"use strict";var e=require("http"),t=require("https"),n=require("url"),r=require("stream"),a=require("assert"),i=require("zlib"),o=require("util"),s=require("path"),l=require("fs"),c=require("crypto"),u=require("node:http"),d=require("node:https"),p=require("node:zlib"),h=require("node:stream"),m=require("node:buffer"),f=require("node:util"),y=require("node:url"),g=require("node:net");require("node:fs"),require("node:path");var b=require("buffer"),v=require("child_process"),w=require("net"),S=require("worker_threads"),E=require("events"),x=require("tty"),_=require("dns"),k=require("tls"),I=require("string_decoder");function T(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function A(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var O=T(e),K=T(t),C=T(n),R=T(r),j=T(a),P=T(i),D=T(o),N=T(s),L=A(s),M=T(l),F=A(l),B=T(c),V=T(u),U=T(d),J=T(p),G=T(h),q=T(b),z=T(w),W=T(E),Y=T(x),H=T(_),Q=T(k),Z=T(I),X="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ee(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var te={exports:{}},ne=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},re=ne,ae=Object.prototype.toString,ie=function(e){return function(t){var n=ae.call(t);return e[n]||(e[n]=n.slice(8,-1).toLowerCase())}}(Object.create(null));function oe(e){return e=e.toLowerCase(),function(t){return ie(t)===e}}function se(e){return Array.isArray(e)}function le(e){return void 0===e}var ce=oe("ArrayBuffer");function ue(e){return null!==e&&"object"==typeof e}function de(e){if("object"!==ie(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}var pe=oe("Date"),he=oe("File"),me=oe("Blob"),fe=oe("FileList");function ye(e){return"[object Function]"===ae.call(e)}var ge=oe("URLSearchParams");function be(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),se(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.call(null,e[a],a,e)}var ve=function(e){return function(t){return e&&t instanceof e}}("undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array)),we={isArray:se,isArrayBuffer:ce,isBuffer:function(e){return null!==e&&!le(e)&&null!==e.constructor&&!le(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){var t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||ae.call(e)===t||ye(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&ce(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:ue,isPlainObject:de,isUndefined:le,isDate:pe,isFile:he,isBlob:me,isFunction:ye,isStream:function(e){return ue(e)&&ye(e.pipe)},isURLSearchParams:ge,isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:be,merge:function e(){var t={};function n(n,r){de(t[r])&&de(n)?t[r]=e(t[r],n):de(n)?t[r]=e({},n):se(n)?t[r]=n.slice():t[r]=n}for(var r=0,a=arguments.length;r<a;r++)be(arguments[r],n);return t},extend:function(e,t,n){return be(t,(function(t,r){e[r]=n&&"function"==typeof t?re(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e},inherits:function(e,t,n,r){e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,n&&Object.assign(e.prototype,n)},toFlatObject:function(e,t,n){var r,a,i,o={};t=t||{};do{for(a=(r=Object.getOwnPropertyNames(e)).length;a-- >0;)o[i=r[a]]||(t[i]=e[i],o[i]=!0);e=Object.getPrototypeOf(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:ie,kindOfTest:oe,endsWith:function(e,t,n){e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;var r=e.indexOf(t,n);return-1!==r&&r===n},toArray:function(e){if(!e)return null;var t=e.length;if(le(t))return null;for(var n=new Array(t);t-- >0;)n[t]=e[t];return n},isTypedArray:ve,isFileList:fe},Se=we;function Ee(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var xe=function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(Se.isURLSearchParams(t))r=t.toString();else{var a=[];Se.forEach(t,(function(e,t){null!=e&&(Se.isArray(e)?t+="[]":e=[e],Se.forEach(e,(function(e){Se.isDate(e)?e=e.toISOString():Se.isObject(e)&&(e=JSON.stringify(e)),a.push(Ee(t)+"="+Ee(e))})))})),r=a.join("&")}if(r){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e},_e=we;function ke(){this.handlers=[]}ke.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},ke.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},ke.prototype.forEach=function(e){_e.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var Ie=ke,Te=we,Ae=we;function Oe(e,t,n,r,a){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),a&&(this.response=a)}Ae.inherits(Oe,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var Ke=Oe.prototype,Ce={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(e){Ce[e]={value:e}})),Object.defineProperties(Oe,Ce),Object.defineProperty(Ke,"isAxiosError",{value:!0}),Oe.from=function(e,t,n,r,a,i){var o=Object.create(Ke);return Ae.toFlatObject(e,o,(function(e){return e!==Error.prototype})),Oe.call(o,e.message,t,n,r,a),o.name=e.name,i&&Object.assign(o,i),o};var Re=Oe,je={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Pe=we;var De=function(e,t){t=t||new FormData;var n=[];function r(e){return null===e?"":Pe.isDate(e)?e.toISOString():Pe.isArrayBuffer(e)||Pe.isTypedArray(e)?"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}return function e(a,i){if(Pe.isPlainObject(a)||Pe.isArray(a)){if(-1!==n.indexOf(a))throw Error("Circular reference detected in "+i);n.push(a),Pe.forEach(a,(function(n,a){if(!Pe.isUndefined(n)){var o,s=i?i+"."+a:a;if(n&&!i&&"object"==typeof n)if(Pe.endsWith(a,"{}"))n=JSON.stringify(n);else if(Pe.endsWith(a,"[]")&&(o=Pe.toArray(n)))return void o.forEach((function(e){!Pe.isUndefined(e)&&t.append(s,r(e))}));e(n,s)}})),n.pop()}else t.append(i,r(a))}(e),t},Ne=Re,Le=function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new Ne("Request failed with status code "+n.status,[Ne.ERR_BAD_REQUEST,Ne.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)},Me=we,Fe=Me.isStandardBrowserEnv()?{write:function(e,t,n,r,a,i){var o=[];o.push(e+"="+encodeURIComponent(t)),Me.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),Me.isString(r)&&o.push("path="+r),Me.isString(a)&&o.push("domain="+a),!0===i&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Be=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},Ve=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},Ue=function(e,t){return e&&!Be(t)?Ve(e,t):t},Je=we,Ge=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],$e=we,qe=$e.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=$e.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0},ze=Re;function We(e){ze.call(this,null==e?"canceled":e,ze.ERR_CANCELED),this.name="CanceledError"}we.inherits(We,ze,{__CANCEL__:!0});var Ye,He=We,Qe=we,Ze=Le,Xe=Fe,et=xe,tt=Ue,nt=function(e){var t,n,r,a={};return e?(Je.forEach(e.split("\n"),(function(e){if(r=e.indexOf(":"),t=Je.trim(e.substr(0,r)).toLowerCase(),n=Je.trim(e.substr(r+1)),t){if(a[t]&&Ge.indexOf(t)>=0)return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([n]):a[t]?a[t]+", "+n:n}})),a):a},rt=qe,at=je,it=Re,ot=He,st=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""},lt=function(e){return new Promise((function(t,n){var r,a=e.data,i=e.headers,o=e.responseType;function s(){e.cancelToken&&e.cancelToken.unsubscribe(r),e.signal&&e.signal.removeEventListener("abort",r)}Qe.isFormData(a)&&Qe.isStandardBrowserEnv()&&delete i["Content-Type"];var l=new XMLHttpRequest;if(e.auth){var c=e.auth.username||"",u=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";i.Authorization="Basic "+btoa(c+":"+u)}var d=tt(e.baseURL,e.url);function p(){if(l){var r="getAllResponseHeaders"in l?nt(l.getAllResponseHeaders()):null,a={data:o&&"text"!==o&&"json"!==o?l.response:l.responseText,status:l.status,statusText:l.statusText,headers:r,config:e,request:l};Ze((function(e){t(e),s()}),(function(e){n(e),s()}),a),l=null}}if(l.open(e.method.toUpperCase(),et(d,e.params,e.paramsSerializer),!0),l.timeout=e.timeout,"onloadend"in l?l.onloadend=p:l.onreadystatechange=function(){l&&4===l.readyState&&(0!==l.status||l.responseURL&&0===l.responseURL.indexOf("file:"))&&setTimeout(p)},l.onabort=function(){l&&(n(new it("Request aborted",it.ECONNABORTED,e,l)),l=null)},l.onerror=function(){n(new it("Network Error",it.ERR_NETWORK,e,l,l)),l=null},l.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",r=e.transitional||at;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new it(t,r.clarifyTimeoutError?it.ETIMEDOUT:it.ECONNABORTED,e,l)),l=null},Qe.isStandardBrowserEnv()){var h=(e.withCredentials||rt(d))&&e.xsrfCookieName?Xe.read(e.xsrfCookieName):void 0;h&&(i[e.xsrfHeaderName]=h)}"setRequestHeader"in l&&Qe.forEach(i,(function(e,t){void 0===a&&"content-type"===t.toLowerCase()?delete i[t]:l.setRequestHeader(t,e)})),Qe.isUndefined(e.withCredentials)||(l.withCredentials=!!e.withCredentials),o&&"json"!==o&&(l.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&l.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&l.upload&&l.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(r=function(e){l&&(n(!e||e&&e.type?new ot:e),l.abort(),l=null)},e.cancelToken&&e.cancelToken.subscribe(r),e.signal&&(e.signal.aborted?r():e.signal.addEventListener("abort",r))),a||(a=null);var m=st(d);m&&-1===["http","https","file"].indexOf(m)?n(new it("Unsupported protocol "+m+":",it.ERR_BAD_REQUEST,e)):l.send(a)}))},ct={exports:{}},ut=C.default,dt=ut.URL,pt=O.default,ht=K.default,mt=R.default.Writable,ft=j.default,yt=function(){if(!Ye){try{Ye=require("debug")("follow-redirects")}catch(e){}"function"!=typeof Ye&&(Ye=function(){})}Ye.apply(null,arguments)},gt=["abort","aborted","connect","error","socket","timeout"],bt=Object.create(null);gt.forEach((function(e){bt[e]=function(t,n,r){this._redirectable.emit(e,t,n,r)}}));var vt=Ot("ERR_INVALID_URL","Invalid URL",TypeError),wt=Ot("ERR_FR_REDIRECTION_FAILURE","Redirected request failed"),St=Ot("ERR_FR_TOO_MANY_REDIRECTS","Maximum number of redirects exceeded"),Et=Ot("ERR_FR_MAX_BODY_LENGTH_EXCEEDED","Request body larger than maxBodyLength limit"),xt=Ot("ERR_STREAM_WRITE_AFTER_END","write after end");function _t(e,t){mt.call(this),this._sanitizeOptions(e),this._options=e,this._ended=!1,this._ending=!1,this._redirectCount=0,this._redirects=[],this._requestBodyLength=0,this._requestBodyBuffers=[],t&&this.on("response",t);var n=this;this._onNativeResponse=function(e){n._processResponse(e)},this._performRequest()}function kt(e){var t={maxRedirects:21,maxBodyLength:10485760},n={};return Object.keys(e).forEach((function(r){var a=r+":",i=n[a]=e[r],o=t[r]=Object.create(i);Object.defineProperties(o,{request:{value:function(e,r,i){if(Ct(e)){var o;try{o=Tt(new dt(e))}catch(t){o=ut.parse(e)}if(!Ct(o.protocol))throw new vt({input:e});e=o}else dt&&e instanceof dt?e=Tt(e):(i=r,r=e,e={protocol:a});return Rt(r)&&(i=r,r=null),(r=Object.assign({maxRedirects:t.maxRedirects,maxBodyLength:t.maxBodyLength},e,r)).nativeProtocols=n,Ct(r.host)||Ct(r.hostname)||(r.hostname="::1"),ft.equal(r.protocol,a,"protocol mismatch"),yt("options",r),new _t(r,i)},configurable:!0,enumerable:!0,writable:!0},get:{value:function(e,t,n){var r=o.request(e,t,n);return r.end(),r},configurable:!0,enumerable:!0,writable:!0}})})),t}function It(){}function Tt(e){var t={protocol:e.protocol,hostname:e.hostname.startsWith("[")?e.hostname.slice(1,-1):e.hostname,hash:e.hash,search:e.search,pathname:e.pathname,path:e.pathname+e.search,href:e.href};return""!==e.port&&(t.port=Number(e.port)),t}function At(e,t){var n;for(var r in t)e.test(r)&&(n=t[r],delete t[r]);return null==n?void 0:String(n).trim()}function Ot(e,t,n){function r(n){Error.captureStackTrace(this,this.constructor),Object.assign(this,n||{}),this.code=e,this.message=this.cause?t+": "+this.cause.message:t}return r.prototype=new(n||Error),r.prototype.constructor=r,r.prototype.name="Error ["+e+"]",r}function Kt(e){for(var t of gt)e.removeListener(t,bt[t]);e.on("error",It),e.abort()}function Ct(e){return"string"==typeof e||e instanceof String}function Rt(e){return"function"==typeof e}_t.prototype=Object.create(mt.prototype),_t.prototype.abort=function(){Kt(this._currentRequest),this.emit("abort")},_t.prototype.write=function(e,t,n){if(this._ending)throw new xt;if(!Ct(e)&&("object"!=typeof(r=e)||!("length"in r)))throw new TypeError("data should be a string, Buffer or Uint8Array");var r;Rt(t)&&(n=t,t=null),0!==e.length?this._requestBodyLength+e.length<=this._options.maxBodyLength?(this._requestBodyLength+=e.length,this._requestBodyBuffers.push({data:e,encoding:t}),this._currentRequest.write(e,t,n)):(this.emit("error",new Et),this.abort()):n&&n()},_t.prototype.end=function(e,t,n){if(Rt(e)?(n=e,e=t=null):Rt(t)&&(n=t,t=null),e){var r=this,a=this._currentRequest;this.write(e,t,(function(){r._ended=!0,a.end(null,null,n)})),this._ending=!0}else this._ended=this._ending=!0,this._currentRequest.end(null,null,n)},_t.prototype.setHeader=function(e,t){this._options.headers[e]=t,this._currentRequest.setHeader(e,t)},_t.prototype.removeHeader=function(e){delete this._options.headers[e],this._currentRequest.removeHeader(e)},_t.prototype.setTimeout=function(e,t){var n=this;function r(t){t.setTimeout(e),t.removeListener("timeout",t.destroy),t.addListener("timeout",t.destroy)}function a(t){n._timeout&&clearTimeout(n._timeout),n._timeout=setTimeout((function(){n.emit("timeout"),i()}),e),r(t)}function i(){n._timeout&&(clearTimeout(n._timeout),n._timeout=null),n.removeListener("abort",i),n.removeListener("error",i),n.removeListener("response",i),t&&n.removeListener("timeout",t),n.socket||n._currentRequest.removeListener("socket",a)}return t&&this.on("timeout",t),this.socket?a(this.socket):this._currentRequest.once("socket",a),this.on("socket",r),this.on("abort",i),this.on("error",i),this.on("response",i),this},["flushHeaders","getHeader","setNoDelay","setSocketKeepAlive"].forEach((function(e){_t.prototype[e]=function(t,n){return this._currentRequest[e](t,n)}})),["aborted","connection","socket"].forEach((function(e){Object.defineProperty(_t.prototype,e,{get:function(){return this._currentRequest[e]}})})),_t.prototype._sanitizeOptions=function(e){if(e.headers||(e.headers={}),e.host&&(e.hostname||(e.hostname=e.host),delete e.host),!e.pathname&&e.path){var t=e.path.indexOf("?");t<0?e.pathname=e.path:(e.pathname=e.path.substring(0,t),e.search=e.path.substring(t))}},_t.prototype._performRequest=function(){var e=this._options.protocol,t=this._options.nativeProtocols[e];if(t){if(this._options.agents){var n=e.slice(0,-1);this._options.agent=this._options.agents[n]}var r=this._currentRequest=t.request(this._options,this._onNativeResponse);for(var a of(r._redirectable=this,gt))r.on(a,bt[a]);if(this._currentUrl=/^\//.test(this._options.path)?ut.format(this._options):this._options.path,this._isRedirect){var i=0,o=this,s=this._requestBodyBuffers;!function e(t){if(r===o._currentRequest)if(t)o.emit("error",t);else if(i<s.length){var n=s[i++];r.finished||r.write(n.data,n.encoding,e)}else o._ended&&r.end()}()}}else this.emit("error",new TypeError("Unsupported protocol "+e))},_t.prototype._processResponse=function(e){var t=e.statusCode;this._options.trackRedirects&&this._redirects.push({url:this._currentUrl,headers:e.headers,statusCode:t});var n=e.headers.location;if(!n||!1===this._options.followRedirects||t<300||t>=400)return e.responseUrl=this._currentUrl,e.redirects=this._redirects,this.emit("response",e),void(this._requestBodyBuffers=[]);if(Kt(this._currentRequest),e.destroy(),++this._redirectCount>this._options.maxRedirects)this.emit("error",new St);else{var r,a=this._options.beforeRedirect;a&&(r=Object.assign({Host:e.req.getHeader("host")},this._options.headers));var i=this._options.method;((301===t||302===t)&&"POST"===this._options.method||303===t&&!/^(?:GET|HEAD)$/.test(this._options.method))&&(this._options.method="GET",this._requestBodyBuffers=[],At(/^content-/i,this._options.headers));var o,s=At(/^host$/i,this._options.headers),l=ut.parse(this._currentUrl),c=s||l.host,u=/^\w+:/.test(n)?this._currentUrl:ut.format(Object.assign(l,{host:c}));try{o=ut.resolve(u,n)}catch(e){return void this.emit("error",new wt({cause:e}))}yt("redirecting to",o),this._isRedirect=!0;var d=ut.parse(o);if(Object.assign(this._options,d),(d.protocol!==l.protocol&&"https:"!==d.protocol||d.host!==c&&!function(e,t){ft(Ct(e)&&Ct(t));var n=e.length-t.length-1;return n>0&&"."===e[n]&&e.endsWith(t)}(d.host,c))&&At(/^(?:authorization|cookie)$/i,this._options.headers),Rt(a)){var p={headers:e.headers,statusCode:t},h={url:u,method:i,headers:r};try{a(this._options,p,h)}catch(e){return void this.emit("error",e)}this._sanitizeOptions(this._options)}try{this._performRequest()}catch(e){this.emit("error",new wt({cause:e}))}}},ct.exports=kt({http:pt,https:ht}),ct.exports.wrap=kt;var jt="0.27.2",Pt=we,Dt=Le,Nt=Ue,Lt=xe,Mt=O.default,Ft=K.default,Bt=ct.exports.http,Vt=ct.exports.https,Ut=C.default,Jt=P.default,Gt=jt,$t=je,qt=Re,zt=He,Wt=/https:?/,Yt=["http:","https:","file:"];function Ht(e,t,n){if(e.hostname=t.host,e.host=t.host,e.port=t.port,e.path=n,t.auth){var r=Buffer.from(t.auth.username+":"+t.auth.password,"utf8").toString("base64");e.headers["Proxy-Authorization"]="Basic "+r}e.beforeRedirect=function(e){e.headers.host=e.host,Ht(e,t,e.href)}}var Qt=function(e){return new Promise((function(t,n){var r;function a(){e.cancelToken&&e.cancelToken.unsubscribe(r),e.signal&&e.signal.removeEventListener("abort",r)}var i=function(e){a(),t(e)},o=!1,s=function(e){a(),o=!0,n(e)},l=e.data,c=e.headers,u={};if(Object.keys(c).forEach((function(e){u[e.toLowerCase()]=e})),"user-agent"in u?c[u["user-agent"]]||delete c[u["user-agent"]]:c["User-Agent"]="axios/"+Gt,Pt.isFormData(l)&&Pt.isFunction(l.getHeaders))Object.assign(c,l.getHeaders());else if(l&&!Pt.isStream(l)){if(Buffer.isBuffer(l));else if(Pt.isArrayBuffer(l))l=Buffer.from(new Uint8Array(l));else{if(!Pt.isString(l))return s(new qt("Data after transformation must be a string, an ArrayBuffer, a Buffer, or a Stream",qt.ERR_BAD_REQUEST,e));l=Buffer.from(l,"utf-8")}if(e.maxBodyLength>-1&&l.length>e.maxBodyLength)return s(new qt("Request body larger than maxBodyLength limit",qt.ERR_BAD_REQUEST,e));u["content-length"]||(c["Content-Length"]=l.length)}var d=void 0;e.auth&&(d=(e.auth.username||"")+":"+(e.auth.password||""));var p=Nt(e.baseURL,e.url),h=Ut.parse(p),m=h.protocol||Yt[0];if(-1===Yt.indexOf(m))return s(new qt("Unsupported protocol "+m,qt.ERR_BAD_REQUEST,e));if(!d&&h.auth){var f=h.auth.split(":");d=(f[0]||"")+":"+(f[1]||"")}d&&u.authorization&&delete c[u.authorization];var y=Wt.test(m),g=y?e.httpsAgent:e.httpAgent;try{Lt(h.path,e.params,e.paramsSerializer).replace(/^\?/,"")}catch(t){var b=new Error(t.message);b.config=e,b.url=e.url,b.exists=!0,s(b)}var v={path:Lt(h.path,e.params,e.paramsSerializer).replace(/^\?/,""),method:e.method.toUpperCase(),headers:c,agent:g,agents:{http:e.httpAgent,https:e.httpsAgent},auth:d};e.socketPath?v.socketPath=e.socketPath:(v.hostname=h.hostname,v.port=h.port);var w,S=e.proxy;if(!S&&!1!==S){var E=m.slice(0,-1)+"_proxy",x=process.env[E]||process.env[E.toUpperCase()];if(x){var _=Ut.parse(x),k=process.env.no_proxy||process.env.NO_PROXY,I=!0;if(k){var T=k.split(",").map((function(e){return e.trim()}));I=!T.some((function(e){return!!e&&("*"===e||("."===e[0]&&h.hostname.substr(h.hostname.length-e.length)===e||h.hostname===e))}))}if(I&&(S={host:_.hostname,port:_.port,protocol:_.protocol},_.auth)){var A=_.auth.split(":");S.auth={username:A[0],password:A[1]}}}}S&&(v.headers.host=h.hostname+(h.port?":"+h.port:""),Ht(v,S,m+"//"+h.hostname+(h.port?":"+h.port:"")+v.path));var O=y&&(!S||Wt.test(S.protocol));e.transport?w=e.transport:0===e.maxRedirects?w=O?Ft:Mt:(e.maxRedirects&&(v.maxRedirects=e.maxRedirects),e.beforeRedirect&&(v.beforeRedirect=e.beforeRedirect),w=O?Vt:Bt),e.maxBodyLength>-1&&(v.maxBodyLength=e.maxBodyLength),e.insecureHTTPParser&&(v.insecureHTTPParser=e.insecureHTTPParser);var K=w.request(v,(function(t){if(!K.aborted){var n=t,r=t.req||K;if(204!==t.statusCode&&"HEAD"!==r.method&&!1!==e.decompress)switch(t.headers["content-encoding"]){case"gzip":case"compress":case"deflate":n=n.pipe(Jt.createUnzip()),delete t.headers["content-encoding"]}var a={status:t.statusCode,statusText:t.statusMessage,headers:t.headers,config:e,request:r};if("stream"===e.responseType)a.data=n,Dt(i,s,a);else{var l=[],c=0;n.on("data",(function(t){l.push(t),c+=t.length,e.maxContentLength>-1&&c>e.maxContentLength&&(o=!0,n.destroy(),s(new qt("maxContentLength size of "+e.maxContentLength+" exceeded",qt.ERR_BAD_RESPONSE,e,r)))})),n.on("aborted",(function(){o||(n.destroy(),s(new qt("maxContentLength size of "+e.maxContentLength+" exceeded",qt.ERR_BAD_RESPONSE,e,r)))})),n.on("error",(function(t){K.aborted||s(qt.from(t,null,e,r))})),n.on("end",(function(){try{var t=1===l.length?l[0]:Buffer.concat(l);"arraybuffer"!==e.responseType&&(t=t.toString(e.responseEncoding),e.responseEncoding&&"utf8"!==e.responseEncoding||(t=Pt.stripBOM(t))),a.data=t}catch(t){s(qt.from(t,null,e,a.request,a))}Dt(i,s,a)}))}}}));if(K.on("error",(function(t){s(qt.from(t,null,e,K))})),K.on("socket",(function(e){e.setKeepAlive(!0,6e4)})),e.timeout){var C=parseInt(e.timeout,10);if(isNaN(C))return void s(new qt("error trying to parse `config.timeout` to int",qt.ERR_BAD_OPTION_VALUE,e,K));K.setTimeout(C,(function(){K.abort();var t=e.transitional||$t;s(new qt("timeout of "+C+"ms exceeded",t.clarifyTimeoutError?qt.ETIMEDOUT:qt.ECONNABORTED,e,K))}))}(e.cancelToken||e.signal)&&(r=function(e){K.aborted||(K.abort(),s(!e||e&&e.type?new zt:e))},e.cancelToken&&e.cancelToken.subscribe(r),e.signal&&(e.signal.aborted?r():e.signal.addEventListener("abort",r))),Pt.isStream(l)?l.on("error",(function(t){s(qt.from(t,e,null,K))})).pipe(K):K.end(l)}))},Zt=R.default.Stream,Xt=en;function en(){this.source=null,this.dataSize=0,this.maxDataSize=1048576,this.pauseStream=!0,this._maxDataSizeExceeded=!1,this._released=!1,this._bufferedEvents=[]}D.default.inherits(en,Zt),en.create=function(e,t){var n=new this;for(var r in t=t||{})n[r]=t[r];n.source=e;var a=e.emit;return e.emit=function(){return n._handleEmit(arguments),a.apply(e,arguments)},e.on("error",(function(){})),n.pauseStream&&e.pause(),n},Object.defineProperty(en.prototype,"readable",{configurable:!0,enumerable:!0,get:function(){return this.source.readable}}),en.prototype.setEncoding=function(){return this.source.setEncoding.apply(this.source,arguments)},en.prototype.resume=function(){this._released||this.release(),this.source.resume()},en.prototype.pause=function(){this.source.pause()},en.prototype.release=function(){this._released=!0,this._bufferedEvents.forEach(function(e){this.emit.apply(this,e)}.bind(this)),this._bufferedEvents=[]},en.prototype.pipe=function(){var e=Zt.prototype.pipe.apply(this,arguments);return this.resume(),e},en.prototype._handleEmit=function(e){this._released?this.emit.apply(this,e):("data"===e[0]&&(this.dataSize+=e[1].length,this._checkIfMaxDataSizeExceeded()),this._bufferedEvents.push(e))},en.prototype._checkIfMaxDataSizeExceeded=function(){if(!(this._maxDataSizeExceeded||this.dataSize<=this.maxDataSize)){this._maxDataSizeExceeded=!0;var e="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this.emit("error",new Error(e))}};var tn=D.default,nn=R.default.Stream,rn=Xt,an=on;function on(){this.writable=!1,this.readable=!0,this.dataSize=0,this.maxDataSize=2097152,this.pauseStreams=!0,this._released=!1,this._streams=[],this._currentStream=null,this._insideLoop=!1,this._pendingNext=!1}tn.inherits(on,nn),on.create=function(e){var t=new this;for(var n in e=e||{})t[n]=e[n];return t},on.isStreamLike=function(e){return"function"!=typeof e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e&&!Buffer.isBuffer(e)},on.prototype.append=function(e){if(on.isStreamLike(e)){if(!(e instanceof rn)){var t=rn.create(e,{maxDataSize:1/0,pauseStream:this.pauseStreams});e.on("data",this._checkDataSize.bind(this)),e=t}this._handleErrors(e),this.pauseStreams&&e.pause()}return this._streams.push(e),this},on.prototype.pipe=function(e,t){return nn.prototype.pipe.call(this,e,t),this.resume(),e},on.prototype._getNext=function(){if(this._currentStream=null,this._insideLoop)this._pendingNext=!0;else{this._insideLoop=!0;try{do{this._pendingNext=!1,this._realGetNext()}while(this._pendingNext)}finally{this._insideLoop=!1}}},on.prototype._realGetNext=function(){var e=this._streams.shift();void 0!==e?"function"==typeof e?e(function(e){on.isStreamLike(e)&&(e.on("data",this._checkDataSize.bind(this)),this._handleErrors(e)),this._pipeNext(e)}.bind(this)):this._pipeNext(e):this.end()},on.prototype._pipeNext=function(e){if(this._currentStream=e,on.isStreamLike(e))return e.on("end",this._getNext.bind(this)),void e.pipe(this,{end:!1});var t=e;this.write(t),this._getNext()},on.prototype._handleErrors=function(e){var t=this;e.on("error",(function(e){t._emitError(e)}))},on.prototype.write=function(e){this.emit("data",e)},on.prototype.pause=function(){this.pauseStreams&&(this.pauseStreams&&this._currentStream&&"function"==typeof this._currentStream.pause&&this._currentStream.pause(),this.emit("pause"))},on.prototype.resume=function(){this._released||(this._released=!0,this.writable=!0,this._getNext()),this.pauseStreams&&this._currentStream&&"function"==typeof this._currentStream.resume&&this._currentStream.resume(),this.emit("resume")},on.prototype.end=function(){this._reset(),this.emit("end")},on.prototype.destroy=function(){this._reset(),this.emit("close")},on.prototype._reset=function(){this.writable=!1,this._streams=[],this._currentStream=null},on.prototype._checkDataSize=function(){if(this._updateDataSize(),!(this.dataSize<=this.maxDataSize)){var e="DelayedStream#maxDataSize of "+this.maxDataSize+" bytes exceeded.";this._emitError(new Error(e))}},on.prototype._updateDataSize=function(){this.dataSize=0;var e=this;this._streams.forEach((function(t){t.dataSize&&(e.dataSize+=t.dataSize)})),this._currentStream&&this._currentStream.dataSize&&(this.dataSize+=this._currentStream.dataSize)},on.prototype._emitError=function(e){this._reset(),this.emit("error",e)};var sn={},ln={"application/1d-interleaved-parityfec":{source:"iana"},"application/3gpdash-qoe-report+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/3gpp-ims+xml":{source:"iana",compressible:!0},"application/3gpphal+json":{source:"iana",compressible:!0},"application/3gpphalforms+json":{source:"iana",compressible:!0},"application/a2l":{source:"iana"},"application/ace+cbor":{source:"iana"},"application/activemessage":{source:"iana"},"application/activity+json":{source:"iana",compressible:!0},"application/alto-costmap+json":{source:"iana",compressible:!0},"application/alto-costmapfilter+json":{source:"iana",compressible:!0},"application/alto-directory+json":{source:"iana",compressible:!0},"application/alto-endpointcost+json":{source:"iana",compressible:!0},"application/alto-endpointcostparams+json":{source:"iana",compressible:!0},"application/alto-endpointprop+json":{source:"iana",compressible:!0},"application/alto-endpointpropparams+json":{source:"iana",compressible:!0},"application/alto-error+json":{source:"iana",compressible:!0},"application/alto-networkmap+json":{source:"iana",compressible:!0},"application/alto-networkmapfilter+json":{source:"iana",compressible:!0},"application/alto-updatestreamcontrol+json":{source:"iana",compressible:!0},"application/alto-updatestreamparams+json":{source:"iana",compressible:!0},"application/aml":{source:"iana"},"application/andrew-inset":{source:"iana",extensions:["ez"]},"application/applefile":{source:"iana"},"application/applixware":{source:"apache",extensions:["aw"]},"application/at+jwt":{source:"iana"},"application/atf":{source:"iana"},"application/atfx":{source:"iana"},"application/atom+xml":{source:"iana",compressible:!0,extensions:["atom"]},"application/atomcat+xml":{source:"iana",compressible:!0,extensions:["atomcat"]},"application/atomdeleted+xml":{source:"iana",compressible:!0,extensions:["atomdeleted"]},"application/atomicmail":{source:"iana"},"application/atomsvc+xml":{source:"iana",compressible:!0,extensions:["atomsvc"]},"application/atsc-dwd+xml":{source:"iana",compressible:!0,extensions:["dwd"]},"application/atsc-dynamic-event-message":{source:"iana"},"application/atsc-held+xml":{source:"iana",compressible:!0,extensions:["held"]},"application/atsc-rdt+json":{source:"iana",compressible:!0},"application/atsc-rsat+xml":{source:"iana",compressible:!0,extensions:["rsat"]},"application/atxml":{source:"iana"},"application/auth-policy+xml":{source:"iana",compressible:!0},"application/bacnet-xdd+zip":{source:"iana",compressible:!1},"application/batch-smtp":{source:"iana"},"application/bdoc":{compressible:!1,extensions:["bdoc"]},"application/beep+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/calendar+json":{source:"iana",compressible:!0},"application/calendar+xml":{source:"iana",compressible:!0,extensions:["xcs"]},"application/call-completion":{source:"iana"},"application/cals-1840":{source:"iana"},"application/captive+json":{source:"iana",compressible:!0},"application/cbor":{source:"iana"},"application/cbor-seq":{source:"iana"},"application/cccex":{source:"iana"},"application/ccmp+xml":{source:"iana",compressible:!0},"application/ccxml+xml":{source:"iana",compressible:!0,extensions:["ccxml"]},"application/cdfx+xml":{source:"iana",compressible:!0,extensions:["cdfx"]},"application/cdmi-capability":{source:"iana",extensions:["cdmia"]},"application/cdmi-container":{source:"iana",extensions:["cdmic"]},"application/cdmi-domain":{source:"iana",extensions:["cdmid"]},"application/cdmi-object":{source:"iana",extensions:["cdmio"]},"application/cdmi-queue":{source:"iana",extensions:["cdmiq"]},"application/cdni":{source:"iana"},"application/cea":{source:"iana"},"application/cea-2018+xml":{source:"iana",compressible:!0},"application/cellml+xml":{source:"iana",compressible:!0},"application/cfw":{source:"iana"},"application/city+json":{source:"iana",compressible:!0},"application/clr":{source:"iana"},"application/clue+xml":{source:"iana",compressible:!0},"application/clue_info+xml":{source:"iana",compressible:!0},"application/cms":{source:"iana"},"application/cnrp+xml":{source:"iana",compressible:!0},"application/coap-group+json":{source:"iana",compressible:!0},"application/coap-payload":{source:"iana"},"application/commonground":{source:"iana"},"application/conference-info+xml":{source:"iana",compressible:!0},"application/cose":{source:"iana"},"application/cose-key":{source:"iana"},"application/cose-key-set":{source:"iana"},"application/cpl+xml":{source:"iana",compressible:!0,extensions:["cpl"]},"application/csrattrs":{source:"iana"},"application/csta+xml":{source:"iana",compressible:!0},"application/cstadata+xml":{source:"iana",compressible:!0},"application/csvm+json":{source:"iana",compressible:!0},"application/cu-seeme":{source:"apache",extensions:["cu"]},"application/cwt":{source:"iana"},"application/cybercash":{source:"iana"},"application/dart":{compressible:!0},"application/dash+xml":{source:"iana",compressible:!0,extensions:["mpd"]},"application/dash-patch+xml":{source:"iana",compressible:!0,extensions:["mpp"]},"application/dashdelta":{source:"iana"},"application/davmount+xml":{source:"iana",compressible:!0,extensions:["davmount"]},"application/dca-rft":{source:"iana"},"application/dcd":{source:"iana"},"application/dec-dx":{source:"iana"},"application/dialog-info+xml":{source:"iana",compressible:!0},"application/dicom":{source:"iana"},"application/dicom+json":{source:"iana",compressible:!0},"application/dicom+xml":{source:"iana",compressible:!0},"application/dii":{source:"iana"},"application/dit":{source:"iana"},"application/dns":{source:"iana"},"application/dns+json":{source:"iana",compressible:!0},"application/dns-message":{source:"iana"},"application/docbook+xml":{source:"apache",compressible:!0,extensions:["dbk"]},"application/dots+cbor":{source:"iana"},"application/dskpp+xml":{source:"iana",compressible:!0},"application/dssc+der":{source:"iana",extensions:["dssc"]},"application/dssc+xml":{source:"iana",compressible:!0,extensions:["xdssc"]},"application/dvcs":{source:"iana"},"application/ecmascript":{source:"iana",compressible:!0,extensions:["es","ecma"]},"application/edi-consent":{source:"iana"},"application/edi-x12":{source:"iana",compressible:!1},"application/edifact":{source:"iana",compressible:!1},"application/efi":{source:"iana"},"application/elm+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/elm+xml":{source:"iana",compressible:!0},"application/emergencycalldata.cap+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/emergencycalldata.comment+xml":{source:"iana",compressible:!0},"application/emergencycalldata.control+xml":{source:"iana",compressible:!0},"application/emergencycalldata.deviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.ecall.msd":{source:"iana"},"application/emergencycalldata.providerinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.serviceinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.subscriberinfo+xml":{source:"iana",compressible:!0},"application/emergencycalldata.veds+xml":{source:"iana",compressible:!0},"application/emma+xml":{source:"iana",compressible:!0,extensions:["emma"]},"application/emotionml+xml":{source:"iana",compressible:!0,extensions:["emotionml"]},"application/encaprtp":{source:"iana"},"application/epp+xml":{source:"iana",compressible:!0},"application/epub+zip":{source:"iana",compressible:!1,extensions:["epub"]},"application/eshop":{source:"iana"},"application/exi":{source:"iana",extensions:["exi"]},"application/expect-ct-report+json":{source:"iana",compressible:!0},"application/express":{source:"iana",extensions:["exp"]},"application/fastinfoset":{source:"iana"},"application/fastsoap":{source:"iana"},"application/fdt+xml":{source:"iana",compressible:!0,extensions:["fdt"]},"application/fhir+json":{source:"iana",charset:"UTF-8",compressible:!0},"application/fhir+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/fido.trusted-apps+json":{compressible:!0},"application/fits":{source:"iana"},"application/flexfec":{source:"iana"},"application/font-sfnt":{source:"iana"},"application/font-tdpfr":{source:"iana",extensions:["pfr"]},"application/font-woff":{source:"iana",compressible:!1},"application/framework-attributes+xml":{source:"iana",compressible:!0},"application/geo+json":{source:"iana",compressible:!0,extensions:["geojson"]},"application/geo+json-seq":{source:"iana"},"application/geopackage+sqlite3":{source:"iana"},"application/geoxacml+xml":{source:"iana",compressible:!0},"application/gltf-buffer":{source:"iana"},"application/gml+xml":{source:"iana",compressible:!0,extensions:["gml"]},"application/gpx+xml":{source:"apache",compressible:!0,extensions:["gpx"]},"application/gxf":{source:"apache",extensions:["gxf"]},"application/gzip":{source:"iana",compressible:!1,extensions:["gz"]},"application/h224":{source:"iana"},"application/held+xml":{source:"iana",compressible:!0},"application/hjson":{extensions:["hjson"]},"application/http":{source:"iana"},"application/hyperstudio":{source:"iana",extensions:["stk"]},"application/ibe-key-request+xml":{source:"iana",compressible:!0},"application/ibe-pkg-reply+xml":{source:"iana",compressible:!0},"application/ibe-pp-data":{source:"iana"},"application/iges":{source:"iana"},"application/im-iscomposing+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/index":{source:"iana"},"application/index.cmd":{source:"iana"},"application/index.obj":{source:"iana"},"application/index.response":{source:"iana"},"application/index.vnd":{source:"iana"},"application/inkml+xml":{source:"iana",compressible:!0,extensions:["ink","inkml"]},"application/iotp":{source:"iana"},"application/ipfix":{source:"iana",extensions:["ipfix"]},"application/ipp":{source:"iana"},"application/isup":{source:"iana"},"application/its+xml":{source:"iana",compressible:!0,extensions:["its"]},"application/java-archive":{source:"apache",compressible:!1,extensions:["jar","war","ear"]},"application/java-serialized-object":{source:"apache",compressible:!1,extensions:["ser"]},"application/java-vm":{source:"apache",compressible:!1,extensions:["class"]},"application/javascript":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["js","mjs"]},"application/jf2feed+json":{source:"iana",compressible:!0},"application/jose":{source:"iana"},"application/jose+json":{source:"iana",compressible:!0},"application/jrd+json":{source:"iana",compressible:!0},"application/jscalendar+json":{source:"iana",compressible:!0},"application/json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["json","map"]},"application/json-patch+json":{source:"iana",compressible:!0},"application/json-seq":{source:"iana"},"application/json5":{extensions:["json5"]},"application/jsonml+json":{source:"apache",compressible:!0,extensions:["jsonml"]},"application/jwk+json":{source:"iana",compressible:!0},"application/jwk-set+json":{source:"iana",compressible:!0},"application/jwt":{source:"iana"},"application/kpml-request+xml":{source:"iana",compressible:!0},"application/kpml-response+xml":{source:"iana",compressible:!0},"application/ld+json":{source:"iana",compressible:!0,extensions:["jsonld"]},"application/lgr+xml":{source:"iana",compressible:!0,extensions:["lgr"]},"application/link-format":{source:"iana"},"application/load-control+xml":{source:"iana",compressible:!0},"application/lost+xml":{source:"iana",compressible:!0,extensions:["lostxml"]},"application/lostsync+xml":{source:"iana",compressible:!0},"application/lpf+zip":{source:"iana",compressible:!1},"application/lxf":{source:"iana"},"application/mac-binhex40":{source:"iana",extensions:["hqx"]},"application/mac-compactpro":{source:"apache",extensions:["cpt"]},"application/macwriteii":{source:"iana"},"application/mads+xml":{source:"iana",compressible:!0,extensions:["mads"]},"application/manifest+json":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["webmanifest"]},"application/marc":{source:"iana",extensions:["mrc"]},"application/marcxml+xml":{source:"iana",compressible:!0,extensions:["mrcx"]},"application/mathematica":{source:"iana",extensions:["ma","nb","mb"]},"application/mathml+xml":{source:"iana",compressible:!0,extensions:["mathml"]},"application/mathml-content+xml":{source:"iana",compressible:!0},"application/mathml-presentation+xml":{source:"iana",compressible:!0},"application/mbms-associated-procedure-description+xml":{source:"iana",compressible:!0},"application/mbms-deregister+xml":{source:"iana",compressible:!0},"application/mbms-envelope+xml":{source:"iana",compressible:!0},"application/mbms-msk+xml":{source:"iana",compressible:!0},"application/mbms-msk-response+xml":{source:"iana",compressible:!0},"application/mbms-protection-description+xml":{source:"iana",compressible:!0},"application/mbms-reception-report+xml":{source:"iana",compressible:!0},"application/mbms-register+xml":{source:"iana",compressible:!0},"application/mbms-register-response+xml":{source:"iana",compressible:!0},"application/mbms-schedule+xml":{source:"iana",compressible:!0},"application/mbms-user-service-description+xml":{source:"iana",compressible:!0},"application/mbox":{source:"iana",extensions:["mbox"]},"application/media-policy-dataset+xml":{source:"iana",compressible:!0,extensions:["mpf"]},"application/media_control+xml":{source:"iana",compressible:!0},"application/mediaservercontrol+xml":{source:"iana",compressible:!0,extensions:["mscml"]},"application/merge-patch+json":{source:"iana",compressible:!0},"application/metalink+xml":{source:"apache",compressible:!0,extensions:["metalink"]},"application/metalink4+xml":{source:"iana",compressible:!0,extensions:["meta4"]},"application/mets+xml":{source:"iana",compressible:!0,extensions:["mets"]},"application/mf4":{source:"iana"},"application/mikey":{source:"iana"},"application/mipc":{source:"iana"},"application/missing-blocks+cbor-seq":{source:"iana"},"application/mmt-aei+xml":{source:"iana",compressible:!0,extensions:["maei"]},"application/mmt-usd+xml":{source:"iana",compressible:!0,extensions:["musd"]},"application/mods+xml":{source:"iana",compressible:!0,extensions:["mods"]},"application/moss-keys":{source:"iana"},"application/moss-signature":{source:"iana"},"application/mosskey-data":{source:"iana"},"application/mosskey-request":{source:"iana"},"application/mp21":{source:"iana",extensions:["m21","mp21"]},"application/mp4":{source:"iana",extensions:["mp4s","m4p"]},"application/mpeg4-generic":{source:"iana"},"application/mpeg4-iod":{source:"iana"},"application/mpeg4-iod-xmt":{source:"iana"},"application/mrb-consumer+xml":{source:"iana",compressible:!0},"application/mrb-publish+xml":{source:"iana",compressible:!0},"application/msc-ivr+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msc-mixer+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/msword":{source:"iana",compressible:!1,extensions:["doc","dot"]},"application/mud+json":{source:"iana",compressible:!0},"application/multipart-core":{source:"iana"},"application/mxf":{source:"iana",extensions:["mxf"]},"application/n-quads":{source:"iana",extensions:["nq"]},"application/n-triples":{source:"iana",extensions:["nt"]},"application/nasdata":{source:"iana"},"application/news-checkgroups":{source:"iana",charset:"US-ASCII"},"application/news-groupinfo":{source:"iana",charset:"US-ASCII"},"application/news-transmission":{source:"iana"},"application/nlsml+xml":{source:"iana",compressible:!0},"application/node":{source:"iana",extensions:["cjs"]},"application/nss":{source:"iana"},"application/oauth-authz-req+jwt":{source:"iana"},"application/oblivious-dns-message":{source:"iana"},"application/ocsp-request":{source:"iana"},"application/ocsp-response":{source:"iana"},"application/octet-stream":{source:"iana",compressible:!1,extensions:["bin","dms","lrf","mar","so","dist","distz","pkg","bpk","dump","elc","deploy","exe","dll","deb","dmg","iso","img","msi","msp","msm","buffer"]},"application/oda":{source:"iana",extensions:["oda"]},"application/odm+xml":{source:"iana",compressible:!0},"application/odx":{source:"iana"},"application/oebps-package+xml":{source:"iana",compressible:!0,extensions:["opf"]},"application/ogg":{source:"iana",compressible:!1,extensions:["ogx"]},"application/omdoc+xml":{source:"apache",compressible:!0,extensions:["omdoc"]},"application/onenote":{source:"apache",extensions:["onetoc","onetoc2","onetmp","onepkg"]},"application/opc-nodeset+xml":{source:"iana",compressible:!0},"application/oscore":{source:"iana"},"application/oxps":{source:"iana",extensions:["oxps"]},"application/p21":{source:"iana"},"application/p21+zip":{source:"iana",compressible:!1},"application/p2p-overlay+xml":{source:"iana",compressible:!0,extensions:["relo"]},"application/parityfec":{source:"iana"},"application/passport":{source:"iana"},"application/patch-ops-error+xml":{source:"iana",compressible:!0,extensions:["xer"]},"application/pdf":{source:"iana",compressible:!1,extensions:["pdf"]},"application/pdx":{source:"iana"},"application/pem-certificate-chain":{source:"iana"},"application/pgp-encrypted":{source:"iana",compressible:!1,extensions:["pgp"]},"application/pgp-keys":{source:"iana",extensions:["asc"]},"application/pgp-signature":{source:"iana",extensions:["asc","sig"]},"application/pics-rules":{source:"apache",extensions:["prf"]},"application/pidf+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pidf-diff+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/pkcs10":{source:"iana",extensions:["p10"]},"application/pkcs12":{source:"iana"},"application/pkcs7-mime":{source:"iana",extensions:["p7m","p7c"]},"application/pkcs7-signature":{source:"iana",extensions:["p7s"]},"application/pkcs8":{source:"iana",extensions:["p8"]},"application/pkcs8-encrypted":{source:"iana"},"application/pkix-attr-cert":{source:"iana",extensions:["ac"]},"application/pkix-cert":{source:"iana",extensions:["cer"]},"application/pkix-crl":{source:"iana",extensions:["crl"]},"application/pkix-pkipath":{source:"iana",extensions:["pkipath"]},"application/pkixcmp":{source:"iana",extensions:["pki"]},"application/pls+xml":{source:"iana",compressible:!0,extensions:["pls"]},"application/poc-settings+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/postscript":{source:"iana",compressible:!0,extensions:["ai","eps","ps"]},"application/ppsp-tracker+json":{source:"iana",compressible:!0},"application/problem+json":{source:"iana",compressible:!0},"application/problem+xml":{source:"iana",compressible:!0},"application/provenance+xml":{source:"iana",compressible:!0,extensions:["provx"]},"application/prs.alvestrand.titrax-sheet":{source:"iana"},"application/prs.cww":{source:"iana",extensions:["cww"]},"application/prs.cyn":{source:"iana",charset:"7-BIT"},"application/prs.hpub+zip":{source:"iana",compressible:!1},"application/prs.nprend":{source:"iana"},"application/prs.plucker":{source:"iana"},"application/prs.rdf-xml-crypt":{source:"iana"},"application/prs.xsf+xml":{source:"iana",compressible:!0},"application/pskc+xml":{source:"iana",compressible:!0,extensions:["pskcxml"]},"application/pvd+json":{source:"iana",compressible:!0},"application/qsig":{source:"iana"},"application/raml+yaml":{compressible:!0,extensions:["raml"]},"application/raptorfec":{source:"iana"},"application/rdap+json":{source:"iana",compressible:!0},"application/rdf+xml":{source:"iana",compressible:!0,extensions:["rdf","owl"]},"application/reginfo+xml":{source:"iana",compressible:!0,extensions:["rif"]},"application/relax-ng-compact-syntax":{source:"iana",extensions:["rnc"]},"application/remote-printing":{source:"iana"},"application/reputon+json":{source:"iana",compressible:!0},"application/resource-lists+xml":{source:"iana",compressible:!0,extensions:["rl"]},"application/resource-lists-diff+xml":{source:"iana",compressible:!0,extensions:["rld"]},"application/rfc+xml":{source:"iana",compressible:!0},"application/riscos":{source:"iana"},"application/rlmi+xml":{source:"iana",compressible:!0},"application/rls-services+xml":{source:"iana",compressible:!0,extensions:["rs"]},"application/route-apd+xml":{source:"iana",compressible:!0,extensions:["rapd"]},"application/route-s-tsid+xml":{source:"iana",compressible:!0,extensions:["sls"]},"application/route-usd+xml":{source:"iana",compressible:!0,extensions:["rusd"]},"application/rpki-ghostbusters":{source:"iana",extensions:["gbr"]},"application/rpki-manifest":{source:"iana",extensions:["mft"]},"application/rpki-publication":{source:"iana"},"application/rpki-roa":{source:"iana",extensions:["roa"]},"application/rpki-updown":{source:"iana"},"application/rsd+xml":{source:"apache",compressible:!0,extensions:["rsd"]},"application/rss+xml":{source:"apache",compressible:!0,extensions:["rss"]},"application/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"application/rtploopback":{source:"iana"},"application/rtx":{source:"iana"},"application/samlassertion+xml":{source:"iana",compressible:!0},"application/samlmetadata+xml":{source:"iana",compressible:!0},"application/sarif+json":{source:"iana",compressible:!0},"application/sarif-external-properties+json":{source:"iana",compressible:!0},"application/sbe":{source:"iana"},"application/sbml+xml":{source:"iana",compressible:!0,extensions:["sbml"]},"application/scaip+xml":{source:"iana",compressible:!0},"application/scim+json":{source:"iana",compressible:!0},"application/scvp-cv-request":{source:"iana",extensions:["scq"]},"application/scvp-cv-response":{source:"iana",extensions:["scs"]},"application/scvp-vp-request":{source:"iana",extensions:["spq"]},"application/scvp-vp-response":{source:"iana",extensions:["spp"]},"application/sdp":{source:"iana",extensions:["sdp"]},"application/secevent+jwt":{source:"iana"},"application/senml+cbor":{source:"iana"},"application/senml+json":{source:"iana",compressible:!0},"application/senml+xml":{source:"iana",compressible:!0,extensions:["senmlx"]},"application/senml-etch+cbor":{source:"iana"},"application/senml-etch+json":{source:"iana",compressible:!0},"application/senml-exi":{source:"iana"},"application/sensml+cbor":{source:"iana"},"application/sensml+json":{source:"iana",compressible:!0},"application/sensml+xml":{source:"iana",compressible:!0,extensions:["sensmlx"]},"application/sensml-exi":{source:"iana"},"application/sep+xml":{source:"iana",compressible:!0},"application/sep-exi":{source:"iana"},"application/session-info":{source:"iana"},"application/set-payment":{source:"iana"},"application/set-payment-initiation":{source:"iana",extensions:["setpay"]},"application/set-registration":{source:"iana"},"application/set-registration-initiation":{source:"iana",extensions:["setreg"]},"application/sgml":{source:"iana"},"application/sgml-open-catalog":{source:"iana"},"application/shf+xml":{source:"iana",compressible:!0,extensions:["shf"]},"application/sieve":{source:"iana",extensions:["siv","sieve"]},"application/simple-filter+xml":{source:"iana",compressible:!0},"application/simple-message-summary":{source:"iana"},"application/simplesymbolcontainer":{source:"iana"},"application/sipc":{source:"iana"},"application/slate":{source:"iana"},"application/smil":{source:"iana"},"application/smil+xml":{source:"iana",compressible:!0,extensions:["smi","smil"]},"application/smpte336m":{source:"iana"},"application/soap+fastinfoset":{source:"iana"},"application/soap+xml":{source:"iana",compressible:!0},"application/sparql-query":{source:"iana",extensions:["rq"]},"application/sparql-results+xml":{source:"iana",compressible:!0,extensions:["srx"]},"application/spdx+json":{source:"iana",compressible:!0},"application/spirits-event+xml":{source:"iana",compressible:!0},"application/sql":{source:"iana"},"application/srgs":{source:"iana",extensions:["gram"]},"application/srgs+xml":{source:"iana",compressible:!0,extensions:["grxml"]},"application/sru+xml":{source:"iana",compressible:!0,extensions:["sru"]},"application/ssdl+xml":{source:"apache",compressible:!0,extensions:["ssdl"]},"application/ssml+xml":{source:"iana",compressible:!0,extensions:["ssml"]},"application/stix+json":{source:"iana",compressible:!0},"application/swid+xml":{source:"iana",compressible:!0,extensions:["swidtag"]},"application/tamp-apex-update":{source:"iana"},"application/tamp-apex-update-confirm":{source:"iana"},"application/tamp-community-update":{source:"iana"},"application/tamp-community-update-confirm":{source:"iana"},"application/tamp-error":{source:"iana"},"application/tamp-sequence-adjust":{source:"iana"},"application/tamp-sequence-adjust-confirm":{source:"iana"},"application/tamp-status-query":{source:"iana"},"application/tamp-status-response":{source:"iana"},"application/tamp-update":{source:"iana"},"application/tamp-update-confirm":{source:"iana"},"application/tar":{compressible:!0},"application/taxii+json":{source:"iana",compressible:!0},"application/td+json":{source:"iana",compressible:!0},"application/tei+xml":{source:"iana",compressible:!0,extensions:["tei","teicorpus"]},"application/tetra_isi":{source:"iana"},"application/thraud+xml":{source:"iana",compressible:!0,extensions:["tfi"]},"application/timestamp-query":{source:"iana"},"application/timestamp-reply":{source:"iana"},"application/timestamped-data":{source:"iana",extensions:["tsd"]},"application/tlsrpt+gzip":{source:"iana"},"application/tlsrpt+json":{source:"iana",compressible:!0},"application/tnauthlist":{source:"iana"},"application/token-introspection+jwt":{source:"iana"},"application/toml":{compressible:!0,extensions:["toml"]},"application/trickle-ice-sdpfrag":{source:"iana"},"application/trig":{source:"iana",extensions:["trig"]},"application/ttml+xml":{source:"iana",compressible:!0,extensions:["ttml"]},"application/tve-trigger":{source:"iana"},"application/tzif":{source:"iana"},"application/tzif-leap":{source:"iana"},"application/ubjson":{compressible:!1,extensions:["ubj"]},"application/ulpfec":{source:"iana"},"application/urc-grpsheet+xml":{source:"iana",compressible:!0},"application/urc-ressheet+xml":{source:"iana",compressible:!0,extensions:["rsheet"]},"application/urc-targetdesc+xml":{source:"iana",compressible:!0,extensions:["td"]},"application/urc-uisocketdesc+xml":{source:"iana",compressible:!0},"application/vcard+json":{source:"iana",compressible:!0},"application/vcard+xml":{source:"iana",compressible:!0},"application/vemmi":{source:"iana"},"application/vividence.scriptfile":{source:"apache"},"application/vnd.1000minds.decision-model+xml":{source:"iana",compressible:!0,extensions:["1km"]},"application/vnd.3gpp-prose+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-prose-pc3ch+xml":{source:"iana",compressible:!0},"application/vnd.3gpp-v2x-local-service-information":{source:"iana"},"application/vnd.3gpp.5gnas":{source:"iana"},"application/vnd.3gpp.access-transfer-events+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.bsf+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gmop+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.gtpc":{source:"iana"},"application/vnd.3gpp.interworking-data":{source:"iana"},"application/vnd.3gpp.lpp":{source:"iana"},"application/vnd.3gpp.mc-signalling-ear":{source:"iana"},"application/vnd.3gpp.mcdata-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-payload":{source:"iana"},"application/vnd.3gpp.mcdata-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-signalling":{source:"iana"},"application/vnd.3gpp.mcdata-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcdata-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-floor-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-signed+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-ue-init-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcptt-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-command+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-affiliation-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-location-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-mbms-usage-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-service-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-transmission-request+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-ue-config+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mcvideo-user-profile+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.mid-call+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ngap":{source:"iana"},"application/vnd.3gpp.pfcp":{source:"iana"},"application/vnd.3gpp.pic-bw-large":{source:"iana",extensions:["plb"]},"application/vnd.3gpp.pic-bw-small":{source:"iana",extensions:["psb"]},"application/vnd.3gpp.pic-bw-var":{source:"iana",extensions:["pvb"]},"application/vnd.3gpp.s1ap":{source:"iana"},"application/vnd.3gpp.sms":{source:"iana"},"application/vnd.3gpp.sms+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-ext+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.srvcc-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.state-and-event-info+xml":{source:"iana",compressible:!0},"application/vnd.3gpp.ussd+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.bcmcsinfo+xml":{source:"iana",compressible:!0},"application/vnd.3gpp2.sms":{source:"iana"},"application/vnd.3gpp2.tcap":{source:"iana",extensions:["tcap"]},"application/vnd.3lightssoftware.imagescal":{source:"iana"},"application/vnd.3m.post-it-notes":{source:"iana",extensions:["pwn"]},"application/vnd.accpac.simply.aso":{source:"iana",extensions:["aso"]},"application/vnd.accpac.simply.imp":{source:"iana",extensions:["imp"]},"application/vnd.acucobol":{source:"iana",extensions:["acu"]},"application/vnd.acucorp":{source:"iana",extensions:["atc","acutc"]},"application/vnd.adobe.air-application-installer-package+zip":{source:"apache",compressible:!1,extensions:["air"]},"application/vnd.adobe.flash.movie":{source:"iana"},"application/vnd.adobe.formscentral.fcdt":{source:"iana",extensions:["fcdt"]},"application/vnd.adobe.fxp":{source:"iana",extensions:["fxp","fxpl"]},"application/vnd.adobe.partial-upload":{source:"iana"},"application/vnd.adobe.xdp+xml":{source:"iana",compressible:!0,extensions:["xdp"]},"application/vnd.adobe.xfdf":{source:"iana",extensions:["xfdf"]},"application/vnd.aether.imp":{source:"iana"},"application/vnd.afpc.afplinedata":{source:"iana"},"application/vnd.afpc.afplinedata-pagedef":{source:"iana"},"application/vnd.afpc.cmoca-cmresource":{source:"iana"},"application/vnd.afpc.foca-charset":{source:"iana"},"application/vnd.afpc.foca-codedfont":{source:"iana"},"application/vnd.afpc.foca-codepage":{source:"iana"},"application/vnd.afpc.modca":{source:"iana"},"application/vnd.afpc.modca-cmtable":{source:"iana"},"application/vnd.afpc.modca-formdef":{source:"iana"},"application/vnd.afpc.modca-mediummap":{source:"iana"},"application/vnd.afpc.modca-objectcontainer":{source:"iana"},"application/vnd.afpc.modca-overlay":{source:"iana"},"application/vnd.afpc.modca-pagesegment":{source:"iana"},"application/vnd.age":{source:"iana",extensions:["age"]},"application/vnd.ah-barcode":{source:"iana"},"application/vnd.ahead.space":{source:"iana",extensions:["ahead"]},"application/vnd.airzip.filesecure.azf":{source:"iana",extensions:["azf"]},"application/vnd.airzip.filesecure.azs":{source:"iana",extensions:["azs"]},"application/vnd.amadeus+json":{source:"iana",compressible:!0},"application/vnd.amazon.ebook":{source:"apache",extensions:["azw"]},"application/vnd.amazon.mobi8-ebook":{source:"iana"},"application/vnd.americandynamics.acc":{source:"iana",extensions:["acc"]},"application/vnd.amiga.ami":{source:"iana",extensions:["ami"]},"application/vnd.amundsen.maze+xml":{source:"iana",compressible:!0},"application/vnd.android.ota":{source:"iana"},"application/vnd.android.package-archive":{source:"apache",compressible:!1,extensions:["apk"]},"application/vnd.anki":{source:"iana"},"application/vnd.anser-web-certificate-issue-initiation":{source:"iana",extensions:["cii"]},"application/vnd.anser-web-funds-transfer-initiation":{source:"apache",extensions:["fti"]},"application/vnd.antix.game-component":{source:"iana",extensions:["atx"]},"application/vnd.apache.arrow.file":{source:"iana"},"application/vnd.apache.arrow.stream":{source:"iana"},"application/vnd.apache.thrift.binary":{source:"iana"},"application/vnd.apache.thrift.compact":{source:"iana"},"application/vnd.apache.thrift.json":{source:"iana"},"application/vnd.api+json":{source:"iana",compressible:!0},"application/vnd.aplextor.warrp+json":{source:"iana",compressible:!0},"application/vnd.apothekende.reservation+json":{source:"iana",compressible:!0},"application/vnd.apple.installer+xml":{source:"iana",compressible:!0,extensions:["mpkg"]},"application/vnd.apple.keynote":{source:"iana",extensions:["key"]},"application/vnd.apple.mpegurl":{source:"iana",extensions:["m3u8"]},"application/vnd.apple.numbers":{source:"iana",extensions:["numbers"]},"application/vnd.apple.pages":{source:"iana",extensions:["pages"]},"application/vnd.apple.pkpass":{compressible:!1,extensions:["pkpass"]},"application/vnd.arastra.swi":{source:"iana"},"application/vnd.aristanetworks.swi":{source:"iana",extensions:["swi"]},"application/vnd.artisan+json":{source:"iana",compressible:!0},"application/vnd.artsquare":{source:"iana"},"application/vnd.astraea-software.iota":{source:"iana",extensions:["iota"]},"application/vnd.audiograph":{source:"iana",extensions:["aep"]},"application/vnd.autopackage":{source:"iana"},"application/vnd.avalon+json":{source:"iana",compressible:!0},"application/vnd.avistar+xml":{source:"iana",compressible:!0},"application/vnd.balsamiq.bmml+xml":{source:"iana",compressible:!0,extensions:["bmml"]},"application/vnd.balsamiq.bmpr":{source:"iana"},"application/vnd.banana-accounting":{source:"iana"},"application/vnd.bbf.usp.error":{source:"iana"},"application/vnd.bbf.usp.msg":{source:"iana"},"application/vnd.bbf.usp.msg+json":{source:"iana",compressible:!0},"application/vnd.bekitzur-stech+json":{source:"iana",compressible:!0},"application/vnd.bint.med-content":{source:"iana"},"application/vnd.biopax.rdf+xml":{source:"iana",compressible:!0},"application/vnd.blink-idb-value-wrapper":{source:"iana"},"application/vnd.blueice.multipass":{source:"iana",extensions:["mpm"]},"application/vnd.bluetooth.ep.oob":{source:"iana"},"application/vnd.bluetooth.le.oob":{source:"iana"},"application/vnd.bmi":{source:"iana",extensions:["bmi"]},"application/vnd.bpf":{source:"iana"},"application/vnd.bpf3":{source:"iana"},"application/vnd.businessobjects":{source:"iana",extensions:["rep"]},"application/vnd.byu.uapi+json":{source:"iana",compressible:!0},"application/vnd.cab-jscript":{source:"iana"},"application/vnd.canon-cpdl":{source:"iana"},"application/vnd.canon-lips":{source:"iana"},"application/vnd.capasystems-pg+json":{source:"iana",compressible:!0},"application/vnd.cendio.thinlinc.clientconf":{source:"iana"},"application/vnd.century-systems.tcp_stream":{source:"iana"},"application/vnd.chemdraw+xml":{source:"iana",compressible:!0,extensions:["cdxml"]},"application/vnd.chess-pgn":{source:"iana"},"application/vnd.chipnuts.karaoke-mmd":{source:"iana",extensions:["mmd"]},"application/vnd.ciedi":{source:"iana"},"application/vnd.cinderella":{source:"iana",extensions:["cdy"]},"application/vnd.cirpack.isdn-ext":{source:"iana"},"application/vnd.citationstyles.style+xml":{source:"iana",compressible:!0,extensions:["csl"]},"application/vnd.claymore":{source:"iana",extensions:["cla"]},"application/vnd.cloanto.rp9":{source:"iana",extensions:["rp9"]},"application/vnd.clonk.c4group":{source:"iana",extensions:["c4g","c4d","c4f","c4p","c4u"]},"application/vnd.cluetrust.cartomobile-config":{source:"iana",extensions:["c11amc"]},"application/vnd.cluetrust.cartomobile-config-pkg":{source:"iana",extensions:["c11amz"]},"application/vnd.coffeescript":{source:"iana"},"application/vnd.collabio.xodocuments.document":{source:"iana"},"application/vnd.collabio.xodocuments.document-template":{source:"iana"},"application/vnd.collabio.xodocuments.presentation":{source:"iana"},"application/vnd.collabio.xodocuments.presentation-template":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet":{source:"iana"},"application/vnd.collabio.xodocuments.spreadsheet-template":{source:"iana"},"application/vnd.collection+json":{source:"iana",compressible:!0},"application/vnd.collection.doc+json":{source:"iana",compressible:!0},"application/vnd.collection.next+json":{source:"iana",compressible:!0},"application/vnd.comicbook+zip":{source:"iana",compressible:!1},"application/vnd.comicbook-rar":{source:"iana"},"application/vnd.commerce-battelle":{source:"iana"},"application/vnd.commonspace":{source:"iana",extensions:["csp"]},"application/vnd.contact.cmsg":{source:"iana",extensions:["cdbcmsg"]},"application/vnd.coreos.ignition+json":{source:"iana",compressible:!0},"application/vnd.cosmocaller":{source:"iana",extensions:["cmc"]},"application/vnd.crick.clicker":{source:"iana",extensions:["clkx"]},"application/vnd.crick.clicker.keyboard":{source:"iana",extensions:["clkk"]},"application/vnd.crick.clicker.palette":{source:"iana",extensions:["clkp"]},"application/vnd.crick.clicker.template":{source:"iana",extensions:["clkt"]},"application/vnd.crick.clicker.wordbank":{source:"iana",extensions:["clkw"]},"application/vnd.criticaltools.wbs+xml":{source:"iana",compressible:!0,extensions:["wbs"]},"application/vnd.cryptii.pipe+json":{source:"iana",compressible:!0},"application/vnd.crypto-shade-file":{source:"iana"},"application/vnd.cryptomator.encrypted":{source:"iana"},"application/vnd.cryptomator.vault":{source:"iana"},"application/vnd.ctc-posml":{source:"iana",extensions:["pml"]},"application/vnd.ctct.ws+xml":{source:"iana",compressible:!0},"application/vnd.cups-pdf":{source:"iana"},"application/vnd.cups-postscript":{source:"iana"},"application/vnd.cups-ppd":{source:"iana",extensions:["ppd"]},"application/vnd.cups-raster":{source:"iana"},"application/vnd.cups-raw":{source:"iana"},"application/vnd.curl":{source:"iana"},"application/vnd.curl.car":{source:"apache",extensions:["car"]},"application/vnd.curl.pcurl":{source:"apache",extensions:["pcurl"]},"application/vnd.cyan.dean.root+xml":{source:"iana",compressible:!0},"application/vnd.cybank":{source:"iana"},"application/vnd.cyclonedx+json":{source:"iana",compressible:!0},"application/vnd.cyclonedx+xml":{source:"iana",compressible:!0},"application/vnd.d2l.coursepackage1p0+zip":{source:"iana",compressible:!1},"application/vnd.d3m-dataset":{source:"iana"},"application/vnd.d3m-problem":{source:"iana"},"application/vnd.dart":{source:"iana",compressible:!0,extensions:["dart"]},"application/vnd.data-vision.rdz":{source:"iana",extensions:["rdz"]},"application/vnd.datapackage+json":{source:"iana",compressible:!0},"application/vnd.dataresource+json":{source:"iana",compressible:!0},"application/vnd.dbf":{source:"iana",extensions:["dbf"]},"application/vnd.debian.binary-package":{source:"iana"},"application/vnd.dece.data":{source:"iana",extensions:["uvf","uvvf","uvd","uvvd"]},"application/vnd.dece.ttml+xml":{source:"iana",compressible:!0,extensions:["uvt","uvvt"]},"application/vnd.dece.unspecified":{source:"iana",extensions:["uvx","uvvx"]},"application/vnd.dece.zip":{source:"iana",extensions:["uvz","uvvz"]},"application/vnd.denovo.fcselayout-link":{source:"iana",extensions:["fe_launch"]},"application/vnd.desmume.movie":{source:"iana"},"application/vnd.dir-bi.plate-dl-nosuffix":{source:"iana"},"application/vnd.dm.delegation+xml":{source:"iana",compressible:!0},"application/vnd.dna":{source:"iana",extensions:["dna"]},"application/vnd.document+json":{source:"iana",compressible:!0},"application/vnd.dolby.mlp":{source:"apache",extensions:["mlp"]},"application/vnd.dolby.mobile.1":{source:"iana"},"application/vnd.dolby.mobile.2":{source:"iana"},"application/vnd.doremir.scorecloud-binary-document":{source:"iana"},"application/vnd.dpgraph":{source:"iana",extensions:["dpg"]},"application/vnd.dreamfactory":{source:"iana",extensions:["dfac"]},"application/vnd.drive+json":{source:"iana",compressible:!0},"application/vnd.ds-keypoint":{source:"apache",extensions:["kpxx"]},"application/vnd.dtg.local":{source:"iana"},"application/vnd.dtg.local.flash":{source:"iana"},"application/vnd.dtg.local.html":{source:"iana"},"application/vnd.dvb.ait":{source:"iana",extensions:["ait"]},"application/vnd.dvb.dvbisl+xml":{source:"iana",compressible:!0},"application/vnd.dvb.dvbj":{source:"iana"},"application/vnd.dvb.esgcontainer":{source:"iana"},"application/vnd.dvb.ipdcdftnotifaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess":{source:"iana"},"application/vnd.dvb.ipdcesgaccess2":{source:"iana"},"application/vnd.dvb.ipdcesgpdd":{source:"iana"},"application/vnd.dvb.ipdcroaming":{source:"iana"},"application/vnd.dvb.iptv.alfec-base":{source:"iana"},"application/vnd.dvb.iptv.alfec-enhancement":{source:"iana"},"application/vnd.dvb.notif-aggregate-root+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-container+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-generic+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-msglist+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-request+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-ia-registration-response+xml":{source:"iana",compressible:!0},"application/vnd.dvb.notif-init+xml":{source:"iana",compressible:!0},"application/vnd.dvb.pfr":{source:"iana"},"application/vnd.dvb.service":{source:"iana",extensions:["svc"]},"application/vnd.dxr":{source:"iana"},"application/vnd.dynageo":{source:"iana",extensions:["geo"]},"application/vnd.dzr":{source:"iana"},"application/vnd.easykaraoke.cdgdownload":{source:"iana"},"application/vnd.ecdis-update":{source:"iana"},"application/vnd.ecip.rlp":{source:"iana"},"application/vnd.eclipse.ditto+json":{source:"iana",compressible:!0},"application/vnd.ecowin.chart":{source:"iana",extensions:["mag"]},"application/vnd.ecowin.filerequest":{source:"iana"},"application/vnd.ecowin.fileupdate":{source:"iana"},"application/vnd.ecowin.series":{source:"iana"},"application/vnd.ecowin.seriesrequest":{source:"iana"},"application/vnd.ecowin.seriesupdate":{source:"iana"},"application/vnd.efi.img":{source:"iana"},"application/vnd.efi.iso":{source:"iana"},"application/vnd.emclient.accessrequest+xml":{source:"iana",compressible:!0},"application/vnd.enliven":{source:"iana",extensions:["nml"]},"application/vnd.enphase.envoy":{source:"iana"},"application/vnd.eprints.data+xml":{source:"iana",compressible:!0},"application/vnd.epson.esf":{source:"iana",extensions:["esf"]},"application/vnd.epson.msf":{source:"iana",extensions:["msf"]},"application/vnd.epson.quickanime":{source:"iana",extensions:["qam"]},"application/vnd.epson.salt":{source:"iana",extensions:["slt"]},"application/vnd.epson.ssf":{source:"iana",extensions:["ssf"]},"application/vnd.ericsson.quickcall":{source:"iana"},"application/vnd.espass-espass+zip":{source:"iana",compressible:!1},"application/vnd.eszigno3+xml":{source:"iana",compressible:!0,extensions:["es3","et3"]},"application/vnd.etsi.aoc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.asic-e+zip":{source:"iana",compressible:!1},"application/vnd.etsi.asic-s+zip":{source:"iana",compressible:!1},"application/vnd.etsi.cug+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvcommand+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-bc+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-cod+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsad-npvr+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvservice+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvsync+xml":{source:"iana",compressible:!0},"application/vnd.etsi.iptvueprofile+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mcid+xml":{source:"iana",compressible:!0},"application/vnd.etsi.mheg5":{source:"iana"},"application/vnd.etsi.overload-control-policy-dataset+xml":{source:"iana",compressible:!0},"application/vnd.etsi.pstn+xml":{source:"iana",compressible:!0},"application/vnd.etsi.sci+xml":{source:"iana",compressible:!0},"application/vnd.etsi.simservs+xml":{source:"iana",compressible:!0},"application/vnd.etsi.timestamp-token":{source:"iana"},"application/vnd.etsi.tsl+xml":{source:"iana",compressible:!0},"application/vnd.etsi.tsl.der":{source:"iana"},"application/vnd.eu.kasparian.car+json":{source:"iana",compressible:!0},"application/vnd.eudora.data":{source:"iana"},"application/vnd.evolv.ecig.profile":{source:"iana"},"application/vnd.evolv.ecig.settings":{source:"iana"},"application/vnd.evolv.ecig.theme":{source:"iana"},"application/vnd.exstream-empower+zip":{source:"iana",compressible:!1},"application/vnd.exstream-package":{source:"iana"},"application/vnd.ezpix-album":{source:"iana",extensions:["ez2"]},"application/vnd.ezpix-package":{source:"iana",extensions:["ez3"]},"application/vnd.f-secure.mobile":{source:"iana"},"application/vnd.familysearch.gedcom+zip":{source:"iana",compressible:!1},"application/vnd.fastcopy-disk-image":{source:"iana"},"application/vnd.fdf":{source:"iana",extensions:["fdf"]},"application/vnd.fdsn.mseed":{source:"iana",extensions:["mseed"]},"application/vnd.fdsn.seed":{source:"iana",extensions:["seed","dataless"]},"application/vnd.ffsns":{source:"iana"},"application/vnd.ficlab.flb+zip":{source:"iana",compressible:!1},"application/vnd.filmit.zfc":{source:"iana"},"application/vnd.fints":{source:"iana"},"application/vnd.firemonkeys.cloudcell":{source:"iana"},"application/vnd.flographit":{source:"iana",extensions:["gph"]},"application/vnd.fluxtime.clip":{source:"iana",extensions:["ftc"]},"application/vnd.font-fontforge-sfd":{source:"iana"},"application/vnd.framemaker":{source:"iana",extensions:["fm","frame","maker","book"]},"application/vnd.frogans.fnc":{source:"iana",extensions:["fnc"]},"application/vnd.frogans.ltf":{source:"iana",extensions:["ltf"]},"application/vnd.fsc.weblaunch":{source:"iana",extensions:["fsc"]},"application/vnd.fujifilm.fb.docuworks":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.binder":{source:"iana"},"application/vnd.fujifilm.fb.docuworks.container":{source:"iana"},"application/vnd.fujifilm.fb.jfi+xml":{source:"iana",compressible:!0},"application/vnd.fujitsu.oasys":{source:"iana",extensions:["oas"]},"application/vnd.fujitsu.oasys2":{source:"iana",extensions:["oa2"]},"application/vnd.fujitsu.oasys3":{source:"iana",extensions:["oa3"]},"application/vnd.fujitsu.oasysgp":{source:"iana",extensions:["fg5"]},"application/vnd.fujitsu.oasysprs":{source:"iana",extensions:["bh2"]},"application/vnd.fujixerox.art-ex":{source:"iana"},"application/vnd.fujixerox.art4":{source:"iana"},"application/vnd.fujixerox.ddd":{source:"iana",extensions:["ddd"]},"application/vnd.fujixerox.docuworks":{source:"iana",extensions:["xdw"]},"application/vnd.fujixerox.docuworks.binder":{source:"iana",extensions:["xbd"]},"application/vnd.fujixerox.docuworks.container":{source:"iana"},"application/vnd.fujixerox.hbpl":{source:"iana"},"application/vnd.fut-misnet":{source:"iana"},"application/vnd.futoin+cbor":{source:"iana"},"application/vnd.futoin+json":{source:"iana",compressible:!0},"application/vnd.fuzzysheet":{source:"iana",extensions:["fzs"]},"application/vnd.genomatix.tuxedo":{source:"iana",extensions:["txd"]},"application/vnd.gentics.grd+json":{source:"iana",compressible:!0},"application/vnd.geo+json":{source:"iana",compressible:!0},"application/vnd.geocube+xml":{source:"iana",compressible:!0},"application/vnd.geogebra.file":{source:"iana",extensions:["ggb"]},"application/vnd.geogebra.slides":{source:"iana"},"application/vnd.geogebra.tool":{source:"iana",extensions:["ggt"]},"application/vnd.geometry-explorer":{source:"iana",extensions:["gex","gre"]},"application/vnd.geonext":{source:"iana",extensions:["gxt"]},"application/vnd.geoplan":{source:"iana",extensions:["g2w"]},"application/vnd.geospace":{source:"iana",extensions:["g3w"]},"application/vnd.gerber":{source:"iana"},"application/vnd.globalplatform.card-content-mgt":{source:"iana"},"application/vnd.globalplatform.card-content-mgt-response":{source:"iana"},"application/vnd.gmx":{source:"iana",extensions:["gmx"]},"application/vnd.google-apps.document":{compressible:!1,extensions:["gdoc"]},"application/vnd.google-apps.presentation":{compressible:!1,extensions:["gslides"]},"application/vnd.google-apps.spreadsheet":{compressible:!1,extensions:["gsheet"]},"application/vnd.google-earth.kml+xml":{source:"iana",compressible:!0,extensions:["kml"]},"application/vnd.google-earth.kmz":{source:"iana",compressible:!1,extensions:["kmz"]},"application/vnd.gov.sk.e-form+xml":{source:"iana",compressible:!0},"application/vnd.gov.sk.e-form+zip":{source:"iana",compressible:!1},"application/vnd.gov.sk.xmldatacontainer+xml":{source:"iana",compressible:!0},"application/vnd.grafeq":{source:"iana",extensions:["gqf","gqs"]},"application/vnd.gridmp":{source:"iana"},"application/vnd.groove-account":{source:"iana",extensions:["gac"]},"application/vnd.groove-help":{source:"iana",extensions:["ghf"]},"application/vnd.groove-identity-message":{source:"iana",extensions:["gim"]},"application/vnd.groove-injector":{source:"iana",extensions:["grv"]},"application/vnd.groove-tool-message":{source:"iana",extensions:["gtm"]},"application/vnd.groove-tool-template":{source:"iana",extensions:["tpl"]},"application/vnd.groove-vcard":{source:"iana",extensions:["vcg"]},"application/vnd.hal+json":{source:"iana",compressible:!0},"application/vnd.hal+xml":{source:"iana",compressible:!0,extensions:["hal"]},"application/vnd.handheld-entertainment+xml":{source:"iana",compressible:!0,extensions:["zmm"]},"application/vnd.hbci":{source:"iana",extensions:["hbci"]},"application/vnd.hc+json":{source:"iana",compressible:!0},"application/vnd.hcl-bireports":{source:"iana"},"application/vnd.hdt":{source:"iana"},"application/vnd.heroku+json":{source:"iana",compressible:!0},"application/vnd.hhe.lesson-player":{source:"iana",extensions:["les"]},"application/vnd.hl7cda+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hl7v2+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.hp-hpgl":{source:"iana",extensions:["hpgl"]},"application/vnd.hp-hpid":{source:"iana",extensions:["hpid"]},"application/vnd.hp-hps":{source:"iana",extensions:["hps"]},"application/vnd.hp-jlyt":{source:"iana",extensions:["jlt"]},"application/vnd.hp-pcl":{source:"iana",extensions:["pcl"]},"application/vnd.hp-pclxl":{source:"iana",extensions:["pclxl"]},"application/vnd.httphone":{source:"iana"},"application/vnd.hydrostatix.sof-data":{source:"iana",extensions:["sfd-hdstx"]},"application/vnd.hyper+json":{source:"iana",compressible:!0},"application/vnd.hyper-item+json":{source:"iana",compressible:!0},"application/vnd.hyperdrive+json":{source:"iana",compressible:!0},"application/vnd.hzn-3d-crossword":{source:"iana"},"application/vnd.ibm.afplinedata":{source:"iana"},"application/vnd.ibm.electronic-media":{source:"iana"},"application/vnd.ibm.minipay":{source:"iana",extensions:["mpy"]},"application/vnd.ibm.modcap":{source:"iana",extensions:["afp","listafp","list3820"]},"application/vnd.ibm.rights-management":{source:"iana",extensions:["irm"]},"application/vnd.ibm.secure-container":{source:"iana",extensions:["sc"]},"application/vnd.iccprofile":{source:"iana",extensions:["icc","icm"]},"application/vnd.ieee.1905":{source:"iana"},"application/vnd.igloader":{source:"iana",extensions:["igl"]},"application/vnd.imagemeter.folder+zip":{source:"iana",compressible:!1},"application/vnd.imagemeter.image+zip":{source:"iana",compressible:!1},"application/vnd.immervision-ivp":{source:"iana",extensions:["ivp"]},"application/vnd.immervision-ivu":{source:"iana",extensions:["ivu"]},"application/vnd.ims.imsccv1p1":{source:"iana"},"application/vnd.ims.imsccv1p2":{source:"iana"},"application/vnd.ims.imsccv1p3":{source:"iana"},"application/vnd.ims.lis.v2.result+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolconsumerprofile+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolproxy.id+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings+json":{source:"iana",compressible:!0},"application/vnd.ims.lti.v2.toolsettings.simple+json":{source:"iana",compressible:!0},"application/vnd.informedcontrol.rms+xml":{source:"iana",compressible:!0},"application/vnd.informix-visionary":{source:"iana"},"application/vnd.infotech.project":{source:"iana"},"application/vnd.infotech.project+xml":{source:"iana",compressible:!0},"application/vnd.innopath.wamp.notification":{source:"iana"},"application/vnd.insors.igm":{source:"iana",extensions:["igm"]},"application/vnd.intercon.formnet":{source:"iana",extensions:["xpw","xpx"]},"application/vnd.intergeo":{source:"iana",extensions:["i2g"]},"application/vnd.intertrust.digibox":{source:"iana"},"application/vnd.intertrust.nncp":{source:"iana"},"application/vnd.intu.qbo":{source:"iana",extensions:["qbo"]},"application/vnd.intu.qfx":{source:"iana",extensions:["qfx"]},"application/vnd.iptc.g2.catalogitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.conceptitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.knowledgeitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.newsmessage+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.packageitem+xml":{source:"iana",compressible:!0},"application/vnd.iptc.g2.planningitem+xml":{source:"iana",compressible:!0},"application/vnd.ipunplugged.rcprofile":{source:"iana",extensions:["rcprofile"]},"application/vnd.irepository.package+xml":{source:"iana",compressible:!0,extensions:["irp"]},"application/vnd.is-xpr":{source:"iana",extensions:["xpr"]},"application/vnd.isac.fcs":{source:"iana",extensions:["fcs"]},"application/vnd.iso11783-10+zip":{source:"iana",compressible:!1},"application/vnd.jam":{source:"iana",extensions:["jam"]},"application/vnd.japannet-directory-service":{source:"iana"},"application/vnd.japannet-jpnstore-wakeup":{source:"iana"},"application/vnd.japannet-payment-wakeup":{source:"iana"},"application/vnd.japannet-registration":{source:"iana"},"application/vnd.japannet-registration-wakeup":{source:"iana"},"application/vnd.japannet-setstore-wakeup":{source:"iana"},"application/vnd.japannet-verification":{source:"iana"},"application/vnd.japannet-verification-wakeup":{source:"iana"},"application/vnd.jcp.javame.midlet-rms":{source:"iana",extensions:["rms"]},"application/vnd.jisp":{source:"iana",extensions:["jisp"]},"application/vnd.joost.joda-archive":{source:"iana",extensions:["joda"]},"application/vnd.jsk.isdn-ngn":{source:"iana"},"application/vnd.kahootz":{source:"iana",extensions:["ktz","ktr"]},"application/vnd.kde.karbon":{source:"iana",extensions:["karbon"]},"application/vnd.kde.kchart":{source:"iana",extensions:["chrt"]},"application/vnd.kde.kformula":{source:"iana",extensions:["kfo"]},"application/vnd.kde.kivio":{source:"iana",extensions:["flw"]},"application/vnd.kde.kontour":{source:"iana",extensions:["kon"]},"application/vnd.kde.kpresenter":{source:"iana",extensions:["kpr","kpt"]},"application/vnd.kde.kspread":{source:"iana",extensions:["ksp"]},"application/vnd.kde.kword":{source:"iana",extensions:["kwd","kwt"]},"application/vnd.kenameaapp":{source:"iana",extensions:["htke"]},"application/vnd.kidspiration":{source:"iana",extensions:["kia"]},"application/vnd.kinar":{source:"iana",extensions:["kne","knp"]},"application/vnd.koan":{source:"iana",extensions:["skp","skd","skt","skm"]},"application/vnd.kodak-descriptor":{source:"iana",extensions:["sse"]},"application/vnd.las":{source:"iana"},"application/vnd.las.las+json":{source:"iana",compressible:!0},"application/vnd.las.las+xml":{source:"iana",compressible:!0,extensions:["lasxml"]},"application/vnd.laszip":{source:"iana"},"application/vnd.leap+json":{source:"iana",compressible:!0},"application/vnd.liberty-request+xml":{source:"iana",compressible:!0},"application/vnd.llamagraphics.life-balance.desktop":{source:"iana",extensions:["lbd"]},"application/vnd.llamagraphics.life-balance.exchange+xml":{source:"iana",compressible:!0,extensions:["lbe"]},"application/vnd.logipipe.circuit+zip":{source:"iana",compressible:!1},"application/vnd.loom":{source:"iana"},"application/vnd.lotus-1-2-3":{source:"iana",extensions:["123"]},"application/vnd.lotus-approach":{source:"iana",extensions:["apr"]},"application/vnd.lotus-freelance":{source:"iana",extensions:["pre"]},"application/vnd.lotus-notes":{source:"iana",extensions:["nsf"]},"application/vnd.lotus-organizer":{source:"iana",extensions:["org"]},"application/vnd.lotus-screencam":{source:"iana",extensions:["scm"]},"application/vnd.lotus-wordpro":{source:"iana",extensions:["lwp"]},"application/vnd.macports.portpkg":{source:"iana",extensions:["portpkg"]},"application/vnd.mapbox-vector-tile":{source:"iana",extensions:["mvt"]},"application/vnd.marlin.drm.actiontoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.conftoken+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.license+xml":{source:"iana",compressible:!0},"application/vnd.marlin.drm.mdcf":{source:"iana"},"application/vnd.mason+json":{source:"iana",compressible:!0},"application/vnd.maxar.archive.3tz+zip":{source:"iana",compressible:!1},"application/vnd.maxmind.maxmind-db":{source:"iana"},"application/vnd.mcd":{source:"iana",extensions:["mcd"]},"application/vnd.medcalcdata":{source:"iana",extensions:["mc1"]},"application/vnd.mediastation.cdkey":{source:"iana",extensions:["cdkey"]},"application/vnd.meridian-slingshot":{source:"iana"},"application/vnd.mfer":{source:"iana",extensions:["mwf"]},"application/vnd.mfmp":{source:"iana",extensions:["mfm"]},"application/vnd.micro+json":{source:"iana",compressible:!0},"application/vnd.micrografx.flo":{source:"iana",extensions:["flo"]},"application/vnd.micrografx.igx":{source:"iana",extensions:["igx"]},"application/vnd.microsoft.portable-executable":{source:"iana"},"application/vnd.microsoft.windows.thumbnail-cache":{source:"iana"},"application/vnd.miele+json":{source:"iana",compressible:!0},"application/vnd.mif":{source:"iana",extensions:["mif"]},"application/vnd.minisoft-hp3000-save":{source:"iana"},"application/vnd.mitsubishi.misty-guard.trustweb":{source:"iana"},"application/vnd.mobius.daf":{source:"iana",extensions:["daf"]},"application/vnd.mobius.dis":{source:"iana",extensions:["dis"]},"application/vnd.mobius.mbk":{source:"iana",extensions:["mbk"]},"application/vnd.mobius.mqy":{source:"iana",extensions:["mqy"]},"application/vnd.mobius.msl":{source:"iana",extensions:["msl"]},"application/vnd.mobius.plc":{source:"iana",extensions:["plc"]},"application/vnd.mobius.txf":{source:"iana",extensions:["txf"]},"application/vnd.mophun.application":{source:"iana",extensions:["mpn"]},"application/vnd.mophun.certificate":{source:"iana",extensions:["mpc"]},"application/vnd.motorola.flexsuite":{source:"iana"},"application/vnd.motorola.flexsuite.adsi":{source:"iana"},"application/vnd.motorola.flexsuite.fis":{source:"iana"},"application/vnd.motorola.flexsuite.gotap":{source:"iana"},"application/vnd.motorola.flexsuite.kmr":{source:"iana"},"application/vnd.motorola.flexsuite.ttc":{source:"iana"},"application/vnd.motorola.flexsuite.wem":{source:"iana"},"application/vnd.motorola.iprm":{source:"iana"},"application/vnd.mozilla.xul+xml":{source:"iana",compressible:!0,extensions:["xul"]},"application/vnd.ms-3mfdocument":{source:"iana"},"application/vnd.ms-artgalry":{source:"iana",extensions:["cil"]},"application/vnd.ms-asf":{source:"iana"},"application/vnd.ms-cab-compressed":{source:"iana",extensions:["cab"]},"application/vnd.ms-color.iccprofile":{source:"apache"},"application/vnd.ms-excel":{source:"iana",compressible:!1,extensions:["xls","xlm","xla","xlc","xlt","xlw"]},"application/vnd.ms-excel.addin.macroenabled.12":{source:"iana",extensions:["xlam"]},"application/vnd.ms-excel.sheet.binary.macroenabled.12":{source:"iana",extensions:["xlsb"]},"application/vnd.ms-excel.sheet.macroenabled.12":{source:"iana",extensions:["xlsm"]},"application/vnd.ms-excel.template.macroenabled.12":{source:"iana",extensions:["xltm"]},"application/vnd.ms-fontobject":{source:"iana",compressible:!0,extensions:["eot"]},"application/vnd.ms-htmlhelp":{source:"iana",extensions:["chm"]},"application/vnd.ms-ims":{source:"iana",extensions:["ims"]},"application/vnd.ms-lrm":{source:"iana",extensions:["lrm"]},"application/vnd.ms-office.activex+xml":{source:"iana",compressible:!0},"application/vnd.ms-officetheme":{source:"iana",extensions:["thmx"]},"application/vnd.ms-opentype":{source:"apache",compressible:!0},"application/vnd.ms-outlook":{compressible:!1,extensions:["msg"]},"application/vnd.ms-package.obfuscated-opentype":{source:"apache"},"application/vnd.ms-pki.seccat":{source:"apache",extensions:["cat"]},"application/vnd.ms-pki.stl":{source:"apache",extensions:["stl"]},"application/vnd.ms-playready.initiator+xml":{source:"iana",compressible:!0},"application/vnd.ms-powerpoint":{source:"iana",compressible:!1,extensions:["ppt","pps","pot"]},"application/vnd.ms-powerpoint.addin.macroenabled.12":{source:"iana",extensions:["ppam"]},"application/vnd.ms-powerpoint.presentation.macroenabled.12":{source:"iana",extensions:["pptm"]},"application/vnd.ms-powerpoint.slide.macroenabled.12":{source:"iana",extensions:["sldm"]},"application/vnd.ms-powerpoint.slideshow.macroenabled.12":{source:"iana",extensions:["ppsm"]},"application/vnd.ms-powerpoint.template.macroenabled.12":{source:"iana",extensions:["potm"]},"application/vnd.ms-printdevicecapabilities+xml":{source:"iana",compressible:!0},"application/vnd.ms-printing.printticket+xml":{source:"apache",compressible:!0},"application/vnd.ms-printschematicket+xml":{source:"iana",compressible:!0},"application/vnd.ms-project":{source:"iana",extensions:["mpp","mpt"]},"application/vnd.ms-tnef":{source:"iana"},"application/vnd.ms-windows.devicepairing":{source:"iana"},"application/vnd.ms-windows.nwprinting.oob":{source:"iana"},"application/vnd.ms-windows.printerpairing":{source:"iana"},"application/vnd.ms-windows.wsd.oob":{source:"iana"},"application/vnd.ms-wmdrm.lic-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.lic-resp":{source:"iana"},"application/vnd.ms-wmdrm.meter-chlg-req":{source:"iana"},"application/vnd.ms-wmdrm.meter-resp":{source:"iana"},"application/vnd.ms-word.document.macroenabled.12":{source:"iana",extensions:["docm"]},"application/vnd.ms-word.template.macroenabled.12":{source:"iana",extensions:["dotm"]},"application/vnd.ms-works":{source:"iana",extensions:["wps","wks","wcm","wdb"]},"application/vnd.ms-wpl":{source:"iana",extensions:["wpl"]},"application/vnd.ms-xpsdocument":{source:"iana",compressible:!1,extensions:["xps"]},"application/vnd.msa-disk-image":{source:"iana"},"application/vnd.mseq":{source:"iana",extensions:["mseq"]},"application/vnd.msign":{source:"iana"},"application/vnd.multiad.creator":{source:"iana"},"application/vnd.multiad.creator.cif":{source:"iana"},"application/vnd.music-niff":{source:"iana"},"application/vnd.musician":{source:"iana",extensions:["mus"]},"application/vnd.muvee.style":{source:"iana",extensions:["msty"]},"application/vnd.mynfc":{source:"iana",extensions:["taglet"]},"application/vnd.nacamar.ybrid+json":{source:"iana",compressible:!0},"application/vnd.ncd.control":{source:"iana"},"application/vnd.ncd.reference":{source:"iana"},"application/vnd.nearst.inv+json":{source:"iana",compressible:!0},"application/vnd.nebumind.line":{source:"iana"},"application/vnd.nervana":{source:"iana"},"application/vnd.netfpx":{source:"iana"},"application/vnd.neurolanguage.nlu":{source:"iana",extensions:["nlu"]},"application/vnd.nimn":{source:"iana"},"application/vnd.nintendo.nitro.rom":{source:"iana"},"application/vnd.nintendo.snes.rom":{source:"iana"},"application/vnd.nitf":{source:"iana",extensions:["ntf","nitf"]},"application/vnd.noblenet-directory":{source:"iana",extensions:["nnd"]},"application/vnd.noblenet-sealer":{source:"iana",extensions:["nns"]},"application/vnd.noblenet-web":{source:"iana",extensions:["nnw"]},"application/vnd.nokia.catalogs":{source:"iana"},"application/vnd.nokia.conml+wbxml":{source:"iana"},"application/vnd.nokia.conml+xml":{source:"iana",compressible:!0},"application/vnd.nokia.iptv.config+xml":{source:"iana",compressible:!0},"application/vnd.nokia.isds-radio-presets":{source:"iana"},"application/vnd.nokia.landmark+wbxml":{source:"iana"},"application/vnd.nokia.landmark+xml":{source:"iana",compressible:!0},"application/vnd.nokia.landmarkcollection+xml":{source:"iana",compressible:!0},"application/vnd.nokia.n-gage.ac+xml":{source:"iana",compressible:!0,extensions:["ac"]},"application/vnd.nokia.n-gage.data":{source:"iana",extensions:["ngdat"]},"application/vnd.nokia.n-gage.symbian.install":{source:"iana",extensions:["n-gage"]},"application/vnd.nokia.ncd":{source:"iana"},"application/vnd.nokia.pcd+wbxml":{source:"iana"},"application/vnd.nokia.pcd+xml":{source:"iana",compressible:!0},"application/vnd.nokia.radio-preset":{source:"iana",extensions:["rpst"]},"application/vnd.nokia.radio-presets":{source:"iana",extensions:["rpss"]},"application/vnd.novadigm.edm":{source:"iana",extensions:["edm"]},"application/vnd.novadigm.edx":{source:"iana",extensions:["edx"]},"application/vnd.novadigm.ext":{source:"iana",extensions:["ext"]},"application/vnd.ntt-local.content-share":{source:"iana"},"application/vnd.ntt-local.file-transfer":{source:"iana"},"application/vnd.ntt-local.ogw_remote-access":{source:"iana"},"application/vnd.ntt-local.sip-ta_remote":{source:"iana"},"application/vnd.ntt-local.sip-ta_tcp_stream":{source:"iana"},"application/vnd.oasis.opendocument.chart":{source:"iana",extensions:["odc"]},"application/vnd.oasis.opendocument.chart-template":{source:"iana",extensions:["otc"]},"application/vnd.oasis.opendocument.database":{source:"iana",extensions:["odb"]},"application/vnd.oasis.opendocument.formula":{source:"iana",extensions:["odf"]},"application/vnd.oasis.opendocument.formula-template":{source:"iana",extensions:["odft"]},"application/vnd.oasis.opendocument.graphics":{source:"iana",compressible:!1,extensions:["odg"]},"application/vnd.oasis.opendocument.graphics-template":{source:"iana",extensions:["otg"]},"application/vnd.oasis.opendocument.image":{source:"iana",extensions:["odi"]},"application/vnd.oasis.opendocument.image-template":{source:"iana",extensions:["oti"]},"application/vnd.oasis.opendocument.presentation":{source:"iana",compressible:!1,extensions:["odp"]},"application/vnd.oasis.opendocument.presentation-template":{source:"iana",extensions:["otp"]},"application/vnd.oasis.opendocument.spreadsheet":{source:"iana",compressible:!1,extensions:["ods"]},"application/vnd.oasis.opendocument.spreadsheet-template":{source:"iana",extensions:["ots"]},"application/vnd.oasis.opendocument.text":{source:"iana",compressible:!1,extensions:["odt"]},"application/vnd.oasis.opendocument.text-master":{source:"iana",extensions:["odm"]},"application/vnd.oasis.opendocument.text-template":{source:"iana",extensions:["ott"]},"application/vnd.oasis.opendocument.text-web":{source:"iana",extensions:["oth"]},"application/vnd.obn":{source:"iana"},"application/vnd.ocf+cbor":{source:"iana"},"application/vnd.oci.image.manifest.v1+json":{source:"iana",compressible:!0},"application/vnd.oftn.l10n+json":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessdownload+xml":{source:"iana",compressible:!0},"application/vnd.oipf.contentaccessstreaming+xml":{source:"iana",compressible:!0},"application/vnd.oipf.cspg-hexbinary":{source:"iana"},"application/vnd.oipf.dae.svg+xml":{source:"iana",compressible:!0},"application/vnd.oipf.dae.xhtml+xml":{source:"iana",compressible:!0},"application/vnd.oipf.mippvcontrolmessage+xml":{source:"iana",compressible:!0},"application/vnd.oipf.pae.gem":{source:"iana"},"application/vnd.oipf.spdiscovery+xml":{source:"iana",compressible:!0},"application/vnd.oipf.spdlist+xml":{source:"iana",compressible:!0},"application/vnd.oipf.ueprofile+xml":{source:"iana",compressible:!0},"application/vnd.oipf.userprofile+xml":{source:"iana",compressible:!0},"application/vnd.olpc-sugar":{source:"iana",extensions:["xo"]},"application/vnd.oma-scws-config":{source:"iana"},"application/vnd.oma-scws-http-request":{source:"iana"},"application/vnd.oma-scws-http-response":{source:"iana"},"application/vnd.oma.bcast.associated-procedure-parameter+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.drm-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.imd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.ltkm":{source:"iana"},"application/vnd.oma.bcast.notification+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.provisioningtrigger":{source:"iana"},"application/vnd.oma.bcast.sgboot":{source:"iana"},"application/vnd.oma.bcast.sgdd+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sgdu":{source:"iana"},"application/vnd.oma.bcast.simple-symbol-container":{source:"iana"},"application/vnd.oma.bcast.smartcard-trigger+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.sprov+xml":{source:"iana",compressible:!0},"application/vnd.oma.bcast.stkm":{source:"iana"},"application/vnd.oma.cab-address-book+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-feature-handler+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-pcc+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-subs-invite+xml":{source:"iana",compressible:!0},"application/vnd.oma.cab-user-prefs+xml":{source:"iana",compressible:!0},"application/vnd.oma.dcd":{source:"iana"},"application/vnd.oma.dcdc":{source:"iana"},"application/vnd.oma.dd2+xml":{source:"iana",compressible:!0,extensions:["dd2"]},"application/vnd.oma.drm.risd+xml":{source:"iana",compressible:!0},"application/vnd.oma.group-usage-list+xml":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+cbor":{source:"iana"},"application/vnd.oma.lwm2m+json":{source:"iana",compressible:!0},"application/vnd.oma.lwm2m+tlv":{source:"iana"},"application/vnd.oma.pal+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.detailed-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.final-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.groups+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.invocation-descriptor+xml":{source:"iana",compressible:!0},"application/vnd.oma.poc.optimized-progress-report+xml":{source:"iana",compressible:!0},"application/vnd.oma.push":{source:"iana"},"application/vnd.oma.scidm.messages+xml":{source:"iana",compressible:!0},"application/vnd.oma.xcap-directory+xml":{source:"iana",compressible:!0},"application/vnd.omads-email+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-file+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omads-folder+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.omaloc-supl-init":{source:"iana"},"application/vnd.onepager":{source:"iana"},"application/vnd.onepagertamp":{source:"iana"},"application/vnd.onepagertamx":{source:"iana"},"application/vnd.onepagertat":{source:"iana"},"application/vnd.onepagertatp":{source:"iana"},"application/vnd.onepagertatx":{source:"iana"},"application/vnd.openblox.game+xml":{source:"iana",compressible:!0,extensions:["obgx"]},"application/vnd.openblox.game-binary":{source:"iana"},"application/vnd.openeye.oeb":{source:"iana"},"application/vnd.openofficeorg.extension":{source:"apache",extensions:["oxt"]},"application/vnd.openstreetmap.data+xml":{source:"iana",compressible:!0,extensions:["osm"]},"application/vnd.opentimestamps.ots":{source:"iana"},"application/vnd.openxmlformats-officedocument.custom-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.customxmlproperties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawing+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chart+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramcolors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramdata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramlayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.drawingml.diagramstyle+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.extended-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.commentauthors+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.handoutmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesmaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.notesslide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presentation":{source:"iana",compressible:!1,extensions:["pptx"]},"application/vnd.openxmlformats-officedocument.presentationml.presentation.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.presprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slide":{source:"iana",extensions:["sldx"]},"application/vnd.openxmlformats-officedocument.presentationml.slide+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidelayout+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slidemaster+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideshow":{source:"iana",extensions:["ppsx"]},"application/vnd.openxmlformats-officedocument.presentationml.slideshow.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.slideupdateinfo+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tablestyles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.tags+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.template":{source:"iana",extensions:["potx"]},"application/vnd.openxmlformats-officedocument.presentationml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.presentationml.viewprops+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.calcchain+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.externallink+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcachedefinition+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivotcacherecords+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.pivottable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.querytable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionheaders+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.revisionlog+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedstrings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{source:"iana",compressible:!1,extensions:["xlsx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetmetadata+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.tablesinglecells+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.template":{source:"iana",extensions:["xltx"]},"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.usernames+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.volatiledependencies+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.theme+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.themeoverride+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.vmldrawing":{source:"iana"},"application/vnd.openxmlformats-officedocument.wordprocessingml.comments+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{source:"iana",compressible:!1,extensions:["docx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.glossary+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.endnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.fonttable+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footer+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.footnotes+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.settings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.template":{source:"iana",extensions:["dotx"]},"application/vnd.openxmlformats-officedocument.wordprocessingml.template.main+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-officedocument.wordprocessingml.websettings+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.core-properties+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.digital-signature-xmlsignature+xml":{source:"iana",compressible:!0},"application/vnd.openxmlformats-package.relationships+xml":{source:"iana",compressible:!0},"application/vnd.oracle.resource+json":{source:"iana",compressible:!0},"application/vnd.orange.indata":{source:"iana"},"application/vnd.osa.netdeploy":{source:"iana"},"application/vnd.osgeo.mapguide.package":{source:"iana",extensions:["mgp"]},"application/vnd.osgi.bundle":{source:"iana"},"application/vnd.osgi.dp":{source:"iana",extensions:["dp"]},"application/vnd.osgi.subsystem":{source:"iana",extensions:["esa"]},"application/vnd.otps.ct-kip+xml":{source:"iana",compressible:!0},"application/vnd.oxli.countgraph":{source:"iana"},"application/vnd.pagerduty+json":{source:"iana",compressible:!0},"application/vnd.palm":{source:"iana",extensions:["pdb","pqa","oprc"]},"application/vnd.panoply":{source:"iana"},"application/vnd.paos.xml":{source:"iana"},"application/vnd.patentdive":{source:"iana"},"application/vnd.patientecommsdoc":{source:"iana"},"application/vnd.pawaafile":{source:"iana",extensions:["paw"]},"application/vnd.pcos":{source:"iana"},"application/vnd.pg.format":{source:"iana",extensions:["str"]},"application/vnd.pg.osasli":{source:"iana",extensions:["ei6"]},"application/vnd.piaccess.application-licence":{source:"iana"},"application/vnd.picsel":{source:"iana",extensions:["efif"]},"application/vnd.pmi.widget":{source:"iana",extensions:["wg"]},"application/vnd.poc.group-advertisement+xml":{source:"iana",compressible:!0},"application/vnd.pocketlearn":{source:"iana",extensions:["plf"]},"application/vnd.powerbuilder6":{source:"iana",extensions:["pbd"]},"application/vnd.powerbuilder6-s":{source:"iana"},"application/vnd.powerbuilder7":{source:"iana"},"application/vnd.powerbuilder7-s":{source:"iana"},"application/vnd.powerbuilder75":{source:"iana"},"application/vnd.powerbuilder75-s":{source:"iana"},"application/vnd.preminet":{source:"iana"},"application/vnd.previewsystems.box":{source:"iana",extensions:["box"]},"application/vnd.proteus.magazine":{source:"iana",extensions:["mgz"]},"application/vnd.psfs":{source:"iana"},"application/vnd.publishare-delta-tree":{source:"iana",extensions:["qps"]},"application/vnd.pvi.ptid1":{source:"iana",extensions:["ptid"]},"application/vnd.pwg-multiplexed":{source:"iana"},"application/vnd.pwg-xhtml-print+xml":{source:"iana",compressible:!0},"application/vnd.qualcomm.brew-app-res":{source:"iana"},"application/vnd.quarantainenet":{source:"iana"},"application/vnd.quark.quarkxpress":{source:"iana",extensions:["qxd","qxt","qwd","qwt","qxl","qxb"]},"application/vnd.quobject-quoxdocument":{source:"iana"},"application/vnd.radisys.moml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-conn+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-audit-stream+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-conf+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-base+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-detect+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-fax-sendrecv+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-group+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-speech+xml":{source:"iana",compressible:!0},"application/vnd.radisys.msml-dialog-transform+xml":{source:"iana",compressible:!0},"application/vnd.rainstor.data":{source:"iana"},"application/vnd.rapid":{source:"iana"},"application/vnd.rar":{source:"iana",extensions:["rar"]},"application/vnd.realvnc.bed":{source:"iana",extensions:["bed"]},"application/vnd.recordare.musicxml":{source:"iana",extensions:["mxl"]},"application/vnd.recordare.musicxml+xml":{source:"iana",compressible:!0,extensions:["musicxml"]},"application/vnd.renlearn.rlprint":{source:"iana"},"application/vnd.resilient.logic":{source:"iana"},"application/vnd.restful+json":{source:"iana",compressible:!0},"application/vnd.rig.cryptonote":{source:"iana",extensions:["cryptonote"]},"application/vnd.rim.cod":{source:"apache",extensions:["cod"]},"application/vnd.rn-realmedia":{source:"apache",extensions:["rm"]},"application/vnd.rn-realmedia-vbr":{source:"apache",extensions:["rmvb"]},"application/vnd.route66.link66+xml":{source:"iana",compressible:!0,extensions:["link66"]},"application/vnd.rs-274x":{source:"iana"},"application/vnd.ruckus.download":{source:"iana"},"application/vnd.s3sms":{source:"iana"},"application/vnd.sailingtracker.track":{source:"iana",extensions:["st"]},"application/vnd.sar":{source:"iana"},"application/vnd.sbm.cid":{source:"iana"},"application/vnd.sbm.mid2":{source:"iana"},"application/vnd.scribus":{source:"iana"},"application/vnd.sealed.3df":{source:"iana"},"application/vnd.sealed.csf":{source:"iana"},"application/vnd.sealed.doc":{source:"iana"},"application/vnd.sealed.eml":{source:"iana"},"application/vnd.sealed.mht":{source:"iana"},"application/vnd.sealed.net":{source:"iana"},"application/vnd.sealed.ppt":{source:"iana"},"application/vnd.sealed.tiff":{source:"iana"},"application/vnd.sealed.xls":{source:"iana"},"application/vnd.sealedmedia.softseal.html":{source:"iana"},"application/vnd.sealedmedia.softseal.pdf":{source:"iana"},"application/vnd.seemail":{source:"iana",extensions:["see"]},"application/vnd.seis+json":{source:"iana",compressible:!0},"application/vnd.sema":{source:"iana",extensions:["sema"]},"application/vnd.semd":{source:"iana",extensions:["semd"]},"application/vnd.semf":{source:"iana",extensions:["semf"]},"application/vnd.shade-save-file":{source:"iana"},"application/vnd.shana.informed.formdata":{source:"iana",extensions:["ifm"]},"application/vnd.shana.informed.formtemplate":{source:"iana",extensions:["itp"]},"application/vnd.shana.informed.interchange":{source:"iana",extensions:["iif"]},"application/vnd.shana.informed.package":{source:"iana",extensions:["ipk"]},"application/vnd.shootproof+json":{source:"iana",compressible:!0},"application/vnd.shopkick+json":{source:"iana",compressible:!0},"application/vnd.shp":{source:"iana"},"application/vnd.shx":{source:"iana"},"application/vnd.sigrok.session":{source:"iana"},"application/vnd.simtech-mindmapper":{source:"iana",extensions:["twd","twds"]},"application/vnd.siren+json":{source:"iana",compressible:!0},"application/vnd.smaf":{source:"iana",extensions:["mmf"]},"application/vnd.smart.notebook":{source:"iana"},"application/vnd.smart.teacher":{source:"iana",extensions:["teacher"]},"application/vnd.snesdev-page-table":{source:"iana"},"application/vnd.software602.filler.form+xml":{source:"iana",compressible:!0,extensions:["fo"]},"application/vnd.software602.filler.form-xml-zip":{source:"iana"},"application/vnd.solent.sdkm+xml":{source:"iana",compressible:!0,extensions:["sdkm","sdkd"]},"application/vnd.spotfire.dxp":{source:"iana",extensions:["dxp"]},"application/vnd.spotfire.sfs":{source:"iana",extensions:["sfs"]},"application/vnd.sqlite3":{source:"iana"},"application/vnd.sss-cod":{source:"iana"},"application/vnd.sss-dtf":{source:"iana"},"application/vnd.sss-ntf":{source:"iana"},"application/vnd.stardivision.calc":{source:"apache",extensions:["sdc"]},"application/vnd.stardivision.draw":{source:"apache",extensions:["sda"]},"application/vnd.stardivision.impress":{source:"apache",extensions:["sdd"]},"application/vnd.stardivision.math":{source:"apache",extensions:["smf"]},"application/vnd.stardivision.writer":{source:"apache",extensions:["sdw","vor"]},"application/vnd.stardivision.writer-global":{source:"apache",extensions:["sgl"]},"application/vnd.stepmania.package":{source:"iana",extensions:["smzip"]},"application/vnd.stepmania.stepchart":{source:"iana",extensions:["sm"]},"application/vnd.street-stream":{source:"iana"},"application/vnd.sun.wadl+xml":{source:"iana",compressible:!0,extensions:["wadl"]},"application/vnd.sun.xml.calc":{source:"apache",extensions:["sxc"]},"application/vnd.sun.xml.calc.template":{source:"apache",extensions:["stc"]},"application/vnd.sun.xml.draw":{source:"apache",extensions:["sxd"]},"application/vnd.sun.xml.draw.template":{source:"apache",extensions:["std"]},"application/vnd.sun.xml.impress":{source:"apache",extensions:["sxi"]},"application/vnd.sun.xml.impress.template":{source:"apache",extensions:["sti"]},"application/vnd.sun.xml.math":{source:"apache",extensions:["sxm"]},"application/vnd.sun.xml.writer":{source:"apache",extensions:["sxw"]},"application/vnd.sun.xml.writer.global":{source:"apache",extensions:["sxg"]},"application/vnd.sun.xml.writer.template":{source:"apache",extensions:["stw"]},"application/vnd.sus-calendar":{source:"iana",extensions:["sus","susp"]},"application/vnd.svd":{source:"iana",extensions:["svd"]},"application/vnd.swiftview-ics":{source:"iana"},"application/vnd.sycle+xml":{source:"iana",compressible:!0},"application/vnd.syft+json":{source:"iana",compressible:!0},"application/vnd.symbian.install":{source:"apache",extensions:["sis","sisx"]},"application/vnd.syncml+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xsm"]},"application/vnd.syncml.dm+wbxml":{source:"iana",charset:"UTF-8",extensions:["bdm"]},"application/vnd.syncml.dm+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["xdm"]},"application/vnd.syncml.dm.notification":{source:"iana"},"application/vnd.syncml.dmddf+wbxml":{source:"iana"},"application/vnd.syncml.dmddf+xml":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["ddf"]},"application/vnd.syncml.dmtnds+wbxml":{source:"iana"},"application/vnd.syncml.dmtnds+xml":{source:"iana",charset:"UTF-8",compressible:!0},"application/vnd.syncml.ds.notification":{source:"iana"},"application/vnd.tableschema+json":{source:"iana",compressible:!0},"application/vnd.tao.intent-module-archive":{source:"iana",extensions:["tao"]},"application/vnd.tcpdump.pcap":{source:"iana",extensions:["pcap","cap","dmp"]},"application/vnd.think-cell.ppttc+json":{source:"iana",compressible:!0},"application/vnd.tmd.mediaflex.api+xml":{source:"iana",compressible:!0},"application/vnd.tml":{source:"iana"},"application/vnd.tmobile-livetv":{source:"iana",extensions:["tmo"]},"application/vnd.tri.onesource":{source:"iana"},"application/vnd.trid.tpt":{source:"iana",extensions:["tpt"]},"application/vnd.triscape.mxs":{source:"iana",extensions:["mxs"]},"application/vnd.trueapp":{source:"iana",extensions:["tra"]},"application/vnd.truedoc":{source:"iana"},"application/vnd.ubisoft.webplayer":{source:"iana"},"application/vnd.ufdl":{source:"iana",extensions:["ufd","ufdl"]},"application/vnd.uiq.theme":{source:"iana",extensions:["utz"]},"application/vnd.umajin":{source:"iana",extensions:["umj"]},"application/vnd.unity":{source:"iana",extensions:["unityweb"]},"application/vnd.uoml+xml":{source:"iana",compressible:!0,extensions:["uoml"]},"application/vnd.uplanet.alert":{source:"iana"},"application/vnd.uplanet.alert-wbxml":{source:"iana"},"application/vnd.uplanet.bearer-choice":{source:"iana"},"application/vnd.uplanet.bearer-choice-wbxml":{source:"iana"},"application/vnd.uplanet.cacheop":{source:"iana"},"application/vnd.uplanet.cacheop-wbxml":{source:"iana"},"application/vnd.uplanet.channel":{source:"iana"},"application/vnd.uplanet.channel-wbxml":{source:"iana"},"application/vnd.uplanet.list":{source:"iana"},"application/vnd.uplanet.list-wbxml":{source:"iana"},"application/vnd.uplanet.listcmd":{source:"iana"},"application/vnd.uplanet.listcmd-wbxml":{source:"iana"},"application/vnd.uplanet.signal":{source:"iana"},"application/vnd.uri-map":{source:"iana"},"application/vnd.valve.source.material":{source:"iana"},"application/vnd.vcx":{source:"iana",extensions:["vcx"]},"application/vnd.vd-study":{source:"iana"},"application/vnd.vectorworks":{source:"iana"},"application/vnd.vel+json":{source:"iana",compressible:!0},"application/vnd.verimatrix.vcas":{source:"iana"},"application/vnd.veritone.aion+json":{source:"iana",compressible:!0},"application/vnd.veryant.thin":{source:"iana"},"application/vnd.ves.encrypted":{source:"iana"},"application/vnd.vidsoft.vidconference":{source:"iana"},"application/vnd.visio":{source:"iana",extensions:["vsd","vst","vss","vsw"]},"application/vnd.visionary":{source:"iana",extensions:["vis"]},"application/vnd.vividence.scriptfile":{source:"iana"},"application/vnd.vsf":{source:"iana",extensions:["vsf"]},"application/vnd.wap.sic":{source:"iana"},"application/vnd.wap.slc":{source:"iana"},"application/vnd.wap.wbxml":{source:"iana",charset:"UTF-8",extensions:["wbxml"]},"application/vnd.wap.wmlc":{source:"iana",extensions:["wmlc"]},"application/vnd.wap.wmlscriptc":{source:"iana",extensions:["wmlsc"]},"application/vnd.webturbo":{source:"iana",extensions:["wtb"]},"application/vnd.wfa.dpp":{source:"iana"},"application/vnd.wfa.p2p":{source:"iana"},"application/vnd.wfa.wsc":{source:"iana"},"application/vnd.windows.devicepairing":{source:"iana"},"application/vnd.wmc":{source:"iana"},"application/vnd.wmf.bootstrap":{source:"iana"},"application/vnd.wolfram.mathematica":{source:"iana"},"application/vnd.wolfram.mathematica.package":{source:"iana"},"application/vnd.wolfram.player":{source:"iana",extensions:["nbp"]},"application/vnd.wordperfect":{source:"iana",extensions:["wpd"]},"application/vnd.wqd":{source:"iana",extensions:["wqd"]},"application/vnd.wrq-hp3000-labelled":{source:"iana"},"application/vnd.wt.stf":{source:"iana",extensions:["stf"]},"application/vnd.wv.csp+wbxml":{source:"iana"},"application/vnd.wv.csp+xml":{source:"iana",compressible:!0},"application/vnd.wv.ssp+xml":{source:"iana",compressible:!0},"application/vnd.xacml+json":{source:"iana",compressible:!0},"application/vnd.xara":{source:"iana",extensions:["xar"]},"application/vnd.xfdl":{source:"iana",extensions:["xfdl"]},"application/vnd.xfdl.webform":{source:"iana"},"application/vnd.xmi+xml":{source:"iana",compressible:!0},"application/vnd.xmpie.cpkg":{source:"iana"},"application/vnd.xmpie.dpkg":{source:"iana"},"application/vnd.xmpie.plan":{source:"iana"},"application/vnd.xmpie.ppkg":{source:"iana"},"application/vnd.xmpie.xlim":{source:"iana"},"application/vnd.yamaha.hv-dic":{source:"iana",extensions:["hvd"]},"application/vnd.yamaha.hv-script":{source:"iana",extensions:["hvs"]},"application/vnd.yamaha.hv-voice":{source:"iana",extensions:["hvp"]},"application/vnd.yamaha.openscoreformat":{source:"iana",extensions:["osf"]},"application/vnd.yamaha.openscoreformat.osfpvg+xml":{source:"iana",compressible:!0,extensions:["osfpvg"]},"application/vnd.yamaha.remote-setup":{source:"iana"},"application/vnd.yamaha.smaf-audio":{source:"iana",extensions:["saf"]},"application/vnd.yamaha.smaf-phrase":{source:"iana",extensions:["spf"]},"application/vnd.yamaha.through-ngn":{source:"iana"},"application/vnd.yamaha.tunnel-udpencap":{source:"iana"},"application/vnd.yaoweme":{source:"iana"},"application/vnd.yellowriver-custom-menu":{source:"iana",extensions:["cmp"]},"application/vnd.youtube.yt":{source:"iana"},"application/vnd.zul":{source:"iana",extensions:["zir","zirz"]},"application/vnd.zzazz.deck+xml":{source:"iana",compressible:!0,extensions:["zaz"]},"application/voicexml+xml":{source:"iana",compressible:!0,extensions:["vxml"]},"application/voucher-cms+json":{source:"iana",compressible:!0},"application/vq-rtcpxr":{source:"iana"},"application/wasm":{source:"iana",compressible:!0,extensions:["wasm"]},"application/watcherinfo+xml":{source:"iana",compressible:!0,extensions:["wif"]},"application/webpush-options+json":{source:"iana",compressible:!0},"application/whoispp-query":{source:"iana"},"application/whoispp-response":{source:"iana"},"application/widget":{source:"iana",extensions:["wgt"]},"application/winhlp":{source:"apache",extensions:["hlp"]},"application/wita":{source:"iana"},"application/wordperfect5.1":{source:"iana"},"application/wsdl+xml":{source:"iana",compressible:!0,extensions:["wsdl"]},"application/wspolicy+xml":{source:"iana",compressible:!0,extensions:["wspolicy"]},"application/x-7z-compressed":{source:"apache",compressible:!1,extensions:["7z"]},"application/x-abiword":{source:"apache",extensions:["abw"]},"application/x-ace-compressed":{source:"apache",extensions:["ace"]},"application/x-amf":{source:"apache"},"application/x-apple-diskimage":{source:"apache",extensions:["dmg"]},"application/x-arj":{compressible:!1,extensions:["arj"]},"application/x-authorware-bin":{source:"apache",extensions:["aab","x32","u32","vox"]},"application/x-authorware-map":{source:"apache",extensions:["aam"]},"application/x-authorware-seg":{source:"apache",extensions:["aas"]},"application/x-bcpio":{source:"apache",extensions:["bcpio"]},"application/x-bdoc":{compressible:!1,extensions:["bdoc"]},"application/x-bittorrent":{source:"apache",extensions:["torrent"]},"application/x-blorb":{source:"apache",extensions:["blb","blorb"]},"application/x-bzip":{source:"apache",compressible:!1,extensions:["bz"]},"application/x-bzip2":{source:"apache",compressible:!1,extensions:["bz2","boz"]},"application/x-cbr":{source:"apache",extensions:["cbr","cba","cbt","cbz","cb7"]},"application/x-cdlink":{source:"apache",extensions:["vcd"]},"application/x-cfs-compressed":{source:"apache",extensions:["cfs"]},"application/x-chat":{source:"apache",extensions:["chat"]},"application/x-chess-pgn":{source:"apache",extensions:["pgn"]},"application/x-chrome-extension":{extensions:["crx"]},"application/x-cocoa":{source:"nginx",extensions:["cco"]},"application/x-compress":{source:"apache"},"application/x-conference":{source:"apache",extensions:["nsc"]},"application/x-cpio":{source:"apache",extensions:["cpio"]},"application/x-csh":{source:"apache",extensions:["csh"]},"application/x-deb":{compressible:!1},"application/x-debian-package":{source:"apache",extensions:["deb","udeb"]},"application/x-dgc-compressed":{source:"apache",extensions:["dgc"]},"application/x-director":{source:"apache",extensions:["dir","dcr","dxr","cst","cct","cxt","w3d","fgd","swa"]},"application/x-doom":{source:"apache",extensions:["wad"]},"application/x-dtbncx+xml":{source:"apache",compressible:!0,extensions:["ncx"]},"application/x-dtbook+xml":{source:"apache",compressible:!0,extensions:["dtb"]},"application/x-dtbresource+xml":{source:"apache",compressible:!0,extensions:["res"]},"application/x-dvi":{source:"apache",compressible:!1,extensions:["dvi"]},"application/x-envoy":{source:"apache",extensions:["evy"]},"application/x-eva":{source:"apache",extensions:["eva"]},"application/x-font-bdf":{source:"apache",extensions:["bdf"]},"application/x-font-dos":{source:"apache"},"application/x-font-framemaker":{source:"apache"},"application/x-font-ghostscript":{source:"apache",extensions:["gsf"]},"application/x-font-libgrx":{source:"apache"},"application/x-font-linux-psf":{source:"apache",extensions:["psf"]},"application/x-font-pcf":{source:"apache",extensions:["pcf"]},"application/x-font-snf":{source:"apache",extensions:["snf"]},"application/x-font-speedo":{source:"apache"},"application/x-font-sunos-news":{source:"apache"},"application/x-font-type1":{source:"apache",extensions:["pfa","pfb","pfm","afm"]},"application/x-font-vfont":{source:"apache"},"application/x-freearc":{source:"apache",extensions:["arc"]},"application/x-futuresplash":{source:"apache",extensions:["spl"]},"application/x-gca-compressed":{source:"apache",extensions:["gca"]},"application/x-glulx":{source:"apache",extensions:["ulx"]},"application/x-gnumeric":{source:"apache",extensions:["gnumeric"]},"application/x-gramps-xml":{source:"apache",extensions:["gramps"]},"application/x-gtar":{source:"apache",extensions:["gtar"]},"application/x-gzip":{source:"apache"},"application/x-hdf":{source:"apache",extensions:["hdf"]},"application/x-httpd-php":{compressible:!0,extensions:["php"]},"application/x-install-instructions":{source:"apache",extensions:["install"]},"application/x-iso9660-image":{source:"apache",extensions:["iso"]},"application/x-iwork-keynote-sffkey":{extensions:["key"]},"application/x-iwork-numbers-sffnumbers":{extensions:["numbers"]},"application/x-iwork-pages-sffpages":{extensions:["pages"]},"application/x-java-archive-diff":{source:"nginx",extensions:["jardiff"]},"application/x-java-jnlp-file":{source:"apache",compressible:!1,extensions:["jnlp"]},"application/x-javascript":{compressible:!0},"application/x-keepass2":{extensions:["kdbx"]},"application/x-latex":{source:"apache",compressible:!1,extensions:["latex"]},"application/x-lua-bytecode":{extensions:["luac"]},"application/x-lzh-compressed":{source:"apache",extensions:["lzh","lha"]},"application/x-makeself":{source:"nginx",extensions:["run"]},"application/x-mie":{source:"apache",extensions:["mie"]},"application/x-mobipocket-ebook":{source:"apache",extensions:["prc","mobi"]},"application/x-mpegurl":{compressible:!1},"application/x-ms-application":{source:"apache",extensions:["application"]},"application/x-ms-shortcut":{source:"apache",extensions:["lnk"]},"application/x-ms-wmd":{source:"apache",extensions:["wmd"]},"application/x-ms-wmz":{source:"apache",extensions:["wmz"]},"application/x-ms-xbap":{source:"apache",extensions:["xbap"]},"application/x-msaccess":{source:"apache",extensions:["mdb"]},"application/x-msbinder":{source:"apache",extensions:["obd"]},"application/x-mscardfile":{source:"apache",extensions:["crd"]},"application/x-msclip":{source:"apache",extensions:["clp"]},"application/x-msdos-program":{extensions:["exe"]},"application/x-msdownload":{source:"apache",extensions:["exe","dll","com","bat","msi"]},"application/x-msmediaview":{source:"apache",extensions:["mvb","m13","m14"]},"application/x-msmetafile":{source:"apache",extensions:["wmf","wmz","emf","emz"]},"application/x-msmoney":{source:"apache",extensions:["mny"]},"application/x-mspublisher":{source:"apache",extensions:["pub"]},"application/x-msschedule":{source:"apache",extensions:["scd"]},"application/x-msterminal":{source:"apache",extensions:["trm"]},"application/x-mswrite":{source:"apache",extensions:["wri"]},"application/x-netcdf":{source:"apache",extensions:["nc","cdf"]},"application/x-ns-proxy-autoconfig":{compressible:!0,extensions:["pac"]},"application/x-nzb":{source:"apache",extensions:["nzb"]},"application/x-perl":{source:"nginx",extensions:["pl","pm"]},"application/x-pilot":{source:"nginx",extensions:["prc","pdb"]},"application/x-pkcs12":{source:"apache",compressible:!1,extensions:["p12","pfx"]},"application/x-pkcs7-certificates":{source:"apache",extensions:["p7b","spc"]},"application/x-pkcs7-certreqresp":{source:"apache",extensions:["p7r"]},"application/x-pki-message":{source:"iana"},"application/x-rar-compressed":{source:"apache",compressible:!1,extensions:["rar"]},"application/x-redhat-package-manager":{source:"nginx",extensions:["rpm"]},"application/x-research-info-systems":{source:"apache",extensions:["ris"]},"application/x-sea":{source:"nginx",extensions:["sea"]},"application/x-sh":{source:"apache",compressible:!0,extensions:["sh"]},"application/x-shar":{source:"apache",extensions:["shar"]},"application/x-shockwave-flash":{source:"apache",compressible:!1,extensions:["swf"]},"application/x-silverlight-app":{source:"apache",extensions:["xap"]},"application/x-sql":{source:"apache",extensions:["sql"]},"application/x-stuffit":{source:"apache",compressible:!1,extensions:["sit"]},"application/x-stuffitx":{source:"apache",extensions:["sitx"]},"application/x-subrip":{source:"apache",extensions:["srt"]},"application/x-sv4cpio":{source:"apache",extensions:["sv4cpio"]},"application/x-sv4crc":{source:"apache",extensions:["sv4crc"]},"application/x-t3vm-image":{source:"apache",extensions:["t3"]},"application/x-tads":{source:"apache",extensions:["gam"]},"application/x-tar":{source:"apache",compressible:!0,extensions:["tar"]},"application/x-tcl":{source:"apache",extensions:["tcl","tk"]},"application/x-tex":{source:"apache",extensions:["tex"]},"application/x-tex-tfm":{source:"apache",extensions:["tfm"]},"application/x-texinfo":{source:"apache",extensions:["texinfo","texi"]},"application/x-tgif":{source:"apache",extensions:["obj"]},"application/x-ustar":{source:"apache",extensions:["ustar"]},"application/x-virtualbox-hdd":{compressible:!0,extensions:["hdd"]},"application/x-virtualbox-ova":{compressible:!0,extensions:["ova"]},"application/x-virtualbox-ovf":{compressible:!0,extensions:["ovf"]},"application/x-virtualbox-vbox":{compressible:!0,extensions:["vbox"]},"application/x-virtualbox-vbox-extpack":{compressible:!1,extensions:["vbox-extpack"]},"application/x-virtualbox-vdi":{compressible:!0,extensions:["vdi"]},"application/x-virtualbox-vhd":{compressible:!0,extensions:["vhd"]},"application/x-virtualbox-vmdk":{compressible:!0,extensions:["vmdk"]},"application/x-wais-source":{source:"apache",extensions:["src"]},"application/x-web-app-manifest+json":{compressible:!0,extensions:["webapp"]},"application/x-www-form-urlencoded":{source:"iana",compressible:!0},"application/x-x509-ca-cert":{source:"iana",extensions:["der","crt","pem"]},"application/x-x509-ca-ra-cert":{source:"iana"},"application/x-x509-next-ca-cert":{source:"iana"},"application/x-xfig":{source:"apache",extensions:["fig"]},"application/x-xliff+xml":{source:"apache",compressible:!0,extensions:["xlf"]},"application/x-xpinstall":{source:"apache",compressible:!1,extensions:["xpi"]},"application/x-xz":{source:"apache",extensions:["xz"]},"application/x-zmachine":{source:"apache",extensions:["z1","z2","z3","z4","z5","z6","z7","z8"]},"application/x400-bp":{source:"iana"},"application/xacml+xml":{source:"iana",compressible:!0},"application/xaml+xml":{source:"apache",compressible:!0,extensions:["xaml"]},"application/xcap-att+xml":{source:"iana",compressible:!0,extensions:["xav"]},"application/xcap-caps+xml":{source:"iana",compressible:!0,extensions:["xca"]},"application/xcap-diff+xml":{source:"iana",compressible:!0,extensions:["xdf"]},"application/xcap-el+xml":{source:"iana",compressible:!0,extensions:["xel"]},"application/xcap-error+xml":{source:"iana",compressible:!0},"application/xcap-ns+xml":{source:"iana",compressible:!0,extensions:["xns"]},"application/xcon-conference-info+xml":{source:"iana",compressible:!0},"application/xcon-conference-info-diff+xml":{source:"iana",compressible:!0},"application/xenc+xml":{source:"iana",compressible:!0,extensions:["xenc"]},"application/xhtml+xml":{source:"iana",compressible:!0,extensions:["xhtml","xht"]},"application/xhtml-voice+xml":{source:"apache",compressible:!0},"application/xliff+xml":{source:"iana",compressible:!0,extensions:["xlf"]},"application/xml":{source:"iana",compressible:!0,extensions:["xml","xsl","xsd","rng"]},"application/xml-dtd":{source:"iana",compressible:!0,extensions:["dtd"]},"application/xml-external-parsed-entity":{source:"iana"},"application/xml-patch+xml":{source:"iana",compressible:!0},"application/xmpp+xml":{source:"iana",compressible:!0},"application/xop+xml":{source:"iana",compressible:!0,extensions:["xop"]},"application/xproc+xml":{source:"apache",compressible:!0,extensions:["xpl"]},"application/xslt+xml":{source:"iana",compressible:!0,extensions:["xsl","xslt"]},"application/xspf+xml":{source:"apache",compressible:!0,extensions:["xspf"]},"application/xv+xml":{source:"iana",compressible:!0,extensions:["mxml","xhvml","xvml","xvm"]},"application/yang":{source:"iana",extensions:["yang"]},"application/yang-data+json":{source:"iana",compressible:!0},"application/yang-data+xml":{source:"iana",compressible:!0},"application/yang-patch+json":{source:"iana",compressible:!0},"application/yang-patch+xml":{source:"iana",compressible:!0},"application/yin+xml":{source:"iana",compressible:!0,extensions:["yin"]},"application/zip":{source:"iana",compressible:!1,extensions:["zip"]},"application/zlib":{source:"iana"},"application/zstd":{source:"iana"},"audio/1d-interleaved-parityfec":{source:"iana"},"audio/32kadpcm":{source:"iana"},"audio/3gpp":{source:"iana",compressible:!1,extensions:["3gpp"]},"audio/3gpp2":{source:"iana"},"audio/aac":{source:"iana"},"audio/ac3":{source:"iana"},"audio/adpcm":{source:"apache",extensions:["adp"]},"audio/amr":{source:"iana",extensions:["amr"]},"audio/amr-wb":{source:"iana"},"audio/amr-wb+":{source:"iana"},"audio/aptx":{source:"iana"},"audio/asc":{source:"iana"},"audio/atrac-advanced-lossless":{source:"iana"},"audio/atrac-x":{source:"iana"},"audio/atrac3":{source:"iana"},"audio/basic":{source:"iana",compressible:!1,extensions:["au","snd"]},"audio/bv16":{source:"iana"},"audio/bv32":{source:"iana"},"audio/clearmode":{source:"iana"},"audio/cn":{source:"iana"},"audio/dat12":{source:"iana"},"audio/dls":{source:"iana"},"audio/dsr-es201108":{source:"iana"},"audio/dsr-es202050":{source:"iana"},"audio/dsr-es202211":{source:"iana"},"audio/dsr-es202212":{source:"iana"},"audio/dv":{source:"iana"},"audio/dvi4":{source:"iana"},"audio/eac3":{source:"iana"},"audio/encaprtp":{source:"iana"},"audio/evrc":{source:"iana"},"audio/evrc-qcp":{source:"iana"},"audio/evrc0":{source:"iana"},"audio/evrc1":{source:"iana"},"audio/evrcb":{source:"iana"},"audio/evrcb0":{source:"iana"},"audio/evrcb1":{source:"iana"},"audio/evrcnw":{source:"iana"},"audio/evrcnw0":{source:"iana"},"audio/evrcnw1":{source:"iana"},"audio/evrcwb":{source:"iana"},"audio/evrcwb0":{source:"iana"},"audio/evrcwb1":{source:"iana"},"audio/evs":{source:"iana"},"audio/flexfec":{source:"iana"},"audio/fwdred":{source:"iana"},"audio/g711-0":{source:"iana"},"audio/g719":{source:"iana"},"audio/g722":{source:"iana"},"audio/g7221":{source:"iana"},"audio/g723":{source:"iana"},"audio/g726-16":{source:"iana"},"audio/g726-24":{source:"iana"},"audio/g726-32":{source:"iana"},"audio/g726-40":{source:"iana"},"audio/g728":{source:"iana"},"audio/g729":{source:"iana"},"audio/g7291":{source:"iana"},"audio/g729d":{source:"iana"},"audio/g729e":{source:"iana"},"audio/gsm":{source:"iana"},"audio/gsm-efr":{source:"iana"},"audio/gsm-hr-08":{source:"iana"},"audio/ilbc":{source:"iana"},"audio/ip-mr_v2.5":{source:"iana"},"audio/isac":{source:"apache"},"audio/l16":{source:"iana"},"audio/l20":{source:"iana"},"audio/l24":{source:"iana",compressible:!1},"audio/l8":{source:"iana"},"audio/lpc":{source:"iana"},"audio/melp":{source:"iana"},"audio/melp1200":{source:"iana"},"audio/melp2400":{source:"iana"},"audio/melp600":{source:"iana"},"audio/mhas":{source:"iana"},"audio/midi":{source:"apache",extensions:["mid","midi","kar","rmi"]},"audio/mobile-xmf":{source:"iana",extensions:["mxmf"]},"audio/mp3":{compressible:!1,extensions:["mp3"]},"audio/mp4":{source:"iana",compressible:!1,extensions:["m4a","mp4a"]},"audio/mp4a-latm":{source:"iana"},"audio/mpa":{source:"iana"},"audio/mpa-robust":{source:"iana"},"audio/mpeg":{source:"iana",compressible:!1,extensions:["mpga","mp2","mp2a","mp3","m2a","m3a"]},"audio/mpeg4-generic":{source:"iana"},"audio/musepack":{source:"apache"},"audio/ogg":{source:"iana",compressible:!1,extensions:["oga","ogg","spx","opus"]},"audio/opus":{source:"iana"},"audio/parityfec":{source:"iana"},"audio/pcma":{source:"iana"},"audio/pcma-wb":{source:"iana"},"audio/pcmu":{source:"iana"},"audio/pcmu-wb":{source:"iana"},"audio/prs.sid":{source:"iana"},"audio/qcelp":{source:"iana"},"audio/raptorfec":{source:"iana"},"audio/red":{source:"iana"},"audio/rtp-enc-aescm128":{source:"iana"},"audio/rtp-midi":{source:"iana"},"audio/rtploopback":{source:"iana"},"audio/rtx":{source:"iana"},"audio/s3m":{source:"apache",extensions:["s3m"]},"audio/scip":{source:"iana"},"audio/silk":{source:"apache",extensions:["sil"]},"audio/smv":{source:"iana"},"audio/smv-qcp":{source:"iana"},"audio/smv0":{source:"iana"},"audio/sofa":{source:"iana"},"audio/sp-midi":{source:"iana"},"audio/speex":{source:"iana"},"audio/t140c":{source:"iana"},"audio/t38":{source:"iana"},"audio/telephone-event":{source:"iana"},"audio/tetra_acelp":{source:"iana"},"audio/tetra_acelp_bb":{source:"iana"},"audio/tone":{source:"iana"},"audio/tsvcis":{source:"iana"},"audio/uemclip":{source:"iana"},"audio/ulpfec":{source:"iana"},"audio/usac":{source:"iana"},"audio/vdvi":{source:"iana"},"audio/vmr-wb":{source:"iana"},"audio/vnd.3gpp.iufp":{source:"iana"},"audio/vnd.4sb":{source:"iana"},"audio/vnd.audiokoz":{source:"iana"},"audio/vnd.celp":{source:"iana"},"audio/vnd.cisco.nse":{source:"iana"},"audio/vnd.cmles.radio-events":{source:"iana"},"audio/vnd.cns.anp1":{source:"iana"},"audio/vnd.cns.inf1":{source:"iana"},"audio/vnd.dece.audio":{source:"iana",extensions:["uva","uvva"]},"audio/vnd.digital-winds":{source:"iana",extensions:["eol"]},"audio/vnd.dlna.adts":{source:"iana"},"audio/vnd.dolby.heaac.1":{source:"iana"},"audio/vnd.dolby.heaac.2":{source:"iana"},"audio/vnd.dolby.mlp":{source:"iana"},"audio/vnd.dolby.mps":{source:"iana"},"audio/vnd.dolby.pl2":{source:"iana"},"audio/vnd.dolby.pl2x":{source:"iana"},"audio/vnd.dolby.pl2z":{source:"iana"},"audio/vnd.dolby.pulse.1":{source:"iana"},"audio/vnd.dra":{source:"iana",extensions:["dra"]},"audio/vnd.dts":{source:"iana",extensions:["dts"]},"audio/vnd.dts.hd":{source:"iana",extensions:["dtshd"]},"audio/vnd.dts.uhd":{source:"iana"},"audio/vnd.dvb.file":{source:"iana"},"audio/vnd.everad.plj":{source:"iana"},"audio/vnd.hns.audio":{source:"iana"},"audio/vnd.lucent.voice":{source:"iana",extensions:["lvp"]},"audio/vnd.ms-playready.media.pya":{source:"iana",extensions:["pya"]},"audio/vnd.nokia.mobile-xmf":{source:"iana"},"audio/vnd.nortel.vbk":{source:"iana"},"audio/vnd.nuera.ecelp4800":{source:"iana",extensions:["ecelp4800"]},"audio/vnd.nuera.ecelp7470":{source:"iana",extensions:["ecelp7470"]},"audio/vnd.nuera.ecelp9600":{source:"iana",extensions:["ecelp9600"]},"audio/vnd.octel.sbc":{source:"iana"},"audio/vnd.presonus.multitrack":{source:"iana"},"audio/vnd.qcelp":{source:"iana"},"audio/vnd.rhetorex.32kadpcm":{source:"iana"},"audio/vnd.rip":{source:"iana",extensions:["rip"]},"audio/vnd.rn-realaudio":{compressible:!1},"audio/vnd.sealedmedia.softseal.mpeg":{source:"iana"},"audio/vnd.vmx.cvsd":{source:"iana"},"audio/vnd.wave":{compressible:!1},"audio/vorbis":{source:"iana",compressible:!1},"audio/vorbis-config":{source:"iana"},"audio/wav":{compressible:!1,extensions:["wav"]},"audio/wave":{compressible:!1,extensions:["wav"]},"audio/webm":{source:"apache",compressible:!1,extensions:["weba"]},"audio/x-aac":{source:"apache",compressible:!1,extensions:["aac"]},"audio/x-aiff":{source:"apache",extensions:["aif","aiff","aifc"]},"audio/x-caf":{source:"apache",compressible:!1,extensions:["caf"]},"audio/x-flac":{source:"apache",extensions:["flac"]},"audio/x-m4a":{source:"nginx",extensions:["m4a"]},"audio/x-matroska":{source:"apache",extensions:["mka"]},"audio/x-mpegurl":{source:"apache",extensions:["m3u"]},"audio/x-ms-wax":{source:"apache",extensions:["wax"]},"audio/x-ms-wma":{source:"apache",extensions:["wma"]},"audio/x-pn-realaudio":{source:"apache",extensions:["ram","ra"]},"audio/x-pn-realaudio-plugin":{source:"apache",extensions:["rmp"]},"audio/x-realaudio":{source:"nginx",extensions:["ra"]},"audio/x-tta":{source:"apache"},"audio/x-wav":{source:"apache",extensions:["wav"]},"audio/xm":{source:"apache",extensions:["xm"]},"chemical/x-cdx":{source:"apache",extensions:["cdx"]},"chemical/x-cif":{source:"apache",extensions:["cif"]},"chemical/x-cmdf":{source:"apache",extensions:["cmdf"]},"chemical/x-cml":{source:"apache",extensions:["cml"]},"chemical/x-csml":{source:"apache",extensions:["csml"]},"chemical/x-pdb":{source:"apache"},"chemical/x-xyz":{source:"apache",extensions:["xyz"]},"font/collection":{source:"iana",extensions:["ttc"]},"font/otf":{source:"iana",compressible:!0,extensions:["otf"]},"font/sfnt":{source:"iana"},"font/ttf":{source:"iana",compressible:!0,extensions:["ttf"]},"font/woff":{source:"iana",extensions:["woff"]},"font/woff2":{source:"iana",extensions:["woff2"]},"image/aces":{source:"iana",extensions:["exr"]},"image/apng":{compressible:!1,extensions:["apng"]},"image/avci":{source:"iana",extensions:["avci"]},"image/avcs":{source:"iana",extensions:["avcs"]},"image/avif":{source:"iana",compressible:!1,extensions:["avif"]},"image/bmp":{source:"iana",compressible:!0,extensions:["bmp"]},"image/cgm":{source:"iana",extensions:["cgm"]},"image/dicom-rle":{source:"iana",extensions:["drle"]},"image/emf":{source:"iana",extensions:["emf"]},"image/fits":{source:"iana",extensions:["fits"]},"image/g3fax":{source:"iana",extensions:["g3"]},"image/gif":{source:"iana",compressible:!1,extensions:["gif"]},"image/heic":{source:"iana",extensions:["heic"]},"image/heic-sequence":{source:"iana",extensions:["heics"]},"image/heif":{source:"iana",extensions:["heif"]},"image/heif-sequence":{source:"iana",extensions:["heifs"]},"image/hej2k":{source:"iana",extensions:["hej2"]},"image/hsj2":{source:"iana",extensions:["hsj2"]},"image/ief":{source:"iana",extensions:["ief"]},"image/jls":{source:"iana",extensions:["jls"]},"image/jp2":{source:"iana",compressible:!1,extensions:["jp2","jpg2"]},"image/jpeg":{source:"iana",compressible:!1,extensions:["jpeg","jpg","jpe"]},"image/jph":{source:"iana",extensions:["jph"]},"image/jphc":{source:"iana",extensions:["jhc"]},"image/jpm":{source:"iana",compressible:!1,extensions:["jpm"]},"image/jpx":{source:"iana",compressible:!1,extensions:["jpx","jpf"]},"image/jxr":{source:"iana",extensions:["jxr"]},"image/jxra":{source:"iana",extensions:["jxra"]},"image/jxrs":{source:"iana",extensions:["jxrs"]},"image/jxs":{source:"iana",extensions:["jxs"]},"image/jxsc":{source:"iana",extensions:["jxsc"]},"image/jxsi":{source:"iana",extensions:["jxsi"]},"image/jxss":{source:"iana",extensions:["jxss"]},"image/ktx":{source:"iana",extensions:["ktx"]},"image/ktx2":{source:"iana",extensions:["ktx2"]},"image/naplps":{source:"iana"},"image/pjpeg":{compressible:!1},"image/png":{source:"iana",compressible:!1,extensions:["png"]},"image/prs.btif":{source:"iana",extensions:["btif"]},"image/prs.pti":{source:"iana",extensions:["pti"]},"image/pwg-raster":{source:"iana"},"image/sgi":{source:"apache",extensions:["sgi"]},"image/svg+xml":{source:"iana",compressible:!0,extensions:["svg","svgz"]},"image/t38":{source:"iana",extensions:["t38"]},"image/tiff":{source:"iana",compressible:!1,extensions:["tif","tiff"]},"image/tiff-fx":{source:"iana",extensions:["tfx"]},"image/vnd.adobe.photoshop":{source:"iana",compressible:!0,extensions:["psd"]},"image/vnd.airzip.accelerator.azv":{source:"iana",extensions:["azv"]},"image/vnd.cns.inf2":{source:"iana"},"image/vnd.dece.graphic":{source:"iana",extensions:["uvi","uvvi","uvg","uvvg"]},"image/vnd.djvu":{source:"iana",extensions:["djvu","djv"]},"image/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"image/vnd.dwg":{source:"iana",extensions:["dwg"]},"image/vnd.dxf":{source:"iana",extensions:["dxf"]},"image/vnd.fastbidsheet":{source:"iana",extensions:["fbs"]},"image/vnd.fpx":{source:"iana",extensions:["fpx"]},"image/vnd.fst":{source:"iana",extensions:["fst"]},"image/vnd.fujixerox.edmics-mmr":{source:"iana",extensions:["mmr"]},"image/vnd.fujixerox.edmics-rlc":{source:"iana",extensions:["rlc"]},"image/vnd.globalgraphics.pgb":{source:"iana"},"image/vnd.microsoft.icon":{source:"iana",compressible:!0,extensions:["ico"]},"image/vnd.mix":{source:"iana"},"image/vnd.mozilla.apng":{source:"iana"},"image/vnd.ms-dds":{compressible:!0,extensions:["dds"]},"image/vnd.ms-modi":{source:"iana",extensions:["mdi"]},"image/vnd.ms-photo":{source:"apache",extensions:["wdp"]},"image/vnd.net-fpx":{source:"iana",extensions:["npx"]},"image/vnd.pco.b16":{source:"iana",extensions:["b16"]},"image/vnd.radiance":{source:"iana"},"image/vnd.sealed.png":{source:"iana"},"image/vnd.sealedmedia.softseal.gif":{source:"iana"},"image/vnd.sealedmedia.softseal.jpg":{source:"iana"},"image/vnd.svf":{source:"iana"},"image/vnd.tencent.tap":{source:"iana",extensions:["tap"]},"image/vnd.valve.source.texture":{source:"iana",extensions:["vtf"]},"image/vnd.wap.wbmp":{source:"iana",extensions:["wbmp"]},"image/vnd.xiff":{source:"iana",extensions:["xif"]},"image/vnd.zbrush.pcx":{source:"iana",extensions:["pcx"]},"image/webp":{source:"apache",extensions:["webp"]},"image/wmf":{source:"iana",extensions:["wmf"]},"image/x-3ds":{source:"apache",extensions:["3ds"]},"image/x-cmu-raster":{source:"apache",extensions:["ras"]},"image/x-cmx":{source:"apache",extensions:["cmx"]},"image/x-freehand":{source:"apache",extensions:["fh","fhc","fh4","fh5","fh7"]},"image/x-icon":{source:"apache",compressible:!0,extensions:["ico"]},"image/x-jng":{source:"nginx",extensions:["jng"]},"image/x-mrsid-image":{source:"apache",extensions:["sid"]},"image/x-ms-bmp":{source:"nginx",compressible:!0,extensions:["bmp"]},"image/x-pcx":{source:"apache",extensions:["pcx"]},"image/x-pict":{source:"apache",extensions:["pic","pct"]},"image/x-portable-anymap":{source:"apache",extensions:["pnm"]},"image/x-portable-bitmap":{source:"apache",extensions:["pbm"]},"image/x-portable-graymap":{source:"apache",extensions:["pgm"]},"image/x-portable-pixmap":{source:"apache",extensions:["ppm"]},"image/x-rgb":{source:"apache",extensions:["rgb"]},"image/x-tga":{source:"apache",extensions:["tga"]},"image/x-xbitmap":{source:"apache",extensions:["xbm"]},"image/x-xcf":{compressible:!1},"image/x-xpixmap":{source:"apache",extensions:["xpm"]},"image/x-xwindowdump":{source:"apache",extensions:["xwd"]},"message/cpim":{source:"iana"},"message/delivery-status":{source:"iana"},"message/disposition-notification":{source:"iana",extensions:["disposition-notification"]},"message/external-body":{source:"iana"},"message/feedback-report":{source:"iana"},"message/global":{source:"iana",extensions:["u8msg"]},"message/global-delivery-status":{source:"iana",extensions:["u8dsn"]},"message/global-disposition-notification":{source:"iana",extensions:["u8mdn"]},"message/global-headers":{source:"iana",extensions:["u8hdr"]},"message/http":{source:"iana",compressible:!1},"message/imdn+xml":{source:"iana",compressible:!0},"message/news":{source:"iana"},"message/partial":{source:"iana",compressible:!1},"message/rfc822":{source:"iana",compressible:!0,extensions:["eml","mime"]},"message/s-http":{source:"iana"},"message/sip":{source:"iana"},"message/sipfrag":{source:"iana"},"message/tracking-status":{source:"iana"},"message/vnd.si.simp":{source:"iana"},"message/vnd.wfa.wsc":{source:"iana",extensions:["wsc"]},"model/3mf":{source:"iana",extensions:["3mf"]},"model/e57":{source:"iana"},"model/gltf+json":{source:"iana",compressible:!0,extensions:["gltf"]},"model/gltf-binary":{source:"iana",compressible:!0,extensions:["glb"]},"model/iges":{source:"iana",compressible:!1,extensions:["igs","iges"]},"model/mesh":{source:"iana",compressible:!1,extensions:["msh","mesh","silo"]},"model/mtl":{source:"iana",extensions:["mtl"]},"model/obj":{source:"iana",extensions:["obj"]},"model/step":{source:"iana"},"model/step+xml":{source:"iana",compressible:!0,extensions:["stpx"]},"model/step+zip":{source:"iana",compressible:!1,extensions:["stpz"]},"model/step-xml+zip":{source:"iana",compressible:!1,extensions:["stpxz"]},"model/stl":{source:"iana",extensions:["stl"]},"model/vnd.collada+xml":{source:"iana",compressible:!0,extensions:["dae"]},"model/vnd.dwf":{source:"iana",extensions:["dwf"]},"model/vnd.flatland.3dml":{source:"iana"},"model/vnd.gdl":{source:"iana",extensions:["gdl"]},"model/vnd.gs-gdl":{source:"apache"},"model/vnd.gs.gdl":{source:"iana"},"model/vnd.gtw":{source:"iana",extensions:["gtw"]},"model/vnd.moml+xml":{source:"iana",compressible:!0},"model/vnd.mts":{source:"iana",extensions:["mts"]},"model/vnd.opengex":{source:"iana",extensions:["ogex"]},"model/vnd.parasolid.transmit.binary":{source:"iana",extensions:["x_b"]},"model/vnd.parasolid.transmit.text":{source:"iana",extensions:["x_t"]},"model/vnd.pytha.pyox":{source:"iana"},"model/vnd.rosette.annotated-data-model":{source:"iana"},"model/vnd.sap.vds":{source:"iana",extensions:["vds"]},"model/vnd.usdz+zip":{source:"iana",compressible:!1,extensions:["usdz"]},"model/vnd.valve.source.compiled-map":{source:"iana",extensions:["bsp"]},"model/vnd.vtu":{source:"iana",extensions:["vtu"]},"model/vrml":{source:"iana",compressible:!1,extensions:["wrl","vrml"]},"model/x3d+binary":{source:"apache",compressible:!1,extensions:["x3db","x3dbz"]},"model/x3d+fastinfoset":{source:"iana",extensions:["x3db"]},"model/x3d+vrml":{source:"apache",compressible:!1,extensions:["x3dv","x3dvz"]},"model/x3d+xml":{source:"iana",compressible:!0,extensions:["x3d","x3dz"]},"model/x3d-vrml":{source:"iana",extensions:["x3dv"]},"multipart/alternative":{source:"iana",compressible:!1},"multipart/appledouble":{source:"iana"},"multipart/byteranges":{source:"iana"},"multipart/digest":{source:"iana"},"multipart/encrypted":{source:"iana",compressible:!1},"multipart/form-data":{source:"iana",compressible:!1},"multipart/header-set":{source:"iana"},"multipart/mixed":{source:"iana"},"multipart/multilingual":{source:"iana"},"multipart/parallel":{source:"iana"},"multipart/related":{source:"iana",compressible:!1},"multipart/report":{source:"iana"},"multipart/signed":{source:"iana",compressible:!1},"multipart/vnd.bint.med-plus":{source:"iana"},"multipart/voice-message":{source:"iana"},"multipart/x-mixed-replace":{source:"iana"},"text/1d-interleaved-parityfec":{source:"iana"},"text/cache-manifest":{source:"iana",compressible:!0,extensions:["appcache","manifest"]},"text/calendar":{source:"iana",extensions:["ics","ifb"]},"text/calender":{compressible:!0},"text/cmd":{compressible:!0},"text/coffeescript":{extensions:["coffee","litcoffee"]},"text/cql":{source:"iana"},"text/cql-expression":{source:"iana"},"text/cql-identifier":{source:"iana"},"text/css":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["css"]},"text/csv":{source:"iana",compressible:!0,extensions:["csv"]},"text/csv-schema":{source:"iana"},"text/directory":{source:"iana"},"text/dns":{source:"iana"},"text/ecmascript":{source:"iana"},"text/encaprtp":{source:"iana"},"text/enriched":{source:"iana"},"text/fhirpath":{source:"iana"},"text/flexfec":{source:"iana"},"text/fwdred":{source:"iana"},"text/gff3":{source:"iana"},"text/grammar-ref-list":{source:"iana"},"text/html":{source:"iana",compressible:!0,extensions:["html","htm","shtml"]},"text/jade":{extensions:["jade"]},"text/javascript":{source:"iana",compressible:!0},"text/jcr-cnd":{source:"iana"},"text/jsx":{compressible:!0,extensions:["jsx"]},"text/less":{compressible:!0,extensions:["less"]},"text/markdown":{source:"iana",compressible:!0,extensions:["markdown","md"]},"text/mathml":{source:"nginx",extensions:["mml"]},"text/mdx":{compressible:!0,extensions:["mdx"]},"text/mizar":{source:"iana"},"text/n3":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["n3"]},"text/parameters":{source:"iana",charset:"UTF-8"},"text/parityfec":{source:"iana"},"text/plain":{source:"iana",compressible:!0,extensions:["txt","text","conf","def","list","log","in","ini"]},"text/provenance-notation":{source:"iana",charset:"UTF-8"},"text/prs.fallenstein.rst":{source:"iana"},"text/prs.lines.tag":{source:"iana",extensions:["dsc"]},"text/prs.prop.logic":{source:"iana"},"text/raptorfec":{source:"iana"},"text/red":{source:"iana"},"text/rfc822-headers":{source:"iana"},"text/richtext":{source:"iana",compressible:!0,extensions:["rtx"]},"text/rtf":{source:"iana",compressible:!0,extensions:["rtf"]},"text/rtp-enc-aescm128":{source:"iana"},"text/rtploopback":{source:"iana"},"text/rtx":{source:"iana"},"text/sgml":{source:"iana",extensions:["sgml","sgm"]},"text/shaclc":{source:"iana"},"text/shex":{source:"iana",extensions:["shex"]},"text/slim":{extensions:["slim","slm"]},"text/spdx":{source:"iana",extensions:["spdx"]},"text/strings":{source:"iana"},"text/stylus":{extensions:["stylus","styl"]},"text/t140":{source:"iana"},"text/tab-separated-values":{source:"iana",compressible:!0,extensions:["tsv"]},"text/troff":{source:"iana",extensions:["t","tr","roff","man","me","ms"]},"text/turtle":{source:"iana",charset:"UTF-8",extensions:["ttl"]},"text/ulpfec":{source:"iana"},"text/uri-list":{source:"iana",compressible:!0,extensions:["uri","uris","urls"]},"text/vcard":{source:"iana",compressible:!0,extensions:["vcard"]},"text/vnd.a":{source:"iana"},"text/vnd.abc":{source:"iana"},"text/vnd.ascii-art":{source:"iana"},"text/vnd.curl":{source:"iana",extensions:["curl"]},"text/vnd.curl.dcurl":{source:"apache",extensions:["dcurl"]},"text/vnd.curl.mcurl":{source:"apache",extensions:["mcurl"]},"text/vnd.curl.scurl":{source:"apache",extensions:["scurl"]},"text/vnd.debian.copyright":{source:"iana",charset:"UTF-8"},"text/vnd.dmclientscript":{source:"iana"},"text/vnd.dvb.subtitle":{source:"iana",extensions:["sub"]},"text/vnd.esmertec.theme-descriptor":{source:"iana",charset:"UTF-8"},"text/vnd.familysearch.gedcom":{source:"iana",extensions:["ged"]},"text/vnd.ficlab.flt":{source:"iana"},"text/vnd.fly":{source:"iana",extensions:["fly"]},"text/vnd.fmi.flexstor":{source:"iana",extensions:["flx"]},"text/vnd.gml":{source:"iana"},"text/vnd.graphviz":{source:"iana",extensions:["gv"]},"text/vnd.hans":{source:"iana"},"text/vnd.hgl":{source:"iana"},"text/vnd.in3d.3dml":{source:"iana",extensions:["3dml"]},"text/vnd.in3d.spot":{source:"iana",extensions:["spot"]},"text/vnd.iptc.newsml":{source:"iana"},"text/vnd.iptc.nitf":{source:"iana"},"text/vnd.latex-z":{source:"iana"},"text/vnd.motorola.reflex":{source:"iana"},"text/vnd.ms-mediapackage":{source:"iana"},"text/vnd.net2phone.commcenter.command":{source:"iana"},"text/vnd.radisys.msml-basic-layout":{source:"iana"},"text/vnd.senx.warpscript":{source:"iana"},"text/vnd.si.uricatalogue":{source:"iana"},"text/vnd.sosi":{source:"iana"},"text/vnd.sun.j2me.app-descriptor":{source:"iana",charset:"UTF-8",extensions:["jad"]},"text/vnd.trolltech.linguist":{source:"iana",charset:"UTF-8"},"text/vnd.wap.si":{source:"iana"},"text/vnd.wap.sl":{source:"iana"},"text/vnd.wap.wml":{source:"iana",extensions:["wml"]},"text/vnd.wap.wmlscript":{source:"iana",extensions:["wmls"]},"text/vtt":{source:"iana",charset:"UTF-8",compressible:!0,extensions:["vtt"]},"text/x-asm":{source:"apache",extensions:["s","asm"]},"text/x-c":{source:"apache",extensions:["c","cc","cxx","cpp","h","hh","dic"]},"text/x-component":{source:"nginx",extensions:["htc"]},"text/x-fortran":{source:"apache",extensions:["f","for","f77","f90"]},"text/x-gwt-rpc":{compressible:!0},"text/x-handlebars-template":{extensions:["hbs"]},"text/x-java-source":{source:"apache",extensions:["java"]},"text/x-jquery-tmpl":{compressible:!0},"text/x-lua":{extensions:["lua"]},"text/x-markdown":{compressible:!0,extensions:["mkd"]},"text/x-nfo":{source:"apache",extensions:["nfo"]},"text/x-opml":{source:"apache",extensions:["opml"]},"text/x-org":{compressible:!0,extensions:["org"]},"text/x-pascal":{source:"apache",extensions:["p","pas"]},"text/x-processing":{compressible:!0,extensions:["pde"]},"text/x-sass":{extensions:["sass"]},"text/x-scss":{extensions:["scss"]},"text/x-setext":{source:"apache",extensions:["etx"]},"text/x-sfv":{source:"apache",extensions:["sfv"]},"text/x-suse-ymp":{compressible:!0,extensions:["ymp"]},"text/x-uuencode":{source:"apache",extensions:["uu"]},"text/x-vcalendar":{source:"apache",extensions:["vcs"]},"text/x-vcard":{source:"apache",extensions:["vcf"]},"text/xml":{source:"iana",compressible:!0,extensions:["xml"]},"text/xml-external-parsed-entity":{source:"iana"},"text/yaml":{compressible:!0,extensions:["yaml","yml"]},"video/1d-interleaved-parityfec":{source:"iana"},"video/3gpp":{source:"iana",extensions:["3gp","3gpp"]},"video/3gpp-tt":{source:"iana"},"video/3gpp2":{source:"iana",extensions:["3g2"]},"video/av1":{source:"iana"},"video/bmpeg":{source:"iana"},"video/bt656":{source:"iana"},"video/celb":{source:"iana"},"video/dv":{source:"iana"},"video/encaprtp":{source:"iana"},"video/ffv1":{source:"iana"},"video/flexfec":{source:"iana"},"video/h261":{source:"iana",extensions:["h261"]},"video/h263":{source:"iana",extensions:["h263"]},"video/h263-1998":{source:"iana"},"video/h263-2000":{source:"iana"},"video/h264":{source:"iana",extensions:["h264"]},"video/h264-rcdo":{source:"iana"},"video/h264-svc":{source:"iana"},"video/h265":{source:"iana"},"video/iso.segment":{source:"iana",extensions:["m4s"]},"video/jpeg":{source:"iana",extensions:["jpgv"]},"video/jpeg2000":{source:"iana"},"video/jpm":{source:"apache",extensions:["jpm","jpgm"]},"video/jxsv":{source:"iana"},"video/mj2":{source:"iana",extensions:["mj2","mjp2"]},"video/mp1s":{source:"iana"},"video/mp2p":{source:"iana"},"video/mp2t":{source:"iana",extensions:["ts"]},"video/mp4":{source:"iana",compressible:!1,extensions:["mp4","mp4v","mpg4"]},"video/mp4v-es":{source:"iana"},"video/mpeg":{source:"iana",compressible:!1,extensions:["mpeg","mpg","mpe","m1v","m2v"]},"video/mpeg4-generic":{source:"iana"},"video/mpv":{source:"iana"},"video/nv":{source:"iana"},"video/ogg":{source:"iana",compressible:!1,extensions:["ogv"]},"video/parityfec":{source:"iana"},"video/pointer":{source:"iana"},"video/quicktime":{source:"iana",compressible:!1,extensions:["qt","mov"]},"video/raptorfec":{source:"iana"},"video/raw":{source:"iana"},"video/rtp-enc-aescm128":{source:"iana"},"video/rtploopback":{source:"iana"},"video/rtx":{source:"iana"},"video/scip":{source:"iana"},"video/smpte291":{source:"iana"},"video/smpte292m":{source:"iana"},"video/ulpfec":{source:"iana"},"video/vc1":{source:"iana"},"video/vc2":{source:"iana"},"video/vnd.cctv":{source:"iana"},"video/vnd.dece.hd":{source:"iana",extensions:["uvh","uvvh"]},"video/vnd.dece.mobile":{source:"iana",extensions:["uvm","uvvm"]},"video/vnd.dece.mp4":{source:"iana"},"video/vnd.dece.pd":{source:"iana",extensions:["uvp","uvvp"]},"video/vnd.dece.sd":{source:"iana",extensions:["uvs","uvvs"]},"video/vnd.dece.video":{source:"iana",extensions:["uvv","uvvv"]},"video/vnd.directv.mpeg":{source:"iana"},"video/vnd.directv.mpeg-tts":{source:"iana"},"video/vnd.dlna.mpeg-tts":{source:"iana"},"video/vnd.dvb.file":{source:"iana",extensions:["dvb"]},"video/vnd.fvt":{source:"iana",extensions:["fvt"]},"video/vnd.hns.video":{source:"iana"},"video/vnd.iptvforum.1dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.1dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.2dparityfec-1010":{source:"iana"},"video/vnd.iptvforum.2dparityfec-2005":{source:"iana"},"video/vnd.iptvforum.ttsavc":{source:"iana"},"video/vnd.iptvforum.ttsmpeg2":{source:"iana"},"video/vnd.motorola.video":{source:"iana"},"video/vnd.motorola.videop":{source:"iana"},"video/vnd.mpegurl":{source:"iana",extensions:["mxu","m4u"]},"video/vnd.ms-playready.media.pyv":{source:"iana",extensions:["pyv"]},"video/vnd.nokia.interleaved-multimedia":{source:"iana"},"video/vnd.nokia.mp4vr":{source:"iana"},"video/vnd.nokia.videovoip":{source:"iana"},"video/vnd.objectvideo":{source:"iana"},"video/vnd.radgamettools.bink":{source:"iana"},"video/vnd.radgamettools.smacker":{source:"iana"},"video/vnd.sealed.mpeg1":{source:"iana"},"video/vnd.sealed.mpeg4":{source:"iana"},"video/vnd.sealed.swf":{source:"iana"},"video/vnd.sealedmedia.softseal.mov":{source:"iana"},"video/vnd.uvvu.mp4":{source:"iana",extensions:["uvu","uvvu"]},"video/vnd.vivo":{source:"iana",extensions:["viv"]},"video/vnd.youtube.yt":{source:"iana"},"video/vp8":{source:"iana"},"video/vp9":{source:"iana"},"video/webm":{source:"apache",compressible:!1,extensions:["webm"]},"video/x-f4v":{source:"apache",extensions:["f4v"]},"video/x-fli":{source:"apache",extensions:["fli"]},"video/x-flv":{source:"apache",compressible:!1,extensions:["flv"]},"video/x-m4v":{source:"apache",extensions:["m4v"]},"video/x-matroska":{source:"apache",compressible:!1,extensions:["mkv","mk3d","mks"]},"video/x-mng":{source:"apache",extensions:["mng"]},"video/x-ms-asf":{source:"apache",extensions:["asf","asx"]},"video/x-ms-vob":{source:"apache",extensions:["vob"]},"video/x-ms-wm":{source:"apache",extensions:["wm"]},"video/x-ms-wmv":{source:"apache",compressible:!1,extensions:["wmv"]},"video/x-ms-wmx":{source:"apache",extensions:["wmx"]},"video/x-ms-wvx":{source:"apache",extensions:["wvx"]},"video/x-msvideo":{source:"apache",extensions:["avi"]},"video/x-sgi-movie":{source:"apache",extensions:["movie"]},"video/x-smv":{source:"apache",extensions:["smv"]},"x-conference/x-cooltalk":{source:"apache",extensions:["ice"]},"x-shader/x-fragment":{compressible:!0},"x-shader/x-vertex":{compressible:!0}};
/*!
 * mime-types
 * Copyright(c) 2014 Jonathan Ong
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */
!function(e){var t=ln,n=N.default.extname,r=/^\s*([^;\s]*)(?:;|\s|$)/,a=/^text\//i;function i(e){if(!e||"string"!=typeof e)return!1;var n=r.exec(e),i=n&&t[n[1].toLowerCase()];return i&&i.charset?i.charset:!(!n||!a.test(n[1]))&&"UTF-8"}e.charset=i,e.charsets={lookup:i},e.contentType=function(t){if(!t||"string"!=typeof t)return!1;var n=-1===t.indexOf("/")?e.lookup(t):t;if(!n)return!1;if(-1===n.indexOf("charset")){var r=e.charset(n);r&&(n+="; charset="+r.toLowerCase())}return n},e.extension=function(t){if(!t||"string"!=typeof t)return!1;var n=r.exec(t),a=n&&e.extensions[n[1].toLowerCase()];if(!a||!a.length)return!1;return a[0]},e.extensions=Object.create(null),e.lookup=function(t){if(!t||"string"!=typeof t)return!1;var r=n("x."+t).toLowerCase().substr(1);if(!r)return!1;return e.types[r]||!1},e.types=Object.create(null),function(e,n){var r=["nginx","apache",void 0,"iana"];Object.keys(t).forEach((function(a){var i=t[a],o=i.extensions;if(o&&o.length){e[a]=o;for(var s=0;s<o.length;s++){var l=o[s];if(n[l]){var c=r.indexOf(t[n[l]].source),u=r.indexOf(i.source);if("application/octet-stream"!==n[l]&&(c>u||c===u&&"application/"===n[l].substr(0,12)))continue}n[l]=a}}}))}(e.extensions,e.types)}(sn);var cn=function(e){var t="function"==typeof setImmediate?setImmediate:"object"==typeof process&&"function"==typeof process.nextTick?process.nextTick:null;t?t(e):setTimeout(e,0)},un=function(e){var t=!1;return cn((function(){t=!0})),function(n,r){t?e(n,r):cn((function(){e(n,r)}))}};var dn=function(e){Object.keys(e.jobs).forEach(pn.bind(e)),e.jobs={}};function pn(e){"function"==typeof this.jobs[e]&&this.jobs[e]()}var hn=un,mn=dn,fn=function(e,t,n,r){var a=n.keyedList?n.keyedList[n.index]:n.index;n.jobs[a]=function(e,t,n,r){var a;a=2==e.length?e(n,hn(r)):e(n,t,hn(r));return a}(t,a,e[a],(function(e,t){a in n.jobs&&(delete n.jobs[a],e?mn(n):n.results[a]=t,r(e,n.results))}))};var yn=function(e,t){var n=!Array.isArray(e),r={index:0,keyedList:n||t?Object.keys(e):null,jobs:{},results:n?{}:[],size:n?Object.keys(e).length:e.length};t&&r.keyedList.sort(n?t:function(n,r){return t(e[n],e[r])});return r};var gn=dn,bn=un,vn=function(e){if(!Object.keys(this.jobs).length)return;this.index=this.size,gn(this),bn(e)(null,this.results)};var wn=fn,Sn=yn,En=vn,xn=function(e,t,n){var r=Sn(e);for(;r.index<(r.keyedList||e).length;)wn(e,t,r,(function(e,t){e?n(e,t):0!==Object.keys(r.jobs).length||n(null,r.results)})),r.index++;return En.bind(r,n)};var _n={exports:{}},kn=fn,In=yn,Tn=vn;function An(e,t){return e<t?-1:e>t?1:0}_n.exports=function(e,t,n,r){var a=In(e,n);return kn(e,t,a,(function n(i,o){i?r(i,o):(a.index++,a.index<(a.keyedList||e).length?kn(e,t,a,n):r(null,a.results))})),Tn.bind(a,r)},_n.exports.ascending=An,_n.exports.descending=function(e,t){return-1*An(e,t)};var On=_n.exports;var Kn={parallel:xn,serial:function(e,t,n){return On(e,t,null,n)},serialOrdered:_n.exports},Cn=Object,Rn=Error,jn=EvalError,Pn=RangeError,Dn=ReferenceError,Nn=SyntaxError,Ln=TypeError,Mn=URIError,Fn=Math.abs,Bn=Math.floor,Vn=Math.max,Un=Math.min,Jn=Math.pow,Gn=Math.round,$n=Number.isNaN||function(e){return e!=e},qn=Object.getOwnPropertyDescriptor;if(qn)try{qn([],"length")}catch(fo){qn=null}var zn=qn,Wn=Object.defineProperty||!1;if(Wn)try{Wn({},"a",{value:1})}catch(fo){Wn=!1}var Yn,Hn=Wn,Qn=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(var r in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var a=Object.getOwnPropertySymbols(e);if(1!==a.length||a[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(e,t);if(42!==i.value||!0!==i.enumerable)return!1}return!0},Zn="undefined"!=typeof Symbol&&Symbol,Xn=Qn,er="undefined"!=typeof Reflect&&Reflect.getPrototypeOf||null,tr=Cn.getPrototypeOf||null,nr="Function.prototype.bind called on incompatible ",rr=Object.prototype.toString,ar=Math.max,ir=function(e,t){for(var n=[],r=0;r<e.length;r+=1)n[r]=e[r];for(var a=0;a<t.length;a+=1)n[a+e.length]=t[a];return n},or=function(e,t){for(var n=[],r=t||0,a=0;r<e.length;r+=1,a+=1)n[a]=e[r];return n},sr=function(e,t){for(var n="",r=0;r<e.length;r+=1)n+=e[r],r+1<e.length&&(n+=t);return n},lr=function(e){var t=this;if("function"!=typeof t||"[object Function]"!==rr.apply(t))throw new TypeError(nr+t);for(var n,r=or(arguments,1),a=function(){if(this instanceof n){var a=t.apply(this,ir(r,arguments));return Object(a)===a?a:this}return t.apply(e,ir(r,arguments))},i=ar(0,t.length-r.length),o=[],s=0;s<i;s++)o[s]="$"+s;if(n=Function("binder","return function ("+sr(o,",")+"){ return binder.apply(this,arguments); }")(a),t.prototype){var l=function(){};l.prototype=t.prototype,n.prototype=new l,l.prototype=null}return n},cr=Function.prototype.bind||lr,ur=Function.prototype.call,dr=Function.prototype.apply,pr=dr,hr=ur,mr="undefined"!=typeof Reflect&&Reflect&&Reflect.apply||cr.call(hr,pr),fr=cr,yr=Ln,gr=ur,br=mr,vr=function(e){if(e.length<1||"function"!=typeof e[0])throw new yr("a function is required");return br(fr,gr,e)},wr=zn;try{Yn=[].__proto__===Array.prototype}catch(fo){if(!fo||"object"!=typeof fo||!("code"in fo)||"ERR_PROTO_ACCESS"!==fo.code)throw fo}var Sr=!!Yn&&wr&&wr(Object.prototype,"__proto__"),Er=Object,xr=Er.getPrototypeOf,_r=Sr&&"function"==typeof Sr.get?vr([Sr.get]):"function"==typeof xr&&function(e){return xr(null==e?e:Er(e))},kr=er,Ir=tr,Tr=_r,Ar=kr?function(e){return kr(e)}:Ir?function(e){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new TypeError("getProto: not an object");return Ir(e)}:Tr?function(e){return Tr(e)}:null,Or=Function.prototype.call,Kr=Object.prototype.hasOwnProperty,Cr=cr.call(Or,Kr),Rr=Cn,jr=Rn,Pr=jn,Dr=Pn,Nr=Dn,Lr=Nn,Mr=Ln,Fr=Mn,Br=Fn,Vr=Bn,Ur=Vn,Jr=Un,Gr=Jn,$r=Gn,qr=function(e){return $n(e)||0===e?e:e<0?-1:1},zr=Function,Wr=function(e){try{return zr('"use strict"; return ('+e+").constructor;")()}catch(e){}},Yr=zn,Hr=Hn,Qr=function(){throw new Mr},Zr=Yr?function(){try{return Qr}catch(e){try{return Yr(arguments,"callee").get}catch(e){return Qr}}}():Qr,Xr="function"==typeof Zn&&"function"==typeof Symbol&&"symbol"==typeof Zn("foo")&&"symbol"==typeof Symbol("bar")&&Xn(),ea=Ar,ta=tr,na=er,ra=dr,aa=ur,ia={},oa="undefined"!=typeof Uint8Array&&ea?ea(Uint8Array):undefined,sa={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?undefined:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?undefined:ArrayBuffer,"%ArrayIteratorPrototype%":Xr&&ea?ea([][Symbol.iterator]()):undefined,"%AsyncFromSyncIteratorPrototype%":undefined,"%AsyncFunction%":ia,"%AsyncGenerator%":ia,"%AsyncGeneratorFunction%":ia,"%AsyncIteratorPrototype%":ia,"%Atomics%":"undefined"==typeof Atomics?undefined:Atomics,"%BigInt%":"undefined"==typeof BigInt?undefined:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?undefined:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?undefined:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?undefined:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":jr,"%eval%":eval,"%EvalError%":Pr,"%Float16Array%":"undefined"==typeof Float16Array?undefined:Float16Array,"%Float32Array%":"undefined"==typeof Float32Array?undefined:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?undefined:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?undefined:FinalizationRegistry,"%Function%":zr,"%GeneratorFunction%":ia,"%Int8Array%":"undefined"==typeof Int8Array?undefined:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?undefined:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?undefined:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Xr&&ea?ea(ea([][Symbol.iterator]())):undefined,"%JSON%":"object"==typeof JSON?JSON:undefined,"%Map%":"undefined"==typeof Map?undefined:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&Xr&&ea?ea((new Map)[Symbol.iterator]()):undefined,"%Math%":Math,"%Number%":Number,"%Object%":Rr,"%Object.getOwnPropertyDescriptor%":Yr,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?undefined:Promise,"%Proxy%":"undefined"==typeof Proxy?undefined:Proxy,"%RangeError%":Dr,"%ReferenceError%":Nr,"%Reflect%":"undefined"==typeof Reflect?undefined:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?undefined:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&Xr&&ea?ea((new Set)[Symbol.iterator]()):undefined,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?undefined:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Xr&&ea?ea(""[Symbol.iterator]()):undefined,"%Symbol%":Xr?Symbol:undefined,"%SyntaxError%":Lr,"%ThrowTypeError%":Zr,"%TypedArray%":oa,"%TypeError%":Mr,"%Uint8Array%":"undefined"==typeof Uint8Array?undefined:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?undefined:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?undefined:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?undefined:Uint32Array,"%URIError%":Fr,"%WeakMap%":"undefined"==typeof WeakMap?undefined:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?undefined:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?undefined:WeakSet,"%Function.prototype.call%":aa,"%Function.prototype.apply%":ra,"%Object.defineProperty%":Hr,"%Object.getPrototypeOf%":ta,"%Math.abs%":Br,"%Math.floor%":Vr,"%Math.max%":Ur,"%Math.min%":Jr,"%Math.pow%":Gr,"%Math.round%":$r,"%Math.sign%":qr,"%Reflect.getPrototypeOf%":na};if(ea)try{null.error}catch(fo){var la=ea(ea(fo));sa["%Error.prototype%"]=la}var ca=function e(t){var n;if("%AsyncFunction%"===t)n=Wr("async function () {}");else if("%GeneratorFunction%"===t)n=Wr("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=Wr("async function* () {}");else if("%AsyncGenerator%"===t){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===t){var a=e("%AsyncGenerator%");a&&ea&&(n=ea(a.prototype))}return sa[t]=n,n},ua={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},da=cr,pa=Cr,ha=da.call(aa,Array.prototype.concat),ma=da.call(ra,Array.prototype.splice),fa=da.call(aa,String.prototype.replace),ya=da.call(aa,String.prototype.slice),ga=da.call(aa,RegExp.prototype.exec),ba=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,va=/\\(\\)?/g,wa=function(e){var t=ya(e,0,1),n=ya(e,-1);if("%"===t&&"%"!==n)throw new Lr("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new Lr("invalid intrinsic syntax, expected opening `%`");var r=[];return fa(e,ba,(function(e,t,n,a){r[r.length]=n?fa(a,va,"$1"):t||e})),r},Sa=function(e,t){var n,r=e;if(pa(ua,r)&&(r="%"+(n=ua[r])[0]+"%"),pa(sa,r)){var a=sa[r];if(a===ia&&(a=ca(r)),void 0===a&&!t)throw new Mr("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:a}}throw new Lr("intrinsic "+e+" does not exist!")},Ea=Qn,xa=function(e,t){if("string"!=typeof e||0===e.length)throw new Mr("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new Mr('"allowMissing" argument must be a boolean');if(null===ga(/^%?[^%]*%?$/,e))throw new Lr("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=wa(e),r=n.length>0?n[0]:"",a=Sa("%"+r+"%",t),i=a.name,o=a.value,s=!1,l=a.alias;l&&(r=l[0],ma(n,ha([0,1],l)));for(var c=1,u=!0;c<n.length;c+=1){var d=n[c],p=ya(d,0,1),h=ya(d,-1);if(('"'===p||"'"===p||"`"===p||'"'===h||"'"===h||"`"===h)&&p!==h)throw new Lr("property names with quotes must have matching quotes");if("constructor"!==d&&u||(s=!0),pa(sa,i="%"+(r+="."+d)+"%"))o=sa[i];else if(null!=o){if(!(d in o)){if(!t)throw new Mr("base intrinsic for "+e+" exists, but the property is not available.");return}if(Yr&&c+1>=n.length){var m=Yr(o,d);o=(u=!!m)&&"get"in m&&!("originalValue"in m.get)?m.get:o[d]}else u=pa(o,d),o=o[d];u&&!s&&(sa[i]=o)}}return o},_a=xa("%Object.defineProperty%",!0),ka=Ea()&&!!Symbol.toStringTag,Ia=Cr,Ta=Ln,Aa=ka?Symbol.toStringTag:null,Oa=an,Ka=D.default,Ca=N.default,Ra=O.default,ja=K.default,Pa=C.default.parse,Da=M.default,Na=R.default.Stream,La=B.default,Ma=sn,Fa=Kn,Ba=function(e,t){var n=arguments.length>2&&!!arguments[2]&&arguments[2].force,r=arguments.length>2&&!!arguments[2]&&arguments[2].nonConfigurable;if(void 0!==n&&"boolean"!=typeof n||void 0!==r&&"boolean"!=typeof r)throw new Ta("if provided, the `overrideIfSet` and `nonConfigurable` options must be booleans");!Aa||!n&&Ia(e,Aa)||(_a?_a(e,Aa,{configurable:!r,enumerable:!1,value:t,writable:!1}):e[Aa]=t)},Va=Cr,Ua=function(e,t){return Object.keys(t).forEach((function(n){e[n]=e[n]||t[n]})),e};function Ja(e){if(!(this instanceof Ja))return new Ja(e);for(var t in this._overheadLength=0,this._valueLength=0,this._valuesToMeasure=[],Oa.call(this),e=e||{})this[t]=e[t]}Ka.inherits(Ja,Oa),Ja.LINE_BREAK="\r\n",Ja.DEFAULT_CONTENT_TYPE="application/octet-stream",Ja.prototype.append=function(e,t,n){"string"==typeof(n=n||{})&&(n={filename:n});var r=Oa.prototype.append.bind(this);if("number"!=typeof t&&null!=t||(t=String(t)),Array.isArray(t))this._error(new Error("Arrays are not supported."));else{var a=this._multiPartHeader(e,t,n),i=this._multiPartFooter();r(a),r(t),r(i),this._trackLength(a,t,n)}},Ja.prototype._trackLength=function(e,t,n){var r=0;null!=n.knownLength?r+=Number(n.knownLength):Buffer.isBuffer(t)?r=t.length:"string"==typeof t&&(r=Buffer.byteLength(t)),this._valueLength+=r,this._overheadLength+=Buffer.byteLength(e)+Ja.LINE_BREAK.length,t&&(t.path||t.readable&&Va(t,"httpVersion")||t instanceof Na)&&(n.knownLength||this._valuesToMeasure.push(t))},Ja.prototype._lengthRetriever=function(e,t){Va(e,"fd")?null!=e.end&&e.end!=1/0&&null!=e.start?t(null,e.end+1-(e.start?e.start:0)):Da.stat(e.path,(function(n,r){if(n)t(n);else{var a=r.size-(e.start?e.start:0);t(null,a)}})):Va(e,"httpVersion")?t(null,Number(e.headers["content-length"])):Va(e,"httpModule")?(e.on("response",(function(n){e.pause(),t(null,Number(n.headers["content-length"]))})),e.resume()):t("Unknown stream")},Ja.prototype._multiPartHeader=function(e,t,n){if("string"==typeof n.header)return n.header;var r,a=this._getContentDisposition(t,n),i=this._getContentType(t,n),o="",s={"Content-Disposition":["form-data",'name="'+e+'"'].concat(a||[]),"Content-Type":[].concat(i||[])};for(var l in"object"==typeof n.header&&Ua(s,n.header),s)if(Va(s,l)){if(null==(r=s[l]))continue;Array.isArray(r)||(r=[r]),r.length&&(o+=l+": "+r.join("; ")+Ja.LINE_BREAK)}return"--"+this.getBoundary()+Ja.LINE_BREAK+o+Ja.LINE_BREAK},Ja.prototype._getContentDisposition=function(e,t){var n;if("string"==typeof t.filepath?n=Ca.normalize(t.filepath).replace(/\\/g,"/"):t.filename||e&&(e.name||e.path)?n=Ca.basename(t.filename||e&&(e.name||e.path)):e&&e.readable&&Va(e,"httpVersion")&&(n=Ca.basename(e.client._httpMessage.path||"")),n)return'filename="'+n+'"'},Ja.prototype._getContentType=function(e,t){var n=t.contentType;return!n&&e&&e.name&&(n=Ma.lookup(e.name)),!n&&e&&e.path&&(n=Ma.lookup(e.path)),!n&&e&&e.readable&&Va(e,"httpVersion")&&(n=e.headers["content-type"]),n||!t.filepath&&!t.filename||(n=Ma.lookup(t.filepath||t.filename)),!n&&e&&"object"==typeof e&&(n=Ja.DEFAULT_CONTENT_TYPE),n},Ja.prototype._multiPartFooter=function(){return function(e){var t=Ja.LINE_BREAK;0===this._streams.length&&(t+=this._lastBoundary()),e(t)}.bind(this)},Ja.prototype._lastBoundary=function(){return"--"+this.getBoundary()+"--"+Ja.LINE_BREAK},Ja.prototype.getHeaders=function(e){var t,n={"content-type":"multipart/form-data; boundary="+this.getBoundary()};for(t in e)Va(e,t)&&(n[t.toLowerCase()]=e[t]);return n},Ja.prototype.setBoundary=function(e){if("string"!=typeof e)throw new TypeError("FormData boundary must be a string");this._boundary=e},Ja.prototype.getBoundary=function(){return this._boundary||this._generateBoundary(),this._boundary},Ja.prototype.getBuffer=function(){for(var e=new Buffer.alloc(0),t=this.getBoundary(),n=0,r=this._streams.length;n<r;n++)"function"!=typeof this._streams[n]&&(e=Buffer.isBuffer(this._streams[n])?Buffer.concat([e,this._streams[n]]):Buffer.concat([e,Buffer.from(this._streams[n])]),"string"==typeof this._streams[n]&&this._streams[n].substring(2,t.length+2)===t||(e=Buffer.concat([e,Buffer.from(Ja.LINE_BREAK)])));return Buffer.concat([e,Buffer.from(this._lastBoundary())])},Ja.prototype._generateBoundary=function(){this._boundary="--------------------------"+La.randomBytes(12).toString("hex")},Ja.prototype.getLengthSync=function(){var e=this._overheadLength+this._valueLength;return this._streams.length&&(e+=this._lastBoundary().length),this.hasKnownLength()||this._error(new Error("Cannot calculate proper length in synchronous way.")),e},Ja.prototype.hasKnownLength=function(){var e=!0;return this._valuesToMeasure.length&&(e=!1),e},Ja.prototype.getLength=function(e){var t=this._overheadLength+this._valueLength;this._streams.length&&(t+=this._lastBoundary().length),this._valuesToMeasure.length?Fa.parallel(this._valuesToMeasure,this._lengthRetriever,(function(n,r){n?e(n):(r.forEach((function(e){t+=e})),e(null,t))})):process.nextTick(e.bind(this,null,t))},Ja.prototype.submit=function(e,t){var n,r,a={method:"post"};return"string"==typeof e?(e=Pa(e),r=Ua({port:e.port,path:e.pathname,host:e.hostname,protocol:e.protocol},a)):(r=Ua(e,a)).port||(r.port="https:"===r.protocol?443:80),r.headers=this.getHeaders(e.headers),n="https:"===r.protocol?ja.request(r):Ra.request(r),this.getLength(function(e,r){if(e&&"Unknown stream"!==e)this._error(e);else if(r&&n.setHeader("Content-Length",r),this.pipe(n),t){var a,i=function(e,r){return n.removeListener("error",i),n.removeListener("response",a),t.call(this,e,r)};a=i.bind(this,null),n.on("error",i),n.on("response",a)}}.bind(this)),n},Ja.prototype._error=function(e){this.error||(this.error=e,this.pause(),this.emit("error",e))},Ja.prototype.toString=function(){return"[object FormData]"},Ba(Ja,"FormData");var Ga=Ja,$a=Ga,qa=we,za=function(e,t){Te.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))},Wa=Re,Ya=De,Ha={"Content-Type":"application/x-www-form-urlencoded"};function Qa(e,t){!qa.isUndefined(e)&&qa.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var Za,Xa={transitional:je,adapter:("undefined"!=typeof XMLHttpRequest?Za=lt:"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process)&&(Za=Qt),Za),transformRequest:[function(e,t){if(za(t,"Accept"),za(t,"Content-Type"),qa.isFormData(e)||qa.isArrayBuffer(e)||qa.isBuffer(e)||qa.isStream(e)||qa.isFile(e)||qa.isBlob(e))return e;if(qa.isArrayBufferView(e))return e.buffer;if(qa.isURLSearchParams(e))return Qa(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n,r=qa.isObject(e),a=t&&t["Content-Type"];if((n=qa.isFileList(e))||r&&"multipart/form-data"===a){var i=this.env&&this.env.FormData;return Ya(n?{"files[]":e}:e,i&&new i)}return r||"application/json"===a?(Qa(t,"application/json"),function(e,t,n){if(qa.isString(e))try{return(t||JSON.parse)(e),qa.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||Xa.transitional,n=t&&t.silentJSONParsing,r=t&&t.forcedJSONParsing,a=!n&&"json"===this.responseType;if(a||r&&qa.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(a){if("SyntaxError"===e.name)throw Wa.from(e,Wa.ERR_BAD_RESPONSE,this,null,this.response);throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:$a},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};qa.forEach(["delete","get","head"],(function(e){Xa.headers[e]={}})),qa.forEach(["post","put","patch"],(function(e){Xa.headers[e]=qa.merge(Ha)}));var ei=Xa,ti=we,ni=ei,ri=function(e){return!(!e||!e.__CANCEL__)},ai=we,ii=function(e,t,n){var r=this||ni;return ti.forEach(n,(function(n){e=n.call(r,e,t)})),e},oi=ri,si=ei,li=He;function ci(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new li}var ui=we,di=function(e,t){t=t||{};var n={};function r(e,t){return ui.isPlainObject(e)&&ui.isPlainObject(t)?ui.merge(e,t):ui.isPlainObject(t)?ui.merge({},t):ui.isArray(t)?t.slice():t}function a(n){return ui.isUndefined(t[n])?ui.isUndefined(e[n])?void 0:r(void 0,e[n]):r(e[n],t[n])}function i(e){if(!ui.isUndefined(t[e]))return r(void 0,t[e])}function o(n){return ui.isUndefined(t[n])?ui.isUndefined(e[n])?void 0:r(void 0,e[n]):r(void 0,t[n])}function s(n){return n in t?r(e[n],t[n]):n in e?r(void 0,e[n]):void 0}var l={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s};return ui.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=l[e]||a,r=t(e);ui.isUndefined(r)&&t!==s||(n[e]=r)})),n},pi=jt,hi=Re,mi={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){mi[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var fi={};mi.transitional=function(e,t,n){function r(e,t){return"[Axios v"+pi+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,a,i){if(!1===e)throw new hi(r(a," has been removed"+(t?" in "+t:"")),hi.ERR_DEPRECATED);return t&&!fi[a]&&(fi[a]=!0,console.warn(r(a," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,a,i)}};var yi={assertOptions:function(e,t,n){if("object"!=typeof e)throw new hi("options must be an object",hi.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(e),a=r.length;a-- >0;){var i=r[a],o=t[i];if(o){var s=e[i],l=void 0===s||o(s,i,e);if(!0!==l)throw new hi("option "+i+" must be "+l,hi.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new hi("Unknown option "+i,hi.ERR_BAD_OPTION)}},validators:mi},gi=we,bi=xe,vi=Ie,wi=function(e){return ci(e),e.headers=e.headers||{},e.data=ii.call(e,e.data,e.headers,e.transformRequest),e.headers=ai.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),ai.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||si.adapter)(e).then((function(t){return ci(e),t.data=ii.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return oi(t)||(ci(e),t&&t.response&&(t.response.data=ii.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},Si=di,Ei=Ue,xi=yi,_i=xi.validators;function ki(e){this.defaults=e,this.interceptors={request:new vi,response:new vi}}ki.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=Si(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;void 0!==n&&xi.assertOptions(n,{silentJSONParsing:_i.transitional(_i.boolean),forcedJSONParsing:_i.transitional(_i.boolean),clarifyTimeoutError:_i.transitional(_i.boolean)},!1);var r=[],a=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,r.unshift(e.fulfilled,e.rejected))}));var i,o=[];if(this.interceptors.response.forEach((function(e){o.push(e.fulfilled,e.rejected)})),!a){var s=[wi,void 0];for(Array.prototype.unshift.apply(s,r),s=s.concat(o),i=Promise.resolve(t);s.length;)i=i.then(s.shift(),s.shift());return i}for(var l=t;r.length;){var c=r.shift(),u=r.shift();try{l=c(l)}catch(e){u(e);break}}try{i=wi(l)}catch(e){return Promise.reject(e)}for(;o.length;)i=i.then(o.shift(),o.shift());return i},ki.prototype.getUri=function(e){e=Si(this.defaults,e);var t=Ei(e.baseURL,e.url);return bi(t,e.params,e.paramsSerializer)},gi.forEach(["delete","get","head","options"],(function(e){ki.prototype[e]=function(t,n){return this.request(Si(n||{},{method:e,url:t,data:(n||{}).data}))}})),gi.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,a){return this.request(Si(a||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}ki.prototype[e]=t(),ki.prototype[e+"Form"]=t(!0)}));var Ii=ki,Ti=He;function Ai(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;this.promise.then((function(e){if(n._listeners){var t,r=n._listeners.length;for(t=0;t<r;t++)n._listeners[t](e);n._listeners=null}})),this.promise.then=function(e){var t,r=new Promise((function(e){n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e){n.reason||(n.reason=new Ti(e),t(n.reason))}))}Ai.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Ai.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},Ai.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},Ai.source=function(){var e;return{token:new Ai((function(t){e=t})),cancel:e}};var Oi=Ai,Ki=we,Ci=we,Ri=ne,ji=Ii,Pi=di;var Di=function e(t){var n=new ji(t),r=Ri(ji.prototype.request,n);return Ci.extend(r,ji.prototype,n),Ci.extend(r,n),r.create=function(n){return e(Pi(t,n))},r}(ei);Di.Axios=ji,Di.CanceledError=He,Di.CancelToken=Oi,Di.isCancel=ri,Di.VERSION=jt,Di.toFormData=De,Di.AxiosError=Re,Di.Cancel=Di.CanceledError,Di.all=function(e){return Promise.all(e)},Di.spread=function(e){return function(t){return e.apply(null,t)}},Di.isAxiosError=function(e){return Ki.isObject(e)&&!0===e.isAxiosError},te.exports=Di,te.exports.default=Di;var Ni=te.exports;const Li={collection:{BRAND_VENDOR_MAPPING:"sd_brand_vendor_mapping",VENDOR_SKU_MAPPING:"sd_vendor_sku_mapping",BRAND_DETAILS:"sd_brand_details",VENDOR_DETAILS:"sd_vendor_details",BRAND_SKU_MAPPING:"sd_brand_sku_mapping",GIFT_CARD_INVENTORY:"sd_gift_card_inventory",VENDOR_ORDERS:"sd_vendor_orders",LOG_TABLE:"sd_error_log",INVENTORY_BALANCE_REPORT:"sd_giftcard_inventory_balance_report",ZEUS_GIFT_CARD_INVENTORY:"sd_gift_card_inventory",LINK_LEDGER:"sp_link_ledger",LINK_REWARD_REDEMPTIONS_TABLE:"sp_link_reward_redemptions",REWARD_LINKS_TABLE:"sp_reward_links",USER_BRAND_WISE_REDEMPTIONS:"user_brand_wise_redemptions",SKU_BRAND_MAPPING:"sd_brand_sku_mapping",VENDOR_CATALOGUE:"sd_vendor_catalogue"},logging_system:{save_normal_logs:!0,save_error_logs:!0},vendor_id_mapping:{WORK_ADVANTAGE:"WK_ADV",AMAZON_QC:"QC_AMZN",FLIPKART_EGV:"FK_EGV",QUICKCILVER_EGV:"QC_EGV",REWARD_STORE:"REWARD_ST"},inventoryQty:process.env.INVENTORY_QTY?parseInt(process.env.INVENTORY_QTY):1,softlLinkInventoryQty:process.env.SOFTLINK_INVENTORY_QTY?parseInt(process.env.SOFTLINK_INVENTORY_QTY):1,secret_key:process.env.SOFT_LINK_SECRET_KEY||"your-secret-key-here",expiresIn:process.env.SOFT_LINK_TOKEN_EXPIRE_INPUT?parseInt(process.env.SOFT_LINK_TOKEN_EXPIRE_INPUT):24,from_mail:process.env.NOTIFICATION_FROM_MAIL||"noreply@example.com",custom_domain:process.env.CUSTOM_DOMAIN||"https://example.com",max_random_chars:process.env.MAX_RANDOM_CHAR?parseInt(process.env.MAX_RANDOM_CHAR):16,zeus:{base_url:process.env.ZEUS_BASE_URL||"https://zeus-api.example.com",auth:process.env.ZEUS_AUTH||"Bearer your-zeus-token",zeus_api_access:process.env.ZEUS_API_AUTH},defaults:{asset_base_url:process.env.ASSETS_BASE_URL||"https://example.com/assets",auto_logout_time_mins:process.env.AUTO_LOGOUT_TIME_MINS,max_retry_attempts:process.env.MAX_RETRY_ATTEMPTS_FAILED_ORDERS?process.env.MAX_RETRY_ATTEMPTS_FAILED_ORDERS:5},workflows:{base_url:process.env.WORKFLOW_BASE_URL,sd_notifications_auth:process.env.WORKFLOW_AUTH},auth:{extension:process.env.REWARD_LINKS_AUTH,zeus_send_otp_api:process.env.ZEUS_SEND_OTP_AUTH},apiVendorList:process.env.API_VENDOR_LIST};class Mi{constructor(e,t){this.vouchersToInventory=async e=>{try{const t=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,this.accountabilitySchema);return await t.createMany(e)}catch(e){return await(new Vi).jsonError({exception:e,error:"vouchersToInventory Error"},null,null),null}},this.vouchersToSingleInventory=async e=>{try{const t=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,this.accountabilitySchema);return await t.createOne(e)}catch(e){return await(new Vi).jsonError({exception:e,error:"vouchersToInventory Error"},null,null),null}},this.addLog=async(e,t,n,r)=>{try{const a=new this.ItemsService(Li.collection.LOG_TABLE,this.accountabilitySchema);return await a.createMany([{collection_name:e,error:t,reference_id:n,vendor_code:r}])}catch(e){return console.log("addLog",e),null}},this.sd_giftcard_inventory_balance_report=async e=>{try{await(new Vi).log(`vouchers ${e}`,!1,null,null);const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.INVENTORY_BALANCE_REPORT,t);return await n.createOne(e)}catch(e){return await(new Vi).jsonError({exception:e,error:"sd giftcard inventory balance report Error"},null,null),null}},this.vendorCatalogue=async e=>{try{const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.VENDOR_CATALOGUE,t);return await n.createMany(e)}catch(e){return console.log("e",e),await(new Vi).jsonError({exception:e,error:"vouchersToInventory Error"},null,null),null}},this.ItemsService=e,this.accountabilitySchema=t}async addVendorOrder(e,t,n){try{const n=new this.ItemsService(Li.collection.VENDOR_ORDERS,this.accountabilitySchema);return await n.createOne({reference_id:e,vendor:t})}catch(t){return await(new Vi).jsonError({exception:t,error:"addVendorOrder Error"},e,n),null}}async updateVendorOrderStatus(e,t,n,r){try{const r=new this.ItemsService(Li.collection.VENDOR_ORDERS,this.accountabilitySchema);return await r.updateOne(e,{order_status:n,vendor_order_id:t})}catch(t){return await(new Vi).jsonError({exception:t,error:"updateVendorOrderStatus Error"},e,r),null}}async updateVendorOrderReferenceAppend(e,t,n){try{const n=new this.ItemsService(Li.collection.VENDOR_ORDERS,this.accountabilitySchema);return await n.updateOne(e,{reference_append:t})}catch(t){return await(new Vi).jsonError({exception:t,error:"updateVendorOrderReferenceAppend Error"},e,n),null}}async updateVendorOrderByKeys(e,t,n){try{const r=new this.ItemsService(Li.collection.VENDOR_ORDERS,this.accountabilitySchema);return await r.updateOne(e,{order_status:n,vendor_order_id:t})}catch(e){return await(new Vi).jsonError({exception:e,error:"updateVendorOrderStatus Error"},null,null),null}}async updateVendorWalletBalance(e,t){try{const n=new this.ItemsService(Li.collection.VENDOR_DETAILS,this.accountabilitySchema);return await n.updateOne(e,{wallet_balance:t+""})}catch(e){return await(new Vi).jsonError({exception:e,error:"updateVendorWalletBalance Error"},null,null),null}}async updateLinkVoucherStatus(e,t){try{await(new Vi).log("update Link Voucher Status and order id",!1,null,null);const n={...this.accountabilitySchema,accountability:{admin:!0}},r=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,n);return await r.updateOne(e,{gift_card:!0,order_id:t})}catch(e){return await(new Vi).jsonError({exception:e,error:"updateLinkVoucherStatus Error"},null,null),null}}async updateOtp(e,t,n){try{await(new Vi).log("update Otp",!1,null,null);const n={...this.accountabilitySchema,accountability:{admin:!0}},r=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,n);return await r.updateOne(e,{reference_code_otp:t})}catch(e){return await(new Vi).jsonError({exception:e,error:"update Otp Error"},null,null),null}}async updateSoftLinkRedemptionInCampaigns(e,t,n){try{let r=await Ni.post(`${n.CAMPAIGN_BASE_URL}reward-links/webhook/updateredemption`,{link_reference_id:e,soft_link_redemption_id:t},{headers:{Authorization:n.CAMPAIGN_AUTH}});return await(new Vi).log("update Soft Link Redemption Campaigns:",!1,null,null),await(new Vi).log(`updateSoftLinkRedemptionInCampaigns step 10:${e}-${t}`,!1,null,null),r}catch(e){return await(new Vi).error({voucherCodeFromVppError:e},null,null),null}}async referenceupdate(e){try{await(new Vi).log("referenceupdate",!1,null,null);const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,t);return await n.updateOne(e,{reference_code_otp:"",link_reference_id:"",soft_link_order_id:""})}catch(e){return await(new Vi).jsonError({exception:e,error:"reference update Error"},null,null),null}}async softLinkOtpVerificationUpdate(e){try{await(new Vi).log("softLinkOtpVerification"+e,!1,null,null),await(new Vi).log(`softLinkOtpVerificationUpdate:${e}`,!1,null,null);const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,t);return await n.updateOne(e,{soft_link_redeemed_status:!0})}catch(e){return await(new Vi).jsonError({exception:e,error:"updateLinkVoucherStatus Error"},null,null),null}}async updateInventoryPin(e,t){try{const n={...this.accountabilitySchema,accountability:{admin:!0}},r=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,n);return await r.updateOne(e,{pin:t})}catch(e){return await(new Vi).jsonError({exception:e,error:"update Inventory Pin Error"},null,null),null}}async updateVendorCategoryId(e,t){try{const n={...this.accountabilitySchema,accountability:{admin:!0}},r=new this.ItemsService(Li.collection.VENDOR_DETAILS,n);return await r.updateOne(e,{categoryid:t})}catch(e){return await(new Vi).jsonError({exception:e,error:"updateVendorCategoryId Error"},null,null),null}}async updateCheckBalaceStatus(e){try{await(new Vi).log(`updateCheckBalaceStatus ${e}`,!1,null,null);const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,t);return await n.updateOne(e,{card_balance_status:!0})}catch(e){return await(new Vi).jsonError({exception:e,error:"update Check Balace Status"},null,null),null}}async updateBulkQuantityStatus(e,t){try{const n={...this.accountabilitySchema,accountability:{admin:!0}},r=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,n);return await r.updateOne(e,{bulk_qty_status:t})}catch(e){return await(new Vi).jsonError({exception:e,error:"update Inventory bulk_qty_status Error"},null,null),null}}async revalidateCheckBalaceStatus(e,t){try{const n={...this.accountabilitySchema,accountability:{admin:!0}},r=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,n);return await r.updateOne(e,{revalidate_status:!0,validity:t})}catch(e){return await(new Vi).jsonError({exception:e,error:"revalidateCheckBalaceStatus Error"},null,null),null}}async updateLinkBalance(e,t){try{const n={...this.accountabilitySchema,accountability:{admin:!0}},r=new this.ItemsService(Li.collection.REWARD_LINKS_TABLE,n);return await r.updateOne(e,{pending_value:t,status:"redeemed"})}catch(e){return await(new Vi).jsonError({exception:e,error:"updateLinkBalance Error"},null,null),null}}async insertVoucherRedemption(e,t,n,r,a,i,o,s){try{const l={...this.accountabilitySchema,accountability:{admin:!0}},c=new this.ItemsService(Li.collection.LINK_REWARD_REDEMPTIONS_TABLE,l);return await c.createOne({redemption_id:n,brand_sku:t,reward_link:e,link_reference_id:r,reference_code_otp:a,redeemed_mode:i,link_ledger:o,soft_link_token:s})}catch(e){return await(new Vi).jsonError({exception:e,error:"insertVoucherRedemption Error"},null,null),null}}async addTransactionToLedger(e,t,n,r,a,i,o,s,l){try{const c={...this.accountabilitySchema,accountability:{admin:!0}},u=new this.ItemsService(Li.collection.LINK_LEDGER,c);return await u.createOne({reward_link:e,amount:1*t,type:n,reference_id:r,order_status:a,vendor_code:i,link_reference_id:o,reference_code_otp:s,soft_link_token:l})}catch(e){return await(new Vi).jsonError({exception:e,error:"addTransactionToLedger Error"},null,null),null}}async updateLedgerTransactionOrderStatus(e,t,n,r){try{const a={order_status:t};n&&(a.vendor_code=n),r&&(a.message=r);const i={...this.accountabilitySchema,accountability:{admin:!0}},o=new this.ItemsService(Li.collection.LINK_LEDGER,i);return await o.updateOne(e,a)}catch(e){return await(new Vi).jsonError({exception:e,error:"updateLedgerTransactionOrderStatus Error"},null,null),null}}async updateVoucherRedeemed(e,t,n,r,a,i,o,s){try{const l=new this.ItemsService(Li.collection.ZEUS_GIFT_CARD_INVENTORY,this.accountabilitySchema);return(await l.updateOne(e,{order_id:t,gift_card:i,client:n,link_reference_id:r,reference_code_otp:a,soft_link_order_id:o,link_ledger_reference_id:s})).data}catch(e){return await(new Vi).jsonError({exception:e,error:"updateVoucherRedeemed Error"},null,null),null}}async updateBrandLimitationDetails(e,t,n){try{const r={...this.accountabilitySchema,accountability:{admin:!0}},a=new this.ItemsService(Li.collection.USER_BRAND_WISE_REDEMPTIONS,r);return await a.updateOne(e,{monthly_limit_utilized:t,overall_limit_utilized:n})}catch(e){return await(new Vi).jsonError({exception:e,error:"updateBrandLimitationDetailsError Error"},null,null),null}}async insertBrandLimitationDetails(e,t,n,r,a,i){try{const o={...this.accountabilitySchema,accountability:{admin:!0}},s=new this.ItemsService(Li.collection.USER_BRAND_WISE_REDEMPTIONS,o);return await s.createOne({campaign:e,email:t,phone:n,brand_name:r,monthly_limit_utilized:a,overall_limit_utilized:i})}catch(e){return await(new Vi).jsonError({exception:e,error:"insertBrandLimitationDetailsError Error"},null,null),null}}async updateSoftlinkVoucherRedeemedStatus(e,t,n,r,a,i,o,s,l){try{const c={...this.accountabilitySchema,accountability:{admin:!0}},u=new this.ItemsService(Li.collection.ZEUS_GIFT_CARD_INVENTORY,c);return(await u.updateOne(e,{order_id:t,gift_card:i,client:n,link_reference_id:r,reference_code_otp:a,soft_link_order_id:o,link_ledger_reference_id:s,soft_link_redeemed_status:l})).data}catch(e){return await(new Vi).jsonError({exception:e,error:"updateVoucherRedeemedError Error"},null,null),null}}async updateSoftReferenceId(e,t){try{const n={...this.accountabilitySchema,accountability:{admin:!0}},r=new this.ItemsService(Li.collection.LINK_LEDGER,n);return await r.updateOne(e,{reference_id:t})}catch(e){return await(new Vi).jsonError({exception:e,error:"updateSoftReferenceId Error"},null,null),null}}async updateLedgerAttempts(e,t){try{const n={...this.accountabilitySchema,accountability:{admin:!0}},r=new this.ItemsService(Li.collection.LINK_LEDGER,n);return await r.updateOne(e,{attempts:t})}catch(e){return await(new Vi).jsonError({exception:e,error:"updateLedgerAttemptsError Error"},null,null),!1}}}let Fi=null;class Bi{constructor(e,t,n){this.get=null,this.accountabilitySchema=null,this.itemsService=null,this.prependText="",this.log=async(e,t,n,r,a)=>{null==n&&(n=!0);const i=new Mi(this.itemsService,this.accountabilitySchema);await i.addLog(e,JSON.stringify({log:t,info:n?this.prependText:null}),r,a)},this.updateAccountabilitySchema=e=>{this.accountabilitySchema=e},this.accountabilitySchema=t,this.itemsService=e,this.prependText=n}}class Vi{constructor(){this.createLoggerInstance=async(e,t,n)=>{Fi=new Bi(e,t,n)},this.updateAccountabilitySchema=e=>{try{Fi.updateAccountabilitySchema(e)}catch(e){}},this.log=async(e,t,n,r)=>{Fi.log(null,e,t,n,r)},this.error=async(e,t,n)=>{Fi.log(null,e,t,n)},this.jsonError=async(e,t,n)=>{await Fi.log(null,JSON.stringify(e),JSON.stringify(e.exception),t,n)}}}class Ui{constructor(e,t){this.brandDetails=null,this.getBrandFromSKU=async(e,t,n)=>{try{const r=new this.ItemsService(Li.collection.BRAND_DETAILS,this.accountabilitySchema);return(await r.readByQuery({fields:["*.*"],filter:{_and:[{status:{_eq:"active"}},{sku:{sku:{_eq:e}}},{sku:{amount:{_eq:t}}},{sku:{currency:{_eq:n}}}]}}))[0]}catch(e){await(new Vi).jsonError({exception:e,error:"getBrandFromSKU Error"},null,null)}},this.checkBrandStatus=async(e,t,n,r,a)=>{try{const r=await this.getBrandFromSKU(e,t,n);return this.brandDetails=r,!!r}catch(e){await(new Vi).jsonError({exception:e,error:"checkBrandStatus Error"},r,a)}},this.checkSkuAmountMapping=async(e,t)=>{try{const n=this.brandDetails.sku;for(let r=0;r<n.length;r++){const{sku:a,amount:i}=n[r];if(e==a&&t==i)return!0}return!1}catch(e){await(new Vi).jsonError({exception:e,error:"checkSkuAmountMapping Error"},null,null)}},this.bestVendor=async(e,t,n,r,a)=>{try{const r=new this.ItemsService(Li.collection.BRAND_VENDOR_MAPPING,this.accountabilitySchema),a=await r.readByQuery({fields:["*","choose_a_brand.*","choose_a_vendor.*","choose_a_brand.sku.*"],sort:["-discount_percentage","processing_fee"],filter:{_and:[{choose_a_brand:{sku:{sku:{_eq:e}}}},{choose_a_vendor:{vendor_sku:{sd_brand_sku:{sku:{_eq:e}}}}},{choose_a_brand:{sku:{amount:{_eq:t}}}},{choose_a_brand:{status:{_eq:"active"}}},{choose_a_vendor:{vendor_status:{_eq:"active"}}},{choose_a_vendor:{is_api_integrated:{_eq:!0}}},{_or:[{_and:[{denomination:{_eq:"fixed"}},{fixed:{_eq:t}}]},{_and:[{denomination:{_eq:"range"}},{from:{_lte:t}},{to:{_gte:t}}]}]},{currency:{_eq:n}}]}});let i=null;for(let e=0;e<a.length;e++){const t=a[e],{commercial_type:n}=t;"upfront_discount"==n&&(i=t,e=a.length)}if(!i)for(let e=0;e<a.length;e++){const t=a[e],{commercial_type:n}=t;"cashback"==n&&(i=t,e=a.length)}if(!i)for(let e=0;e<a.length;e++){const t=a[e],{commercial_type:n,processing_fee:r}=t;"processing_fee"==n&&(i||(i=t),i&&1*r<1*i.processing_fee&&(i=t))}return i}catch(e){await(new Vi).jsonError({exception:e,error:"bestVendor Error"},r,a)}},this.mappedVendorSKU=async e=>{try{const t=new this.ItemsService(Li.collection.VENDOR_SKU_MAPPING,this.accountabilitySchema);return(await t.readByQuery({fields:["*.*"],limit:1,filter:{sd_brand_sku:{sku:{_eq:e}}}}))[0]}catch(e){await(new Vi).jsonError({exception:e,error:"mappedVendorSKU Error"},null,null)}},this.checkBrandVendorMapping=async(e,t,n,r,a,i)=>{try{const a=new this.ItemsService(Li.collection.BRAND_VENDOR_MAPPING,this.accountabilitySchema),i=await a.readByQuery({fields:["*","choose_a_brand.*","choose_a_vendor.*","choose_a_brand.sku.*"],sort:["-discount_percentage","processing_fee"],filter:{_and:[{choose_a_brand:{sku:{sku:{_eq:e}}}},{choose_a_brand:{sku:{amount:{_eq:t}}}},{choose_a_brand:{status:{_eq:"active"}}},{choose_a_vendor:{vendor_status:{_eq:"active"}}},{choose_a_vendor:{api_integration_id:{_eq:r}}},{_or:[{_and:[{denomination:{_eq:"fixed"}},{fixed:{_eq:t}}]},{_and:[{denomination:{_eq:"range"}},{from:{_lte:t}},{to:{_gte:t}}]}]},{currency:{_eq:n}}]}});let o=null;for(let e=0;e<i.length;e++){const t=i[e],{commercial_type:n}=t;"upfront_discount"==n&&(o=t,e=i.length)}if(!o)for(let e=0;e<i.length;e++){const t=i[e],{commercial_type:n}=t;"cashback"==n&&(o=t,e=i.length)}if(!o)for(let e=0;e<i.length;e++){const t=i[e],{commercial_type:n,processing_fee:r}=t;"processing_fee"==n&&(o||(o=t),o&&1*r<1*o.processing_fee&&(o=t))}return o}catch(e){await(new Vi).jsonError({exception:e,error:"bestVendor Error"},a,i)}},this.mappedVendorActiveBrandSKU=async(e,t,n)=>{try{const n=new this.ItemsService(Li.collection.VENDOR_SKU_MAPPING,this.accountabilitySchema);return(await n.readByQuery({fields:["*.*"],limit:1,filter:{_and:[{sd_brand_sku:{sku:{_eq:e}}},{sd_brand_sku:{brand:{status:{_eq:"active"}}}},{vendor_name:{api_integration_id:{_eq:t}}}]}}))[0]}catch(e){await(new Vi).jsonError({exception:e,error:"mappedVendorSKU Error"},n,t)}},this.voucherCodeList=async e=>{try{const t={...this.accountabilitySchema,accountability:{admin:!0}},n=(new Date).toISOString(),r=new this.ItemsService(Li.collection.ZEUS_GIFT_CARD_INVENTORY,t);return await r.readByQuery({fields:["*"],filter:{_and:[{product_code:{_eq:e}},{gift_card:{_eq:!1}},{validity:{_gte:n}}]}})}catch(e){return await(new Vi).jsonError({exception:e,error:"voucherCodeResponse Error"},null,null),null}},this.ItemsService=e,this.accountabilitySchema=t}async voucherKeysFromInventory(e){try{const t=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,this.accountabilitySchema),n=await t.readByQuery({fields:["id"],filter:{code:{_in:e}}});return n?n.map((e=>e.id)):null}catch(e){return await(new Vi).jsonError({exception:e,error:"voucherKeysFromInventory Error"},null,null),null}}async getBrandSkuMapping(e,t,n){try{const t=new this.ItemsService(Li.collection.BRAND_SKU_MAPPING,this.accountabilitySchema);return(await t.readByQuery({fields:["*","brand.*"],filter:{sku:{_eq:e}}}))[0]}catch(e){return await(new Vi).jsonError({exception:e,error:"getBrandSkuMapping Error"},t,n),null}}async getVendorFromVendorCode(e,t){try{const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.VENDOR_DETAILS,t);return(await n.readByQuery({fields:["*"],filter:{api_integration_id:{_eq:e}}}))[0]}catch(n){return await(new Vi).jsonError({exception:n,error:"getVendorFromVendorCode Error"},t,e),null}}async getVendorOrderFromRef(e,t,n){try{const n=new this.ItemsService(Li.collection.VENDOR_ORDERS,this.accountabilitySchema);return(await n.readByQuery({fields:["*"],filter:{_and:[{reference_id:{_eq:e}},{vendor:{_eq:t}}]}}))[0]}catch(t){return await(new Vi).jsonError({exception:t,error:"getVendorOrderFromRef Error"},e,n),null}}async getVendorTrasanctionDetails(e){try{const t=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,this.accountabilitySchema);return await t.readByQuery({filter:{vendor_order_id:{_eq:e}},fields:["*"],limit:-1})}catch(e){return await(new Vi).jsonError({exception:e,error:"get Trasanction Details Error"},null,null),null}}async getVendorOrderByReferenceId(e,t){try{const t=new this.ItemsService(Li.collection.VENDOR_ORDERS,this.accountabilitySchema);return await t.readByQuery({fields:["*","vendor.*"],filter:{reference_id:{_eq:e}}})}catch(n){return await(new Vi).jsonError({exception:n,error:"getVendorOrderByReferenceId Error"},e,t),null}}async getLinkVoucherDetails(e,t){try{await(new Vi).log("get Link VoucherDetails:",!1,null,null);const n={...this.accountabilitySchema,accountability:{admin:!0}},r=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,n);return await r.readByQuery({fields:["*"],filter:{_and:[{link_reference_id:{_neq:null}},{price:{_eq:t}},{product_code:{_eq:e}},{gift_card:{_eq:!1}}]},limit:1})}catch(e){return await(new Vi).jsonError({exception:e,error:"get Link Voucher Details Query Error"},null,null),null}}async getLinkVoucherDetailsbyorderid(e){try{const t={...this.accountabilitySchema,accountability:{admin:!0}};await(new Vi).log(`get Link order Details:OrderId:${e}`,!1,null,null);const n=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,t);return await n.readByQuery({fields:["*"],filter:{order_id:{_eq:e}}})}catch(e){return await(new Vi).jsonError({exception:e,error:"get Link Voucher Details by orderid query Error"},null,null),null}}async inventoryOtpVerification(e,t){try{const n={...this.accountabilitySchema,accountability:{admin:!0}},r=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,n);return await r.readByQuery({fields:["*"],filter:{_and:[{link_reference_id:{_eq:e}},{reference_code_otp:{_eq:t}}]}})}catch(e){return await(new Vi).jsonError({exception:e,error:"inventory Otp Verification Error"},null,null),null}}async getInventoryByreferance(e,t){try{const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,t);return await n.readByQuery({fields:["*"],filter:{_and:[{link_reference_id:{_eq:e}}]}})}catch(e){return await(new Vi).jsonError({exception:e,error:"inventory Otp Verification Error"},null,null),null}}async getInventoryByorderid(e){try{const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,t);return await n.readByQuery({fields:["*"],filter:{_and:[{order_id:{_eq:e}}]}})}catch(e){return await(new Vi).jsonError({exception:e,error:"inventory Otp Verification Error"},null,null),null}}async getInventoryByid(e){try{const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,t),r=await n.readByQuery({fields:["*"],filter:{_and:[{id:{_eq:e}}]}});return await(new Vi).log("getInventoryByid:",!1,null,null),r}catch(e){return await(new Vi).jsonError({exception:e,error:"inventory Otp Verification Error"},null,null),null}}async getBrandSkuMappingbySku(e){try{const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.BRAND_SKU_MAPPING,t);return(await n.readByQuery({fields:["*","brand.*"],filter:{sku:{_eq:e}}}))[0]}catch(e){return await(new Vi).jsonError({exception:e,error:"getBrandSkuMapping Error"},null,null),null}}async getVoucherFromInventory(e){try{const t=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,this.accountabilitySchema);return await t.readByQuery({fields:["*"],filter:{link_reference_id:{_eq:e}}})}catch(e){return await(new Vi).jsonError({exception:e,error:"voucherKeysFromInventory Error"},null,null),null}}async getVoucherFromInventorybykeys(e){try{const t=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,this.accountabilitySchema);return await t.readByQuery({fields:["id","link_reference_id","reference_code_otp"],filter:{link_reference_id:{_in:e}}})}catch(e){return await(new Vi).jsonError({exception:e,error:"voucherKeysFromInventory Error"},null,null),null}}async getVoucherBySoftLinkId(e){try{const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,t);return await n.readByQuery({fields:["*"],filter:{_and:[{order_id:{_eq:e}}]}})}catch(e){return await(new Vi).jsonError({exception:e,error:"get VoucherBy Soft LinkId"},null,null),null}}async getCampaignRedemptions(e,t){try{let n=await Ni.post(`${t.CAMPAIGN_BASE_URL}reward-links/webhook/getoneredeem`,{link_reference_id:e},{headers:{Authorization:t.CAMPAIGN_AUTH}});return await(new Vi).log(`getCampaignRedemptions link_reference_id:${e}`,!1,null,null),n}catch(e){await(new Vi).error({voucherCodeFromVppError:e},null,null)}}async inventoryRedeemList(e,t,n){try{const r={...this.accountabilitySchema,accountability:{admin:!0}},a=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,r);return await a.readByQuery({fields:["*"],filter:{_and:[{order_id:{_nnull:!0}},{gift_card:{_eq:!0}},{validity:{_between:[e,t]}},{bulk_qty_status:{_eq:!0}},{card_balance_status:{_eq:!1}}]},limit:n})}catch(e){return await(new Vi).jsonError({exception:e,error:"inventoryRedeemList Error"},null,null),null}}async inventoryRedeemListRevlidate(e,t){try{const n=new this.ItemsService(Li.collection.GIFT_CARD_INVENTORY,this.accountabilitySchema);return await n.readByQuery({fields:["*"],filter:{_and:[{created_on:{_gte:e}},{created_on:{_lte:t}},{gift_card:{_eq:!0}}]}})}catch(e){await(new Vi).jsonError({exception:e,error:"inventoryRedeemListRevlidate Error"},null,null)}}async getLinkDetailsFromId(e){try{const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.REWARD_LINKS_TABLE,t);return await n.readByQuery({fields:["*.*","reward_campaign.*","reward_campaign.catalog_sort","reward_campaign.brands.*","reward_campaign.brands.brand_id.*","reward_campaign.new_catalogue.sd_brand_sku_mapping_id.*","reward_campaign.new_catalogue.sd_brand_sku_mapping_id.brand.brand_name","reward_campaign.new_catalogue.sd_brand_sku_mapping_id.brand.brand_image","reward_campaign.new_catalogue.sd_brand_sku_mapping_id.brand.card_color","reward_campaign.new_catalogue.sd_brand_sku_mapping_id.brand.darkmode_card_color","reward_campaign.new_catalogue.sd_brand_sku_mapping_id.brand.brand_purchase_url","redemptions_list.brand_sku.*","reward_campaign.new_catalogue.sd_brand_sku_mapping_id.brand.logo_bg_color","reward_campaign.new_catalogue.sd_brand_sku_mapping_id.brand.terms_and_condition","reward_campaign.new_catalogue.sd_brand_sku_mapping_id.brand.dark_logo_bg_color","reward_campaign.new_catalogue.sd_brand_sku_mapping_id.brand.redemption_process","reward_campaign.company_logo","reward_campaign.other_catalogue_new.sd_brand_sku_mapping_id.*","reward_campaign.other_catalogue_new.sd_brand_sku_mapping_id.brand.*","reward_campaign.other_catalogue_new.sd_brand_sku_mapping_id.brand.is_active_brand","reward_campaign.new_catalogue.sd_brand_sku_mapping_id.brand.is_active_brand","reward_campaign.other_catalogue_new.sd_brand_sku_mapping_id.brand.status","reward_campaign.new_catalogue.sd_brand_sku_mapping_id.brand.status","reward_campaign.brand_limitation.*","reward_campaign.brand_limitation.brand.*","reward_campaign.base_region.id","reward_campaign.base_region.name","reward_campaign.base_region.currency","reward_campaign.base_region.code","reward_campaign.regions.country_id.id","reward_campaign.regions.country_id.name","reward_campaign.regions.country_id.code"],filter:{_and:[{id:{_eq:e}},{reward_campaign:{campaign_type:{_neq:"pdf"}}}]}})}catch(e){return await(new Vi).jsonError({exception:e,error:"getLinkDetailsFromId Error"},null,null),null}}async getSkuBrandMapping(e){try{const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.SKU_BRAND_MAPPING,t);return(await n.readByQuery({fields:["*","brand.brand_image","brand.brand_name","brand.card_color","brand.darkmode_card_color","brand.brand_purchase_url","brand.logo_bg_color","brand.terms_and_condition","brand.dark_logo_bg_color","brand.redemption_process","brand.statuus","brand.region.name","brand.region.code","brand.region.currency","brand.region.id"],filter:{_and:[{sku:{_eq:e}}]}}))[0]}catch(e){return await(new Vi).jsonError({exception:e,error:"getSkuBrandMapping Error"},null,null),null}}async voucherDetails(e){try{const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.SKU_BRAND_MAPPING,t);return(await n.readByQuery({fields:["*","brand.brand_image","brand.brand_name","brand.card_color","brand.darkmode_card_color","brand.brand_purchase_url","brand.logo_bg_color","brand.terms_and_condition","brand.dark_logo_bg_color","brand.redemption_process","brand.status","brand.region.id","brand.region.name","brand.region.code","brand.region.currency"],filter:{_and:[{sku:{_eq:e}}]}}))[0]}catch(e){return await(new Vi).jsonError({exception:e,error:"voucherDetails Error"},null,null),null}}async voucherCode(e){try{const t={...this.accountabilitySchema,accountability:{admin:!0}},n=(new Date).toISOString(),r=new this.ItemsService(Li.collection.ZEUS_GIFT_CARD_INVENTORY,t),a=await r.readByQuery({fields:["*"],filter:{_and:[{product_code:{_eq:e}},{gift_card:{_eq:!1}},{validity:{_gte:n}}]},sort:["date_created"],limit:1});return Array.isArray(a)&&0!==a.length?a[0]:null}catch(e){return await(new Vi).jsonError({exception:e,error:"voucherCode Error"},null,null),null}}async checkRandomChars(e){try{const t=new this.ItemsService(Li.collection.LINK_REWARD_REDEMPTIONS_TABLE,this.accountabilitySchema);return await t.readByQuery({filter:{_and:[{link_reference_id:{_eq:e}}]}})}catch(e){return await(new Vi).jsonError({exception:e,error:"redemptionsFromIdsError Error"},null,null),null}}async voucherCodeFromVpp(e,t,n,r,a,i,o,s,l){try{return(await Ni.post(`${Li.zeus.base_url}/vpp/get-vouchers`,{required_vouchers:[{sku:e,qty:1,amt:t}],options:{redeemed:s,retrieveIfRedeemed:!0,syncOnly:!0,reference_id:r,order_id:n,extra:{client:a},link_reference_id:i,reference_code_otp:o,soft_link_order_id:l}},{headers:{Authorization:Li.zeus.auth}})).data[0]}catch(e){return await(new Vi).jsonError({exception:e,error:"voucherCodeFromVppError Error"},null,null),null}}async placeNewOrderVpp(e,t,n,r,a,i,o,s){try{let l=!0;i&&(t="",l=!1,i="");return(await Ni.post(`${Li.zeus.base_url}/vpp/place-new-order`,{vendor_code:r,reference_id:e,brand_sku:a,quantity:1,options:{redeemed:l,retrieveIfRedeemed:!0,syncOnly:!0,order_id:t,reference_id:e,extra:{client:n},link_reference_id:i,reference_code_otp:o,soft_link_order_id:s}},{headers:{Authorization:Li.zeus.auth}})).data}catch(e){return await(new Vi).jsonError({exception:e,error:"placeNewOrderVppError Error"},null,null),null}}async generateMultipleVoucherCodeFromVpp(e,t,n,r,a,i){try{return(await Ni.post(`${Li.zeus.base_url}/vpp/get-vouchers`,{required_vouchers:[{sku:e,qty:i,amt:t}],options:{redeemed:!1,retrieveIfRedeemed:!0,syncOnly:!0,reference_id:r,order_id:n,extra:{client:a}}},{headers:{Authorization:Li.zeus.auth}})).data[0]}catch(e){return await(new Vi).jsonError({exception:e,error:"voucherCodeFromVppError Error"},null,null),null}}async placeMultipleVoucherNewOrderVpp(e,t,n,r,a,i){try{return(await Ni.post(`${Li.zeus.base_url}/vpp/place-new-order`,{vendor_code:i,reference_id:n,brand_sku:e,quantity:a,options:{redeemed:!1,retrieveIfRedeemed:!0,syncOnly:!0,order_id:t,reference_id:n,extra:{client:r},link_reference_id:"",reference_code_otp:"",soft_link_order_id:""}},{headers:{Authorization:Li.zeus.auth}})).data}catch(e){return await(new Vi).jsonError({exception:e,error:"placeNewOrderVppError Error"},null,null),null}}async getUserBrandWiseRedemptions(e,t,n,r){new Vi;try{t||(t=null),n||(n=null);const a=new this.ItemsService(Li.collection.USER_BRAND_WISE_REDEMPTIONS,this.accountabilitySchema);return await a.readByQuery({filter:{_and:[{campaign:{_eq:e}},{brand_name:{_eq:r}},{_or:[{phone:{_eq:n}},{email:{_eq:t}}]}]},limit:1})}catch(e){return await(new Vi).jsonError({exception:e,error:"getBrandLimitationDetailsResponse Error"},null,null),null}}async softLinkOtpVerification(e,t){try{const n={...this.accountabilitySchema,accountability:{admin:!0}},r=new this.ItemsService(Li.collection.LINK_REWARD_REDEMPTIONS_TABLE,n);return await r.readByQuery({fields:["*","brand_sku.*","brand_sku.brand.terms_and_condition","brand_sku.brand.redemption_process","brand_sku.brand.brand_image","brand_sku.brand.brand_name"],filter:{_and:[{link_reference_id:{_eq:e}},{reference_code_otp:{_eq:t}}]}})}catch(e){return await(new Vi).jsonError({exception:e,error:"softlinkotpverification Error"},null,null),null}}async getZeusVoucherCode(e){try{const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.ZEUS_GIFT_CARD_INVENTORY,t),r=await n.readByQuery({fields:["*"],filter:{_and:[{id:{_eq:e},gift_card:{_eq:!0}}]}});return 0!==r.length&&r[0]}catch(e){return await(new Vi).jsonError({exception:e,error:"getZeusVoucherCode Error"},null,null),null}}async getLinkLedger(e,t){try{const n={...this.accountabilitySchema,accountability:{admin:!0}},r=new this.ItemsService(Li.collection.LINK_LEDGER,n);return await r.readByQuery({fields:["*","reward_link.id","reward_link.reward_campaign.name","reward_link.reward_campaign.voucher_vendor"],filter:{_and:[{link_reference_id:{_eq:e}},{reference_code_otp:{_eq:t}}]}})}catch(e){return await(new Vi).jsonError({exception:e,error:"getLinkLedger Error"},null,null),null}}async getLinkredemptionsFromLedgerId(e){try{const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.LINK_REWARD_REDEMPTIONS_TABLE,t),r=await n.readByQuery({filter:{_and:[{link_ledger:{_eq:e}}]}});return 0!==r.length?r[0]:void 0}catch(e){return await(new Vi).jsonError({exception:e,error:"redemptionsFromIdsError Error"},null,null),null}}async getZeusVoucherCodeByLedgerReferenceId(e){try{const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.ZEUS_GIFT_CARD_INVENTORY,t),r=await n.readByQuery({fields:["*"],filter:{_and:[{order_id:{_eq:e}}]}});return 0!==r.length&&r[0]}catch(e){return await(new Vi).jsonError({exception:e,error:"getZeusVoucherCodeByLedgerReferenceId Error"},null,null),null}}async getLinkredemptionsFromId(e){try{const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.LINK_REWARD_REDEMPTIONS_TABLE,t);return(await n.readByQuery({filter:{_and:[{redemption_id:{_eq:e}}]}}))[0]}catch(e){return await(new Vi).jsonError({exception:e,error:"getLinkredemptionsFromId Error"},null,null),null}}async getVoucherCodeById(e){try{const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.ZEUS_GIFT_CARD_INVENTORY,t);return await n.readByQuery({fields:["*"],filter:{_and:[{id:{_eq:e}}]}})}catch(e){return await(new Vi).jsonError({exception:e,error:"getVoucherCodeById Error"},null,null),null}}async placeNewVoucheForSoftLik(e,t,n,r,a,i,o,s){try{let l=!1;return(await Ni.post(`${Li.zeus.base_url}/vpp/place-new-order`,{vendor_code:r,reference_id:e,brand_sku:a,quantity:1,options:{redeemed:l,retrieveIfRedeemed:!0,syncOnly:!0,order_id:t,reference_id:e,extra:{client:n},link_reference_id:i,reference_code_otp:o,soft_link_order_id:s}},{headers:{Authorization:Li.zeus.auth}})).data}catch(e){return await(new Vi).jsonError({exception:e,error:"placeNewVoucheForSoftLik Error"},null,null),null}}async getAllFailedLinkLedger(){try{const e={...this.accountabilitySchema,accountability:{admin:!0}},t=new this.ItemsService(Li.collection.LINK_LEDGER,e);return await t.readByQuery({fields:["*","reward_link.reward_campaign","reward_link.id","reward_link.reward_campaign.name","reward_link.reward_campaign.delivery_mode"],filter:{_and:[{order_status:{_eq:"failed"},attempts:{_lt:Li.defaults.max_retry_attempts}}]}})}catch(e){return await(new Vi).jsonError({exception:e,error:"getAllFailedLinkLedger Error"},null,null),null}}async getFailedLinkLedgerForLink(e){try{const t={...this.accountabilitySchema,accountability:{admin:!0}},n=new this.ItemsService(Li.collection.LINK_LEDGER,t);return await n.readByQuery({fields:["*","reward_link.reward_campaign","reward_link.id","reward_link.reward_campaign.name","reward_link.reward_campaign.delivery_mode"],filter:{_and:[{order_status:{_eq:"failed"},reward_link:{_eq:e}}]}})}catch(e){return await(new Vi).jsonError({exception:e,error:"getFailedLinkLedgerForLink Error"},null,null),null}}async orderHistoryfromVpp(e,t,n,r,a,i,o,s){try{let l=!0;a&&(l=!1,t="");return(await Ni.post(`${Li.zeus.base_url}/vpp/get-old-vouchers`,{vendor_code:r,reference_id:e,options:{store_to_inventory:!0,redeemed:l,reference_id:e,order_id:t,extra:{client:n},link_reference_id:a,reference_code_otp:i,soft_link_order_id:o,voucherSku:s}},{headers:{Authorization:Li.zeus.auth}})).data}catch(e){return await(new Vi).jsonError({exception:e,error:"orderHistoryfromVpp Error"},null,null),null}}async voucherCodeByOrerId(e,t){try{const n={...this.accountabilitySchema,accountability:{admin:!0}},r=(new Date).toISOString(),a=new this.ItemsService(Li.collection.ZEUS_GIFT_CARD_INVENTORY,n),i=await a.readByQuery({fields:["*"],filter:{_and:[{gift_card:{_eq:!1},product_code:{_eq:e},order_id:{_eq:t},link_reference_id:{_empty:!0},soft_link_order_id:{_empty:!0},validity:{_gt:r}}]},limit:1});return 0!==i.length&&i[0]}catch(e){return await(new Vi).jsonError({exception:e,error:"voucherCodeByOrerId Error"},null,null),!1}}}var Ji={work_advantage:{AUTH_CODE:null,AUTH_CODE_LAST_UPDATED:0},qc_amazon:{AUTH_CODE:null,AUTH_CODE_LAST_UPDATED:0,OAUTH_CODE:null,OAUTH_CODE_LAST_UPDATED:0},quick_silver:{AUTH_CODE:null,AUTH_CODE_LAST_UPDATED:0,OAUTH_CODE:null,OAUTH_CODE_LAST_UPDATED:0}};class Gi{constructor({client_id:e,client_secret:t,redirect_uri:n,authorization:r,base_url:a,place_order_config:i}){this.getAuthCode=async()=>{try{const e=await Ni.get(this.base_url+"/fetch_authorization_code?client_id="+this.client_id+"&client_secret="+this.client_secret+"&redirect_uri="+this.redirect_uri,{headers:{Authorization:this.authorization}}),{success:t,code:n}=e.data;return Ji.work_advantage.AUTH_CODE=n,Ji.work_advantage.AUTH_CODE_LAST_UPDATED=(new Date).getTime(),{code:n}}catch(e){return await(new Vi).jsonError({exception:e,error:"getAuthCode Error"},null,null),{codeException:!0}}},this.getOAuthToken=async(e,t,n)=>{try{return(await Ni.post(this.base_url+"/oauth/token",{client_id:this.client_id,client_secret:this.client_secret,redirect_uri:this.redirect_uri,grant_type:"authorization_code",code:e},{headers:{Authorization:this.authorization}})).data}catch(e){return await(new Vi).jsonError({exception:e,error:"getOAuthToken Error"},t,n),{oAuthException:!0}}},this.getCatalog=async(e,t)=>{try{return(await Ni.get(this.base_url+`/api/v1/catalogs?iso3_code=${t}&page=0&limit=10000000`,{headers:{Authorization:e}})).data}catch(e){return await(new Vi).jsonError({exception:e,error:"getCatalog Error"},null,null),{exception:!0}}},this.placeVouchersOrder=async({qty:e,upc_id:t,access_token:n,referenceId:r,vendor_code:a})=>{try{let i={type:"Web",quantity:e,billing_name:this.place_order_config.billing_name,billing_email:this.place_order_config.billing_email,contact:this.place_order_config.contact,postal_code:this.place_order_config.postal_code,city:this.place_order_config.city,address_line1:this.place_order_config.address_line1,state:this.place_order_config.state,country:this.place_order_config.country,reference_id:r,upc_id:t};await(new Vi).log(`WORK ADVANTAGE Body:${JSON.stringify(i)}`,null,r,a),await(new Vi).log(`WORK ADVANTAGE  access_token:${n}`,null,r,a);const o=await Ni.post(this.base_url+"/external_order_place",null,{params:i,headers:{Authorization:n}});let s=null,l=null,c=!0,u="";try{s=o.data.result.codes,l=o.data.result.order_id}catch(e){c=!1,u=o.data.info}return{vouchers:s,success:c,message:u,orderId:l,vendorCode:a}}catch(e){return await(new Vi).jsonError({exception:e,error:"placeVouchersOrder Error"},r,a),{orderException:!0}}},this.getBalance=async e=>{try{return(await Ni.get(this.base_url+"/balenq",{headers:{Authorization:e}})).data}catch(e){return await(new Vi).jsonError({exception:e,error:"getBalance Error"},null,null),{exception:!0}}},this.getOlderOrderDetails=async(e,t,n)=>{try{const r=await Ni.get("https://secure.workadvantage.in/external_orders",{params:{reference_id:e},headers:{Authorization:t}}),{result:a,message:i}=r.data;let o=null,s=null,l=!0;try{const{codes:e,order_id:t}=a;o=e,s=t}catch(e){l=!1}return{vouchers:o,success:l,message:i||"",orderId:s,vendorCode:n}}catch(t){return await(new Vi).jsonError({exception:t,error:"getOlderOrderDetails Error"},e,n),{oldOrderException:!0}}},this.client_id=e,this.client_secret=t,this.redirect_uri=n,this.authorization=r,this.base_url=a,this.place_order_config=i}}const $i={client_id:process.env.WA_CLIENT_ID,client_secret:process.env.WA_CLIENT_SECRET,redirect_uri:process.env.WA_REDIRECT_URI,authorization:process.env.WA_AUTHORIZATION,base_url:process.env.WA_BASE_URL,place_order_config:{billing_name:process.env.WA_BILLING_NAME,billing_email:process.env.WA_BILLING_EMAIL,contact:process.env.WA_CONTACT,postal_code:process.env.WA_POSTAL_CODE,city:process.env.WA_CITY,address_line1:process.env.WA_ADDRESS_LINE,state:process.env.WA_STATE,country:process.env.WA_COUNTRY,reference_id:process.env.WA_RF_ID},code_validity_time:process.env.WA_AUTH_CODE_VALIDITY_TIME?process.env.WA_AUTH_CODE_VALIDITY_TIME:21600},qi={client_id:process.env.QC_AMZN_CLIENT_ID,username:process.env.QC_AMZN_USERNAME,password:process.env.QC_AMZN_PASSWORD,client_secret:process.env.QC_AMZN_CLIENT_SECRET,authorization:process.env.QC_AMZN_AUTHORIZATION,order_history_retrieval_sleep_time:process.env.QC_AMZN_HISTORY_RETRIEVAL_SLEEP_TIME?process.env.QC_AMZN_HISTORY_RETRIEVAL_SLEEP_TIME:500,base_url:process.env.QC_AMZN_BASE_URL,code_validity_time:process.env.QC_AMZN_AUTH_CODE_VALIDITY_TIME?process.env.QC_AMZN_AUTH_CODE_VALIDITY_TIME:21600,place_order_config:{firstname:process.env.QC_AMZN_FIRSTNAME,lastname:process.env.QC_AMZN_LASTNAME,email:process.env.QC_AMZN_EMAIL,telephone:process.env.QC_AMZN_TELEPHONE,line1:process.env.QC_AMZN_ADR_LINE1,line2:process.env.QC_AMZN_ADR_LINE2,city:process.env.QC_AMZN_CITY,region:process.env.QC_AMZN_REGION,country:process.env.QC_AMZN_COUNTRY,postcode:process.env.QC_AMZN_POSTALCODE,company:process.env.QC_AMZN_COMPANYNAME},error_code:{DUPLICATE_ORDER_ERROR:5313}},zi={client_id:process.env.QUICK_CILVER_CLIENT_ID,username:process.env.QUICK_CILVER_USERNAME,password:process.env.QUICK_CILVER_PASSWORD,client_secret:process.env.QUICK_CILVER_CLIENT_SECRET,authorization:process.env.QUICK_CILVER_AUTHORIZATION,order_history_retrieval_sleep_time:process.env.QUICK_CILVER_HISTORY_RETRIEVAL_SLEEP_TIME?process.env.QUICK_CILVER_HISTORY_RETRIEVAL_SLEEP_TIME:500,base_url:process.env.QUICK_CILVER_BASE_URL,code_validity_time:process.env.QUICK_CILVER_AUTH_CODE_VALIDITY_TIME?process.env.QUICK_CILVER_AUTH_CODE_VALIDITY_TIME:21600,place_order_config:{firstname:process.env.QUICK_CILVER_FIRSTNAME,lastname:process.env.QUICK_CILVER_LASTNAME,email:process.env.QUICK_CILVER_EMAIL,telephone:process.env.QUICK_CILVER_TELEPHONE,line1:process.env.QUICK_CILVER_ADR_LINE1,line2:process.env.QUICK_CILVER_ADR_LINE2,city:process.env.QUICK_CILVER_CITY,region:process.env.QUICK_CILVER_REGION,country:process.env.QUICK_CILVER_COUNTRY,postcode:process.env.QUICK_CILVER_POSTALCODE,company:process.env.QUICK_CILVER_COMPANYNAME},error_code:{DUPLICATE_ORDER_ERROR:5313},cardNumber:process.env.QC_CARDNUMBER};var Wi,Yi={workAdvantageConfig:$i,qcAmazonConfig:qi,flipkartConfig:{headers:{"Content-Type":"application/json;charset=UTF-8","Flipkart-Gifting-Client-Id":process.env.FLIPKART_GIFTING_API_CLIENT_ID,"Flipkart-Gifting-Client-Token":process.env.FLIPKART_GIFTING_API_CLIENT_TOKEN},baseUrl:process.env.FLIPKART_GIFTING_BASE_URL},quickcilverConfig:zi,rewardStoreConfig:{base_url:process.env.REWARD_ST_BASE_URL,client_id:process.env.REWARD_ST_CLIENT_ID,client_secret:process.env.REWARD_ST_CLIENT_SECRET}},Hi={exports:{}},Qi={exports:{}};Qi.exports=(Wi=Wi||function(e,t){var n;if("undefined"!=typeof window&&window.crypto&&(n=window.crypto),"undefined"!=typeof self&&self.crypto&&(n=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(n=globalThis.crypto),!n&&"undefined"!=typeof window&&window.msCrypto&&(n=window.msCrypto),!n&&void 0!==X&&X.crypto&&(n=X.crypto),!n)try{n=require("crypto")}catch(e){}var r=function(){if(n){if("function"==typeof n.getRandomValues)try{return n.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof n.randomBytes)try{return n.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),i={},o=i.lib={},s=o.Base={extend:function(e){var t=a(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=o.WordArray=s.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,a=e.sigBytes;if(this.clamp(),r%4)for(var i=0;i<a;i++){var o=n[i>>>2]>>>24-i%4*8&255;t[r+i>>>2]|=o<<24-(r+i)%4*8}else for(var s=0;s<a;s+=4)t[r+s>>>2]=n[s>>>2];return this.sigBytes+=a,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(r());return new l.init(t,e)}}),c=i.enc={},u=c.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],a=0;a<n;a++){var i=t[a>>>2]>>>24-a%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new l.init(n,t/2)}},d=c.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],a=0;a<n;a++){var i=t[a>>>2]>>>24-a%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new l.init(n,t)}},p=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},h=o.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,a=r.words,i=r.sigBytes,o=this.blockSize,s=i/(4*o),c=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*o,u=e.min(4*c,i);if(c){for(var d=0;d<c;d+=o)this._doProcessBlock(a,d);n=a.splice(0,c),r.sigBytes-=u}return new l.init(n,u)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});o.Hasher=h.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new m.HMAC.init(e,n).finalize(t)}}});var m=i.algo={};return i}(Math),Wi);var Zi={exports:{}};Zi.exports=function(e){return function(t){var n=e,r=n.lib,a=r.Base,i=r.WordArray,o=n.x64={};o.Word=a.extend({init:function(e,t){this.high=e,this.low=t}}),o.WordArray=a.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],r=0;r<t;r++){var a=e[r];n.push(a.high),n.push(a.low)}return i.create(n,this.sigBytes)},clone:function(){for(var e=a.clone.call(this),t=e.words=this.words.slice(0),n=t.length,r=0;r<n;r++)t[r]=t[r].clone();return e}})}(),e}(Qi.exports);var Xi={exports:{}};Xi.exports=function(e){return function(){var t=e,n=t.lib.Hasher,r=t.x64,a=r.Word,i=r.WordArray,o=t.algo;function s(){return a.create.apply(a,arguments)}var l=[s(1116352408,3609767458),s(1899447441,602891725),s(3049323471,3964484399),s(3921009573,2173295548),s(961987163,4081628472),s(1508970993,3053834265),s(2453635748,2937671579),s(2870763221,3664609560),s(3624381080,2734883394),s(310598401,1164996542),s(607225278,1323610764),s(1426881987,3590304994),s(1925078388,4068182383),s(2162078206,991336113),s(2614888103,633803317),s(3248222580,3479774868),s(3835390401,2666613458),s(4022224774,944711139),s(264347078,2341262773),s(604807628,2007800933),s(770255983,1495990901),s(1249150122,1856431235),s(1555081692,3175218132),s(1996064986,2198950837),s(2554220882,3999719339),s(2821834349,766784016),s(2952996808,2566594879),s(3210313671,3203337956),s(3336571891,1034457026),s(3584528711,2466948901),s(113926993,3758326383),s(338241895,168717936),s(666307205,1188179964),s(773529912,1546045734),s(1294757372,1522805485),s(1396182291,2643833823),s(1695183700,2343527390),s(1986661051,1014477480),s(2177026350,1206759142),s(2456956037,344077627),s(2730485921,1290863460),s(2820302411,3158454273),s(3259730800,3505952657),s(3345764771,106217008),s(3516065817,3606008344),s(3600352804,1432725776),s(4094571909,1467031594),s(275423344,851169720),s(430227734,3100823752),s(506948616,1363258195),s(659060556,3750685593),s(883997877,3785050280),s(958139571,3318307427),s(1322822218,3812723403),s(1537002063,2003034995),s(1747873779,3602036899),s(1955562222,1575990012),s(2024104815,1125592928),s(2227730452,2716904306),s(2361852424,442776044),s(2428436474,593698344),s(2756734187,3733110249),s(3204031479,2999351573),s(3329325298,3815920427),s(3391569614,3928383900),s(3515267271,566280711),s(3940187606,3454069534),s(4118630271,4000239992),s(116418474,1914138554),s(174292421,2731055270),s(289380356,3203993006),s(460393269,320620315),s(685471733,587496836),s(852142971,1086792851),s(1017036298,365543100),s(1126000580,2618297676),s(1288033470,3409855158),s(1501505948,4234509866),s(1607167915,987167468),s(1816402316,1246189591)],c=[];!function(){for(var e=0;e<80;e++)c[e]=s()}();var u=o.SHA512=n.extend({_doReset:function(){this._hash=new i.init([new a.init(1779033703,4089235720),new a.init(3144134277,2227873595),new a.init(1013904242,4271175723),new a.init(2773480762,1595750129),new a.init(1359893119,2917565137),new a.init(2600822924,725511199),new a.init(528734635,4215389547),new a.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],a=n[1],i=n[2],o=n[3],s=n[4],u=n[5],d=n[6],p=n[7],h=r.high,m=r.low,f=a.high,y=a.low,g=i.high,b=i.low,v=o.high,w=o.low,S=s.high,E=s.low,x=u.high,_=u.low,k=d.high,I=d.low,T=p.high,A=p.low,O=h,K=m,C=f,R=y,j=g,P=b,D=v,N=w,L=S,M=E,F=x,B=_,V=k,U=I,J=T,G=A,$=0;$<80;$++){var q,z,W=c[$];if($<16)z=W.high=0|e[t+2*$],q=W.low=0|e[t+2*$+1];else{var Y=c[$-15],H=Y.high,Q=Y.low,Z=(H>>>1|Q<<31)^(H>>>8|Q<<24)^H>>>7,X=(Q>>>1|H<<31)^(Q>>>8|H<<24)^(Q>>>7|H<<25),ee=c[$-2],te=ee.high,ne=ee.low,re=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,ae=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),ie=c[$-7],oe=ie.high,se=ie.low,le=c[$-16],ce=le.high,ue=le.low;z=(z=(z=Z+oe+((q=X+se)>>>0<X>>>0?1:0))+re+((q+=ae)>>>0<ae>>>0?1:0))+ce+((q+=ue)>>>0<ue>>>0?1:0),W.high=z,W.low=q}var de,pe=L&F^~L&V,he=M&B^~M&U,me=O&C^O&j^C&j,fe=K&R^K&P^R&P,ye=(O>>>28|K<<4)^(O<<30|K>>>2)^(O<<25|K>>>7),ge=(K>>>28|O<<4)^(K<<30|O>>>2)^(K<<25|O>>>7),be=(L>>>14|M<<18)^(L>>>18|M<<14)^(L<<23|M>>>9),ve=(M>>>14|L<<18)^(M>>>18|L<<14)^(M<<23|L>>>9),we=l[$],Se=we.high,Ee=we.low,xe=J+be+((de=G+ve)>>>0<G>>>0?1:0),_e=ge+fe;J=V,G=U,V=F,U=B,F=L,B=M,L=D+(xe=(xe=(xe=xe+pe+((de+=he)>>>0<he>>>0?1:0))+Se+((de+=Ee)>>>0<Ee>>>0?1:0))+z+((de+=q)>>>0<q>>>0?1:0))+((M=N+de|0)>>>0<N>>>0?1:0)|0,D=j,N=P,j=C,P=R,C=O,R=K,O=xe+(ye+me+(_e>>>0<ge>>>0?1:0))+((K=de+_e|0)>>>0<de>>>0?1:0)|0}m=r.low=m+K,r.high=h+O+(m>>>0<K>>>0?1:0),y=a.low=y+R,a.high=f+C+(y>>>0<R>>>0?1:0),b=i.low=b+P,i.high=g+j+(b>>>0<P>>>0?1:0),w=o.low=w+N,o.high=v+D+(w>>>0<N>>>0?1:0),E=s.low=E+M,s.high=S+L+(E>>>0<M>>>0?1:0),_=u.low=_+B,u.high=x+F+(_>>>0<B>>>0?1:0),I=d.low=I+U,d.high=k+V+(I>>>0<U>>>0?1:0),A=p.low=A+G,p.high=T+J+(A>>>0<G>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[30+(r+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(r+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});t.SHA512=n._createHelper(u),t.HmacSHA512=n._createHmacHelper(u)}(),e.SHA512}(Qi.exports);var eo={exports:{}};eo.exports=function(e){var t,n,r;n=(t=e).lib.Base,r=t.enc.Utf8,t.algo.HMAC=n.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=r.parse(t));var n=e.blockSize,a=4*n;t.sigBytes>a&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),o=this._iKey=t.clone(),s=i.words,l=o.words,c=0;c<n;c++)s[c]^=1549556828,l[c]^=909522486;i.sigBytes=o.sigBytes=a,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})}(Qi.exports);var to=Hi.exports=function(e){return e.HmacSHA512}(Qi.exports);var no={exports:{}};!function(e){const t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol:e=>`Symbol(${e})`;function n(){}function r(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==X?X:void 0}const a=r();function i(e){return"object"==typeof e&&null!==e||"function"==typeof e}const o=n,s=Promise,l=Promise.prototype.then,c=Promise.resolve.bind(s),u=Promise.reject.bind(s);function d(e){return new s(e)}function p(e){return c(e)}function h(e){return u(e)}function m(e,t,n){return l.call(e,t,n)}function f(e,t,n){m(m(e,t,n),void 0,o)}function y(e,t){f(e,t)}function g(e,t){f(e,void 0,t)}function b(e,t,n){return m(e,t,n)}function v(e){m(e,void 0,o)}const w=(()=>{const e=a&&a.queueMicrotask;if("function"==typeof e)return e;const t=p(void 0);return e=>m(t,e)})();function S(e,t,n){if("function"!=typeof e)throw new TypeError("Argument is not a function");return Function.prototype.apply.call(e,t,n)}function E(e,t,n){try{return p(S(e,t,n))}catch(e){return h(e)}}const x=16384;class _{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(e){const t=this._back;let n=t;t._elements.length===x-1&&(n={_elements:[],_next:void 0}),t._elements.push(e),n!==t&&(this._back=n,t._next=n),++this._size}shift(){const e=this._front;let t=e;const n=this._cursor;let r=n+1;const a=e._elements,i=a[n];return r===x&&(t=e._next,r=0),--this._size,this._cursor=r,e!==t&&(this._front=t),a[n]=void 0,i}forEach(e){let t=this._cursor,n=this._front,r=n._elements;for(;!(t===r.length&&void 0===n._next||t===r.length&&(n=n._next,r=n._elements,t=0,0===r.length));)e(r[t]),++t}peek(){const e=this._front,t=this._cursor;return e._elements[t]}}function k(e,t){e._ownerReadableStream=t,t._reader=e,"readable"===t._state?O(e):"closed"===t._state?C(e):K(e,t._storedError)}function I(e,t){return kr(e._ownerReadableStream,t)}function T(e){"readable"===e._ownerReadableStream._state?R(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):j(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),e._ownerReadableStream._reader=void 0,e._ownerReadableStream=void 0}function A(e){return new TypeError("Cannot "+e+" a stream using a released reader")}function O(e){e._closedPromise=d(((t,n)=>{e._closedPromise_resolve=t,e._closedPromise_reject=n}))}function K(e,t){O(e),R(e,t)}function C(e){O(e),P(e)}function R(e,t){void 0!==e._closedPromise_reject&&(v(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}function j(e,t){K(e,t)}function P(e){void 0!==e._closedPromise_resolve&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}const D=t("[[AbortSteps]]"),N=t("[[ErrorSteps]]"),L=t("[[CancelSteps]]"),M=t("[[PullSteps]]"),F=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},B=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};function V(e){return"object"==typeof e||"function"==typeof e}function U(e,t){if(void 0!==e&&!V(e))throw new TypeError(`${t} is not an object.`)}function J(e,t){if("function"!=typeof e)throw new TypeError(`${t} is not a function.`)}function G(e){return"object"==typeof e&&null!==e||"function"==typeof e}function $(e,t){if(!G(e))throw new TypeError(`${t} is not an object.`)}function q(e,t,n){if(void 0===e)throw new TypeError(`Parameter ${t} is required in '${n}'.`)}function z(e,t,n){if(void 0===e)throw new TypeError(`${t} is required in '${n}'.`)}function W(e){return Number(e)}function Y(e){return 0===e?0:e}function H(e){return Y(B(e))}function Q(e,t){const n=0,r=Number.MAX_SAFE_INTEGER;let a=Number(e);if(a=Y(a),!F(a))throw new TypeError(`${t} is not a finite number`);if(a=H(a),a<n||a>r)throw new TypeError(`${t} is outside the accepted range of ${n} to ${r}, inclusive`);return F(a)&&0!==a?a:0}function Z(e,t){if(!xr(e))throw new TypeError(`${t} is not a ReadableStream.`)}function ee(e){return new ie(e)}function te(e,t){e._reader._readRequests.push(t)}function ne(e,t,n){const r=e._reader._readRequests.shift();n?r._closeSteps():r._chunkSteps(t)}function re(e){return e._reader._readRequests.length}function ae(e){const t=e._reader;return void 0!==t&&!!oe(t)}class ie{constructor(e){if(q(e,1,"ReadableStreamDefaultReader"),Z(e,"First parameter"),_r(e))throw new TypeError("This stream has already been locked for exclusive reading by another reader");k(this,e),this._readRequests=new _}get closed(){return oe(this)?this._closedPromise:h(le("closed"))}cancel(e){return oe(this)?void 0===this._ownerReadableStream?h(A("cancel")):I(this,e):h(le("cancel"))}read(){if(!oe(this))return h(le("read"));if(void 0===this._ownerReadableStream)return h(A("read from"));let e,t;const n=d(((n,r)=>{e=n,t=r})),r={_chunkSteps:t=>e({value:t,done:!1}),_closeSteps:()=>e({value:void 0,done:!0}),_errorSteps:e=>t(e)};return se(this,r),n}releaseLock(){if(!oe(this))throw le("releaseLock");if(void 0!==this._ownerReadableStream){if(this._readRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");T(this)}}}function oe(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readRequests")&&e instanceof ie}function se(e,t){const n=e._ownerReadableStream;n._disturbed=!0,"closed"===n._state?t._closeSteps():"errored"===n._state?t._errorSteps(n._storedError):n._readableStreamController[M](t)}function le(e){return new TypeError(`ReadableStreamDefaultReader.prototype.${e} can only be used on a ReadableStreamDefaultReader`)}Object.defineProperties(ie.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(ie.prototype,t.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});const ce=Object.getPrototypeOf(Object.getPrototypeOf((async function*(){})).prototype);class ue{constructor(e,t){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=e,this._preventCancel=t}next(){const e=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?b(this._ongoingPromise,e,e):e(),this._ongoingPromise}return(e){const t=()=>this._returnSteps(e);return this._ongoingPromise?b(this._ongoingPromise,t,t):t()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});const e=this._reader;if(void 0===e._ownerReadableStream)return h(A("iterate"));let t,n;const r=d(((e,r)=>{t=e,n=r}));return se(e,{_chunkSteps:e=>{this._ongoingPromise=void 0,w((()=>t({value:e,done:!1})))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,T(e),t({value:void 0,done:!0})},_errorSteps:t=>{this._ongoingPromise=void 0,this._isFinished=!0,T(e),n(t)}}),r}_returnSteps(e){if(this._isFinished)return Promise.resolve({value:e,done:!0});this._isFinished=!0;const t=this._reader;if(void 0===t._ownerReadableStream)return h(A("finish iterating"));if(!this._preventCancel){const n=I(t,e);return T(t),b(n,(()=>({value:e,done:!0})))}return T(t),p({value:e,done:!0})}}const de={next(){return he(this)?this._asyncIteratorImpl.next():h(me("next"))},return(e){return he(this)?this._asyncIteratorImpl.return(e):h(me("return"))}};function pe(e,t){const n=ee(e),r=new ue(n,t),a=Object.create(de);return a._asyncIteratorImpl=r,a}function he(e){if(!i(e))return!1;if(!Object.prototype.hasOwnProperty.call(e,"_asyncIteratorImpl"))return!1;try{return e._asyncIteratorImpl instanceof ue}catch(e){return!1}}function me(e){return new TypeError(`ReadableStreamAsyncIterator.${e} can only be used on a ReadableSteamAsyncIterator`)}void 0!==ce&&Object.setPrototypeOf(de,ce);const fe=Number.isNaN||function(e){return e!=e};function ye(e){return e.slice()}function ge(e,t,n,r,a){new Uint8Array(e).set(new Uint8Array(n,r,a),t)}function be(e){return e}function ve(e){return!1}function we(e,t,n){if(e.slice)return e.slice(t,n);const r=n-t,a=new ArrayBuffer(r);return ge(a,0,e,t,r),a}function Se(e){return!("number"!=typeof e||fe(e)||e<0)}function Ee(e){const t=we(e.buffer,e.byteOffset,e.byteOffset+e.byteLength);return new Uint8Array(t)}function xe(e){const t=e._queue.shift();return e._queueTotalSize-=t.size,e._queueTotalSize<0&&(e._queueTotalSize=0),t.value}function _e(e,t,n){if(!Se(n)||n===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");e._queue.push({value:t,size:n}),e._queueTotalSize+=n}function ke(e){return e._queue.peek().value}function Ie(e){e._queue=new _,e._queueTotalSize=0}class Te{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!Ke(this))throw at("view");return this._view}respond(e){if(!Ke(this))throw at("respond");if(q(e,1,"respond"),e=Q(e,"First parameter"),void 0===this._associatedReadableByteStreamController)throw new TypeError("This BYOB request has been invalidated");ve(this._view.buffer),Xe(this._associatedReadableByteStreamController,e)}respondWithNewView(e){if(!Ke(this))throw at("respondWithNewView");if(q(e,1,"respondWithNewView"),!ArrayBuffer.isView(e))throw new TypeError("You can only respond with array buffer views");if(void 0===this._associatedReadableByteStreamController)throw new TypeError("This BYOB request has been invalidated");ve(e.buffer),et(this._associatedReadableByteStreamController,e)}}Object.defineProperties(Te.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(Te.prototype,t.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class Ae{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!Oe(this))throw it("byobRequest");return Qe(this)}get desiredSize(){if(!Oe(this))throw it("desiredSize");return Ze(this)}close(){if(!Oe(this))throw it("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");const e=this._controlledReadableByteStream._state;if("readable"!==e)throw new TypeError(`The stream (in ${e} state) is not in the readable state and cannot be closed`);We(this)}enqueue(e){if(!Oe(this))throw it("enqueue");if(q(e,1,"enqueue"),!ArrayBuffer.isView(e))throw new TypeError("chunk must be an array buffer view");if(0===e.byteLength)throw new TypeError("chunk must have non-zero byteLength");if(0===e.buffer.byteLength)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");const t=this._controlledReadableByteStream._state;if("readable"!==t)throw new TypeError(`The stream (in ${t} state) is not in the readable state and cannot be enqueued to`);Ye(this,e)}error(e){if(!Oe(this))throw it("error");He(this,e)}[L](e){Re(this),Ie(this);const t=this._cancelAlgorithm(e);return ze(this),t}[M](e){const t=this._controlledReadableByteStream;if(this._queueTotalSize>0){const t=this._queue.shift();this._queueTotalSize-=t.byteLength,Me(this);const n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);return void e._chunkSteps(n)}const n=this._autoAllocateChunkSize;if(void 0!==n){let t;try{t=new ArrayBuffer(n)}catch(t){return void e._errorSteps(t)}const r={buffer:t,bufferByteLength:n,byteOffset:0,byteLength:n,bytesFilled:0,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(r)}te(t,e),Ce(this)}}function Oe(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream")&&e instanceof Ae}function Ke(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController")&&e instanceof Te}function Ce(e){qe(e)&&(e._pulling?e._pullAgain=!0:(e._pulling=!0,f(e._pullAlgorithm(),(()=>{e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,Ce(e))}),(t=>{He(e,t)}))))}function Re(e){Fe(e),e._pendingPullIntos=new _}function je(e,t){let n=!1;"closed"===e._state&&(n=!0);const r=Pe(t);"default"===t.readerType?ne(e,r,n):lt(e,r,n)}function Pe(e){const t=e.bytesFilled,n=e.elementSize;return new e.viewConstructor(e.buffer,e.byteOffset,t/n)}function De(e,t,n,r){e._queue.push({buffer:t,byteOffset:n,byteLength:r}),e._queueTotalSize+=r}function Ne(e,t){const n=t.elementSize,r=t.bytesFilled-t.bytesFilled%n,a=Math.min(e._queueTotalSize,t.byteLength-t.bytesFilled),i=t.bytesFilled+a,o=i-i%n;let s=a,l=!1;o>r&&(s=o-t.bytesFilled,l=!0);const c=e._queue;for(;s>0;){const n=c.peek(),r=Math.min(s,n.byteLength),a=t.byteOffset+t.bytesFilled;ge(t.buffer,a,n.buffer,n.byteOffset,r),n.byteLength===r?c.shift():(n.byteOffset+=r,n.byteLength-=r),e._queueTotalSize-=r,Le(e,r,t),s-=r}return l}function Le(e,t,n){n.bytesFilled+=t}function Me(e){0===e._queueTotalSize&&e._closeRequested?(ze(e),Ir(e._controlledReadableByteStream)):Ce(e)}function Fe(e){null!==e._byobRequest&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=null,e._byobRequest=null)}function Be(e){for(;e._pendingPullIntos.length>0;){if(0===e._queueTotalSize)return;const t=e._pendingPullIntos.peek();Ne(e,t)&&($e(e),je(e._controlledReadableByteStream,t))}}function Ve(e,t,n){const r=e._controlledReadableByteStream;let a=1;t.constructor!==DataView&&(a=t.constructor.BYTES_PER_ELEMENT);const i=t.constructor,o=be(t.buffer),s={buffer:o,bufferByteLength:o.byteLength,byteOffset:t.byteOffset,byteLength:t.byteLength,bytesFilled:0,elementSize:a,viewConstructor:i,readerType:"byob"};if(e._pendingPullIntos.length>0)return e._pendingPullIntos.push(s),void st(r,n);if("closed"!==r._state){if(e._queueTotalSize>0){if(Ne(e,s)){const t=Pe(s);return Me(e),void n._chunkSteps(t)}if(e._closeRequested){const t=new TypeError("Insufficient bytes to fill elements in the given buffer");return He(e,t),void n._errorSteps(t)}}e._pendingPullIntos.push(s),st(r,n),Ce(e)}else{const e=new i(s.buffer,s.byteOffset,0);n._closeSteps(e)}}function Ue(e,t){const n=e._controlledReadableByteStream;if(ut(n))for(;ct(n)>0;)je(n,$e(e))}function Je(e,t,n){if(Le(e,t,n),n.bytesFilled<n.elementSize)return;$e(e);const r=n.bytesFilled%n.elementSize;if(r>0){const t=n.byteOffset+n.bytesFilled,a=we(n.buffer,t-r,t);De(e,a,0,a.byteLength)}n.bytesFilled-=r,je(e._controlledReadableByteStream,n),Be(e)}function Ge(e,t){const n=e._pendingPullIntos.peek();Fe(e),"closed"===e._controlledReadableByteStream._state?Ue(e):Je(e,t,n),Ce(e)}function $e(e){return e._pendingPullIntos.shift()}function qe(e){const t=e._controlledReadableByteStream;return"readable"===t._state&&!e._closeRequested&&!!e._started&&(!!(ae(t)&&re(t)>0)||!!(ut(t)&&ct(t)>0)||Ze(e)>0)}function ze(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function We(e){const t=e._controlledReadableByteStream;if(!e._closeRequested&&"readable"===t._state)if(e._queueTotalSize>0)e._closeRequested=!0;else{if(e._pendingPullIntos.length>0&&e._pendingPullIntos.peek().bytesFilled>0){const t=new TypeError("Insufficient bytes to fill elements in the given buffer");throw He(e,t),t}ze(e),Ir(t)}}function Ye(e,t){const n=e._controlledReadableByteStream;if(e._closeRequested||"readable"!==n._state)return;const r=t.buffer,a=t.byteOffset,i=t.byteLength,o=be(r);if(e._pendingPullIntos.length>0){const t=e._pendingPullIntos.peek();ve(t.buffer),t.buffer=be(t.buffer)}Fe(e),ae(n)?0===re(n)?De(e,o,a,i):(e._pendingPullIntos.length>0&&$e(e),ne(n,new Uint8Array(o,a,i),!1)):ut(n)?(De(e,o,a,i),Be(e)):De(e,o,a,i),Ce(e)}function He(e,t){const n=e._controlledReadableByteStream;"readable"===n._state&&(Re(e),Ie(e),ze(e),Tr(n,t))}function Qe(e){if(null===e._byobRequest&&e._pendingPullIntos.length>0){const t=e._pendingPullIntos.peek(),n=new Uint8Array(t.buffer,t.byteOffset+t.bytesFilled,t.byteLength-t.bytesFilled),r=Object.create(Te.prototype);rt(r,e,n),e._byobRequest=r}return e._byobRequest}function Ze(e){const t=e._controlledReadableByteStream._state;return"errored"===t?null:"closed"===t?0:e._strategyHWM-e._queueTotalSize}function Xe(e,t){const n=e._pendingPullIntos.peek();if("closed"===e._controlledReadableByteStream._state){if(0!==t)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(0===t)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(n.bytesFilled+t>n.byteLength)throw new RangeError("bytesWritten out of range")}n.buffer=be(n.buffer),Ge(e,t)}function et(e,t){const n=e._pendingPullIntos.peek();if("closed"===e._controlledReadableByteStream._state){if(0!==t.byteLength)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(0===t.byteLength)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(n.byteOffset+n.bytesFilled!==t.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(n.bufferByteLength!==t.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(n.bytesFilled+t.byteLength>n.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");const r=t.byteLength;n.buffer=be(t.buffer),Ge(e,r)}function tt(e,t,n,r,a,i,o){t._controlledReadableByteStream=e,t._pullAgain=!1,t._pulling=!1,t._byobRequest=null,t._queue=t._queueTotalSize=void 0,Ie(t),t._closeRequested=!1,t._started=!1,t._strategyHWM=i,t._pullAlgorithm=r,t._cancelAlgorithm=a,t._autoAllocateChunkSize=o,t._pendingPullIntos=new _,e._readableStreamController=t,f(p(n()),(()=>{t._started=!0,Ce(t)}),(e=>{He(t,e)}))}function nt(e,t,n){const r=Object.create(Ae.prototype);let a=()=>{},i=()=>p(void 0),o=()=>p(void 0);void 0!==t.start&&(a=()=>t.start(r)),void 0!==t.pull&&(i=()=>t.pull(r)),void 0!==t.cancel&&(o=e=>t.cancel(e));const s=t.autoAllocateChunkSize;if(0===s)throw new TypeError("autoAllocateChunkSize must be greater than 0");tt(e,r,a,i,o,n,s)}function rt(e,t,n){e._associatedReadableByteStreamController=t,e._view=n}function at(e){return new TypeError(`ReadableStreamBYOBRequest.prototype.${e} can only be used on a ReadableStreamBYOBRequest`)}function it(e){return new TypeError(`ReadableByteStreamController.prototype.${e} can only be used on a ReadableByteStreamController`)}function ot(e){return new dt(e)}function st(e,t){e._reader._readIntoRequests.push(t)}function lt(e,t,n){const r=e._reader._readIntoRequests.shift();n?r._closeSteps(t):r._chunkSteps(t)}function ct(e){return e._reader._readIntoRequests.length}function ut(e){const t=e._reader;return void 0!==t&&!!pt(t)}Object.defineProperties(Ae.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(Ae.prototype,t.toStringTag,{value:"ReadableByteStreamController",configurable:!0});class dt{constructor(e){if(q(e,1,"ReadableStreamBYOBReader"),Z(e,"First parameter"),_r(e))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!Oe(e._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");k(this,e),this._readIntoRequests=new _}get closed(){return pt(this)?this._closedPromise:h(mt("closed"))}cancel(e){return pt(this)?void 0===this._ownerReadableStream?h(A("cancel")):I(this,e):h(mt("cancel"))}read(e){if(!pt(this))return h(mt("read"));if(!ArrayBuffer.isView(e))return h(new TypeError("view must be an array buffer view"));if(0===e.byteLength)return h(new TypeError("view must have non-zero byteLength"));if(0===e.buffer.byteLength)return h(new TypeError("view's buffer must have non-zero byteLength"));if(ve(e.buffer),void 0===this._ownerReadableStream)return h(A("read from"));let t,n;const r=d(((e,r)=>{t=e,n=r})),a={_chunkSteps:e=>t({value:e,done:!1}),_closeSteps:e=>t({value:e,done:!0}),_errorSteps:e=>n(e)};return ht(this,e,a),r}releaseLock(){if(!pt(this))throw mt("releaseLock");if(void 0!==this._ownerReadableStream){if(this._readIntoRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");T(this)}}}function pt(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readIntoRequests")&&e instanceof dt}function ht(e,t,n){const r=e._ownerReadableStream;r._disturbed=!0,"errored"===r._state?n._errorSteps(r._storedError):Ve(r._readableStreamController,t,n)}function mt(e){return new TypeError(`ReadableStreamBYOBReader.prototype.${e} can only be used on a ReadableStreamBYOBReader`)}function ft(e,t){const{highWaterMark:n}=e;if(void 0===n)return t;if(fe(n)||n<0)throw new RangeError("Invalid highWaterMark");return n}function yt(e){const{size:t}=e;return t||(()=>1)}function gt(e,t){U(e,t);const n=null==e?void 0:e.highWaterMark,r=null==e?void 0:e.size;return{highWaterMark:void 0===n?void 0:W(n),size:void 0===r?void 0:bt(r,`${t} has member 'size' that`)}}function bt(e,t){return J(e,t),t=>W(e(t))}function vt(e,t){U(e,t);const n=null==e?void 0:e.abort,r=null==e?void 0:e.close,a=null==e?void 0:e.start,i=null==e?void 0:e.type,o=null==e?void 0:e.write;return{abort:void 0===n?void 0:wt(n,e,`${t} has member 'abort' that`),close:void 0===r?void 0:St(r,e,`${t} has member 'close' that`),start:void 0===a?void 0:Et(a,e,`${t} has member 'start' that`),write:void 0===o?void 0:xt(o,e,`${t} has member 'write' that`),type:i}}function wt(e,t,n){return J(e,n),n=>E(e,t,[n])}function St(e,t,n){return J(e,n),()=>E(e,t,[])}function Et(e,t,n){return J(e,n),n=>S(e,t,[n])}function xt(e,t,n){return J(e,n),(n,r)=>E(e,t,[n,r])}function _t(e,t){if(!Rt(e))throw new TypeError(`${t} is not a WritableStream.`)}function kt(e){if("object"!=typeof e||null===e)return!1;try{return"boolean"==typeof e.aborted}catch(e){return!1}}Object.defineProperties(dt.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(dt.prototype,t.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});const It="function"==typeof AbortController;function Tt(){if(It)return new AbortController}class At{constructor(e={},t={}){void 0===e?e=null:$(e,"First parameter");const n=gt(t,"Second parameter"),r=vt(e,"First parameter");if(Ct(this),void 0!==r.type)throw new RangeError("Invalid type is specified");const a=yt(n);dn(this,r,ft(n,1),a)}get locked(){if(!Rt(this))throw xn("locked");return jt(this)}abort(e){return Rt(this)?jt(this)?h(new TypeError("Cannot abort a stream that already has a writer")):Pt(this,e):h(xn("abort"))}close(){return Rt(this)?jt(this)?h(new TypeError("Cannot close a stream that already has a writer")):Gt(this)?h(new TypeError("Cannot close an already-closing stream")):Dt(this):h(xn("close"))}getWriter(){if(!Rt(this))throw xn("getWriter");return Ot(this)}}function Ot(e){return new Ht(e)}function Kt(e,t,n,r,a=1,i=(()=>1)){const o=Object.create(At.prototype);return Ct(o),un(o,Object.create(ln.prototype),e,t,n,r,a,i),o}function Ct(e){e._state="writable",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=new _,e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}function Rt(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_writableStreamController")&&e instanceof At}function jt(e){return void 0!==e._writer}function Pt(e,t){var n;if("closed"===e._state||"errored"===e._state)return p(void 0);e._writableStreamController._abortReason=t,null===(n=e._writableStreamController._abortController)||void 0===n||n.abort();const r=e._state;if("closed"===r||"errored"===r)return p(void 0);if(void 0!==e._pendingAbortRequest)return e._pendingAbortRequest._promise;let a=!1;"erroring"===r&&(a=!0,t=void 0);const i=d(((n,r)=>{e._pendingAbortRequest={_promise:void 0,_resolve:n,_reject:r,_reason:t,_wasAlreadyErroring:a}}));return e._pendingAbortRequest._promise=i,a||Mt(e,t),i}function Dt(e){const t=e._state;if("closed"===t||"errored"===t)return h(new TypeError(`The stream (in ${t} state) is not in the writable state and cannot be closed`));const n=d(((t,n)=>{const r={_resolve:t,_reject:n};e._closeRequest=r})),r=e._writer;return void 0!==r&&e._backpressure&&"writable"===t&&Fn(r),hn(e._writableStreamController),n}function Nt(e){return d(((t,n)=>{const r={_resolve:t,_reject:n};e._writeRequests.push(r)}))}function Lt(e,t){"writable"!==e._state?Ft(e):Mt(e,t)}function Mt(e,t){const n=e._writableStreamController;e._state="erroring",e._storedError=t;const r=e._writer;void 0!==r&&nn(r,t),!$t(e)&&n._started&&Ft(e)}function Ft(e){e._state="errored",e._writableStreamController[N]();const t=e._storedError;if(e._writeRequests.forEach((e=>{e._reject(t)})),e._writeRequests=new _,void 0===e._pendingAbortRequest)return void Wt(e);const n=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,n._wasAlreadyErroring)return n._reject(t),void Wt(e);f(e._writableStreamController[D](n._reason),(()=>{n._resolve(),Wt(e)}),(t=>{n._reject(t),Wt(e)}))}function Bt(e){e._inFlightWriteRequest._resolve(void 0),e._inFlightWriteRequest=void 0}function Vt(e,t){e._inFlightWriteRequest._reject(t),e._inFlightWriteRequest=void 0,Lt(e,t)}function Ut(e){e._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0,"erroring"===e._state&&(e._storedError=void 0,void 0!==e._pendingAbortRequest&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0)),e._state="closed";const t=e._writer;void 0!==t&&Rn(t)}function Jt(e,t){e._inFlightCloseRequest._reject(t),e._inFlightCloseRequest=void 0,void 0!==e._pendingAbortRequest&&(e._pendingAbortRequest._reject(t),e._pendingAbortRequest=void 0),Lt(e,t)}function Gt(e){return void 0!==e._closeRequest||void 0!==e._inFlightCloseRequest}function $t(e){return void 0!==e._inFlightWriteRequest||void 0!==e._inFlightCloseRequest}function qt(e){e._inFlightCloseRequest=e._closeRequest,e._closeRequest=void 0}function zt(e){e._inFlightWriteRequest=e._writeRequests.shift()}function Wt(e){void 0!==e._closeRequest&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);const t=e._writer;void 0!==t&&Kn(t,e._storedError)}function Yt(e,t){const n=e._writer;void 0!==n&&t!==e._backpressure&&(t?Ln(n):Fn(n)),e._backpressure=t}Object.defineProperties(At.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(At.prototype,t.toStringTag,{value:"WritableStream",configurable:!0});class Ht{constructor(e){if(q(e,1,"WritableStreamDefaultWriter"),_t(e,"First parameter"),jt(e))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=e,e._writer=this;const t=e._state;if("writable"===t)!Gt(e)&&e._backpressure?jn(this):Dn(this),Tn(this);else if("erroring"===t)Pn(this,e._storedError),Tn(this);else if("closed"===t)Dn(this),On(this);else{const t=e._storedError;Pn(this,t),An(this,t)}}get closed(){return Qt(this)?this._closedPromise:h(kn("closed"))}get desiredSize(){if(!Qt(this))throw kn("desiredSize");if(void 0===this._ownerWritableStream)throw In("desiredSize");return rn(this)}get ready(){return Qt(this)?this._readyPromise:h(kn("ready"))}abort(e){return Qt(this)?void 0===this._ownerWritableStream?h(In("abort")):Zt(this,e):h(kn("abort"))}close(){if(!Qt(this))return h(kn("close"));const e=this._ownerWritableStream;return void 0===e?h(In("close")):Gt(e)?h(new TypeError("Cannot close an already-closing stream")):Xt(this)}releaseLock(){if(!Qt(this))throw kn("releaseLock");void 0!==this._ownerWritableStream&&an(this)}write(e){return Qt(this)?void 0===this._ownerWritableStream?h(In("write to")):on(this,e):h(kn("write"))}}function Qt(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream")&&e instanceof Ht}function Zt(e,t){return Pt(e._ownerWritableStream,t)}function Xt(e){return Dt(e._ownerWritableStream)}function en(e){const t=e._ownerWritableStream,n=t._state;return Gt(t)||"closed"===n?p(void 0):"errored"===n?h(t._storedError):Xt(e)}function tn(e,t){"pending"===e._closedPromiseState?Kn(e,t):Cn(e,t)}function nn(e,t){"pending"===e._readyPromiseState?Nn(e,t):Mn(e,t)}function rn(e){const t=e._ownerWritableStream,n=t._state;return"errored"===n||"erroring"===n?null:"closed"===n?0:fn(t._writableStreamController)}function an(e){const t=e._ownerWritableStream,n=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");nn(e,n),tn(e,n),t._writer=void 0,e._ownerWritableStream=void 0}function on(e,t){const n=e._ownerWritableStream,r=n._writableStreamController,a=mn(r,t);if(n!==e._ownerWritableStream)return h(In("write to"));const i=n._state;if("errored"===i)return h(n._storedError);if(Gt(n)||"closed"===i)return h(new TypeError("The stream is closing or closed and cannot be written to"));if("erroring"===i)return h(n._storedError);const o=Nt(n);return yn(r,t,a),o}Object.defineProperties(Ht.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(Ht.prototype,t.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});const sn={};class ln{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!cn(this))throw _n("abortReason");return this._abortReason}get signal(){if(!cn(this))throw _n("signal");if(void 0===this._abortController)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(e){if(!cn(this))throw _n("error");"writable"===this._controlledWritableStream._state&&En(this,e)}[D](e){const t=this._abortAlgorithm(e);return pn(this),t}[N](){Ie(this)}}function cn(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledWritableStream")&&e instanceof ln}function un(e,t,n,r,a,i,o,s){t._controlledWritableStream=e,e._writableStreamController=t,t._queue=void 0,t._queueTotalSize=void 0,Ie(t),t._abortReason=void 0,t._abortController=Tt(),t._started=!1,t._strategySizeAlgorithm=s,t._strategyHWM=o,t._writeAlgorithm=r,t._closeAlgorithm=a,t._abortAlgorithm=i;const l=Sn(t);Yt(e,l),f(p(n()),(()=>{t._started=!0,gn(t)}),(n=>{t._started=!0,Lt(e,n)}))}function dn(e,t,n,r){const a=Object.create(ln.prototype);let i=()=>{},o=()=>p(void 0),s=()=>p(void 0),l=()=>p(void 0);void 0!==t.start&&(i=()=>t.start(a)),void 0!==t.write&&(o=e=>t.write(e,a)),void 0!==t.close&&(s=()=>t.close()),void 0!==t.abort&&(l=e=>t.abort(e)),un(e,a,i,o,s,l,n,r)}function pn(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function hn(e){_e(e,sn,0),gn(e)}function mn(e,t){try{return e._strategySizeAlgorithm(t)}catch(t){return bn(e,t),1}}function fn(e){return e._strategyHWM-e._queueTotalSize}function yn(e,t,n){try{_e(e,t,n)}catch(t){return void bn(e,t)}const r=e._controlledWritableStream;Gt(r)||"writable"!==r._state||Yt(r,Sn(e)),gn(e)}function gn(e){const t=e._controlledWritableStream;if(!e._started)return;if(void 0!==t._inFlightWriteRequest)return;if("erroring"===t._state)return void Ft(t);if(0===e._queue.length)return;const n=ke(e);n===sn?vn(e):wn(e,n)}function bn(e,t){"writable"===e._controlledWritableStream._state&&En(e,t)}function vn(e){const t=e._controlledWritableStream;qt(t),xe(e);const n=e._closeAlgorithm();pn(e),f(n,(()=>{Ut(t)}),(e=>{Jt(t,e)}))}function wn(e,t){const n=e._controlledWritableStream;zt(n),f(e._writeAlgorithm(t),(()=>{Bt(n);const t=n._state;if(xe(e),!Gt(n)&&"writable"===t){const t=Sn(e);Yt(n,t)}gn(e)}),(t=>{"writable"===n._state&&pn(e),Vt(n,t)}))}function Sn(e){return fn(e)<=0}function En(e,t){const n=e._controlledWritableStream;pn(e),Mt(n,t)}function xn(e){return new TypeError(`WritableStream.prototype.${e} can only be used on a WritableStream`)}function _n(e){return new TypeError(`WritableStreamDefaultController.prototype.${e} can only be used on a WritableStreamDefaultController`)}function kn(e){return new TypeError(`WritableStreamDefaultWriter.prototype.${e} can only be used on a WritableStreamDefaultWriter`)}function In(e){return new TypeError("Cannot "+e+" a stream using a released writer")}function Tn(e){e._closedPromise=d(((t,n)=>{e._closedPromise_resolve=t,e._closedPromise_reject=n,e._closedPromiseState="pending"}))}function An(e,t){Tn(e),Kn(e,t)}function On(e){Tn(e),Rn(e)}function Kn(e,t){void 0!==e._closedPromise_reject&&(v(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected")}function Cn(e,t){An(e,t)}function Rn(e){void 0!==e._closedPromise_resolve&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved")}function jn(e){e._readyPromise=d(((t,n)=>{e._readyPromise_resolve=t,e._readyPromise_reject=n})),e._readyPromiseState="pending"}function Pn(e,t){jn(e),Nn(e,t)}function Dn(e){jn(e),Fn(e)}function Nn(e,t){void 0!==e._readyPromise_reject&&(v(e._readyPromise),e._readyPromise_reject(t),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected")}function Ln(e){jn(e)}function Mn(e,t){Pn(e,t)}function Fn(e){void 0!==e._readyPromise_resolve&&(e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled")}Object.defineProperties(ln.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(ln.prototype,t.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});const Bn="undefined"!=typeof DOMException?DOMException:void 0;function Vn(e){if("function"!=typeof e&&"object"!=typeof e)return!1;try{return new e,!0}catch(e){return!1}}function Un(){const e=function(e,t){this.message=e||"",this.name=t||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return e.prototype=Object.create(Error.prototype),Object.defineProperty(e.prototype,"constructor",{value:e,writable:!0,configurable:!0}),e}const Jn=Vn(Bn)?Bn:Un();function Gn(e,t,r,a,i,o){const s=ee(e),l=Ot(t);e._disturbed=!0;let c=!1,u=p(void 0);return d(((h,b)=>{let w;if(void 0!==o){if(w=()=>{const n=new Jn("Aborted","AbortError"),r=[];a||r.push((()=>"writable"===t._state?Pt(t,n):p(void 0))),i||r.push((()=>"readable"===e._state?kr(e,n):p(void 0))),I((()=>Promise.all(r.map((e=>e())))),!0,n)},o.aborted)return void w();o.addEventListener("abort",w)}function S(){return d(((e,t)=>{function n(r){r?e():m(E(),n,t)}n(!1)}))}function E(){return c?p(!0):m(l._readyPromise,(()=>d(((e,t)=>{se(s,{_chunkSteps:t=>{u=m(on(l,t),void 0,n),e(!1)},_closeSteps:()=>e(!0),_errorSteps:t})}))))}if(_(e,s._closedPromise,(e=>{a?A(!0,e):I((()=>Pt(t,e)),!0,e)})),_(t,l._closedPromise,(t=>{i?A(!0,t):I((()=>kr(e,t)),!0,t)})),k(e,s._closedPromise,(()=>{r?A():I((()=>en(l)))})),Gt(t)||"closed"===t._state){const t=new TypeError("the destination writable stream closed before all data could be piped to it");i?A(!0,t):I((()=>kr(e,t)),!0,t)}function x(){const e=u;return m(u,(()=>e!==u?x():void 0))}function _(e,t,n){"errored"===e._state?n(e._storedError):g(t,n)}function k(e,t,n){"closed"===e._state?n():y(t,n)}function I(e,n,r){function a(){f(e(),(()=>O(n,r)),(e=>O(!0,e)))}c||(c=!0,"writable"!==t._state||Gt(t)?a():y(x(),a))}function A(e,n){c||(c=!0,"writable"!==t._state||Gt(t)?O(e,n):y(x(),(()=>O(e,n))))}function O(e,t){an(l),T(s),void 0!==o&&o.removeEventListener("abort",w),e?b(t):h(void 0)}v(S())}))}class $n{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!qn(this))throw ar("desiredSize");return Xn(this)}close(){if(!qn(this))throw ar("close");if(!tr(this))throw new TypeError("The stream is not in a state that permits close");Hn(this)}enqueue(e){if(!qn(this))throw ar("enqueue");if(!tr(this))throw new TypeError("The stream is not in a state that permits enqueue");return Qn(this,e)}error(e){if(!qn(this))throw ar("error");Zn(this,e)}[L](e){Ie(this);const t=this._cancelAlgorithm(e);return Yn(this),t}[M](e){const t=this._controlledReadableStream;if(this._queue.length>0){const n=xe(this);this._closeRequested&&0===this._queue.length?(Yn(this),Ir(t)):zn(this),e._chunkSteps(n)}else te(t,e),zn(this)}}function qn(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream")&&e instanceof $n}function zn(e){Wn(e)&&(e._pulling?e._pullAgain=!0:(e._pulling=!0,f(e._pullAlgorithm(),(()=>{e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,zn(e))}),(t=>{Zn(e,t)}))))}function Wn(e){const t=e._controlledReadableStream;return!!tr(e)&&!!e._started&&(!!(_r(t)&&re(t)>0)||Xn(e)>0)}function Yn(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Hn(e){if(!tr(e))return;const t=e._controlledReadableStream;e._closeRequested=!0,0===e._queue.length&&(Yn(e),Ir(t))}function Qn(e,t){if(!tr(e))return;const n=e._controlledReadableStream;if(_r(n)&&re(n)>0)ne(n,t,!1);else{let n;try{n=e._strategySizeAlgorithm(t)}catch(t){throw Zn(e,t),t}try{_e(e,t,n)}catch(t){throw Zn(e,t),t}}zn(e)}function Zn(e,t){const n=e._controlledReadableStream;"readable"===n._state&&(Ie(e),Yn(e),Tr(n,t))}function Xn(e){const t=e._controlledReadableStream._state;return"errored"===t?null:"closed"===t?0:e._strategyHWM-e._queueTotalSize}function er(e){return!Wn(e)}function tr(e){const t=e._controlledReadableStream._state;return!e._closeRequested&&"readable"===t}function nr(e,t,n,r,a,i,o){t._controlledReadableStream=e,t._queue=void 0,t._queueTotalSize=void 0,Ie(t),t._started=!1,t._closeRequested=!1,t._pullAgain=!1,t._pulling=!1,t._strategySizeAlgorithm=o,t._strategyHWM=i,t._pullAlgorithm=r,t._cancelAlgorithm=a,e._readableStreamController=t,f(p(n()),(()=>{t._started=!0,zn(t)}),(e=>{Zn(t,e)}))}function rr(e,t,n,r){const a=Object.create($n.prototype);let i=()=>{},o=()=>p(void 0),s=()=>p(void 0);void 0!==t.start&&(i=()=>t.start(a)),void 0!==t.pull&&(o=()=>t.pull(a)),void 0!==t.cancel&&(s=e=>t.cancel(e)),nr(e,a,i,o,s,n,r)}function ar(e){return new TypeError(`ReadableStreamDefaultController.prototype.${e} can only be used on a ReadableStreamDefaultController`)}function ir(e,t){return Oe(e._readableStreamController)?sr(e):or(e)}function or(e,t){const n=ee(e);let r,a,i,o,s,l=!1,c=!1,u=!1,h=!1;const m=d((e=>{s=e}));function f(){return l?(c=!0,p(void 0)):(l=!0,se(n,{_chunkSteps:e=>{w((()=>{c=!1;const t=e,n=e;u||Qn(i._readableStreamController,t),h||Qn(o._readableStreamController,n),l=!1,c&&f()}))},_closeSteps:()=>{l=!1,u||Hn(i._readableStreamController),h||Hn(o._readableStreamController),u&&h||s(void 0)},_errorSteps:()=>{l=!1}}),p(void 0))}function y(t){if(u=!0,r=t,h){const t=ye([r,a]),n=kr(e,t);s(n)}return m}function b(t){if(h=!0,a=t,u){const t=ye([r,a]),n=kr(e,t);s(n)}return m}function v(){}return i=wr(v,f,y),o=wr(v,f,b),g(n._closedPromise,(e=>{Zn(i._readableStreamController,e),Zn(o._readableStreamController,e),u&&h||s(void 0)})),[i,o]}function sr(e){let t,n,r,a,i,o=ee(e),s=!1,l=!1,c=!1,u=!1,h=!1;const m=d((e=>{i=e}));function f(e){g(e._closedPromise,(t=>{e===o&&(He(r._readableStreamController,t),He(a._readableStreamController,t),u&&h||i(void 0))}))}function y(){pt(o)&&(T(o),o=ee(e),f(o)),se(o,{_chunkSteps:t=>{w((()=>{l=!1,c=!1;const n=t;let o=t;if(!u&&!h)try{o=Ee(t)}catch(t){return He(r._readableStreamController,t),He(a._readableStreamController,t),void i(kr(e,t))}u||Ye(r._readableStreamController,n),h||Ye(a._readableStreamController,o),s=!1,l?v():c&&S()}))},_closeSteps:()=>{s=!1,u||We(r._readableStreamController),h||We(a._readableStreamController),r._readableStreamController._pendingPullIntos.length>0&&Xe(r._readableStreamController,0),a._readableStreamController._pendingPullIntos.length>0&&Xe(a._readableStreamController,0),u&&h||i(void 0)},_errorSteps:()=>{s=!1}})}function b(t,n){oe(o)&&(T(o),o=ot(e),f(o));const d=n?a:r,p=n?r:a;ht(o,t,{_chunkSteps:t=>{w((()=>{l=!1,c=!1;const r=n?h:u;if(n?u:h)r||et(d._readableStreamController,t);else{let n;try{n=Ee(t)}catch(t){return He(d._readableStreamController,t),He(p._readableStreamController,t),void i(kr(e,t))}r||et(d._readableStreamController,t),Ye(p._readableStreamController,n)}s=!1,l?v():c&&S()}))},_closeSteps:e=>{s=!1;const t=n?h:u,r=n?u:h;t||We(d._readableStreamController),r||We(p._readableStreamController),void 0!==e&&(t||et(d._readableStreamController,e),!r&&p._readableStreamController._pendingPullIntos.length>0&&Xe(p._readableStreamController,0)),t&&r||i(void 0)},_errorSteps:()=>{s=!1}})}function v(){if(s)return l=!0,p(void 0);s=!0;const e=Qe(r._readableStreamController);return null===e?y():b(e._view,!1),p(void 0)}function S(){if(s)return c=!0,p(void 0);s=!0;const e=Qe(a._readableStreamController);return null===e?y():b(e._view,!0),p(void 0)}function E(r){if(u=!0,t=r,h){const r=ye([t,n]),a=kr(e,r);i(a)}return m}function x(r){if(h=!0,n=r,u){const r=ye([t,n]),a=kr(e,r);i(a)}return m}function _(){}return r=Sr(_,v,E),a=Sr(_,S,x),f(o),[r,a]}function lr(e,t){U(e,t);const n=e,r=null==n?void 0:n.autoAllocateChunkSize,a=null==n?void 0:n.cancel,i=null==n?void 0:n.pull,o=null==n?void 0:n.start,s=null==n?void 0:n.type;return{autoAllocateChunkSize:void 0===r?void 0:Q(r,`${t} has member 'autoAllocateChunkSize' that`),cancel:void 0===a?void 0:cr(a,n,`${t} has member 'cancel' that`),pull:void 0===i?void 0:ur(i,n,`${t} has member 'pull' that`),start:void 0===o?void 0:dr(o,n,`${t} has member 'start' that`),type:void 0===s?void 0:pr(s,`${t} has member 'type' that`)}}function cr(e,t,n){return J(e,n),n=>E(e,t,[n])}function ur(e,t,n){return J(e,n),n=>E(e,t,[n])}function dr(e,t,n){return J(e,n),n=>S(e,t,[n])}function pr(e,t){if("bytes"!=(e=`${e}`))throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamType`);return e}function hr(e,t){U(e,t);const n=null==e?void 0:e.mode;return{mode:void 0===n?void 0:mr(n,`${t} has member 'mode' that`)}}function mr(e,t){if("byob"!=(e=`${e}`))throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamReaderMode`);return e}function fr(e,t){U(e,t);const n=null==e?void 0:e.preventCancel;return{preventCancel:Boolean(n)}}function yr(e,t){U(e,t);const n=null==e?void 0:e.preventAbort,r=null==e?void 0:e.preventCancel,a=null==e?void 0:e.preventClose,i=null==e?void 0:e.signal;return void 0!==i&&gr(i,`${t} has member 'signal' that`),{preventAbort:Boolean(n),preventCancel:Boolean(r),preventClose:Boolean(a),signal:i}}function gr(e,t){if(!kt(e))throw new TypeError(`${t} is not an AbortSignal.`)}function br(e,t){U(e,t);const n=null==e?void 0:e.readable;z(n,"readable","ReadableWritablePair"),Z(n,`${t} has member 'readable' that`);const r=null==e?void 0:e.writable;return z(r,"writable","ReadableWritablePair"),_t(r,`${t} has member 'writable' that`),{readable:n,writable:r}}Object.defineProperties($n.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty($n.prototype,t.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});class vr{constructor(e={},t={}){void 0===e?e=null:$(e,"First parameter");const n=gt(t,"Second parameter"),r=lr(e,"First parameter");if(Er(this),"bytes"===r.type){if(void 0!==n.size)throw new RangeError("The strategy for a byte stream cannot have a size function");nt(this,r,ft(n,0))}else{const e=yt(n);rr(this,r,ft(n,1),e)}}get locked(){if(!xr(this))throw Ar("locked");return _r(this)}cancel(e){return xr(this)?_r(this)?h(new TypeError("Cannot cancel a stream that already has a reader")):kr(this,e):h(Ar("cancel"))}getReader(e){if(!xr(this))throw Ar("getReader");return void 0===hr(e,"First parameter").mode?ee(this):ot(this)}pipeThrough(e,t={}){if(!xr(this))throw Ar("pipeThrough");q(e,1,"pipeThrough");const n=br(e,"First parameter"),r=yr(t,"Second parameter");if(_r(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(jt(n.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");return v(Gn(this,n.writable,r.preventClose,r.preventAbort,r.preventCancel,r.signal)),n.readable}pipeTo(e,t={}){if(!xr(this))return h(Ar("pipeTo"));if(void 0===e)return h("Parameter 1 is required in 'pipeTo'.");if(!Rt(e))return h(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let n;try{n=yr(t,"Second parameter")}catch(e){return h(e)}return _r(this)?h(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):jt(e)?h(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):Gn(this,e,n.preventClose,n.preventAbort,n.preventCancel,n.signal)}tee(){if(!xr(this))throw Ar("tee");return ye(ir(this))}values(e){if(!xr(this))throw Ar("values");return pe(this,fr(e,"First parameter").preventCancel)}}function wr(e,t,n,r=1,a=(()=>1)){const i=Object.create(vr.prototype);return Er(i),nr(i,Object.create($n.prototype),e,t,n,r,a),i}function Sr(e,t,n){const r=Object.create(vr.prototype);return Er(r),tt(r,Object.create(Ae.prototype),e,t,n,0,void 0),r}function Er(e){e._state="readable",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}function xr(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readableStreamController")&&e instanceof vr}function _r(e){return void 0!==e._reader}function kr(e,t){if(e._disturbed=!0,"closed"===e._state)return p(void 0);if("errored"===e._state)return h(e._storedError);Ir(e);const r=e._reader;return void 0!==r&&pt(r)&&(r._readIntoRequests.forEach((e=>{e._closeSteps(void 0)})),r._readIntoRequests=new _),b(e._readableStreamController[L](t),n)}function Ir(e){e._state="closed";const t=e._reader;void 0!==t&&(P(t),oe(t)&&(t._readRequests.forEach((e=>{e._closeSteps()})),t._readRequests=new _))}function Tr(e,t){e._state="errored",e._storedError=t;const n=e._reader;void 0!==n&&(R(n,t),oe(n)?(n._readRequests.forEach((e=>{e._errorSteps(t)})),n._readRequests=new _):(n._readIntoRequests.forEach((e=>{e._errorSteps(t)})),n._readIntoRequests=new _))}function Ar(e){return new TypeError(`ReadableStream.prototype.${e} can only be used on a ReadableStream`)}function Or(e,t){U(e,t);const n=null==e?void 0:e.highWaterMark;return z(n,"highWaterMark","QueuingStrategyInit"),{highWaterMark:W(n)}}Object.defineProperties(vr.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(vr.prototype,t.toStringTag,{value:"ReadableStream",configurable:!0}),"symbol"==typeof t.asyncIterator&&Object.defineProperty(vr.prototype,t.asyncIterator,{value:vr.prototype.values,writable:!0,configurable:!0});const Kr=e=>e.byteLength;try{Object.defineProperty(Kr,"name",{value:"size",configurable:!0})}catch(e){}class Cr{constructor(e){q(e,1,"ByteLengthQueuingStrategy"),e=Or(e,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=e.highWaterMark}get highWaterMark(){if(!jr(this))throw Rr("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!jr(this))throw Rr("size");return Kr}}function Rr(e){return new TypeError(`ByteLengthQueuingStrategy.prototype.${e} can only be used on a ByteLengthQueuingStrategy`)}function jr(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_byteLengthQueuingStrategyHighWaterMark")&&e instanceof Cr}Object.defineProperties(Cr.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(Cr.prototype,t.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});const Pr=()=>1;try{Object.defineProperty(Pr,"name",{value:"size",configurable:!0})}catch(e){}class Dr{constructor(e){q(e,1,"CountQueuingStrategy"),e=Or(e,"First parameter"),this._countQueuingStrategyHighWaterMark=e.highWaterMark}get highWaterMark(){if(!Lr(this))throw Nr("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!Lr(this))throw Nr("size");return Pr}}function Nr(e){return new TypeError(`CountQueuingStrategy.prototype.${e} can only be used on a CountQueuingStrategy`)}function Lr(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_countQueuingStrategyHighWaterMark")&&e instanceof Dr}function Mr(e,t){U(e,t);const n=null==e?void 0:e.flush,r=null==e?void 0:e.readableType,a=null==e?void 0:e.start,i=null==e?void 0:e.transform,o=null==e?void 0:e.writableType;return{flush:void 0===n?void 0:Fr(n,e,`${t} has member 'flush' that`),readableType:r,start:void 0===a?void 0:Br(a,e,`${t} has member 'start' that`),transform:void 0===i?void 0:Vr(i,e,`${t} has member 'transform' that`),writableType:o}}function Fr(e,t,n){return J(e,n),n=>E(e,t,[n])}function Br(e,t,n){return J(e,n),n=>S(e,t,[n])}function Vr(e,t,n){return J(e,n),(n,r)=>E(e,t,[n,r])}Object.defineProperties(Dr.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(Dr.prototype,t.toStringTag,{value:"CountQueuingStrategy",configurable:!0});class Ur{constructor(e={},t={},n={}){void 0===e&&(e=null);const r=gt(t,"Second parameter"),a=gt(n,"Third parameter"),i=Mr(e,"First parameter");if(void 0!==i.readableType)throw new RangeError("Invalid readableType specified");if(void 0!==i.writableType)throw new RangeError("Invalid writableType specified");const o=ft(a,0),s=yt(a),l=ft(r,1),c=yt(r);let u;Jr(this,d((e=>{u=e})),l,c,o,s),Qr(this,i),void 0!==i.start?u(i.start(this._transformStreamController)):u(void 0)}get readable(){if(!Gr(this))throw la("readable");return this._readable}get writable(){if(!Gr(this))throw la("writable");return this._writable}}function Jr(e,t,n,r,a,i){function o(){return t}function s(t){return ra(e,t)}function l(t){return aa(e,t)}function c(){return ia(e)}function u(){return oa(e)}function d(t){return qr(e,t),p(void 0)}e._writable=Kt(o,s,c,l,n,r),e._readable=wr(o,u,d,a,i),e._backpressure=void 0,e._backpressureChangePromise=void 0,e._backpressureChangePromise_resolve=void 0,zr(e,!0),e._transformStreamController=void 0}function Gr(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_transformStreamController")&&e instanceof Ur}function $r(e,t){Zn(e._readable._readableStreamController,t),qr(e,t)}function qr(e,t){Zr(e._transformStreamController),bn(e._writable._writableStreamController,t),e._backpressure&&zr(e,!1)}function zr(e,t){void 0!==e._backpressureChangePromise&&e._backpressureChangePromise_resolve(),e._backpressureChangePromise=d((t=>{e._backpressureChangePromise_resolve=t})),e._backpressure=t}Object.defineProperties(Ur.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(Ur.prototype,t.toStringTag,{value:"TransformStream",configurable:!0});class Wr{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Yr(this))throw sa("desiredSize");return Xn(this._controlledTransformStream._readable._readableStreamController)}enqueue(e){if(!Yr(this))throw sa("enqueue");Xr(this,e)}error(e){if(!Yr(this))throw sa("error");ea(this,e)}terminate(){if(!Yr(this))throw sa("terminate");na(this)}}function Yr(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledTransformStream")&&e instanceof Wr}function Hr(e,t,n,r){t._controlledTransformStream=e,e._transformStreamController=t,t._transformAlgorithm=n,t._flushAlgorithm=r}function Qr(e,t){const n=Object.create(Wr.prototype);let r=e=>{try{return Xr(n,e),p(void 0)}catch(e){return h(e)}},a=()=>p(void 0);void 0!==t.transform&&(r=e=>t.transform(e,n)),void 0!==t.flush&&(a=()=>t.flush(n)),Hr(e,n,r,a)}function Zr(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0}function Xr(e,t){const n=e._controlledTransformStream,r=n._readable._readableStreamController;if(!tr(r))throw new TypeError("Readable side is not in a state that permits enqueue");try{Qn(r,t)}catch(e){throw qr(n,e),n._readable._storedError}er(r)!==n._backpressure&&zr(n,!0)}function ea(e,t){$r(e._controlledTransformStream,t)}function ta(e,t){return b(e._transformAlgorithm(t),void 0,(t=>{throw $r(e._controlledTransformStream,t),t}))}function na(e){const t=e._controlledTransformStream;Hn(t._readable._readableStreamController),qr(t,new TypeError("TransformStream terminated"))}function ra(e,t){const n=e._transformStreamController;return e._backpressure?b(e._backpressureChangePromise,(()=>{const r=e._writable;if("erroring"===r._state)throw r._storedError;return ta(n,t)})):ta(n,t)}function aa(e,t){return $r(e,t),p(void 0)}function ia(e){const t=e._readable,n=e._transformStreamController,r=n._flushAlgorithm();return Zr(n),b(r,(()=>{if("errored"===t._state)throw t._storedError;Hn(t._readableStreamController)}),(n=>{throw $r(e,n),t._storedError}))}function oa(e){return zr(e,!1),e._backpressureChangePromise}function sa(e){return new TypeError(`TransformStreamDefaultController.prototype.${e} can only be used on a TransformStreamDefaultController`)}function la(e){return new TypeError(`TransformStream.prototype.${e} can only be used on a TransformStream`)}Object.defineProperties(Wr.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(Wr.prototype,t.toStringTag,{value:"TransformStreamDefaultController",configurable:!0}),e.ByteLengthQueuingStrategy=Cr,e.CountQueuingStrategy=Dr,e.ReadableByteStreamController=Ae,e.ReadableStream=vr,e.ReadableStreamBYOBReader=dt,e.ReadableStreamBYOBRequest=Te,e.ReadableStreamDefaultController=$n,e.ReadableStreamDefaultReader=ie,e.TransformStream=Ur,e.TransformStreamDefaultController=Wr,e.WritableStream=At,e.WritableStreamDefaultController=ln,e.WritableStreamDefaultWriter=Ht,Object.defineProperty(e,"__esModule",{value:!0})}(no.exports);if(!globalThis.ReadableStream)try{const e=require("node:process"),{emitWarning:t}=e;try{e.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),e.emitWarning=t}catch(n){throw e.emitWarning=t,n}}catch(e){Object.assign(globalThis,no.exports)}try{const{Blob:e}=require("buffer");e&&!e.prototype.stream&&(e.prototype.stream=function(e){let t=0;const n=this;return new ReadableStream({type:"bytes",async pull(e){const r=n.slice(t,Math.min(n.size,t+65536)),a=await r.arrayBuffer();t+=a.byteLength,e.enqueue(new Uint8Array(a)),t===n.size&&e.close()}})})}catch(e){}
/*! fetch-blob. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> */async function*ro(e,t=!0){for(const n of e)if("stream"in n)yield*n.stream();else if(ArrayBuffer.isView(n))if(t){let e=n.byteOffset;const t=n.byteOffset+n.byteLength;for(;e!==t;){const r=Math.min(t-e,65536),a=n.buffer.slice(e,e+r);e+=a.byteLength,yield new Uint8Array(a)}}else yield n;else{let e=0,t=n;for(;e!==t.size;){const n=t.slice(e,Math.min(t.size,e+65536)),r=await n.arrayBuffer();e+=r.byteLength,yield new Uint8Array(r)}}}const ao=class e{#e=[];#t="";#n=0;#r="transparent";constructor(t=[],n={}){if("object"!=typeof t||null===t)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if("function"!=typeof t[Symbol.iterator])throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if("object"!=typeof n&&"function"!=typeof n)throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");null===n&&(n={});const r=new TextEncoder;for(const n of t){let t;t=ArrayBuffer.isView(n)?new Uint8Array(n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)):n instanceof ArrayBuffer?new Uint8Array(n.slice(0)):n instanceof e?n:r.encode(`${n}`),this.#n+=ArrayBuffer.isView(t)?t.byteLength:t.size,this.#e.push(t)}this.#r=`${void 0===n.endings?"transparent":n.endings}`;const a=void 0===n.type?"":String(n.type);this.#t=/^[\x20-\x7E]*$/.test(a)?a:""}get size(){return this.#n}get type(){return this.#t}async text(){const e=new TextDecoder;let t="";for await(const n of ro(this.#e,!1))t+=e.decode(n,{stream:!0});return t+=e.decode(),t}async arrayBuffer(){const e=new Uint8Array(this.size);let t=0;for await(const n of ro(this.#e,!1))e.set(n,t),t+=n.length;return e.buffer}stream(){const e=ro(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(t){const n=await e.next();n.done?t.close():t.enqueue(n.value)},async cancel(){await e.return()}})}slice(t=0,n=this.size,r=""){const{size:a}=this;let i=t<0?Math.max(a+t,0):Math.min(t,a),o=n<0?Math.max(a+n,0):Math.min(n,a);const s=Math.max(o-i,0),l=this.#e,c=[];let u=0;for(const e of l){if(u>=s)break;const t=ArrayBuffer.isView(e)?e.byteLength:e.size;if(i&&t<=i)i-=t,o-=t;else{let n;ArrayBuffer.isView(e)?(n=e.subarray(i,Math.min(t,o)),u+=n.byteLength):(n=e.slice(i,Math.min(t,o)),u+=n.size),o-=t,c.push(n),i=0}}const d=new e([],{type:String(r).toLowerCase()});return d.#n=s,d.#e=c,d}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&"object"==typeof e&&"function"==typeof e.constructor&&("function"==typeof e.stream||"function"==typeof e.arrayBuffer)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}};Object.defineProperties(ao.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});var io=ao;const oo=class extends io{#a=0;#i="";constructor(e,t,n={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(e,n),null===n&&(n={});const r=void 0===n.lastModified?Date.now():Number(n.lastModified);Number.isNaN(r)||(this.#a=r),this.#i=String(t)}get name(){return this.#i}get lastModified(){return this.#a}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](e){return!!e&&e instanceof io&&/^(File)$/.test(e[Symbol.toStringTag])}},so=oo;
/*! formdata-polyfill. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> */
var{toStringTag:lo,iterator:co,hasInstance:uo}=Symbol,po=Math.random,ho="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),mo=(e,t,n)=>(e+="",/^(Blob|File)$/.test(t&&t[lo])?[(n=void 0!==n?n+"":"File"==t[lo]?t.name:"blob",e),t.name!==n||"blob"==t[lo]?new so([t],n,t):t]:[e,t+""]),fo=(e,t)=>(t?e:e.replace(/\r?\n|\r/g,"\r\n")).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),yo=(e,t,n)=>{if(t.length<n)throw new TypeError(`Failed to execute '${e}' on 'FormData': ${n} arguments required, but only ${t.length} present.`)};const go=class{#o=[];constructor(...e){if(e.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[lo](){return"FormData"}[co](){return this.entries()}static[uo](e){return e&&"object"==typeof e&&"FormData"===e[lo]&&!ho.some((t=>"function"!=typeof e[t]))}append(...e){yo("append",arguments,2),this.#o.push(mo(...e))}delete(e){yo("delete",arguments,1),e+="",this.#o=this.#o.filter((([t])=>t!==e))}get(e){yo("get",arguments,1),e+="";for(var t=this.#o,n=t.length,r=0;r<n;r++)if(t[r][0]===e)return t[r][1];return null}getAll(e,t){return yo("getAll",arguments,1),t=[],e+="",this.#o.forEach((n=>n[0]===e&&t.push(n[1]))),t}has(e){return yo("has",arguments,1),e+="",this.#o.some((t=>t[0]===e))}forEach(e,t){for(var[n,r]of(yo("forEach",arguments,1),this))e.call(t,r,n,this)}set(...e){yo("set",arguments,2);var t=[],n=!0;e=mo(...e),this.#o.forEach((r=>{r[0]===e[0]?n&&(n=!t.push(e)):t.push(r)})),n&&t.push(e),this.#o=t}*entries(){yield*this.#o}*keys(){for(var[e]of this)yield e}*values(){for(var[,e]of this)yield e}};class bo extends Error{constructor(e,t){super(e),Error.captureStackTrace(this,this.constructor),this.type=t}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}class vo extends bo{constructor(e,t,n){super(e,t),n&&(this.code=this.errno=n.code,this.erroredSysCall=n.syscall)}}const wo=Symbol.toStringTag,So=e=>"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&"function"==typeof e.sort&&"URLSearchParams"===e[wo],Eo=e=>e&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&/^(Blob|File)$/.test(e[wo]),xo=f.promisify(G.default.pipeline),_o=Symbol("Body internals");class ko{constructor(e,{size:t=0}={}){let n=null;null===e?e=null:So(e)?e=m.Buffer.from(e.toString()):Eo(e)||m.Buffer.isBuffer(e)||(f.types.isAnyArrayBuffer(e)?e=m.Buffer.from(e):ArrayBuffer.isView(e)?e=m.Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof G.default||(e instanceof go?(e=function(e,t=io){var n=`${po()}${po()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),r=[],a=`--${n}\r\nContent-Disposition: form-data; name="`;return e.forEach(((e,t)=>"string"==typeof e?r.push(a+fo(t)+`"\r\n\r\n${e.replace(/\r(?!\n)|(?<!\r)\n/g,"\r\n")}\r\n`):r.push(a+fo(t)+`"; filename="${fo(e.name,1)}"\r\nContent-Type: ${e.type||"application/octet-stream"}\r\n\r\n`,e,"\r\n"))),r.push(`--${n}--`),new t(r,{type:"multipart/form-data; boundary="+n})}(e),n=e.type.split("=")[1]):e=m.Buffer.from(String(e))));let r=e;m.Buffer.isBuffer(e)?r=G.default.Readable.from(e):Eo(e)&&(r=G.default.Readable.from(e.stream())),this[_o]={body:e,stream:r,boundary:n,disturbed:!1,error:null},this.size=t,e instanceof G.default&&e.on("error",(e=>{const t=e instanceof bo?e:new vo(`Invalid response body while trying to fetch ${this.url}: ${e.message}`,"system",e);this[_o].error=t}))}get body(){return this[_o].stream}get bodyUsed(){return this[_o].disturbed}async arrayBuffer(){const{buffer:e,byteOffset:t,byteLength:n}=await Io(this);return e.slice(t,t+n)}async formData(){const e=this.headers.get("content-type");if(e.startsWith("application/x-www-form-urlencoded")){const e=new go,t=new URLSearchParams(await this.text());for(const[n,r]of t)e.append(n,r);return e}const{toFormData:t}=await Promise.resolve().then((function(){return aM}));return t(this.body,e)}async blob(){const e=this.headers&&this.headers.get("content-type")||this[_o].body&&this[_o].body.type||"",t=await this.arrayBuffer();return new io([t],{type:e})}async json(){const e=await this.text();return JSON.parse(e)}async text(){const e=await Io(this);return(new TextDecoder).decode(e)}buffer(){return Io(this)}}async function Io(e){if(e[_o].disturbed)throw new TypeError(`body used already for: ${e.url}`);if(e[_o].disturbed=!0,e[_o].error)throw e[_o].error;const{body:t}=e;if(null===t)return m.Buffer.alloc(0);if(!(t instanceof G.default))return m.Buffer.alloc(0);const n=[];let r=0;try{for await(const a of t){if(e.size>0&&r+a.length>e.size){const n=new vo(`content size at ${e.url} over limit: ${e.size}`,"max-size");throw t.destroy(n),n}r+=a.length,n.push(a)}}catch(t){throw t instanceof bo?t:new vo(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t)}if(!0!==t.readableEnded&&!0!==t._readableState.ended)throw new vo(`Premature close of server response while trying to fetch ${e.url}`);try{return n.every((e=>"string"==typeof e))?m.Buffer.from(n.join("")):m.Buffer.concat(n,r)}catch(t){throw new vo(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t)}}ko.prototype.buffer=f.deprecate(ko.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer"),Object.defineProperties(ko.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:f.deprecate((()=>{}),"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});const To=(e,t)=>{let n,r,{body:a}=e[_o];if(e.bodyUsed)throw new Error("cannot clone body after it is used");return a instanceof G.default&&"function"!=typeof a.getBoundary&&(n=new h.PassThrough({highWaterMark:t}),r=new h.PassThrough({highWaterMark:t}),a.pipe(n),a.pipe(r),e[_o].stream=n,a=r),a},Ao=f.deprecate((e=>e.getBoundary()),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),Oo=(e,t)=>null===e?null:"string"==typeof e?"text/plain;charset=UTF-8":So(e)?"application/x-www-form-urlencoded;charset=UTF-8":Eo(e)?e.type||null:m.Buffer.isBuffer(e)||f.types.isAnyArrayBuffer(e)||ArrayBuffer.isView(e)?null:e instanceof go?`multipart/form-data; boundary=${t[_o].boundary}`:e&&"function"==typeof e.getBoundary?`multipart/form-data;boundary=${Ao(e)}`:e instanceof G.default?null:"text/plain;charset=UTF-8",Ko="function"==typeof V.default.validateHeaderName?V.default.validateHeaderName:e=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(e)){const t=new TypeError(`Header name must be a valid HTTP token [${e}]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),t}},Co="function"==typeof V.default.validateHeaderValue?V.default.validateHeaderValue:(e,t)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(t)){const t=new TypeError(`Invalid character in header content ["${e}"]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_CHAR"}),t}};class Ro extends URLSearchParams{constructor(e){let t=[];if(e instanceof Ro){const n=e.raw();for(const[e,r]of Object.entries(n))t.push(...r.map((t=>[e,t])))}else if(null==e);else{if("object"!=typeof e||f.types.isBoxedPrimitive(e))throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");{const n=e[Symbol.iterator];if(null==n)t.push(...Object.entries(e));else{if("function"!=typeof n)throw new TypeError("Header pairs must be iterable");t=[...e].map((e=>{if("object"!=typeof e||f.types.isBoxedPrimitive(e))throw new TypeError("Each header pair must be an iterable object");return[...e]})).map((e=>{if(2!==e.length)throw new TypeError("Each header pair must be a name/value tuple");return[...e]}))}}}return t=t.length>0?t.map((([e,t])=>(Ko(e),Co(e,String(t)),[String(e).toLowerCase(),String(t)]))):void 0,super(t),new Proxy(this,{get(e,t,n){switch(t){case"append":case"set":return(n,r)=>(Ko(n),Co(n,String(r)),URLSearchParams.prototype[t].call(e,String(n).toLowerCase(),String(r)));case"delete":case"has":case"getAll":return n=>(Ko(n),URLSearchParams.prototype[t].call(e,String(n).toLowerCase()));case"keys":return()=>(e.sort(),new Set(URLSearchParams.prototype.keys.call(e)).keys());default:return Reflect.get(e,t,n)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){const t=this.getAll(e);if(0===t.length)return null;let n=t.join(", ");return/^content-encoding$/i.test(e)&&(n=n.toLowerCase()),n}forEach(e,t){for(const n of this.keys())Reflect.apply(e,t,[this.get(n),n,this])}*values(){for(const e of this.keys())yield this.get(e)}*entries(){for(const e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce(((e,t)=>(e[t]=this.getAll(t),e)),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce(((e,t)=>{const n=this.getAll(t);return e[t]="host"===t?n[0]:n.length>1?n:n[0],e}),{})}}Object.defineProperties(Ro.prototype,["get","entries","forEach","values"].reduce(((e,t)=>(e[t]={enumerable:!0},e)),{}));const jo=new Set([301,302,303,307,308]),Po=e=>jo.has(e),Do=Symbol("Response internals");class No extends ko{constructor(e=null,t={}){super(e,t);const n=null!=t.status?t.status:200,r=new Ro(t.headers);if(null!==e&&!r.has("Content-Type")){const t=Oo(e,this);t&&r.append("Content-Type",t)}this[Do]={type:"default",url:t.url,status:n,statusText:t.statusText||"",headers:r,counter:t.counter,highWaterMark:t.highWaterMark}}get type(){return this[Do].type}get url(){return this[Do].url||""}get status(){return this[Do].status}get ok(){return this[Do].status>=200&&this[Do].status<300}get redirected(){return this[Do].counter>0}get statusText(){return this[Do].statusText}get headers(){return this[Do].headers}get highWaterMark(){return this[Do].highWaterMark}clone(){return new No(To(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(e,t=302){if(!Po(t))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new No(null,{headers:{location:new URL(e).toString()},status:t})}static error(){const e=new No(null,{status:0,statusText:""});return e[Do].type="error",e}static json(e,t={}){const n=JSON.stringify(e);if(void 0===n)throw new TypeError("data is not JSON serializable");const r=new Ro(t&&t.headers);return r.has("content-type")||r.set("content-type","application/json"),new No(n,{...t,headers:r})}get[Symbol.toStringTag](){return"Response"}}Object.defineProperties(No.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});function Lo(e,t=!1){return null==e?"no-referrer":(e=new URL(e),/^(about|blob|data):$/.test(e.protocol)?"no-referrer":(e.username="",e.password="",e.hash="",t&&(e.pathname="",e.search=""),e))}const Mo=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]);function Fo(e){return!!/^about:(blank|srcdoc)$/.test(e)||("data:"===e.protocol||(!!/^(blob|filesystem):$/.test(e.protocol)||function(e){if(/^(http|ws)s:$/.test(e.protocol))return!0;const t=e.host.replace(/(^\[)|(]$)/g,""),n=g.isIP(t);return!(4!==n||!/^127\./.test(t))||!(6!==n||!/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(t))||"localhost"!==e.host&&!e.host.endsWith(".localhost")&&"file:"===e.protocol}(e)))}const Bo=Symbol("Request internals"),Vo=e=>"object"==typeof e&&"object"==typeof e[Bo],Uo=f.deprecate((()=>{}),".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)");class Jo extends ko{constructor(e,t={}){let n;if(Vo(e)?n=new URL(e.url):(n=new URL(e),e={}),""!==n.username||""!==n.password)throw new TypeError(`${n} is an url with embedded credentials.`);let r=t.method||e.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(r)&&(r=r.toUpperCase()),!Vo(t)&&"data"in t&&Uo(),(null!=t.body||Vo(e)&&null!==e.body)&&("GET"===r||"HEAD"===r))throw new TypeError("Request with GET/HEAD method cannot have body");const a=t.body?t.body:Vo(e)&&null!==e.body?To(e):null;super(a,{size:t.size||e.size||0});const i=new Ro(t.headers||e.headers||{});if(null!==a&&!i.has("Content-Type")){const e=Oo(a,this);e&&i.set("Content-Type",e)}let o=Vo(e)?e.signal:null;if("signal"in t&&(o=t.signal),null!=o&&!(e=>"object"==typeof e&&("AbortSignal"===e[wo]||"EventTarget"===e[wo]))(o))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let s=null==t.referrer?e.referrer:t.referrer;if(""===s)s="no-referrer";else if(s){const e=new URL(s);s=/^about:(\/\/)?client$/.test(e)?"client":e}else s=void 0;this[Bo]={method:r,redirect:t.redirect||e.redirect||"follow",headers:i,parsedURL:n,signal:o,referrer:s},this.follow=void 0===t.follow?void 0===e.follow?20:e.follow:t.follow,this.compress=void 0===t.compress?void 0===e.compress||e.compress:t.compress,this.counter=t.counter||e.counter||0,this.agent=t.agent||e.agent,this.highWaterMark=t.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=t.insecureHTTPParser||e.insecureHTTPParser||!1,this.referrerPolicy=t.referrerPolicy||e.referrerPolicy||""}get method(){return this[Bo].method}get url(){return y.format(this[Bo].parsedURL)}get headers(){return this[Bo].headers}get redirect(){return this[Bo].redirect}get signal(){return this[Bo].signal}get referrer(){return"no-referrer"===this[Bo].referrer?"":"client"===this[Bo].referrer?"about:client":this[Bo].referrer?this[Bo].referrer.toString():void 0}get referrerPolicy(){return this[Bo].referrerPolicy}set referrerPolicy(e){this[Bo].referrerPolicy=function(e){if(!Mo.has(e))throw new TypeError(`Invalid referrerPolicy: ${e}`);return e}(e)}clone(){return new Jo(this)}get[Symbol.toStringTag](){return"Request"}}Object.defineProperties(Jo.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});const Go=e=>{const{parsedURL:t}=e[Bo],n=new Ro(e[Bo].headers);n.has("Accept")||n.set("Accept","*/*");let r=null;if(null===e.body&&/^(post|put)$/i.test(e.method)&&(r="0"),null!==e.body){const t=(e=>{const{body:t}=e[_o];return null===t?0:Eo(t)?t.size:m.Buffer.isBuffer(t)?t.length:t&&"function"==typeof t.getLengthSync&&t.hasKnownLength&&t.hasKnownLength()?t.getLengthSync():null})(e);"number"!=typeof t||Number.isNaN(t)||(r=String(t))}r&&n.set("Content-Length",r),""===e.referrerPolicy&&(e.referrerPolicy="strict-origin-when-cross-origin"),e.referrer&&"no-referrer"!==e.referrer?e[Bo].referrer=function(e,{referrerURLCallback:t,referrerOriginCallback:n}={}){if("no-referrer"===e.referrer||""===e.referrerPolicy)return null;const r=e.referrerPolicy;if("about:client"===e.referrer)return"no-referrer";const a=e.referrer;let i=Lo(a),o=Lo(a,!0);i.toString().length>4096&&(i=o),t&&(i=t(i)),n&&(o=n(o));const s=new URL(e.url);switch(r){case"no-referrer":return"no-referrer";case"origin":return o;case"unsafe-url":return i;case"strict-origin":return Fo(i)&&!Fo(s)?"no-referrer":o.toString();case"strict-origin-when-cross-origin":return i.origin===s.origin?i:Fo(i)&&!Fo(s)?"no-referrer":o;case"same-origin":return i.origin===s.origin?i:"no-referrer";case"origin-when-cross-origin":return i.origin===s.origin?i:o;case"no-referrer-when-downgrade":return Fo(i)&&!Fo(s)?"no-referrer":i;default:throw new TypeError(`Invalid referrerPolicy: ${r}`)}}(e):e[Bo].referrer="no-referrer",e[Bo].referrer instanceof URL&&n.set("Referer",e.referrer),n.has("User-Agent")||n.set("User-Agent","node-fetch"),e.compress&&!n.has("Accept-Encoding")&&n.set("Accept-Encoding","gzip, deflate, br");let{agent:a}=e;"function"==typeof a&&(a=a(t));const i=(e=>{if(e.search)return e.search;const t=e.href.length-1,n=e.hash||("#"===e.href[t]?"#":"");return"?"===e.href[t-n.length]?"?":""})(t);return{parsedURL:t,options:{path:t.pathname+i,method:e.method,headers:n[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:e.insecureHTTPParser,agent:a}}};class $o extends bo{constructor(e,t="aborted"){super(e,t)}}
/*! node-domexception. MIT License. Jimmy Wärting <https://jimmy.warting.se/opensource> */if(!globalThis.DOMException)try{const{MessageChannel:e}=require("worker_threads"),t=(new e).port1,n=new ArrayBuffer;t.postMessage(n,[n,n])}catch(e){"DOMException"===e.constructor.name&&(globalThis.DOMException=e.constructor)}const qo=new Set(["data:","http:","https:"]);async function zo(e,t){return new Promise(((n,r)=>{const a=new Jo(e,t),{parsedURL:i,options:o}=Go(a);if(!qo.has(i.protocol))throw new TypeError(`node-fetch cannot load ${e}. URL scheme "${i.protocol.replace(/:$/,"")}" is not supported.`);if("data:"===i.protocol){const e=function(e){if(!/^data:/i.test(e))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');const t=(e=e.replace(/\r?\n/g,"")).indexOf(",");if(-1===t||t<=4)throw new TypeError("malformed data: URI");const n=e.substring(5,t).split(";");let r="",a=!1;const i=n[0]||"text/plain";let o=i;for(let e=1;e<n.length;e++)"base64"===n[e]?a=!0:n[e]&&(o+=`;${n[e]}`,0===n[e].indexOf("charset=")&&(r=n[e].substring(8)));n[0]||r.length||(o+=";charset=US-ASCII",r="US-ASCII");const s=a?"base64":"ascii",l=unescape(e.substring(t+1)),c=Buffer.from(l,s);return c.type=i,c.typeFull=o,c.charset=r,c}(a.url),t=new No(e,{headers:{"Content-Type":e.typeFull}});return void n(t)}const s=("https:"===i.protocol?U.default:V.default).request,{signal:l}=a;let c=null;const u=()=>{const e=new $o("The operation was aborted.");r(e),a.body&&a.body instanceof G.default.Readable&&a.body.destroy(e),c&&c.body&&c.body.emit("error",e)};if(l&&l.aborted)return void u();const d=()=>{u(),f()},p=s(i.toString(),o);l&&l.addEventListener("abort",d);const f=()=>{p.abort(),l&&l.removeEventListener("abort",d)};p.on("error",(e=>{r(new vo(`request to ${a.url} failed, reason: ${e.message}`,"system",e)),f()})),function(e,t){const n=m.Buffer.from("0\r\n\r\n");let r,a=!1,i=!1;e.on("response",(e=>{const{headers:t}=e;a="chunked"===t["transfer-encoding"]&&!t["content-length"]})),e.on("socket",(o=>{const s=()=>{if(a&&!i){const e=new Error("Premature close");e.code="ERR_STREAM_PREMATURE_CLOSE",t(e)}},l=e=>{i=0===m.Buffer.compare(e.slice(-5),n),!i&&r&&(i=0===m.Buffer.compare(r.slice(-3),n.slice(0,3))&&0===m.Buffer.compare(e.slice(-2),n.slice(3))),r=e};o.prependListener("close",s),o.on("data",l),e.on("close",(()=>{o.removeListener("close",s),o.removeListener("data",l)}))}))}(p,(e=>{c&&c.body&&c.body.destroy(e)})),process.version<"v14"&&p.on("socket",(e=>{let t;e.prependListener("end",(()=>{t=e._eventsCount})),e.prependListener("close",(n=>{if(c&&t<e._eventsCount&&!n){const e=new Error("Premature close");e.code="ERR_STREAM_PREMATURE_CLOSE",c.body.emit("error",e)}}))})),p.on("response",(e=>{p.setTimeout(0);const i=function(e=[]){return new Ro(e.reduce(((e,t,n,r)=>(n%2==0&&e.push(r.slice(n,n+2)),e)),[]).filter((([e,t])=>{try{return Ko(e),Co(e,String(t)),!0}catch{return!1}})))}(e.rawHeaders);if(Po(e.statusCode)){const s=i.get("Location");let l=null;try{l=null===s?null:new URL(s,a.url)}catch{if("manual"!==a.redirect)return r(new vo(`uri requested responds with an invalid redirect URL: ${s}`,"invalid-redirect")),void f()}switch(a.redirect){case"error":return r(new vo(`uri requested responds with a redirect, redirect mode is set to error: ${a.url}`,"no-redirect")),void f();case"manual":break;case"follow":{if(null===l)break;if(a.counter>=a.follow)return r(new vo(`maximum redirect reached at: ${a.url}`,"max-redirect")),void f();const s={headers:new Ro(a.headers),follow:a.follow,counter:a.counter+1,agent:a.agent,compress:a.compress,method:a.method,body:To(a),signal:a.signal,size:a.size,referrer:a.referrer,referrerPolicy:a.referrerPolicy};if(!((e,t)=>{const n=new URL(t).hostname,r=new URL(e).hostname;return n===r||n.endsWith(`.${r}`)})(a.url,l)||(o=a.url,new URL(l).protocol!==new URL(o).protocol))for(const e of["authorization","www-authenticate","cookie","cookie2"])s.headers.delete(e);if(303!==e.statusCode&&a.body&&t.body instanceof G.default.Readable)return r(new vo("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void f();303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==a.method)||(s.method="GET",s.body=void 0,s.headers.delete("content-length"));const c=function(e){const t=(e.get("referrer-policy")||"").split(/[,\s]+/);let n="";for(const e of t)e&&Mo.has(e)&&(n=e);return n}(i);return c&&(s.referrerPolicy=c),n(zo(new Jo(l,s))),void f()}default:return r(new TypeError(`Redirect option '${a.redirect}' is not a valid value of RequestRedirect`))}}var o;l&&e.once("end",(()=>{l.removeEventListener("abort",d)}));let s=h.pipeline(e,new h.PassThrough,(e=>{e&&r(e)}));process.version<"v12.10"&&e.on("aborted",d);const u={url:a.url,status:e.statusCode,statusText:e.statusMessage,headers:i,size:a.size,counter:a.counter,highWaterMark:a.highWaterMark},m=i.get("Content-Encoding");if(!a.compress||"HEAD"===a.method||null===m||204===e.statusCode||304===e.statusCode)return c=new No(s,u),void n(c);const y={flush:J.default.Z_SYNC_FLUSH,finishFlush:J.default.Z_SYNC_FLUSH};if("gzip"===m||"x-gzip"===m)return s=h.pipeline(s,J.default.createGunzip(y),(e=>{e&&r(e)})),c=new No(s,u),void n(c);if("deflate"===m||"x-deflate"===m){const t=h.pipeline(e,new h.PassThrough,(e=>{e&&r(e)}));return t.once("data",(e=>{s=8==(15&e[0])?h.pipeline(s,J.default.createInflate(),(e=>{e&&r(e)})):h.pipeline(s,J.default.createInflateRaw(),(e=>{e&&r(e)})),c=new No(s,u),n(c)})),void t.once("end",(()=>{c||(c=new No(s,u),n(c))}))}if("br"===m)return s=h.pipeline(s,J.default.createBrotliDecompress(),(e=>{e&&r(e)})),c=new No(s,u),void n(c);c=new No(s,u),n(c)})),(async(e,{body:t})=>{null===t?e.end():await xo(t,e)})(p,a).catch(r)}))}class Wo{constructor({client_id:e,client_secret:t,redirect_uri:n,authorization:r,base_url:a,place_order_config:i,username:o,password:s}){this.generateSignature=async(e,t,n)=>{try{var r=t,a=(n+"").toUpperCase(),i=e,o=this.client_secret;let s=e=>{if(e instanceof Array)var t=[],n=Object.keys(e);else t={},n=Object.keys(e);for(var r in n.sort((function(e,t){return e<t?-1:e>t?1:0})),n){var a=n[r];"object"==typeof e[a]?(e[a]instanceof Array&&(t[a]=s(e[a])),t[a]=s(e[a])):t[a]=e[a]}return t},l=()=>{var e=i.split("?"),t=e[0],n=e[1].split("&");return i=t+"?"+n.sort().join("&"),u(i)},c=()=>{var e=[];return e.push(a.toUpperCase()),i.indexOf("?")>=0?e.push(l()):e.push(u(i)),r&&Object.keys(r).length&&e.push(u(JSON.stringify(s(r)))),e.join("&")},u=e=>encodeURIComponent(e).replace(/[!'()*]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}));return to(c(),o).toString()}catch(e){await(new Vi).jsonError({exception:e,error:"QC generateSignature Error"})}},this.getAuthCode=async(e,t)=>{try{const e=await Ni.post(this.base_url+"/oauth2/verify",{clientId:this.client_id,username:this.username,password:this.password}),{authorizationCode:t}=e.data;return Ji.qc_amazon.AUTH_CODE=t,Ji.qc_amazon.AUTH_CODE_LAST_UPDATED=(new Date).getTime(),{code:t}}catch(n){return await(new Vi).jsonError({exception:n,error:"QC getAuthCode Error"},e,t),{codeException:!0}}},this.getOAuthToken=async(e,t,n)=>{try{const t=await Ni.post(this.base_url+"/oauth2/token",{clientId:this.client_id,clientSecret:this.client_secret,authorizationCode:e}),{token:n}=t.data;return Ji.qc_amazon.OAUTH_CODE=n,Ji.qc_amazon.OAUTH_CODE_LAST_UPDATED=(new Date).getTime(),{access_token:n}}catch(e){return await(new Vi).jsonError({exception:e,error:"QC getOAuthToken Error"},t,n),{oAuthException:!0}}},this.getOrderStatus=async(e,t,n)=>{try{const r=this.base_url+`/rest/v3/order/${e}/status`,a={connection:"close","content-type":"application/json",dateatclient:(new Date).toISOString()+"",signature:await this.generateSignature(r,null,"GET"),"accept-encoding":"gzip, deflate, br",Authorization:r.includes("zeus")?"":`Bearer ${t}`};r.includes("zeus")&&(a["sp-qc-auth"]=`Bearer ${t}`);const i=await zo(r,{headers:a,method:"GET"}),o=await i.json();return await(new Vi).log(`get Order Status${JSON.stringify(i)}`,!1,e,n),{response:o}}catch(t){return await(new Vi).jsonError({exception:t,error:"QC getOrderStatus Error"},e,n),{oAuthException:!0}}},this.placeVouchersOrder=async({qty:e,vendorSku:t,access_token:n,referenceId:r,price:a,currencyISOCode:i,syncOnly:o,vendor_code:s})=>{try{const l={address:{firstname:this.place_order_config.firstname,lastname:this.place_order_config.lastname,email:this.place_order_config.email,telephone:this.place_order_config.telephone,line1:this.place_order_config.line1,line2:this.place_order_config.line2,city:this.place_order_config.city,region:this.place_order_config.region,country:this.place_order_config.country,postcode:this.place_order_config.postcode,company:this.place_order_config.company,billToThis:!0},payments:[{code:"svc",amount:a*e}],refno:r,syncOnly:o,deliveryMode:"API",products:[{sku:t,price:a,qty:e,currency:i,theme:""}]};await(new Vi).log(`QC-AMAZON Body:${JSON.stringify(l)}`,null,r,s),await(new Vi).log(`QC-AMAZON access_token:${n}`,null,r,s);const c=this.base_url+"/rest/v3/orders",u={connection:"close","content-type":"application/json",dateatclient:(new Date).toISOString()+"",signature:await this.generateSignature(c,l,"POST"),"accept-encoding":"gzip, deflate, br",Authorization:c.includes("zeus")?"":`Bearer ${n}`};c.includes("zeus")&&(u["sp-qc-auth"]=`Bearer ${n}`);const d=await zo(c,{headers:u,body:JSON.stringify(l),method:"POST"}),p=await d.json();let{status:h,message:m,cards:f,orderId:y,code:g}=p,b=null,v=null,w="COMPLETE"==h||"PROCESSING"==h;try{b=f.map((e=>({cardnumber:e.cardNumber,pin_or_url:e.cardPin,expiry:e.validity})))}catch(e){w=!1}try{v=p.payments[0].balance}catch(e){await(new Vi).jsonError({exception:e,error:"Wallet balance retrieval Error"},r,s)}return{vouchers:b,success:w,message:m,orderId:y,status:h,statusCode:g,walletBalance:v}}catch(e){return await(new Vi).jsonError({exception:e,error:"QC placeVouchersOrder Error"},r,s),{orderException:!0}}},this.client_id=e,this.client_secret=t,this.redirect_uri=n,this.authorization=r,this.base_url=a,this.place_order_config=i,this.username=o,this.password=s}async getOlderOrderDetails(e,t,n,r){try{const n=this.base_url+`/rest/v3/order/${e}/cards/?limit=400`,r={connection:"close","content-type":"application/json",dateatclient:(new Date).toISOString()+"",signature:await this.generateSignature(n,null,"GET"),"accept-encoding":"gzip, deflate, br",Authorization:n.includes("zeus")?"":`Bearer ${t}`};n.includes("zeus")&&(r["sp-qc-auth"]=`Bearer ${t}`);const a=await zo(n,{headers:r,method:"GET"}),i=await a.json();let{cards:o}=i,s=!1,l=null;try{l=o.map((e=>({cardnumber:e.cardNumber,pin_or_url:e.cardPin,expiry:e.validity}))),s=!0}catch(e){s=!1}return{vouchers:l,success:s,message:""}}catch(e){return await(new Vi).jsonError({exception:e,error:"QC getOlderOrderDetails Error"},n,r),{oldOrderException:!0,vendorCode:r}}}async getCategory(e){try{const t=this.base_url+"/rest/v3/catalog/categories",n={connection:"close","content-type":"application/json",dateatclient:(new Date).toISOString()+"",signature:await this.generateSignature(t,null,"GET"),"accept-encoding":"gzip, deflate, br",Authorization:t.includes("zeus")?"":`Bearer ${e}`};t.includes("zeus")&&(n["sp-qc-auth"]=`Bearer ${e}`);const r=await zo(t,{headers:n,method:"GET"}),a=await r.json();return{categoryId:a.id}}catch(e){return await(new Vi).jsonError({exception:e,error:"QC getCategory Error"}),null}}async getProducts(e,t){try{await(new Vi).log(`categoryId ${e}`,!1,null,null);const n=this.base_url+`/rest/v3/catalog/categories/${e}/products`,r={connection:"close","content-type":"application/json",dateatclient:(new Date).toISOString()+"",signature:await this.generateSignature(n,null,"GET"),"accept-encoding":"gzip, deflate, br",Authorization:n.includes("zeus")?"":`Bearer ${t}`};n.includes("zeus")&&(r["sp-qc-auth"]=`Bearer ${t}`);const a=await zo(n,{headers:r,method:"GET"}),i=(await a.json()).products;return await(new Vi).log(`productList ${JSON.stringify(i)}`,!1,null,null),{productList:i}}catch(e){return await(new Vi).jsonError({exception:e,error:"QC getCategory Error"},null,null),null}}}var Yo={AED:{name:"United Arab Emirates Dirham",demonym:"UAE",majorSingle:"Dirham",majorPlural:"Dirhams",ISOnum:784,symbol:"د.إ.",symbolNative:"د.إ.",minorSingle:"Fils",minorPlural:"Fils",ISOdigits:2,decimals:2,numToBasic:100},AFN:{name:"Afghan Afghani",demonym:"Afghan",majorSingle:"Afghani",majorPlural:"Afghani",ISOnum:971,symbol:"Af",symbolNative:"؋",minorSingle:"Pul",minorPlural:"Pul",ISOdigits:2,decimals:2,numToBasic:100},ALL:{name:"Albanian Lek",demonym:"Albanian",majorSingle:"Lek",majorPlural:"Lekë",ISOnum:8,symbol:"L",symbolNative:"L",minorSingle:"Qindarka",minorPlural:"Qindarka",ISOdigits:2,decimals:2,numToBasic:100},AMD:{name:"Armenian Dram",demonym:"Armenian",majorSingle:"Dram",majorPlural:"Dram",ISOnum:51,symbol:"֏",symbolNative:"դր",minorSingle:"Luma",minorPlural:"Luma",ISOdigits:2,decimals:2,numToBasic:100},ANG:{name:"Netherlands Antillean Guilder",demonym:"Netherlands Antillean",majorSingle:"Guilder",majorPlural:"Guilders",ISOnum:532,symbol:"ƒ",symbolNative:"ƒ",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},AOA:{name:"Angolan Kwanza",demonym:"Angolan",majorSingle:"Kwanza",majorPlural:"Kwanza",ISOnum:973,symbol:"Kz",symbolNative:"Kz",minorSingle:"Centimo",minorPlural:"Centimos",ISOdigits:2,decimals:2,numToBasic:100},ARS:{name:"Argentine Peso",demonym:"Argentine",majorSingle:"Peso",majorPlural:"Pesos",ISOnum:32,symbol:"AR$",symbolNative:"$",minorSingle:"Centavo",minorPlural:"Centavos",ISOdigits:2,decimals:2,numToBasic:100},AUD:{name:"Australian Dollar",demonym:"Australian",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:36,symbol:"AU$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},AWG:{name:"Aruban Florin",demonym:"Aruban",majorSingle:"Florin",majorPlural:"Florin",ISOnum:533,symbol:"ƒ",symbolNative:"ƒ",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},AZN:{name:"Azerbaijani Manat",demonym:"Azerbaijani",majorSingle:"Manat",majorPlural:"Manat",ISOnum:944,symbol:"ман",symbolNative:"₼",minorSingle:"Qapik",minorPlural:"Qapik",ISOdigits:2,decimals:2,numToBasic:100},BAM:{name:"Bosnia and Herzegovina Convertible Mark",demonym:"Bosnia-Herzegovina",majorSingle:"Convertible Mark",majorPlural:"Marks",ISOnum:977,symbol:"KM",symbolNative:"КМ",minorSingle:"Fening",minorPlural:"Fening",ISOdigits:2,decimals:2,numToBasic:100},BBD:{name:"Barbadian Dollar",demonym:"Barbadian",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:52,symbol:"BBD$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},BDT:{name:"Bangladeshi Taka",demonym:"Bangladeshi",majorSingle:"Taka",majorPlural:"Taka",ISOnum:50,symbol:"৳",symbolNative:"৳",minorSingle:"Poisha",minorPlural:"Poisha",ISOdigits:2,decimals:2,numToBasic:100},BGN:{name:"Bulgarian Lev",demonym:"Bulgarian",majorSingle:"Lev",majorPlural:"Leva",ISOnum:975,symbol:"лв.",symbolNative:"лв.",minorSingle:"Stotinka",minorPlural:"Stotinki",ISOdigits:2,decimals:2,numToBasic:100},BHD:{name:"Bahraini Dinar",demonym:"Bahraini",majorSingle:"Dinar",majorPlural:"Dinars",ISOnum:48,symbol:"BD",symbolNative:"د.ب.",minorSingle:"Fils",minorPlural:"Fils",ISOdigits:3,decimals:3,numToBasic:1e3},BIF:{name:"Burundian Franc",demonym:"Burundian",majorSingle:"Franc",majorPlural:"Francs",ISOnum:108,symbol:"FBu",symbolNative:"FBu",minorSingle:"Centime",minorPlural:"Centimes",ISOdigits:0,decimals:2,numToBasic:100},BMD:{name:"Bermudian Dollar",demonym:"Bermudian",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:60,symbol:"$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},BND:{name:"Brunei Dollar",demonym:"Brunei",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:96,symbol:"B$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},BOB:{name:"Bolivian Boliviano",demonym:"Bolivian",majorSingle:"Boliviano",majorPlural:"Bolivianos",ISOnum:68,symbol:"Bs.",symbolNative:"Bs.",minorSingle:"Centavo",minorPlural:"Centavos",ISOdigits:2,decimals:2,numToBasic:100},BRL:{name:"Brazilian Real",demonym:"Brazilian",majorSingle:"Real",majorPlural:"Reais",ISOnum:986,symbol:"R$",symbolNative:"R$",minorSingle:"Centavo",minorPlural:"Centavos",ISOdigits:2,decimals:2,numToBasic:100},BSD:{name:"Bahamian Dollar",demonym:"Bahamian",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:44,symbol:"$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},BTN:{name:"Bhutanese Ngultrum",demonym:"Bhutanese",majorSingle:"Ngultrum",majorPlural:"Ngultrums",ISOnum:64,symbol:"Nu.",symbolNative:"Nu.",minorSingle:"Chetrum",minorPlural:"Chetrums",ISOdigits:2,decimals:2,numToBasic:100},BWP:{name:"Botswana Pula",demonym:"Botswana",majorSingle:"Pula",majorPlural:"Pula",ISOnum:72,symbol:"P",symbolNative:"P",minorSingle:"Thebe",minorPlural:"Thebe",ISOdigits:2,decimals:2,numToBasic:100},BYN:{name:"Belarusian Ruble",demonym:"Belarusian",majorSingle:"Ruble",majorPlural:"Rubles",ISOnum:933,symbol:"Br",symbolNative:"руб.",minorSingle:"Kapiejka",minorPlural:"Kapiejka",ISOdigits:2,decimals:2,numToBasic:100},BZD:{name:"Belize Dollar",demonym:"Belize",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:84,symbol:"BZ$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},CAD:{name:"Canadian Dollar",demonym:"Canadian",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:124,symbol:"CA$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},CDF:{name:"Congolese Franc",demonym:"Congolese",majorSingle:"Franc",majorPlural:"Francs",ISOnum:976,symbol:"FC",symbolNative:"₣",minorSingle:"Centime",minorPlural:"Centimes",ISOdigits:2,decimals:2,numToBasic:100},CHF:{name:"Swiss Franc",demonym:"Swiss",majorSingle:"Franc",majorPlural:"Francs",ISOnum:756,symbol:"Fr.",symbolNative:"₣",minorSingle:"Centime",minorPlural:"Centimes",ISOdigits:2,decimals:2,numToBasic:100},CKD:{name:"Cook Islands Dollar",demonym:"Cook Islands",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:null,symbol:"$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},CLP:{name:"Chilean Peso",demonym:"Chilean",majorSingle:"Peso",majorPlural:"Pesos",ISOnum:152,symbol:"CL$",symbolNative:"$",minorSingle:"Centavo",minorPlural:"Centavos",ISOdigits:0,decimals:0,numToBasic:100},CNY:{name:"Chinese Yuan",demonym:"Chinese",majorSingle:"Yuan",majorPlural:"Yuan",ISOnum:156,symbol:"CN¥",symbolNative:"¥元",minorSingle:"Fen",minorPlural:"Fen",ISOdigits:2,decimals:2,numToBasic:100},COP:{name:"Colombian Peso",demonym:"Colombian",majorSingle:"Peso",majorPlural:"Pesos",ISOnum:170,symbol:"CO$",symbolNative:"$",minorSingle:"Centavo",minorPlural:"Centavos",ISOdigits:2,decimals:2,numToBasic:100},CRC:{name:"Costa Rican Colon",demonym:"Costa Rican",majorSingle:"Colón",majorPlural:"Colones",ISOnum:188,symbol:"₡",symbolNative:"₡",minorSingle:"Centimo",minorPlural:"Centimos",ISOdigits:2,decimals:2,numToBasic:100},CUC:{name:"Cuban convertible Peso",demonym:"Cuban Convertible",majorSingle:"Peso",majorPlural:"Pesos",ISOnum:931,symbol:"CUC$",symbolNative:"$",minorSingle:"Centavo",minorPlural:"Centavos",ISOdigits:2,decimals:2,numToBasic:100},CUP:{name:"Cuban Peso",demonym:"Cuban",majorSingle:"Peso",majorPlural:"Pesos",ISOnum:192,symbol:"$MN",symbolNative:"₱",minorSingle:"Centavo",minorPlural:"Centavos",ISOdigits:2,decimals:2,numToBasic:100},CVE:{name:"Cabo Verdean Escudo",demonym:"Cabo Verdean",majorSingle:"Escudo",majorPlural:"Escudo",ISOnum:132,symbol:"CV$",symbolNative:"$",minorSingle:"Centavo",minorPlural:"Centavos",ISOdigits:2,decimals:2,numToBasic:100},CZK:{name:"Czech Koruna",demonym:"Czech",majorSingle:"Koruna",majorPlural:"Koruny",ISOnum:203,symbol:"Kč",symbolNative:"Kč",minorSingle:"Haléř",minorPlural:"Haléř",ISOdigits:2,decimals:2,numToBasic:100},DJF:{name:"Djiboutian Franc",demonym:"Djiboutian",majorSingle:"Franc",majorPlural:"Francs",ISOnum:262,symbol:"Fdj",symbolNative:"ف.ج.",minorSingle:"Centime",minorPlural:"Centimes",ISOdigits:0,decimals:2,numToBasic:100},DKK:{name:"Danish Krone",demonym:"Danish",majorSingle:"Krone",majorPlural:"Kroner",ISOnum:208,symbol:"kr.",symbolNative:"kr.",minorSingle:"Øre",minorPlural:"Øre",ISOdigits:2,decimals:2,numToBasic:100},DOP:{name:"Dominican Peso",demonym:"Dominican",majorSingle:"Peso",majorPlural:"Pesos",ISOnum:214,symbol:"RD$",symbolNative:"$",minorSingle:"Centavo",minorPlural:"Centavos",ISOdigits:2,decimals:2,numToBasic:100},DZD:{name:"Algerian Dinar",demonym:"Algerian",majorSingle:"Dinar",majorPlural:"Dinars",ISOnum:12,symbol:"DA",symbolNative:"د.ج.",minorSingle:"Santeem",minorPlural:"Santeems",ISOdigits:2,decimals:2,numToBasic:100},EGP:{name:"Egyptian Pound",demonym:"Egyptian",majorSingle:"Pound",majorPlural:"Pounds",ISOnum:818,symbol:"E£",symbolNative:"ج.م.",minorSingle:"Qirsh",minorPlural:"Qirsh",ISOdigits:2,decimals:2,numToBasic:100},EHP:{name:"Sahrawi Peseta",demonym:"Sahrawi",majorSingle:"Peseta",majorPlural:"Pesetas",ISOnum:null,symbol:"Ptas.",symbolNative:"Ptas.",minorSingle:"Céntimo",minorPlural:"Céntimos",ISOdigits:2,decimals:2,numToBasic:100},ERN:{name:"Eritrean Nakfa",demonym:"Eritrean",majorSingle:"Nakfa",majorPlural:"Nakfa",ISOnum:232,symbol:"Nkf",symbolNative:"ناكفا",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},ETB:{name:"Ethiopian Birr",demonym:"Ethiopian",majorSingle:"Birr",majorPlural:"Birr",ISOnum:230,symbol:"Br",symbolNative:"ብር",minorSingle:"Santim",minorPlural:"Santim",ISOdigits:2,decimals:2,numToBasic:100},EUR:{name:"Euro",demonym:"",majorSingle:"Euro",majorPlural:"Euros",ISOnum:978,symbol:"€",symbolNative:"€",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},FJD:{name:"Fijian Dollar",demonym:"Fijian",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:242,symbol:"FJ$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},FKP:{name:"Falkland Islands Pound",demonym:"Falkland Islands",majorSingle:"Pound",majorPlural:"Pounds",ISOnum:238,symbol:"FK£",symbolNative:"£",minorSingle:"Penny",minorPlural:"Pence",ISOdigits:2,decimals:2,numToBasic:100},FOK:{name:"Faroese Króna",demonym:"Faroese",majorSingle:"Króna",majorPlural:"Krónas",ISOnum:null,symbol:"kr",symbolNative:"kr",minorSingle:"Oyra",minorPlural:"Oyra",ISOdigits:2,decimals:2,numToBasic:100},GBP:{name:"Pound Sterling",demonym:"Pound Sterling",majorSingle:"Pound",majorPlural:"Pounds",ISOnum:826,symbol:"£",symbolNative:"£",minorSingle:"Penny",minorPlural:"Pence",ISOdigits:2,decimals:2,numToBasic:100},GEL:{name:"Georgian Lari",demonym:"Georgian",majorSingle:"Lari",majorPlural:"Lari",ISOnum:981,symbol:"₾",symbolNative:"₾",minorSingle:"Tetri",minorPlural:"Tetri",ISOdigits:2,decimals:2,numToBasic:100},GGP:{name:"Guernsey Pound",demonym:"Guernsey",majorSingle:"Pound",majorPlural:"Pounds",ISOnum:null,symbol:"£",symbolNative:"£",minorSingle:"Penny",minorPlural:"Pence",ISOdigits:2,decimals:2,numToBasic:100},GHS:{name:"Ghanaian Cedi",demonym:"Ghanaian",majorSingle:"Cedi",majorPlural:"Cedis",ISOnum:936,symbol:"GH₵",symbolNative:"₵",minorSingle:"Pesewa",minorPlural:"Pesewas",ISOdigits:2,decimals:2,numToBasic:100},GIP:{name:"Gibraltar Pound",demonym:"Gibraltar",majorSingle:"Pound",majorPlural:"Pounds",ISOnum:292,symbol:"£",symbolNative:"£",minorSingle:"Penny",minorPlural:"Pence",ISOdigits:2,decimals:2,numToBasic:100},GMD:{name:"Gambian Dalasi",demonym:"Gambian",majorSingle:"Dalasi",majorPlural:"Dalasis",ISOnum:270,symbol:"D",symbolNative:"D",minorSingle:"Butut",minorPlural:"Bututs",ISOdigits:2,decimals:2,numToBasic:100},GNF:{name:"Guinean Franc",demonym:"Guinean",majorSingle:"Franc",majorPlural:"Francs",ISOnum:324,symbol:"FG",symbolNative:"FG",minorSingle:"Centime",minorPlural:"Centimes",ISOdigits:0,decimals:2,numToBasic:100},GTQ:{name:"Guatemalan Quetzal",demonym:"Guatemalan",majorSingle:"Quetzal",majorPlural:"Quetzales",ISOnum:320,symbol:"Q",symbolNative:"$",minorSingle:"Centavo",minorPlural:"Centavos",ISOdigits:2,decimals:2,numToBasic:100},GYD:{name:"Guyanese Dollar",demonym:"Guyanese",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:328,symbol:"G$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},HKD:{name:"Hong Kong Dollar",demonym:"Hong Kong",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:344,symbol:"HK$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},HNL:{name:"Honduran Lempira",demonym:"Honduran",majorSingle:"Lempira",majorPlural:"Lempiras",ISOnum:340,symbol:"L",symbolNative:"L",minorSingle:"Centavo",minorPlural:"Centavos",ISOdigits:2,decimals:2,numToBasic:100},HRK:{name:"Croatian Kuna",demonym:"Croatian",majorSingle:"Kuna",majorPlural:"Kuna",ISOnum:191,symbol:"kn",symbolNative:"kn",minorSingle:"Lipa",minorPlural:"Lipa",ISOdigits:2,decimals:2,numToBasic:100},HTG:{name:"Haitian Gourde",demonym:"Haitian",majorSingle:"Gourde",majorPlural:"Gourdes",ISOnum:332,symbol:"G",symbolNative:"G",minorSingle:"Centime",minorPlural:"Centimes",ISOdigits:2,decimals:2,numToBasic:100},HUF:{name:"Hungarian Forint",demonym:"Hungarian",majorSingle:"Forint",majorPlural:"Forint",ISOnum:348,symbol:"Ft",symbolNative:"Ft",minorSingle:"fillér",minorPlural:"fillér",ISOdigits:2,decimals:2,numToBasic:100},IDR:{name:"Indonesian Rupiah",demonym:"Indonesian",majorSingle:"Rupiah",majorPlural:"Rupiah",ISOnum:360,symbol:"Rp",symbolNative:"Rp",minorSingle:"Sen",minorPlural:"Sen",ISOdigits:2,decimals:2,numToBasic:100},ILS:{name:"Israeli new Shekel",demonym:"Israeli",majorSingle:"Shekel",majorPlural:"Shekels",ISOnum:376,symbol:"₪",symbolNative:"₪",minorSingle:"Agora",minorPlural:"Agoras",ISOdigits:2,decimals:2,numToBasic:100},IMP:{name:"Manx Pound",demonym:"Manx",majorSingle:"Pound",majorPlural:"Pounds",ISOnum:null,symbol:"£",symbolNative:"£",minorSingle:"Penny",minorPlural:"Pence",ISOdigits:2,decimals:2,numToBasic:100},INR:{name:"Indian Rupee",demonym:"Indian",majorSingle:"Rupee",majorPlural:"Rupees",ISOnum:356,symbol:"Rs.",symbolNative:"₹",minorSingle:"Paisa",minorPlural:"Paise",ISOdigits:2,decimals:2,numToBasic:100},IQD:{name:"Iraqi Dinar",demonym:"Iraqi",majorSingle:"Dinar",majorPlural:"Dinars",ISOnum:368,symbol:"د.ع.",symbolNative:"د.ع.",minorSingle:"Fils",minorPlural:"Fils",ISOdigits:3,decimals:3,numToBasic:1e3},IRR:{name:"Iranian Rial",demonym:"Iranian",majorSingle:"Rial",majorPlural:"Rials",ISOnum:364,symbol:"﷼",symbolNative:"﷼",minorSingle:"Dinar",minorPlural:"Dinars",ISOdigits:2,decimals:2,numToBasic:100},ISK:{name:"Icelandic Krona",demonym:"Icelandic",majorSingle:"Krona",majorPlural:"Krónur",ISOnum:352,symbol:"kr",symbolNative:"kr",minorSingle:"Aurar",minorPlural:"Aurar",ISOdigits:0,decimals:2,numToBasic:100},JEP:{name:"Jersey Pound",demonym:"Jersey",majorSingle:"Pound",majorPlural:"Pounds",ISOnum:null,symbol:"£",symbolNative:"£",minorSingle:"Penny",minorPlural:"Pence",ISOdigits:2,decimals:2,numToBasic:100},JMD:{name:"Jamaican Dollar",demonym:"Jamaican",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:388,symbol:"J$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},JOD:{name:"Jordanian Dinar",demonym:"Jordanian",majorSingle:"Dinar",majorPlural:"Dinars",ISOnum:400,symbol:"JD",symbolNative:"د.أ.",minorSingle:"Fils",minorPlural:"Fils",ISOdigits:3,decimals:3,numToBasic:1e3},JPY:{name:"Japanese Yen",demonym:"Japanese",majorSingle:"Yen",majorPlural:"Yen",ISOnum:392,symbol:"¥",symbolNative:"¥",minorSingle:"Sen",minorPlural:"Sen",ISOdigits:0,decimals:2,numToBasic:100},KES:{name:"Kenyan Shilling",demonym:"Kenyan",majorSingle:"Shilling",majorPlural:"Shillings",ISOnum:404,symbol:"KSh",symbolNative:"KSh",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},KGS:{name:"Kyrgyzstani Som",demonym:"Kyrgyzstani",majorSingle:"Som",majorPlural:"Som",ISOnum:417,symbol:"с",symbolNative:"с",minorSingle:"Tyiyn",minorPlural:"Tyiyn",ISOdigits:2,decimals:2,numToBasic:100},KHR:{name:"Cambodian Riel",demonym:"Cambodian",majorSingle:"Riel",majorPlural:"Riels",ISOnum:116,symbol:"៛",symbolNative:"៛",minorSingle:"Sen",minorPlural:"Sen",ISOdigits:2,decimals:2,numToBasic:100},KID:{name:"Kiribati Dollar",demonym:"Kiribati",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:null,symbol:"$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},KMF:{name:"Comorian Franc",demonym:"Comorian",majorSingle:"Franc",majorPlural:"Francs",ISOnum:174,symbol:"CF",symbolNative:"CF",minorSingle:"Centime",minorPlural:"Centimes",ISOdigits:0,decimals:2,numToBasic:100},KPW:{name:"North Korean Won",demonym:"North Korean",majorSingle:"Won",majorPlural:"Won",ISOnum:408,symbol:"₩",symbolNative:"₩",minorSingle:"Chon",minorPlural:"Chon",ISOdigits:2,decimals:2,numToBasic:100},KRW:{name:"South Korean Won",demonym:"South Korean",majorSingle:"Won",majorPlural:"Won",ISOnum:410,symbol:"₩",symbolNative:"₩",minorSingle:"Jeon",minorPlural:"Jeon",ISOdigits:0,decimals:2,numToBasic:100},KWD:{name:"Kuwaiti Dinar",demonym:"Kuwaiti",majorSingle:"Dinar",majorPlural:"Dinars",ISOnum:414,symbol:"KD",symbolNative:"د.ك.",minorSingle:"Fils",minorPlural:"Fils",ISOdigits:3,decimals:3,numToBasic:1e3},KYD:{name:"Cayman Islands Dollar",demonym:"Cayman Islands",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:136,symbol:"CI$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},KZT:{name:"Kazakhstani Tenge",demonym:"Kazakhstani",majorSingle:"Tenge",majorPlural:"Tenge",ISOnum:398,symbol:"₸",symbolNative:"₸",minorSingle:"Tıyn",minorPlural:"Tıyn",ISOdigits:2,decimals:2,numToBasic:100},LAK:{name:"Lao Kip",demonym:"Lao",majorSingle:"Kip",majorPlural:"Kip",ISOnum:418,symbol:"₭N",symbolNative:"₭",minorSingle:"Att",minorPlural:"Att",ISOdigits:2,decimals:2,numToBasic:100},LBP:{name:"Lebanese Pound",demonym:"Lebanese",majorSingle:"Pound",majorPlural:"Pounds",ISOnum:422,symbol:"LL.",symbolNative:"ل.ل.",minorSingle:"Qirsh",minorPlural:"Qirsh",ISOdigits:2,decimals:2,numToBasic:100},LKR:{name:"Sri Lankan Rupee",demonym:"Sri Lankan",majorSingle:"Rupee",majorPlural:"Rupees",ISOnum:144,symbol:"Rs.",symbolNative:"රු or ரூ",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},LRD:{name:"Liberian Dollar",demonym:"Liberian",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:430,symbol:"L$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},LSL:{name:"Lesotho Loti",demonym:"Lesotho",majorSingle:"Loti",majorPlural:"maLoti",ISOnum:426,symbol:"L",symbolNative:"L",minorSingle:"Sente",minorPlural:"Lisente",ISOdigits:2,decimals:2,numToBasic:100},LYD:{name:"Libyan Dinar",demonym:"Libyan",majorSingle:"Dinar",majorPlural:"Dinars",ISOnum:434,symbol:"LD",symbolNative:"ل.د.",minorSingle:"Dirham",minorPlural:"Dirhams",ISOdigits:3,decimals:3,numToBasic:1e3},MAD:{name:"Moroccan Dirham",demonym:"Moroccan",majorSingle:"Dirham",majorPlural:"Dirhams",ISOnum:504,symbol:"DH",symbolNative:"د.م.",minorSingle:"Centime",minorPlural:"Centimes",ISOdigits:2,decimals:2,numToBasic:100},MDL:{name:"Moldovan Leu",demonym:"Moldovan",majorSingle:"Leu",majorPlural:"Lei",ISOnum:498,symbol:"L",symbolNative:"L",minorSingle:"Ban",minorPlural:"Bani",ISOdigits:2,decimals:2,numToBasic:100},MGA:{name:"Malagasy Ariary",demonym:"Malagasy",majorSingle:"Ariary",majorPlural:"Ariary",ISOnum:969,symbol:"Ar",symbolNative:"Ar",minorSingle:"Iraimbilanja",minorPlural:"Iraimbilanja",ISOdigits:2,decimals:0,numToBasic:5},MKD:{name:"Macedonian Denar",demonym:"Macedonian",majorSingle:"Denar",majorPlural:"Denars",ISOnum:807,symbol:"den",symbolNative:"ден",minorSingle:"Deni",minorPlural:"Deni",ISOdigits:2,decimals:2,numToBasic:100},MMK:{name:"Myanmar Kyat",demonym:"Myanmar",majorSingle:"Kyat",majorPlural:"Kyat",ISOnum:104,symbol:"Ks",symbolNative:"Ks",minorSingle:"Pya",minorPlural:"Pya",ISOdigits:2,decimals:2,numToBasic:100},MNT:{name:"Mongolian Tögrög",demonym:"Mongolian",majorSingle:"Tögrög",majorPlural:"Tögrög",ISOnum:496,symbol:"₮",symbolNative:"₮",minorSingle:"möngö",minorPlural:"möngö",ISOdigits:2,decimals:2,numToBasic:100},MOP:{name:"Macanese Pataca",demonym:"Macanese",majorSingle:"Pataca",majorPlural:"Patacas",ISOnum:446,symbol:"MOP$",symbolNative:"MOP$",minorSingle:"Avo",minorPlural:"Avos",ISOdigits:2,decimals:2,numToBasic:100},MRU:{name:"Mauritanian Ouguiya",demonym:"Mauritanian",majorSingle:"Ouguiya",majorPlural:"Ouguiya",ISOnum:929,symbol:"UM",symbolNative:"أ.م.",minorSingle:"Khoums",minorPlural:"Khoums",ISOdigits:2,decimals:0,numToBasic:5},MUR:{name:"Mauritian Rupee",demonym:"Mauritian",majorSingle:"Rupee",majorPlural:"Rupees",ISOnum:480,symbol:"Rs.",symbolNative:"रु ",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},MVR:{name:"Maldivian Rufiyaa",demonym:"Maldivian",majorSingle:"Rufiyaa",majorPlural:"Rufiyaa",ISOnum:462,symbol:"MRf",symbolNative:".ރ",minorSingle:"laari",minorPlural:"laari",ISOdigits:2,decimals:2,numToBasic:100},MWK:{name:"Malawian Kwacha",demonym:"Malawian",majorSingle:"Kwacha",majorPlural:"Kwacha",ISOnum:454,symbol:"MK",symbolNative:"MK",minorSingle:"Tambala",minorPlural:"Tambala",ISOdigits:2,decimals:2,numToBasic:100},MXN:{name:"Mexican Peso",demonym:"Mexican",majorSingle:"Peso",majorPlural:"Pesos",ISOnum:484,symbol:"MX$",symbolNative:"$",minorSingle:"Centavo",minorPlural:"Centavos",ISOdigits:2,decimals:2,numToBasic:100},MYR:{name:"Malaysian Ringgit",demonym:"Malaysian",majorSingle:"Ringgit",majorPlural:"Ringgit",ISOnum:458,symbol:"RM",symbolNative:"RM",minorSingle:"Sen",minorPlural:"Sen",ISOdigits:2,decimals:2,numToBasic:100},MZN:{name:"Mozambican Metical",demonym:"Mozambican",majorSingle:"Metical",majorPlural:"Meticais",ISOnum:943,symbol:"MTn",symbolNative:"MT",minorSingle:"Centavo",minorPlural:"Centavos",ISOdigits:2,decimals:2,numToBasic:100},NAD:{name:"Namibian Dollar",demonym:"Namibian",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:516,symbol:"N$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},NGN:{name:"Nigerian Naira",demonym:"Nigerian",majorSingle:"Naira",majorPlural:"Naira",ISOnum:566,symbol:"₦",symbolNative:"₦",minorSingle:"Kobo",minorPlural:"Kobo",ISOdigits:2,decimals:2,numToBasic:100},NIO:{name:"Nicaraguan Córdoba",demonym:"Nicaraguan",majorSingle:"Córdoba Oro",majorPlural:"Córdoba Oro",ISOnum:558,symbol:"C$",symbolNative:"C$",minorSingle:"Centavo",minorPlural:"Centavos",ISOdigits:2,decimals:2,numToBasic:100},NOK:{name:"Norwegian Krone",demonym:"Norwegian",majorSingle:"Krone",majorPlural:"Kroner",ISOnum:578,symbol:"kr",symbolNative:"kr",minorSingle:"øre",minorPlural:"øre",ISOdigits:2,decimals:2,numToBasic:100},NPR:{name:"Nepalese Rupee",demonym:"Nepalese",majorSingle:"Rupee",majorPlural:"Rupees",ISOnum:524,symbol:"Rs.",symbolNative:"रू",minorSingle:"Paisa",minorPlural:"Paise",ISOdigits:2,decimals:2,numToBasic:100},NZD:{name:"New Zealand Dollar",demonym:"New Zealand",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:554,symbol:"NZ$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},OMR:{name:"Omani Rial",demonym:"Omani",majorSingle:"Rial",majorPlural:"Rials",ISOnum:512,symbol:"OR",symbolNative:"ر.ع.",minorSingle:"Baisa",minorPlural:"Baisa",ISOdigits:3,decimals:3,numToBasic:1e3},PAB:{name:"Panamanian Balboa",demonym:"Panamanian",majorSingle:"Balboa",majorPlural:"Balboa",ISOnum:590,symbol:"B/.",symbolNative:"B/.",minorSingle:"Centésimo",minorPlural:"Centésimos",ISOdigits:2,decimals:2,numToBasic:100},PEN:{name:"Peruvian Sol",demonym:"Peruvian",majorSingle:"Sol",majorPlural:"Soles",ISOnum:604,symbol:"S/.",symbolNative:"S/.",minorSingle:"Céntimo",minorPlural:"Céntimos",ISOdigits:2,decimals:2,numToBasic:100},PGK:{name:"Papua New Guinean Kina",demonym:"Papua New Guinean",majorSingle:"Kina",majorPlural:"Kina",ISOnum:598,symbol:"K",symbolNative:"K",minorSingle:"Toea",minorPlural:"Toea",ISOdigits:2,decimals:2,numToBasic:100},PHP:{name:"Philippine Peso",demonym:"Philippine",majorSingle:"Peso",majorPlural:"Pesos",ISOnum:608,symbol:"₱",symbolNative:"₱",minorSingle:"Sentimo",minorPlural:"Sentimo",ISOdigits:2,decimals:2,numToBasic:100},PKR:{name:"Pakistani Rupee",demonym:"Pakistani",majorSingle:"Rupee",majorPlural:"Rupees",ISOnum:586,symbol:"Rs.",symbolNative:"Rs",minorSingle:"Paisa",minorPlural:"Paise",ISOdigits:2,decimals:2,numToBasic:100},PLN:{name:"Polish Zloty",demonym:"Polish",majorSingle:"Zloty",majorPlural:"Zlotys",ISOnum:985,symbol:"zł",symbolNative:"zł",minorSingle:"Grosz",minorPlural:"Groszy",ISOdigits:2,decimals:2,numToBasic:100},PND:{name:"Pitcairn Islands Dollar",demonym:"Pitcairn Islands",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:null,symbol:"$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},PRB:{name:"Transnistrian Ruble",demonym:"Transnistrian",majorSingle:"Ruble",majorPlural:"Rubles",ISOnum:null,symbol:"р.",symbolNative:"р.",minorSingle:"Kopek",minorPlural:"Kopeks",ISOdigits:2,decimals:2,numToBasic:100},PYG:{name:"Paraguayan Guaraní",demonym:"Paraguayan",majorSingle:"Guaraní",majorPlural:"Guaraníes",ISOnum:600,symbol:"₲",symbolNative:"₲",minorSingle:"Centimo",minorPlural:"Centimos",ISOdigits:0,decimals:2,numToBasic:100},QAR:{name:"Qatari Riyal",demonym:"Qatari",majorSingle:"Riyal",majorPlural:"Riyals",ISOnum:634,symbol:"QR",symbolNative:"ر.ق.",minorSingle:"Dirham",minorPlural:"Dirhams",ISOdigits:2,decimals:2,numToBasic:100},RON:{name:"Romanian Leu",demonym:"Romanian",majorSingle:"Leu",majorPlural:"Lei",ISOnum:946,symbol:"L",symbolNative:"L",minorSingle:"Ban",minorPlural:"Bani",ISOdigits:2,decimals:2,numToBasic:100},RSD:{name:"Serbian Dinar",demonym:"Serbian",majorSingle:"Dinar",majorPlural:"Dinars",ISOnum:941,symbol:"din",symbolNative:"дин",minorSingle:"Para",minorPlural:"Para",ISOdigits:2,decimals:2,numToBasic:100},RUB:{name:"Russian Ruble",demonym:"Russian",majorSingle:"Ruble",majorPlural:"Rubles",ISOnum:643,symbol:"₽",symbolNative:"₽",minorSingle:"Kopek",minorPlural:"Kopeks",ISOdigits:2,decimals:2,numToBasic:100},RWF:{name:"Rwandan Franc",demonym:"Rwandan",majorSingle:"Franc",majorPlural:"Francs",ISOnum:646,symbol:"FRw",symbolNative:"R₣",minorSingle:"Centime",minorPlural:"Centimes",ISOdigits:0,decimals:2,numToBasic:100},SAR:{name:"Saudi Riyal",demonym:"Saudi",majorSingle:"Riyal",majorPlural:"Riyals",ISOnum:682,symbol:"SR",symbolNative:"ر.س.",minorSingle:"Halalah",minorPlural:"Halalahs",ISOdigits:2,decimals:2,numToBasic:100},SBD:{name:"Solomon Islands Dollar",demonym:"Solomon Islands",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:90,symbol:"SI$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},SCR:{name:"Seychellois Rupee",demonym:"Seychellois",majorSingle:"Rupee",majorPlural:"Rupees",ISOnum:690,symbol:"Rs.",symbolNative:"Rs",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},SDG:{name:"Sudanese Pound",demonym:"Sudanese",majorSingle:"Pound",majorPlural:"Pounds",ISOnum:938,symbol:"£SD",symbolNative:"ج.س.",minorSingle:"Qirsh",minorPlural:"Qirsh",ISOdigits:2,decimals:2,numToBasic:100},SEK:{name:"Swedish Krona",demonym:"Swedish",majorSingle:"Krona",majorPlural:"Kronor",ISOnum:752,symbol:"kr",symbolNative:"kr",minorSingle:"Öre",minorPlural:"Öre",ISOdigits:2,decimals:2,numToBasic:100},SGD:{name:"Singapore Dollar",demonym:"Singapore",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:702,symbol:"S$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},SHP:{name:"Saint Helena Pound",demonym:"Saint Helena",majorSingle:"Pound",majorPlural:"Pounds",ISOnum:654,symbol:"£",symbolNative:"£",minorSingle:"Penny",minorPlural:"Pence",ISOdigits:2,decimals:2,numToBasic:100},SLL:{name:"Sierra Leonean Leone",demonym:"Sierra Leonean",majorSingle:"Leone",majorPlural:"Leones",ISOnum:694,symbol:"Le",symbolNative:"Le",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},SLS:{name:"Somaliland Shilling",demonym:"Somaliland",majorSingle:"Shilling",majorPlural:"Shillings",ISOnum:null,symbol:"Sl",symbolNative:"Sl",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},SOS:{name:"Somali Shilling",demonym:"Somali",majorSingle:"Shilling",majorPlural:"Shillings",ISOnum:706,symbol:"Sh.So.",symbolNative:"Ssh",minorSingle:"Senti",minorPlural:"Senti",ISOdigits:2,decimals:2,numToBasic:100},SRD:{name:"Surinamese Dollar",demonym:"Surinamese",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:968,symbol:"Sr$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},SSP:{name:"South Sudanese Pound",demonym:"South Sudanese",majorSingle:"Pound",majorPlural:"Pounds",ISOnum:728,symbol:"SS£",symbolNative:"SS£",minorSingle:"Qirsh",minorPlural:"Qirsh",ISOdigits:2,decimals:2,numToBasic:100},STN:{name:"Sao Tome and Príncipe Dobra",demonym:"Sao Tome",majorSingle:"Dobra",majorPlural:"Dobras",ISOnum:930,symbol:"Db",symbolNative:"Db",minorSingle:"Centimo",minorPlural:"Centimos",ISOdigits:2,decimals:2,numToBasic:100},SVC:{name:"Salvadoran Colón",demonym:"Salvadoran",majorSingle:"Colón",majorPlural:"Colones",ISOnum:222,symbol:"₡",symbolNative:"₡",minorSingle:"Centavo",minorPlural:"Centavos",ISOdigits:2,decimals:2,numToBasic:100},SYP:{name:"Syrian Pound",demonym:"Syrian",majorSingle:"Pound",majorPlural:"Pounds",ISOnum:760,symbol:"LS",symbolNative:"ل.س.",minorSingle:"Qirsh",minorPlural:"Qirsh",ISOdigits:2,decimals:2,numToBasic:100},SZL:{name:"Swazi Lilangeni",demonym:"Swazi",majorSingle:"Lilangeni",majorPlural:"Emalangeni",ISOnum:748,symbol:"L",symbolNative:"L",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},THB:{name:"Thai Baht",demonym:"Thai",majorSingle:"Baht",majorPlural:"Baht",ISOnum:764,symbol:"฿",symbolNative:"฿",minorSingle:"Satang",minorPlural:"Satang",ISOdigits:2,decimals:2,numToBasic:100},TJS:{name:"Tajikistani Somoni",demonym:"Tajikistani",majorSingle:"Somoni",majorPlural:"Somoni",ISOnum:972,symbol:"SM",symbolNative:"SM",minorSingle:"Diram",minorPlural:"Diram",ISOdigits:2,decimals:2,numToBasic:100},TMT:{name:"Turkmenistan Manat",demonym:"Turkmenistan",majorSingle:"Manat",majorPlural:"Manat",ISOnum:934,symbol:"m.",symbolNative:"T",minorSingle:"Tenge",minorPlural:"Tenge",ISOdigits:2,decimals:2,numToBasic:100},TND:{name:"Tunisian Dinar",demonym:"Tunisian",majorSingle:"Dinar",majorPlural:"Dinars",ISOnum:788,symbol:"DT",symbolNative:"د.ت.",minorSingle:"Millime",minorPlural:"Millime",ISOdigits:3,decimals:3,numToBasic:1e3},TOP:{name:"Tongan Paʻanga",demonym:"Tongan",majorSingle:"Pa'anga",majorPlural:"Pa'anga",ISOnum:776,symbol:"T$",symbolNative:"PT",minorSingle:"Seniti",minorPlural:"Seniti",ISOdigits:2,decimals:2,numToBasic:100},TRY:{name:"Turkish Lira",demonym:"Turkish",majorSingle:"Lira",majorPlural:"Lira",ISOnum:949,symbol:"TL",symbolNative:"₺",minorSingle:"Kuruş",minorPlural:"Kuruş",ISOdigits:2,decimals:2,numToBasic:100},TTD:{name:"Trinidad and Tobago Dollar",demonym:"Trinidad and Tobago",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:780,symbol:"TT$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},TVD:{name:"Tuvaluan Dollar",demonym:"Tuvaluan",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:null,symbol:"$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},TWD:{name:"New Taiwan Dollar",demonym:"New Taiwan",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:901,symbol:"NT$",symbolNative:"圓",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},TZS:{name:"Tanzanian Shilling",demonym:"Tanzanian",majorSingle:"Shilling",majorPlural:"Shillings",ISOnum:834,symbol:"TSh",symbolNative:"TSh",minorSingle:"Senti",minorPlural:"Senti",ISOdigits:2,decimals:2,numToBasic:100},UAH:{name:"Ukrainian Hryvnia",demonym:"Ukrainian",majorSingle:"Hryvnia",majorPlural:"Hryvnias",ISOnum:980,symbol:"₴",symbolNative:"грн",minorSingle:"Kopiyka",minorPlural:"kopiyky",ISOdigits:2,decimals:2,numToBasic:100},UGX:{name:"Ugandan Shilling",demonym:"Ugandan",majorSingle:"Shilling",majorPlural:"Shillings",ISOnum:800,symbol:"USh",symbolNative:"Sh",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:0,decimals:2,numToBasic:100},USD:{name:"United States Dollar",demonym:"US",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:840,symbol:"$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},UYU:{name:"Uruguayan Peso",demonym:"Uruguayan",majorSingle:"Peso",majorPlural:"Pesos",ISOnum:858,symbol:"$U",symbolNative:"$",minorSingle:"Centésimo",minorPlural:"Centésimos",ISOdigits:2,decimals:2,numToBasic:100},UZS:{name:"Uzbekistani Som",demonym:"Uzbekistani",majorSingle:"Som",majorPlural:"Som",ISOnum:860,symbol:"сум",symbolNative:"сум",minorSingle:"Tiyin",minorPlural:"Tiyin",ISOdigits:2,decimals:2,numToBasic:100},VED:{name:"Venezuelan bolívar digital",demonym:"Venezuelan",majorSingle:"Bolívar Digital",majorPlural:"Bolívars Digital",ISOnum:null,symbol:"Bs.",symbolNative:"Bs.",minorSingle:"Céntimo",minorPlural:"Céntimos",ISOdigits:2,decimals:2,numToBasic:100},VES:{name:"Venezuelan Bolívar Soberano",demonym:"Venezuelan",majorSingle:"Bolívar",majorPlural:"Bolívares",ISOnum:928,symbol:"Bs.F",symbolNative:"Bs.F",minorSingle:"Centimo",minorPlural:"Centimos",ISOdigits:2,decimals:2,numToBasic:100},VND:{name:"Vietnamese Dong",demonym:"Vietnamese",majorSingle:"Dong",majorPlural:"Dong",ISOnum:704,symbol:"₫",symbolNative:"₫",minorSingle:"Hào",minorPlural:"Hào",ISOdigits:0,decimals:2,numToBasic:10},VUV:{name:"Vanuatu Vatu",demonym:"Vanuatu",majorSingle:"Vatu",majorPlural:"Vatu",ISOnum:548,symbol:"VT",symbolNative:"VT",minorSingle:"",minorPlural:"",ISOdigits:0,decimals:0,numToBasic:null},WST:{name:"Samoan Tala",demonym:"Samoan",majorSingle:"Tala",majorPlural:"Tala",ISOnum:882,symbol:"T",symbolNative:"ST",minorSingle:"Sene",minorPlural:"Sene",ISOdigits:2,decimals:2,numToBasic:100},XAF:{name:"Central African CFA Franc BEAC",demonym:"Central African CFA",majorSingle:"Franc",majorPlural:"Francs",ISOnum:950,symbol:"Fr",symbolNative:"Fr.",minorSingle:"Centime",minorPlural:"Centimes",ISOdigits:0,decimals:2,numToBasic:100},XCD:{name:"East Caribbean Dollar",demonym:"East Caribbean",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:951,symbol:"$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},XOF:{name:"West African CFA Franc BCEAO",demonym:"West African CFA",majorSingle:"Franc",majorPlural:"Francs",ISOnum:952,symbol:"₣",symbolNative:"₣",minorSingle:"Centime",minorPlural:"Centimes",ISOdigits:0,decimals:2,numToBasic:100},XPF:{name:"CFP Franc (Franc Pacifique)",demonym:"CFP",majorSingle:"Franc",majorPlural:"Francs",ISOnum:953,symbol:"₣",symbolNative:"₣",minorSingle:"Centime",minorPlural:"Centimes",ISOdigits:0,decimals:0,numToBasic:100},YER:{name:"Yemeni Rial",demonym:"Yemeni",majorSingle:"Rial",majorPlural:"Rials",ISOnum:886,symbol:"YR",symbolNative:"ر.ي.",minorSingle:"Fils",minorPlural:"Fils",ISOdigits:2,decimals:2,numToBasic:100},ZAR:{name:"South African Rand",demonym:"South African",majorSingle:"Rand",majorPlural:"Rand",ISOnum:710,symbol:"R",symbolNative:"R",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},ZMW:{name:"Zambian Kwacha",demonym:"Zambian",majorSingle:"Kwacha",majorPlural:"Kwacha",ISOnum:967,symbol:"ZK",symbolNative:"ZK",minorSingle:"Ngwee",minorPlural:"Ngwee",ISOdigits:2,decimals:2,numToBasic:100},ZWB:{name:"RTGS Dollar",demonym:"RTGS",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:null,symbol:"",symbolNative:"",minorSingle:"",minorPlural:"",ISOdigits:0,decimals:0,numToBasic:null},ZWL:{name:"Zimbabwean Dollar",demonym:"Zimbabwean",majorSingle:"Dollar",majorPlural:"Dollars",ISOnum:932,symbol:"Z$",symbolNative:"$",minorSingle:"Cent",minorPlural:"Cents",ISOdigits:2,decimals:2,numToBasic:100},Abkhazia:{name:"Abkhazian Apsar",demonym:"Abkhazian",majorSingle:"Apsar",majorPlural:"Apsark",ISOnum:null,symbol:"",symbolNative:"",minorSingle:"",minorPlural:"",ISOdigits:0,decimals:0,numToBasic:null},Artsakh:{name:"Artsakh Dram",demonym:"Artsakh",majorSingle:"Dram",majorPlural:"Dram",ISOnum:null,symbol:"դր.",symbolNative:"դր.",minorSingle:"Luma",minorPlural:"Luma",ISOdigits:2,decimals:2,numToBasic:100}};class Ho{constructor({transactionId:e,denomination:t,qty:n,code:r,baseUrl:a,headers:i}){this.transactionId=e,this.denomination=t,this.qty=n,this.code=r,this.baseUrl=a,this.headers=i}async getTrasactionId(){try{return(await Ni.post(this.baseUrl+"/gcms/api/1.0/transaction",null,{headers:this.headers})).data}catch(e){return await(new Vi).jsonError({exception:e,error:"Transaction Id Generation Error"},null,null),{codeException:!0,message:e.response.data.statusCode,success:!1}}}async generateFlipkartVoucher({transactionId:e,denomination:t}){try{const n=this.baseUrl+"/gcms/api/1.0/egv/v2";let r={transactionId:e,denomination:t,recipient:{medium:"INLINE",format:"JSON"}};return(await Ni.post(n,r,{headers:this.headers})).data}catch(e){return await(new Vi).log("Flipkart EGV Generation Error : "+e.response.data.statusCode,e.response.data,null,"FK_EGV"),await(new Vi).jsonError({exception:e,error:"Flipkart EGV Generation Error"},null,null),{codeException:!0,message:e.response.data.statusCode,success:!1}}}async activateFlipkartVoucher(e,t){try{const n=this.baseUrl+"/gcms/api/1.0/egv/activate";let r={transactionId:e,code:t};return(await Ni.post(n,r,{headers:this.headers})).data}catch(e){return await(new Vi).log("Flipkart EGV Activation Error Error : "+e.response.data.statusCode,e.response.data,null,"FK_EGV"),await(new Vi).log("Flipkart EGV Activation Error : "+e.response.data.statusMessage,e.response.data,null,"FK_EGV"),await(new Vi).jsonError({exception:e,error:"Flipkart EGV Activation Error"},null,null),{codeException:!0,message:e.response.data.statusCode,success:!1}}}async deactivateFlipkartVoucher(e,t){try{const n=this.baseUrl+"/gcms/api/1.0/egv/deactivate";let r={transactionId:e,code:t,comment:"deactivate"};return(await Ni.post(n,r,{headers:this.headers})).data}catch(e){return await(new Vi).log("Flipkart EGV Deativation Error Error : "+e.response.data.statusCode,e.response.data,null,"FK_EGV"),await(new Vi).log("Flipkart EGV Deativation Error : "+e.response.data.statusMessage,e.response.data,null,"FK_EGV"),await(new Vi).jsonError({exception:e,error:"Flipkart EGV Deativation Error"},null,null),{codeException:!0,message:e.response.data.statusCode,success:!1}}}async CancelFlipkartVoucher(e,t){try{const n=this.baseUrl+"/gcms/api/1.0/egv/cancel";let r={transactionId:e,code:t,comment:"Cancel"};return(await Ni.post(n,r,{headers:this.headers})).data}catch(e){return await(new Vi).log("Flipkart EGV Cancel Error Error : "+e.response.data.statusCode,e.response.data,null,"FK_EGV"),await(new Vi).log("Flipkart EGV Cancel Error : "+e.response.data.statusMessage,e.response.data,null,"FK_EGV"),await(new Vi).jsonError({exception:e,error:"Flipkart EGV Cancel Error"},null,null),{codeException:!0,message:e.response.data.statusCode,success:!1}}}async redispatchFlipkartVoucher(e){try{const t=this.baseUrl+"/gcms/api/1.0/egv/redispatch";let n={transactionId:e,comment:"redispatch",recipientList:[{medium:"INLINE",format:"JSON"}]};return(await Ni.post(t,n,{headers:this.headers})).data}catch(e){return await(new Vi).log("Flipkart EGV redispatch Error Error : "+e.response.data.statusCode,e.response.data,null,"FK_EGV"),await(new Vi).log("Flipkart EGV redispatch Error : "+e.response.data.statusMessage,e.response.data,null,"FK_EGV"),await(new Vi).jsonError({exception:e,error:"Flipkart EGV redispatch Error"},null,null),{codeException:!0,message:e.response.data.statusCode,success:!1}}}async getFlipkartBalance(){try{await(new Vi).log("get Flipkart Balance",null,null,"FK_EGV");const e=await Ni.get(this.baseUrl+"/gcms/api/1.0/client/balance",{headers:this.headers});let t=0;return t=0!==e.data.clients.length?e.data.clients[0].balance:0,{success:t>0,balance:t,message:e.data.statusMessage}}catch(e){return await(new Vi).log("get Flipkart Balance Error :"+e.response.data.statusCode,e.response.data,null,"FK_EGV"),await(new Vi).jsonError({exception:e,error:"get Flipkart Balance Error"},null,null),{codeException:!0,message:e.response.data.statusCode,success:!1}}}}class Qo{constructor({client_id:e,client_secret:t,redirect_uri:n,authorization:r,base_url:a,place_order_config:i,username:o,password:s}){this.generateSignature=async(e,t,n)=>{try{var r=t,a=(n+"").toUpperCase(),i=e,o=this.client_secret;let s=e=>{if(e instanceof Array)var t=[],n=Object.keys(e);else t={},n=Object.keys(e);for(var r in n.sort((function(e,t){return e<t?-1:e>t?1:0})),n){var a=n[r];"object"==typeof e[a]?(e[a]instanceof Array&&(t[a]=s(e[a])),t[a]=s(e[a])):t[a]=e[a]}return t},l=()=>{var e=i.split("?"),t=e[0],n=e[1].split("&");return i=t+"?"+n.sort().join("&"),u(i)},c=()=>{var e=[];return e.push(a.toUpperCase()),i.indexOf("?")>=0?e.push(l()):e.push(u(i)),r&&Object.keys(r).length&&e.push(u(JSON.stringify(s(r)))),e.join("&")},u=e=>encodeURIComponent(e).replace(/[!'()*]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}));return to(c(),o).toString()}catch(e){await(new Vi).jsonError({exception:e,error:"QC generateSignature Error"},null,null)}},this.getQuickCilverAuthCode=async(e,t)=>{try{const e=await Ni.post(this.base_url+"/oauth2/verify",{clientId:this.client_id,username:this.username,password:this.password}),{authorizationCode:t}=e.data;return Ji.quick_silver.AUTH_CODE=t,Ji.quick_silver.AUTH_CODE_LAST_UPDATED=(new Date).getTime(),{code:t}}catch(n){return await(new Vi).jsonError({exception:n,error:"QC getAuthCode Error"},e,t),{codeException:!0}}},this.getQuickCilverOAuthToken=async(e,t,n)=>{try{const t=await Ni.post(this.base_url+"/oauth2/token",{clientId:this.client_id,clientSecret:this.client_secret,authorizationCode:e}),{token:n}=t.data;return Ji.quick_silver.OAUTH_CODE=n,Ji.quick_silver.OAUTH_CODE_LAST_UPDATED=(new Date).getTime(),{access_token:n}}catch(e){return await(new Vi).jsonError({exception:e,error:"QC getOAuthToken Error"},t,n),{oAuthException:!0}}},this.getOrderStatus=async(e,t,n)=>{try{const r=this.base_url+`/rest/v3/order/${e}/status`,a={connection:"close","content-type":"application/json",dateatclient:(new Date).toISOString()+"",signature:await this.generateSignature(r,null,"GET"),"accept-encoding":"gzip, deflate, br",Authorization:r.includes("zeus")?"":`Bearer ${t}`};r.includes("zeus")&&(a["sp-qc-auth"]=`Bearer ${t}`);const i=await zo(r,{headers:a,method:"GET"}),o=await i.json();return await(new Vi).log(`get Order Status${JSON.stringify(i)}`,!1,e,n),{response:o}}catch(t){return await(new Vi).jsonError({exception:t,error:"QC getOrderStatus Error"},e,n),{oAuthException:!0}}},this.placeVouchersOrder=async({qty:e,vendorSku:t,access_token:n,referenceId:r,price:a,currencyISOCode:i,syncOnly:o,vendor_code:s})=>{try{const l={address:{firstname:this.place_order_config.firstname,lastname:this.place_order_config.lastname,email:this.place_order_config.email,telephone:this.place_order_config.telephone,line1:this.place_order_config.line1,line2:this.place_order_config.line2,city:this.place_order_config.city,region:this.place_order_config.region,country:this.place_order_config.country,postcode:this.place_order_config.postcode,company:this.place_order_config.company,billToThis:!0},payments:[{code:"svc",amount:a*e}],refno:r,syncOnly:o,deliveryMode:"API",products:[{sku:t,price:a,qty:e,currency:i,theme:""}]},c=this.base_url+"/rest/v3/orders";await(new Vi).log(`QC Body:${JSON.stringify(l)}`,null,r,s),await(new Vi).log(`QC access_token:${n}`,null,r,s);const u={connection:"close","content-type":"application/json",dateatclient:(new Date).toISOString()+"",signature:await this.generateSignature(c,l,"POST"),"accept-encoding":"gzip, deflate, br",Authorization:c.includes("zeus")?"":`Bearer ${n}`};c.includes("zeus")&&(u["sp-qc-auth"]=`Bearer ${n}`);const d=await zo(c,{headers:u,body:JSON.stringify(l),method:"POST"}),p=await d.json();let{status:h,message:m,cards:f,orderId:y,code:g}=p,b=null,v=null,w="COMPLETE"==h||"PROCESSING"==h;try{b=f.map((e=>({cardnumber:e.cardNumber,pin_or_url:e.cardPin,expiry:e.validity})))}catch(e){w=!1}try{v=p.payments[0].balance}catch(e){await(new Vi).jsonError({exception:e,error:"Wallet balance retrieval Error"},r,s)}return{vouchers:b,success:w,message:m,orderId:y,status:h,statusCode:g,walletBalance:v}}catch(e){return await(new Vi).jsonError({exception:e,error:"QC placeVouchersOrder Error"},r,s),{orderException:!0}}},this.getBalance=async(e,t,n)=>{try{const r={cardNumber:e,pin:t},a=this.base_url+"/rest/v3/balance",i={connection:"close","content-type":"application/json",dateatclient:(new Date).toISOString()+"",signature:await this.generateSignature(a,r,"POST"),"accept-encoding":"gzip, deflate, br",Authorization:a.includes("zeus")?"":`Bearer ${n}`};a.includes("zeus")&&(i["sp-qc-auth"]=`Bearer ${n}`);const o=await zo(a,{headers:i,body:JSON.stringify(r),method:"POST"}),s=await o.json();let{status:l,message:c,balance:u}=s;return{status:l,message:c,balance:u,responseJson:s}}catch(e){return await(new Vi).jsonError({exception:e,error:"QC getBalance Error"},null,null),{getBalanceException:!0}}},this.client_id=e,this.client_secret=t,this.redirect_uri=n,this.authorization=r,this.base_url=a,this.place_order_config=i,this.username=o,this.password=s}async getOlderOrderDetails(e,t,n,r){try{const n=this.base_url+`/rest/v3/order/${e}/cards/?limit=400`,r={connection:"close","content-type":"application/json",dateatclient:(new Date).toISOString()+"",signature:await this.generateSignature(n,null,"GET"),"accept-encoding":"gzip, deflate, br",Authorization:n.includes("zeus")?"":`Bearer ${t}`};n.includes("zeus")&&(r["sp-qc-auth"]=`Bearer ${t}`);const a=await zo(n,{headers:r,method:"GET"}),i=await a.json();let{cards:o}=i,s=!1,l=null;try{l=o.map((e=>({cardnumber:e.cardNumber,pin_or_url:e.cardPin,expiry:e.validity}))),s=!0}catch(e){s=!1}return{vouchers:l,success:s,message:""}}catch(e){return await(new Vi).jsonError({exception:e,error:"QC getOlderOrderDetails Error"},n,r),{oldOrderException:!0,vendorCode:r}}}async getCategory(e){try{const t=this.base_url+"/rest/v3/catalog/categories",n={connection:"close","content-type":"application/json",dateatclient:(new Date).toISOString()+"",signature:await this.generateSignature(t,null,"GET"),"accept-encoding":"gzip, deflate, br",Authorization:t.includes("zeus")?"":`Bearer ${e}`};t.includes("zeus")&&(n["sp-qc-auth"]=`Bearer ${e}`);const r=await zo(t,{headers:n,method:"GET"}),a=await r.json();return{categoryId:a.id}}catch(e){return await(new Vi).jsonError({exception:e,error:"QC getCategory Error"},null,null),null}}async getProducts(e,t){try{const n=this.base_url+`/rest/v3/catalog/categories/${e}/products`,r={connection:"close","content-type":"application/json",dateatclient:(new Date).toISOString()+"",signature:await this.generateSignature(n,null,"GET"),"accept-encoding":"gzip, deflate, br",Authorization:n.includes("zeus")?"":`Bearer ${t}`};n.includes("zeus")&&(r["sp-qc-auth"]=`Bearer ${t}`);const a=await zo(n,{headers:r,method:"GET"}),i=await a.json();return{productList:i.products}}catch(e){return await(new Vi).jsonError({exception:e,error:"QC getCategory Error"},null,null),null}}}const Zo=process.env.REWARD_ST_BASE_URL,Xo=process.env.REWARD_ST_CLIENT_ID,es=process.env.REWARD_ST_CLIENT_SECRET,ts=Buffer.from(`${Xo}:${es}`).toString("base64");var ns=async()=>{try{const e=Zo+"/wallets",t={connection:"close","content-type":"application/json",Authorization:"Basic "+ts};return{success:!0,balance:(await Ni.get(e,{headers:t})).data}}catch(e){return{success:!1,error:e}}},rs=async()=>{try{const e=Zo+"/products",t={limit:1e4,filters:{category:"Gift Card"}},n={connection:"close","content-type":"application/json",Authorization:"Basic "+ts};return(await Ni.get(e,{headers:n,params:t})).data}catch(e){return await(new Vi).jsonError({exception:e,error:"Reward Store getProduct Error"},null,null),null}},as=async(e,t,n,r,a)=>{try{await(new Vi).log("get Reward Store Voucher Initialising",!1,r,a);const i=Zo+"/orders",o={connection:"close","content-type":"application/json",Authorization:"Basic "+ts},s={product_id:e,denomination:t,quantity:n,reference_code:r},l=await Ni.post(i,s,{headers:o}),{id:c,status:u,vouchers:d,message:p}=l.data;return console.log(l.status,"status"),{vouchers:d,success:"DELIVERED"==u||"PENDING"==u,message:p,orderID:c,status:u}}catch(e){return await(new Vi).jsonError({exception:e,error:"getQCVoucher Error",referenceId:r},r,a),{vouchers:null,success:!1,message:"Exception Occurred:"+e,exception:!0,orderId:null,ref_code:r}}};class is{constructor(e,t){this.get=null,this.set=null,this.services=null,this.accountabilitySchema=null,this.itemsService=null,this.sleep=e=>new Promise((t=>setTimeout(t,e))),this.getWorkAdvantageCode=async(e,t)=>{try{const n=new Gi(Yi.workAdvantageConfig);let r=null,a=null;const i=Ji.work_advantage.AUTH_CODE_LAST_UPDATED,o=Ji.work_advantage.AUTH_CODE,s=Yi.workAdvantageConfig.code_validity_time,l=((new Date).getTime()-i)/1e3;if(o&&i&&l<s)await(new Vi).log("Fetching Previous Auth Code TSLU:"+l,!1,e,t),r=o;else{await(new Vi).log("Generating Auth Code TSLU:"+l,!1,e,t);const i=await n.getAuthCode();r=i.code,a=i.codeException}return{code:r,codeException:a}}catch(n){return await(new Vi).jsonError({exception:n,error:"getWorkAdvantageCode Error"},e,t),{code:null,codeException:!0}}},this.getWorkAdvantageVoucher=async(e,t,n,r,a)=>{try{await(new Vi).log("Initialising WorkAdvantage Object",!1,n,a);const i=new Gi(Yi.workAdvantageConfig);await(new Vi).log("Getting Authorization Code",!1,n,a);const{code:o,codeException:s}=await this.getWorkAdvantageCode(n,a);await(new Vi).log("Getting OAuthToken",!1,n,a);const{access_token:l,oAuthException:c}=await i.getOAuthToken(o,n,a);await(new Vi).log("Getting Vouchers: "+JSON.stringify({upc_id:e,qty:t,referenceId:n}),!1,n,a);let{vouchers:u,success:d,message:p,orderId:h,orderException:m}=await i.placeVouchersOrder({upc_id:e,qty:t,access_token:l,referenceId:n,vendor_code:a});await(new Vi).log(`Received Response for refId:${n}, Suc:${d}, Msg:${p}`,!1,n,a);let f=null;if(!d&&r&&p&&p.toLowerCase().includes("unique reference id")){await(new Vi).log(`Getting Older Order Details for Ref:${n},"Message:"${p}`,!1,n,a);const e=await i.getOlderOrderDetails(n,l,a);u=e.vouchers,d=e.success,p=e.message,h=e.orderId,f=e.oldOrderException,await(new Vi).log(`Received Old Order Response Suc:${d}, ordId:${h},"Message:"${p}`,!1,n,a)}let y=s||m||c||f;return await(new Vi).log(`isExceptionOccurred: ${!!y}`,!1,n,a),y?(await(new Vi).log(`Throwing Error: coE:${s} oaE:${c} orE:${m} ooE:${f}`,!1,n,a),{vouchers:null,success:!1,message:"Exception Occurred:",orderId:null,exception:!0,vendorCode:a}):{vouchers:u,success:d,message:p,orderId:h,exception:!!y,vendorCode:a}}catch(e){return await(new Vi).jsonError({exception:e,error:"getWorkAdvantageVoucher Error"},n,a),{vouchers:null,success:!1,message:"Exception Occurred:"+e,orderId:null,exception:!0,vendorCode:a}}},this.getWorkAdvantageCatalogue=async e=>{try{const t=new Gi(Yi.workAdvantageConfig),{code:n}=await t.getAuthCode(),{access_token:r}=await t.getOAuthToken(n,null,null);return await t.getCatalog(r,e)}catch(e){await(new Vi).jsonError({exception:e,error:"getWorkAdvantageCatalogue Error"},null,null)}},this.getWorkAdvantageWalletBalance=async()=>{try{const e=new Gi(Yi.workAdvantageConfig),{code:t}=await e.getAuthCode(),{access_token:n}=await e.getOAuthToken(t,null,null);return await e.getBalance(n)}catch(e){await(new Vi).jsonError({exception:e,error:"getWorkAdvantageWalletBalance Error"},null,null)}},this.getFlipkartVoucher=async(e,t,n,r,a)=>{try{await(new Vi).log("Initialising Flipkart Voucher",!1,t,r);const i=e,o=new Ui(this.itemsService,this.accountabilitySchema),s=new Mi(this.itemsService,this.accountabilitySchema),l=await o.getVendorFromVendorCode(r,t),c=l?l.id:null;let u=[],d="";const p=new Ho({transactionId:"",denomination:"",qty:1,code:"",baseUrl:Yi.flipkartConfig.baseUrl,headers:Yi.flipkartConfig.headers}),h=[];let m=!1,f=[],y=0,g=null,b="";y=i*n;const{success:v,balance:w,codeException:S,message:E}=await p.getFlipkartBalance();if(v){if(w){if(y<w){for(let e=0;e<i;e++){const i=t+"-"+(e+1);if(u=await o.getVendorOrderFromRef(i,c,r),await(new Vi).log(`checking data from sd_vendor_orders collection:${u}`,!1,t,r),d=u&&u.vendor_order_id?u.vendor_order_id:null,u){await(new Vi).log("Fetch Gift Card From SD Gift Card Inventory:",!1,t,r);const e=await o.getVendorTrasanctionDetails(u.vendor_order_id),i={},l={};if(i.statusCode="Fetching Data From Inventory",i.statusMessage="Please provide a unique reference ID for the order, following the gift card fetching process from the SD Gift Card Inventory.",0!==e.length)l.code=e[0].code||"",l.pin=e[0].pin||"",l.expiryDate=e[0].validity||"",l.storeToInventory=!1,l.transactionId=u.vendor_order_id,l.sku=a,l.recipient={medium:"INLINE",format:"JSON",status:"DISPATCHED",walletInfoRequired:!1},i.egv=l,h.push(i),0!==h.length&&(m=!0);else{const e=await p.redispatchFlipkartVoucher(u.vendor_order_id);if("SUCCESS"==e.statusCode)i.statusCode=e.statusCode,i.statusMessage=e.statusMessage,l.code=e.egv.code||"",l.pin=e.egv.pin||"",l.expiryDate=e.egv.expiryDate||"",l.storeToInventory=!0,l.transactionId=u.vendor_order_id,l.sku=a,l.balance=e.egv.balance,l.recipient={medium:"INLINE",format:"JSON",status:"DISPATCHED",walletInfoRequired:!1},i.egv=l,h.push(i),0!==h.length&&(m=!0);else if(await(new Vi).log(`TransactionId Already Generated : ${u.vendor_order_id}`,!1,t,r),await(new Vi).log(`Redispatch Flipkart Voucher statusCode:${e.statusCode} TransactionId: ${u.vendor_order_id}`,!1,t,r),await(new Vi).log(`Redispatch Flipkart Voucher statusMessage:${e.statusMessage}`,!1,t,r),"ERR_NOT_GENERATED"==e.statusCode){if(!u.vendor_order_id)return await(new Vi).log(`TransactionId Not Available:${e.statusMessage}`,!1,t,r),b="TransactionId Not Available",{giftCardList:h,success:!1,message:"TransactionId Not Available",codeException:!0,vendorCode:r};{await(new Vi).log("Re Generating Gift Card :",!1,t,r);let i=null;if(i=await p.generateFlipkartVoucher({transactionId:u.vendor_order_id,denomination:n}),"CREATION_SUCCESSFUL"===i.statusCode)await(new Vi).log("Flipkart Gift Card Re-Generated :",!1,t,r),i.egv.transactionId=u.vendor_order_id,i.egv.storeToInventory=!0,i.egv.sku=a,await s.updateVendorOrderByKeys(f,d||u.vendor_order_id,i?"completed":"pending"),m=!0,h.push(i);else if(i.codeException)return await(new Vi).log(`Redispatch Flipkart Voucher generation failes:${e.statusMessage}`,!1,t,r),b=e.statusMessage,{giftCardList:h,success:!1,message:e.statusMessage,codeException:!0,vendorCode:r}}}else if("ERR_TRANSACTION_FAILED"==e.statusCode){await(new Vi).log(`TransactionId Failed: ${u.vendor_order_id}`,!1,t,r),await(new Vi).log("Getting TransactionId Code",!1,t,r);const e=await p.getTrasactionId();if("SUCCESS"!==e.statusCode)return await(new Vi).log(`Create TransactionId Error :${e}`,!1,t,r),b="Transaction Id Not generated",{giftCardList:h,success:!1,message:"Transaction Id Not generated",codeException:!0,vendorCode:r};if(g=e.transactionId,await(new Vi).log(`Flipkart TransactionId Generated : ${e}`,e,t,r),!g)return await(new Vi).log(`Flipkart TransactionId Not Availabe: ${e}`,e,t,r),b="TransactionId Not Available",{giftCardList:h,success:!1,message:"TransactionId Not Available",codeException:!0,vendorCode:r};{await s.updateVendorOrderByKeys(f,d||g,"pending"),await(new Vi).log("Generating Gift Card :",!1,t,r);let e=null;if(e=await p.generateFlipkartVoucher({transactionId:g,denomination:n}),"CREATION_SUCCESSFUL"===e.statusCode)await(new Vi).log("Flipkart Gift Card Generated :",!1,t,r),e.egv.transactionId=g,e.egv.storeToInventory=!0,e.egv.sku=a,await s.updateVendorOrderByKeys(f,d||g,e?"completed":"pending"),m=!0,h.push(e);else if(e.codeException)return b=e.statusCode,{giftCardList:h,success:!1,message:e.statusCode,codeException:!0,vendorCode:r}}}}}else{f=await s.addVendorOrder(i,c,r),await(new Vi).log("Getting TransactionId Code",!1,t,r);const e=await p.getTrasactionId();if("SUCCESS"!=e.statusCode)return await(new Vi).log(`Create TransactionId Error :${e}`,!1,t,r),b="Flipkart Transaction ID Not generated",{giftCardList:h,success:!1,message:"Transaction ID Not generated",codeException:!0,vendorCode:r};if(g=e.transactionId,await(new Vi).log(`Flipkart TransactionId Generated : ${e}`,e,t,r),!g)return await(new Vi).log(`Flipkart TransactionId  Not Generated ${e}`,e,t,r),b="Flipkart TransactionId  Not Generated",{giftCardList:h,success:!1,message:"Flipkart TransactionId  Not Generated",codeException:!0,vendorCode:r};{await s.updateVendorOrderByKeys(f,d||g,"pending"),await(new Vi).log("Generating Gift Cards",!1,t,r);let i=null;if(i=await p.generateFlipkartVoucher({transactionId:g,denomination:n}),"CREATION_SUCCESSFUL"==i.statusCode)await(new Vi).log("Flipkart Gift Card Generated :",!1,t,r),i.egv.transactionId=g,i.egv.storeToInventory=!0,i.egv.sku=a,await s.updateVendorOrderByKeys(f,d||g,i?"completed":"pending"),m=!0,h.push(i);else if(i.codeException)return await(new Vi).log(`Gift Card  Generating  Error ${JSON.stringify(i)}`,e,t,r),b=i.statusCode,{giftCardList:h,success:!1,message:i.statusCode,codeException:!0,vendorCode:r}}}}return h.length==i&&(m=!0),{giftCardList:h,success:m,message:b,codeException:!1,vendorCode:r}}return await(new Vi).log(`Flikart Insufficient balance :${E}`,!1,t,r),{giftCardList:h,success:!1,message:"Flikart Insufficient balance",codeException:!0,vendorCode:r}}return await(new Vi).log(`Flikart Balance Not Found :${E}`,!1,t,r),{giftCardList:h,success:!1,message:"Flikart Balance Not Found",codeException:!0,vendorCode:r}}if(await(new Vi).log(`get Flikart Balance Error :${E}`,!1,t,r),!S)return{giftCardList:h,success:!1,message:"Flikart Balance Error",codeException:!0,vendorCode:r}}catch(e){return await(new Vi).log(`Error :${e}`,!1,t,r),await(new Vi).jsonError({exception:e,error:`getFlipKartVoucher Error ${e}`},t,r),{giftCardList:[],success:!1,message:e,codeException:!0,vendorCode:r}}},this.getQCAmazonBearerToken=async(e,t)=>{try{let n=null,r=null;try{const a=new Wo(Yi.qcAmazonConfig);let i=null;const o=Ji.qc_amazon.OAUTH_CODE_LAST_UPDATED,s=Ji.qc_amazon.OAUTH_CODE,l=Yi.qcAmazonConfig.code_validity_time,c=((new Date).getTime()-o)/1e3;if(s&&o&&c<l)await(new Vi).log("QC Fetching Previous OAuth Code TSLU:"+c,!1,e,t),i=s;else{await(new Vi).log("QC Generating OAuth Code TSLU:"+c,!1,e,t),await(new Vi).log("Getting QC Authorization Code",!1,e,t);const{code:o,codeException:s}=await a.getAuthCode(e,t);r=s,await(new Vi).log("Getting QC OAuthToken",!1,e,t);const{access_token:l,oAuthException:u}=await a.getOAuthToken(o,e,t);i=l,n=u}return{access_token:i,oAuthException:n,codeException:r}}catch(a){return await(new Vi).jsonError({exception:a,error:"getQCAmazonBearerToken B Error"},e,t),{access_token:null,oAuthException:n,codeException:r}}}catch(n){return await(new Vi).jsonError({exception:n,error:"getQCAmazonBearerToken A Error"},e,t),null}},this.getQCAmazonVoucher=async(e,t,n,r,a,i,o,s,l,c)=>{try{await(new Vi).log("getQCAmazonVoucher Initialising QC AMZN Object",!1,n,c);const u=new Wo(Yi.qcAmazonConfig);await(new Vi).log("QC Getting Access Token",!1,n,c);const{access_token:d,codeException:p,oAuthException:h}=await this.getQCAmazonBearerToken(n,c);await(new Vi).log("Placing QC Order",!1,n,c);const m=Yo[i].ISOnum;if(l&&r){let{vouchers:e,success:t,message:r,orderId:a,status:i,orderException:s,statusCode:l}={},m=null;const f=await u.getOlderOrderDetails(o,d,n,c);e=f.vouchers,t=f.success,r=f.message,a=o,m=f.oldOrderException,await(new Vi).log(`Received Old QC Order Response Suc:${t}, ordId:${a}`,!1,n,c);const y=p||s||h||m;return await(new Vi).log(`isExceptionOccurred: ${!!y}`,!1,n,c),y?(await(new Vi).log(`Exception Occurred QC Amazon (Order Details): coE:${p} oaE:${h} orE:${s} ooE:${m}`,!1,n,c),{vouchers:null,success:!1,message:"Exception Occurred:",exception:!0,orderId:a,vendorCode:c}):{vouchers:e,success:t,message:r,status:i,orderId:a,exception:!!y,statusCode:l,vendoCode:c}}{const{vouchers:r,success:i,message:o,orderId:l,status:f,orderException:y,statusCode:g,walletBalance:b}=await u.placeVouchersOrder({vendorSku:e,qty:t,access_token:d,referenceId:n,price:a,currencyISOCode:m,syncOnly:s,vendor_code:c}),v=null,w=p||y||h||v;return await(new Vi).log(`isExceptionOccurred: ${!!w} Message:`+o,!1,n,c),w?(await(new Vi).log(`Exception Occurred due to QC Amazon: coE:${p} oaE:${h} orE:${y} ooE:${v}`,!1,n,c),{vouchers:null,success:!1,message:"Exception Occurred:",exception:!0,orderId:l,vendorCode:c}):{vouchers:r,success:i,message:o,status:f,orderId:l,exception:!!w,statusCode:g,walletBalance:b,vendorCode:c}}}catch(e){return await(new Vi).jsonError({exception:e,error:"getQCAmazonVoucher Error"},n,c),{vouchers:null,success:!1,message:"Exception Occurred:"+e,exception:!0,orderId:null,vendoCode:c}}},this.getQCAmazonOlderOrder=async(e,t,n)=>{try{await(new Vi).log("getQCAmazonOlderOrder Initialising QC AMZN Object",!1,e,n);const r=new Wo(Yi.qcAmazonConfig);await(new Vi).log("QC Getting Access Token",!1,e,n);const{access_token:a,codeException:i,oAuthException:o}=await this.getQCAmazonBearerToken(e,n);await(new Vi).log("Getting QC Order History",!1,e,n);let{vouchers:s,success:l,message:c,orderId:u,status:d}={},p=null;const h=await r.getOlderOrderDetails(t,a,e,n);s=h.vouchers,l=h.success,c=h.message,u=t,p=h.oldOrderException,await(new Vi).log(`Received Old QC Order Response Suc:${l}, ordId:${u}`,!1,e,n);const m=i||o||p;return await(new Vi).log(`isExceptionOccurred: ${!!m}`,!1,e,n),m?(await(new Vi).log(`Exception Occurred QC Amazon (Order Details): coE:${i} oaE:${o} ooE:${p}`,!1,e,n),{vouchers:null,success:!1,message:"Exception Occurred:",exception:!0,orderId:u,vendorCode:n}):{vouchers:s,success:l,message:c,status:d,orderId:u,exception:!!m}}catch(t){return await(new Vi).jsonError({exception:t,error:"getQCAmazonOlderOrder Error"},e,n),{vouchers:null,success:!1,message:"Exception Occurred:"+t,exception:!0,orderId:null,vendorCode:n}}},this.getQCAmazonOrderStatus=async(e,t)=>{try{await(new Vi).log("getQCAmazonOrderStatus Initialising QC AMZN Object",!1,e,t);const n=new Wo(Yi.qcAmazonConfig);await(new Vi).log("QC Getting Access Token",!1,e,t);const{access_token:r,codeException:a,oAuthException:i}=await this.getQCAmazonBearerToken(e,t),{response:o}=await n.getOrderStatus(e,r,t);return await(new Vi).log("get QC Amazon Order Status",!1,e,t),o}catch(n){return await(new Vi).jsonError({exception:n,error:`getQCAmazonOrderStatus Error : ${n}`},e,t),{vouchers:null,success:!1,message:`Exception Occurred:${n}`,exception:!0,vendorCode:t}}},this.getFlipkartWalletBalance=async()=>{try{const e=new Ho({transactionId:"",denomination:"",qty:1,code:"",baseUrl:Yi.flipkartConfig.baseUrl,headers:Yi.flipkartConfig.headers}),{success:t,balance:n}=await e.getFlipkartBalance();return{success:t,balance:n}}catch(e){await(new Vi).jsonError({exception:e,error:"get Flipkart Wallet Balance Error"},null,null)}},this.getFlipkartRedispatch=async e=>{try{const t=new Ho({transactionId:"",denomination:"",qty:1,code:"",baseUrl:Yi.flipkartConfig.baseUrl,headers:Yi.flipkartConfig.headers});return await t.redispatchFlipkartVoucher(e)}catch(e){await(new Vi).jsonError({exception:e,error:"get Flipkart Wallet Balance Error"},null,null)}},this.generateFlipkartVoucher=async(e,t)=>{try{const n=new Ho({transactionId:"",denomination:"",qty:1,code:"",baseUrl:Yi.flipkartConfig.baseUrl,headers:Yi.flipkartConfig.headers});return await n.generateFlipkartVoucher({transactionId:e,denomination:t})}catch(e){await(new Vi).jsonError({exception:e,error:"get Flipkart Wallet Balance Error"},null,null)}},this.getQCOrderStatus=async(e,t)=>{try{await(new Vi).log("getQCOrderStatus Initialising QC Object",!1,e,t);const n=new Qo(Yi.quickcilverConfig);await(new Vi).log("QC Getting Access Token",!1,e,t);const{access_token:r,codeException:a,oAuthException:i}=await this.getQucikCilverBearerToken(e,t),{response:o}=await n.getOrderStatus(e,r,t);return await(new Vi).log("get QC  Order Status",!1,e,t),o}catch(n){return await(new Vi).jsonError({exception:n,error:`getQCOrderStatus Error : ${n}`},e,t),{vouchers:null,success:!1,message:`Exception Occurred:${n}`,exception:!0,vendorCode:t}}},this.getQuickCilverVoucher=async(e,t,n,r,a,i,o,s,l,c)=>{try{await(new Vi).log("getQCVoucher Initialising Quick Cilver Object",!1,n,c);const u=new Qo(Yi.quickcilverConfig);await(new Vi).log("QC Getting Access Token",!1,n,c);const{access_token:d,codeException:p,oAuthException:h}=await this.getQucikCilverBearerToken(n,c);await(new Vi).log("Placing QC Order",!1,n,c);const m=Yo[i].ISOnum;if(l&&r){let{vouchers:e,success:t,message:r,orderId:a,status:i,orderException:s,statusCode:l}={},m=null;const f=await u.getOlderOrderDetails(o,d,n,c);e=f.vouchers,t=f.success,r=f.message,a=o,m=f.oldOrderException,await(new Vi).log(`Received Old QC Order Response Suc:${t}, ordId:${a}`,!1,n,c);const y=p||s||h||m;return await(new Vi).log(`isExceptionOccurred: ${!!y}`,!1,n,c),y?(await(new Vi).log(`Exception Occurred QC (Order Details): coE:${p} oaE:${h} orE:${s} ooE:${m}`,!1,n,c),{vouchers:null,success:!1,message:"Exception Occurred:",exception:!0,orderId:a,vendorCode:c}):{vouchers:e,success:t,message:r,status:i,orderId:a,exception:!!y,statusCode:l,vendoCode:c}}{const{vouchers:r,success:i,message:o,orderId:l,status:f,orderException:y,statusCode:g,walletBalance:b}=await u.placeVouchersOrder({vendorSku:e,qty:t,access_token:d,referenceId:n,price:a,currencyISOCode:m,syncOnly:s,vendor_code:c}),v=null;let w=p||y||h||v;return await(new Vi).log(`isExceptionOccurred: ${!!w} Message:`+o,!1,n,c),w?(await(new Vi).log(`Exception Occurred due to QC : coE:${p} oaE:${h} orE:${y} ooE:${v}`,!1,n,c),{vouchers:null,success:!1,message:"Exception Occurred:",exception:!0,orderId:l,vendorCode:c}):{vouchers:r,success:i,message:o,status:f,orderId:l,exception:!!w,statusCode:g,walletBalance:b,vendorCode:c}}}catch(e){return await(new Vi).jsonError({exception:e,error:"getQCVoucher Error"},n,c),{vouchers:null,success:!1,message:"Exception Occurred:"+e,exception:!0,orderId:null,vendoCode:c}}},this.getQucikCilverBearerToken=async(e,t)=>{try{let n=null,r=null;try{const a=new Qo(Yi.quickcilverConfig);let i=null;const o=Ji.quick_silver.OAUTH_CODE_LAST_UPDATED,s=Ji.quick_silver.OAUTH_CODE,l=Yi.quickcilverConfig.code_validity_time,c=((new Date).getTime()-o)/1e3;if(s&&o&&c<l)await(new Vi).log("QC Fetching Previous OAuth Code TSLU:"+c,!1,e,t),i=s;else{await(new Vi).log("QC Generating OAuth Code TSLU:"+c,!1,e,t),await(new Vi).log("Getting QC Authorization Code",!1,e,t);const{code:o,codeException:s}=await a.getQuickCilverAuthCode(e,t);r=s,await(new Vi).log("Getting QC OAuthToken",!1,e,t);const{access_token:l,oAuthException:u}=await a.getQuickCilverOAuthToken(o,e,t);i=l,n=u}return{access_token:i,oAuthException:n,codeException:r}}catch(a){return await(new Vi).jsonError({exception:a,error:"getQCBearerToken B Error"},e,t),{access_token:null,oAuthException:n,codeException:r}}}catch(n){return await(new Vi).jsonError({exception:n,error:"getQCBearerToken A Error"},e,t),null}},this.getQCOlderOrder=async(e,t,n)=>{try{await(new Vi).log("getQCOlderOrder Initialising QC Object",!1,e,n);const r=new Qo(Yi.quickcilverConfig);await(new Vi).log("QC Getting Access Token",!1,e,n);const{access_token:a,codeException:i,oAuthException:o}=await this.getQucikCilverBearerToken(e,n);await(new Vi).log("Getting QC Order History",!1,e,n);let{vouchers:s,success:l,message:c,orderId:u,status:d}={},p=null;const h=await r.getOlderOrderDetails(t,a,e,n);s=h.vouchers,l=h.success,c=h.message,u=t,p=h.oldOrderException,await(new Vi).log(`Received Old QC Order Response Suc:${l}, ordId:${u}`,!1,e,n);const m=i||o||p;return await(new Vi).log(`isExceptionOccurred: ${!!m}`,!1,e,n),m?(await(new Vi).log(`Exception Occurred QC  (Order Details): coE:${i} oaE:${o} ooE:${p}`,!1,e,n),{vouchers:null,success:!1,message:"Exception Occurred:",exception:!0,orderId:u,vendorCode:n}):{vouchers:s,success:l,message:c,status:d,orderId:u,exception:!!m}}catch(t){return await(new Vi).jsonError({exception:t,error:"getQCOlderOrder Error"},e,n),{vouchers:null,success:!1,message:"Exception Occurred:"+t,exception:!0,orderId:null,vendorCode:n}}},this.getQCWalletBalance=async(e,t)=>{try{await(new Vi).log("Initialising get WalletBalance Object",!1,null,null);const n=new Qo(Yi.quickcilverConfig),{access_token:r,codeException:a,oAuthException:i}=await this.getQucikCilverBearerToken(null,null);await(new Vi).log(`access_token ${r}`,!1,null,null);const{status:o,message:s,balance:l,responseJson:c}=await n.getBalance(e,t,r);return await(new Vi).log(`status: ${o}`,!1,null,null),await(new Vi).log(`message: ${s}`,!1,null,null),await(new Vi).log(`balance: ${l}`,!1,null,null),{status:o,message:s,balance:l,responseJson:c}}catch(e){await(new Vi).jsonError({exception:e,error:"getQCWalletBalance Error"},null,null)}},this.getRewardStoreWalletBalance=async()=>{try{await(new Vi).log("Initialising get WalletBalance Object",!1,null,null);const{success:e,balance:t}=await ns();return{success:e,balance:t[0].amount,currency:t[0].currency}}catch(e){await(new Vi).jsonError({exception:e,error:"getRewardStoreWalletBalance Error"},null,null)}},this.itemsService=e,this.accountabilitySchema=t}async getWorkAdvantagePreviousOrder(e,t){try{await(new Vi).log("PrevOrd Initialising WorkAdvantage Object",!1,e,t);const n=new Gi(Yi.workAdvantageConfig);await(new Vi).log("PrevOrd Getting Authorization Code",!1,e,t);const{code:r,codeException:a}=await this.getWorkAdvantageCode(e,t);await(new Vi).log("PrevOrd Getting OAuthToken",!1,e,t);const{access_token:i,oAuthException:o}=await n.getOAuthToken(r,e,t);await(new Vi).log(`PrevOrd Getting Older Order Details for Ref:${e}`,!1,e,t);const s=await n.getOlderOrderDetails(e,i,t),l=s.vouchers,c=s.success,u=s.message,d=s.orderId,p=s.oldOrderException;await(new Vi).log(`PrevOrd Received Old Order Response Suc:${c}, ordId:${d}`,!1,e,t);const h=a||o||p;return await(new Vi).log(`PrevOrd isExceptionOccurred: ${!!h}`,!1,e,t),h?(await(new Vi).log(`PrevOrd Throwing Error: coE:${a} oaE:${o} ooE:${p}`,!1,e,t),{vouchers:null,success:!1,message:"Exception Occurred:",exception:!0,orderId:d,vendorCode:t}):{vouchers:l,success:c,message:u,orderId:d,exception:!!h}}catch(n){return await(new Vi).jsonError({exception:n,error:"PrevOrd getWorkAdvantagePreviousOrder Error"},e,t),{vouchers:null,success:!1,message:"PrevOrd Exception Occurred:"+n,exception:!0,orderId:null}}}async getQCAmazonCatalog(){try{await(new Vi).log("getQCAmazonCatalog Initialising QC AMZN Object",!1,null,null);const e=new Wo(Yi.qcAmazonConfig);await(new Vi).log("QC Getting Access Token",!1,null,null);const{access_token:t,codeException:n,oAuthException:r}=await this.getQCAmazonBearerToken(null,null);await(new Vi).log(`access_token ${t}`,!1,null,null),await(new Vi).log(`codeException ${n}`,!1,null,null),await(new Vi).log(`oAuthException ${r}`,!1,null,null);const{categoryId:a}=await e.getCategory(t),{productList:i}=await e.getProducts(a,t);return{productList:i,categoryId:a}}catch(e){return await(new Vi).jsonError({exception:e,error:"getQCAmazonOrderStatus Error"},null,null),{vouchers:null,success:!1,message:"Exception Occurred:"+e,exception:!0}}}async getQuickCilverCatalogList(e){try{await(new Vi).log("getQCCatalog Initialising QC  Object",!1,null,null);const t=new Qo(Yi.quickcilverConfig);await(new Vi).log("QC Getting Access Token",!1,null,null);const{access_token:n,codeException:r,oAuthException:a}=await this.getQucikCilverBearerToken(null,null);if(await(new Vi).log(`access_token ${n}`,!1,null,null),await(new Vi).log(`codeException ${r}`,!1,null,null),await(new Vi).log(`oAuthException ${a}`,!1,null,null),!e){const{categoryIds:r}=await t.getCategory(n);e=r}await(new Vi).log(`categoryId: ${e}`,!1,null,null);const{productList:i}=await t.getProducts(e,n);return await(new Vi).log(`productList: ${JSON.stringify(i)}`,!1,null,null),{productList:i,categoryId:e}}catch(e){return await(new Vi).jsonError({exception:e,error:"get Quick Cilver CatalogList Error"},null,null),{vouchers:null,success:!1,message:"Exception Occurred:"+e,exception:!0}}}async updateQuickCilverCatalog(){try{const e=new Qo(Yi.quickcilverConfig);await(new Vi).log("QC Getting Access Token",!1,null,null);const{access_token:t,codeException:n,oAuthException:r}=await this.getQucikCilverBearerToken(null,null);await(new Vi).log(`access_token ${t}`,!1,null,null),await(new Vi).log(`codeException ${n}`,!1,null,null),await(new Vi).log(`oAuthException ${r}`,!1,null,null);const{categoryId:a}=await e.getCategory(t);return await(new Vi).log(`categoryId: ${a}`,!1,null,null),{categoryId:a}}catch(e){return await(new Vi).jsonError({exception:e,error:"getQuick cilver Error"},null,null),{vouchers:null,success:!1,message:"Exception Occurred:"+e,exception:!0}}}}var os=e=>{try{const[t,n,r]=e.split("-"),[a,i,o]=e.split("-")[3].split(":"),s=new Date(Date.UTC(t,n,r,a,i,o)).getTime();return new Date(s-198e5)}catch(e){return null}},ss=e=>{try{const t=new Date(e);return t.toISOString()}catch(e){}};class ls{constructor(e,t){this.get=null,this.set=null,this.services=null,this.accountabilitySchema=null,this.itemsService=null,this.storeToInventory=async({vouchers:e,reference_id:t,orderId:n,options:r,brand_sku:a,vendor_code:i})=>{var o,s;try{const l=new Ui(this.itemsService,this.accountabilitySchema),c=new Mi(this.itemsService,this.accountabilitySchema),u=a||t.split("-")[0],d=await l.getBrandSkuMapping(u,t,i),p=d?d.amount:null,h=d?d.currency:null,m=null!==(s=null===(o=null==d?void 0:d.brand)||void 0===o?void 0:o.brand_name)&&void 0!==s?s:null,f=await l.getVendorFromVendorCode(Li.vendor_id_mapping.WORK_ADVANTAGE,t),y=f?f.id:null;let g=!(!r||!r.redeemed||"boolean"!=typeof r.redeemed)&&r.redeemed;const b=r&&r.order_id?r.order_id:null,v=r&&r.extra?r.extra:{},w=[];let S=[];if(e){for(let t=0;t<e.length;t++){let i="";r&&r.extra&&r.extra.voucher_order_type&&(i=r.extra.voucher_order_type.toLowerCase());let o=r.link_reference_id||"",s=r.reference_code_otp||"";"link"===i&&(o=await this.generateUniqueCode(),s=await this.generateOTP(),n="",r.soft_link_order_id=r.soft_link_order_id?"":a+"-"+o,g=!1);const l={code:e[t].cardnumber,pin:e[t].pin_or_url,product_code:u,price:p,currency:h,gift_card:g,order_id:b,vendor_order_id:n,vendors:y,validity:os(e[t].expiry),link_reference_id:o,reference_code_otp:s,soft_link_order_id:r.soft_link_order_id||"",link_ledger_reference_id:o?r.reference_id:"",brand_name:m,...v};w.push(l),e[t].link_reference_id=o,e[t].reference_code_otp=s}S=e}await(new Vi).log("vouchersToSave",!1,t,i);let E=[];return w.length&&(await(new Vi).log("PrevOrd Saving Vouchers to Inventory",!1,t,i),E=await c.vouchersToInventory(w),E||(await(new Vi).log("PrevOrd Retrieving Vouchers from Inventory",!1,t,i),E=await l.voucherKeysFromInventory(w.map((e=>e.code)))),await(new Vi).log("PrevOrd Saved Voucher Keys:"+JSON.stringify(E),!1,t,i)),{keys:E,VoucherList:S}}catch(e){await(new Vi).jsonError({exception:e,error:"PrevOrd storeToInventory Error"},t,i)}},this.itemsService=e,this.accountabilitySchema=t}async getOrderDetails(e,t){try{new Ui(this.itemsService,this.accountabilitySchema),new Mi(this.itemsService,this.accountabilitySchema);const n=new is,{vouchers:r,success:a,message:i,exception:o,orderId:s}=await n.getWorkAdvantagePreviousOrder(e,t);return{vouchers:r,success:a,message:i,exception:o,orderId:s}}catch(n){await(new Vi).jsonError({exception:n,error:"PrevOrd getOrderDetails Error"},e,t)}}async placeNewWaOrder(e,t,n,r,a){try{const i=new Ui(this.itemsService,this.accountabilitySchema),o=new is,s=await i.mappedVendorActiveBrandSKU(n,r,e),l=!a||null==a.retrieveIfRedeemed||a.retrieveIfRedeemed;if(s&&s.vendor_sku){const n=s.vendor_sku,{vouchers:a,success:i,message:c,exception:u,orderId:d,vendorCode:p}=await o.getWorkAdvantageVoucher(n,t,e,l,r);return{vouchers:a,success:i,message:c,exception:u,orderId:d,vendorCode:p}}return await(new Vi).log("`No Vendor Sku Mapping from Brand SKU:${brand_sku}`",!1,e,r),{vouchers:null,success:!1,message:`No Vendor Sku Mapping from Brand SKU:${n}`,exception:!0,orderId:null,vendorCode:r}}catch(t){await(new Vi).jsonError({exception:t,error:"PrevOrd placeNewWaOrder Error"},e,r)}return{vouchers:null,success:!1,message:"PrevOrd placeNewWaOrder Error",exception:!0,orderId:null,vendorCode:r}}async generateUniqueCode(){try{const e=new Ui(this.itemsService,this.accountabilitySchema);let t=await this.generateRandomChars(16);const n=await e.getVoucherFromInventory(t);let r=[];for(0!==n.length&&(r=n.filter((e=>e.link_reference_id==t)));r.length>0;){t=await this.generateRandomChars(16);const n=await e.getVoucherFromInventory(t);0!==n.length&&(r=n.filter((e=>e.link_reference_id==t)))}return t}catch(e){await(new Vi).jsonError({exception:e,error:"generate Unique Code Error"},null,null)}}async generateRandomChars(e){try{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let r=0;r<e;r++){const e=Math.floor(Math.random()*t.length);n+=t.charAt(e)}return n}catch(e){await(new Vi).jsonError({exception:e,error:"generate Random Chars Error"},null,null)}}async generateOTP(){try{return Math.floor(1e3+9e3*Math.random()).toString()}catch(e){await(new Vi).jsonError({exception:e,error:"generate OTP Error"},null,null)}}}class cs{constructor(e,t){this.get=null,this.set=null,this.services=null,this.accountabilitySchema=null,this.itemsService=null,this.storeToInventory=async({vouchers:e,reference_id:t,orderId:n,options:r,brand_sku:a,vendor_code:i})=>{var o,s;try{const l=new Ui(this.itemsService,this.accountabilitySchema),c=new Mi(this.itemsService,this.accountabilitySchema),u=a||t.split("-")[0],d=await l.getBrandSkuMapping(u,t,i),p=d?d.amount:null,h=d?d.currency:null,m=null!==(s=null===(o=null==d?void 0:d.brand)||void 0===o?void 0:o.brand_name)&&void 0!==s?s:null,f=await l.getVendorFromVendorCode(Li.vendor_id_mapping.AMAZON_QC,t),y=f?f.id:null;let g=!(!r||!r.redeemed||"boolean"!=typeof r.redeemed)&&r.redeemed;const b=r&&r.order_id?r.order_id:null,v=r&&r.extra?r.extra:{},w=[];let S=[];if(e){for(let t=0;t<e.length;t++){let i="";r&&r.extra&&r.extra.voucher_order_type&&(i=r.extra.voucher_order_type.toLowerCase());let o=r.link_reference_id||"",s=r.reference_code_otp||"";"link"===i&&(o=await this.generateUniqueCode(),s=await this.generateOTP(),n="",r.soft_link_order_id=r.soft_link_order_id?"":a+"-"+o,g=!1);const l={code:e[t].cardnumber,pin:e[t].pin_or_url,product_code:u,price:p,currency:h,gift_card:g,order_id:b,vendor_order_id:n,vendors:y,validity:new Date(e[t].expiry),link_reference_id:o,reference_code_otp:s,soft_link_order_id:r.soft_link_order_id||"",link_ledger_reference_id:o?r.reference_id:"",brand_name:m,...v};w.push(l),e[t].link_reference_id=o,e[t].reference_code_otp=s}S=e}let E=[];return w.length&&(await(new Vi).log("PrevOrd Saving Vouchers to Inventory",!1,t,i),E=await c.vouchersToInventory(w),E||(await(new Vi).log("PrevOrd Retrieving Vouchers from Inventory",!1,t,i),E=await l.voucherKeysFromInventory(w.map((e=>e.code)))),await(new Vi).log(`PrevOrd Saved Voucher Keys:${E}`,!1,t,i)),{keys:E,VoucherList:S}}catch(e){await(new Vi).jsonError({exception:e,error:"PrevOrd storeToInventory Error"},t,i)}},this.itemsService=e,this.accountabilitySchema=t}async placeOrder(e,t,n,r,a,i,o){try{const s=new Ui(this.itemsService,this.accountabilitySchema),l=(new Mi(this.itemsService,this.accountabilitySchema),new is),c=await s.getBrandSkuMapping(n,e,o),u=c?c.amount:null,d=c?c.currency:null,p=await s.checkBrandVendorMapping(n,u,d,Li.vendor_id_mapping.AMAZON_QC,e,o),h=await s.mappedVendorActiveBrandSKU(n,Li.vendor_id_mapping.AMAZON_QC,e);if(u&&d&&p&&h&&h.vendor_sku){const n=h.vendor_sku,{vouchers:s,success:c,message:p,exception:m,orderId:f,status:y,statusCode:g,walletBalance:b}=await l.getQCAmazonVoucher(n,t,e,r.retrieveIfRedeemed,u,d,a,!!r.syncOnly,i,o);return{vouchers:s,success:c,message:p,exception:m,orderId:f,status:y,statusCode:g,walletBalance:b}}return await(new Vi).log(`Either No Vendor Sku Mapping from Brand SKU:${n} or Incorrect Brand SKU Mapping or Brand Vendor Mapping Absent`,!1,e,o),{vouchers:null,success:!1,message:`Either No Vendor Sku Mapping from Brand SKU:${n} or Incorrect Brand SKU Mapping or Brand Vendor Mapping Absent`,exception:!0,orderId:null,vendorCode:o}}catch(t){await(new Vi).jsonError({exception:t,error:`QC placeNewWaOrder Error : ${t}`},e,o)}return{vouchers:null,success:!1,message:"QC placeNewWaOrder Error :",exception:!0,orderId:null,vendorCode:o}}async getOrderDetails(e,t,n){try{new Ui(this.itemsService,this.accountabilitySchema),new Mi(this.itemsService,this.accountabilitySchema);const r=new is,{vouchers:a,success:i,message:o,exception:s,orderId:l,status:c}=await r.getQCAmazonOlderOrder(e,t,n);return{vouchers:a,success:i,message:o,exception:s,orderId:l,status:c}}catch(t){await(new Vi).jsonError({exception:t,error:"QC placeNewWaOrder Error"},e,n)}}async checkOrderStatus(e,t){try{new Ui(this.itemsService,this.accountabilitySchema),new Mi(this.itemsService,this.accountabilitySchema);const n=new is;return await n.getQCAmazonOrderStatus(e,t)}catch(n){await(new Vi).jsonError({exception:n,error:`QC checkOrderStatus Error : ${n}`},e,t)}}async generateUniqueCode(){try{const e=new Ui(this.itemsService,this.accountabilitySchema);new Mi(this.itemsService,this.accountabilitySchema);let t=await this.generateRandomChars(16);const n=await e.getVoucherFromInventory(t);let r=[];for(0!==n.length&&(r=n.filter((e=>e.link_reference_id==t)));r.length>0;){t=await this.generateRandomChars(16);const n=await e.getVoucherFromInventory(t);0!==n.length&&(r=n.filter((e=>e.link_reference_id==t)))}return t}catch(e){return await(new Vi).jsonError({exception:e,error:"generate Unique Code Error"},null,null),null}}async generateRandomChars(e){try{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let r=0;r<e;r++){const e=Math.floor(Math.random()*t.length);n+=t.charAt(e)}return n}catch(e){return await(new Vi).jsonError({exception:e,error:"generate Random Chars Error"},null,null),null}}async generateOTP(){try{return Math.floor(1e3+9e3*Math.random()).toString()}catch(e){return await(new Vi).jsonError({exception:e,error:"generate OTP Error"},null,null),null}}}class us{constructor(e,t){this.get=null,this.set=null,this.services=null,this.accountabilitySchema=null,this.itemsService=null,this.storeToInventory=async(e,t,n,r,a,i)=>{var o,s;try{await(new Vi).log("Initialising Flipkart Inventory",!1,t,r);const l=new Ui(this.itemsService,this.accountabilitySchema),c=new Mi(this.itemsService,this.accountabilitySchema),u=t.split("-")[0],d=await l.getBrandSkuMapping(u,t,r),p=(d&&d.amount,d?d.currency:null),h=null!==(s=null===(o=null==d?void 0:d.brand)||void 0===o?void 0:o.brand_name)&&void 0!==s?s:null,m=await l.getVendorFromVendorCode(Li.vendor_id_mapping.FLIPKART_EGV,t),f=m?m.id:null;let y=!(!n||!n.redeemed||"boolean"!=typeof n.redeemed)&&n.redeemed,g=n&&n.order_id?n.order_id:null;const b=n&&n.extra?n.extra:{};let v;const w=[];let S=[];if(0!==e.length){for(let t=0;t<e.length;t++){let r="";n&&n.extra&&n.extra.voucher_order_type&&(r=n.extra.voucher_order_type.toLowerCase());let o=n.link_reference_id||"",s=n.reference_code_otp||"";v=ss(e[t].egv.expiryDate),"link"===r&&(o=await this.generateUniqueCode(),s=await this.generateOTP(),g="",y=!1,n.soft_link_order_id=n.soft_link_order_id?"":a+"-"+o),o&&(g="");const l={code:e[t].egv.code,pin:e[t].egv.pin,price:e[t].egv.balance,currency:p,gift_card:y,product_code:e[t].egv.sku,order_id:g,vendor_order_id:e[t].egv.transactionId,vendors:f,validity:v,link_reference_id:o,reference_code_otp:s,soft_link_order_id:n.soft_link_order_id||"",link_ledger_reference_id:o?n.reference_id:"",bulk_qty_status:i||!1,brand_name:h,...b};w.push(l),e[t].link_reference_id=o,e[t].reference_code_otp=s}S=e}let E=[];if(0!==w.length){await(new Vi).log("PrevOrd Saving Vouchers to Inventory",!1,t,r);for(let e=0;e<w.length;e++){const t=await l.getVendorTrasanctionDetails(w[e].vendor_order_id);if(0!==t.length)t[0].code==w[e].code&&t[0].pin!==w[e].pin&&c.updateInventoryPin(t[0].id,w[e].pin),i&&!t[0].bulk_qty_status&&c.updateBulkQuantityStatus(t[0].id,i),E.push(t[0].id);else{const t=await c.vouchersToSingleInventory(w[e]);E.push(t)}}E||(await(new Vi).log("PrevOrd Retrieving Vouchers from Inventory",!1,t,r),E=await l.voucherKeysFromInventory(w.map((e=>e.code)))),await(new Vi).log(`PrevOrd Saved Voucher Keys: ${E}`,!1,t,r)}return{keys:E,VoucherList:S}}catch(e){return await(new Vi).log(`Flipkart Inventory Error: ${e}`,!1,t,r),await(new Vi).jsonError({exception:e,error:"Flipkart PrevOrd storeToInventory Error"},t,r),{giftCardList:null,keys:null,success:!1,message:`${e}`,exception:!1,orderId:null,vendorCode:r}}},this.itemsService=e,this.accountabilitySchema=t}async flipkartplaceOrder(e,t,n,r,a,i){try{const r=new Ui(this.itemsService,this.accountabilitySchema),a=(new Mi(this.itemsService,this.accountabilitySchema),new is(this.itemsService,this.accountabilitySchema)),o=await r.getBrandSkuMapping(n,e,i),s=o?o.amount:null,l=o?o.currency:null,c=await r.checkBrandVendorMapping(n,s,l,Li.vendor_id_mapping.FLIPKART_EGV,e,i),u=await r.mappedVendorActiveBrandSKU(n,i,e);if(s&&l&&c&&u&&u.vendor_sku){u.vendor_sku;const{giftCardList:r,success:o,message:l,codeException:c,vendorCode:d}=await a.getFlipkartVoucher(t,e,s,i,n);return await(new Vi).log(`Flipkart Place Order giftCardList status:${o}`,c,e,i),await(new Vi).log(`Flipkart Place Order giftCardList message:${l}`,c,e,i),{giftCardList:r,success:o,message:l,exception:c,orderId:null,vendorCode:d}}return{giftCardList:null,success:!1,message:`Either No Vendor Sku Mapping from Brand SKU:${n} or Incorrect Brand SKU Mapping or Brand Vendor Mapping Absent`,exception:!1,orderId:null,vendorCode:i}}catch(t){return await(new Vi).jsonError({exception:t,error:"Flipkart placeNewWaOrder Error"},e,i),{giftCardList:null,success:!1,message:`${t}`,exception:!1,orderId:null,vendorCode:i}}}async generateUniqueCode(){try{const e=new Ui(this.itemsService,this.accountabilitySchema);new Mi(this.itemsService,this.accountabilitySchema);let t=await this.generateRandomChars(16);const n=await e.getVoucherFromInventory(t);let r=[];for(0!==n.length&&(r=n.filter((e=>e.link_reference_id==t)));r.length>0;){t=await this.generateRandomChars(16);const n=await e.getVoucherFromInventory(t);0!==n.length&&(r=n.filter((e=>e.link_reference_id==t)))}return t}catch(e){return await(new Vi).jsonError({exception:e,error:"generate Unique Code error"},null,null),null}}async generateRandomChars(e){try{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let r=0;r<e;r++){const e=Math.floor(Math.random()*t.length);n+=t.charAt(e)}return n}catch(e){return await(new Vi).jsonError({exception:e,error:"generate Random Chars"},null,null),null}}async generateOTP(){try{return Math.floor(1e3+9e3*Math.random()).toString()}catch(e){return await(new Vi).jsonError({exception:e,error:"generate OTP"},null,null),null}}}class ds{constructor(e,t){this.get=null,this.set=null,this.services=null,this.accountabilitySchema=null,this.itemsService=null,this.storeToInventory=async({vouchers:e,reference_id:t,orderId:n,options:r,brand_sku:a,vendor_code:i})=>{var o,s;try{const l=new Ui(this.itemsService,this.accountabilitySchema),c=new Mi(this.itemsService,this.accountabilitySchema),u=a||t.split("-")[0],d=await l.getBrandSkuMapping(u,t,i),p=d?d.amount:null,h=d?d.currency:null,m=null!==(s=null===(o=null==d?void 0:d.brand)||void 0===o?void 0:o.brand_name)&&void 0!==s?s:null,f=await l.getVendorFromVendorCode(Li.vendor_id_mapping.QUICKCILVER_EGV,t),y=f?f.id:null;let g=!(!r||!r.redeemed||"boolean"!=typeof r.redeemed)&&r.redeemed;const b=r&&r.order_id?r.order_id:null,v=r&&r.extra?r.extra:{},w=[];let S=[];if(e){for(let t=0;t<e.length;t++){let i="";r&&r.extra&&r.extra.voucher_order_type&&(i=r.extra.voucher_order_type.toLowerCase());let o=r.link_reference_id||"",s=r.reference_code_otp||"";"link"===i&&(o=await this.generateUniqueCode(),s=await this.generateOTP(),n="",r.soft_link_order_id=r.soft_link_order_id?"":a+"-"+o,g=!1);const l={code:e[t].cardnumber,pin:e[t].pin_or_url,product_code:u,price:p,currency:h,gift_card:g,order_id:b,vendor_order_id:n,vendors:y,validity:new Date(e[t].expiry),link_reference_id:o,reference_code_otp:s,soft_link_order_id:r.soft_link_order_id||"",link_ledger_reference_id:o?r.reference_id:"",brand_name:m,...v};w.push(l),e[t].link_reference_id=o,e[t].reference_code_otp=s}S=e}let E=[];return w.length&&(await(new Vi).log("PrevOrd Saving Vouchers to Inventory",!1,t,i),E=await c.vouchersToInventory(w),E||(await(new Vi).log("PrevOrd Retrieving Vouchers from Inventory",!1,t,i),E=await l.voucherKeysFromInventory(w.map((e=>e.code)))),await(new Vi).log(`PrevOrd Saved Voucher Keys:${E}`,!1,t,i)),{keys:E,VoucherList:S}}catch(e){await(new Vi).jsonError({exception:e,error:"PrevOrd storeToInventory Error"},t,i)}},this.itemsService=e,this.accountabilitySchema=t}async placeOrder(e,t,n,r,a,i,o){try{const s=new Ui(this.itemsService,this.accountabilitySchema),l=(new Mi(this.itemsService,this.accountabilitySchema),new is),c=await s.getBrandSkuMapping(n,e,o),u=c?c.amount:null,d=c?c.currency:null,p=await s.checkBrandVendorMapping(n,u,d,Li.vendor_id_mapping.QUICKCILVER_EGV,e,o),h=await s.mappedVendorActiveBrandSKU(n,Li.vendor_id_mapping.QUICKCILVER_EGV,e);if(u&&d&&p&&h&&h.vendor_sku){const n=h.vendor_sku,{vouchers:s,success:c,message:p,exception:m,orderId:f,status:y,statusCode:g,walletBalance:b}=await l.getQuickCilverVoucher(n,t,e,r.retrieveIfRedeemed,u,d,a,!!r.syncOnly,i,o);return{vouchers:s,success:c,message:p,exception:m,orderId:f,status:y,statusCode:g,walletBalance:b}}return await(new Vi).log(`Either No Vendor Sku Mapping from Brand SKU:${n} or Incorrect Brand SKU Mapping or Brand Vendor Mapping Absent`,!1,e,o),{vouchers:null,success:!1,message:`Either No Vendor Sku Mapping from Brand SKU:${n} or Incorrect Brand SKU Mapping or Brand Vendor Mapping Absent`,exception:!0,orderId:null,vendorCode:o}}catch(t){await(new Vi).jsonError({exception:t,error:`QC placeNewWaOrder Error : ${t}`},e,o)}return{vouchers:null,success:!1,message:"QC placeNewWaOrder Error :",exception:!0,orderId:null,vendorCode:o}}async getOrderDetails(e,t,n){try{new Ui(this.itemsService,this.accountabilitySchema),new Mi(this.itemsService,this.accountabilitySchema);const r=new is,{vouchers:a,success:i,message:o,exception:s,orderId:l,status:c}=await r.getQCOlderOrder(e,t,n);return{vouchers:a,success:i,message:o,exception:s,orderId:l,status:c}}catch(t){await(new Vi).jsonError({exception:t,error:"QC placeNewWaOrder Error"},e,n)}}async checkOrderStatus(e,t){try{new Ui(this.itemsService,this.accountabilitySchema),new Mi(this.itemsService,this.accountabilitySchema);const n=new is;return await n.getQCOrderStatus(e,t)}catch(n){await(new Vi).jsonError({exception:n,error:`QC checkOrderStatus Error : ${n}`},e,t)}}async generateUniqueCode(){try{const e=new Ui(this.itemsService,this.accountabilitySchema);new Mi(this.itemsService,this.accountabilitySchema);let t=await this.generateRandomChars(16);const n=await e.getVoucherFromInventory(t);let r=[];for(0!==n.length&&(r=n.filter((e=>e.link_reference_id==t)));r.length>0;){t=await this.generateRandomChars(16);const n=await e.getVoucherFromInventory(t);0!==n.length&&(r=n.filter((e=>e.link_reference_id==t)))}return t}catch(e){return await(new Vi).jsonError({exception:e,error:"generate Unique Code Error"},null,null),null}}async generateRandomChars(e){try{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let r=0;r<e;r++){const e=Math.floor(Math.random()*t.length);n+=t.charAt(e)}return n}catch(e){return await(new Vi).jsonError({exception:e,error:"generate Random Chars Error"},null,null),null}}async generateOTP(){try{return Math.floor(1e3+9e3*Math.random()).toString()}catch(e){return await(new Vi).jsonError({exception:e,error:"generate OTP Error"},null,null),null}}}class ps{constructor(e,t){this.get=null,this.set=null,this.services=null,this.accountabilitySchema=null,this.itemsService=null,this.storeToInventory=async({vouchers:e,reference_id:t,orderId:n,options:r,brand_sku:a,vendor_code:i})=>{var o,s;try{const l=new Ui(this.itemsService,this.accountabilitySchema),c=new Mi(this.itemsService,this.accountabilitySchema),u=a||t.split("-")[0],d=await l.getBrandSkuMapping(u,t,i),p=d?d.amount:null,h=d?d.currency:null,m=null!==(s=null===(o=null==d?void 0:d.brand)||void 0===o?void 0:o.brand_name)&&void 0!==s?s:null,f=await l.getVendorFromVendorCode(Li.vendor_id_mapping.QUICKCILVER_EGV,t),y=f?f.id:null;let g=!(!r||!r.redeemed||"boolean"!=typeof r.redeemed)&&r.redeemed;const b=r&&r.order_id?r.order_id:null,v=r&&r.extra?r.extra:{},w=[];let S=[];if(e){for(let t=0;t<e.length;t++){let i="";r&&r.extra&&r.extra.voucher_order_type&&(i=r.extra.voucher_order_type.toLowerCase());let o=r.link_reference_id||"",s=r.reference_code_otp||"";"link"===i&&(o=await this.generateUniqueCode(),s=await this.generateOTP(),n="",r.soft_link_order_id=r.soft_link_order_id?"":a+"-"+o,g=!1);const l={code:e[t].cardnumber,pin:e[t].pin_or_url,product_code:u,price:p,currency:h,gift_card:g,order_id:b,vendor_order_id:n,vendors:y,validity:new Date(e[t].expiry),link_reference_id:o,reference_code_otp:s,soft_link_order_id:r.soft_link_order_id||"",link_ledger_reference_id:o?r.reference_id:"",brand_name:m,...v};w.push(l),e[t].link_reference_id=o,e[t].reference_code_otp=s}S=e}let E=[];return w.length&&(await(new Vi).log("PrevOrd Saving Vouchers to Inventory",!1,t,i),E=await c.vouchersToInventory(w),E||(await(new Vi).log("PrevOrd Retrieving Vouchers from Inventory",!1,t,i),E=await l.voucherKeysFromInventory(w.map((e=>e.code)))),await(new Vi).log(`PrevOrd Saved Voucher Keys:${E}`,!1,t,i)),{keys:E,VoucherList:S}}catch(e){await(new Vi).jsonError({exception:e,error:"PrevOrd storeToInventory Error"},t,i)}},this.itemsService=e,this.accountabilitySchema=t}async placeOrder(e,t,n,r,a,i,o){try{const r=new Ui(this.itemsService,this.accountabilitySchema),a=(new Mi(this.itemsService,this.accountabilitySchema),new is,await r.getBrandSkuMapping(n,e,o)),i=a?a.amount:null,s=a?a.currency:null,l=await r.checkBrandVendorMapping(n,i,s,Li.vendor_id_mapping.REWARD_STORE,e,o),c=await r.mappedVendorActiveBrandSKU(n,Li.vendor_id_mapping.REWARD_STORE,e);if(i&&s&&l&&c&&c.vendor_sku){return{...await as(c.vendor_sku,i,t,e,o),vendor_code:o}}return await(new Vi).log(`Either No Vendor Sku Mapping from Brand SKU:${n} or Incorrect Brand SKU Mapping or Brand Vendor Mapping Absent`,!1,e,o),{vouchers:null,success:!1,message:`Either No Vendor Sku Mapping from Brand SKU:${n} or Incorrect Brand SKU Mapping or Brand Vendor Mapping Absent`,exception:!0,orderId:null,vendorCode:o}}catch(t){await(new Vi).jsonError({exception:t,error:`Reward Store  Controller placeNewWaOrder Error : ${t}`},e,o)}return{vouchers:null,success:!1,message:"Reward Store  Controller placeNewWaOrder Error :",exception:!0,orderId:null,vendorCode:o}}async generateUniqueCode(){try{const e=new Ui(this.itemsService,this.accountabilitySchema);new Mi(this.itemsService,this.accountabilitySchema);let t=await this.generateRandomChars(16);const n=await e.getVoucherFromInventory(t);let r=[];for(0!==n.length&&(r=n.filter((e=>e.link_reference_id==t)));r.length>0;){t=await this.generateRandomChars(16);const n=await e.getVoucherFromInventory(t);0!==n.length&&(r=n.filter((e=>e.link_reference_id==t)))}return t}catch(e){return await(new Vi).jsonError({exception:e,error:"generate Unique Code Error"},null,null),null}}async generateRandomChars(e){try{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let r=0;r<e;r++){const e=Math.floor(Math.random()*t.length);n+=t.charAt(e)}return n}catch(e){return await(new Vi).jsonError({exception:e,error:"generate Random Chars Error"},null,null),null}}async generateOTP(){try{return Math.floor(1e3+9e3*Math.random()).toString()}catch(e){return await(new Vi).jsonError({exception:e,error:"generate OTP Error"},null,null),null}}}
/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var hs={version:"0.18.5"},ms=1252,fs=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],ys=function(e){-1!=fs.indexOf(e)&&(ms=e)};var gs=function(e){ys(e)};function bs(){gs(1200),ys(1252)}var vs=function(e){return String.fromCharCode(e)},ws=function(e){return String.fromCharCode(e)},Ss="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Es(e){for(var t="",n=0,r=0,a=0,i=0,o=0,s=0,l=0,c=0;c<e.length;)i=(n=e.charCodeAt(c++))>>2,o=(3&n)<<4|(r=e.charCodeAt(c++))>>4,s=(15&r)<<2|(a=e.charCodeAt(c++))>>6,l=63&a,isNaN(r)?s=l=64:isNaN(a)&&(l=64),t+=Ss.charAt(i)+Ss.charAt(o)+Ss.charAt(s)+Ss.charAt(l);return t}function xs(e){var t="",n=0,r=0,a=0,i=0,o=0,s=0;e=e.replace(/[^\w\+\/\=]/g,"");for(var l=0;l<e.length;)n=Ss.indexOf(e.charAt(l++))<<2|(i=Ss.indexOf(e.charAt(l++)))>>4,t+=String.fromCharCode(n),r=(15&i)<<4|(o=Ss.indexOf(e.charAt(l++)))>>2,64!==o&&(t+=String.fromCharCode(r)),a=(3&o)<<6|(s=Ss.indexOf(e.charAt(l++))),64!==s&&(t+=String.fromCharCode(a));return t}var _s=function(){return"undefined"!=typeof Buffer&&"undefined"!=typeof process&&void 0!==process.versions&&!!process.versions.node}(),ks=function(){if("undefined"!=typeof Buffer){var e=!Buffer.from;if(!e)try{Buffer.from("foo","utf8")}catch(t){e=!0}return e?function(e,t){return t?new Buffer(e,t):new Buffer(e)}:Buffer.from.bind(Buffer)}return function(){}}();function Is(e){return _s?Buffer.alloc?Buffer.alloc(e):new Buffer(e):"undefined"!=typeof Uint8Array?new Uint8Array(e):new Array(e)}function Ts(e){return _s?Buffer.allocUnsafe?Buffer.allocUnsafe(e):new Buffer(e):"undefined"!=typeof Uint8Array?new Uint8Array(e):new Array(e)}var As=function(e){return _s?ks(e,"binary"):e.split("").map((function(e){return 255&e.charCodeAt(0)}))};function Os(e){if("undefined"==typeof ArrayBuffer)return As(e);for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r!=e.length;++r)n[r]=255&e.charCodeAt(r);return t}function Ks(e){if(Array.isArray(e))return e.map((function(e){return String.fromCharCode(e)})).join("");for(var t=[],n=0;n<e.length;++n)t[n]=String.fromCharCode(e[n]);return t.join("")}var Cs=_s?function(e){return Buffer.concat(e.map((function(e){return Buffer.isBuffer(e)?e:ks(e)})))}:function(e){if("undefined"!=typeof Uint8Array){var t=0,n=0;for(t=0;t<e.length;++t)n+=e[t].length;var r=new Uint8Array(n),a=0;for(t=0,n=0;t<e.length;n+=a,++t)if(a=e[t].length,e[t]instanceof Uint8Array)r.set(e[t],n);else{if("string"==typeof e[t])throw"wtf";r.set(new Uint8Array(e[t]),n)}return r}return[].concat.apply([],e.map((function(e){return Array.isArray(e)?e:[].slice.call(e)})))};var Rs=/\u0000/g,js=/[\u0001-\u0006]/g;function Ps(e){for(var t="",n=e.length-1;n>=0;)t+=e.charAt(n--);return t}function Ds(e,t){var n=""+e;return n.length>=t?n:ql("0",t-n.length)+n}function Ns(e,t){var n=""+e;return n.length>=t?n:ql(" ",t-n.length)+n}function Ls(e,t){var n=""+e;return n.length>=t?n:n+ql(" ",t-n.length)}var Ms=Math.pow(2,32);function Fs(e,t){return e>Ms||e<-Ms?function(e,t){var n=""+Math.round(e);return n.length>=t?n:ql("0",t-n.length)+n}(e,t):function(e,t){var n=""+e;return n.length>=t?n:ql("0",t-n.length)+n}(Math.round(e),t)}function Bs(e,t){return t=t||0,e.length>=7+t&&103==(32|e.charCodeAt(t))&&101==(32|e.charCodeAt(t+1))&&110==(32|e.charCodeAt(t+2))&&101==(32|e.charCodeAt(t+3))&&114==(32|e.charCodeAt(t+4))&&97==(32|e.charCodeAt(t+5))&&108==(32|e.charCodeAt(t+6))}var Vs=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],Us=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];var Js={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"上午/下午 "hh"時"mm"分"ss"秒 "'},Gs={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},$s={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function qs(e,t,n){for(var r=e<0?-1:1,a=e*r,i=0,o=1,s=0,l=1,c=0,u=0,d=Math.floor(a);c<t&&(s=(d=Math.floor(a))*o+i,u=d*c+l,!(a-d<5e-8));)a=1/(a-d),i=o,o=s,l=c,c=u;if(u>t&&(c>t?(u=l,s=i):(u=c,s=o)),!n)return[0,r*s,u];var p=Math.floor(r*s/u);return[p,r*s-p*u,u]}function zs(e,t,n){if(e>2958465||e<0)return null;var r=0|e,a=Math.floor(86400*(e-r)),i=0,o=[],s={D:r,T:a,u:86400*(e-r)-a,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(s.u)<1e-6&&(s.u=0),t&&t.date1904&&(r+=1462),s.u>.9999&&(s.u=0,86400==++a&&(s.T=a=0,++r,++s.D)),60===r)o=n?[1317,10,29]:[1900,2,29],i=3;else if(0===r)o=n?[1317,8,29]:[1900,1,0],i=6;else{r>60&&--r;var l=new Date(1900,0,1);l.setDate(l.getDate()+r-1),o=[l.getFullYear(),l.getMonth()+1,l.getDate()],i=l.getDay(),r<60&&(i=(i+6)%7),n&&(i=function(e,t){t[0]-=581;var n=e.getDay();e<60&&(n=(n+6)%7);return n}(l,o))}return s.y=o[0],s.m=o[1],s.d=o[2],s.S=a%60,a=Math.floor(a/60),s.M=a%60,a=Math.floor(a/60),s.H=a,s.q=i,s}var Ws=new Date(1899,11,31,0,0,0),Ys=Ws.getTime(),Hs=new Date(1900,2,1,0,0,0);function Qs(e,t){var n=e.getTime();return t?n-=1262304e5:e>=Hs&&(n+=864e5),(n-(Ys+6e4*(e.getTimezoneOffset()-Ws.getTimezoneOffset())))/864e5}function Zs(e){return-1==e.indexOf(".")?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function Xs(e){var t,n=Math.floor(Math.log(Math.abs(e))*Math.LOG10E);return t=n>=-4&&n<=-1?e.toPrecision(10+n):Math.abs(n)<=9?function(e){var t=e<0?12:11,n=Zs(e.toFixed(12));return n.length<=t||(n=e.toPrecision(10)).length<=t?n:e.toExponential(5)}(e):10===n?e.toFixed(10).substr(0,12):function(e){var t=Zs(e.toFixed(11));return t.length>(e<0?12:11)||"0"===t||"-0"===t?e.toPrecision(6):t}(e),Zs(function(e){return-1==e.indexOf("E")?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}(t.toUpperCase()))}function el(e,t){switch(typeof e){case"string":return e;case"boolean":return e?"TRUE":"FALSE";case"number":return(0|e)===e?e.toString(10):Xs(e);case"undefined":return"";case"object":if(null==e)return"";if(e instanceof Date)return Sl(14,Qs(e,t&&t.date1904),t)}throw new Error("unsupported value in General format: "+e)}function tl(e,t,n,r){var a,i="",o=0,s=0,l=n.y,c=0;switch(e){case 98:l=n.y+543;case 121:switch(t.length){case 1:case 2:a=l%100,c=2;break;default:a=l%1e4,c=4}break;case 109:switch(t.length){case 1:case 2:a=n.m,c=t.length;break;case 3:return Us[n.m-1][1];case 5:return Us[n.m-1][0];default:return Us[n.m-1][2]}break;case 100:switch(t.length){case 1:case 2:a=n.d,c=t.length;break;case 3:return Vs[n.q][0];default:return Vs[n.q][1]}break;case 104:switch(t.length){case 1:case 2:a=1+(n.H+11)%12,c=t.length;break;default:throw"bad hour format: "+t}break;case 72:switch(t.length){case 1:case 2:a=n.H,c=t.length;break;default:throw"bad hour format: "+t}break;case 77:switch(t.length){case 1:case 2:a=n.M,c=t.length;break;default:throw"bad minute format: "+t}break;case 115:if("s"!=t&&"ss"!=t&&".0"!=t&&".00"!=t&&".000"!=t)throw"bad second format: "+t;return 0!==n.u||"s"!=t&&"ss"!=t?(s=r>=2?3===r?1e3:100:1===r?10:1,(o=Math.round(s*(n.S+n.u)))>=60*s&&(o=0),"s"===t?0===o?"0":""+o/s:(i=Ds(o,2+r),"ss"===t?i.substr(0,2):"."+i.substr(2,t.length-1))):Ds(n.S,t.length);case 90:switch(t){case"[h]":case"[hh]":a=24*n.D+n.H;break;case"[m]":case"[mm]":a=60*(24*n.D+n.H)+n.M;break;case"[s]":case"[ss]":a=60*(60*(24*n.D+n.H)+n.M)+Math.round(n.S+n.u);break;default:throw"bad abstime format: "+t}c=3===t.length?1:2;break;case 101:a=l,c=1}return c>0?Ds(a,c):""}function nl(e){if(e.length<=3)return e;for(var t=e.length%3,n=e.substr(0,t);t!=e.length;t+=3)n+=(n.length>0?",":"")+e.substr(t,3);return n}var rl=/%/g;function al(e,t){var n,r=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(0==t)return"0.0E+0";if(t<0)return"-"+al(e,-t);var a=e.indexOf(".");-1===a&&(a=e.indexOf("E"));var i=Math.floor(Math.log(t)*Math.LOG10E)%a;if(i<0&&(i+=a),-1===(n=(t/Math.pow(10,i)).toPrecision(r+1+(a+i)%a)).indexOf("e")){var o=Math.floor(Math.log(t)*Math.LOG10E);for(-1===n.indexOf(".")?n=n.charAt(0)+"."+n.substr(1)+"E+"+(o-n.length+i):n+="E+"+(o-i);"0."===n.substr(0,2);)n=(n=n.charAt(0)+n.substr(2,a)+"."+n.substr(2+a)).replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");n=n.replace(/\+-/,"-")}n=n.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,(function(e,t,n,r){return t+n+r.substr(0,(a+i)%a)+"."+r.substr(i)+"E"}))}else n=t.toExponential(r);return e.match(/E\+00$/)&&n.match(/e[+-]\d$/)&&(n=n.substr(0,n.length-1)+"0"+n.charAt(n.length-1)),e.match(/E\-/)&&n.match(/e\+/)&&(n=n.replace(/e\+/,"e")),n.replace("e","E")}var il=/# (\?+)( ?)\/( ?)(\d+)/;var ol=/^#*0*\.([0#]+)/,sl=/\).*[0#]/,ll=/\(###\) ###\\?-####/;function cl(e){for(var t,n="",r=0;r!=e.length;++r)switch(t=e.charCodeAt(r)){case 35:break;case 63:n+=" ";break;case 48:n+="0";break;default:n+=String.fromCharCode(t)}return n}function ul(e,t){var n=Math.pow(10,t);return""+Math.round(e*n)/n}function dl(e,t){var n=e-Math.floor(e),r=Math.pow(10,t);return t<(""+Math.round(n*r)).length?0:Math.round(n*r)}function pl(e,t,n){if(40===e.charCodeAt(0)&&!t.match(sl)){var r=t.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return n>=0?pl("n",r,n):"("+pl("n",r,-n)+")"}if(44===t.charCodeAt(t.length-1))return function(e,t,n){for(var r=t.length-1;44===t.charCodeAt(r-1);)--r;return fl(e,t.substr(0,r),n/Math.pow(10,3*(t.length-r)))}(e,t,n);if(-1!==t.indexOf("%"))return function(e,t,n){var r=t.replace(rl,""),a=t.length-r.length;return fl(e,r,n*Math.pow(10,2*a))+ql("%",a)}(e,t,n);if(-1!==t.indexOf("E"))return al(t,n);if(36===t.charCodeAt(0))return"$"+pl(e,t.substr(" "==t.charAt(1)?2:1),n);var a,i,o,s,l=Math.abs(n),c=n<0?"-":"";if(t.match(/^00+$/))return c+Fs(l,t.length);if(t.match(/^[#?]+$/))return"0"===(a=Fs(n,0))&&(a=""),a.length>t.length?a:cl(t.substr(0,t.length-a.length))+a;if(i=t.match(il))return function(e,t,n){var r=parseInt(e[4],10),a=Math.round(t*r),i=Math.floor(a/r),o=a-i*r,s=r;return n+(0===i?"":""+i)+" "+(0===o?ql(" ",e[1].length+1+e[4].length):Ns(o,e[1].length)+e[2]+"/"+e[3]+Ds(s,e[4].length))}(i,l,c);if(t.match(/^#+0+$/))return c+Fs(l,t.length-t.indexOf("0"));if(i=t.match(ol))return a=ul(n,i[1].length).replace(/^([^\.]+)$/,"$1."+cl(i[1])).replace(/\.$/,"."+cl(i[1])).replace(/\.(\d*)$/,(function(e,t){return"."+t+ql("0",cl(i[1]).length-t.length)})),-1!==t.indexOf("0.")?a:a.replace(/^0\./,".");if(t=t.replace(/^#+([0.])/,"$1"),i=t.match(/^(0*)\.(#*)$/))return c+ul(l,i[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,i[1].length?"0.":".");if(i=t.match(/^#{1,3},##0(\.?)$/))return c+nl(Fs(l,0));if(i=t.match(/^#,##0\.([#0]*0)$/))return n<0?"-"+pl(e,t,-n):nl(""+(Math.floor(n)+function(e,t){return t<(""+Math.round((e-Math.floor(e))*Math.pow(10,t))).length?1:0}(n,i[1].length)))+"."+Ds(dl(n,i[1].length),i[1].length);if(i=t.match(/^#,#*,#0/))return pl(e,t.replace(/^#,#*,/,""),n);if(i=t.match(/^([0#]+)(\\?-([0#]+))+$/))return a=Ps(pl(e,t.replace(/[\\-]/g,""),n)),o=0,Ps(Ps(t.replace(/\\/g,"")).replace(/[0#]/g,(function(e){return o<a.length?a.charAt(o++):"0"===e?"0":""})));if(t.match(ll))return"("+(a=pl(e,"##########",n)).substr(0,3)+") "+a.substr(3,3)+"-"+a.substr(6);var u="";if(i=t.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(i[4].length,7),s=qs(l,Math.pow(10,o)-1,!1),a=""+c," "==(u=fl("n",i[1],s[1])).charAt(u.length-1)&&(u=u.substr(0,u.length-1)+"0"),a+=u+i[2]+"/"+i[3],(u=Ls(s[2],o)).length<i[4].length&&(u=cl(i[4].substr(i[4].length-u.length))+u),a+=u;if(i=t.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(Math.max(i[1].length,i[4].length),7),c+((s=qs(l,Math.pow(10,o)-1,!0))[0]||(s[1]?"":"0"))+" "+(s[1]?Ns(s[1],o)+i[2]+"/"+i[3]+Ls(s[2],o):ql(" ",2*o+1+i[2].length+i[3].length));if(i=t.match(/^[#0?]+$/))return a=Fs(n,0),t.length<=a.length?a:cl(t.substr(0,t.length-a.length))+a;if(i=t.match(/^([#0?]+)\.([#0]+)$/)){a=""+n.toFixed(Math.min(i[2].length,10)).replace(/([^0])0+$/,"$1"),o=a.indexOf(".");var d=t.indexOf(".")-o,p=t.length-a.length-d;return cl(t.substr(0,d)+a+t.substr(t.length-p))}if(i=t.match(/^00,000\.([#0]*0)$/))return o=dl(n,i[1].length),n<0?"-"+pl(e,t,-n):nl(function(e){return e<2147483647&&e>-2147483648?""+(e>=0?0|e:e-1|0):""+Math.floor(e)}(n)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,(function(e){return"00,"+(e.length<3?Ds(0,3-e.length):"")+e}))+"."+Ds(o,i[1].length);switch(t){case"###,##0.00":return pl(e,"#,##0.00",n);case"###,###":case"##,###":case"#,###":var h=nl(Fs(l,0));return"0"!==h?c+h:"";case"###,###.00":return pl(e,"###,##0.00",n).replace(/^0\./,".");case"#,###.00":return pl(e,"#,##0.00",n).replace(/^0\./,".")}throw new Error("unsupported format |"+t+"|")}function hl(e,t){var n,r=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(0==t)return"0.0E+0";if(t<0)return"-"+hl(e,-t);var a=e.indexOf(".");-1===a&&(a=e.indexOf("E"));var i=Math.floor(Math.log(t)*Math.LOG10E)%a;if(i<0&&(i+=a),!(n=(t/Math.pow(10,i)).toPrecision(r+1+(a+i)%a)).match(/[Ee]/)){var o=Math.floor(Math.log(t)*Math.LOG10E);-1===n.indexOf(".")?n=n.charAt(0)+"."+n.substr(1)+"E+"+(o-n.length+i):n+="E+"+(o-i),n=n.replace(/\+-/,"-")}n=n.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,(function(e,t,n,r){return t+n+r.substr(0,(a+i)%a)+"."+r.substr(i)+"E"}))}else n=t.toExponential(r);return e.match(/E\+00$/)&&n.match(/e[+-]\d$/)&&(n=n.substr(0,n.length-1)+"0"+n.charAt(n.length-1)),e.match(/E\-/)&&n.match(/e\+/)&&(n=n.replace(/e\+/,"e")),n.replace("e","E")}function ml(e,t,n){if(40===e.charCodeAt(0)&&!t.match(sl)){var r=t.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return n>=0?ml("n",r,n):"("+ml("n",r,-n)+")"}if(44===t.charCodeAt(t.length-1))return function(e,t,n){for(var r=t.length-1;44===t.charCodeAt(r-1);)--r;return fl(e,t.substr(0,r),n/Math.pow(10,3*(t.length-r)))}(e,t,n);if(-1!==t.indexOf("%"))return function(e,t,n){var r=t.replace(rl,""),a=t.length-r.length;return fl(e,r,n*Math.pow(10,2*a))+ql("%",a)}(e,t,n);if(-1!==t.indexOf("E"))return hl(t,n);if(36===t.charCodeAt(0))return"$"+ml(e,t.substr(" "==t.charAt(1)?2:1),n);var a,i,o,s,l=Math.abs(n),c=n<0?"-":"";if(t.match(/^00+$/))return c+Ds(l,t.length);if(t.match(/^[#?]+$/))return a=""+n,0===n&&(a=""),a.length>t.length?a:cl(t.substr(0,t.length-a.length))+a;if(i=t.match(il))return function(e,t,n){return n+(0===t?"":""+t)+ql(" ",e[1].length+2+e[4].length)}(i,l,c);if(t.match(/^#+0+$/))return c+Ds(l,t.length-t.indexOf("0"));if(i=t.match(ol))return a=(a=(""+n).replace(/^([^\.]+)$/,"$1."+cl(i[1])).replace(/\.$/,"."+cl(i[1]))).replace(/\.(\d*)$/,(function(e,t){return"."+t+ql("0",cl(i[1]).length-t.length)})),-1!==t.indexOf("0.")?a:a.replace(/^0\./,".");if(t=t.replace(/^#+([0.])/,"$1"),i=t.match(/^(0*)\.(#*)$/))return c+(""+l).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,i[1].length?"0.":".");if(i=t.match(/^#{1,3},##0(\.?)$/))return c+nl(""+l);if(i=t.match(/^#,##0\.([#0]*0)$/))return n<0?"-"+ml(e,t,-n):nl(""+n)+"."+ql("0",i[1].length);if(i=t.match(/^#,#*,#0/))return ml(e,t.replace(/^#,#*,/,""),n);if(i=t.match(/^([0#]+)(\\?-([0#]+))+$/))return a=Ps(ml(e,t.replace(/[\\-]/g,""),n)),o=0,Ps(Ps(t.replace(/\\/g,"")).replace(/[0#]/g,(function(e){return o<a.length?a.charAt(o++):"0"===e?"0":""})));if(t.match(ll))return"("+(a=ml(e,"##########",n)).substr(0,3)+") "+a.substr(3,3)+"-"+a.substr(6);var u="";if(i=t.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(i[4].length,7),s=qs(l,Math.pow(10,o)-1,!1),a=""+c," "==(u=fl("n",i[1],s[1])).charAt(u.length-1)&&(u=u.substr(0,u.length-1)+"0"),a+=u+i[2]+"/"+i[3],(u=Ls(s[2],o)).length<i[4].length&&(u=cl(i[4].substr(i[4].length-u.length))+u),a+=u;if(i=t.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(Math.max(i[1].length,i[4].length),7),c+((s=qs(l,Math.pow(10,o)-1,!0))[0]||(s[1]?"":"0"))+" "+(s[1]?Ns(s[1],o)+i[2]+"/"+i[3]+Ls(s[2],o):ql(" ",2*o+1+i[2].length+i[3].length));if(i=t.match(/^[#0?]+$/))return a=""+n,t.length<=a.length?a:cl(t.substr(0,t.length-a.length))+a;if(i=t.match(/^([#0]+)\.([#0]+)$/)){a=""+n.toFixed(Math.min(i[2].length,10)).replace(/([^0])0+$/,"$1"),o=a.indexOf(".");var d=t.indexOf(".")-o,p=t.length-a.length-d;return cl(t.substr(0,d)+a+t.substr(t.length-p))}if(i=t.match(/^00,000\.([#0]*0)$/))return n<0?"-"+ml(e,t,-n):nl(""+n).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,(function(e){return"00,"+(e.length<3?Ds(0,3-e.length):"")+e}))+"."+Ds(0,i[1].length);switch(t){case"###,###":case"##,###":case"#,###":var h=nl(""+l);return"0"!==h?c+h:"";default:if(t.match(/\.[0#?]*$/))return ml(e,t.slice(0,t.lastIndexOf(".")),n)+cl(t.slice(t.lastIndexOf(".")))}throw new Error("unsupported format |"+t+"|")}function fl(e,t,n){return(0|n)===n?ml(e,t,n):pl(e,t,n)}var yl=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function gl(e){for(var t=0,n="",r="";t<e.length;)switch(n=e.charAt(t)){case"G":Bs(e,t)&&(t+=6),t++;break;case'"':for(;34!==e.charCodeAt(++t)&&t<e.length;);++t;break;case"\\":case"_":t+=2;break;case"@":++t;break;case"B":case"b":if("1"===e.charAt(t+1)||"2"===e.charAt(t+1))return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"上":if("A/P"===e.substr(t,3).toUpperCase())return!0;if("AM/PM"===e.substr(t,5).toUpperCase())return!0;if("上午/下午"===e.substr(t,5).toUpperCase())return!0;++t;break;case"[":for(r=n;"]"!==e.charAt(t++)&&t<e.length;)r+=e.charAt(t);if(r.match(yl))return!0;break;case".":case"0":case"#":for(;t<e.length&&("0#?.,E+-%".indexOf(n=e.charAt(++t))>-1||"\\"==n&&"-"==e.charAt(t+1)&&"0#".indexOf(e.charAt(t+2))>-1););break;case"?":for(;e.charAt(++t)===n;);break;case"*":++t," "!=e.charAt(t)&&"*"!=e.charAt(t)||++t;break;case"(":case")":++t;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;t<e.length&&"0123456789".indexOf(e.charAt(++t))>-1;);break;default:++t}return!1}var bl=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function vl(e,t){if(null==t)return!1;var n=parseFloat(t[2]);switch(t[1]){case"=":if(e==n)return!0;break;case">":if(e>n)return!0;break;case"<":if(e<n)return!0;break;case"<>":if(e!=n)return!0;break;case">=":if(e>=n)return!0;break;case"<=":if(e<=n)return!0}return!1}function wl(e,t){var n=function(e){for(var t=[],n=!1,r=0,a=0;r<e.length;++r)switch(e.charCodeAt(r)){case 34:n=!n;break;case 95:case 42:case 92:++r;break;case 59:t[t.length]=e.substr(a,r-a),a=r+1}if(t[t.length]=e.substr(a),!0===n)throw new Error("Format |"+e+"| unterminated string ");return t}(e),r=n.length,a=n[r-1].indexOf("@");if(r<4&&a>-1&&--r,n.length>4)throw new Error("cannot find right format for |"+n.join("|")+"|");if("number"!=typeof t)return[4,4===n.length||a>-1?n[n.length-1]:"@"];switch(n.length){case 1:n=a>-1?["General","General","General",n[0]]:[n[0],n[0],n[0],"@"];break;case 2:n=a>-1?[n[0],n[0],n[0],n[1]]:[n[0],n[1],n[0],"@"];break;case 3:n=a>-1?[n[0],n[1],n[0],n[2]]:[n[0],n[1],n[2],"@"]}var i=t>0?n[0]:t<0?n[1]:n[2];if(-1===n[0].indexOf("[")&&-1===n[1].indexOf("["))return[r,i];if(null!=n[0].match(/\[[=<>]/)||null!=n[1].match(/\[[=<>]/)){var o=n[0].match(bl),s=n[1].match(bl);return vl(t,o)?[r,n[0]]:vl(t,s)?[r,n[1]]:[r,n[null!=o&&null!=s?2:1]]}return[r,i]}function Sl(e,t,n){null==n&&(n={});var r="";switch(typeof e){case"string":r="m/d/yy"==e&&n.dateNF?n.dateNF:e;break;case"number":null==(r=14==e&&n.dateNF?n.dateNF:(null!=n.table?n.table:Js)[e])&&(r=n.table&&n.table[Gs[e]]||Js[Gs[e]]),null==r&&(r=$s[e]||"General")}if(Bs(r,0))return el(t,n);t instanceof Date&&(t=Qs(t,n.date1904));var a=wl(r,t);if(Bs(a[1]))return el(t,n);if(!0===t)t="TRUE";else if(!1===t)t="FALSE";else if(""===t||null==t)return"";return function(e,t,n,r){for(var a,i,o,s=[],l="",c=0,u="",d="t",p="H";c<e.length;)switch(u=e.charAt(c)){case"G":if(!Bs(e,c))throw new Error("unrecognized character "+u+" in "+e);s[s.length]={t:"G",v:"General"},c+=7;break;case'"':for(l="";34!==(o=e.charCodeAt(++c))&&c<e.length;)l+=String.fromCharCode(o);s[s.length]={t:"t",v:l},++c;break;case"\\":var h=e.charAt(++c),m="("===h||")"===h?h:"t";s[s.length]={t:m,v:h},++c;break;case"_":s[s.length]={t:"t",v:" "},c+=2;break;case"@":s[s.length]={t:"T",v:t},++c;break;case"B":case"b":if("1"===e.charAt(c+1)||"2"===e.charAt(c+1)){if(null==a&&null==(a=zs(t,n,"2"===e.charAt(c+1))))return"";s[s.length]={t:"X",v:e.substr(c,2)},d=u,c+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":u=u.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(t<0)return"";if(null==a&&null==(a=zs(t,n)))return"";for(l=u;++c<e.length&&e.charAt(c).toLowerCase()===u;)l+=u;"m"===u&&"h"===d.toLowerCase()&&(u="M"),"h"===u&&(u=p),s[s.length]={t:u,v:l},d=u;break;case"A":case"a":case"上":var f={t:u,v:u};if(null==a&&(a=zs(t,n)),"A/P"===e.substr(c,3).toUpperCase()?(null!=a&&(f.v=a.H>=12?"P":"A"),f.t="T",p="h",c+=3):"AM/PM"===e.substr(c,5).toUpperCase()?(null!=a&&(f.v=a.H>=12?"PM":"AM"),f.t="T",c+=5,p="h"):"上午/下午"===e.substr(c,5).toUpperCase()?(null!=a&&(f.v=a.H>=12?"下午":"上午"),f.t="T",c+=5,p="h"):(f.t="t",++c),null==a&&"T"===f.t)return"";s[s.length]=f,d=u;break;case"[":for(l=u;"]"!==e.charAt(c++)&&c<e.length;)l+=e.charAt(c);if("]"!==l.slice(-1))throw'unterminated "[" block: |'+l+"|";if(l.match(yl)){if(null==a&&null==(a=zs(t,n)))return"";s[s.length]={t:"Z",v:l.toLowerCase()},d=l.charAt(1)}else l.indexOf("$")>-1&&(l=(l.match(/\$([^-\[\]]*)/)||[])[1]||"$",gl(e)||(s[s.length]={t:"t",v:l}));break;case".":if(null!=a){for(l=u;++c<e.length&&"0"===(u=e.charAt(c));)l+=u;s[s.length]={t:"s",v:l};break}case"0":case"#":for(l=u;++c<e.length&&"0#?.,E+-%".indexOf(u=e.charAt(c))>-1;)l+=u;s[s.length]={t:"n",v:l};break;case"?":for(l=u;e.charAt(++c)===u;)l+=u;s[s.length]={t:u,v:l},d=u;break;case"*":++c," "!=e.charAt(c)&&"*"!=e.charAt(c)||++c;break;case"(":case")":s[s.length]={t:1===r?"t":u,v:u},++c;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(l=u;c<e.length&&"0123456789".indexOf(e.charAt(++c))>-1;)l+=e.charAt(c);s[s.length]={t:"D",v:l};break;case" ":s[s.length]={t:u,v:u},++c;break;case"$":s[s.length]={t:"t",v:"$"},++c;break;default:if(-1===",$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(u))throw new Error("unrecognized character "+u+" in "+e);s[s.length]={t:"t",v:u},++c}var y,g=0,b=0;for(c=s.length-1,d="t";c>=0;--c)switch(s[c].t){case"h":case"H":s[c].t=p,d="h",g<1&&(g=1);break;case"s":(y=s[c].v.match(/\.0+$/))&&(b=Math.max(b,y[0].length-1)),g<3&&(g=3);case"d":case"y":case"M":case"e":d=s[c].t;break;case"m":"s"===d&&(s[c].t="M",g<2&&(g=2));break;case"X":break;case"Z":g<1&&s[c].v.match(/[Hh]/)&&(g=1),g<2&&s[c].v.match(/[Mm]/)&&(g=2),g<3&&s[c].v.match(/[Ss]/)&&(g=3)}switch(g){case 0:break;case 1:a.u>=.5&&(a.u=0,++a.S),a.S>=60&&(a.S=0,++a.M),a.M>=60&&(a.M=0,++a.H);break;case 2:a.u>=.5&&(a.u=0,++a.S),a.S>=60&&(a.S=0,++a.M)}var v,w="";for(c=0;c<s.length;++c)switch(s[c].t){case"t":case"T":case" ":case"D":break;case"X":s[c].v="",s[c].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":s[c].v=tl(s[c].t.charCodeAt(0),s[c].v,a,b),s[c].t="t";break;case"n":case"?":for(v=c+1;null!=s[v]&&("?"===(u=s[v].t)||"D"===u||(" "===u||"t"===u)&&null!=s[v+1]&&("?"===s[v+1].t||"t"===s[v+1].t&&"/"===s[v+1].v)||"("===s[c].t&&(" "===u||"n"===u||")"===u)||"t"===u&&("/"===s[v].v||" "===s[v].v&&null!=s[v+1]&&"?"==s[v+1].t));)s[c].v+=s[v].v,s[v]={v:"",t:";"},++v;w+=s[c].v,c=v-1;break;case"G":s[c].t="t",s[c].v=el(t,n)}var S,E,x="";if(w.length>0){40==w.charCodeAt(0)?(S=t<0&&45===w.charCodeAt(0)?-t:t,E=fl("n",w,S)):(E=fl("n",w,S=t<0&&r>1?-t:t),S<0&&s[0]&&"t"==s[0].t&&(E=E.substr(1),s[0].v="-"+s[0].v)),v=E.length-1;var _=s.length;for(c=0;c<s.length;++c)if(null!=s[c]&&"t"!=s[c].t&&s[c].v.indexOf(".")>-1){_=c;break}var k=s.length;if(_===s.length&&-1===E.indexOf("E")){for(c=s.length-1;c>=0;--c)null!=s[c]&&-1!=="n?".indexOf(s[c].t)&&(v>=s[c].v.length-1?(v-=s[c].v.length,s[c].v=E.substr(v+1,s[c].v.length)):v<0?s[c].v="":(s[c].v=E.substr(0,v+1),v=-1),s[c].t="t",k=c);v>=0&&k<s.length&&(s[k].v=E.substr(0,v+1)+s[k].v)}else if(_!==s.length&&-1===E.indexOf("E")){for(v=E.indexOf(".")-1,c=_;c>=0;--c)if(null!=s[c]&&-1!=="n?".indexOf(s[c].t)){for(i=s[c].v.indexOf(".")>-1&&c===_?s[c].v.indexOf(".")-1:s[c].v.length-1,x=s[c].v.substr(i+1);i>=0;--i)v>=0&&("0"===s[c].v.charAt(i)||"#"===s[c].v.charAt(i))&&(x=E.charAt(v--)+x);s[c].v=x,s[c].t="t",k=c}for(v>=0&&k<s.length&&(s[k].v=E.substr(0,v+1)+s[k].v),v=E.indexOf(".")+1,c=_;c<s.length;++c)if(null!=s[c]&&(-1!=="n?(".indexOf(s[c].t)||c===_)){for(i=s[c].v.indexOf(".")>-1&&c===_?s[c].v.indexOf(".")+1:0,x=s[c].v.substr(0,i);i<s[c].v.length;++i)v<E.length&&(x+=E.charAt(v++));s[c].v=x,s[c].t="t",k=c}}}for(c=0;c<s.length;++c)null!=s[c]&&"n?".indexOf(s[c].t)>-1&&(S=r>1&&t<0&&c>0&&"-"===s[c-1].v?-t:t,s[c].v=fl(s[c].t,s[c].v,S),s[c].t="t");var I="";for(c=0;c!==s.length;++c)null!=s[c]&&(I+=s[c].v);return I}(a[1],t,n,a[0])}function El(e,t){if("number"!=typeof t){t=+t||-1;for(var n=0;n<392;++n)if(null!=Js[n]){if(Js[n]==e){t=n;break}}else t<0&&(t=n);t<0&&(t=391)}return Js[t]=e,t}function xl(e){for(var t=0;392!=t;++t)void 0!==e[t]&&El(e[t],t)}function _l(){Js=function(e){return e||(e={}),e[0]="General",e[1]="0",e[2]="0.00",e[3]="#,##0",e[4]="#,##0.00",e[9]="0%",e[10]="0.00%",e[11]="0.00E+00",e[12]="# ?/?",e[13]="# ??/??",e[14]="m/d/yy",e[15]="d-mmm-yy",e[16]="d-mmm",e[17]="mmm-yy",e[18]="h:mm AM/PM",e[19]="h:mm:ss AM/PM",e[20]="h:mm",e[21]="h:mm:ss",e[22]="m/d/yy h:mm",e[37]="#,##0 ;(#,##0)",e[38]="#,##0 ;[Red](#,##0)",e[39]="#,##0.00;(#,##0.00)",e[40]="#,##0.00;[Red](#,##0.00)",e[45]="mm:ss",e[46]="[h]:mm:ss",e[47]="mmss.0",e[48]="##0.0E+0",e[49]="@",e[56]='"上午/下午 "hh"時"mm"分"ss"秒 "',e}()}var kl=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;var Il=function(){var e={};e.version="1.2.0";var t=function(){for(var e=0,t=new Array(256),n=0;256!=n;++n)e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=1&(e=n)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1)?-306674912^e>>>1:e>>>1,t[n]=e;return"undefined"!=typeof Int32Array?new Int32Array(t):t}();var n=function(e){var t=0,n=0,r=0,a="undefined"!=typeof Int32Array?new Int32Array(4096):new Array(4096);for(r=0;256!=r;++r)a[r]=e[r];for(r=0;256!=r;++r)for(n=e[r],t=256+r;t<4096;t+=256)n=a[t]=n>>>8^e[255&n];var i=[];for(r=1;16!=r;++r)i[r-1]="undefined"!=typeof Int32Array?a.subarray(256*r,256*r+256):a.slice(256*r,256*r+256);return i}(t),r=n[0],a=n[1],i=n[2],o=n[3],s=n[4],l=n[5],c=n[6],u=n[7],d=n[8],p=n[9],h=n[10],m=n[11],f=n[12],y=n[13],g=n[14];return e.table=t,e.bstr=function(e,n){for(var r=-1^n,a=0,i=e.length;a<i;)r=r>>>8^t[255&(r^e.charCodeAt(a++))];return~r},e.buf=function(e,n){for(var b=-1^n,v=e.length-15,w=0;w<v;)b=g[e[w++]^255&b]^y[e[w++]^b>>8&255]^f[e[w++]^b>>16&255]^m[e[w++]^b>>>24]^h[e[w++]]^p[e[w++]]^d[e[w++]]^u[e[w++]]^c[e[w++]]^l[e[w++]]^s[e[w++]]^o[e[w++]]^i[e[w++]]^a[e[w++]]^r[e[w++]]^t[e[w++]];for(v+=15;w<v;)b=b>>>8^t[255&(b^e[w++])];return~b},e.str=function(e,n){for(var r=-1^n,a=0,i=e.length,o=0,s=0;a<i;)(o=e.charCodeAt(a++))<128?r=r>>>8^t[255&(r^o)]:o<2048?r=(r=r>>>8^t[255&(r^(192|o>>6&31))])>>>8^t[255&(r^(128|63&o))]:o>=55296&&o<57344?(o=64+(1023&o),s=1023&e.charCodeAt(a++),r=(r=(r=(r=r>>>8^t[255&(r^(240|o>>8&7))])>>>8^t[255&(r^(128|o>>2&63))])>>>8^t[255&(r^(128|s>>6&15|(3&o)<<4))])>>>8^t[255&(r^(128|63&s))]):r=(r=(r=r>>>8^t[255&(r^(224|o>>12&15))])>>>8^t[255&(r^(128|o>>6&63))])>>>8^t[255&(r^(128|63&o))];return~r},e}(),Tl=function(){var e,t={};function n(e){if("/"==e.charAt(e.length-1))return-1===e.slice(0,-1).indexOf("/")?e:n(e.slice(0,-1));var t=e.lastIndexOf("/");return-1===t?e:e.slice(0,t+1)}function r(e){if("/"==e.charAt(e.length-1))return r(e.slice(0,-1));var t=e.lastIndexOf("/");return-1===t?e:e.slice(t+1)}function a(e,t){"string"==typeof t&&(t=new Date(t));var n=t.getHours();n=(n=n<<6|t.getMinutes())<<5|t.getSeconds()>>>1,e.write_shift(2,n);var r=t.getFullYear()-1980;r=(r=r<<4|t.getMonth()+1)<<5|t.getDate(),e.write_shift(2,r)}function i(e){fu(e,0);for(var t={},n=0;e.l<=e.length-4;){var r=e.read_shift(2),a=e.read_shift(2),i=e.l+a,o={};if(21589===r)1&(n=e.read_shift(1))&&(o.mtime=e.read_shift(4)),a>5&&(2&n&&(o.atime=e.read_shift(4)),4&n&&(o.ctime=e.read_shift(4))),o.mtime&&(o.mt=new Date(1e3*o.mtime));e.l=i,t[r]=o}return t}function o(){return e||(e={})}function s(e,t){if(80==e[0]&&75==e[1])return re(e,t);if(109==(32|e[0])&&105==(32|e[1]))return function(e,t){if("mime-version:"!=E(e.slice(0,13)).toLowerCase())throw new Error("Unsupported MAD header");var n=t&&t.root||"",r=(_s&&Buffer.isBuffer(e)?e.toString("binary"):E(e)).split("\r\n"),a=0,i="";for(a=0;a<r.length;++a)if(i=r[a],/^Content-Location:/i.test(i)&&(i=i.slice(i.indexOf("file")),n||(n=i.slice(0,i.lastIndexOf("/")+1)),i.slice(0,n.length)!=n))for(;n.length>0&&(n=(n=n.slice(0,n.length-1)).slice(0,n.lastIndexOf("/")+1),i.slice(0,n.length)!=n););var o=(r[1]||"").match(/boundary="(.*?)"/);if(!o)throw new Error("MAD cannot find boundary");var s="--"+(o[1]||""),l={FileIndex:[],FullPaths:[]};p(l);var c,u=0;for(a=0;a<r.length;++a){var d=r[a];d!==s&&d!==s+"--"||(u++&&ce(l,r.slice(c,a),n),c=a)}return l}(e,t);if(e.length<512)throw new Error("CFB file size "+e.length+" < 512");var n,r,a,i,o,s,h=512,m=[],f=e.slice(0,512);fu(f,0);var y=function(e){if(80==e[e.l]&&75==e[e.l+1])return[0,0];e.chk(b,"Header Signature: "),e.l+=16;var t=e.read_shift(2,"u");return[e.read_shift(2,"u"),t]}(f);switch(n=y[0]){case 3:h=512;break;case 4:h=4096;break;case 0:if(0==y[1])return re(e,t);default:throw new Error("Major Version: Expected 3 or 4 saw "+n)}512!==h&&fu(f=e.slice(0,h),28);var v=e.slice(0,h);!function(e,t){var n=9;switch(e.l+=2,n=e.read_shift(2)){case 9:if(3!=t)throw new Error("Sector Shift: Expected 9 saw "+n);break;case 12:if(4!=t)throw new Error("Sector Shift: Expected 12 saw "+n);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+n)}e.chk("0600","Mini Sector Shift: "),e.chk("000000000000","Reserved: ")}(f,n);var w=f.read_shift(4,"i");if(3===n&&0!==w)throw new Error("# Directory Sectors: Expected 0 saw "+w);f.l+=4,i=f.read_shift(4,"i"),f.l+=4,f.chk("00100000","Mini Stream Cutoff Size: "),o=f.read_shift(4,"i"),r=f.read_shift(4,"i"),s=f.read_shift(4,"i"),a=f.read_shift(4,"i");for(var S=-1,x=0;x<109&&!((S=f.read_shift(4,"i"))<0);++x)m[x]=S;var _=function(e,t){for(var n=Math.ceil(e.length/t)-1,r=[],a=1;a<n;++a)r[a-1]=e.slice(a*t,(a+1)*t);return r[n-1]=e.slice(n*t),r}(e,h);c(s,a,_,h,m);var k=function(e,t,n,r){var a=e.length,i=[],o=[],s=[],l=[],c=r-1,u=0,d=0,p=0,h=0;for(u=0;u<a;++u)if(s=[],(p=u+t)>=a&&(p-=a),!o[p]){l=[];var m=[];for(d=p;d>=0;){m[d]=!0,o[d]=!0,s[s.length]=d,l.push(e[d]);var f=n[Math.floor(4*d/r)];if(r<4+(h=4*d&c))throw new Error("FAT boundary crossed: "+d+" 4 "+r);if(!e[f])break;if(m[d=cu(e[f],h)])break}i[p]={nodes:s,data:Fc([l])}}return i}(_,i,m,h);k[i].name="!Directory",r>0&&o!==g&&(k[o].name="!MiniFAT"),k[m[0]].name="!FAT",k.fat_addrs=m,k.ssz=h;var I=[],T=[],A=[];!function(e,t,n,r,a,i,o,s){for(var c,p=0,h=r.length?2:0,m=t[e].data,f=0,y=0;f<m.length;f+=128){var b=m.slice(f,f+128);fu(b,64),y=b.read_shift(2),c=Vc(b,0,y-h),r.push(c);var v={name:c,type:b.read_shift(1),color:b.read_shift(1),L:b.read_shift(4,"i"),R:b.read_shift(4,"i"),C:b.read_shift(4,"i"),clsid:b.read_shift(16),state:b.read_shift(4,"i"),start:0,size:0};0!==b.read_shift(2)+b.read_shift(2)+b.read_shift(2)+b.read_shift(2)&&(v.ct=d(b,b.l-8)),0!==b.read_shift(2)+b.read_shift(2)+b.read_shift(2)+b.read_shift(2)&&(v.mt=d(b,b.l-8)),v.start=b.read_shift(4,"i"),v.size=b.read_shift(4,"i"),v.size<0&&v.start<0&&(v.size=v.type=0,v.start=g,v.name=""),5===v.type?(p=v.start,a>0&&p!==g&&(t[p].name="!StreamData")):v.size>=4096?(v.storage="fat",void 0===t[v.start]&&(t[v.start]=u(n,v.start,t.fat_addrs,t.ssz)),t[v.start].name=v.name,v.content=t[v.start].data.slice(0,v.size)):(v.storage="minifat",v.size<0?v.size=0:p!==g&&v.start!==g&&t[p]&&(v.content=l(v,t[p].data,(t[s]||{}).data))),v.content&&fu(v.content,0),i[c]=v,o.push(v)}}(i,k,_,I,r,{},T,o),function(e,t,n){for(var r=0,a=0,i=0,o=0,s=0,l=n.length,c=[],u=[];r<l;++r)c[r]=u[r]=r,t[r]=n[r];for(;s<u.length;++s)a=e[r=u[s]].L,i=e[r].R,o=e[r].C,c[r]===r&&(-1!==a&&c[a]!==a&&(c[r]=c[a]),-1!==i&&c[i]!==i&&(c[r]=c[i])),-1!==o&&(c[o]=r),-1!==a&&r!=c[r]&&(c[a]=c[r],u.lastIndexOf(a)<s&&u.push(a)),-1!==i&&r!=c[r]&&(c[i]=c[r],u.lastIndexOf(i)<s&&u.push(i));for(r=1;r<l;++r)c[r]===r&&(-1!==i&&c[i]!==i?c[r]=c[i]:-1!==a&&c[a]!==a&&(c[r]=c[a]));for(r=1;r<l;++r)if(0!==e[r].type){if((s=r)!=c[s])do{s=c[s],t[r]=t[s]+"/"+t[r]}while(0!==s&&-1!==c[s]&&s!=c[s]);c[r]=-1}for(t[0]+="/",r=1;r<l;++r)2!==e[r].type&&(t[r]+="/")}(T,A,I),I.shift();var O={FileIndex:T,FullPaths:A};return t&&t.raw&&(O.raw={header:v,sectors:_}),O}function l(e,t,n){for(var r=e.start,a=e.size,i=[],o=r;n&&a>0&&o>=0;)i.push(t.slice(o*y,o*y+y)),a-=y,o=cu(n,4*o);return 0===i.length?gu(0):Cs(i).slice(0,e.size)}function c(e,t,n,r,a){var i=g;if(e===g){if(0!==t)throw new Error("DIFAT chain shorter than expected")}else if(-1!==e){var o=n[e],s=(r>>>2)-1;if(!o)return;for(var l=0;l<s&&(i=cu(o,4*l))!==g;++l)a.push(i);c(cu(o,r-4),t-1,n,r,a)}}function u(e,t,n,r,a){var i=[],o=[];a||(a=[]);var s=r-1,l=0,c=0;for(l=t;l>=0;){a[l]=!0,i[i.length]=l,o.push(e[l]);var u=n[Math.floor(4*l/r)];if(r<4+(c=4*l&s))throw new Error("FAT boundary crossed: "+l+" 4 "+r);if(!e[u])break;l=cu(e[u],c)}return{nodes:i,data:Fc([o])}}function d(e,t){return new Date(1e3*(lu(e,t+4)/1e7*Math.pow(2,32)+lu(e,t)/1e7-11644473600))}function p(e,t){var n=t||{},r=n.root||"Root Entry";if(e.FullPaths||(e.FullPaths=[]),e.FileIndex||(e.FileIndex=[]),e.FullPaths.length!==e.FileIndex.length)throw new Error("inconsistent CFB structure");0===e.FullPaths.length&&(e.FullPaths[0]=r+"/",e.FileIndex[0]={name:r,type:5}),n.CLSID&&(e.FileIndex[0].clsid=n.CLSID),function(e){var t="Sh33tJ5";if(Tl.find(e,"/"+t))return;var n=gu(4);n[0]=55,n[1]=n[3]=50,n[2]=54,e.FileIndex.push({name:t,type:2,content:n,size:4,L:69,R:69,C:69}),e.FullPaths.push(e.FullPaths[0]+t),h(e)}(e)}function h(e,t){p(e);for(var a=!1,i=!1,o=e.FullPaths.length-1;o>=0;--o){var s=e.FileIndex[o];switch(s.type){case 0:i?a=!0:(e.FileIndex.pop(),e.FullPaths.pop());break;case 1:case 2:case 5:i=!0,isNaN(s.R*s.L*s.C)&&(a=!0),s.R>-1&&s.L>-1&&s.R==s.L&&(a=!0);break;default:a=!0}}if(a||t){var l=new Date(1987,1,19),c=0,u=Object.create?Object.create(null):{},d=[];for(o=0;o<e.FullPaths.length;++o)u[e.FullPaths[o]]=!0,0!==e.FileIndex[o].type&&d.push([e.FullPaths[o],e.FileIndex[o]]);for(o=0;o<d.length;++o){var h=n(d[o][0]);(i=u[h])||(d.push([h,{name:r(h).replace("/",""),type:1,clsid:w,ct:l,mt:l,content:null}]),u[h]=!0)}for(d.sort((function(e,t){return function(e,t){for(var n=e.split("/"),r=t.split("/"),a=0,i=0,o=Math.min(n.length,r.length);a<o;++a){if(i=n[a].length-r[a].length)return i;if(n[a]!=r[a])return n[a]<r[a]?-1:1}return n.length-r.length}(e[0],t[0])})),e.FullPaths=[],e.FileIndex=[],o=0;o<d.length;++o)e.FullPaths[o]=d[o][0],e.FileIndex[o]=d[o][1];for(o=0;o<d.length;++o){var m=e.FileIndex[o],f=e.FullPaths[o];if(m.name=r(f).replace("/",""),m.L=m.R=m.C=-(m.color=1),m.size=m.content?m.content.length:0,m.start=0,m.clsid=m.clsid||w,0===o)m.C=d.length>1?1:-1,m.size=0,m.type=5;else if("/"==f.slice(-1)){for(c=o+1;c<d.length&&n(e.FullPaths[c])!=f;++c);for(m.C=c>=d.length?-1:c,c=o+1;c<d.length&&n(e.FullPaths[c])!=n(f);++c);m.R=c>=d.length?-1:c,m.type=1}else n(e.FullPaths[o+1]||"")==n(f)&&(m.R=o+1),m.type=2}}}function m(e,t){var n=t||{};if("mad"==n.fileType)return function(e,t){for(var n=t||{},r=n.boundary||"SheetJS",a=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+(r="------="+r).slice(2)+'"',"","",""],i=e.FullPaths[0],o=i,s=e.FileIndex[0],l=1;l<e.FullPaths.length;++l)if(o=e.FullPaths[l].slice(i.length),(s=e.FileIndex[l]).size&&s.content&&"Sh33tJ5"!=o){o=o.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,(function(e){return"_x"+e.charCodeAt(0).toString(16)+"_"})).replace(/[\u0080-\uFFFF]/g,(function(e){return"_u"+e.charCodeAt(0).toString(16)+"_"}));for(var c=s.content,u=_s&&Buffer.isBuffer(c)?c.toString("binary"):E(c),d=0,p=Math.min(1024,u.length),h=0,m=0;m<=p;++m)(h=u.charCodeAt(m))>=32&&h<128&&++d;var f=d>=4*p/5;a.push(r),a.push("Content-Location: "+(n.root||"file:///C:/SheetJS/")+o),a.push("Content-Transfer-Encoding: "+(f?"quoted-printable":"base64")),a.push("Content-Type: "+oe(s,o)),a.push(""),a.push(f?le(u):se(u))}return a.push(r+"--\r\n"),a.join("\r\n")}(e,n);if(h(e),"zip"===n.fileType)return function(e,t){var n=t||{},r=[],i=[],o=gu(1),s=n.compression?8:0,l=0,c=0,u=0,d=0,p=0,h=e.FullPaths[0],m=h,f=e.FileIndex[0],y=[],g=0;for(c=1;c<e.FullPaths.length;++c)if(m=e.FullPaths[c].slice(h.length),(f=e.FileIndex[c]).size&&f.content&&"Sh33tJ5"!=m){var b=d,v=gu(m.length);for(u=0;u<m.length;++u)v.write_shift(1,127&m.charCodeAt(u));v=v.slice(0,v.l),y[p]=Il.buf(f.content,0);var w=f.content;8==s&&(w=x(w)),(o=gu(30)).write_shift(4,67324752),o.write_shift(2,20),o.write_shift(2,l),o.write_shift(2,s),f.mt?a(o,f.mt):o.write_shift(4,0),o.write_shift(-4,y[p]),o.write_shift(4,w.length),o.write_shift(4,f.content.length),o.write_shift(2,v.length),o.write_shift(2,0),d+=o.length,r.push(o),d+=v.length,r.push(v),d+=w.length,r.push(w),(o=gu(46)).write_shift(4,33639248),o.write_shift(2,0),o.write_shift(2,20),o.write_shift(2,l),o.write_shift(2,s),o.write_shift(4,0),o.write_shift(-4,y[p]),o.write_shift(4,w.length),o.write_shift(4,f.content.length),o.write_shift(2,v.length),o.write_shift(2,0),o.write_shift(2,0),o.write_shift(2,0),o.write_shift(2,0),o.write_shift(4,0),o.write_shift(4,b),g+=o.l,i.push(o),g+=v.length,i.push(v),++p}return(o=gu(22)).write_shift(4,101010256),o.write_shift(2,0),o.write_shift(2,0),o.write_shift(2,p),o.write_shift(2,p),o.write_shift(4,g),o.write_shift(4,d),o.write_shift(2,0),Cs([Cs(r),Cs(i),o])}(e,n);var r=function(e){for(var t=0,n=0,r=0;r<e.FileIndex.length;++r){var a=e.FileIndex[r];if(a.content){var i=a.content.length;i>0&&(i<4096?t+=i+63>>6:n+=i+511>>9)}}for(var o=e.FullPaths.length+3>>2,s=t+127>>7,l=(t+7>>3)+n+o+s,c=l+127>>7,u=c<=109?0:Math.ceil((c-109)/127);l+c+u+127>>7>c;)u=++c<=109?0:Math.ceil((c-109)/127);var d=[1,u,c,s,o,n,t,0];return e.FileIndex[0].size=t<<6,d[7]=(e.FileIndex[0].start=d[0]+d[1]+d[2]+d[3]+d[4]+d[5])+(d[6]+7>>3),d}(e),i=gu(r[7]<<9),o=0,s=0;for(o=0;o<8;++o)i.write_shift(1,v[o]);for(o=0;o<8;++o)i.write_shift(2,0);for(i.write_shift(2,62),i.write_shift(2,3),i.write_shift(2,65534),i.write_shift(2,9),i.write_shift(2,6),o=0;o<3;++o)i.write_shift(2,0);for(i.write_shift(4,0),i.write_shift(4,r[2]),i.write_shift(4,r[0]+r[1]+r[2]+r[3]-1),i.write_shift(4,0),i.write_shift(4,4096),i.write_shift(4,r[3]?r[0]+r[1]+r[2]-1:g),i.write_shift(4,r[3]),i.write_shift(-4,r[1]?r[0]-1:g),i.write_shift(4,r[1]),o=0;o<109;++o)i.write_shift(-4,o<r[2]?r[1]+o:-1);if(r[1])for(s=0;s<r[1];++s){for(;o<236+127*s;++o)i.write_shift(-4,o<r[2]?r[1]+o:-1);i.write_shift(-4,s===r[1]-1?g:s+1)}var l=function(e){for(s+=e;o<s-1;++o)i.write_shift(-4,o+1);e&&(++o,i.write_shift(-4,g))};for(s=o=0,s+=r[1];o<s;++o)i.write_shift(-4,S.DIFSECT);for(s+=r[2];o<s;++o)i.write_shift(-4,S.FATSECT);l(r[3]),l(r[4]);for(var c=0,u=0,d=e.FileIndex[0];c<e.FileIndex.length;++c)(d=e.FileIndex[c]).content&&((u=d.content.length)<4096||(d.start=s,l(u+511>>9)));for(l(r[6]+7>>3);511&i.l;)i.write_shift(-4,S.ENDOFCHAIN);for(s=o=0,c=0;c<e.FileIndex.length;++c)(d=e.FileIndex[c]).content&&(!(u=d.content.length)||u>=4096||(d.start=s,l(u+63>>6)));for(;511&i.l;)i.write_shift(-4,S.ENDOFCHAIN);for(o=0;o<r[4]<<2;++o){var p=e.FullPaths[o];if(p&&0!==p.length){d=e.FileIndex[o],0===o&&(d.start=d.size?d.start-1:g);var m=0===o&&n.root||d.name;if(u=2*(m.length+1),i.write_shift(64,m,"utf16le"),i.write_shift(2,u),i.write_shift(1,d.type),i.write_shift(1,d.color),i.write_shift(-4,d.L),i.write_shift(-4,d.R),i.write_shift(-4,d.C),d.clsid)i.write_shift(16,d.clsid,"hex");else for(c=0;c<4;++c)i.write_shift(4,0);i.write_shift(4,d.state||0),i.write_shift(4,0),i.write_shift(4,0),i.write_shift(4,0),i.write_shift(4,0),i.write_shift(4,d.start),i.write_shift(4,d.size),i.write_shift(4,0)}else{for(c=0;c<17;++c)i.write_shift(4,0);for(c=0;c<3;++c)i.write_shift(4,-1);for(c=0;c<12;++c)i.write_shift(4,0)}}for(o=1;o<e.FileIndex.length;++o)if((d=e.FileIndex[o]).size>=4096)if(i.l=d.start+1<<9,_s&&Buffer.isBuffer(d.content))d.content.copy(i,i.l,0,d.size),i.l+=d.size+511&-512;else{for(c=0;c<d.size;++c)i.write_shift(1,d.content[c]);for(;511&c;++c)i.write_shift(1,0)}for(o=1;o<e.FileIndex.length;++o)if((d=e.FileIndex[o]).size>0&&d.size<4096)if(_s&&Buffer.isBuffer(d.content))d.content.copy(i,i.l,0,d.size),i.l+=d.size+63&-64;else{for(c=0;c<d.size;++c)i.write_shift(1,d.content[c]);for(;63&c;++c)i.write_shift(1,0)}if(_s)i.l=i.length;else for(;i.l<i.length;)i.write_shift(1,0);return i}t.version="1.2.1";var f,y=64,g=-2,b="d0cf11e0a1b11ae1",v=[208,207,17,224,161,177,26,225],w="00000000000000000000000000000000",S={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:g,FREESECT:-1,HEADER_SIGNATURE:b,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:w,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function E(e){for(var t=new Array(e.length),n=0;n<e.length;++n)t[n]=String.fromCharCode(e[n]);return t.join("")}function x(e){return f?f.deflateRawSync(e):W(e)}var _=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],I=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function T(e){var t=139536&(e<<1|e<<11)|558144&(e<<5|e<<15);return 255&(t>>16|t>>8|t)}for(var A="undefined"!=typeof Uint8Array,O=A?new Uint8Array(256):[],K=0;K<256;++K)O[K]=T(K);function C(e,t){var n=O[255&e];return t<=8?n>>>8-t:(n=n<<8|O[e>>8&255],t<=16?n>>>16-t:(n=n<<8|O[e>>16&255])>>>24-t)}function R(e,t){var n=7&t,r=t>>>3;return(e[r]|(n<=6?0:e[r+1]<<8))>>>n&3}function j(e,t){var n=7&t,r=t>>>3;return(e[r]|(n<=5?0:e[r+1]<<8))>>>n&7}function P(e,t){var n=7&t,r=t>>>3;return(e[r]|(n<=3?0:e[r+1]<<8))>>>n&31}function D(e,t){var n=7&t,r=t>>>3;return(e[r]|(n<=1?0:e[r+1]<<8))>>>n&127}function N(e,t,n){var r=7&t,a=t>>>3,i=(1<<n)-1,o=e[a]>>>r;return n<8-r?o&i:(o|=e[a+1]<<8-r,n<16-r?o&i:(o|=e[a+2]<<16-r,n<24-r?o&i:(o|=e[a+3]<<24-r)&i))}function L(e,t,n){var r=7&t,a=t>>>3;return r<=5?e[a]|=(7&n)<<r:(e[a]|=n<<r&255,e[a+1]=(7&n)>>8-r),t+3}function M(e,t,n){return n=(1&n)<<(7&t),e[t>>>3]|=n,t+1}function F(e,t,n){var r=t>>>3;return n<<=7&t,e[r]|=255&n,n>>>=8,e[r+1]=n,t+8}function B(e,t,n){var r=t>>>3;return n<<=7&t,e[r]|=255&n,n>>>=8,e[r+1]=255&n,e[r+2]=n>>>8,t+16}function V(e,t){var n=e.length,r=2*n>t?2*n:t+5,a=0;if(n>=t)return e;if(_s){var i=Ts(r);if(e.copy)e.copy(i);else for(;a<e.length;++a)i[a]=e[a];return i}if(A){var o=new Uint8Array(r);if(o.set)o.set(e);else for(;a<n;++a)o[a]=e[a];return o}return e.length=r,e}function U(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=0;return t}function J(e,t,n){var r=1,a=0,i=0,o=0,s=0,l=e.length,c=A?new Uint16Array(32):U(32);for(i=0;i<32;++i)c[i]=0;for(i=l;i<n;++i)e[i]=0;l=e.length;var u=A?new Uint16Array(l):U(l);for(i=0;i<l;++i)c[a=e[i]]++,r<a&&(r=a),u[i]=0;for(c[0]=0,i=1;i<=r;++i)c[i+16]=s=s+c[i-1]<<1;for(i=0;i<l;++i)0!=(s=e[i])&&(u[i]=c[s+16]++);var d=0;for(i=0;i<l;++i)if(0!=(d=e[i]))for(s=C(u[i],r)>>r-d,o=(1<<r+4-d)-1;o>=0;--o)t[s|o<<d]=15&d|i<<4;return r}var G=A?new Uint16Array(512):U(512),$=A?new Uint16Array(32):U(32);if(!A){for(var q=0;q<512;++q)G[q]=0;for(q=0;q<32;++q)$[q]=0}!function(){for(var e=[],t=0;t<32;t++)e.push(5);J(e,$,32);var n=[];for(t=0;t<=143;t++)n.push(8);for(;t<=255;t++)n.push(9);for(;t<=279;t++)n.push(7);for(;t<=287;t++)n.push(8);J(n,G,288)}();var z=function(){for(var e=A?new Uint8Array(32768):[],t=0,n=0;t<I.length-1;++t)for(;n<I[t+1];++n)e[n]=t;for(;n<32768;++n)e[n]=29;var r=A?new Uint8Array(259):[];for(t=0,n=0;t<k.length-1;++t)for(;n<k[t+1];++n)r[n]=t;return function(t,n){return t.length<8?function(e,t){for(var n=0;n<e.length;){var r=Math.min(65535,e.length-n),a=n+r==e.length;for(t.write_shift(1,+a),t.write_shift(2,r),t.write_shift(2,65535&~r);r-- >0;)t[t.l++]=e[n++]}return t.l}(t,n):function(t,n){for(var a=0,i=0,o=A?new Uint16Array(32768):[];i<t.length;){var s=Math.min(65535,t.length-i);if(s<10){for(7&(a=L(n,a,+!(i+s!=t.length)))&&(a+=8-(7&a)),n.l=a/8|0,n.write_shift(2,s),n.write_shift(2,65535&~s);s-- >0;)n[n.l++]=t[i++];a=8*n.l}else{a=L(n,a,+!(i+s!=t.length)+2);for(var l=0;s-- >0;){var c=t[i],u=-1,d=0;if((u=o[l=32767&(l<<5^c)])&&((u|=-32768&i)>i&&(u-=32768),u<i))for(;t[u+d]==t[i+d]&&d<250;)++d;if(d>2){(c=r[d])<=22?a=F(n,a,O[c+1]>>1)-1:(F(n,a,3),F(n,a+=5,O[c-23]>>5),a+=3);var p=c<8?0:c-4>>2;p>0&&(B(n,a,d-k[c]),a+=p),c=e[i-u],a=F(n,a,O[c]>>3),a-=3;var h=c<4?0:c-2>>1;h>0&&(B(n,a,i-u-I[c]),a+=h);for(var m=0;m<d;++m)o[l]=32767&i,l=32767&(l<<5^t[i]),++i;s-=d-1}else c<=143?c+=48:a=M(n,a,1),a=F(n,a,O[c]),o[l]=32767&i,++i}a=F(n,a,0)-1}}return n.l=(a+7)/8|0,n.l}(t,n)}}();function W(e){var t=gu(50+Math.floor(1.1*e.length)),n=z(e,t);return t.slice(0,n)}var Y=A?new Uint16Array(32768):U(32768),H=A?new Uint16Array(32768):U(32768),Q=A?new Uint16Array(128):U(128),Z=1,X=1;function ee(e,t){var n=P(e,t)+257,r=P(e,t+=5)+1,a=function(e,t){var n=7&t,r=t>>>3;return(e[r]|(n<=4?0:e[r+1]<<8))>>>n&15}(e,t+=5)+4;t+=4;for(var i=0,o=A?new Uint8Array(19):U(19),s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l=1,c=A?new Uint8Array(8):U(8),u=A?new Uint8Array(8):U(8),d=o.length,p=0;p<a;++p)o[_[p]]=i=j(e,t),l<i&&(l=i),c[i]++,t+=3;var h=0;for(c[0]=0,p=1;p<=l;++p)u[p]=h=h+c[p-1]<<1;for(p=0;p<d;++p)0!=(h=o[p])&&(s[p]=u[h]++);var m=0;for(p=0;p<d;++p)if(0!=(m=o[p])){h=O[s[p]]>>8-m;for(var f=(1<<7-m)-1;f>=0;--f)Q[h|f<<m]=7&m|p<<3}var y=[];for(l=1;y.length<n+r;)switch(t+=7&(h=Q[D(e,t)]),h>>>=3){case 16:for(i=3+R(e,t),t+=2,h=y[y.length-1];i-- >0;)y.push(h);break;case 17:for(i=3+j(e,t),t+=3;i-- >0;)y.push(0);break;case 18:for(i=11+D(e,t),t+=7;i-- >0;)y.push(0);break;default:y.push(h),l<h&&(l=h)}var g=y.slice(0,n),b=y.slice(n);for(p=n;p<286;++p)g[p]=0;for(p=r;p<30;++p)b[p]=0;return Z=J(g,Y,286),X=J(b,H,30),t}function te(e,t){var n=function(e,t){if(3==e[0]&&!(3&e[1]))return[Is(t),2];for(var n=0,r=0,a=Ts(t||1<<18),i=0,o=a.length>>>0,s=0,l=0;0==(1&r);)if(r=j(e,n),n+=3,r>>>1!=0)for(r>>1==1?(s=9,l=5):(n=ee(e,n),s=Z,l=X);;){!t&&o<i+32767&&(o=(a=V(a,i+32767)).length);var c=N(e,n,s),u=r>>>1==1?G[c]:Y[c];if(n+=15&u,0==((u>>>=4)>>>8&255))a[i++]=u;else{if(256==u)break;var d=(u-=257)<8?0:u-4>>2;d>5&&(d=0);var p=i+k[u];d>0&&(p+=N(e,n,d),n+=d),c=N(e,n,l),n+=15&(u=r>>>1==1?$[c]:H[c]);var h=(u>>>=4)<4?0:u-2>>1,m=I[u];for(h>0&&(m+=N(e,n,h),n+=h),!t&&o<p&&(o=(a=V(a,p+100)).length);i<p;)a[i]=a[i-m],++i}}else{7&n&&(n+=8-(7&n));var f=e[n>>>3]|e[1+(n>>>3)]<<8;if(n+=32,f>0)for(!t&&o<i+f&&(o=(a=V(a,i+f)).length);f-- >0;)a[i++]=e[n>>>3],n+=8}return t?[a,n+7>>>3]:[a.slice(0,i),n+7>>>3]}(e.slice(e.l||0),t);return e.l+=n[1],n[0]}function ne(e,t){if(!e)throw new Error(t);"undefined"!=typeof console&&console.error(t)}function re(e,t){var n=e;fu(n,0);var r={FileIndex:[],FullPaths:[]};p(r,{root:t.root});for(var a=n.length-4;(80!=n[a]||75!=n[a+1]||5!=n[a+2]||6!=n[a+3])&&a>=0;)--a;n.l=a+4,n.l+=4;var o=n.read_shift(2);n.l+=6;var s=n.read_shift(4);for(n.l=s,a=0;a<o;++a){n.l+=20;var l=n.read_shift(4),c=n.read_shift(4),u=n.read_shift(2),d=n.read_shift(2),h=n.read_shift(2);n.l+=8;var m=n.read_shift(4),f=i(n.slice(n.l+u,n.l+u+d));n.l+=u+d+h;var y=n.l;n.l=m+4,ae(n,l,c,r,f),n.l=y}return r}function ae(e,t,n,r,a){e.l+=2;var o=e.read_shift(2),s=e.read_shift(2),l=function(e){var t=65535&e.read_shift(2),n=65535&e.read_shift(2),r=new Date,a=31&n,i=15&(n>>>=5);n>>>=4,r.setMilliseconds(0),r.setFullYear(n+1980),r.setMonth(i-1),r.setDate(a);var o=31&t,s=63&(t>>>=5);return t>>>=6,r.setHours(t),r.setMinutes(s),r.setSeconds(o<<1),r}(e);if(8257&o)throw new Error("Unsupported ZIP encryption");e.read_shift(4);for(var c=e.read_shift(4),u=e.read_shift(4),d=e.read_shift(2),p=e.read_shift(2),h="",m=0;m<d;++m)h+=String.fromCharCode(e[e.l++]);if(p){var y=i(e.slice(e.l,e.l+p));(y[21589]||{}).mt&&(l=y[21589].mt),((a||{})[21589]||{}).mt&&(l=a[21589].mt)}e.l+=p;var g=e.slice(e.l,e.l+c);switch(s){case 8:g=function(e,t){if(!f)return te(e,t);var n=new(0,f.InflateRaw),r=n._processChunk(e.slice(e.l),n._finishFlushFlag);return e.l+=n.bytesRead,r}(e,u);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+s)}var b=!1;8&o&&(134695760==e.read_shift(4)&&(e.read_shift(4),b=!0),c=e.read_shift(4),u=e.read_shift(4)),c!=t&&ne(b,"Bad compressed size: "+t+" != "+c),u!=n&&ne(b,"Bad uncompressed size: "+n+" != "+u),ue(r,h,g,{unsafe:!0,mt:l})}var ie={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function oe(e,t){if(e.ctype)return e.ctype;var n=e.name||"",r=n.match(/\.([^\.]+)$/);return r&&ie[r[1]]||t&&(r=(n=t).match(/[\.\\]([^\.\\])+$/))&&ie[r[1]]?ie[r[1]]:"application/octet-stream"}function se(e){for(var t=Es(e),n=[],r=0;r<t.length;r+=76)n.push(t.slice(r,r+76));return n.join("\r\n")+"\r\n"}function le(e){var t=e.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,(function(e){var t=e.charCodeAt(0).toString(16).toUpperCase();return"="+(1==t.length?"0"+t:t)}));"\n"==(t=t.replace(/ $/gm,"=20").replace(/\t$/gm,"=09")).charAt(0)&&(t="=0D"+t.slice(1));for(var n=[],r=(t=t.replace(/\r(?!\n)/gm,"=0D").replace(/\n\n/gm,"\n=0A").replace(/([^\r\n])\n/gm,"$1=0A")).split("\r\n"),a=0;a<r.length;++a){var i=r[a];if(0!=i.length)for(var o=0;o<i.length;){var s=76,l=i.slice(o,o+s);"="==l.charAt(s-1)?s--:"="==l.charAt(s-2)?s-=2:"="==l.charAt(s-3)&&(s-=3),l=i.slice(o,o+s),(o+=s)<i.length&&(l+="="),n.push(l)}else n.push("")}return n.join("\r\n")}function ce(e,t,n){for(var r,a="",i="",o="",s=0;s<10;++s){var l=t[s];if(!l||l.match(/^\s*$/))break;var c=l.match(/^(.*?):\s*([^\s].*)$/);if(c)switch(c[1].toLowerCase()){case"content-location":a=c[2].trim();break;case"content-type":o=c[2].trim();break;case"content-transfer-encoding":i=c[2].trim()}}switch(++s,i.toLowerCase()){case"base64":r=As(xs(t.slice(s).join("")));break;case"quoted-printable":r=function(e){for(var t=[],n=0;n<e.length;++n){for(var r=e[n];n<=e.length&&"="==r.charAt(r.length-1);)r=r.slice(0,r.length-1)+e[++n];t.push(r)}for(var a=0;a<t.length;++a)t[a]=t[a].replace(/[=][0-9A-Fa-f]{2}/g,(function(e){return String.fromCharCode(parseInt(e.slice(1),16))}));return As(t.join("\r\n"))}(t.slice(s));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+i)}var u=ue(e,a.slice(n.length),r,{unsafe:!0});o&&(u.ctype=o)}function ue(e,t,n,a){var i=a&&a.unsafe;i||p(e);var o=!i&&Tl.find(e,t);if(!o){var s=e.FullPaths[0];t.slice(0,s.length)==s?s=t:("/"!=s.slice(-1)&&(s+="/"),s=(s+t).replace("//","/")),o={name:r(t),type:2},e.FileIndex.push(o),e.FullPaths.push(s),i||Tl.utils.cfb_gc(e)}return o.content=n,o.size=n?n.length:0,a&&(a.CLSID&&(o.clsid=a.CLSID),a.mt&&(o.mt=a.mt),a.ct&&(o.ct=a.ct)),o}return t.find=function(e,t){var n=e.FullPaths.map((function(e){return e.toUpperCase()})),r=n.map((function(e){var t=e.split("/");return t[t.length-("/"==e.slice(-1)?2:1)]})),a=!1;47===t.charCodeAt(0)?(a=!0,t=n[0].slice(0,-1)+t):a=-1!==t.indexOf("/");var i=t.toUpperCase(),o=!0===a?n.indexOf(i):r.indexOf(i);if(-1!==o)return e.FileIndex[o];var s=!i.match(js);for(i=i.replace(Rs,""),s&&(i=i.replace(js,"!")),o=0;o<n.length;++o){if((s?n[o].replace(js,"!"):n[o]).replace(Rs,"")==i)return e.FileIndex[o];if((s?r[o].replace(js,"!"):r[o]).replace(Rs,"")==i)return e.FileIndex[o]}return null},t.read=function(t,n){var r=n&&n.type;switch(r||_s&&Buffer.isBuffer(t)&&(r="buffer"),r||"base64"){case"file":return function(t,n){return o(),s(e.readFileSync(t),n)}(t,n);case"base64":return s(As(xs(t)),n);case"binary":return s(As(t),n)}return s(t,n)},t.parse=s,t.write=function(t,n){var r=m(t,n);switch(n&&n.type||"buffer"){case"file":return o(),e.writeFileSync(n.filename,r),r;case"binary":return"string"==typeof r?r:E(r);case"base64":return Es("string"==typeof r?r:E(r));case"buffer":if(_s)return Buffer.isBuffer(r)?r:ks(r);case"array":return"string"==typeof r?As(r):r}return r},t.writeFile=function(t,n,r){o();var a=m(t,r);e.writeFileSync(n,a)},t.utils={cfb_new:function(e){var t={};return p(t,e),t},cfb_add:ue,cfb_del:function(e,t){p(e);var n=Tl.find(e,t);if(n)for(var r=0;r<e.FileIndex.length;++r)if(e.FileIndex[r]==n)return e.FileIndex.splice(r,1),e.FullPaths.splice(r,1),!0;return!1},cfb_mov:function(e,t,n){p(e);var a=Tl.find(e,t);if(a)for(var i=0;i<e.FileIndex.length;++i)if(e.FileIndex[i]==a)return e.FileIndex[i].name=r(n),e.FullPaths[i]=n,!0;return!1},cfb_gc:function(e){h(e,!0)},ReadShift:du,CheckField:mu,prep_blob:fu,bconcat:Cs,use_zlib:function(e){try{var t=new(0,e.InflateRaw);if(t._processChunk(new Uint8Array([3,0]),t._finishFlushFlag),!t.bytesRead)throw new Error("zlib does not expose bytesRead");f=e}catch(e){console.error("cannot use native zlib: "+(e.message||e))}},_deflateRaw:W,_inflateRaw:te,consts:S},t}();function Al(e){return"string"==typeof e?Os(e):Array.isArray(e)?function(e){if("undefined"==typeof Uint8Array)throw new Error("Unsupported");return new Uint8Array(e)}(e):e}function Ol(e,t,n){if("undefined"!=typeof Deno){if(n&&"string"==typeof t)switch(n){case"utf8":t=new TextEncoder(n).encode(t);break;case"binary":t=Os(t);break;default:throw new Error("Unsupported encoding "+n)}return Deno.writeFileSync(e,t)}var r="utf8"==n?uc(t):t;if("undefined"!=typeof IE_SaveFile)return IE_SaveFile(r,e);if("undefined"!=typeof Blob){var a=new Blob([Al(r)],{type:"application/octet-stream"});if("undefined"!=typeof navigator&&navigator.msSaveBlob)return navigator.msSaveBlob(a,e);if("undefined"!=typeof saveAs)return saveAs(a,e);if("undefined"!=typeof URL&&"undefined"!=typeof document&&document.createElement&&URL.createObjectURL){var i=URL.createObjectURL(a);if("object"==typeof chrome&&"function"==typeof(chrome.downloads||{}).download)return URL.revokeObjectURL&&"undefined"!=typeof setTimeout&&setTimeout((function(){URL.revokeObjectURL(i)}),6e4),chrome.downloads.download({url:i,filename:e,saveAs:!0});var o=document.createElement("a");if(null!=o.download)return o.download=e,o.href=i,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL&&"undefined"!=typeof setTimeout&&setTimeout((function(){URL.revokeObjectURL(i)}),6e4),i}}if("undefined"!=typeof $&&"undefined"!=typeof File&&"undefined"!=typeof Folder)try{var s=File(e);return s.open("w"),s.encoding="binary",Array.isArray(t)&&(t=Ks(t)),s.write(t),s.close(),t}catch(e){if(!e.message||!e.message.match(/onstruct/))throw e}throw new Error("cannot save file "+e)}function Kl(e){for(var t=Object.keys(e),n=[],r=0;r<t.length;++r)Object.prototype.hasOwnProperty.call(e,t[r])&&n.push(t[r]);return n}function Cl(e,t){for(var n=[],r=Kl(e),a=0;a!==r.length;++a)null==n[e[r[a]][t]]&&(n[e[r[a]][t]]=r[a]);return n}function Rl(e){for(var t=[],n=Kl(e),r=0;r!==n.length;++r)t[e[n[r]]]=n[r];return t}function jl(e){for(var t=[],n=Kl(e),r=0;r!==n.length;++r)t[e[n[r]]]=parseInt(n[r],10);return t}var Pl=new Date(1899,11,30,0,0,0);function Dl(e,t){var n=e.getTime();return t&&(n-=1263168e5),(n-(Pl.getTime()+6e4*(e.getTimezoneOffset()-Pl.getTimezoneOffset())))/864e5}var Nl=new Date,Ll=Pl.getTime()+6e4*(Nl.getTimezoneOffset()-Pl.getTimezoneOffset()),Ml=Nl.getTimezoneOffset();function Fl(e){var t=new Date;return t.setTime(24*e*60*60*1e3+Ll),t.getTimezoneOffset()!==Ml&&t.setTime(t.getTime()+6e4*(t.getTimezoneOffset()-Ml)),t}var Bl=new Date("2017-02-19T19:06:09.000Z"),Vl=isNaN(Bl.getFullYear())?new Date("2/19/17"):Bl,Ul=2017==Vl.getFullYear();function Jl(e,t){var n=new Date(e);if(Ul)return t>0?n.setTime(n.getTime()+60*n.getTimezoneOffset()*1e3):t<0&&n.setTime(n.getTime()-60*n.getTimezoneOffset()*1e3),n;if(e instanceof Date)return e;if(1917==Vl.getFullYear()&&!isNaN(n.getFullYear())){var r=n.getFullYear();return e.indexOf(""+r)>-1||n.setFullYear(n.getFullYear()+100),n}var a=e.match(/\d+/g)||["2017","2","19","0","0","0"],i=new Date(+a[0],+a[1]-1,+a[2],+a[3]||0,+a[4]||0,+a[5]||0);return e.indexOf("Z")>-1&&(i=new Date(i.getTime()-60*i.getTimezoneOffset()*1e3)),i}function Gl(e,t){if(_s&&Buffer.isBuffer(e)){if(t){if(255==e[0]&&254==e[1])return uc(e.slice(2).toString("utf16le"));if(254==e[1]&&255==e[2])return uc(function(e){for(var t=[],n=0;n<e.length>>1;++n)t[n]=String.fromCharCode(e.charCodeAt(2*n+1)+(e.charCodeAt(2*n)<<8));return t.join("")}(e.slice(2).toString("binary")))}return e.toString("binary")}if("undefined"!=typeof TextDecoder)try{if(t){if(255==e[0]&&254==e[1])return uc(new TextDecoder("utf-16le").decode(e.slice(2)));if(254==e[0]&&255==e[1])return uc(new TextDecoder("utf-16be").decode(e.slice(2)))}var n={"€":"","‚":"","ƒ":"","„":"","…":"","†":"","‡":"","ˆ":"","‰":"","Š":"","‹":"","Œ":"","Ž":"","‘":"","’":"","“":"","”":"","•":"","–":"","—":"","˜":"","™":"","š":"","›":"","œ":"","ž":"","Ÿ":""};return Array.isArray(e)&&(e=new Uint8Array(e)),new TextDecoder("latin1").decode(e).replace(/[€‚ƒ„…†‡ˆ‰Š‹ŒŽ‘’“”•–—˜™š›œžŸ]/g,(function(e){return n[e]||e}))}catch(e){}for(var r=[],a=0;a!=e.length;++a)r.push(String.fromCharCode(e[a]));return r.join("")}function $l(e){if("undefined"!=typeof JSON&&!Array.isArray(e))return JSON.parse(JSON.stringify(e));if("object"!=typeof e||null==e)return e;if(e instanceof Date)return new Date(e.getTime());var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=$l(e[n]));return t}function ql(e,t){for(var n="";n.length<t;)n+=e;return n}function zl(e){var t=Number(e);if(!isNaN(t))return isFinite(t)?t:NaN;if(!/\d/.test(e))return t;var n=1,r=e.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,(function(){return n*=100,""}));return isNaN(t=Number(r))?(r=r.replace(/[(](.*)[)]/,(function(e,t){return n=-n,t})),isNaN(t=Number(r))?t:t/n):t/n}var Wl=["january","february","march","april","may","june","july","august","september","october","november","december"];function Yl(e){var t=new Date(e),n=new Date(NaN),r=t.getYear(),a=t.getMonth(),i=t.getDate();if(isNaN(i))return n;var o=e.toLowerCase();if(o.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if((o=o.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,"")).length>3&&-1==Wl.indexOf(o))return n}else if(o.match(/[a-z]/))return n;return r<0||r>8099?n:(a>0||i>1)&&101!=r?t:e.match(/[^-0-9:,\/\\]/)?n:t}function Hl(e,t,n){if(e.FullPaths){var r;if("string"==typeof n)return r=_s?ks(n):function(e){for(var t=[],n=0,r=e.length+250,a=Is(e.length+255),i=0;i<e.length;++i){var o=e.charCodeAt(i);if(o<128)a[n++]=o;else if(o<2048)a[n++]=192|o>>6&31,a[n++]=128|63&o;else if(o>=55296&&o<57344){o=64+(1023&o);var s=1023&e.charCodeAt(++i);a[n++]=240|o>>8&7,a[n++]=128|o>>2&63,a[n++]=128|s>>6&15|(3&o)<<4,a[n++]=128|63&s}else a[n++]=224|o>>12&15,a[n++]=128|o>>6&63,a[n++]=128|63&o;n>r&&(t.push(a.slice(0,n)),n=0,a=Is(65535),r=65530)}return t.push(a.slice(0,n)),Cs(t)}(n),Tl.utils.cfb_add(e,t,r);Tl.utils.cfb_add(e,t,n)}else e.file(t,n)}function Ql(){return Tl.utils.cfb_new()}var Zl='<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r\n',Xl=Rl({"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"}),ec=/[&<>'"]/g,tc=/[\u0000-\u0008\u000b-\u001f]/g;function nc(e){return(e+"").replace(ec,(function(e){return Xl[e]})).replace(tc,(function(e){return"_x"+("000"+e.charCodeAt(0).toString(16)).slice(-4)+"_"}))}function rc(e){return nc(e).replace(/ /g,"_x0020_")}var ac=/[\u0000-\u001f]/g;function ic(e){for(var t="",n=0,r=0,a=0,i=0,o=0,s=0;n<e.length;)(r=e.charCodeAt(n++))<128?t+=String.fromCharCode(r):(a=e.charCodeAt(n++),r>191&&r<224?(o=(31&r)<<6,o|=63&a,t+=String.fromCharCode(o)):(i=e.charCodeAt(n++),r<240?t+=String.fromCharCode((15&r)<<12|(63&a)<<6|63&i):(s=((7&r)<<18|(63&a)<<12|(63&i)<<6|63&(o=e.charCodeAt(n++)))-65536,t+=String.fromCharCode(55296+(s>>>10&1023)),t+=String.fromCharCode(56320+(1023&s)))));return t}function oc(e){var t,n,r,a=Is(2*e.length),i=1,o=0,s=0;for(n=0;n<e.length;n+=i)i=1,(r=e.charCodeAt(n))<128?t=r:r<224?(t=64*(31&r)+(63&e.charCodeAt(n+1)),i=2):r<240?(t=4096*(15&r)+64*(63&e.charCodeAt(n+1))+(63&e.charCodeAt(n+2)),i=3):(i=4,t=262144*(7&r)+4096*(63&e.charCodeAt(n+1))+64*(63&e.charCodeAt(n+2))+(63&e.charCodeAt(n+3)),s=55296+((t-=65536)>>>10&1023),t=56320+(1023&t)),0!==s&&(a[o++]=255&s,a[o++]=s>>>8,s=0),a[o++]=t%256,a[o++]=t>>>8;return a.slice(0,o).toString("ucs2")}function sc(e){return ks(e,"binary").toString("utf8")}var lc="foo bar bazâð£",cc=_s&&(sc(lc)==ic(lc)&&sc||oc(lc)==ic(lc)&&oc)||ic,uc=_s?function(e){return ks(e,"utf8").toString("binary")}:function(e){for(var t=[],n=0,r=0,a=0;n<e.length;)switch(r=e.charCodeAt(n++),!0){case r<128:t.push(String.fromCharCode(r));break;case r<2048:t.push(String.fromCharCode(192+(r>>6))),t.push(String.fromCharCode(128+(63&r)));break;case r>=55296&&r<57344:r-=55296,a=e.charCodeAt(n++)-56320+(r<<10),t.push(String.fromCharCode(240+(a>>18&7))),t.push(String.fromCharCode(144+(a>>12&63))),t.push(String.fromCharCode(128+(a>>6&63))),t.push(String.fromCharCode(128+(63&a)));break;default:t.push(String.fromCharCode(224+(r>>12))),t.push(String.fromCharCode(128+(r>>6&63))),t.push(String.fromCharCode(128+(63&r)))}return t.join("")},dc=function(){var e=[["nbsp"," "],["middot","·"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map((function(e){return[new RegExp("&"+e[0]+";","ig"),e[1]]}));return function(t){for(var n=t.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,"\n").replace(/<[^>]*>/g,""),r=0;r<e.length;++r)n=n.replace(e[r][0],e[r][1]);return n}}(),pc=/(^\s|\s$|\n)/;function hc(e,t){return"<"+e+(t.match(pc)?' xml:space="preserve"':"")+">"+t+"</"+e+">"}function mc(e){return Kl(e).map((function(t){return" "+t+'="'+e[t]+'"'})).join("")}function fc(e,t,n){return"<"+e+(null!=n?mc(n):"")+(null!=t?(t.match(pc)?' xml:space="preserve"':"")+">"+t+"</"+e:"/")+">"}function yc(e,t){try{return e.toISOString().replace(/\.\d*/,"")}catch(e){if(t)throw e}return""}var gc="http://schemas.openxmlformats.org/package/2006/metadata/core-properties",bc="http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",vc="http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",wc="http://schemas.openxmlformats.org/package/2006/content-types",Sc="http://schemas.openxmlformats.org/package/2006/relationships",Ec="http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",xc="http://purl.org/dc/elements/1.1/",_c="http://purl.org/dc/terms/",kc="http://purl.org/dc/dcmitype/",Ic="http://schemas.openxmlformats.org/officeDocument/2006/relationships",Tc="http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",Ac="http://www.w3.org/2001/XMLSchema-instance",Oc="http://www.w3.org/2001/XMLSchema",Kc=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"],Cc="urn:schemas-microsoft-com:office:office",Rc="urn:schemas-microsoft-com:office:excel",jc="urn:schemas-microsoft-com:office:spreadsheet",Pc="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882",Dc="http://macVmlSchemaUri",Nc="urn:schemas-microsoft-com:vml",Lc="http://www.w3.org/TR/REC-html40";var Mc=function(e){for(var t=[],n=0;n<e[0].length;++n)if(e[0][n])for(var r=0,a=e[0][n].length;r<a;r+=10240)t.push.apply(t,e[0][n].slice(r,r+10240));return t},Fc=_s?function(e){return e[0].length>0&&Buffer.isBuffer(e[0][0])?Buffer.concat(e[0].map((function(e){return Buffer.isBuffer(e)?e:ks(e)}))):Mc(e)}:Mc,Bc=function(e,t,n){for(var r=[],a=t;a<n;a+=2)r.push(String.fromCharCode(ou(e,a)));return r.join("").replace(Rs,"")},Vc=_s?function(e,t,n){return Buffer.isBuffer(e)?e.toString("utf16le",t,n).replace(Rs,""):Bc(e,t,n)}:Bc,Uc=function(e,t,n){for(var r=[],a=t;a<t+n;++a)r.push(("0"+e[a].toString(16)).slice(-2));return r.join("")},Jc=_s?function(e,t,n){return Buffer.isBuffer(e)?e.toString("hex",t,t+n):Uc(e,t,n)}:Uc,Gc=function(e,t,n){for(var r=[],a=t;a<n;a++)r.push(String.fromCharCode(iu(e,a)));return r.join("")},$c=_s?function(e,t,n){return Buffer.isBuffer(e)?e.toString("utf8",t,n):Gc(e,t,n)}:Gc,qc=function(e,t){var n=lu(e,t);return n>0?$c(e,t+4,t+4+n-1):""},zc=qc,Wc=function(e,t){var n=lu(e,t);return n>0?$c(e,t+4,t+4+n-1):""},Yc=Wc,Hc=function(e,t){var n=2*lu(e,t);return n>0?$c(e,t+4,t+4+n-1):""},Qc=Hc,Zc=function(e,t){var n=lu(e,t);return n>0?Vc(e,t+4,t+4+n):""},Xc=Zc,eu=function(e,t){var n=lu(e,t);return n>0?$c(e,t+4,t+4+n):""},tu=eu,nu=function(e,t){return function(e,t){for(var n=1-2*(e[t+7]>>>7),r=((127&e[t+7])<<4)+(e[t+6]>>>4&15),a=15&e[t+6],i=5;i>=0;--i)a=256*a+e[t+i];return 2047==r?0==a?n*(1/0):NaN:(0==r?r=-1022:(r-=1023,a+=Math.pow(2,52)),n*Math.pow(2,r-52)*a)}(e,t)},ru=nu,au=function(e){return Array.isArray(e)||"undefined"!=typeof Uint8Array&&e instanceof Uint8Array};_s&&(zc=function(e,t){if(!Buffer.isBuffer(e))return qc(e,t);var n=e.readUInt32LE(t);return n>0?e.toString("utf8",t+4,t+4+n-1):""},Yc=function(e,t){if(!Buffer.isBuffer(e))return Wc(e,t);var n=e.readUInt32LE(t);return n>0?e.toString("utf8",t+4,t+4+n-1):""},Qc=function(e,t){if(!Buffer.isBuffer(e))return Hc(e,t);var n=2*e.readUInt32LE(t);return e.toString("utf16le",t+4,t+4+n-1)},Xc=function(e,t){if(!Buffer.isBuffer(e))return Zc(e,t);var n=e.readUInt32LE(t);return e.toString("utf16le",t+4,t+4+n)},tu=function(e,t){if(!Buffer.isBuffer(e))return eu(e,t);var n=e.readUInt32LE(t);return e.toString("utf8",t+4,t+4+n)},ru=function(e,t){return Buffer.isBuffer(e)?e.readDoubleLE(t):nu(e,t)},au=function(e){return Buffer.isBuffer(e)||Array.isArray(e)||"undefined"!=typeof Uint8Array&&e instanceof Uint8Array});var iu=function(e,t){return e[t]},ou=function(e,t){return 256*e[t+1]+e[t]},su=function(e,t){var n=256*e[t+1]+e[t];return n<32768?n:-1*(65535-n+1)},lu=function(e,t){return e[t+3]*(1<<24)+(e[t+2]<<16)+(e[t+1]<<8)+e[t]},cu=function(e,t){return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]},uu=function(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]};function du(e,t){var n,r,a,i,o,s,l="",c=[];switch(t){case"dbcs":if(s=this.l,_s&&Buffer.isBuffer(this))l=this.slice(this.l,this.l+2*e).toString("utf16le");else for(o=0;o<e;++o)l+=String.fromCharCode(ou(this,s)),s+=2;e*=2;break;case"utf8":l=$c(this,this.l,this.l+e);break;case"utf16le":e*=2,l=Vc(this,this.l,this.l+e);break;case"wstr":return du.call(this,e,"dbcs");case"lpstr-ansi":l=zc(this,this.l),e=4+lu(this,this.l);break;case"lpstr-cp":l=Yc(this,this.l),e=4+lu(this,this.l);break;case"lpwstr":l=Qc(this,this.l),e=4+2*lu(this,this.l);break;case"lpp4":e=4+lu(this,this.l),l=Xc(this,this.l),2&e&&(e+=2);break;case"8lpp4":e=4+lu(this,this.l),l=tu(this,this.l),3&e&&(e+=4-(3&e));break;case"cstr":for(e=0,l="";0!==(a=iu(this,this.l+e++));)c.push(vs(a));l=c.join("");break;case"_wstr":for(e=0,l="";0!==(a=ou(this,this.l+e));)c.push(vs(a)),e+=2;e+=2,l=c.join("");break;case"dbcs-cont":for(l="",s=this.l,o=0;o<e;++o){if(this.lens&&-1!==this.lens.indexOf(s))return a=iu(this,s),this.l=s+1,i=du.call(this,e-o,a?"dbcs-cont":"sbcs-cont"),c.join("")+i;c.push(vs(ou(this,s))),s+=2}l=c.join(""),e*=2;break;case"cpstr":case"sbcs-cont":for(l="",s=this.l,o=0;o!=e;++o){if(this.lens&&-1!==this.lens.indexOf(s))return a=iu(this,s),this.l=s+1,i=du.call(this,e-o,a?"dbcs-cont":"sbcs-cont"),c.join("")+i;c.push(vs(iu(this,s))),s+=1}l=c.join("");break;default:switch(e){case 1:return n=iu(this,this.l),this.l++,n;case 2:return n=("i"===t?su:ou)(this,this.l),this.l+=2,n;case 4:case-4:return"i"===t||0==(128&this[this.l+3])?(n=(e>0?cu:uu)(this,this.l),this.l+=4,n):(r=lu(this,this.l),this.l+=4,r);case 8:case-8:if("f"===t)return r=8==e?ru(this,this.l):ru([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,r;e=8;case 16:l=Jc(this,this.l,e)}}return this.l+=e,l}var pu=function(e,t,n){e[n]=255&t,e[n+1]=t>>>8&255};function hu(e,t,n){var r=0,a=0;if("dbcs"===n){for(a=0;a!=t.length;++a)pu(this,t.charCodeAt(a),this.l+2*a);r=2*t.length}else if("sbcs"===n){for(t=t.replace(/[^\x00-\x7F]/g,"_"),a=0;a!=t.length;++a)this[this.l+a]=255&t.charCodeAt(a);r=t.length}else{if("hex"===n){for(;a<e;++a)this[this.l++]=parseInt(t.slice(2*a,2*a+2),16)||0;return this}if("utf16le"===n){var i=Math.min(this.l+e,this.length);for(a=0;a<Math.min(t.length,e);++a){var o=t.charCodeAt(a);this[this.l++]=255&o,this[this.l++]=o>>8}for(;this.l<i;)this[this.l++]=0;return this}switch(e){case 1:r=1,this[this.l]=255&t;break;case 2:r=2,this[this.l]=255&t,t>>>=8,this[this.l+1]=255&t;break;case 3:r=3,this[this.l]=255&t,t>>>=8,this[this.l+1]=255&t,t>>>=8,this[this.l+2]=255&t;break;case 4:r=4,function(e,t,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24&255}(this,t,this.l);break;case 8:if(r=8,"f"===n){!function(e,t,n){var r=(t<0||1/t==-1/0?1:0)<<7,a=0,i=0,o=r?-t:t;isFinite(o)?0==o?a=i=0:(a=Math.floor(Math.log(o)/Math.LN2),i=o*Math.pow(2,52-a),a<=-1023&&(!isFinite(i)||i<Math.pow(2,52))?a=-1022:(i-=Math.pow(2,52),a+=1023)):(a=2047,i=isNaN(t)?26985:0);for(var s=0;s<=5;++s,i/=256)e[n+s]=255&i;e[n+6]=(15&a)<<4|15&i,e[n+7]=a>>4|r}(this,t,this.l);break}case 16:break;case-4:r=4,function(e,t,n){e[n]=255&t,e[n+1]=t>>8&255,e[n+2]=t>>16&255,e[n+3]=t>>24&255}(this,t,this.l)}}return this.l+=r,this}function mu(e,t){var n=Jc(this,this.l,e.length>>1);if(n!==e)throw new Error(t+"Expected "+e+" saw "+n);this.l+=e.length>>1}function fu(e,t){e.l=t,e.read_shift=du,e.chk=mu,e.write_shift=hu}function yu(e,t){e.l+=t}function gu(e){var t=Is(e);return fu(t,0),t}function bu(){var e=[],t=_s?256:2048,n=function(e){var t=gu(e);return fu(t,0),t},r=n(t),a=function(){r&&(r.length>r.l&&((r=r.slice(0,r.l)).l=r.length),r.length>0&&e.push(r),r=null)},i=function(e){return r&&e<r.length-r.l?r:(a(),r=n(Math.max(e+1,t)))};return{next:i,push:function(e){a(),null==(r=e).l&&(r.l=r.length),i(t)},end:function(){return a(),Cs(e)},_bufs:e}}function vu(e,t,n,r){var a,i=+t;if(!isNaN(i)){r||(r=Sm[i].p||(n||[]).length||0),a=1+(i>=128?1:0)+1,r>=128&&++a,r>=16384&&++a,r>=2097152&&++a;var o=e.next(a);i<=127?o.write_shift(1,i):(o.write_shift(1,128+(127&i)),o.write_shift(1,i>>7));for(var s=0;4!=s;++s){if(!(r>=128)){o.write_shift(1,r);break}o.write_shift(1,128+(127&r)),r>>=7}r>0&&au(n)&&e.push(n)}}function wu(e,t,n){var r=$l(e);if(t.s?(r.cRel&&(r.c+=t.s.c),r.rRel&&(r.r+=t.s.r)):(r.cRel&&(r.c+=t.c),r.rRel&&(r.r+=t.r)),!n||n.biff<12){for(;r.c>=256;)r.c-=256;for(;r.r>=65536;)r.r-=65536}return r}function Su(e,t,n){var r=$l(e);return r.s=wu(r.s,t.s,n),r.e=wu(r.e,t.s,n),r}function Eu(e,t){if(e.cRel&&e.c<0)for(e=$l(e);e.c<0;)e.c+=t>8?16384:256;if(e.rRel&&e.r<0)for(e=$l(e);e.r<0;)e.r+=t>8?1048576:t>5?65536:16384;var n=Ou(e);return e.cRel||null==e.cRel||(n=n.replace(/^([A-Z])/,"$$$1")),e.rRel||null==e.rRel||(n=function(e){return e.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}(n)),n}function xu(e,t){return 0!=e.s.r||e.s.rRel||e.e.r!=(t.biff>=12?1048575:t.biff>=8?65536:16384)||e.e.rRel?0!=e.s.c||e.s.cRel||e.e.c!=(t.biff>=12?16383:255)||e.e.cRel?Eu(e.s,t.biff)+":"+Eu(e.e,t.biff):(e.s.rRel?"":"$")+ku(e.s.r)+":"+(e.e.rRel?"":"$")+ku(e.e.r):(e.s.cRel?"":"$")+Tu(e.s.c)+":"+(e.e.cRel?"":"$")+Tu(e.e.c)}function _u(e){return parseInt(e.replace(/\$(\d+)$/,"$1"),10)-1}function ku(e){return""+(e+1)}function Iu(e){for(var t=e.replace(/^\$([A-Z])/,"$1"),n=0,r=0;r!==t.length;++r)n=26*n+t.charCodeAt(r)-64;return n-1}function Tu(e){if(e<0)throw new Error("invalid column "+e);var t="";for(++e;e;e=Math.floor((e-1)/26))t=String.fromCharCode((e-1)%26+65)+t;return t}function Au(e){for(var t=0,n=0,r=0;r<e.length;++r){var a=e.charCodeAt(r);a>=48&&a<=57?t=10*t+(a-48):a>=65&&a<=90&&(n=26*n+(a-64))}return{c:n-1,r:t-1}}function Ou(e){for(var t=e.c+1,n="";t;t=(t-1)/26|0)n=String.fromCharCode((t-1)%26+65)+n;return n+(e.r+1)}function Ku(e){var t=e.indexOf(":");return-1==t?{s:Au(e),e:Au(e)}:{s:Au(e.slice(0,t)),e:Au(e.slice(t+1))}}function Cu(e,t){return void 0===t||"number"==typeof t?Cu(e.s,e.e):("string"!=typeof e&&(e=Ou(e)),"string"!=typeof t&&(t=Ou(t)),e==t?e:e+":"+t)}function Ru(e){var t={s:{c:0,r:0},e:{c:0,r:0}},n=0,r=0,a=0,i=e.length;for(n=0;r<i&&!((a=e.charCodeAt(r)-64)<1||a>26);++r)n=26*n+a;for(t.s.c=--n,n=0;r<i&&!((a=e.charCodeAt(r)-48)<0||a>9);++r)n=10*n+a;if(t.s.r=--n,r===i||10!=a)return t.e.c=t.s.c,t.e.r=t.s.r,t;for(++r,n=0;r!=i&&!((a=e.charCodeAt(r)-64)<1||a>26);++r)n=26*n+a;for(t.e.c=--n,n=0;r!=i&&!((a=e.charCodeAt(r)-48)<0||a>9);++r)n=10*n+a;return t.e.r=--n,t}function ju(e,t){var n="d"==e.t&&t instanceof Date;if(null!=e.z)try{return e.w=Sl(e.z,n?Dl(t):t)}catch(e){}try{return e.w=Sl((e.XF||{}).numFmtId||(n?14:0),n?Dl(t):t)}catch(e){return""+t}}function Pu(e,t,n){return null==e||null==e.t||"z"==e.t?"":void 0!==e.w?e.w:("d"==e.t&&!e.z&&n&&n.dateNF&&(e.z=n.dateNF),"e"==e.t?md[e.v]||e.v:ju(e,null==t?e.v:t))}function Du(e,t){var n=t&&t.sheet?t.sheet:"Sheet1",r={};return r[n]=e,{SheetNames:[n],Sheets:r}}function Nu(e,t,n){var r=n||{},a=e?Array.isArray(e):r.dense,i=e||(a?[]:{}),o=0,s=0;if(i&&null!=r.origin){if("number"==typeof r.origin)o=r.origin;else{var l="string"==typeof r.origin?Au(r.origin):r.origin;o=l.r,s=l.c}i["!ref"]||(i["!ref"]="A1:A1")}var c={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(i["!ref"]){var u=Ru(i["!ref"]);c.s.c=u.s.c,c.s.r=u.s.r,c.e.c=Math.max(c.e.c,u.e.c),c.e.r=Math.max(c.e.r,u.e.r),-1==o&&(c.e.r=o=u.e.r+1)}for(var d=0;d!=t.length;++d)if(t[d]){if(!Array.isArray(t[d]))throw new Error("aoa_to_sheet expects an array of arrays");for(var p=0;p!=t[d].length;++p)if(void 0!==t[d][p]){var h={v:t[d][p]},m=o+d,f=s+p;if(c.s.r>m&&(c.s.r=m),c.s.c>f&&(c.s.c=f),c.e.r<m&&(c.e.r=m),c.e.c<f&&(c.e.c=f),!t[d][p]||"object"!=typeof t[d][p]||Array.isArray(t[d][p])||t[d][p]instanceof Date)if(Array.isArray(h.v)&&(h.f=t[d][p][1],h.v=h.v[0]),null===h.v)if(h.f)h.t="n";else if(r.nullError)h.t="e",h.v=0;else{if(!r.sheetStubs)continue;h.t="z"}else"number"==typeof h.v?h.t="n":"boolean"==typeof h.v?h.t="b":h.v instanceof Date?(h.z=r.dateNF||Js[14],r.cellDates?(h.t="d",h.w=Sl(h.z,Dl(h.v))):(h.t="n",h.v=Dl(h.v),h.w=Sl(h.z,h.v))):h.t="s";else h=t[d][p];if(a)i[m]||(i[m]=[]),i[m][f]&&i[m][f].z&&(h.z=i[m][f].z),i[m][f]=h;else{var y=Ou({c:f,r:m});i[y]&&i[y].z&&(h.z=i[y].z),i[y]=h}}}return c.s.c<1e7&&(i["!ref"]=Cu(c)),i}function Lu(e,t){return Nu(null,e,t)}function Mu(e,t){return t||(t=gu(4)),t.write_shift(4,e),t}function Fu(e){var t=e.read_shift(4);return 0===t?"":e.read_shift(t,"dbcs")}function Bu(e,t){var n=!1;return null==t&&(n=!0,t=gu(4+2*e.length)),t.write_shift(4,e.length),e.length>0&&t.write_shift(0,e,"dbcs"),n?t.slice(0,t.l):t}function Vu(e){return{ich:e.read_shift(2),ifnt:e.read_shift(2)}}function Uu(e,t){var n=e.l,r=e.read_shift(1),a=Fu(e),i=[],o={t:a,h:a};if(0!=(1&r)){for(var s=e.read_shift(4),l=0;l!=s;++l)i.push(Vu(e));o.r=i}else o.r=[{ich:0,ifnt:0}];return e.l=n+t,o}var Ju=Uu;function Gu(e,t){var n=!1;return null==t&&(n=!0,t=gu(23+4*e.t.length)),t.write_shift(1,1),Bu(e.t,t),t.write_shift(4,1),function(e,t){t||(t=gu(4)),t.write_shift(2,e.ich||0),t.write_shift(2,e.ifnt||0)}({ich:0,ifnt:0},t),n?t.slice(0,t.l):t}function $u(e){var t=e.read_shift(4),n=e.read_shift(2);return n+=e.read_shift(1)<<16,e.l++,{c:t,iStyleRef:n}}function qu(e,t){return null==t&&(t=gu(8)),t.write_shift(-4,e.c),t.write_shift(3,e.iStyleRef||e.s),t.write_shift(1,0),t}function zu(e){var t=e.read_shift(2);return t+=e.read_shift(1)<<16,e.l++,{c:-1,iStyleRef:t}}function Wu(e,t){return null==t&&(t=gu(4)),t.write_shift(3,e.iStyleRef||e.s),t.write_shift(1,0),t}var Yu=Fu,Hu=Bu;function Qu(e){var t=e.read_shift(4);return 0===t||4294967295===t?"":e.read_shift(t,"dbcs")}function Zu(e,t){var n=!1;return null==t&&(n=!0,t=gu(127)),t.write_shift(4,e.length>0?e.length:4294967295),e.length>0&&t.write_shift(0,e,"dbcs"),n?t.slice(0,t.l):t}var Xu=Fu,ed=Qu,td=Zu;function nd(e){var t=e.slice(e.l,e.l+4),n=1&t[0],r=2&t[0];e.l+=4;var a=0===r?ru([0,0,0,0,252&t[0],t[1],t[2],t[3]],0):cu(t,0)>>2;return n?a/100:a}function rd(e,t){null==t&&(t=gu(4));var n=0,r=0,a=100*e;if(e==(0|e)&&e>=-(1<<29)&&e<1<<29?r=1:a==(0|a)&&a>=-(1<<29)&&a<1<<29&&(r=1,n=1),!r)throw new Error("unsupported RkNumber "+e);t.write_shift(-4,((n?a:e)<<2)+(n+2))}function ad(e){var t={s:{},e:{}};return t.s.r=e.read_shift(4),t.e.r=e.read_shift(4),t.s.c=e.read_shift(4),t.e.c=e.read_shift(4),t}var id=ad,od=function(e,t){return t||(t=gu(16)),t.write_shift(4,e.s.r),t.write_shift(4,e.e.r),t.write_shift(4,e.s.c),t.write_shift(4,e.e.c),t};function sd(e){if(e.length-e.l<8)throw"XLS Xnum Buffer underflow";return e.read_shift(8,"f")}function ld(e,t){return(t||gu(8)).write_shift(8,e,"f")}function cd(e,t){if(t||(t=gu(8)),!e||e.auto)return t.write_shift(4,0),t.write_shift(4,0),t;null!=e.index?(t.write_shift(1,2),t.write_shift(1,e.index)):null!=e.theme?(t.write_shift(1,6),t.write_shift(1,e.theme)):(t.write_shift(1,5),t.write_shift(1,0));var n=e.tint||0;if(n>0?n*=32767:n<0&&(n*=32768),t.write_shift(2,n),e.rgb&&null==e.theme){var r=e.rgb||"FFFFFF";"number"==typeof r&&(r=("000000"+r.toString(16)).slice(-6)),t.write_shift(1,parseInt(r.slice(0,2),16)),t.write_shift(1,parseInt(r.slice(2,4),16)),t.write_shift(1,parseInt(r.slice(4,6),16)),t.write_shift(1,255)}else t.write_shift(2,0),t.write_shift(1,0),t.write_shift(1,0);return t}var ud={1:{n:"CodePage",t:2},2:{n:"Category",t:80},3:{n:"PresentationFormat",t:80},4:{n:"ByteCount",t:3},5:{n:"LineCount",t:3},6:{n:"ParagraphCount",t:3},7:{n:"SlideCount",t:3},8:{n:"NoteCount",t:3},9:{n:"HiddenCount",t:3},10:{n:"MultimediaClipCount",t:3},11:{n:"ScaleCrop",t:11},12:{n:"HeadingPairs",t:4108},13:{n:"TitlesOfParts",t:4126},14:{n:"Manager",t:80},15:{n:"Company",t:80},16:{n:"LinksUpToDate",t:11},17:{n:"CharacterCount",t:3},19:{n:"SharedDoc",t:11},22:{n:"HyperlinksChanged",t:11},23:{n:"AppVersion",t:3,p:"version"},24:{n:"DigSig",t:65},26:{n:"ContentType",t:80},27:{n:"ContentStatus",t:80},28:{n:"Language",t:80},29:{n:"Version",t:80},255:{},2147483648:{n:"Locale",t:19},2147483651:{n:"Behavior",t:19},1919054434:{}},dd={1:{n:"CodePage",t:2},2:{n:"Title",t:80},3:{n:"Subject",t:80},4:{n:"Author",t:80},5:{n:"Keywords",t:80},6:{n:"Comments",t:80},7:{n:"Template",t:80},8:{n:"LastAuthor",t:80},9:{n:"RevNumber",t:80},10:{n:"EditTime",t:64},11:{n:"LastPrinted",t:64},12:{n:"CreatedDate",t:64},13:{n:"ModifiedDate",t:64},14:{n:"PageCount",t:3},15:{n:"WordCount",t:3},16:{n:"CharCount",t:3},17:{n:"Thumbnail",t:71},18:{n:"Application",t:80},19:{n:"DocSecurity",t:3},255:{},2147483648:{n:"Locale",t:19},2147483651:{n:"Behavior",t:19},1919054434:{}};function pd(e){return e.map((function(e){return[e>>16&255,e>>8&255,255&e]}))}var hd=$l(pd([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),md={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},fd={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"},yd={workbooks:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.main+xml",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.main",xlam:"application/vnd.ms-excel.addin.macroEnabled.main+xml",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml"},strs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml",xlsb:"application/vnd.ms-excel.sharedStrings"},comments:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml",xlsb:"application/vnd.ms-excel.comments"},sheets:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml",xlsb:"application/vnd.ms-excel.worksheet"},charts:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml",xlsb:"application/vnd.ms-excel.chartsheet"},dialogs:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml",xlsb:"application/vnd.ms-excel.dialogsheet"},macros:{xlsx:"application/vnd.ms-excel.macrosheet+xml",xlsb:"application/vnd.ms-excel.macrosheet"},metadata:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml",xlsb:"application/vnd.ms-excel.sheetMetadata"},styles:{xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml",xlsb:"application/vnd.ms-excel.styles"}};function gd(e,t){var n,r=function(e){for(var t=[],n=Kl(e),r=0;r!==n.length;++r)null==t[e[n[r]]]&&(t[e[n[r]]]=[]),t[e[n[r]]].push(n[r]);return t}(fd),a=[];a[a.length]=Zl,a[a.length]=fc("Types",null,{xmlns:wc,"xmlns:xsd":Oc,"xmlns:xsi":Ac}),a=a.concat([["xml","application/xml"],["bin","application/vnd.ms-excel.sheet.binary.macroEnabled.main"],["vml","application/vnd.openxmlformats-officedocument.vmlDrawing"],["data","application/vnd.openxmlformats-officedocument.model+data"],["bmp","image/bmp"],["png","image/png"],["gif","image/gif"],["emf","image/x-emf"],["wmf","image/x-wmf"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["tif","image/tiff"],["tiff","image/tiff"],["pdf","application/pdf"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].map((function(e){return fc("Default",null,{Extension:e[0],ContentType:e[1]})})));var i=function(r){e[r]&&e[r].length>0&&(n=e[r][0],a[a.length]=fc("Override",null,{PartName:("/"==n[0]?"":"/")+n,ContentType:yd[r][t.bookType]||yd[r].xlsx}))},o=function(n){(e[n]||[]).forEach((function(e){a[a.length]=fc("Override",null,{PartName:("/"==e[0]?"":"/")+e,ContentType:yd[n][t.bookType]||yd[n].xlsx})}))},s=function(t){(e[t]||[]).forEach((function(e){a[a.length]=fc("Override",null,{PartName:("/"==e[0]?"":"/")+e,ContentType:r[t][0]})}))};return i("workbooks"),o("sheets"),o("charts"),s("themes"),["strs","styles"].forEach(i),["coreprops","extprops","custprops"].forEach(s),s("vba"),s("comments"),s("threadedcomments"),s("drawings"),o("metadata"),s("people"),a.length>2&&(a[a.length]="</Types>",a[1]=a[1].replace("/>",">")),a.join("")}var bd={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function vd(e){var t=e.lastIndexOf("/");return e.slice(0,t+1)+"_rels/"+e.slice(t+1)+".rels"}function wd(e){var t=[Zl,fc("Relationships",null,{xmlns:Sc})];return Kl(e["!id"]).forEach((function(n){t[t.length]=fc("Relationship",null,e["!id"][n])})),t.length>2&&(t[t.length]="</Relationships>",t[1]=t[1].replace("/>",">")),t.join("")}function Sd(e,t,n,r,a,i){if(a||(a={}),e["!id"]||(e["!id"]={}),e["!idx"]||(e["!idx"]=1),t<0)for(t=e["!idx"];e["!id"]["rId"+t];++t);if(e["!idx"]=t+1,a.Id="rId"+t,a.Type=r,a.Target=n,i?a.TargetMode=i:[bd.HLINK,bd.XPATH,bd.XMISS].indexOf(a.Type)>-1&&(a.TargetMode="External"),e["!id"][a.Id])throw new Error("Cannot rewrite rId "+t);return e["!id"][a.Id]=a,e[("/"+a.Target).replace("//","/")]=a,t}function Ed(e,t,n){return['  <rdf:Description rdf:about="'+e+'">\n','    <rdf:type rdf:resource="http://docs.oasis-open.org/ns/office/1.2/meta/'+(n||"odf")+"#"+t+'"/>\n',"  </rdf:Description>\n"].join("")}function xd(){return'<office:document-meta xmlns:office="urn:oasis:names:tc:opendocument:xmlns:office:1.0" xmlns:meta="urn:oasis:names:tc:opendocument:xmlns:meta:1.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:xlink="http://www.w3.org/1999/xlink" office:version="1.2"><office:meta><meta:generator>SheetJS '+hs.version+"</meta:generator></office:meta></office:document-meta>"}var _d=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]];function kd(e,t,n,r,a){null==a[e]&&null!=t&&""!==t&&(a[e]=t,t=nc(t),r[r.length]=n?fc(e,t,n):hc(e,t))}function Id(e,t){var n=t||{},r=[Zl,fc("cp:coreProperties",null,{"xmlns:cp":gc,"xmlns:dc":xc,"xmlns:dcterms":_c,"xmlns:dcmitype":kc,"xmlns:xsi":Ac})],a={};if(!e&&!n.Props)return r.join("");e&&(null!=e.CreatedDate&&kd("dcterms:created","string"==typeof e.CreatedDate?e.CreatedDate:yc(e.CreatedDate,n.WTF),{"xsi:type":"dcterms:W3CDTF"},r,a),null!=e.ModifiedDate&&kd("dcterms:modified","string"==typeof e.ModifiedDate?e.ModifiedDate:yc(e.ModifiedDate,n.WTF),{"xsi:type":"dcterms:W3CDTF"},r,a));for(var i=0;i!=_d.length;++i){var o=_d[i],s=n.Props&&null!=n.Props[o[1]]?n.Props[o[1]]:e?e[o[1]]:null;!0===s?s="1":!1===s?s="0":"number"==typeof s&&(s=String(s)),null!=s&&kd(o[0],s,null,r,a)}return r.length>2&&(r[r.length]="</cp:coreProperties>",r[1]=r[1].replace("/>",">")),r.join("")}var Td=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]],Ad=["Worksheets","SheetNames","NamedRanges","DefinedNames","Chartsheets","ChartNames"];function Od(e){var t=[],n=fc;return e||(e={}),e.Application="SheetJS",t[t.length]=Zl,t[t.length]=fc("Properties",null,{xmlns:vc,"xmlns:vt":Tc}),Td.forEach((function(r){if(void 0!==e[r[1]]){var a;switch(r[2]){case"string":a=nc(String(e[r[1]]));break;case"bool":a=e[r[1]]?"true":"false"}void 0!==a&&(t[t.length]=n(r[0],a))}})),t[t.length]=n("HeadingPairs",n("vt:vector",n("vt:variant","<vt:lpstr>Worksheets</vt:lpstr>")+n("vt:variant",n("vt:i4",String(e.Worksheets))),{size:2,baseType:"variant"})),t[t.length]=n("TitlesOfParts",n("vt:vector",e.SheetNames.map((function(e){return"<vt:lpstr>"+nc(e)+"</vt:lpstr>"})).join(""),{size:e.Worksheets,baseType:"lpstr"})),t.length>2&&(t[t.length]="</Properties>",t[1]=t[1].replace("/>",">")),t.join("")}function Kd(e){var t=[Zl,fc("Properties",null,{xmlns:bc,"xmlns:vt":Tc})];if(!e)return t.join("");var n=1;return Kl(e).forEach((function(r){++n,t[t.length]=fc("property",function(e,t){switch(typeof e){case"string":var n=fc("vt:lpwstr",nc(e));return t&&(n=n.replace(/&quot;/g,"_x0022_")),n;case"number":return fc((0|e)==e?"vt:i4":"vt:r8",nc(String(e)));case"boolean":return fc("vt:bool",e?"true":"false")}if(e instanceof Date)return fc("vt:filetime",yc(e));throw new Error("Unable to serialize "+e)}(e[r],!0),{fmtid:"{D5CDD505-2E9C-101B-9397-08002B2CF9AE}",pid:n,name:nc(r)})})),t.length>2&&(t[t.length]="</Properties>",t[1]=t[1].replace("/>",">")),t.join("")}var Cd={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"};function Rd(e,t){var n=gu(4),r=gu(4);switch(n.write_shift(4,80==e?31:e),e){case 3:r.write_shift(-4,t);break;case 5:(r=gu(8)).write_shift(8,t,"f");break;case 11:r.write_shift(4,t?1:0);break;case 64:r=function(e){var t=("string"==typeof e?new Date(Date.parse(e)):e).getTime()/1e3+11644473600,n=t%Math.pow(2,32),r=(t-n)/Math.pow(2,32);r*=1e7;var a=(n*=1e7)/Math.pow(2,32)|0;a>0&&(n%=Math.pow(2,32),r+=a);var i=gu(8);return i.write_shift(4,n),i.write_shift(4,r),i}(t);break;case 31:case 80:for((r=gu(4+2*(t.length+1)+(t.length%2?0:2))).write_shift(4,t.length+1),r.write_shift(0,t,"dbcs");r.l!=r.length;)r.write_shift(1,0);break;default:throw new Error("TypedPropertyValue unrecognized type "+e+" "+t)}return Cs([n,r])}var jd=["CodePage","Thumbnail","_PID_LINKBASE","_PID_HLINKS","SystemIdentifier","FMTID"];function Pd(e){switch(typeof e){case"boolean":return 11;case"number":return(0|e)==e?3:5;case"string":return 31;case"object":if(e instanceof Date)return 64}return-1}function Dd(e,t,n){var r=gu(8),a=[],i=[],o=8,s=0,l=gu(8),c=gu(8);if(l.write_shift(4,2),l.write_shift(4,1200),c.write_shift(4,1),i.push(l),a.push(c),o+=8+l.length,!t){(c=gu(8)).write_shift(4,0),a.unshift(c);var u=[gu(4)];for(u[0].write_shift(4,e.length),s=0;s<e.length;++s){var d=e[s][0];for((l=gu(8+2*(d.length+1)+(d.length%2?0:2))).write_shift(4,s+2),l.write_shift(4,d.length+1),l.write_shift(0,d,"dbcs");l.l!=l.length;)l.write_shift(1,0);u.push(l)}l=Cs(u),i.unshift(l),o+=8+l.length}for(s=0;s<e.length;++s)if((!t||t[e[s][0]])&&!(jd.indexOf(e[s][0])>-1||Ad.indexOf(e[s][0])>-1)&&null!=e[s][1]){var p=e[s][1],h=0;if(t){var m=n[h=+t[e[s][0]]];if("version"==m.p&&"string"==typeof p){var f=p.split(".");p=(+f[0]<<16)+(+f[1]||0)}l=Rd(m.t,p)}else{var y=Pd(p);-1==y&&(y=31,p=String(p)),l=Rd(y,p)}i.push(l),(c=gu(8)).write_shift(4,t?h:2+s),a.push(c),o+=8+l.length}var g=8*(i.length+1);for(s=0;s<i.length;++s)a[s].write_shift(4,g),g+=i[s].length;return r.write_shift(4,o),r.write_shift(4,i.length),Cs([r].concat(a).concat(i))}function Nd(e,t,n,r,a,i){var o=gu(a?68:48),s=[o];o.write_shift(2,65534),o.write_shift(2,0),o.write_shift(4,842412599),o.write_shift(16,Tl.utils.consts.HEADER_CLSID,"hex"),o.write_shift(4,a?2:1),o.write_shift(16,t,"hex"),o.write_shift(4,a?68:48);var l=Dd(e,n,r);if(s.push(l),a){var c=Dd(a,null,null);o.write_shift(16,i,"hex"),o.write_shift(4,68+l.length),s.push(c)}return Cs(s)}function Ld(e,t){return t||(t=gu(2)),t.write_shift(2,+!!e),t}function Md(e){return e.read_shift(2,"u")}function Fd(e,t){return t||(t=gu(2)),t.write_shift(2,e),t}function Bd(e,t,n){return n||(n=gu(2)),n.write_shift(1,"e"==t?+e:+!!e),n.write_shift(1,"e"==t?1:0),n}function Vd(e,t,n){var r=e.read_shift(n&&n.biff>=12?2:1),a="sbcs-cont";(n&&n.biff,n&&8!=n.biff)?12==n.biff&&(a="wstr"):e.read_shift(1)&&(a="dbcs-cont");return n.biff>=2&&n.biff<=5&&(a="cpstr"),r?e.read_shift(r,a):""}function Ud(e){var t=e.t||"",n=gu(3);n.write_shift(2,t.length),n.write_shift(1,1);var r=gu(2*t.length);return r.write_shift(2*t.length,t,"utf16le"),Cs([n,r])}function Jd(e,t,n){return n||(n=gu(3+2*e.length)),n.write_shift(2,e.length),n.write_shift(1,1),n.write_shift(31,e,"utf16le"),n}function Gd(e,t){t||(t=gu(6+2*e.length)),t.write_shift(4,1+e.length);for(var n=0;n<e.length;++n)t.write_shift(2,e.charCodeAt(n));return t.write_shift(2,0),t}function $d(e){var t=gu(512),n=0,r=e.Target;"file://"==r.slice(0,7)&&(r=r.slice(7));var a=r.indexOf("#"),i=a>-1?31:23;switch(r.charAt(0)){case"#":i=28;break;case".":i&=-3}t.write_shift(4,2),t.write_shift(4,i);var o=[8,6815827,6619237,4849780,83];for(n=0;n<o.length;++n)t.write_shift(4,o[n]);if(28==i)Gd(r=r.slice(1),t);else if(2&i){for(o="e0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),n=0;n<o.length;++n)t.write_shift(1,parseInt(o[n],16));var s=a>-1?r.slice(0,a):r;for(t.write_shift(4,2*(s.length+1)),n=0;n<s.length;++n)t.write_shift(2,s.charCodeAt(n));t.write_shift(2,0),8&i&&Gd(a>-1?r.slice(a+1):"",t)}else{for(o="03 03 00 00 00 00 00 00 c0 00 00 00 00 00 00 46".split(" "),n=0;n<o.length;++n)t.write_shift(1,parseInt(o[n],16));for(var l=0;"../"==r.slice(3*l,3*l+3)||"..\\"==r.slice(3*l,3*l+3);)++l;for(t.write_shift(2,l),t.write_shift(4,r.length-3*l+1),n=0;n<r.length-3*l;++n)t.write_shift(1,255&r.charCodeAt(n+3*l));for(t.write_shift(1,0),t.write_shift(2,65535),t.write_shift(2,57005),n=0;n<6;++n)t.write_shift(4,0)}return t.slice(0,t.l)}function qd(e,t,n,r){return r||(r=gu(6)),r.write_shift(2,e),r.write_shift(2,t),r.write_shift(2,n||0),r}function zd(e,t,n){var r=n.biff>8?4:2;return[e.read_shift(r),e.read_shift(r,"i"),e.read_shift(r,"i")]}function Wd(e){var t=e.read_shift(2),n=e.read_shift(2);return{s:{c:e.read_shift(2),r:t},e:{c:e.read_shift(2),r:n}}}function Yd(e,t){return t||(t=gu(8)),t.write_shift(2,e.s.r),t.write_shift(2,e.e.r),t.write_shift(2,e.s.c),t.write_shift(2,e.e.c),t}function Hd(e,t,n){var r=1536,a=16;switch(n.bookType){case"biff8":case"xla":break;case"biff5":r=1280,a=8;break;case"biff4":r=4,a=6;break;case"biff3":r=3,a=6;break;case"biff2":r=2,a=4;break;default:throw new Error("unsupported BIFF version")}var i=gu(a);return i.write_shift(2,r),i.write_shift(2,t),a>4&&i.write_shift(2,29282),a>6&&i.write_shift(2,1997),a>8&&(i.write_shift(2,49161),i.write_shift(2,1),i.write_shift(2,1798),i.write_shift(2,0)),i}function Qd(e,t){var n=!t||t.biff>=8?2:1,r=gu(8+n*e.name.length);r.write_shift(4,e.pos),r.write_shift(1,e.hs||0),r.write_shift(1,e.dt),r.write_shift(1,e.name.length),t.biff>=8&&r.write_shift(1,1),r.write_shift(n*e.name.length,e.name,t.biff<8?"sbcs":"utf16le");var a=r.slice(0,r.l);return a.l=r.l,a}function Zd(e,t,n,r){var a=n&&5==n.biff;r||(r=gu(a?3+t.length:5+2*t.length)),r.write_shift(2,e),r.write_shift(a?1:2,t.length),a||r.write_shift(1,1),r.write_shift((a?1:2)*t.length,t,a?"sbcs":"utf16le");var i=r.length>r.l?r.slice(0,r.l):r;return null==i.l&&(i.l=i.length),i}function Xd(e,t,n,r){var a=n&&5==n.biff;r||(r=gu(a?16:20)),r.write_shift(2,0),e.style?(r.write_shift(2,e.numFmtId||0),r.write_shift(2,65524)):(r.write_shift(2,e.numFmtId||0),r.write_shift(2,t<<4));var i=0;return e.numFmtId>0&&a&&(i|=1024),r.write_shift(4,i),r.write_shift(4,0),a||r.write_shift(4,0),r.write_shift(2,0),r}function ep(e){var t=gu(24),n=Au(e[0]);t.write_shift(2,n.r),t.write_shift(2,n.r),t.write_shift(2,n.c),t.write_shift(2,n.c);for(var r="d0 c9 ea 79 f9 ba ce 11 8c 82 00 aa 00 4b a9 0b".split(" "),a=0;a<16;++a)t.write_shift(1,parseInt(r[a],16));return Cs([t,$d(e[1])])}function tp(e){var t=e[1].Tooltip,n=gu(10+2*(t.length+1));n.write_shift(2,2048);var r=Au(e[0]);n.write_shift(2,r.r),n.write_shift(2,r.r),n.write_shift(2,r.c),n.write_shift(2,r.c);for(var a=0;a<t.length;++a)n.write_shift(2,t.charCodeAt(a));return n.write_shift(2,0),n}var np=function(){var e={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},t=Rl({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function n(t,n){var r=n||{};r.dateNF||(r.dateNF="yyyymmdd");var a=Lu(function(t,n){var r=[],a=Is(1);switch(n.type){case"base64":a=As(xs(t));break;case"binary":a=As(t);break;case"buffer":case"array":a=t}fu(a,0);var i=a.read_shift(1),o=!!(136&i),s=!1,l=!1;switch(i){case 2:case 3:case 131:case 139:case 245:break;case 48:case 49:s=!0,o=!0;break;case 140:l=!0;break;default:throw new Error("DBF Unsupported Version: "+i.toString(16))}var c=0,u=521;2==i&&(c=a.read_shift(2)),a.l+=3,2!=i&&(c=a.read_shift(4)),c>1048576&&(c=1e6),2!=i&&(u=a.read_shift(2));var d=a.read_shift(2),p=n.codepage||1252;2!=i&&(a.l+=16,a.read_shift(1),0!==a[a.l]&&(p=e[a[a.l]]),a.l+=1,a.l+=2),l&&(a.l+=36);for(var h=[],m={},f=Math.min(a.length,2==i?521:u-10-(s?264:0)),y=l?32:11;a.l<f&&13!=a[a.l];)switch((m={}).name=(void 0).utils.decode(p,a.slice(a.l,a.l+y)).replace(/[\u0000\r\n].*$/g,""),a.l+=y,m.type=String.fromCharCode(a.read_shift(1)),2==i||l||(m.offset=a.read_shift(4)),m.len=a.read_shift(1),2==i&&(m.offset=a.read_shift(2)),m.dec=a.read_shift(1),m.name.length&&h.push(m),2!=i&&(a.l+=l?13:14),m.type){case"B":s&&8==m.len||!n.WTF||console.log("Skipping "+m.name+":"+m.type);break;case"G":case"P":n.WTF&&console.log("Skipping "+m.name+":"+m.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+m.type)}if(13!==a[a.l]&&(a.l=u-1),13!==a.read_shift(1))throw new Error("DBF Terminator not found "+a.l+" "+a[a.l]);a.l=u;var g=0,b=0;for(r[0]=[],b=0;b!=h.length;++b)r[0][b]=h[b].name;for(;c-- >0;)if(42!==a[a.l])for(++a.l,r[++g]=[],b=0,b=0;b!=h.length;++b){var v=a.slice(a.l,a.l+h[b].len);a.l+=h[b].len,fu(v,0);var w=(void 0).utils.decode(p,v);switch(h[b].type){case"C":w.trim().length&&(r[g][b]=w.replace(/\s+$/,""));break;case"D":8===w.length?r[g][b]=new Date(+w.slice(0,4),+w.slice(4,6)-1,+w.slice(6,8)):r[g][b]=w;break;case"F":r[g][b]=parseFloat(w.trim());break;case"+":case"I":r[g][b]=l?2147483648^v.read_shift(-4,"i"):v.read_shift(4,"i");break;case"L":switch(w.trim().toUpperCase()){case"Y":case"T":r[g][b]=!0;break;case"N":case"F":r[g][b]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+w+"|")}break;case"M":if(!o)throw new Error("DBF Unexpected MEMO for type "+i.toString(16));r[g][b]="##MEMO##"+(l?parseInt(w.trim(),10):v.read_shift(4));break;case"N":(w=w.replace(/\u0000/g,"").trim())&&"."!=w&&(r[g][b]=+w||0);break;case"@":r[g][b]=new Date(v.read_shift(-8,"f")-621356832e5);break;case"T":r[g][b]=new Date(864e5*(v.read_shift(4)-2440588)+v.read_shift(4));break;case"Y":r[g][b]=v.read_shift(4,"i")/1e4+v.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":r[g][b]=-v.read_shift(-8,"f");break;case"B":if(s&&8==h[b].len){r[g][b]=v.read_shift(8,"f");break}case"G":case"P":v.l+=h[b].len;break;case"0":if("_NullFlags"===h[b].name)break;default:throw new Error("DBF Unsupported data type "+h[b].type)}}else a.l+=d;if(2!=i&&a.l<a.length&&26!=a[a.l++])throw new Error("DBF EOF Marker missing "+(a.l-1)+" of "+a.length+" "+a[a.l-1].toString(16));return n&&n.sheetRows&&(r=r.slice(0,n.sheetRows)),n.DBF=h,r}(t,r),r);return a["!cols"]=r.DBF.map((function(e){return{wch:e.len,DBF:e}})),delete r.DBF,a}var r={B:8,C:250,L:1,D:8,"?":0,"":0};return{to_workbook:function(e,t){try{return Du(n(e,t),t)}catch(e){if(t&&t.WTF)throw e}return{SheetNames:[],Sheets:{}}},to_sheet:n,from_sheet:function(e,n){var a=n||{};if(+a.codepage>=0&&gs(+a.codepage),"string"==a.type)throw new Error("Cannot write DBF to JS string");var i=bu(),o=pf(e,{header:1,raw:!0,cellDates:!0}),s=o[0],l=o.slice(1),c=e["!cols"]||[],u=0,d=0,p=0,h=1;for(u=0;u<s.length;++u)if(((c[u]||{}).DBF||{}).name)s[u]=c[u].DBF.name,++p;else if(null!=s[u]){if(++p,"number"==typeof s[u]&&(s[u]=s[u].toString(10)),"string"!=typeof s[u])throw new Error("DBF Invalid column name "+s[u]+" |"+typeof s[u]+"|");if(s.indexOf(s[u])!==u)for(d=0;d<1024;++d)if(-1==s.indexOf(s[u]+"_"+d)){s[u]+="_"+d;break}}var m=Ru(e["!ref"]),f=[],y=[],g=[];for(u=0;u<=m.e.c-m.s.c;++u){var b="",v="",w=0,S=[];for(d=0;d<l.length;++d)null!=l[d][u]&&S.push(l[d][u]);if(0!=S.length&&null!=s[u]){for(d=0;d<S.length;++d){switch(typeof S[d]){case"number":v="B";break;case"string":default:v="C";break;case"boolean":v="L";break;case"object":v=S[d]instanceof Date?"D":"C"}w=Math.max(w,String(S[d]).length),b=b&&b!=v?"C":v}w>250&&(w=250),"C"==(v=((c[u]||{}).DBF||{}).type)&&c[u].DBF.len>w&&(w=c[u].DBF.len),"B"==b&&"N"==v&&(b="N",g[u]=c[u].DBF.dec,w=c[u].DBF.len),y[u]="C"==b||"N"==v?w:r[b]||0,h+=y[u],f[u]=b}else f[u]="?"}var E=i.next(32);for(E.write_shift(4,318902576),E.write_shift(4,l.length),E.write_shift(2,296+32*p),E.write_shift(2,h),u=0;u<4;++u)E.write_shift(4,0);for(E.write_shift(4,0|(+t[ms]||3)<<8),u=0,d=0;u<s.length;++u)if(null!=s[u]){var x=i.next(32),_=(s[u].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);x.write_shift(1,_,"sbcs"),x.write_shift(1,"?"==f[u]?"C":f[u],"sbcs"),x.write_shift(4,d),x.write_shift(1,y[u]||r[f[u]]||0),x.write_shift(1,g[u]||0),x.write_shift(1,2),x.write_shift(4,0),x.write_shift(1,0),x.write_shift(4,0),x.write_shift(4,0),d+=y[u]||r[f[u]]||0}var k=i.next(264);for(k.write_shift(4,13),u=0;u<65;++u)k.write_shift(4,0);for(u=0;u<l.length;++u){var I=i.next(h);for(I.write_shift(1,0),d=0;d<s.length;++d)if(null!=s[d])switch(f[d]){case"L":I.write_shift(1,null==l[u][d]?63:l[u][d]?84:70);break;case"B":I.write_shift(8,l[u][d]||0,"f");break;case"N":var T="0";for("number"==typeof l[u][d]&&(T=l[u][d].toFixed(g[d]||0)),p=0;p<y[d]-T.length;++p)I.write_shift(1,32);I.write_shift(1,T,"sbcs");break;case"D":l[u][d]?(I.write_shift(4,("0000"+l[u][d].getFullYear()).slice(-4),"sbcs"),I.write_shift(2,("00"+(l[u][d].getMonth()+1)).slice(-2),"sbcs"),I.write_shift(2,("00"+l[u][d].getDate()).slice(-2),"sbcs")):I.write_shift(8,"00000000","sbcs");break;case"C":var A=String(null!=l[u][d]?l[u][d]:"").slice(0,y[d]);for(I.write_shift(1,A,"sbcs"),p=0;p<y[d]-A.length;++p)I.write_shift(1,32)}}return i.next(1).write_shift(1,26),i.end()}}}(),rp=function(){var e={AA:"À",BA:"Á",CA:"Â",DA:195,HA:"Ä",JA:197,AE:"È",BE:"É",CE:"Ê",HE:"Ë",AI:"Ì",BI:"Í",CI:"Î",HI:"Ï",AO:"Ò",BO:"Ó",CO:"Ô",DO:213,HO:"Ö",AU:"Ù",BU:"Ú",CU:"Û",HU:"Ü",Aa:"à",Ba:"á",Ca:"â",Da:227,Ha:"ä",Ja:229,Ae:"è",Be:"é",Ce:"ê",He:"ë",Ai:"ì",Bi:"í",Ci:"î",Hi:"ï",Ao:"ò",Bo:"ó",Co:"ô",Do:245,Ho:"ö",Au:"ù",Bu:"ú",Cu:"û",Hu:"ü",KC:"Ç",Kc:"ç",q:"æ",z:"œ",a:"Æ",j:"Œ",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},t=new RegExp("N("+Kl(e).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),n=function(t,n){var r=e[n];return"number"==typeof r?ws(r):r},r=function(e,t,n){var r=t.charCodeAt(0)-32<<4|n.charCodeAt(0)-48;return 59==r?e:ws(r)};function a(e,a){var i,o=e.split(/[\n\r]+/),s=-1,l=-1,c=0,u=0,d=[],p=[],h=null,m={},f=[],y=[],g=[],b=0;for(+a.codepage>=0&&gs(+a.codepage);c!==o.length;++c){b=0;var v,w=o[c].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,r).replace(t,n),S=w.replace(/;;/g,"\0").split(";").map((function(e){return e.replace(/\u0000/g,";")})),E=S[0];if(w.length>0)switch(E){case"ID":case"E":case"B":case"O":case"W":break;case"P":"P"==S[1].charAt(0)&&p.push(w.slice(3).replace(/;;/g,";"));break;case"C":var x=!1,_=!1,k=!1,I=!1,T=-1,A=-1;for(u=1;u<S.length;++u)switch(S[u].charAt(0)){case"A":case"G":break;case"X":l=parseInt(S[u].slice(1))-1,_=!0;break;case"Y":for(s=parseInt(S[u].slice(1))-1,_||(l=0),i=d.length;i<=s;++i)d[i]=[];break;case"K":'"'===(v=S[u].slice(1)).charAt(0)?v=v.slice(1,v.length-1):"TRUE"===v?v=!0:"FALSE"===v?v=!1:isNaN(zl(v))?isNaN(Yl(v).getDate())||(v=Jl(v)):(v=zl(v),null!==h&&gl(h)&&(v=Fl(v))),x=!0;break;case"E":I=!0;var O=qp(S[u].slice(1),{r:s,c:l});d[s][l]=[d[s][l],O];break;case"S":k=!0,d[s][l]=[d[s][l],"S5S"];break;case"R":T=parseInt(S[u].slice(1))-1;break;case"C":A=parseInt(S[u].slice(1))-1;break;default:if(a&&a.WTF)throw new Error("SYLK bad record "+w)}if(x&&(d[s][l]&&2==d[s][l].length?d[s][l][0]=v:d[s][l]=v,h=null),k){if(I)throw new Error("SYLK shared formula cannot have own formula");var K=T>-1&&d[T][A];if(!K||!K[1])throw new Error("SYLK shared formula cannot find base");d[s][l][1]=Yp(K[1],{r:s-T,c:l-A})}break;case"F":var C=0;for(u=1;u<S.length;++u)switch(S[u].charAt(0)){case"X":l=parseInt(S[u].slice(1))-1,++C;break;case"Y":for(s=parseInt(S[u].slice(1))-1,i=d.length;i<=s;++i)d[i]=[];break;case"M":b=parseInt(S[u].slice(1))/20;break;case"F":case"G":case"S":case"D":case"N":break;case"P":h=p[parseInt(S[u].slice(1))];break;case"W":for(g=S[u].slice(1).split(" "),i=parseInt(g[0],10);i<=parseInt(g[1],10);++i)b=parseInt(g[2],10),y[i-1]=0===b?{hidden:!0}:{wch:b},vp(y[i-1]);break;case"C":y[l=parseInt(S[u].slice(1))-1]||(y[l]={});break;case"R":f[s=parseInt(S[u].slice(1))-1]||(f[s]={}),b>0?(f[s].hpt=b,f[s].hpx=Sp(b)):0===b&&(f[s].hidden=!0);break;default:if(a&&a.WTF)throw new Error("SYLK bad record "+w)}C<1&&(h=null);break;default:if(a&&a.WTF)throw new Error("SYLK bad record "+w)}}return f.length>0&&(m["!rows"]=f),y.length>0&&(m["!cols"]=y),a&&a.sheetRows&&(d=d.slice(0,a.sheetRows)),[d,m]}function i(e,t){var n=function(e,t){switch(t.type){case"base64":return a(xs(e),t);case"binary":return a(e,t);case"buffer":return a(_s&&Buffer.isBuffer(e)?e.toString("binary"):Ks(e),t);case"array":return a(Gl(e),t)}throw new Error("Unrecognized type "+t.type)}(e,t),r=n[0],i=n[1],o=Lu(r,t);return Kl(i).forEach((function(e){o[e]=i[e]})),o}function o(e,t,n,r){var a="C;Y"+(n+1)+";X"+(r+1)+";K";switch(e.t){case"n":a+=e.v||0,e.f&&!e.F&&(a+=";E"+Wp(e.f,{r:n,c:r}));break;case"b":a+=e.v?"TRUE":"FALSE";break;case"e":a+=e.w||e.v;break;case"d":a+='"'+(e.w||e.v)+'"';break;case"s":a+='"'+e.v.replace(/"/g,"").replace(/;/g,";;")+'"'}return a}return e["|"]=254,{to_workbook:function(e,t){return Du(i(e,t),t)},to_sheet:i,from_sheet:function(e,t){var n,r,a=["ID;PWXL;N;E"],i=[],s=Ru(e["!ref"]),l=Array.isArray(e),c="\r\n";a.push("P;PGeneral"),a.push("F;P0;DG0G8;M255"),e["!cols"]&&(r=a,e["!cols"].forEach((function(e,t){var n="F;W"+(t+1)+" "+(t+1)+" ";e.hidden?n+="0":("number"!=typeof e.width||e.wpx||(e.wpx=yp(e.width)),"number"!=typeof e.wpx||e.wch||(e.wch=gp(e.wpx)),"number"==typeof e.wch&&(n+=Math.round(e.wch)))," "!=n.charAt(n.length-1)&&r.push(n)}))),e["!rows"]&&function(e,t){t.forEach((function(t,n){var r="F;";t.hidden?r+="M0;":t.hpt?r+="M"+20*t.hpt+";":t.hpx&&(r+="M"+20*wp(t.hpx)+";"),r.length>2&&e.push(r+"R"+(n+1))}))}(a,e["!rows"]),a.push("B;Y"+(s.e.r-s.s.r+1)+";X"+(s.e.c-s.s.c+1)+";D"+[s.s.c,s.s.r,s.e.c,s.e.r].join(" "));for(var u=s.s.r;u<=s.e.r;++u)for(var d=s.s.c;d<=s.e.c;++d){var p=Ou({r:u,c:d});(n=l?(e[u]||[])[d]:e[p])&&(null!=n.v||n.f&&!n.F)&&i.push(o(n,0,u,d))}return a.join(c)+c+i.join(c)+c+"E"+c}}}(),ap=function(){function e(e,t){for(var n=e.split("\n"),r=-1,a=-1,i=0,o=[];i!==n.length;++i)if("BOT"!==n[i].trim()){if(!(r<0)){for(var s=n[i].trim().split(","),l=s[0],c=s[1],u=n[++i]||"";1&(u.match(/["]/g)||[]).length&&i<n.length-1;)u+="\n"+n[++i];switch(u=u.trim(),+l){case-1:if("BOT"===u){o[++r]=[],a=0;continue}if("EOD"!==u)throw new Error("Unrecognized DIF special command "+u);break;case 0:"TRUE"===u?o[r][a]=!0:"FALSE"===u?o[r][a]=!1:isNaN(zl(c))?isNaN(Yl(c).getDate())?o[r][a]=c:o[r][a]=Jl(c):o[r][a]=zl(c),++a;break;case 1:(u=(u=u.slice(1,u.length-1)).replace(/""/g,'"'))&&u.match(/^=".*"$/)&&(u=u.slice(2,-1)),o[r][a++]=""!==u?u:null}if("EOD"===u)break}}else o[++r]=[],a=0;return t&&t.sheetRows&&(o=o.slice(0,t.sheetRows)),o}function t(t,n){return Lu(function(t,n){switch(n.type){case"base64":return e(xs(t),n);case"binary":return e(t,n);case"buffer":return e(_s&&Buffer.isBuffer(t)?t.toString("binary"):Ks(t),n);case"array":return e(Gl(t),n)}throw new Error("Unrecognized type "+n.type)}(t,n),n)}var n=function(){var e=function(e,t,n,r,a){e.push(t),e.push(n+","+r),e.push('"'+a.replace(/"/g,'""')+'"')},t=function(e,t,n,r){e.push(t+","+n),e.push(1==t?'"'+r.replace(/"/g,'""')+'"':r)};return function(n){var r,a=[],i=Ru(n["!ref"]),o=Array.isArray(n);e(a,"TABLE",0,1,"sheetjs"),e(a,"VECTORS",0,i.e.r-i.s.r+1,""),e(a,"TUPLES",0,i.e.c-i.s.c+1,""),e(a,"DATA",0,0,"");for(var s=i.s.r;s<=i.e.r;++s){t(a,-1,0,"BOT");for(var l=i.s.c;l<=i.e.c;++l){var c=Ou({r:s,c:l});if(r=o?(n[s]||[])[l]:n[c])switch(r.t){case"n":var u=r.w;u||null==r.v||(u=r.v),null==u?r.f&&!r.F?t(a,1,0,"="+r.f):t(a,1,0,""):t(a,0,u,"V");break;case"b":t(a,0,r.v?1:0,r.v?"TRUE":"FALSE");break;case"s":t(a,1,0,isNaN(r.v)?r.v:'="'+r.v+'"');break;case"d":r.w||(r.w=Sl(r.z||Js[14],Dl(Jl(r.v)))),t(a,0,r.w,"V");break;default:t(a,1,0,"")}else t(a,1,0,"")}}t(a,-1,0,"EOD");return a.join("\r\n")}}();return{to_workbook:function(e,n){return Du(t(e,n),n)},to_sheet:t,from_sheet:n}}(),ip=function(){function e(e){return e.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,"\n")}function t(e){return e.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function n(t,n){return Lu(function(t,n){for(var r=t.split("\n"),a=-1,i=-1,o=0,s=[];o!==r.length;++o){var l=r[o].trim().split(":");if("cell"===l[0]){var c=Au(l[1]);if(s.length<=c.r)for(a=s.length;a<=c.r;++a)s[a]||(s[a]=[]);switch(a=c.r,i=c.c,l[2]){case"t":s[a][i]=e(l[3]);break;case"v":s[a][i]=+l[3];break;case"vtf":var u=l[l.length-1];case"vtc":"nl"===l[3]?s[a][i]=!!+l[4]:s[a][i]=+l[4],"vtf"==l[2]&&(s[a][i]=[s[a][i],u])}}}return n&&n.sheetRows&&(s=s.slice(0,n.sheetRows)),s}(t,n),n)}var r=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join("\n"),a=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join("\n")+"\n",i=["# SocialCalc Spreadsheet Control Save","part:sheet"].join("\n"),o="--SocialCalcSpreadsheetControlSave--";function s(e){if(!e||!e["!ref"])return"";for(var n,r=[],a=[],i="",o=Ku(e["!ref"]),s=Array.isArray(e),l=o.s.r;l<=o.e.r;++l)for(var c=o.s.c;c<=o.e.c;++c)if(i=Ou({r:l,c:c}),(n=s?(e[l]||[])[c]:e[i])&&null!=n.v&&"z"!==n.t){switch(a=["cell",i,"t"],n.t){case"s":case"str":a.push(t(n.v));break;case"n":n.f?(a[2]="vtf",a[3]="n",a[4]=n.v,a[5]=t(n.f)):(a[2]="v",a[3]=n.v);break;case"b":a[2]="vt"+(n.f?"f":"c"),a[3]="nl",a[4]=n.v?"1":"0",a[5]=t(n.f||(n.v?"TRUE":"FALSE"));break;case"d":var u=Dl(Jl(n.v));a[2]="vtc",a[3]="nd",a[4]=""+u,a[5]=n.w||Sl(n.z||Js[14],u);break;case"e":continue}r.push(a.join(":"))}return r.push("sheet:c:"+(o.e.c-o.s.c+1)+":r:"+(o.e.r-o.s.r+1)+":tvf:1"),r.push("valueformat:1:text-wiki"),r.join("\n")}return{to_workbook:function(e,t){return Du(n(e,t),t)},to_sheet:n,from_sheet:function(e){return[r,a,i,a,s(e),o].join("\n")}}}(),op=function(){function e(e,t,n,r,a){a.raw?t[n][r]=e:""===e||("TRUE"===e?t[n][r]=!0:"FALSE"===e?t[n][r]=!1:isNaN(zl(e))?isNaN(Yl(e).getDate())?t[n][r]=e:t[n][r]=Jl(e):t[n][r]=zl(e))}var t={44:",",9:"\t",59:";",124:"|"},n={44:3,9:2,59:1,124:0};function r(e){for(var r={},a=!1,i=0,o=0;i<e.length;++i)34==(o=e.charCodeAt(i))?a=!a:!a&&o in t&&(r[o]=(r[o]||0)+1);for(i in o=[],r)Object.prototype.hasOwnProperty.call(r,i)&&o.push([r[i],i]);if(!o.length)for(i in r=n)Object.prototype.hasOwnProperty.call(r,i)&&o.push([r[i],i]);return o.sort((function(e,t){return e[0]-t[0]||n[e[1]]-n[t[1]]})),t[o.pop()[1]]||44}function a(e,t){var n=t||{},a="",i=n.dense?[]:{},o={s:{c:0,r:0},e:{c:0,r:0}};"sep="==e.slice(0,4)?13==e.charCodeAt(5)&&10==e.charCodeAt(6)?(a=e.charAt(4),e=e.slice(7)):13==e.charCodeAt(5)||10==e.charCodeAt(5)?(a=e.charAt(4),e=e.slice(6)):a=r(e.slice(0,1024)):a=n&&n.FS?n.FS:r(e.slice(0,1024));var s=0,l=0,c=0,u=0,d=0,p=a.charCodeAt(0),h=!1,m=0,f=e.charCodeAt(0);e=e.replace(/\r\n/gm,"\n");var y,g,b=null!=n.dateNF?(y=n.dateNF,g=(g="number"==typeof y?Js[y]:y).replace(kl,"(\\d+)"),new RegExp("^"+g+"$")):null;function v(){var t=e.slice(u,d),r={};if('"'==t.charAt(0)&&'"'==t.charAt(t.length-1)&&(t=t.slice(1,-1).replace(/""/g,'"')),0===t.length)r.t="z";else if(n.raw)r.t="s",r.v=t;else if(0===t.trim().length)r.t="s",r.v=t;else if(61==t.charCodeAt(0))34==t.charCodeAt(1)&&34==t.charCodeAt(t.length-1)?(r.t="s",r.v=t.slice(2,-1).replace(/""/g,'"')):!function(e){return 1!=e.length}(t)?(r.t="s",r.v=t):(r.t="n",r.f=t.slice(1));else if("TRUE"==t)r.t="b",r.v=!0;else if("FALSE"==t)r.t="b",r.v=!1;else if(isNaN(c=zl(t)))if(!isNaN(Yl(t).getDate())||b&&t.match(b)){r.z=n.dateNF||Js[14];var a=0;b&&t.match(b)&&(t=function(e,t,n){var r=-1,a=-1,i=-1,o=-1,s=-1,l=-1;(t.match(kl)||[]).forEach((function(e,t){var c=parseInt(n[t+1],10);switch(e.toLowerCase().charAt(0)){case"y":r=c;break;case"d":i=c;break;case"h":o=c;break;case"s":l=c;break;case"m":o>=0?s=c:a=c}})),l>=0&&-1==s&&a>=0&&(s=a,a=-1);var c=(""+(r>=0?r:(new Date).getFullYear())).slice(-4)+"-"+("00"+(a>=1?a:1)).slice(-2)+"-"+("00"+(i>=1?i:1)).slice(-2);7==c.length&&(c="0"+c),8==c.length&&(c="20"+c);var u=("00"+(o>=0?o:0)).slice(-2)+":"+("00"+(s>=0?s:0)).slice(-2)+":"+("00"+(l>=0?l:0)).slice(-2);return-1==o&&-1==s&&-1==l?c:-1==r&&-1==a&&-1==i?u:c+"T"+u}(0,n.dateNF,t.match(b)||[]),a=1),n.cellDates?(r.t="d",r.v=Jl(t,a)):(r.t="n",r.v=Dl(Jl(t,a))),!1!==n.cellText&&(r.w=Sl(r.z,r.v instanceof Date?Dl(r.v):r.v)),n.cellNF||delete r.z}else r.t="s",r.v=t;else r.t="n",!1!==n.cellText&&(r.w=t),r.v=c;if("z"==r.t||(n.dense?(i[s]||(i[s]=[]),i[s][l]=r):i[Ou({c:l,r:s})]=r),u=d+1,f=e.charCodeAt(u),o.e.c<l&&(o.e.c=l),o.e.r<s&&(o.e.r=s),m==p)++l;else if(l=0,++s,n.sheetRows&&n.sheetRows<=s)return!0}e:for(;d<e.length;++d)switch(m=e.charCodeAt(d)){case 34:34===f&&(h=!h);break;case p:case 10:case 13:if(!h&&v())break e}return d-u>0&&v(),i["!ref"]=Cu(o),i}function i(t,n){return n&&n.PRN?n.FS||"sep="==t.slice(0,4)||t.indexOf("\t")>=0||t.indexOf(",")>=0||t.indexOf(";")>=0?a(t,n):Lu(function(t,n){var r=n||{},a=[];if(!t||0===t.length)return a;for(var i=t.split(/[\r\n]/),o=i.length-1;o>=0&&0===i[o].length;)--o;for(var s=10,l=0,c=0;c<=o;++c)-1==(l=i[c].indexOf(" "))?l=i[c].length:l++,s=Math.max(s,l);for(c=0;c<=o;++c){a[c]=[];var u=0;for(e(i[c].slice(0,s).trim(),a,c,u,r),u=1;u<=(i[c].length-s)/10+1;++u)e(i[c].slice(s+10*(u-1),s+10*u).trim(),a,c,u,r)}return r.sheetRows&&(a=a.slice(0,r.sheetRows)),a}(t,n),n):a(t,n)}function o(e,t){var n="",r="string"==t.type?[0,0,0,0]:function(e,t){var n="";switch((t||{}).type||"base64"){case"buffer":case"array":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];case"base64":n=xs(e.slice(0,12));break;case"binary":n=e;break;default:throw new Error("Unrecognized type "+(t&&t.type||"undefined"))}return[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3),n.charCodeAt(4),n.charCodeAt(5),n.charCodeAt(6),n.charCodeAt(7)]}(e,t);switch(t.type){case"base64":n=xs(e);break;case"binary":case"string":n=e;break;case"buffer":65001==t.codepage?n=e.toString("utf8"):(t.codepage,n=_s&&Buffer.isBuffer(e)?e.toString("binary"):Ks(e));break;case"array":n=Gl(e);break;default:throw new Error("Unrecognized type "+t.type)}return 239==r[0]&&187==r[1]&&191==r[2]?n=cc(n.slice(3)):"string"!=t.type&&"buffer"!=t.type&&65001==t.codepage?n=cc(n):t.type,"socialcalc:version:"==n.slice(0,19)?ip.to_sheet("string"==t.type?n:cc(n),t):i(n,t)}return{to_workbook:function(e,t){return Du(o(e,t),t)},to_sheet:o,from_sheet:function(e){for(var t,n=[],r=Ru(e["!ref"]),a=Array.isArray(e),i=r.s.r;i<=r.e.r;++i){for(var o=[],s=r.s.c;s<=r.e.c;++s){var l=Ou({r:i,c:s});if((t=a?(e[i]||[])[s]:e[l])&&null!=t.v){for(var c=(t.w||(Pu(t),t.w)||"").slice(0,10);c.length<10;)c+=" ";o.push(c+(0===s?" ":""))}else o.push("          ")}n.push(o.join(""))}return n.join("\n")}}}(),sp=function(){function e(e,t,n){if(e){fu(e,e.l||0);for(var r=n.Enum||g;e.l<e.length;){var a=e.read_shift(2),i=r[a]||r[65535],o=e.read_shift(2),s=e.l+o,l=i.f&&i.f(e,o,n);if(e.l=s,t(l,i,a))return}}}function t(t,n){if(!t)return t;var r=n||{},a=r.dense?[]:{},i="Sheet1",o="",s=0,l={},c=[],u=[],d={s:{r:0,c:0},e:{r:0,c:0}},p=r.sheetRows||0;if(0==t[2]&&(8==t[3]||9==t[3])&&t.length>=16&&5==t[14]&&108===t[15])throw new Error("Unsupported Works 3 for Mac file");if(2==t[2])r.Enum=g,e(t,(function(e,t,n){switch(n){case 0:r.vers=e,e>=4096&&(r.qpro=!0);break;case 6:d=e;break;case 204:e&&(o=e);break;case 222:o=e;break;case 15:case 51:r.qpro||(e[1].v=e[1].v.slice(1));case 13:case 14:case 16:14==n&&112==(112&e[2])&&(15&e[2])>1&&(15&e[2])<15&&(e[1].z=r.dateNF||Js[14],r.cellDates&&(e[1].t="d",e[1].v=Fl(e[1].v))),r.qpro&&e[3]>s&&(a["!ref"]=Cu(d),l[i]=a,c.push(i),a=r.dense?[]:{},d={s:{r:0,c:0},e:{r:0,c:0}},s=e[3],i=o||"Sheet"+(s+1),o="");var u=r.dense?(a[e[0].r]||[])[e[0].c]:a[Ou(e[0])];if(u){u.t=e[1].t,u.v=e[1].v,null!=e[1].z&&(u.z=e[1].z),null!=e[1].f&&(u.f=e[1].f);break}r.dense?(a[e[0].r]||(a[e[0].r]=[]),a[e[0].r][e[0].c]=e[1]):a[Ou(e[0])]=e[1]}}),r);else{if(26!=t[2]&&14!=t[2])throw new Error("Unrecognized LOTUS BOF "+t[2]);r.Enum=b,14==t[2]&&(r.qpro=!0,t.l=0),e(t,(function(e,t,n){switch(n){case 204:i=e;break;case 22:e[1].v=e[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(e[3]>s&&(a["!ref"]=Cu(d),l[i]=a,c.push(i),a=r.dense?[]:{},d={s:{r:0,c:0},e:{r:0,c:0}},s=e[3],i="Sheet"+(s+1)),p>0&&e[0].r>=p)break;r.dense?(a[e[0].r]||(a[e[0].r]=[]),a[e[0].r][e[0].c]=e[1]):a[Ou(e[0])]=e[1],d.e.c<e[0].c&&(d.e.c=e[0].c),d.e.r<e[0].r&&(d.e.r=e[0].r);break;case 27:e[14e3]&&(u[e[14e3][0]]=e[14e3][1]);break;case 1537:u[e[0]]=e[1],e[0]==s&&(i=e[1])}}),r)}if(a["!ref"]=Cu(d),l[o||i]=a,c.push(o||i),!u.length)return{SheetNames:c,Sheets:l};for(var h={},m=[],f=0;f<u.length;++f)l[c[f]]?(m.push(u[f]||c[f]),h[u[f]]=l[u[f]]||l[c[f]]):(m.push(u[f]),h[u[f]]={"!ref":"A1"});return{SheetNames:m,Sheets:h}}function n(e,t,n){var r=[{c:0,r:0},{t:"n",v:0},0,0];return n.qpro&&20768!=n.vers?(r[0].c=e.read_shift(1),r[3]=e.read_shift(1),r[0].r=e.read_shift(2),e.l+=2):(r[2]=e.read_shift(1),r[0].c=e.read_shift(2),r[0].r=e.read_shift(2)),r}function r(e,t,r){var a=e.l+t,i=n(e,0,r);if(i[1].t="s",20768==r.vers){e.l++;var o=e.read_shift(1);return i[1].v=e.read_shift(o,"utf8"),i}return r.qpro&&e.l++,i[1].v=e.read_shift(a-e.l,"cstr"),i}function a(e,t,n){var r=gu(7+n.length);r.write_shift(1,255),r.write_shift(2,t),r.write_shift(2,e),r.write_shift(1,39);for(var a=0;a<r.length;++a){var i=n.charCodeAt(a);r.write_shift(1,i>=128?95:i)}return r.write_shift(1,0),r}function i(e,t,n){var r=gu(7);return r.write_shift(1,255),r.write_shift(2,t),r.write_shift(2,e),r.write_shift(2,n,"i"),r}function o(e,t,n){var r=gu(13);return r.write_shift(1,255),r.write_shift(2,t),r.write_shift(2,e),r.write_shift(8,n,"f"),r}function s(e,t,n){var r=32768&t;return t=(r?e:0)+((t&=-32769)>=8192?t-16384:t),(r?"":"$")+(n?Tu(t):ku(t))}var l={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},c=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function u(e){var t=[{c:0,r:0},{t:"n",v:0},0];return t[0].r=e.read_shift(2),t[3]=e[e.l++],t[0].c=e[e.l++],t}function d(e,t,n,r){var a=gu(6+r.length);a.write_shift(2,e),a.write_shift(1,n),a.write_shift(1,t),a.write_shift(1,39);for(var i=0;i<r.length;++i){var o=r.charCodeAt(i);a.write_shift(1,o>=128?95:o)}return a.write_shift(1,0),a}function p(e,t){var n=u(e),r=e.read_shift(4),a=e.read_shift(4),i=e.read_shift(2);if(65535==i)return 0===r&&3221225472===a?(n[1].t="e",n[1].v=15):0===r&&3489660928===a?(n[1].t="e",n[1].v=42):n[1].v=0,n;var o=32768&i;return i=(32767&i)-16446,n[1].v=(1-2*o)*(a*Math.pow(2,i+32)+r*Math.pow(2,i)),n}function h(e,t,n,r){var a=gu(14);if(a.write_shift(2,e),a.write_shift(1,n),a.write_shift(1,t),0==r)return a.write_shift(4,0),a.write_shift(4,0),a.write_shift(2,65535),a;var i,o=0,s=0,l=0;return r<0&&(o=1,r=-r),s=0|Math.log2(r),0==(2147483648&(l=(r/=Math.pow(2,s-31))>>>0))&&(++s,l=(r/=2)>>>0),r-=l,l|=2147483648,l>>>=0,i=(r*=Math.pow(2,32))>>>0,a.write_shift(4,i),a.write_shift(4,l),s+=16383+(o?32768:0),a.write_shift(2,s),a}function m(e,t){var n=u(e),r=e.read_shift(8,"f");return n[1].v=r,n}function f(e,t){return 0==e[e.l+t-1]?e.read_shift(t,"cstr"):""}function y(e,t){var n=gu(5+e.length);n.write_shift(2,14e3),n.write_shift(2,t);for(var r=0;r<e.length;++r){var a=e.charCodeAt(r);n[n.l++]=a>127?95:a}return n[n.l++]=0,n}var g={0:{n:"BOF",f:Md},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:function(e,t,n){var r={s:{c:0,r:0},e:{c:0,r:0}};return 8==t&&n.qpro?(r.s.c=e.read_shift(1),e.l++,r.s.r=e.read_shift(2),r.e.c=e.read_shift(1),e.l++,r.e.r=e.read_shift(2),r):(r.s.c=e.read_shift(2),r.s.r=e.read_shift(2),12==t&&n.qpro&&(e.l+=2),r.e.c=e.read_shift(2),r.e.r=e.read_shift(2),12==t&&n.qpro&&(e.l+=2),65535==r.s.c&&(r.s.c=r.e.c=r.s.r=r.e.r=0),r)}},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:function(e,t,r){var a=n(e,0,r);return a[1].v=e.read_shift(2,"i"),a}},14:{n:"NUMBER",f:function(e,t,r){var a=n(e,0,r);return a[1].v=e.read_shift(8,"f"),a}},15:{n:"LABEL",f:r},16:{n:"FORMULA",f:function(e,t,r){var a=e.l+t,i=n(e,0,r);if(i[1].v=e.read_shift(8,"f"),r.qpro)e.l=a;else{var o=e.read_shift(2);!function(e,t){fu(e,0);var n=[],r=0,a="",i="",o="",u="";for(;e.l<e.length;){var d=e[e.l++];switch(d){case 0:n.push(e.read_shift(8,"f"));break;case 1:i=s(t[0].c,e.read_shift(2),!0),a=s(t[0].r,e.read_shift(2),!1),n.push(i+a);break;case 2:var p=s(t[0].c,e.read_shift(2),!0),h=s(t[0].r,e.read_shift(2),!1);i=s(t[0].c,e.read_shift(2),!0),a=s(t[0].r,e.read_shift(2),!1),n.push(p+h+":"+i+a);break;case 3:if(e.l<e.length)return void console.error("WK1 premature formula end");break;case 4:n.push("("+n.pop()+")");break;case 5:n.push(e.read_shift(2));break;case 6:for(var m="";d=e[e.l++];)m+=String.fromCharCode(d);n.push('"'+m.replace(/"/g,'""')+'"');break;case 8:n.push("-"+n.pop());break;case 23:n.push("+"+n.pop());break;case 22:n.push("NOT("+n.pop()+")");break;case 20:case 21:u=n.pop(),o=n.pop(),n.push(["AND","OR"][d-20]+"("+o+","+u+")");break;default:if(d<32&&c[d])u=n.pop(),o=n.pop(),n.push(o+c[d]+u);else{if(!l[d])return d<=7?console.error("WK1 invalid opcode "+d.toString(16)):d<=24?console.error("WK1 unsupported op "+d.toString(16)):d<=30?console.error("WK1 invalid opcode "+d.toString(16)):d<=115?console.error("WK1 unsupported function opcode "+d.toString(16)):console.error("WK1 unrecognized opcode "+d.toString(16));if(69==(r=l[d][1])&&(r=e[e.l++]),r>n.length)return void console.error("WK1 bad formula parse 0x"+d.toString(16)+":|"+n.join("|")+"|");var f=n.slice(-r);n.length-=r,n.push(l[d][0]+"("+f.join(",")+")")}}}1==n.length?t[1].f=""+n[0]:console.error("WK1 bad formula parse |"+n.join("|")+"|")}(e.slice(e.l,e.l+o),i),e.l+=o}return i}},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:r},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:f},222:{n:"SHEETNAMELP",f:function(e,t){var n=e[e.l++];n>t-1&&(n=t-1);for(var r="";r.length<n;)r+=String.fromCharCode(e[e.l++]);return r}},65535:{n:""}},b={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:function(e,t){var n=u(e);return n[1].t="s",n[1].v=e.read_shift(t-4,"cstr"),n}},23:{n:"NUMBER17",f:p},24:{n:"NUMBER18",f:function(e,t){var n=u(e);n[1].v=e.read_shift(2);var r=n[1].v>>1;if(1&n[1].v)switch(7&r){case 0:r=5e3*(r>>3);break;case 1:r=500*(r>>3);break;case 2:r=(r>>3)/20;break;case 3:r=(r>>3)/200;break;case 4:r=(r>>3)/2e3;break;case 5:r=(r>>3)/2e4;break;case 6:r=(r>>3)/16;break;case 7:r=(r>>3)/64}return n[1].v=r,n}},25:{n:"FORMULA19",f:function(e,t){var n=p(e);return e.l+=t-14,n}},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:function(e,t){for(var n={},r=e.l+t;e.l<r;){var a=e.read_shift(2);if(14e3==a){for(n[a]=[0,""],n[a][0]=e.read_shift(2);e[e.l];)n[a][1]+=String.fromCharCode(e[e.l]),e.l++;e.l++}}return n}},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:function(e,t){var n=u(e),r=e.read_shift(4);return n[1].v=r>>6,n}},38:{n:"??"},39:{n:"NUMBER27",f:m},40:{n:"FORMULA28",f:function(e,t){var n=m(e);return e.l+=t-10,n}},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:f},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:function(e,t,n){if(n.qpro&&!(t<21)){var r=e.read_shift(1);return e.l+=17,e.l+=1,e.l+=2,[r,e.read_shift(t-21,"cstr")]}}},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:function(e,t){var n=t||{};if(+n.codepage>=0&&gs(+n.codepage),"string"==n.type)throw new Error("Cannot write WK1 to JS string");var r,s,l=bu(),c=Ru(e["!ref"]),u=Array.isArray(e),d=[];Em(l,0,(r=1030,(s=gu(2)).write_shift(2,r),s)),Em(l,6,function(e){var t=gu(8);return t.write_shift(2,e.s.c),t.write_shift(2,e.s.r),t.write_shift(2,e.e.c),t.write_shift(2,e.e.r),t}(c));for(var p=Math.min(c.e.r,8191),h=c.s.r;h<=p;++h)for(var m=ku(h),f=c.s.c;f<=c.e.c;++f){h===c.s.r&&(d[f]=Tu(f));var y=d[f]+m,g=u?(e[h]||[])[f]:e[y];if(g&&"z"!=g.t)if("n"==g.t)(0|g.v)==g.v&&g.v>=-32768&&g.v<=32767?Em(l,13,i(h,f,g.v)):Em(l,14,o(h,f,g.v));else Em(l,15,a(h,f,Pu(g).slice(0,239)))}return Em(l,1),l.end()},book_to_wk3:function(e,t){var n=t||{};if(+n.codepage>=0&&gs(+n.codepage),"string"==n.type)throw new Error("Cannot write WK3 to JS string");var r=bu();Em(r,0,function(e){var t=gu(26);t.write_shift(2,4096),t.write_shift(2,4),t.write_shift(4,0);for(var n=0,r=0,a=0,i=0;i<e.SheetNames.length;++i){var o=e.SheetNames[i],s=e.Sheets[o];if(s&&s["!ref"]){++a;var l=Ku(s["!ref"]);n<l.e.r&&(n=l.e.r),r<l.e.c&&(r=l.e.c)}}n>8191&&(n=8191);return t.write_shift(2,n),t.write_shift(1,a),t.write_shift(1,r),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(1,1),t.write_shift(1,2),t.write_shift(4,0),t.write_shift(4,0),t}(e));for(var a=0,i=0;a<e.SheetNames.length;++a)(e.Sheets[e.SheetNames[a]]||{})["!ref"]&&Em(r,27,y(e.SheetNames[a],i++));var o=0;for(a=0;a<e.SheetNames.length;++a){var s=e.Sheets[e.SheetNames[a]];if(s&&s["!ref"]){for(var l=Ru(s["!ref"]),c=Array.isArray(s),u=[],p=Math.min(l.e.r,8191),m=l.s.r;m<=p;++m)for(var f=ku(m),g=l.s.c;g<=l.e.c;++g){m===l.s.r&&(u[g]=Tu(g));var b=u[g]+f,v=c?(s[m]||[])[g]:s[b];if(v&&"z"!=v.t)if("n"==v.t)Em(r,23,h(m,g,o,v.v));else Em(r,22,d(m,g,o,Pu(v).slice(0,239)))}++o}}return Em(r,1),r.end()},to_workbook:function(e,n){switch(n.type){case"base64":return t(As(xs(e)),n);case"binary":return t(As(e),n);case"buffer":case"array":return t(e,n)}throw"Unsupported type "+n.type}}}(),lp=/^\s|\s$|[\t\n\r]/;function cp(e,t){if(!t.bookSST)return"";var n=[Zl];n[n.length]=fc("sst",null,{xmlns:Kc[0],count:e.Count,uniqueCount:e.Unique});for(var r=0;r!=e.length;++r)if(null!=e[r]){var a=e[r],i="<si>";a.r?i+=a.r:(i+="<t",a.t||(a.t=""),a.t.match(lp)&&(i+=' xml:space="preserve"'),i+=">"+nc(a.t)+"</t>"),i+="</si>",n[n.length]=i}return n.length>2&&(n[n.length]="</sst>",n[1]=n[1].replace("/>",">")),n.join("")}var up=function(e,t){var n=!1;return null==t&&(n=!0,t=gu(15+4*e.t.length)),t.write_shift(1,0),Bu(e.t,t),n?t.slice(0,t.l):t};function dp(e){var t=bu();vu(t,159,function(e,t){return t||(t=gu(8)),t.write_shift(4,e.Count),t.write_shift(4,e.Unique),t}(e));for(var n=0;n<e.length;++n)vu(t,19,up(e[n]));return vu(t,160),t.end()}function pp(e){var t,n,r=0,a=function(e){for(var t=[],n=e.split(""),r=0;r<n.length;++r)t[r]=n[r].charCodeAt(0);return t}(e),i=a.length+1;for((t=Is(i))[0]=a.length,n=1;n!=i;++n)t[n]=a[n-1];for(n=i-1;n>=0;--n)r=((0==(16384&r)?0:1)|r<<1&32767)^t[n];return 52811^r}var hp=function(){function e(e,n){switch(n.type){case"base64":return t(xs(e),n);case"binary":return t(e,n);case"buffer":return t(_s&&Buffer.isBuffer(e)?e.toString("binary"):Ks(e),n);case"array":return t(Gl(e),n)}throw new Error("Unrecognized type "+n.type)}function t(e,t){var n=(t||{}).dense?[]:{},r=e.match(/\\trowd.*?\\row\b/g);if(!r.length)throw new Error("RTF missing table");var a={s:{c:0,r:0},e:{c:0,r:r.length-1}};return r.forEach((function(e,t){Array.isArray(n)&&(n[t]=[]);for(var r,i=/\\\w+\b/g,o=0,s=-1;r=i.exec(e);){if("\\cell"===r[0]){var l=e.slice(o,i.lastIndex-r[0].length);if(" "==l[0]&&(l=l.slice(1)),++s,l.length){var c={v:l,t:"s"};Array.isArray(n)?n[t][s]=c:n[Ou({r:t,c:s})]=c}}o=i.lastIndex}s>a.e.c&&(a.e.c=s)})),n["!ref"]=Cu(a),n}return{to_workbook:function(t,n){return Du(e(t,n),n)},to_sheet:e,from_sheet:function(e){for(var t,n=["{\\rtf1\\ansi"],r=Ru(e["!ref"]),a=Array.isArray(e),i=r.s.r;i<=r.e.r;++i){n.push("\\trowd\\trautofit1");for(var o=r.s.c;o<=r.e.c;++o)n.push("\\cellx"+(o+1));for(n.push("\\pard\\intbl"),o=r.s.c;o<=r.e.c;++o){var s=Ou({r:i,c:o});(t=a?(e[i]||[])[o]:e[s])&&(null!=t.v||t.f&&!t.F)&&(n.push(" "+(t.w||(Pu(t),t.w))),n.push("\\cell"))}n.push("\\pard\\intbl\\row")}return n.join("")+"}"}}}();function mp(e){for(var t=0,n=1;3!=t;++t)n=256*n+(e[t]>255?255:e[t]<0?0:e[t]);return n.toString(16).toUpperCase().slice(1)}var fp=6;function yp(e){return Math.floor((e+Math.round(128/fp)/256)*fp)}function gp(e){return Math.floor((e-5)/fp*100+.5)/100}function bp(e){return Math.round((e*fp+5)/fp*256)/256}function vp(e){e.width?(e.wpx=yp(e.width),e.wch=gp(e.wpx),e.MDW=fp):e.wpx?(e.wch=gp(e.wpx),e.width=bp(e.wch),e.MDW=fp):"number"==typeof e.wch&&(e.width=bp(e.wch),e.wpx=yp(e.width),e.MDW=fp),e.customWidth&&delete e.customWidth}function wp(e){return 96*e/96}function Sp(e){return 96*e/96}function Ep(e,t){var n,r=[Zl,fc("styleSheet",null,{xmlns:Kc[0],"xmlns:vt":Tc})];return e.SSF&&null!=(n=function(e){var t=["<numFmts>"];return[[5,8],[23,26],[41,44],[50,392]].forEach((function(n){for(var r=n[0];r<=n[1];++r)null!=e[r]&&(t[t.length]=fc("numFmt",null,{numFmtId:r,formatCode:nc(e[r])}))})),1===t.length?"":(t[t.length]="</numFmts>",t[0]=fc("numFmts",null,{count:t.length-2}).replace("/>",">"),t.join(""))}(e.SSF))&&(r[r.length]=n),r[r.length]='<fonts count="1"><font><sz val="12"/><color theme="1"/><name val="Calibri"/><family val="2"/><scheme val="minor"/></font></fonts>',r[r.length]='<fills count="2"><fill><patternFill patternType="none"/></fill><fill><patternFill patternType="gray125"/></fill></fills>',r[r.length]='<borders count="1"><border><left/><right/><top/><bottom/><diagonal/></border></borders>',r[r.length]='<cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0"/></cellStyleXfs>',(n=function(e){var t=[];return t[t.length]=fc("cellXfs",null),e.forEach((function(e){t[t.length]=fc("xf",null,e)})),t[t.length]="</cellXfs>",2===t.length?"":(t[0]=fc("cellXfs",null,{count:t.length-2}).replace("/>",">"),t.join(""))}(t.cellXfs))&&(r[r.length]=n),r[r.length]='<cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0"/></cellStyles>',r[r.length]='<dxfs count="0"/>',r[r.length]='<tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4"/>',r.length>2&&(r[r.length]="</styleSheet>",r[1]=r[1].replace("/>",">")),r.join("")}function xp(e,t,n){n||(n=gu(6+4*t.length)),n.write_shift(2,e),Bu(t,n);var r=n.length>n.l?n.slice(0,n.l):n;return null==n.l&&(n.l=n.length),r}function _p(e,t){t||(t=gu(153)),t.write_shift(2,20*e.sz),function(e,t){t||(t=gu(2));var n=(e.italic?2:0)|(e.strike?8:0)|(e.outline?16:0)|(e.shadow?32:0)|(e.condense?64:0)|(e.extend?128:0);t.write_shift(1,n),t.write_shift(1,0)}(e,t),t.write_shift(2,e.bold?700:400);var n=0;"superscript"==e.vertAlign?n=1:"subscript"==e.vertAlign&&(n=2),t.write_shift(2,n),t.write_shift(1,e.underline||0),t.write_shift(1,e.family||0),t.write_shift(1,e.charset||0),t.write_shift(1,0),cd(e.color,t);var r=0;return"major"==e.scheme&&(r=1),"minor"==e.scheme&&(r=2),t.write_shift(1,r),Bu(e.name,t),t.length>t.l?t.slice(0,t.l):t}var kp,Ip=["none","solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"],Tp=yu;function Ap(e,t){t||(t=gu(84)),kp||(kp=Rl(Ip));var n=kp[e.patternType];null==n&&(n=40),t.write_shift(4,n);var r=0;if(40!=n)for(cd({auto:1},t),cd({auto:1},t);r<12;++r)t.write_shift(4,0);else{for(;r<4;++r)t.write_shift(4,0);for(;r<12;++r)t.write_shift(4,0)}return t.length>t.l?t.slice(0,t.l):t}function Op(e,t,n){n||(n=gu(16)),n.write_shift(2,t||0),n.write_shift(2,e.numFmtId||0),n.write_shift(2,0),n.write_shift(2,0),n.write_shift(2,0),n.write_shift(1,0),n.write_shift(1,0);return n.write_shift(1,0),n.write_shift(1,0),n.write_shift(1,0),n.write_shift(1,0),n}function Kp(e,t){return t||(t=gu(10)),t.write_shift(1,0),t.write_shift(1,0),t.write_shift(4,0),t.write_shift(4,0),t}var Cp=yu;function Rp(e){var t;vu(e,613,Mu(1)),vu(e,46,(t||(t=gu(51)),t.write_shift(1,0),Kp(0,t),Kp(0,t),Kp(0,t),Kp(0,t),Kp(0,t),t.length>t.l?t.slice(0,t.l):t)),vu(e,614)}function jp(e){var t,n;vu(e,619,Mu(1)),vu(e,48,(t={xfId:0,builtinId:0,name:"Normal"},n||(n=gu(52)),n.write_shift(4,t.xfId),n.write_shift(2,1),n.write_shift(1,+t.builtinId),n.write_shift(1,0),Zu(t.name||"",n),n.length>n.l?n.slice(0,n.l):n)),vu(e,620)}function Pp(e){vu(e,508,function(e,t,n){var r=gu(2052);return r.write_shift(4,e),Zu(t,r),Zu(n,r),r.length>r.l?r.slice(0,r.l):r}(0,"TableStyleMedium9","PivotStyleMedium4")),vu(e,509)}function Dp(e,t){var n=bu();return vu(n,278),function(e,t){if(t){var n=0;[[5,8],[23,26],[41,44],[50,392]].forEach((function(e){for(var r=e[0];r<=e[1];++r)null!=t[r]&&++n})),0!=n&&(vu(e,615,Mu(n)),[[5,8],[23,26],[41,44],[50,392]].forEach((function(n){for(var r=n[0];r<=n[1];++r)null!=t[r]&&vu(e,44,xp(r,t[r]))})),vu(e,616))}}(n,e.SSF),function(e){vu(e,611,Mu(1)),vu(e,43,_p({sz:12,color:{theme:1},name:"Calibri",family:2,scheme:"minor"})),vu(e,612)}(n),function(e){vu(e,603,Mu(2)),vu(e,45,Ap({patternType:"none"})),vu(e,45,Ap({patternType:"gray125"})),vu(e,604)}(n),Rp(n),function(e){vu(e,626,Mu(1)),vu(e,47,Op({numFmtId:0,fontId:0,fillId:0,borderId:0},65535)),vu(e,627)}(n),function(e,t){vu(e,617,Mu(t.length)),t.forEach((function(t){vu(e,47,Op(t,0))})),vu(e,618)}(n,t.cellXfs),jp(n),function(e){vu(e,505,Mu(0)),vu(e,506)}(n),Pp(n),vu(n,279),n.end()}function Np(e,t){if(t&&t.themeXLSX)return t.themeXLSX;if(e&&"string"==typeof e.raw)return e.raw;var n=[Zl];return n[n.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',n[n.length]="<a:themeElements>",n[n.length]='<a:clrScheme name="Office">',n[n.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',n[n.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',n[n.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',n[n.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',n[n.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',n[n.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',n[n.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',n[n.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',n[n.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',n[n.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',n[n.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',n[n.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',n[n.length]="</a:clrScheme>",n[n.length]='<a:fontScheme name="Office">',n[n.length]="<a:majorFont>",n[n.length]='<a:latin typeface="Cambria"/>',n[n.length]='<a:ea typeface=""/>',n[n.length]='<a:cs typeface=""/>',n[n.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',n[n.length]='<a:font script="Hang" typeface="맑은 고딕"/>',n[n.length]='<a:font script="Hans" typeface="宋体"/>',n[n.length]='<a:font script="Hant" typeface="新細明體"/>',n[n.length]='<a:font script="Arab" typeface="Times New Roman"/>',n[n.length]='<a:font script="Hebr" typeface="Times New Roman"/>',n[n.length]='<a:font script="Thai" typeface="Tahoma"/>',n[n.length]='<a:font script="Ethi" typeface="Nyala"/>',n[n.length]='<a:font script="Beng" typeface="Vrinda"/>',n[n.length]='<a:font script="Gujr" typeface="Shruti"/>',n[n.length]='<a:font script="Khmr" typeface="MoolBoran"/>',n[n.length]='<a:font script="Knda" typeface="Tunga"/>',n[n.length]='<a:font script="Guru" typeface="Raavi"/>',n[n.length]='<a:font script="Cans" typeface="Euphemia"/>',n[n.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',n[n.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',n[n.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',n[n.length]='<a:font script="Thaa" typeface="MV Boli"/>',n[n.length]='<a:font script="Deva" typeface="Mangal"/>',n[n.length]='<a:font script="Telu" typeface="Gautami"/>',n[n.length]='<a:font script="Taml" typeface="Latha"/>',n[n.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',n[n.length]='<a:font script="Orya" typeface="Kalinga"/>',n[n.length]='<a:font script="Mlym" typeface="Kartika"/>',n[n.length]='<a:font script="Laoo" typeface="DokChampa"/>',n[n.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',n[n.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',n[n.length]='<a:font script="Viet" typeface="Times New Roman"/>',n[n.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',n[n.length]='<a:font script="Geor" typeface="Sylfaen"/>',n[n.length]="</a:majorFont>",n[n.length]="<a:minorFont>",n[n.length]='<a:latin typeface="Calibri"/>',n[n.length]='<a:ea typeface=""/>',n[n.length]='<a:cs typeface=""/>',n[n.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',n[n.length]='<a:font script="Hang" typeface="맑은 고딕"/>',n[n.length]='<a:font script="Hans" typeface="宋体"/>',n[n.length]='<a:font script="Hant" typeface="新細明體"/>',n[n.length]='<a:font script="Arab" typeface="Arial"/>',n[n.length]='<a:font script="Hebr" typeface="Arial"/>',n[n.length]='<a:font script="Thai" typeface="Tahoma"/>',n[n.length]='<a:font script="Ethi" typeface="Nyala"/>',n[n.length]='<a:font script="Beng" typeface="Vrinda"/>',n[n.length]='<a:font script="Gujr" typeface="Shruti"/>',n[n.length]='<a:font script="Khmr" typeface="DaunPenh"/>',n[n.length]='<a:font script="Knda" typeface="Tunga"/>',n[n.length]='<a:font script="Guru" typeface="Raavi"/>',n[n.length]='<a:font script="Cans" typeface="Euphemia"/>',n[n.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',n[n.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',n[n.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',n[n.length]='<a:font script="Thaa" typeface="MV Boli"/>',n[n.length]='<a:font script="Deva" typeface="Mangal"/>',n[n.length]='<a:font script="Telu" typeface="Gautami"/>',n[n.length]='<a:font script="Taml" typeface="Latha"/>',n[n.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',n[n.length]='<a:font script="Orya" typeface="Kalinga"/>',n[n.length]='<a:font script="Mlym" typeface="Kartika"/>',n[n.length]='<a:font script="Laoo" typeface="DokChampa"/>',n[n.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',n[n.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',n[n.length]='<a:font script="Viet" typeface="Arial"/>',n[n.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',n[n.length]='<a:font script="Geor" typeface="Sylfaen"/>',n[n.length]="</a:minorFont>",n[n.length]="</a:fontScheme>",n[n.length]='<a:fmtScheme name="Office">',n[n.length]="<a:fillStyleLst>",n[n.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',n[n.length]='<a:gradFill rotWithShape="1">',n[n.length]="<a:gsLst>",n[n.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',n[n.length]="</a:gsLst>",n[n.length]='<a:lin ang="16200000" scaled="1"/>',n[n.length]="</a:gradFill>",n[n.length]='<a:gradFill rotWithShape="1">',n[n.length]="<a:gsLst>",n[n.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',n[n.length]="</a:gsLst>",n[n.length]='<a:lin ang="16200000" scaled="0"/>',n[n.length]="</a:gradFill>",n[n.length]="</a:fillStyleLst>",n[n.length]="<a:lnStyleLst>",n[n.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',n[n.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',n[n.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',n[n.length]="</a:lnStyleLst>",n[n.length]="<a:effectStyleLst>",n[n.length]="<a:effectStyle>",n[n.length]="<a:effectLst>",n[n.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',n[n.length]="</a:effectLst>",n[n.length]="</a:effectStyle>",n[n.length]="<a:effectStyle>",n[n.length]="<a:effectLst>",n[n.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',n[n.length]="</a:effectLst>",n[n.length]="</a:effectStyle>",n[n.length]="<a:effectStyle>",n[n.length]="<a:effectLst>",n[n.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',n[n.length]="</a:effectLst>",n[n.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',n[n.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',n[n.length]="</a:effectStyle>",n[n.length]="</a:effectStyleLst>",n[n.length]="<a:bgFillStyleLst>",n[n.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',n[n.length]='<a:gradFill rotWithShape="1">',n[n.length]="<a:gsLst>",n[n.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',n[n.length]="</a:gsLst>",n[n.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',n[n.length]="</a:gradFill>",n[n.length]='<a:gradFill rotWithShape="1">',n[n.length]="<a:gsLst>",n[n.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',n[n.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',n[n.length]="</a:gsLst>",n[n.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',n[n.length]="</a:gradFill>",n[n.length]="</a:bgFillStyleLst>",n[n.length]="</a:fmtScheme>",n[n.length]="</a:themeElements>",n[n.length]="<a:objectDefaults>",n[n.length]="<a:spDef>",n[n.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',n[n.length]="</a:spDef>",n[n.length]="<a:lnDef>",n[n.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',n[n.length]="</a:lnDef>",n[n.length]="</a:objectDefaults>",n[n.length]="<a:extraClrSchemeLst/>",n[n.length]="</a:theme>",n.join("")}function Lp(){var e,t,n,r=bu();return vu(r,332),vu(r,334,Mu(1)),vu(r,335,function(e){var t=gu(12+2*e.name.length);return t.write_shift(4,e.flags),t.write_shift(4,e.version),Bu(e.name,t),t.slice(0,t.l)}({name:"XLDAPR",version:12e4,flags:3496657072})),vu(r,336),vu(r,339,(e=1,(n=gu(8+2*(t="XLDAPR").length)).write_shift(4,e),Bu(t,n),n.slice(0,n.l))),vu(r,52),vu(r,35,Mu(514)),vu(r,4096,Mu(0)),vu(r,4097,Fd(1)),vu(r,36),vu(r,53),vu(r,340),vu(r,337,function(e,t){var n=gu(8);return n.write_shift(4,e),n.write_shift(4,t?1:0),n}(1,!0)),vu(r,51,function(e){var t=gu(4+8*e.length);t.write_shift(4,e.length);for(var n=0;n<e.length;++n)t.write_shift(4,e[n][0]),t.write_shift(4,e[n][1]);return t}([[1,0]])),vu(r,338),vu(r,333),r.end()}function Mp(){var e=[Zl];return e.push('<metadata xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:xlrd="http://schemas.microsoft.com/office/spreadsheetml/2017/richdata" xmlns:xda="http://schemas.microsoft.com/office/spreadsheetml/2017/dynamicarray">\n  <metadataTypes count="1">\n    <metadataType name="XLDAPR" minSupportedVersion="120000" copy="1" pasteAll="1" pasteValues="1" merge="1" splitFirst="1" rowColShift="1" clearFormats="1" clearComments="1" assign="1" coerce="1" cellMeta="1"/>\n  </metadataTypes>\n  <futureMetadata name="XLDAPR" count="1">\n    <bk>\n      <extLst>\n        <ext uri="{bdbb8cdc-fa1e-496e-a857-3c3f30c029c3}">\n          <xda:dynamicArrayProperties fDynamic="1" fCollapsed="0"/>\n        </ext>\n      </extLst>\n    </bk>\n  </futureMetadata>\n  <cellMetadata count="1">\n    <bk>\n      <rc t="1" v="0"/>\n    </bk>\n  </cellMetadata>\n</metadata>'),e.join("")}var Fp=1024;function Bp(e,t){for(var n=[21600,21600],r=["m0,0l0",n[1],n[0],n[1],n[0],"0xe"].join(","),a=[fc("xml",null,{"xmlns:v":Nc,"xmlns:o":Cc,"xmlns:x":Rc,"xmlns:mv":Dc}).replace(/\/>/,">"),fc("o:shapelayout",fc("o:idmap",null,{"v:ext":"edit",data:e}),{"v:ext":"edit"}),fc("v:shapetype",[fc("v:stroke",null,{joinstyle:"miter"}),fc("v:path",null,{gradientshapeok:"t","o:connecttype":"rect"})].join(""),{id:"_x0000_t202","o:spt":202,coordsize:n.join(","),path:r})];Fp<1e3*e;)Fp+=1e3;return t.forEach((function(e){var t=Au(e[0]),n={color2:"#BEFF82",type:"gradient"};"gradient"==n.type&&(n.angle="-180");var r="gradient"==n.type?fc("o:fill",null,{type:"gradientUnscaled","v:ext":"view"}):null,i=fc("v:fill",r,n);++Fp,a=a.concat(["<v:shape"+mc({id:"_x0000_s"+Fp,type:"#_x0000_t202",style:"position:absolute; margin-left:80pt;margin-top:5pt;width:104pt;height:64pt;z-index:10"+(e[1].hidden?";visibility:hidden":""),fillcolor:"#ECFAD4",strokecolor:"#edeaa1"})+">",i,fc("v:shadow",null,{on:"t",obscured:"t"}),fc("v:path",null,{"o:connecttype":"none"}),'<v:textbox><div style="text-align:left"></div></v:textbox>','<x:ClientData ObjectType="Note">',"<x:MoveWithCells/>","<x:SizeWithCells/>",hc("x:Anchor",[t.c+1,0,t.r+1,0,t.c+3,20,t.r+5,20].join(",")),hc("x:AutoFill","False"),hc("x:Row",String(t.r)),hc("x:Column",String(t.c)),e[1].hidden?"":"<x:Visible/>","</x:ClientData>","</v:shape>"])})),a.push("</xml>"),a.join("")}function Vp(e){var t=[Zl,fc("comments",null,{xmlns:Kc[0]})],n=[];return t.push("<authors>"),e.forEach((function(e){e[1].forEach((function(e){var r=nc(e.a);-1==n.indexOf(r)&&(n.push(r),t.push("<author>"+r+"</author>")),e.T&&e.ID&&-1==n.indexOf("tc="+e.ID)&&(n.push("tc="+e.ID),t.push("<author>tc="+e.ID+"</author>"))}))})),0==n.length&&(n.push("SheetJ5"),t.push("<author>SheetJ5</author>")),t.push("</authors>"),t.push("<commentList>"),e.forEach((function(e){var r=0,a=[];if(e[1][0]&&e[1][0].T&&e[1][0].ID?r=n.indexOf("tc="+e[1][0].ID):e[1].forEach((function(e){e.a&&(r=n.indexOf(nc(e.a))),a.push(e.t||"")})),t.push('<comment ref="'+e[0]+'" authorId="'+r+'"><text>'),a.length<=1)t.push(hc("t",nc(a[0]||"")));else{for(var i="Comment:\n    "+a[0]+"\n",o=1;o<a.length;++o)i+="Reply:\n    "+a[o]+"\n";t.push(hc("t",nc(i)))}t.push("</text></comment>")})),t.push("</commentList>"),t.length>2&&(t[t.length]="</comments>",t[1]=t[1].replace("/>",">")),t.join("")}function Up(e,t,n){var r=[Zl,fc("ThreadedComments",null,{xmlns:Ec}).replace(/[\/]>/,">")];return e.forEach((function(e){var a="";(e[1]||[]).forEach((function(i,o){if(i.T){i.a&&-1==t.indexOf(i.a)&&t.push(i.a);var s={ref:e[0],id:"{54EE7951-7262-4200-6969-"+("000000000000"+n.tcid++).slice(-12)+"}"};0==o?a=s.id:s.parentId=a,i.ID=s.id,i.a&&(s.personId="{54EE7950-7262-4200-6969-"+("000000000000"+t.indexOf(i.a)).slice(-12)+"}"),r.push(fc("threadedComment",hc("text",i.t||""),s))}else delete i.ID}))})),r.push("</ThreadedComments>"),r.join("")}var Jp=Fu;function Gp(e){var t=bu(),n=[];return vu(t,628),vu(t,630),e.forEach((function(e){e[1].forEach((function(e){n.indexOf(e.a)>-1||(n.push(e.a.slice(0,54)),vu(t,632,function(e){return Bu(e.slice(0,54))}(e.a)))}))})),vu(t,631),vu(t,633),e.forEach((function(e){e[1].forEach((function(r){r.iauthor=n.indexOf(r.a);var a={s:Au(e[0]),e:Au(e[0])};vu(t,635,function(e,t){return null==t&&(t=gu(36)),t.write_shift(4,e[1].iauthor),od(e[0],t),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t.write_shift(4,0),t}([a,r])),r.t&&r.t.length>0&&vu(t,637,Gu(r)),vu(t,636),delete r.iauthor}))})),vu(t,634),vu(t,629),t.end()}var $p=["xlsb","xlsm","xlam","biff8","xla"],qp=function(){var e=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,t={r:0,c:0};function n(e,n,r,a){var i=!1,o=!1;0==r.length?o=!0:"["==r.charAt(0)&&(o=!0,r=r.slice(1,-1)),0==a.length?i=!0:"["==a.charAt(0)&&(i=!0,a=a.slice(1,-1));var s=r.length>0?0|parseInt(r,10):0,l=a.length>0?0|parseInt(a,10):0;return i?l+=t.c:--l,o?s+=t.r:--s,n+(i?"":"$")+Tu(l)+(o?"":"$")+ku(s)}return function(r,a){return t=a,r.replace(e,n)}}(),zp=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,Wp=function(){return function(e,t){return e.replace(zp,(function(e,n,r,a,i,o){var s=Iu(a)-(r?0:t.c),l=_u(o)-(i?0:t.r);return n+"R"+(0==l?"":i?l+1:"["+l+"]")+"C"+(0==s?"":r?s+1:"["+s+"]")}))}}();function Yp(e,t){return e.replace(zp,(function(e,n,r,a,i,o){return n+("$"==r?r+a:Tu(Iu(a)+t.c))+("$"==i?i+o:ku(_u(o)+t.r))}))}function Hp(e){e.l+=1}function Qp(e,t){var n=e.read_shift(1==t?1:2);return[16383&n,n>>14&1,n>>15&1]}function Zp(e,t,n){var r=2;if(n){if(n.biff>=2&&n.biff<=5)return Xp(e);12==n.biff&&(r=4)}var a=e.read_shift(r),i=e.read_shift(r),o=Qp(e,2),s=Qp(e,2);return{s:{r:a,c:o[0],cRel:o[1],rRel:o[2]},e:{r:i,c:s[0],cRel:s[1],rRel:s[2]}}}function Xp(e){var t=Qp(e,2),n=Qp(e,2),r=e.read_shift(1),a=e.read_shift(1);return{s:{r:t[0],c:r,cRel:t[1],rRel:t[2]},e:{r:n[0],c:a,cRel:n[1],rRel:n[2]}}}function eh(e,t,n){if(n&&n.biff>=2&&n.biff<=5)return function(e){var t=Qp(e,2),n=e.read_shift(1);return{r:t[0],c:n,cRel:t[1],rRel:t[2]}}(e);var r=e.read_shift(n&&12==n.biff?4:2),a=Qp(e,2);return{r:r,c:a[0],cRel:a[1],rRel:a[2]}}function th(e){var t=e.read_shift(2),n=e.read_shift(2);return{r:t,c:255&n,fQuoted:!!(16384&n),cRel:n>>15,rRel:n>>15}}function nh(e){var t=1&e[e.l+1];return e.l+=4,[t,1]}function rh(e){return[e.read_shift(1),e.read_shift(1)]}function ah(e,t){var n=[e.read_shift(1)];if(12==t)switch(n[0]){case 2:n[0]=4;break;case 4:n[0]=16;break;case 0:n[0]=1;break;case 1:n[0]=2}switch(n[0]){case 4:n[1]=function(e,t){return 1===e.read_shift(t)}(e,1)?"TRUE":"FALSE",12!=t&&(e.l+=7);break;case 37:case 16:n[1]=md[e[e.l]],e.l+=12==t?4:8;break;case 0:e.l+=8;break;case 1:n[1]=sd(e);break;case 2:n[1]=function(e,t,n){if(n.biff>5)return function(e,t,n){var r=e.read_shift(n&&2==n.biff?1:2);return 0===r?(e.l++,""):function(e,t,n){if(n){if(n.biff>=2&&n.biff<=5)return e.read_shift(t,"cpstr");if(n.biff>=12)return e.read_shift(t,"dbcs-cont")}return 0===e.read_shift(1)?e.read_shift(t,"sbcs-cont"):e.read_shift(t,"dbcs-cont")}(e,r,n)}(e,0,n);var r=e.read_shift(1);return 0===r?(e.l++,""):e.read_shift(r,n.biff<=4||!e.lens?"cpstr":"sbcs-cont")}(e,0,{biff:t>0&&t<8?2:t});break;default:throw new Error("Bad SerAr: "+n[0])}return n}function ih(e,t,n){for(var r=e.read_shift(12==n.biff?4:2),a=[],i=0;i!=r;++i)a.push((12==n.biff?id:Wd)(e));return a}function oh(e,t,n){var r=0,a=0;12==n.biff?(r=e.read_shift(4),a=e.read_shift(4)):(a=1+e.read_shift(1),r=1+e.read_shift(2)),n.biff>=2&&n.biff<8&&(--r,0==--a&&(a=256));for(var i=0,o=[];i!=r&&(o[i]=[]);++i)for(var s=0;s!=a;++s)o[i][s]=ah(e,n.biff);return o}function sh(e,t,n){return e.l+=2,[th(e)]}function lh(e){return e.l+=6,[]}function ch(e){return e.l+=2,[Md(e),1&e.read_shift(2)]}var uh=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];var dh={1:{n:"PtgExp",f:function(e,t,n){return e.l++,n&&12==n.biff?[e.read_shift(4,"i"),0]:[e.read_shift(2),e.read_shift(n&&2==n.biff?1:2)]}},2:{n:"PtgTbl",f:yu},3:{n:"PtgAdd",f:Hp},4:{n:"PtgSub",f:Hp},5:{n:"PtgMul",f:Hp},6:{n:"PtgDiv",f:Hp},7:{n:"PtgPower",f:Hp},8:{n:"PtgConcat",f:Hp},9:{n:"PtgLt",f:Hp},10:{n:"PtgLe",f:Hp},11:{n:"PtgEq",f:Hp},12:{n:"PtgGe",f:Hp},13:{n:"PtgGt",f:Hp},14:{n:"PtgNe",f:Hp},15:{n:"PtgIsect",f:Hp},16:{n:"PtgUnion",f:Hp},17:{n:"PtgRange",f:Hp},18:{n:"PtgUplus",f:Hp},19:{n:"PtgUminus",f:Hp},20:{n:"PtgPercent",f:Hp},21:{n:"PtgParen",f:Hp},22:{n:"PtgMissArg",f:Hp},23:{n:"PtgStr",f:function(e,t,n){return e.l++,Vd(e,0,n)}},26:{n:"PtgSheet",f:function(e,t,n){return e.l+=5,e.l+=2,e.l+=2==n.biff?1:4,["PTGSHEET"]}},27:{n:"PtgEndSheet",f:function(e,t,n){return e.l+=2==n.biff?4:5,["PTGENDSHEET"]}},28:{n:"PtgErr",f:function(e){return e.l++,md[e.read_shift(1)]}},29:{n:"PtgBool",f:function(e){return e.l++,0!==e.read_shift(1)}},30:{n:"PtgInt",f:function(e){return e.l++,e.read_shift(2)}},31:{n:"PtgNum",f:function(e){return e.l++,sd(e)}},32:{n:"PtgArray",f:function(e,t,n){var r=(96&e[e.l++])>>5;return e.l+=2==n.biff?6:12==n.biff?14:7,[r]}},33:{n:"PtgFunc",f:function(e,t,n){var r=(96&e[e.l])>>5;e.l+=1;var a=e.read_shift(n&&n.biff<=3?1:2);return[Ah[a],Th[a],r]}},34:{n:"PtgFuncVar",f:function(e,t,n){var r=e[e.l++],a=e.read_shift(1),i=n&&n.biff<=3?[88==r?-1:0,e.read_shift(1)]:function(e){return[e[e.l+1]>>7,32767&e.read_shift(2)]}(e);return[a,(0===i[0]?Th:Ih)[i[1]]]}},35:{n:"PtgName",f:function(e,t,n){var r=e.read_shift(1)>>>5&3,a=!n||n.biff>=8?4:2,i=e.read_shift(a);switch(n.biff){case 2:e.l+=5;break;case 3:case 4:e.l+=8;break;case 5:e.l+=12}return[r,0,i]}},36:{n:"PtgRef",f:function(e,t,n){var r=(96&e[e.l])>>5;return e.l+=1,[r,eh(e,0,n)]}},37:{n:"PtgArea",f:function(e,t,n){return[(96&e[e.l++])>>5,Zp(e,n.biff>=2&&n.biff,n)]}},38:{n:"PtgMemArea",f:function(e,t,n){var r=e.read_shift(1)>>>5&3;return e.l+=n&&2==n.biff?3:4,[r,e.read_shift(n&&2==n.biff?1:2)]}},39:{n:"PtgMemErr",f:yu},40:{n:"PtgMemNoMem",f:yu},41:{n:"PtgMemFunc",f:function(e,t,n){return[e.read_shift(1)>>>5&3,e.read_shift(n&&2==n.biff?1:2)]}},42:{n:"PtgRefErr",f:function(e,t,n){var r=e.read_shift(1)>>>5&3;return e.l+=4,n.biff<8&&e.l--,12==n.biff&&(e.l+=2),[r]}},43:{n:"PtgAreaErr",f:function(e,t,n){var r=(96&e[e.l++])>>5;return e.l+=n&&n.biff>8?12:n.biff<8?6:8,[r]}},44:{n:"PtgRefN",f:function(e,t,n){var r=(96&e[e.l])>>5;e.l+=1;var a=function(e,t,n){var r=n&&n.biff?n.biff:8;if(r>=2&&r<=5)return function(e){var t=e.read_shift(2),n=e.read_shift(1),r=(32768&t)>>15,a=(16384&t)>>14;return t&=16383,1==r&&t>=8192&&(t-=16384),1==a&&n>=128&&(n-=256),{r:t,c:n,cRel:a,rRel:r}}(e);var a=e.read_shift(r>=12?4:2),i=e.read_shift(2),o=(16384&i)>>14,s=(32768&i)>>15;if(i&=16383,1==s)for(;a>524287;)a-=1048576;if(1==o)for(;i>8191;)i-=16384;return{r:a,c:i,cRel:o,rRel:s}}(e,0,n);return[r,a]}},45:{n:"PtgAreaN",f:function(e,t,n){var r=(96&e[e.l++])>>5,a=function(e,t,n){if(n.biff<8)return Xp(e);var r=e.read_shift(12==n.biff?4:2),a=e.read_shift(12==n.biff?4:2),i=Qp(e,2),o=Qp(e,2);return{s:{r:r,c:i[0],cRel:i[1],rRel:i[2]},e:{r:a,c:o[0],cRel:o[1],rRel:o[2]}}}(e,0,n);return[r,a]}},46:{n:"PtgMemAreaN",f:function(e){return[e.read_shift(1)>>>5&3,e.read_shift(2)]}},47:{n:"PtgMemNoMemN",f:function(e){return[e.read_shift(1)>>>5&3,e.read_shift(2)]}},57:{n:"PtgNameX",f:function(e,t,n){return 5==n.biff?function(e){var t=e.read_shift(1)>>>5&3,n=e.read_shift(2,"i");e.l+=8;var r=e.read_shift(2);return e.l+=12,[t,n,r]}(e):[e.read_shift(1)>>>5&3,e.read_shift(2),e.read_shift(4)]}},58:{n:"PtgRef3d",f:function(e,t,n){var r=(96&e[e.l])>>5;e.l+=1;var a=e.read_shift(2);return n&&5==n.biff&&(e.l+=12),[r,a,eh(e,0,n)]}},59:{n:"PtgArea3d",f:function(e,t,n){var r=(96&e[e.l++])>>5,a=e.read_shift(2,"i");if(n)switch(n.biff){case 5:e.l+=12,6;break;case 12:12}return[r,a,Zp(e,0,n)]}},60:{n:"PtgRefErr3d",f:function(e,t,n){var r=(96&e[e.l++])>>5,a=e.read_shift(2),i=4;if(n)switch(n.biff){case 5:i=15;break;case 12:i=6}return e.l+=i,[r,a]}},61:{n:"PtgAreaErr3d",f:function(e,t,n){var r=(96&e[e.l++])>>5,a=e.read_shift(2),i=8;if(n)switch(n.biff){case 5:e.l+=12,i=6;break;case 12:i=12}return e.l+=i,[r,a]}},255:{}},ph={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},hh={1:{n:"PtgElfLel",f:ch},2:{n:"PtgElfRw",f:sh},3:{n:"PtgElfCol",f:sh},6:{n:"PtgElfRwV",f:sh},7:{n:"PtgElfColV",f:sh},10:{n:"PtgElfRadical",f:sh},11:{n:"PtgElfRadicalS",f:lh},13:{n:"PtgElfColS",f:lh},15:{n:"PtgElfColSV",f:lh},16:{n:"PtgElfRadicalLel",f:ch},25:{n:"PtgList",f:function(e){e.l+=2;var t=e.read_shift(2),n=e.read_shift(2),r=e.read_shift(4),a=e.read_shift(2),i=e.read_shift(2);return{ixti:t,coltype:3&n,rt:uh[n>>2&31],idx:r,c:a,C:i}}},29:{n:"PtgSxName",f:function(e){return e.l+=2,[e.read_shift(4)]}},255:{}},mh={0:{n:"PtgAttrNoop",f:function(e){return e.l+=4,[0,0]}},1:{n:"PtgAttrSemi",f:function(e,t,n){var r=255&e[e.l+1]?1:0;return e.l+=n&&2==n.biff?3:4,[r]}},2:{n:"PtgAttrIf",f:function(e,t,n){var r=255&e[e.l+1]?1:0;return e.l+=2,[r,e.read_shift(n&&2==n.biff?1:2)]}},4:{n:"PtgAttrChoose",f:function(e,t,n){e.l+=2;for(var r=e.read_shift(n&&2==n.biff?1:2),a=[],i=0;i<=r;++i)a.push(e.read_shift(n&&2==n.biff?1:2));return a}},8:{n:"PtgAttrGoto",f:function(e,t,n){var r=255&e[e.l+1]?1:0;return e.l+=2,[r,e.read_shift(n&&2==n.biff?1:2)]}},16:{n:"PtgAttrSum",f:function(e,t,n){e.l+=n&&2==n.biff?3:4}},32:{n:"PtgAttrBaxcel",f:nh},33:{n:"PtgAttrBaxcel",f:nh},64:{n:"PtgAttrSpace",f:function(e){return e.read_shift(2),rh(e)}},65:{n:"PtgAttrSpaceSemi",f:function(e){return e.read_shift(2),rh(e)}},128:{n:"PtgAttrIfError",f:function(e){var t=255&e[e.l+1]?1:0;return e.l+=2,[t,e.read_shift(2)]}},255:{}};function fh(e){for(var t=[],n=0;n<e.length;++n){for(var r=e[n],a=[],i=0;i<r.length;++i){var o=r[i];if(o)if(2===o[0])a.push('"'+o[1].replace(/"/g,'""')+'"');else a.push(o[1]);else a.push("")}t.push(a.join(","))}return t.join(";")}var yh={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function gh(e,t,n){if(!e)return"SH33TJSERR0";if(n.biff>8&&(!e.XTI||!e.XTI[t]))return e.SheetNames[t];if(!e.XTI)return"SH33TJSERR6";var r=e.XTI[t];if(n.biff<8)return t>1e4&&(t-=65536),t<0&&(t=-t),0==t?"":e.XTI[t-1];if(!r)return"SH33TJSERR1";var a="";if(n.biff>8)switch(e[r[0]][0]){case 357:return a=-1==r[1]?"#REF":e.SheetNames[r[1]],r[1]==r[2]?a:a+":"+e.SheetNames[r[2]];case 358:return null!=n.SID?e.SheetNames[n.SID]:"SH33TJSSAME"+e[r[0]][0];default:return"SH33TJSSRC"+e[r[0]][0]}switch(e[r[0]][0][0]){case 1025:return a=-1==r[1]?"#REF":e.SheetNames[r[1]]||"SH33TJSERR3",r[1]==r[2]?a:a+":"+e.SheetNames[r[2]];case 14849:return e[r[0]].slice(1).map((function(e){return e.Name})).join(";;");default:return e[r[0]][0][3]?(a=-1==r[1]?"#REF":e[r[0]][0][3][r[1]]||"SH33TJSERR4",r[1]==r[2]?a:a+":"+e[r[0]][0][3][r[2]]):"SH33TJSERR2"}}function bh(e,t,n){var r=gh(e,t,n);return"#REF"==r?r:function(e,t){if(!(e||t&&t.biff<=5&&t.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(e)?"'"+e+"'":e}(r,n)}function vh(e,t,n,r,a){var i,o,s,l,c=a&&a.biff||8,u={s:{c:0,r:0},e:{c:0,r:0}},d=[],p=0,h=0,m="";if(!e[0]||!e[0][0])return"";for(var f=-1,y="",g=0,b=e[0].length;g<b;++g){var v=e[0][g];switch(v[0]){case"PtgUminus":d.push("-"+d.pop());break;case"PtgUplus":d.push("+"+d.pop());break;case"PtgPercent":d.push(d.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(i=d.pop(),o=d.pop(),f>=0){switch(e[0][f][1][0]){case 0:y=ql(" ",e[0][f][1][1]);break;case 1:y=ql("\r",e[0][f][1][1]);break;default:if(y="",a.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][f][1][0])}o+=y,f=-1}d.push(o+yh[v[0]]+i);break;case"PtgIsect":i=d.pop(),o=d.pop(),d.push(o+" "+i);break;case"PtgUnion":i=d.pop(),o=d.pop(),d.push(o+","+i);break;case"PtgRange":i=d.pop(),o=d.pop(),d.push(o+":"+i);break;case"PtgAttrChoose":case"PtgAttrGoto":case"PtgAttrIf":case"PtgAttrIfError":case"PtgAttrBaxcel":case"PtgAttrSemi":case"PtgMemArea":case"PtgTbl":case"PtgMemErr":case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":case"PtgMemFunc":case"PtgMemNoMem":break;case"PtgRef":s=wu(v[1][1],u,a),d.push(Eu(s,c));break;case"PtgRefN":s=n?wu(v[1][1],n,a):v[1][1],d.push(Eu(s,c));break;case"PtgRef3d":p=v[1][1],s=wu(v[1][2],u,a),m=bh(r,p,a),d.push(m+"!"+Eu(s,c));break;case"PtgFunc":case"PtgFuncVar":var w=v[1][0],S=v[1][1];w||(w=0);var E=0==(w&=127)?[]:d.slice(-w);d.length-=w,"User"===S&&(S=E.shift()),d.push(S+"("+E.join(",")+")");break;case"PtgBool":d.push(v[1]?"TRUE":"FALSE");break;case"PtgInt":case"PtgErr":d.push(v[1]);break;case"PtgNum":d.push(String(v[1]));break;case"PtgStr":d.push('"'+v[1].replace(/"/g,'""')+'"');break;case"PtgAreaN":l=Su(v[1][1],n?{s:n}:u,a),d.push(xu(l,a));break;case"PtgArea":l=Su(v[1][1],u,a),d.push(xu(l,a));break;case"PtgArea3d":p=v[1][1],l=v[1][2],m=bh(r,p,a),d.push(m+"!"+xu(l,a));break;case"PtgAttrSum":d.push("SUM("+d.pop()+")");break;case"PtgName":h=v[1][2];var x=(r.names||[])[h-1]||(r[0]||[])[h],_=x?x.Name:"SH33TJSNAME"+String(h);_&&"_xlfn."==_.slice(0,6)&&!a.xlfn&&(_=_.slice(6)),d.push(_);break;case"PtgNameX":var k,I=v[1][1];if(h=v[1][2],!(a.biff<=5)){var T="";if(14849==((r[I]||[])[0]||[])[0]||(1025==((r[I]||[])[0]||[])[0]?r[I][h]&&r[I][h].itab>0&&(T=r.SheetNames[r[I][h].itab-1]+"!"):T=r.SheetNames[h-1]+"!"),r[I]&&r[I][h])T+=r[I][h].Name;else if(r[0]&&r[0][h])T+=r[0][h].Name;else{var A=(gh(r,I,a)||"").split(";;");A[h-1]?T=A[h-1]:T+="SH33TJSERRX"}d.push(T);break}I<0&&(I=-I),r[I]&&(k=r[I][h]),k||(k={Name:"SH33TJSERRY"}),d.push(k.Name);break;case"PtgParen":var O="(",K=")";if(f>=0){switch(y="",e[0][f][1][0]){case 2:O=ql(" ",e[0][f][1][1])+O;break;case 3:O=ql("\r",e[0][f][1][1])+O;break;case 4:K=ql(" ",e[0][f][1][1])+K;break;case 5:K=ql("\r",e[0][f][1][1])+K;break;default:if(a.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][f][1][0])}f=-1}d.push(O+d.pop()+K);break;case"PtgRefErr":case"PtgRefErr3d":case"PtgAreaErr":case"PtgAreaErr3d":d.push("#REF!");break;case"PtgExp":s={c:v[1][1],r:v[1][0]};var C={c:n.c,r:n.r};if(r.sharedf[Ou(s)]){var R=r.sharedf[Ou(s)];d.push(vh(R,u,C,r,a))}else{var j=!1;for(i=0;i!=r.arrayf.length;++i)if(o=r.arrayf[i],!(s.c<o[0].s.c||s.c>o[0].e.c||s.r<o[0].s.r||s.r>o[0].e.r)){d.push(vh(o[1],u,C,r,a)),j=!0;break}j||d.push(v[1])}break;case"PtgArray":d.push("{"+fh(v[1])+"}");break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":f=g;break;case"PtgMissArg":d.push("");break;case"PtgList":d.push("Table"+v[1].idx+"[#"+v[1].rt+"]");break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");default:throw new Error("Unrecognized Formula Token: "+String(v))}if(3!=a.biff&&f>=0&&-1==["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"].indexOf(e[0][g][0])){var P=!0;switch((v=e[0][f])[1][0]){case 4:P=!1;case 0:y=ql(" ",v[1][1]);break;case 5:P=!1;case 1:y=ql("\r",v[1][1]);break;default:if(y="",a.WTF)throw new Error("Unexpected PtgAttrSpaceType "+v[1][0])}d.push((P?y:"")+d.pop()+(P?"":y)),f=-1}}if(d.length>1&&a.WTF)throw new Error("bad formula stack");return d[0]}function wh(e,t,n,r,a){var i=qd(t,n,a),o=function(e){if(null==e){var t=gu(8);return t.write_shift(1,3),t.write_shift(1,0),t.write_shift(2,0),t.write_shift(2,0),t.write_shift(2,65535),t}return ld("number"==typeof e?e:0)}(e.v),s=gu(6);s.write_shift(2,33),s.write_shift(4,0);for(var l=gu(e.bf.length),c=0;c<e.bf.length;++c)l[c]=e.bf[c];return Cs([i,o,s,l])}function Sh(e,t,n){var r=e.read_shift(4),a=function(e,t,n){for(var r,a,i=e.l+t,o=[];i!=e.l;)t=i-e.l,a=e[e.l],r=dh[a]||dh[ph[a]],24!==a&&25!==a||(r=(24===a?hh:mh)[e[e.l+1]]),r&&r.f?o.push([r.n,r.f(e,t,n)]):yu(e,t);return o}(e,r,n),i=e.read_shift(4),o=i>0?function(e,t,n,r){if(r.biff<8)return yu(e,t);for(var a=e.l+t,i=[],o=0;o!==n.length;++o)switch(n[o][0]){case"PtgArray":n[o][1]=oh(e,0,r),i.push(n[o][1]);break;case"PtgMemArea":n[o][2]=ih(e,n[o][1],r),i.push(n[o][2]);break;case"PtgExp":r&&12==r.biff&&(n[o][1][1]=e.read_shift(4),i.push(n[o][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+n[o][0]}return 0!=(t=a-e.l)&&i.push(yu(e,t)),i}(e,i,a,n):null;return[a,o]}var Eh=Sh,xh=Sh,_h=Sh,kh=Sh,Ih={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},Th={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},Ah={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function Oh(e){return("of:="+e.replace(zp,"$1[.$2$3$4$5]").replace(/\]:\[/g,":")).replace(/;/g,"|").replace(/,/g,";")}function Kh(e){return e.replace(/\./,"!")}var Ch="undefined"!=typeof Map;function Rh(e,t,n){var r=0,a=e.length;if(n){if(Ch?n.has(t):Object.prototype.hasOwnProperty.call(n,t))for(var i=Ch?n.get(t):n[t];r<i.length;++r)if(e[i[r]].t===t)return e.Count++,i[r]}else for(;r<a;++r)if(e[r].t===t)return e.Count++,r;return e[a]={t:t},e.Count++,e.Unique++,n&&(Ch?(n.has(t)||n.set(t,[]),n.get(t).push(a)):(Object.prototype.hasOwnProperty.call(n,t)||(n[t]=[]),n[t].push(a))),a}function jh(e,t){var n={min:e+1,max:e+1},r=-1;return t.MDW&&(fp=t.MDW),null!=t.width?n.customWidth=1:null!=t.wpx?r=gp(t.wpx):null!=t.wch&&(r=t.wch),r>-1?(n.width=bp(r),n.customWidth=1):null!=t.width&&(n.width=t.width),t.hidden&&(n.hidden=!0),null!=t.level&&(n.outlineLevel=n.level=t.level),n}function Ph(e,t){if(e){var n=[.7,.7,.75,.75,.3,.3];"xlml"==t&&(n=[1,1,1,1,.5,.5]),null==e.left&&(e.left=n[0]),null==e.right&&(e.right=n[1]),null==e.top&&(e.top=n[2]),null==e.bottom&&(e.bottom=n[3]),null==e.header&&(e.header=n[4]),null==e.footer&&(e.footer=n[5])}}function Dh(e,t,n){var r=n.revssf[null!=t.z?t.z:"General"],a=60,i=e.length;if(null==r&&n.ssf)for(;a<392;++a)if(null==n.ssf[a]){El(t.z,a),n.ssf[a]=t.z,n.revssf[t.z]=r=a;break}for(a=0;a!=i;++a)if(e[a].numFmtId===r)return a;return e[i]={numFmtId:r,fontId:0,fillId:0,borderId:0,xfId:0,applyNumberFormat:1},i}function Nh(e,t,n){if(e&&e["!ref"]){var r=Ru(e["!ref"]);if(r.e.c<r.s.c||r.e.r<r.s.r)throw new Error("Bad range ("+n+"): "+e["!ref"])}}var Lh=["objects","scenarios","selectLockedCells","selectUnlockedCells"],Mh=["formatColumns","formatRows","formatCells","insertColumns","insertRows","insertHyperlinks","deleteColumns","deleteRows","sort","autoFilter","pivotTables"];function Fh(e,t,n,r){if(e.c&&n["!comments"].push([t,e.c]),void 0===e.v&&"string"!=typeof e.f||"z"===e.t&&!e.f)return"";var a="",i=e.t,o=e.v;if("z"!==e.t)switch(e.t){case"b":a=e.v?"1":"0";break;case"n":a=""+e.v;break;case"e":a=md[e.v];break;case"d":r&&r.cellDates?a=Jl(e.v,-1).toISOString():((e=$l(e)).t="n",a=""+(e.v=Dl(Jl(e.v)))),void 0===e.z&&(e.z=Js[14]);break;default:a=e.v}var s=hc("v",nc(a)),l={r:t},c=Dh(r.cellXfs,e,r);switch(0!==c&&(l.s=c),e.t){case"n":case"z":break;case"d":l.t="d";break;case"b":l.t="b";break;case"e":l.t="e";break;default:if(null==e.v){delete e.t;break}if(e.v.length>32767)throw new Error("Text length must not exceed 32767 characters");if(r&&r.bookSST){s=hc("v",""+Rh(r.Strings,e.v,r.revStrings)),l.t="s";break}l.t="str"}if(e.t!=i&&(e.t=i,e.v=o),"string"==typeof e.f&&e.f){var u=e.F&&e.F.slice(0,t.length)==t?{t:"array",ref:e.F}:null;s=fc("f",nc(e.f),u)+(null!=e.v?s:"")}return e.l&&n["!links"].push([t,e.l]),e.D&&(l.cm=1),fc("c",s,l)}function Bh(e,t,n,r){var a,i=[Zl,fc("worksheet",null,{xmlns:Kc[0],"xmlns:r":Ic})],o=n.SheetNames[e],s="",l=n.Sheets[o];null==l&&(l={});var c=l["!ref"]||"A1",u=Ru(c);if(u.e.c>16383||u.e.r>1048575){if(t.WTF)throw new Error("Range "+c+" exceeds format limit A1:XFD1048576");u.e.c=Math.min(u.e.c,16383),u.e.r=Math.min(u.e.c,1048575),c=Cu(u)}r||(r={}),l["!comments"]=[];var d=[];!function(e,t,n,r,a){var i=!1,o={},s=null;if("xlsx"!==r.bookType&&t.vbaraw){var l=t.SheetNames[n];try{t.Workbook&&(l=t.Workbook.Sheets[n].CodeName||l)}catch(e){}i=!0,o.codeName=uc(nc(l))}if(e&&e["!outline"]){var c={summaryBelow:1,summaryRight:1};e["!outline"].above&&(c.summaryBelow=0),e["!outline"].left&&(c.summaryRight=0),s=(s||"")+fc("outlinePr",null,c)}(i||s)&&(a[a.length]=fc("sheetPr",s,o))}(l,n,e,t,i),i[i.length]=fc("dimension",null,{ref:c}),i[i.length]=function(e,t,n,r){var a={workbookViewId:"0"};return(((r||{}).Workbook||{}).Views||[])[0]&&(a.rightToLeft=r.Workbook.Views[0].RTL?"1":"0"),fc("sheetViews",fc("sheetView",null,a),{})}(0,0,0,n),t.sheetFormat&&(i[i.length]=fc("sheetFormatPr",null,{defaultRowHeight:t.sheetFormat.defaultRowHeight||"16",baseColWidth:t.sheetFormat.baseColWidth||"10",outlineLevelRow:t.sheetFormat.outlineLevelRow||"7"})),null!=l["!cols"]&&l["!cols"].length>0&&(i[i.length]=function(e,t){for(var n,r=["<cols>"],a=0;a!=t.length;++a)(n=t[a])&&(r[r.length]=fc("col",null,jh(a,n)));return r[r.length]="</cols>",r.join("")}(0,l["!cols"])),i[a=i.length]="<sheetData/>",l["!links"]=[],null!=l["!ref"]&&(s=function(e,t,n,r){var a,i,o=[],s=[],l=Ru(e["!ref"]),c="",u="",d=[],p=0,h=0,m=e["!rows"],f=Array.isArray(e),y={r:u},g=-1;for(h=l.s.c;h<=l.e.c;++h)d[h]=Tu(h);for(p=l.s.r;p<=l.e.r;++p){for(s=[],u=ku(p),h=l.s.c;h<=l.e.c;++h){a=d[h]+u;var b=f?(e[p]||[])[h]:e[a];void 0!==b&&null!=(c=Fh(b,a,e,t))&&s.push(c)}(s.length>0||m&&m[p])&&(y={r:u},m&&m[p]&&((i=m[p]).hidden&&(y.hidden=1),g=-1,i.hpx?g=wp(i.hpx):i.hpt&&(g=i.hpt),g>-1&&(y.ht=g,y.customHeight=1),i.level&&(y.outlineLevel=i.level)),o[o.length]=fc("row",s.join(""),y))}if(m)for(;p<m.length;++p)m&&m[p]&&(y={r:p+1},(i=m[p]).hidden&&(y.hidden=1),g=-1,i.hpx?g=wp(i.hpx):i.hpt&&(g=i.hpt),g>-1&&(y.ht=g,y.customHeight=1),i.level&&(y.outlineLevel=i.level),o[o.length]=fc("row","",y));return o.join("")}(l,t),s.length>0&&(i[i.length]=s)),i.length>a+1&&(i[i.length]="</sheetData>",i[a]=i[a].replace("/>",">")),l["!protect"]&&(i[i.length]=function(e){var t={sheet:1};return Lh.forEach((function(n){null!=e[n]&&e[n]&&(t[n]="1")})),Mh.forEach((function(n){null==e[n]||e[n]||(t[n]="0")})),e.password&&(t.password=pp(e.password).toString(16).toUpperCase()),fc("sheetProtection",null,t)}(l["!protect"])),null!=l["!autofilter"]&&(i[i.length]=function(e,t,n,r){var a="string"==typeof e.ref?e.ref:Cu(e.ref);n.Workbook||(n.Workbook={Sheets:[]}),n.Workbook.Names||(n.Workbook.Names=[]);var i=n.Workbook.Names,o=Ku(a);o.s.r==o.e.r&&(o.e.r=Ku(t["!ref"]).e.r,a=Cu(o));for(var s=0;s<i.length;++s){var l=i[s];if("_xlnm._FilterDatabase"==l.Name&&l.Sheet==r){l.Ref="'"+n.SheetNames[r]+"'!"+a;break}}return s==i.length&&i.push({Name:"_xlnm._FilterDatabase",Sheet:r,Ref:"'"+n.SheetNames[r]+"'!"+a}),fc("autoFilter",null,{ref:a})}(l["!autofilter"],l,n,e)),null!=l["!merges"]&&l["!merges"].length>0&&(i[i.length]=function(e){if(0===e.length)return"";for(var t='<mergeCells count="'+e.length+'">',n=0;n!=e.length;++n)t+='<mergeCell ref="'+Cu(e[n])+'"/>';return t+"</mergeCells>"}(l["!merges"]));var p,h,m=-1,f=-1;return l["!links"].length>0&&(i[i.length]="<hyperlinks>",l["!links"].forEach((function(e){e[1].Target&&(p={ref:e[0]},"#"!=e[1].Target.charAt(0)&&(f=Sd(r,-1,nc(e[1].Target).replace(/#.*$/,""),bd.HLINK),p["r:id"]="rId"+f),(m=e[1].Target.indexOf("#"))>-1&&(p.location=nc(e[1].Target.slice(m+1))),e[1].Tooltip&&(p.tooltip=nc(e[1].Tooltip)),i[i.length]=fc("hyperlink",null,p))})),i[i.length]="</hyperlinks>"),delete l["!links"],null!=l["!margins"]&&(i[i.length]=(Ph(h=l["!margins"]),fc("pageMargins",null,h))),t&&!t.ignoreEC&&null!=t.ignoreEC||(i[i.length]=hc("ignoredErrors",fc("ignoredError",null,{numberStoredAsText:1,sqref:c}))),d.length>0&&(f=Sd(r,-1,"../drawings/drawing"+(e+1)+".xml",bd.DRAW),i[i.length]=fc("drawing",null,{"r:id":"rId"+f}),l["!drawing"]=d),l["!comments"].length>0&&(f=Sd(r,-1,"../drawings/vmlDrawing"+(e+1)+".vml",bd.VML),i[i.length]=fc("legacyDrawing",null,{"r:id":"rId"+f}),l["!legacy"]=f),i.length>1&&(i[i.length]="</worksheet>",i[1]=i[1].replace("/>",">")),i.join("")}function Vh(e,t,n,r){var a=function(e,t,n){var r=gu(145),a=(n["!rows"]||[])[e]||{};r.write_shift(4,e),r.write_shift(4,0);var i=320;a.hpx?i=20*wp(a.hpx):a.hpt&&(i=20*a.hpt),r.write_shift(2,i),r.write_shift(1,0);var o=0;a.level&&(o|=a.level),a.hidden&&(o|=16),(a.hpx||a.hpt)&&(o|=32),r.write_shift(1,o),r.write_shift(1,0);var s=0,l=r.l;r.l+=4;for(var c={r:e,c:0},u=0;u<16;++u)if(!(t.s.c>u+1<<10||t.e.c<u<<10)){for(var d=-1,p=-1,h=u<<10;h<u+1<<10;++h)c.c=h,(Array.isArray(n)?(n[c.r]||[])[c.c]:n[Ou(c)])&&(d<0&&(d=h),p=h);d<0||(++s,r.write_shift(4,d),r.write_shift(4,p))}var m=r.l;return r.l=l,r.write_shift(4,s),r.l=m,r.length>r.l?r.slice(0,r.l):r}(r,n,t);(a.length>17||(t["!rows"]||[])[r])&&vu(e,0,a)}var Uh=id,Jh=od;var Gh=id,$h=od;var qh=["left","right","top","bottom","header","footer"];function zh(e,t,n,r,a,i,o){if(void 0===t.v)return!1;var s="";switch(t.t){case"b":s=t.v?"1":"0";break;case"d":(t=$l(t)).z=t.z||Js[14],t.v=Dl(Jl(t.v)),t.t="n";break;case"n":case"e":s=""+t.v;break;default:s=t.v}var l={r:n,c:r};switch(l.s=Dh(a.cellXfs,t,a),t.l&&i["!links"].push([Ou(l),t.l]),t.c&&i["!comments"].push([Ou(l),t.c]),t.t){case"s":case"str":return a.bookSST?(s=Rh(a.Strings,t.v,a.revStrings),l.t="s",l.v=s,o?vu(e,18,function(e,t,n){return null==n&&(n=gu(8)),Wu(t,n),n.write_shift(4,t.v),n}(0,l)):vu(e,7,function(e,t,n){return null==n&&(n=gu(12)),qu(t,n),n.write_shift(4,t.v),n}(0,l))):(l.t="str",o?vu(e,17,function(e,t,n){return null==n&&(n=gu(8+4*e.v.length)),Wu(t,n),Bu(e.v,n),n.length>n.l?n.slice(0,n.l):n}(t,l)):vu(e,6,function(e,t,n){return null==n&&(n=gu(12+4*e.v.length)),qu(t,n),Bu(e.v,n),n.length>n.l?n.slice(0,n.l):n}(t,l))),!0;case"n":return t.v==(0|t.v)&&t.v>-1e3&&t.v<1e3?o?vu(e,13,function(e,t,n){return null==n&&(n=gu(8)),Wu(t,n),rd(e.v,n),n}(t,l)):vu(e,2,function(e,t,n){return null==n&&(n=gu(12)),qu(t,n),rd(e.v,n),n}(t,l)):o?vu(e,16,function(e,t,n){return null==n&&(n=gu(12)),Wu(t,n),ld(e.v,n),n}(t,l)):vu(e,5,function(e,t,n){return null==n&&(n=gu(16)),qu(t,n),ld(e.v,n),n}(t,l)),!0;case"b":return l.t="b",o?vu(e,15,function(e,t,n){return null==n&&(n=gu(5)),Wu(t,n),n.write_shift(1,e.v?1:0),n}(t,l)):vu(e,4,function(e,t,n){return null==n&&(n=gu(9)),qu(t,n),n.write_shift(1,e.v?1:0),n}(t,l)),!0;case"e":return l.t="e",o?vu(e,14,function(e,t,n){return null==n&&(n=gu(8)),Wu(t,n),n.write_shift(1,e.v),n.write_shift(2,0),n.write_shift(1,0),n}(t,l)):vu(e,3,function(e,t,n){return null==n&&(n=gu(9)),qu(t,n),n.write_shift(1,e.v),n}(t,l)),!0}return o?vu(e,12,function(e,t,n){return null==n&&(n=gu(4)),Wu(t,n)}(0,l)):vu(e,1,function(e,t,n){return null==n&&(n=gu(8)),qu(t,n)}(0,l)),!0}function Wh(e,t){var n,r;t&&t["!merges"]&&(vu(e,177,(n=t["!merges"].length,null==r&&(r=gu(4)),r.write_shift(4,n),r)),t["!merges"].forEach((function(t){vu(e,176,$h(t))})),vu(e,178))}function Yh(e,t){t&&t["!cols"]&&(vu(e,390),t["!cols"].forEach((function(t,n){t&&vu(e,60,function(e,t,n){null==n&&(n=gu(18));var r=jh(e,t);n.write_shift(-4,e),n.write_shift(-4,e),n.write_shift(4,256*(r.width||10)),n.write_shift(4,0);var a=0;return t.hidden&&(a|=1),"number"==typeof r.width&&(a|=2),t.level&&(a|=t.level<<8),n.write_shift(2,a),n}(n,t))})),vu(e,391))}function Hh(e,t){t&&t["!ref"]&&(vu(e,648),vu(e,649,function(e){var t=gu(24);return t.write_shift(4,4),t.write_shift(4,1),od(e,t),t}(Ru(t["!ref"]))),vu(e,650))}function Qh(e,t,n){t["!links"].forEach((function(t){if(t[1].Target){var r=Sd(n,-1,t[1].Target.replace(/#.*$/,""),bd.HLINK);vu(e,494,function(e,t){var n=gu(50+4*(e[1].Target.length+(e[1].Tooltip||"").length));od({s:Au(e[0]),e:Au(e[0])},n),td("rId"+t,n);var r=e[1].Target.indexOf("#");return Bu((-1==r?"":e[1].Target.slice(r+1))||"",n),Bu(e[1].Tooltip||"",n),Bu("",n),n.slice(0,n.l)}(t,r))}})),delete t["!links"]}function Zh(e,t,n){vu(e,133),vu(e,137,function(e,t,n){null==n&&(n=gu(30));var r=924;return(((t||{}).Views||[])[0]||{}).RTL&&(r|=32),n.write_shift(2,r),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(1,0),n.write_shift(1,0),n.write_shift(2,0),n.write_shift(2,100),n.write_shift(2,0),n.write_shift(2,0),n.write_shift(2,0),n.write_shift(4,0),n}(0,n)),vu(e,138),vu(e,134)}function Xh(e,t){var n,r;t["!protect"]&&vu(e,535,(n=t["!protect"],null==r&&(r=gu(66)),r.write_shift(2,n.password?pp(n.password):0),r.write_shift(4,1),[["objects",!1],["scenarios",!1],["formatCells",!0],["formatColumns",!0],["formatRows",!0],["insertColumns",!0],["insertRows",!0],["insertHyperlinks",!0],["deleteColumns",!0],["deleteRows",!0],["selectLockedCells",!1],["sort",!0],["autoFilter",!0],["pivotTables",!0],["selectUnlockedCells",!1]].forEach((function(e){e[1]?r.write_shift(4,null==n[e[0]]||n[e[0]]?0:1):r.write_shift(4,null!=n[e[0]]&&n[e[0]]?0:1)})),r))}function em(e,t,n,r){var a=bu(),i=n.SheetNames[e],o=n.Sheets[i]||{},s=i;try{n&&n.Workbook&&(s=n.Workbook.Sheets[e].CodeName||s)}catch(e){}var l,c,u=Ru(o["!ref"]||"A1");if(u.e.c>16383||u.e.r>1048575){if(t.WTF)throw new Error("Range "+(o["!ref"]||"A1")+" exceeds format limit A1:XFD1048576");u.e.c=Math.min(u.e.c,16383),u.e.r=Math.min(u.e.c,1048575)}return o["!links"]=[],o["!comments"]=[],vu(a,129),(n.vbaraw||o["!outline"])&&vu(a,147,function(e,t,n){null==n&&(n=gu(84+4*e.length));var r=192;t&&(t.above&&(r&=-65),t.left&&(r&=-129)),n.write_shift(1,r);for(var a=1;a<3;++a)n.write_shift(1,0);return cd({auto:1},n),n.write_shift(-4,-1),n.write_shift(-4,-1),Hu(e,n),n.slice(0,n.l)}(s,o["!outline"])),vu(a,148,Jh(u)),Zh(a,0,n.Workbook),Yh(a,o),function(e,t,n,r){var a,i=Ru(t["!ref"]||"A1"),o="",s=[];vu(e,145);var l=Array.isArray(t),c=i.e.r;t["!rows"]&&(c=Math.max(i.e.r,t["!rows"].length-1));for(var u=i.s.r;u<=c;++u){o=ku(u),Vh(e,t,i,u);var d=!1;if(u<=i.e.r)for(var p=i.s.c;p<=i.e.c;++p){u===i.s.r&&(s[p]=Tu(p)),a=s[p]+o;var h=l?(t[u]||[])[p]:t[a];d=!!h&&zh(e,h,u,p,r,t,d)}}vu(e,146)}(a,o,0,t),Xh(a,o),function(e,t,n,r){if(t["!autofilter"]){var a=t["!autofilter"],i="string"==typeof a.ref?a.ref:Cu(a.ref);n.Workbook||(n.Workbook={Sheets:[]}),n.Workbook.Names||(n.Workbook.Names=[]);var o=n.Workbook.Names,s=Ku(i);s.s.r==s.e.r&&(s.e.r=Ku(t["!ref"]).e.r,i=Cu(s));for(var l=0;l<o.length;++l){var c=o[l];if("_xlnm._FilterDatabase"==c.Name&&c.Sheet==r){c.Ref="'"+n.SheetNames[r]+"'!"+i;break}}l==o.length&&o.push({Name:"_xlnm._FilterDatabase",Sheet:r,Ref:"'"+n.SheetNames[r]+"'!"+i}),vu(e,161,od(Ru(i))),vu(e,162)}}(a,o,n,e),Wh(a,o),Qh(a,o,r),o["!margins"]&&vu(a,476,(l=o["!margins"],null==c&&(c=gu(48)),Ph(l),qh.forEach((function(e){ld(l[e],c)})),c)),t&&!t.ignoreEC&&null!=t.ignoreEC||Hh(a,o),function(e,t,n,r){if(t["!comments"].length>0){var a=Sd(r,-1,"../drawings/vmlDrawing"+(n+1)+".vml",bd.VML);vu(e,551,td("rId"+a)),t["!legacy"]=a}}(a,o,e,r),vu(a,130),a.end()}var tm=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]];var nm="][*?/\\".split("");function rm(e,t){if(e.length>31){if(t)return!1;throw new Error("Sheet names cannot exceed 31 chars")}var n=!0;return nm.forEach((function(r){if(-1!=e.indexOf(r)){if(!t)throw new Error("Sheet name cannot contain : \\ / ? * [ ]");n=!1}})),n}function am(e){if(!e||!e.SheetNames||!e.Sheets)throw new Error("Invalid Workbook");if(!e.SheetNames.length)throw new Error("Workbook is empty");var t=e.Workbook&&e.Workbook.Sheets||[];!function(e,t,n){e.forEach((function(r,a){rm(r);for(var i=0;i<a;++i)if(r==e[i])throw new Error("Duplicate Sheet Name: "+r);if(n){var o=t&&t[a]&&t[a].CodeName||r;if(95==o.charCodeAt(0)&&o.length>22)throw new Error("Bad Code Name: Worksheet"+o)}}))}(e.SheetNames,t,!!e.vbaraw);for(var n=0;n<e.SheetNames.length;++n)Nh(e.Sheets[e.SheetNames[n]],e.SheetNames[n],n)}function im(e){var t=[Zl];t[t.length]=fc("workbook",null,{xmlns:Kc[0],"xmlns:r":Ic});var n=e.Workbook&&(e.Workbook.Names||[]).length>0,r={codeName:"ThisWorkbook"};e.Workbook&&e.Workbook.WBProps&&(tm.forEach((function(t){null!=e.Workbook.WBProps[t[0]]&&e.Workbook.WBProps[t[0]]!=t[1]&&(r[t[0]]=e.Workbook.WBProps[t[0]])})),e.Workbook.WBProps.CodeName&&(r.codeName=e.Workbook.WBProps.CodeName,delete r.CodeName)),t[t.length]=fc("workbookPr",null,r);var a=e.Workbook&&e.Workbook.Sheets||[],i=0;if(a&&a[0]&&a[0].Hidden){for(t[t.length]="<bookViews>",i=0;i!=e.SheetNames.length&&a[i]&&a[i].Hidden;++i);i==e.SheetNames.length&&(i=0),t[t.length]='<workbookView firstSheet="'+i+'" activeTab="'+i+'"/>',t[t.length]="</bookViews>"}for(t[t.length]="<sheets>",i=0;i!=e.SheetNames.length;++i){var o={name:nc(e.SheetNames[i].slice(0,31))};if(o.sheetId=""+(i+1),o["r:id"]="rId"+(i+1),a[i])switch(a[i].Hidden){case 1:o.state="hidden";break;case 2:o.state="veryHidden"}t[t.length]=fc("sheet",null,o)}return t[t.length]="</sheets>",n&&(t[t.length]="<definedNames>",e.Workbook&&e.Workbook.Names&&e.Workbook.Names.forEach((function(e){var n={name:e.Name};e.Comment&&(n.comment=e.Comment),null!=e.Sheet&&(n.localSheetId=""+e.Sheet),e.Hidden&&(n.hidden="1"),e.Ref&&(t[t.length]=fc("definedName",nc(e.Ref),n))})),t[t.length]="</definedNames>"),t.length>2&&(t[t.length]="</workbook>",t[1]=t[1].replace("/>",">")),t.join("")}function om(e,t){return t||(t=gu(127)),t.write_shift(4,e.Hidden),t.write_shift(4,e.iTabID),td(e.strRelID,t),Bu(e.name.slice(0,31),t),t.length>t.l?t.slice(0,t.l):t}function sm(e,t){if(t.Workbook&&t.Workbook.Sheets){for(var n,r,a=t.Workbook.Sheets,i=0,o=-1,s=-1;i<a.length;++i)!a[i]||!a[i].Hidden&&-1==o?o=i:1==a[i].Hidden&&-1==s&&(s=i);if(!(s>o))vu(e,135),vu(e,158,(n=o,r||(r=gu(29)),r.write_shift(-4,0),r.write_shift(-4,460),r.write_shift(4,28800),r.write_shift(4,17600),r.write_shift(4,500),r.write_shift(4,n),r.write_shift(4,n),r.write_shift(1,120),r.length>r.l?r.slice(0,r.l):r)),vu(e,136)}}function lm(e,t){var n=bu();return vu(n,131),vu(n,128,function(e,t){t||(t=gu(127));for(var n=0;4!=n;++n)t.write_shift(4,0);return Bu("SheetJS",t),Bu(hs.version,t),Bu(hs.version,t),Bu("7262",t),t.length>t.l?t.slice(0,t.l):t}()),vu(n,153,function(e,t){t||(t=gu(72));var n=0;return e&&e.filterPrivacy&&(n|=8),t.write_shift(4,n),t.write_shift(4,0),Hu(e&&e.CodeName||"ThisWorkbook",t),t.slice(0,t.l)}(e.Workbook&&e.Workbook.WBProps||null)),sm(n,e),function(e,t){vu(e,143);for(var n=0;n!=t.SheetNames.length;++n)vu(e,156,om({Hidden:t.Workbook&&t.Workbook.Sheets&&t.Workbook.Sheets[n]&&t.Workbook.Sheets[n].Hidden||0,iTabID:n+1,strRelID:"rId"+(n+1),name:t.SheetNames[n]}));vu(e,144)}(n,e),vu(n,132),n.end()}function cm(e,t,n,r,a){return(".bin"===t.slice(-4)?em:Bh)(e,n,r,a)}function um(e,t,n){return(".bin"===t.slice(-4)?Gp:Vp)(e)}function dm(e,t){var n=[];return e.Props&&n.push(function(e,t){var n=[];return Kl(Cd).map((function(e){for(var t=0;t<_d.length;++t)if(_d[t][1]==e)return _d[t];for(t=0;t<Td.length;++t)if(Td[t][1]==e)return Td[t];throw e})).forEach((function(r){if(null!=e[r[1]]){var a=t&&t.Props&&null!=t.Props[r[1]]?t.Props[r[1]]:e[r[1]];"date"===r[2]&&(a=new Date(a).toISOString().replace(/\.\d*Z/,"Z")),"number"==typeof a?a=String(a):!0===a||!1===a?a=a?"1":"0":a instanceof Date&&(a=new Date(a).toISOString().replace(/\.\d*Z/,"")),n.push(hc(Cd[r[1]]||r[1],a))}})),fc("DocumentProperties",n.join(""),{xmlns:Cc})}(e.Props,t)),e.Custprops&&n.push(function(e,t){var n=["Worksheets","SheetNames"],r="CustomDocumentProperties",a=[];return e&&Kl(e).forEach((function(t){if(Object.prototype.hasOwnProperty.call(e,t)){for(var r=0;r<_d.length;++r)if(t==_d[r][1])return;for(r=0;r<Td.length;++r)if(t==Td[r][1])return;for(r=0;r<n.length;++r)if(t==n[r])return;var i=e[t],o="string";"number"==typeof i?(o="float",i=String(i)):!0===i||!1===i?(o="boolean",i=i?"1":"0"):i=String(i),a.push(fc(rc(t),i,{"dt:dt":o}))}})),t&&Kl(t).forEach((function(n){if(Object.prototype.hasOwnProperty.call(t,n)&&(!e||!Object.prototype.hasOwnProperty.call(e,n))){var r=t[n],i="string";"number"==typeof r?(i="float",r=String(r)):!0===r||!1===r?(i="boolean",r=r?"1":"0"):r instanceof Date?(i="dateTime.tz",r=r.toISOString()):r=String(r),a.push(fc(rc(n),r,{"dt:dt":i}))}})),"<"+r+' xmlns="'+Cc+'">'+a.join("")+"</"+r+">"}(e.Props,e.Custprops)),n.join("")}function pm(e){return fc("NamedRange",null,{"ss:Name":e.Name,"ss:RefersTo":"="+Wp(e.Ref,{r:0,c:0})})}function hm(e,t,n,r,a,i,o){if(!e||null==e.v&&null==e.f)return"";var s={};if(e.f&&(s["ss:Formula"]="="+nc(Wp(e.f,o))),e.F&&e.F.slice(0,t.length)==t){var l=Au(e.F.slice(t.length+1));s["ss:ArrayRange"]="RC:R"+(l.r==o.r?"":"["+(l.r-o.r)+"]")+"C"+(l.c==o.c?"":"["+(l.c-o.c)+"]")}if(e.l&&e.l.Target&&(s["ss:HRef"]=nc(e.l.Target),e.l.Tooltip&&(s["x:HRefScreenTip"]=nc(e.l.Tooltip))),n["!merges"])for(var c=n["!merges"],u=0;u!=c.length;++u)c[u].s.c==o.c&&c[u].s.r==o.r&&(c[u].e.c>c[u].s.c&&(s["ss:MergeAcross"]=c[u].e.c-c[u].s.c),c[u].e.r>c[u].s.r&&(s["ss:MergeDown"]=c[u].e.r-c[u].s.r));var d="",p="";switch(e.t){case"z":if(!r.sheetStubs)return"";break;case"n":d="Number",p=String(e.v);break;case"b":d="Boolean",p=e.v?"1":"0";break;case"e":d="Error",p=md[e.v];break;case"d":d="DateTime",p=new Date(e.v).toISOString(),null==e.z&&(e.z=e.z||Js[14]);break;case"s":d="String",p=((e.v||"")+"").replace(ec,(function(e){return Xl[e]})).replace(ac,(function(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"}))}var h=Dh(r.cellXfs,e,r);s["ss:StyleID"]="s"+(21+h),s["ss:Index"]=o.c+1;var m=null!=e.v?p:"",f="z"==e.t?"":'<Data ss:Type="'+d+'">'+m+"</Data>";return(e.c||[]).length>0&&(f+=e.c.map((function(e){var t=fc("ss:Data",(e.t||"").replace(/(\r\n|[\r\n])/g,"&#10;"),{xmlns:"http://www.w3.org/TR/REC-html40"});return fc("Comment",t,{"ss:Author":e.a})})).join("")),fc("Cell",f,s)}function mm(e,t){var n='<Row ss:Index="'+(e+1)+'"';return t&&(t.hpt&&!t.hpx&&(t.hpx=Sp(t.hpt)),t.hpx&&(n+=' ss:AutoFitHeight="0" ss:Height="'+t.hpx+'"'),t.hidden&&(n+=' ss:Hidden="1"')),n+">"}function fm(e,t,n){var r=[],a=n.SheetNames[e],i=n.Sheets[a],o=i?function(e,t,n,r){if(!e)return"";if(!((r||{}).Workbook||{}).Names)return"";for(var a=r.Workbook.Names,i=[],o=0;o<a.length;++o){var s=a[o];s.Sheet==n&&(s.Name.match(/^_xlfn\./)||i.push(pm(s)))}return i.join("")}(i,0,e,n):"";return o.length>0&&r.push("<Names>"+o+"</Names>"),o=i?function(e,t,n,r){if(!e["!ref"])return"";var a=Ru(e["!ref"]),i=e["!merges"]||[],o=0,s=[];e["!cols"]&&e["!cols"].forEach((function(e,t){vp(e);var n=!!e.width,r=jh(t,e),a={"ss:Index":t+1};n&&(a["ss:Width"]=yp(r.width)),e.hidden&&(a["ss:Hidden"]="1"),s.push(fc("Column",null,a))}));for(var l=Array.isArray(e),c=a.s.r;c<=a.e.r;++c){for(var u=[mm(c,(e["!rows"]||[])[c])],d=a.s.c;d<=a.e.c;++d){var p=!1;for(o=0;o!=i.length;++o)if(!(i[o].s.c>d||i[o].s.r>c||i[o].e.c<d||i[o].e.r<c)){i[o].s.c==d&&i[o].s.r==c||(p=!0);break}if(!p){var h={r:c,c:d},m=Ou(h),f=l?(e[c]||[])[d]:e[m];u.push(hm(f,m,e,t,0,0,h))}}u.push("</Row>"),u.length>2&&s.push(u.join(""))}return s.join("")}(i,t):"",o.length>0&&r.push("<Table>"+o+"</Table>"),r.push(function(e,t,n,r){if(!e)return"";var a=[];if(e["!margins"]&&(a.push("<PageSetup>"),e["!margins"].header&&a.push(fc("Header",null,{"x:Margin":e["!margins"].header})),e["!margins"].footer&&a.push(fc("Footer",null,{"x:Margin":e["!margins"].footer})),a.push(fc("PageMargins",null,{"x:Bottom":e["!margins"].bottom||"0.75","x:Left":e["!margins"].left||"0.7","x:Right":e["!margins"].right||"0.7","x:Top":e["!margins"].top||"0.75"})),a.push("</PageSetup>")),r&&r.Workbook&&r.Workbook.Sheets&&r.Workbook.Sheets[n])if(r.Workbook.Sheets[n].Hidden)a.push(fc("Visible",1==r.Workbook.Sheets[n].Hidden?"SheetHidden":"SheetVeryHidden",{}));else{for(var i=0;i<n&&(!r.Workbook.Sheets[i]||r.Workbook.Sheets[i].Hidden);++i);i==n&&a.push("<Selected/>")}return((((r||{}).Workbook||{}).Views||[])[0]||{}).RTL&&a.push("<DisplayRightToLeft/>"),e["!protect"]&&(a.push(hc("ProtectContents","True")),e["!protect"].objects&&a.push(hc("ProtectObjects","True")),e["!protect"].scenarios&&a.push(hc("ProtectScenarios","True")),null==e["!protect"].selectLockedCells||e["!protect"].selectLockedCells?null==e["!protect"].selectUnlockedCells||e["!protect"].selectUnlockedCells||a.push(hc("EnableSelection","UnlockedCells")):a.push(hc("EnableSelection","NoSelection")),[["formatCells","AllowFormatCells"],["formatColumns","AllowSizeCols"],["formatRows","AllowSizeRows"],["insertColumns","AllowInsertCols"],["insertRows","AllowInsertRows"],["insertHyperlinks","AllowInsertHyperlinks"],["deleteColumns","AllowDeleteCols"],["deleteRows","AllowDeleteRows"],["sort","AllowSort"],["autoFilter","AllowFilter"],["pivotTables","AllowUsePivotTables"]].forEach((function(t){e["!protect"][t[0]]&&a.push("<"+t[1]+"/>")}))),0==a.length?"":fc("WorksheetOptions",a.join(""),{xmlns:Rc})}(i,0,e,n)),r.join("")}function ym(e,t){t||(t={}),e.SSF||(e.SSF=$l(Js)),e.SSF&&(_l(),xl(e.SSF),t.revssf=jl(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF,t.cellXfs=[],Dh(t.cellXfs,{},{revssf:{General:0}}));var n=[];n.push(dm(e,t)),n.push(""),n.push(""),n.push("");for(var r=0;r<e.SheetNames.length;++r)n.push(fc("Worksheet",fm(r,t,e),{"ss:Name":nc(e.SheetNames[r])}));return n[2]=function(e,t){var n=['<Style ss:ID="Default" ss:Name="Normal"><NumberFormat/></Style>'];return t.cellXfs.forEach((function(e,t){var r=[];r.push(fc("NumberFormat",null,{"ss:Format":nc(Js[e.numFmtId])}));var a={"ss:ID":"s"+(21+t)};n.push(fc("Style",r.join(""),a))})),fc("Styles",n.join(""))}(0,t),n[3]=function(e){if(!((e||{}).Workbook||{}).Names)return"";for(var t=e.Workbook.Names,n=[],r=0;r<t.length;++r){var a=t[r];null==a.Sheet&&(a.Name.match(/^_xlfn\./)||n.push(pm(a)))}return fc("Names",n.join(""))}(e),Zl+fc("Workbook",n.join(""),{xmlns:jc,"xmlns:o":Cc,"xmlns:x":Rc,"xmlns:ss":jc,"xmlns:dt":Pc,"xmlns:html":Lc})}var gm="e0859ff2f94f6810ab9108002b27b3d9",bm="02d5cdd59c2e1b10939708002b2cf9ae",vm="05d5cdd59c2e1b10939708002b2cf9ae";function wm(e,t){var n=t||{},r=Tl.utils.cfb_new({root:"R"}),a="/Workbook";switch(n.bookType||"xls"){case"xls":n.bookType="biff8";case"xla":n.bookType||(n.bookType="xla");case"biff8":a="/Workbook",n.biff=8;break;case"biff5":a="/Book",n.biff=5;break;default:throw new Error("invalid type "+n.bookType+" for XLS CFB")}return Tl.utils.cfb_add(r,a,Cm(e,n)),8==n.biff&&(e.Props||e.Custprops)&&function(e,t){var n,r=[],a=[],i=[],o=0,s=Cl(ud,"n"),l=Cl(dd,"n");if(e.Props)for(n=Kl(e.Props),o=0;o<n.length;++o)(Object.prototype.hasOwnProperty.call(s,n[o])?r:Object.prototype.hasOwnProperty.call(l,n[o])?a:i).push([n[o],e.Props[n[o]]]);if(e.Custprops)for(n=Kl(e.Custprops),o=0;o<n.length;++o)Object.prototype.hasOwnProperty.call(e.Props||{},n[o])||(Object.prototype.hasOwnProperty.call(s,n[o])?r:Object.prototype.hasOwnProperty.call(l,n[o])?a:i).push([n[o],e.Custprops[n[o]]]);var c=[];for(o=0;o<i.length;++o)jd.indexOf(i[o][0])>-1||Ad.indexOf(i[o][0])>-1||null!=i[o][1]&&c.push(i[o]);a.length&&Tl.utils.cfb_add(t,"/SummaryInformation",Nd(a,gm,l,dd)),(r.length||c.length)&&Tl.utils.cfb_add(t,"/DocumentSummaryInformation",Nd(r,bm,s,ud,c.length?c:null,vm))}(e,r),8==n.biff&&e.vbaraw&&function(e,t){t.FullPaths.forEach((function(n,r){if(0!=r){var a=n.replace(/[^\/]*[\/]/,"/_VBA_PROJECT_CUR/");"/"!==a.slice(-1)&&Tl.utils.cfb_add(e,a,t.FileIndex[r].content)}}))}(r,Tl.read(e.vbaraw,{type:"string"==typeof e.vbaraw?"binary":"buffer"})),r}var Sm={0:{f:function(e,t){var n={},r=e.l+t;n.r=e.read_shift(4),e.l+=4;var a=e.read_shift(2);e.l+=1;var i=e.read_shift(1);return e.l=r,7&i&&(n.level=7&i),16&i&&(n.hidden=!0),32&i&&(n.hpt=a/20),n}},1:{f:function(e){return[$u(e)]}},2:{f:function(e){return[$u(e),nd(e),"n"]}},3:{f:function(e){return[$u(e),e.read_shift(1),"e"]}},4:{f:function(e){return[$u(e),e.read_shift(1),"b"]}},5:{f:function(e){return[$u(e),sd(e),"n"]}},6:{f:function(e){return[$u(e),Fu(e),"str"]}},7:{f:function(e){return[$u(e),e.read_shift(4),"s"]}},8:{f:function(e,t,n){var r=e.l+t,a=$u(e);a.r=n["!row"];var i=[a,Fu(e),"str"];if(n.cellFormula){e.l+=2;var o=xh(e,r-e.l,n);i[3]=vh(o,0,a,n.supbooks,n)}else e.l=r;return i}},9:{f:function(e,t,n){var r=e.l+t,a=$u(e);a.r=n["!row"];var i=[a,sd(e),"n"];if(n.cellFormula){e.l+=2;var o=xh(e,r-e.l,n);i[3]=vh(o,0,a,n.supbooks,n)}else e.l=r;return i}},10:{f:function(e,t,n){var r=e.l+t,a=$u(e);a.r=n["!row"];var i=[a,e.read_shift(1),"b"];if(n.cellFormula){e.l+=2;var o=xh(e,r-e.l,n);i[3]=vh(o,0,a,n.supbooks,n)}else e.l=r;return i}},11:{f:function(e,t,n){var r=e.l+t,a=$u(e);a.r=n["!row"];var i=[a,e.read_shift(1),"e"];if(n.cellFormula){e.l+=2;var o=xh(e,r-e.l,n);i[3]=vh(o,0,a,n.supbooks,n)}else e.l=r;return i}},12:{f:function(e){return[zu(e)]}},13:{f:function(e){return[zu(e),nd(e),"n"]}},14:{f:function(e){return[zu(e),e.read_shift(1),"e"]}},15:{f:function(e){return[zu(e),e.read_shift(1),"b"]}},16:{f:function(e){return[zu(e),sd(e),"n"]}},17:{f:function(e){return[zu(e),Fu(e),"str"]}},18:{f:function(e){return[zu(e),e.read_shift(4),"s"]}},19:{f:Uu},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:function(e,t,n){var r=e.l+t;e.l+=4,e.l+=1;var a=e.read_shift(4),i=Xu(e),o=_h(e,0,n),s=Qu(e);e.l=r;var l={Name:i,Ptg:o};return a<268435455&&(l.Sheet=a),s&&(l.Comment=s),l}},40:{},42:{},43:{f:function(e,t,n){var r={};r.sz=e.read_shift(2)/20;var a=function(e){var t=e.read_shift(1);return e.l++,{fBold:1&t,fItalic:2&t,fUnderline:4&t,fStrikeout:8&t,fOutline:16&t,fShadow:32&t,fCondense:64&t,fExtend:128&t}}(e);switch(a.fItalic&&(r.italic=1),a.fCondense&&(r.condense=1),a.fExtend&&(r.extend=1),a.fShadow&&(r.shadow=1),a.fOutline&&(r.outline=1),a.fStrikeout&&(r.strike=1),700===e.read_shift(2)&&(r.bold=1),e.read_shift(2)){case 1:r.vertAlign="superscript";break;case 2:r.vertAlign="subscript"}var i=e.read_shift(1);0!=i&&(r.underline=i);var o=e.read_shift(1);o>0&&(r.family=o);var s=e.read_shift(1);switch(s>0&&(r.charset=s),e.l++,r.color=function(e){var t={},n=e.read_shift(1)>>>1,r=e.read_shift(1),a=e.read_shift(2,"i"),i=e.read_shift(1),o=e.read_shift(1),s=e.read_shift(1);switch(e.l++,n){case 0:t.auto=1;break;case 1:t.index=r;var l=hd[r];l&&(t.rgb=mp(l));break;case 2:t.rgb=mp([i,o,s]);break;case 3:t.theme=r}return 0!=a&&(t.tint=a>0?a/32767:a/32768),t}(e),e.read_shift(1)){case 1:r.scheme="major";break;case 2:r.scheme="minor"}return r.name=Fu(e),r}},44:{f:function(e,t){return[e.read_shift(2),Fu(e)]}},45:{f:Tp},46:{f:Cp},47:{f:function(e,t){var n=e.l+t,r=e.read_shift(2),a=e.read_shift(2);return e.l=n,{ixfe:r,numFmtId:a}}},48:{},49:{f:function(e){return e.read_shift(4,"i")}},50:{},51:{f:function(e){for(var t=[],n=e.read_shift(4);n-- >0;)t.push([e.read_shift(4),e.read_shift(4)]);return t}},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:function(e,t,n){if(!n.cellStyles)return yu(e,t);var r=n&&n.biff>=12?4:2,a=e.read_shift(r),i=e.read_shift(r),o=e.read_shift(r),s=e.read_shift(r),l=e.read_shift(2);2==r&&(e.l+=2);var c={s:a,e:i,w:o,ixfe:s,flags:l};return(n.biff>=5||!n.biff)&&(c.level=l>>8&7),c}},62:{f:function(e){return[$u(e),Uu(e),"is"]}},63:{f:function(e){var t={};t.i=e.read_shift(4);var n={};n.r=e.read_shift(4),n.c=e.read_shift(4),t.r=Ou(n);var r=e.read_shift(1);return 2&r&&(t.l="1"),8&r&&(t.a="1"),t}},64:{f:function(){}},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:yu,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:function(e){var t=e.read_shift(2);return e.l+=28,{RTL:32&t}}},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:function(e,t){var n={},r=e[e.l];return++e.l,n.above=!(64&r),n.left=!(128&r),e.l+=18,n.name=Yu(e),n}},148:{f:Uh,p:16},151:{f:function(){}},152:{},153:{f:function(e,t){var n={},r=e.read_shift(4);n.defaultThemeVersion=e.read_shift(4);var a=t>8?Fu(e):"";return a.length>0&&(n.CodeName=a),n.autoCompressPictures=!!(65536&r),n.backupFile=!!(64&r),n.checkCompatibility=!!(4096&r),n.date1904=!!(1&r),n.filterPrivacy=!!(8&r),n.hidePivotFieldList=!!(1024&r),n.promptedSolutions=!!(16&r),n.publishItems=!!(2048&r),n.refreshAllConnections=!!(262144&r),n.saveExternalLinkValues=!!(128&r),n.showBorderUnselectedTables=!!(4&r),n.showInkAnnotation=!!(32&r),n.showObjects=["all","placeholders","none"][r>>13&3],n.showPivotChartFilter=!!(32768&r),n.updateLinks=["userSet","never","always"][r>>8&3],n}},154:{},155:{},156:{f:function(e,t){var n={};return n.Hidden=e.read_shift(4),n.iTabID=e.read_shift(4),n.strRelID=ed(e),n.name=Fu(e),n}},157:{},158:{},159:{T:1,f:function(e){return[e.read_shift(4),e.read_shift(4)]}},160:{T:-1},161:{T:1,f:id},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:Gh},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:function(e,t){return{flags:e.read_shift(4),version:e.read_shift(4),name:Fu(e)}}},336:{T:-1},337:{f:function(e){return e.l+=4,0!=e.read_shift(4)},T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:ed},357:{},358:{},359:{},360:{T:1},361:{},362:{f:function(e,t,n){if(n.biff<8)return function(e,t,n){3==e[e.l+1]&&e[e.l]++;var r=Vd(e,0,n);return 3==r.charCodeAt(0)?r.slice(1):r}(e,0,n);for(var r=[],a=e.l+t,i=e.read_shift(n.biff>8?4:2);0!=i--;)r.push(zd(e,n.biff,n));if(e.l!=a)throw new Error("Bad ExternSheet: "+e.l+" != "+a);return r}},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:function(e,t,n){var r=e.l+t,a=ad(e),i=e.read_shift(1),o=[a];if(o[2]=i,n.cellFormula){var s=Eh(e,r-e.l,n);o[1]=s}else e.l=r;return o}},427:{f:function(e,t,n){var r=e.l+t,a=[id(e)];if(n.cellFormula){var i=kh(e,r-e.l,n);a[1]=i,e.l=r}else e.l=r;return a}},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:function(e){var t={};return qh.forEach((function(n){t[n]=sd(e)})),t}},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:function(){}},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:function(e,t){var n=e.l+t,r=id(e),a=Qu(e),i=Fu(e),o=Fu(e),s=Fu(e);e.l=n;var l={rfx:r,relId:a,loc:i,display:s};return o&&(l.Tooltip=o),l}},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:ed},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:Jp},633:{T:1},634:{T:-1},635:{T:1,f:function(e){var t={};t.iauthor=e.read_shift(4);var n=id(e);return t.rfx=n.s,t.ref=Ou(n.s),e.l+=16,t}},636:{T:-1},637:{f:Ju},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:function(e,t){return e.l+=10,{name:Fu(e)}}},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:function(){}},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}};function Em(e,t,n,r){var a=t;if(!isNaN(a)){var i=r||(n||[]).length||0,o=e.next(4);o.write_shift(2,a),o.write_shift(2,i),i>0&&au(n)&&e.push(n)}}function xm(e,t,n){return e||(e=gu(7)),e.write_shift(2,t),e.write_shift(2,n),e.write_shift(2,0),e.write_shift(1,0),e}function _m(e,t,n,r){if(null!=t.v)switch(t.t){case"d":case"n":var a="d"==t.t?Dl(Jl(t.v)):t.v;return void(a==(0|a)&&a>=0&&a<65536?Em(e,2,function(e,t,n){var r=gu(9);return xm(r,e,t),r.write_shift(2,n),r}(n,r,a)):Em(e,3,function(e,t,n){var r=gu(15);return xm(r,e,t),r.write_shift(8,n,"f"),r}(n,r,a)));case"b":case"e":return void Em(e,5,function(e,t,n,r){var a=gu(9);return xm(a,e,t),Bd(n,r||"b",a),a}(n,r,t.v,t.t));case"s":case"str":return void Em(e,4,function(e,t,n){var r=gu(8+2*n.length);return xm(r,e,t),r.write_shift(1,n.length),r.write_shift(n.length,n,"sbcs"),r.l<r.length?r.slice(0,r.l):r}(n,r,(t.v||"").slice(0,255)))}Em(e,1,xm(null,n,r))}function km(e,t){for(var n=t||{},r=bu(),a=0,i=0;i<e.SheetNames.length;++i)e.SheetNames[i]==n.sheet&&(a=i);if(0==a&&n.sheet&&e.SheetNames[0]!=n.sheet)throw new Error("Sheet not found: "+n.sheet);return Em(r,4==n.biff?1033:3==n.biff?521:9,Hd(0,16,n)),function(e,t,n,r){var a,i=Array.isArray(t),o=Ru(t["!ref"]||"A1"),s="",l=[];if(o.e.c>255||o.e.r>16383){if(r.WTF)throw new Error("Range "+(t["!ref"]||"A1")+" exceeds format limit A1:IV16384");o.e.c=Math.min(o.e.c,255),o.e.r=Math.min(o.e.c,16383),a=Cu(o)}for(var c=o.s.r;c<=o.e.r;++c){s=ku(c);for(var u=o.s.c;u<=o.e.c;++u){c===o.s.r&&(l[u]=Tu(u)),a=l[u]+s;var d=i?(t[c]||[])[u]:t[a];d&&_m(e,d,c,u)}}}(r,e.Sheets[e.SheetNames[a]],0,n),Em(r,10),r.end()}function Im(e,t,n){Em(e,49,function(e,t){var n=e.name||"Arial",r=t&&5==t.biff,a=gu(r?15+n.length:16+2*n.length);return a.write_shift(2,20*(e.sz||12)),a.write_shift(4,0),a.write_shift(2,400),a.write_shift(4,0),a.write_shift(2,0),a.write_shift(1,n.length),r||a.write_shift(1,1),a.write_shift((r?1:2)*n.length,n,r?"sbcs":"utf16le"),a}({sz:12,color:{theme:1},name:"Arial",family:2,scheme:"minor"},n))}function Tm(e,t){if(t){var n=0;t.forEach((function(t,r){++n<=256&&t&&Em(e,125,function(e,t){var n=gu(12);n.write_shift(2,t),n.write_shift(2,t),n.write_shift(2,256*e.width),n.write_shift(2,0);var r=0;return e.hidden&&(r|=1),n.write_shift(1,r),r=e.level||0,n.write_shift(1,r),n.write_shift(2,0),n}(jh(r,t),r))}))}}function Am(e,t,n,r,a){var i=16+Dh(a.cellXfs,t,a);if(null!=t.v||t.bf)if(t.bf)Em(e,6,wh(t,n,r,0,i));else switch(t.t){case"d":case"n":Em(e,515,function(e,t,n,r){var a=gu(14);return qd(e,t,r,a),ld(n,a),a}(n,r,"d"==t.t?Dl(Jl(t.v)):t.v,i));break;case"b":case"e":Em(e,517,function(e,t,n,r,a,i){var o=gu(8);return qd(e,t,r,o),Bd(n,i,o),o}(n,r,t.v,i,0,t.t));break;case"s":case"str":if(a.bookSST)Em(e,253,function(e,t,n,r){var a=gu(10);return qd(e,t,r,a),a.write_shift(4,n),a}(n,r,Rh(a.Strings,t.v,a.revStrings),i));else Em(e,516,function(e,t,n,r,a){var i=!a||8==a.biff,o=gu(+i+8+(1+i)*n.length);return qd(e,t,r,o),o.write_shift(2,n.length),i&&o.write_shift(1,1),o.write_shift((1+i)*n.length,n,i?"utf16le":"sbcs"),o}(n,r,(t.v||"").slice(0,255),i,a));break;default:Em(e,513,qd(n,r,i))}else Em(e,513,qd(n,r,i))}function Om(e,t,n){var r,a,i,o=bu(),s=n.SheetNames[e],l=n.Sheets[s]||{},c=(n||{}).Workbook||{},u=(c.Sheets||[])[e]||{},d=Array.isArray(l),p=8==t.biff,h="",m=[],f=Ru(l["!ref"]||"A1"),y=p?65536:16384;if(f.e.c>255||f.e.r>=y){if(t.WTF)throw new Error("Range "+(l["!ref"]||"A1")+" exceeds format limit A1:IV16384");f.e.c=Math.min(f.e.c,255),f.e.r=Math.min(f.e.c,y-1)}Em(o,2057,Hd(0,16,t)),Em(o,13,Fd(1)),Em(o,12,Fd(100)),Em(o,15,Ld(!0)),Em(o,17,Ld(!1)),Em(o,16,ld(.001)),Em(o,95,Ld(!0)),Em(o,42,Ld(!1)),Em(o,43,Ld(!1)),Em(o,130,Fd(1)),Em(o,128,(a=[0,0],(i=gu(8)).write_shift(4,0),i.write_shift(2,a[0]?a[0]+1:0),i.write_shift(2,a[1]?a[1]+1:0),i)),Em(o,131,Ld(!1)),Em(o,132,Ld(!1)),p&&Tm(o,l["!cols"]),Em(o,512,function(e,t){var n=8!=t.biff&&t.biff?2:4,r=gu(2*n+6);return r.write_shift(n,e.s.r),r.write_shift(n,e.e.r+1),r.write_shift(2,e.s.c),r.write_shift(2,e.e.c+1),r.write_shift(2,0),r}(f,t)),p&&(l["!links"]=[]);for(var g=f.s.r;g<=f.e.r;++g){h=ku(g);for(var b=f.s.c;b<=f.e.c;++b){g===f.s.r&&(m[b]=Tu(b)),r=m[b]+h;var v=d?(l[g]||[])[b]:l[r];v&&(Am(o,v,g,b,t),p&&v.l&&l["!links"].push([r,v.l]))}}var w=u.CodeName||u.name||s;return p&&Em(o,574,function(e){var t=gu(18),n=1718;return e&&e.RTL&&(n|=64),t.write_shift(2,n),t.write_shift(4,0),t.write_shift(4,64),t.write_shift(4,0),t.write_shift(4,0),t}((c.Views||[])[0])),p&&(l["!merges"]||[]).length&&Em(o,229,function(e){var t=gu(2+8*e.length);t.write_shift(2,e.length);for(var n=0;n<e.length;++n)Yd(e[n],t);return t}(l["!merges"])),p&&function(e,t){for(var n=0;n<t["!links"].length;++n){var r=t["!links"][n];Em(e,440,ep(r)),r[1].Tooltip&&Em(e,2048,tp(r))}delete t["!links"]}(o,l),Em(o,442,Jd(w)),p&&function(e,t){var n=gu(19);n.write_shift(4,2151),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(2,3),n.write_shift(1,1),n.write_shift(4,0),Em(e,2151,n),(n=gu(39)).write_shift(4,2152),n.write_shift(4,0),n.write_shift(4,0),n.write_shift(2,3),n.write_shift(1,0),n.write_shift(4,0),n.write_shift(2,1),n.write_shift(4,4),n.write_shift(2,0),Yd(Ru(t["!ref"]||"A1"),n),n.write_shift(4,4),Em(e,2152,n)}(o,l),Em(o,10),o.end()}function Km(e,t,n){var r,a=bu(),i=(e||{}).Workbook||{},o=i.Sheets||[],s=i.WBProps||{},l=8==n.biff,c=5==n.biff;(Em(a,2057,Hd(0,5,n)),"xla"==n.bookType&&Em(a,135),Em(a,225,l?Fd(1200):null),Em(a,193,function(e,t){t||(t=gu(e));for(var n=0;n<e;++n)t.write_shift(1,0);return t}(2)),c&&Em(a,191),c&&Em(a,192),Em(a,226),Em(a,92,function(e,t){var n=!t||8==t.biff,r=gu(n?112:54);for(r.write_shift(8==t.biff?2:1,7),n&&r.write_shift(1,0),r.write_shift(4,859007059),r.write_shift(4,5458548|(n?0:536870912));r.l<r.length;)r.write_shift(1,n?0:32);return r}(0,n)),Em(a,66,Fd(l?1200:1252)),l&&Em(a,353,Fd(0)),l&&Em(a,448),Em(a,317,function(e){for(var t=gu(2*e),n=0;n<e;++n)t.write_shift(2,n+1);return t}(e.SheetNames.length)),l&&e.vbaraw&&Em(a,211),l&&e.vbaraw)&&Em(a,442,Jd(s.CodeName||"ThisWorkbook"));Em(a,156,Fd(17)),Em(a,25,Ld(!1)),Em(a,18,Ld(!1)),Em(a,19,Fd(0)),l&&Em(a,431,Ld(!1)),l&&Em(a,444,Fd(0)),Em(a,61,((r=gu(18)).write_shift(2,0),r.write_shift(2,0),r.write_shift(2,29280),r.write_shift(2,17600),r.write_shift(2,56),r.write_shift(2,0),r.write_shift(2,0),r.write_shift(2,1),r.write_shift(2,500),r)),Em(a,64,Ld(!1)),Em(a,141,Fd(0)),Em(a,34,Ld("true"==function(e){return e.Workbook&&e.Workbook.WBProps&&function(e){switch(e){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}(e.Workbook.WBProps.date1904)?"true":"false"}(e))),Em(a,14,Ld(!0)),l&&Em(a,439,Ld(!1)),Em(a,218,Fd(0)),Im(a,0,n),function(e,t,n){t&&[[5,8],[23,26],[41,44],[50,392]].forEach((function(r){for(var a=r[0];a<=r[1];++a)null!=t[a]&&Em(e,1054,Zd(a,t[a],n))}))}(a,e.SSF,n),function(e,t){for(var n=0;n<16;++n)Em(e,224,Xd({numFmtId:0,style:!0},0,t));t.cellXfs.forEach((function(n){Em(e,224,Xd(n,0,t))}))}(a,n),l&&Em(a,352,Ld(!1));var u=a.end(),d=bu();l&&Em(d,140,function(e){return e||(e=gu(4)),e.write_shift(2,1),e.write_shift(2,1),e}()),l&&n.Strings&&function(e,t,n,r){var a=r||(n||[]).length||0;if(a<=8224)return Em(e,t,n,a);var i=t;if(!isNaN(i)){for(var o=n.parts||[],s=0,l=0,c=0;c+(o[s]||8224)<=8224;)c+=o[s]||8224,s++;var u=e.next(4);for(u.write_shift(2,i),u.write_shift(2,c),e.push(n.slice(l,l+c)),l+=c;l<a;){for((u=e.next(4)).write_shift(2,60),c=0;c+(o[s]||8224)<=8224;)c+=o[s]||8224,s++;u.write_shift(2,c),e.push(n.slice(l,l+c)),l+=c}}}(d,252,function(e,t){var n=gu(8);n.write_shift(4,e.Count),n.write_shift(4,e.Unique);for(var r=[],a=0;a<e.length;++a)r[a]=Ud(e[a]);var i=Cs([n].concat(r));return i.parts=[n.length].concat(r.map((function(e){return e.length}))),i}(n.Strings)),Em(d,10);var p=d.end(),h=bu(),m=0,f=0;for(f=0;f<e.SheetNames.length;++f)m+=(l?12:11)+(l?2:1)*e.SheetNames[f].length;var y=u.length+m+p.length;for(f=0;f<e.SheetNames.length;++f){Em(h,133,Qd({pos:y,hs:(o[f]||{}).Hidden||0,dt:0,name:e.SheetNames[f]},n)),y+=t[f].length}var g=h.end();if(m!=g.length)throw new Error("BS8 "+m+" != "+g.length);var b=[];return u.length&&b.push(u),g.length&&b.push(g),p.length&&b.push(p),Cs(b)}function Cm(e,t){for(var n=0;n<=e.SheetNames.length;++n){var r=e.Sheets[e.SheetNames[n]];if(r&&r["!ref"])Ku(r["!ref"]).e.c>255&&"undefined"!=typeof console&&console.error&&console.error("Worksheet '"+e.SheetNames[n]+"' extends beyond column IV (255).  Data may be lost.")}var a=t||{};switch(a.biff||2){case 8:case 5:return function(e,t){var n=t||{},r=[];e&&!e.SSF&&(e.SSF=$l(Js)),e&&e.SSF&&(_l(),xl(e.SSF),n.revssf=jl(e.SSF),n.revssf[e.SSF[65535]]=0,n.ssf=e.SSF),n.Strings=[],n.Strings.Count=0,n.Strings.Unique=0,rf(n),n.cellXfs=[],Dh(n.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={});for(var a=0;a<e.SheetNames.length;++a)r[r.length]=Om(a,n,e);return r.unshift(Km(e,r,n)),Cs(r)}(e,t);case 4:case 3:case 2:return km(e,t)}throw new Error("invalid type "+a.bookType+" for BIFF")}function Rm(e,t,n,r){for(var a=e["!merges"]||[],i=[],o=t.s.c;o<=t.e.c;++o){for(var s=0,l=0,c=0;c<a.length;++c)if(!(a[c].s.r>n||a[c].s.c>o||a[c].e.r<n||a[c].e.c<o)){if(a[c].s.r<n||a[c].s.c<o){s=-1;break}s=a[c].e.r-a[c].s.r+1,l=a[c].e.c-a[c].s.c+1;break}if(!(s<0)){var u=Ou({r:n,c:o}),d=r.dense?(e[n]||[])[o]:e[u],p=d&&null!=d.v&&(d.h||((d.w||(Pu(d),d.w)||"")+"").replace(ec,(function(e){return Xl[e]})).replace(/\n/g,"<br/>").replace(ac,(function(e){return"&#x"+("000"+e.charCodeAt(0).toString(16)).slice(-4)+";"})))||"",h={};s>1&&(h.rowspan=s),l>1&&(h.colspan=l),r.editable?p='<span contenteditable="true">'+p+"</span>":d&&(h["data-t"]=d&&d.t||"z",null!=d.v&&(h["data-v"]=d.v),null!=d.z&&(h["data-z"]=d.z),d.l&&"#"!=(d.l.Target||"#").charAt(0)&&(p='<a href="'+d.l.Target+'">'+p+"</a>")),h.id=(r.id||"sjs")+"-"+u,i.push(fc("td",p,h))}}return"<tr>"+i.join("")+"</tr>"}function jm(e,t){var n=t||{},r=null!=n.header?n.header:'<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',a=null!=n.footer?n.footer:"</body></html>",i=[r],o=Ku(e["!ref"]);n.dense=Array.isArray(e),i.push(function(e,t,n){return[].join("")+"<table"+(n&&n.id?' id="'+n.id+'"':"")+">"}(0,0,n));for(var s=o.s.r;s<=o.e.r;++s)i.push(Rm(e,o,s,n));return i.push("</table>"+a),i.join("")}function Pm(e,t,n){var r=n||{},a=0,i=0;if(null!=r.origin)if("number"==typeof r.origin)a=r.origin;else{var o="string"==typeof r.origin?Au(r.origin):r.origin;a=o.r,i=o.c}var s=t.getElementsByTagName("tr"),l=Math.min(r.sheetRows||1e7,s.length),c={s:{r:0,c:0},e:{r:a,c:i}};if(e["!ref"]){var u=Ku(e["!ref"]);c.s.r=Math.min(c.s.r,u.s.r),c.s.c=Math.min(c.s.c,u.s.c),c.e.r=Math.max(c.e.r,u.e.r),c.e.c=Math.max(c.e.c,u.e.c),-1==a&&(c.e.r=a=u.e.r+1)}var d=[],p=0,h=e["!rows"]||(e["!rows"]=[]),m=0,f=0,y=0,g=0,b=0,v=0;for(e["!cols"]||(e["!cols"]=[]);m<s.length&&f<l;++m){var w=s[m];if(Nm(w)){if(r.display)continue;h[f]={hidden:!0}}var S=w.children;for(y=g=0;y<S.length;++y){var E=S[y];if(!r.display||!Nm(E)){var x=E.hasAttribute("data-v")?E.getAttribute("data-v"):E.hasAttribute("v")?E.getAttribute("v"):dc(E.innerHTML),_=E.getAttribute("data-z")||E.getAttribute("z");for(p=0;p<d.length;++p){var k=d[p];k.s.c==g+i&&k.s.r<f+a&&f+a<=k.e.r&&(g=k.e.c+1-i,p=-1)}v=+E.getAttribute("colspan")||1,((b=+E.getAttribute("rowspan")||1)>1||v>1)&&d.push({s:{r:f+a,c:g+i},e:{r:f+a+(b||1)-1,c:g+i+(v||1)-1}});var I={t:"s",v:x},T=E.getAttribute("data-t")||E.getAttribute("t")||"";null!=x&&(0==x.length?I.t=T||"z":r.raw||0==x.trim().length||"s"==T||("TRUE"===x?I={t:"b",v:!0}:"FALSE"===x?I={t:"b",v:!1}:isNaN(zl(x))?isNaN(Yl(x).getDate())||(I={t:"d",v:Jl(x)},r.cellDates||(I={t:"n",v:Dl(I.v)}),I.z=r.dateNF||Js[14]):I={t:"n",v:zl(x)})),void 0===I.z&&null!=_&&(I.z=_);var A="",O=E.getElementsByTagName("A");if(O&&O.length)for(var K=0;K<O.length&&(!O[K].hasAttribute("href")||"#"==(A=O[K].getAttribute("href")).charAt(0));++K);A&&"#"!=A.charAt(0)&&(I.l={Target:A}),r.dense?(e[f+a]||(e[f+a]=[]),e[f+a][g+i]=I):e[Ou({c:g+i,r:f+a})]=I,c.e.c<g+i&&(c.e.c=g+i),g+=v}}++f}return d.length&&(e["!merges"]=(e["!merges"]||[]).concat(d)),c.e.r=Math.max(c.e.r,f-1+a),e["!ref"]=Cu(c),f>=l&&(e["!fullref"]=Cu((c.e.r=s.length-m+f-1+a,c))),e}function Dm(e,t){return Pm((t||{}).dense?[]:{},e,t)}function Nm(e){var t="",n=function(e){return e.ownerDocument.defaultView&&"function"==typeof e.ownerDocument.defaultView.getComputedStyle?e.ownerDocument.defaultView.getComputedStyle:"function"==typeof getComputedStyle?getComputedStyle:null}(e);return n&&(t=n(e).getPropertyValue("display")),t||(t=e.style&&e.style.display),"none"===t}var Lm=function(){var e=["<office:master-styles>",'<style:master-page style:name="mp1" style:page-layout-name="mp1">',"<style:header/>",'<style:header-left style:display="false"/>',"<style:footer/>",'<style:footer-left style:display="false"/>',"</style:master-page>","</office:master-styles>"].join(""),t="<office:document-styles "+mc({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","office:version":"1.2"})+">"+e+"</office:document-styles>";return function(){return Zl+t}}(),Mm=function(){var e="          <table:table-cell />\n",t=function(t,n,r){var a=[];a.push('      <table:table table:name="'+nc(n.SheetNames[r])+'" table:style-name="ta1">\n');var i=0,o=0,s=Ku(t["!ref"]||"A1"),l=t["!merges"]||[],c=0,u=Array.isArray(t);if(t["!cols"])for(o=0;o<=s.e.c;++o)a.push("        <table:table-column"+(t["!cols"][o]?' table:style-name="co'+t["!cols"][o].ods+'"':"")+"></table:table-column>\n");var d="",p=t["!rows"]||[];for(i=0;i<s.s.r;++i)d=p[i]?' table:style-name="ro'+p[i].ods+'"':"",a.push("        <table:table-row"+d+"></table:table-row>\n");for(;i<=s.e.r;++i){for(d=p[i]?' table:style-name="ro'+p[i].ods+'"':"",a.push("        <table:table-row"+d+">\n"),o=0;o<s.s.c;++o)a.push(e);for(;o<=s.e.c;++o){var h=!1,m={},f="";for(c=0;c!=l.length;++c)if(!(l[c].s.c>o||l[c].s.r>i||l[c].e.c<o||l[c].e.r<i)){l[c].s.c==o&&l[c].s.r==i||(h=!0),m["table:number-columns-spanned"]=l[c].e.c-l[c].s.c+1,m["table:number-rows-spanned"]=l[c].e.r-l[c].s.r+1;break}if(h)a.push("          <table:covered-table-cell/>\n");else{var y=Ou({r:i,c:o}),g=u?(t[i]||[])[o]:t[y];if(g&&g.f&&(m["table:formula"]=nc(Oh(g.f)),g.F&&g.F.slice(0,y.length)==y)){var b=Ku(g.F);m["table:number-matrix-columns-spanned"]=b.e.c-b.s.c+1,m["table:number-matrix-rows-spanned"]=b.e.r-b.s.r+1}if(g){switch(g.t){case"b":f=g.v?"TRUE":"FALSE",m["office:value-type"]="boolean",m["office:boolean-value"]=g.v?"true":"false";break;case"n":f=g.w||String(g.v||0),m["office:value-type"]="float",m["office:value"]=g.v||0;break;case"s":case"str":f=null==g.v?"":g.v,m["office:value-type"]="string";break;case"d":f=g.w||Jl(g.v).toISOString(),m["office:value-type"]="date",m["office:date-value"]=Jl(g.v).toISOString(),m["table:style-name"]="ce1";break;default:a.push(e);continue}var v=nc(f).replace(/  +/g,(function(e){return'<text:s text:c="'+e.length+'"/>'})).replace(/\t/g,"<text:tab/>").replace(/\n/g,"</text:p><text:p>").replace(/^ /,"<text:s/>").replace(/ $/,"<text:s/>");if(g.l&&g.l.Target){var w=g.l.Target;"#"==(w="#"==w.charAt(0)?"#"+Kh(w.slice(1)):w).charAt(0)||w.match(/^\w+:/)||(w="../"+w),v=fc("text:a",v,{"xlink:href":w.replace(/&/g,"&amp;")})}a.push("          "+fc("table:table-cell",fc("text:p",v,{}),m)+"\n")}else a.push(e)}}a.push("        </table:table-row>\n")}return a.push("      </table:table>\n"),a.join("")};return function(e,n){var r=[Zl],a=mc({"xmlns:office":"urn:oasis:names:tc:opendocument:xmlns:office:1.0","xmlns:table":"urn:oasis:names:tc:opendocument:xmlns:table:1.0","xmlns:style":"urn:oasis:names:tc:opendocument:xmlns:style:1.0","xmlns:text":"urn:oasis:names:tc:opendocument:xmlns:text:1.0","xmlns:draw":"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0","xmlns:fo":"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:dc":"http://purl.org/dc/elements/1.1/","xmlns:meta":"urn:oasis:names:tc:opendocument:xmlns:meta:1.0","xmlns:number":"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0","xmlns:presentation":"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0","xmlns:svg":"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0","xmlns:chart":"urn:oasis:names:tc:opendocument:xmlns:chart:1.0","xmlns:dr3d":"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0","xmlns:math":"http://www.w3.org/1998/Math/MathML","xmlns:form":"urn:oasis:names:tc:opendocument:xmlns:form:1.0","xmlns:script":"urn:oasis:names:tc:opendocument:xmlns:script:1.0","xmlns:ooo":"http://openoffice.org/2004/office","xmlns:ooow":"http://openoffice.org/2004/writer","xmlns:oooc":"http://openoffice.org/2004/calc","xmlns:dom":"http://www.w3.org/2001/xml-events","xmlns:xforms":"http://www.w3.org/2002/xforms","xmlns:xsd":"http://www.w3.org/2001/XMLSchema","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","xmlns:sheet":"urn:oasis:names:tc:opendocument:sh33tjs:1.0","xmlns:rpt":"http://openoffice.org/2005/report","xmlns:of":"urn:oasis:names:tc:opendocument:xmlns:of:1.2","xmlns:xhtml":"http://www.w3.org/1999/xhtml","xmlns:grddl":"http://www.w3.org/2003/g/data-view#","xmlns:tableooo":"http://openoffice.org/2009/table","xmlns:drawooo":"http://openoffice.org/2010/draw","xmlns:calcext":"urn:org:documentfoundation:names:experimental:calc:xmlns:calcext:1.0","xmlns:loext":"urn:org:documentfoundation:names:experimental:office:xmlns:loext:1.0","xmlns:field":"urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0","xmlns:formx":"urn:openoffice:names:experimental:ooxml-odf-interop:xmlns:form:1.0","xmlns:css3t":"http://www.w3.org/TR/css3-text/","office:version":"1.2"}),i=mc({"xmlns:config":"urn:oasis:names:tc:opendocument:xmlns:config:1.0","office:mimetype":"application/vnd.oasis.opendocument.spreadsheet"});"fods"==n.bookType?(r.push("<office:document"+a+i+">\n"),r.push(xd().replace(/office:document-meta/g,"office:meta"))):r.push("<office:document-content"+a+">\n"),function(e,t){e.push(" <office:automatic-styles>\n"),e.push('  <number:date-style style:name="N37" number:automatic-order="true">\n'),e.push('   <number:month number:style="long"/>\n'),e.push("   <number:text>/</number:text>\n"),e.push('   <number:day number:style="long"/>\n'),e.push("   <number:text>/</number:text>\n"),e.push("   <number:year/>\n"),e.push("  </number:date-style>\n");var n=0;t.SheetNames.map((function(e){return t.Sheets[e]})).forEach((function(t){if(t&&t["!cols"])for(var r=0;r<t["!cols"].length;++r)if(t["!cols"][r]){var a=t["!cols"][r];if(null==a.width&&null==a.wpx&&null==a.wch)continue;vp(a),a.ods=n;var i=t["!cols"][r].wpx+"px";e.push('  <style:style style:name="co'+n+'" style:family="table-column">\n'),e.push('   <style:table-column-properties fo:break-before="auto" style:column-width="'+i+'"/>\n'),e.push("  </style:style>\n"),++n}}));var r=0;t.SheetNames.map((function(e){return t.Sheets[e]})).forEach((function(t){if(t&&t["!rows"])for(var n=0;n<t["!rows"].length;++n)if(t["!rows"][n]){t["!rows"][n].ods=r;var a=t["!rows"][n].hpx+"px";e.push('  <style:style style:name="ro'+r+'" style:family="table-row">\n'),e.push('   <style:table-row-properties fo:break-before="auto" style:row-height="'+a+'"/>\n'),e.push("  </style:style>\n"),++r}})),e.push('  <style:style style:name="ta1" style:family="table" style:master-page-name="mp1">\n'),e.push('   <style:table-properties table:display="true" style:writing-mode="lr-tb"/>\n'),e.push("  </style:style>\n"),e.push('  <style:style style:name="ce1" style:family="table-cell" style:parent-style-name="Default" style:data-style-name="N37"/>\n'),e.push(" </office:automatic-styles>\n")}(r,e),r.push("  <office:body>\n"),r.push("    <office:spreadsheet>\n");for(var o=0;o!=e.SheetNames.length;++o)r.push(t(e.Sheets[e.SheetNames[o]],e,o));return r.push("    </office:spreadsheet>\n"),r.push("  </office:body>\n"),"fods"==n.bookType?r.push("</office:document>"):r.push("</office:document-content>"),r.join("")}}();function Fm(e,t){if("fods"==t.bookType)return Mm(e,t);var n=Ql(),r="",a=[],i=[];return Hl(n,r="mimetype","application/vnd.oasis.opendocument.spreadsheet"),Hl(n,r="content.xml",Mm(e,t)),a.push([r,"text/xml"]),i.push([r,"ContentFile"]),Hl(n,r="styles.xml",Lm(e,t)),a.push([r,"text/xml"]),i.push([r,"StylesFile"]),Hl(n,r="meta.xml",Zl+xd()),a.push([r,"text/xml"]),i.push([r,"MetadataFile"]),Hl(n,r="manifest.rdf",function(e){var t,n,r=[Zl];r.push('<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">\n');for(var a=0;a!=e.length;++a)r.push(Ed(e[a][0],e[a][1])),r.push((t="",n=e[a][0],['  <rdf:Description rdf:about="'+t+'">\n','    <ns0:hasPart xmlns:ns0="http://docs.oasis-open.org/ns/office/1.2/meta/pkg#" rdf:resource="'+n+'"/>\n',"  </rdf:Description>\n"].join("")));return r.push(Ed("","Document","pkg")),r.push("</rdf:RDF>"),r.join("")}(i)),a.push([r,"application/rdf+xml"]),Hl(n,r="META-INF/manifest.xml",function(e){var t=[Zl];t.push('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2">\n'),t.push('  <manifest:file-entry manifest:full-path="/" manifest:version="1.2" manifest:media-type="application/vnd.oasis.opendocument.spreadsheet"/>\n');for(var n=0;n<e.length;++n)t.push('  <manifest:file-entry manifest:full-path="'+e[n][0]+'" manifest:media-type="'+e[n][1]+'"/>\n');return t.push("</manifest:manifest>"),t.join("")}(a)),n}
/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function Bm(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Vm(e){return"undefined"!=typeof TextEncoder?(new TextEncoder).encode(e):As(uc(e))}function Um(e){var t=e.reduce((function(e,t){return e+t.length}),0),n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(e,r),r+=e.length})),n}function Jm(e,t){var n=t?t[0]:0,r=127&e[n];e:if(e[n++]>=128){if(r|=(127&e[n])<<7,e[n++]<128)break e;if(r|=(127&e[n])<<14,e[n++]<128)break e;if(r|=(127&e[n])<<21,e[n++]<128)break e;if(r+=(127&e[n])*Math.pow(2,28),++n,e[n++]<128)break e;if(r+=(127&e[n])*Math.pow(2,35),++n,e[n++]<128)break e;if(r+=(127&e[n])*Math.pow(2,42),++n,e[n++]<128)break e}return t&&(t[0]=n),r}function Gm(e){var t=new Uint8Array(7);t[0]=127&e;var n=1;e:if(e>127){if(t[n-1]|=128,t[n]=e>>7&127,++n,e<=16383)break e;if(t[n-1]|=128,t[n]=e>>14&127,++n,e<=2097151)break e;if(t[n-1]|=128,t[n]=e>>21&127,++n,e<=268435455)break e;if(t[n-1]|=128,t[n]=e/256>>>21&127,++n,e<=34359738367)break e;if(t[n-1]|=128,t[n]=e/65536>>>21&127,++n,e<=4398046511103)break e;t[n-1]|=128,t[n]=e/16777216>>>21&127,++n}return t.slice(0,n)}function $m(e){var t=0,n=127&e[t];e:if(e[t++]>=128){if(n|=(127&e[t])<<7,e[t++]<128)break e;if(n|=(127&e[t])<<14,e[t++]<128)break e;if(n|=(127&e[t])<<21,e[t++]<128)break e;n|=(127&e[t])<<28}return n}function qm(e){for(var t=[],n=[0];n[0]<e.length;){var r,a=n[0],i=Jm(e,n),o=7&i,s=0;if(0==(i=Math.floor(i/8)))break;switch(o){case 0:for(var l=n[0];e[n[0]++]>=128;);r=e.slice(l,n[0]);break;case 5:s=4,r=e.slice(n[0],n[0]+s),n[0]+=s;break;case 1:s=8,r=e.slice(n[0],n[0]+s),n[0]+=s;break;case 2:s=Jm(e,n),r=e.slice(n[0],n[0]+s),n[0]+=s;break;default:throw new Error("PB Type ".concat(o," for Field ").concat(i," at offset ").concat(a))}var c={data:r,type:o};null==t[i]?t[i]=[c]:t[i].push(c)}return t}function zm(e){var t=[];return e.forEach((function(e,n){e.forEach((function(e){e.data&&(t.push(Gm(8*n+e.type)),2==e.type&&t.push(Gm(e.data.length)),t.push(e.data))}))})),Um(t)}function Wm(e){for(var t,n=[],r=[0];r[0]<e.length;){var a=Jm(e,r),i=qm(e.slice(r[0],r[0]+a));r[0]+=a;var o={id:$m(i[1][0].data),messages:[]};i[2].forEach((function(t){var n=qm(t.data),a=$m(n[3][0].data);o.messages.push({meta:n,data:e.slice(r[0],r[0]+a)}),r[0]+=a})),(null==(t=i[3])?void 0:t[0])&&(o.merge=$m(i[3][0].data)>>>0>0),n.push(o)}return n}function Ym(e){var t=[];return e.forEach((function(e){var n=[];n[1]=[{data:Gm(e.id),type:0}],n[2]=[],null!=e.merge&&(n[3]=[{data:Gm(+!!e.merge),type:0}]);var r=[];e.messages.forEach((function(e){r.push(e.data),e.meta[3]=[{type:0,data:Gm(e.data.length)}],n[2].push({data:zm(e.meta),type:2})}));var a=zm(n);t.push(Gm(a.length)),t.push(a),r.forEach((function(e){return t.push(e)}))})),Um(t)}function Hm(e,t){if(0!=e)throw new Error("Unexpected Snappy chunk type ".concat(e));for(var n=[0],r=Jm(t,n),a=[];n[0]<t.length;){var i=3&t[n[0]];if(0!=i){var o=0,s=0;if(1==i?(s=4+(t[n[0]]>>2&7),o=(224&t[n[0]++])<<3,o|=t[n[0]++]):(s=1+(t[n[0]++]>>2),2==i?(o=t[n[0]]|t[n[0]+1]<<8,n[0]+=2):(o=(t[n[0]]|t[n[0]+1]<<8|t[n[0]+2]<<16|t[n[0]+3]<<24)>>>0,n[0]+=4)),a=[Um(a)],0==o)throw new Error("Invalid offset 0");if(o>a[0].length)throw new Error("Invalid offset beyond length");if(s>=o)for(a.push(a[0].slice(-o)),s-=o;s>=a[a.length-1].length;)a.push(a[a.length-1]),s-=a[a.length-1].length;a.push(a[0].slice(-o,-o+s))}else{var l=t[n[0]++]>>2;if(l<60)++l;else{var c=l-59;l=t[n[0]],c>1&&(l|=t[n[0]+1]<<8),c>2&&(l|=t[n[0]+2]<<16),c>3&&(l|=t[n[0]+3]<<24),l>>>=0,l++,n[0]+=c}a.push(t.slice(n[0],n[0]+l)),n[0]+=l}}var u=Um(a);if(u.length!=r)throw new Error("Unexpected length: ".concat(u.length," != ").concat(r));return u}function Qm(e){for(var t=[],n=0;n<e.length;){var r=e[n++],a=e[n]|e[n+1]<<8|e[n+2]<<16;n+=3,t.push(Hm(r,e.slice(n,n+a))),n+=a}if(n!==e.length)throw new Error("data is not a valid framed stream!");return Um(t)}function Zm(e){for(var t=[],n=0;n<e.length;){var r=Math.min(e.length-n,268435455),a=new Uint8Array(4);t.push(a);var i=Gm(r),o=i.length;t.push(i),r<=60?(o++,t.push(new Uint8Array([r-1<<2]))):r<=256?(o+=2,t.push(new Uint8Array([240,r-1&255]))):r<=65536?(o+=3,t.push(new Uint8Array([244,r-1&255,r-1>>8&255]))):r<=16777216?(o+=4,t.push(new Uint8Array([248,r-1&255,r-1>>8&255,r-1>>16&255]))):r<=4294967296&&(o+=5,t.push(new Uint8Array([252,r-1&255,r-1>>8&255,r-1>>16&255,r-1>>>24&255]))),t.push(e.slice(n,n+r)),o+=r,a[0]=0,a[1]=255&o,a[2]=o>>8&255,a[3]=o>>16&255,n+=r}return Um(t)}function Xm(e,t){var n=new Uint8Array(32),r=Bm(n),a=12,i=0;switch(n[0]=5,e.t){case"n":n[1]=2,function(e,t,n){var r=Math.floor(0==n?0:Math.LOG10E*Math.log(Math.abs(n)))+6176-20,a=n/Math.pow(10,r-6176);e[t+15]|=r>>7,e[t+14]|=(127&r)<<1;for(var i=0;a>=1;++i,a/=256)e[t+i]=255&a;e[t+15]|=n>=0?0:128}(n,a,e.v),i|=1,a+=16;break;case"b":n[1]=6,r.setFloat64(a,e.v?1:0,!0),i|=2,a+=8;break;case"s":if(-1==t.indexOf(e.v))throw new Error("Value ".concat(e.v," missing from SST!"));n[1]=3,r.setUint32(a,t.indexOf(e.v),!0),i|=8,a+=4;break;default:throw"unsupported cell type "+e.t}return r.setUint32(8,i,!0),n.slice(0,a)}function ef(e,t){var n=new Uint8Array(32),r=Bm(n),a=12,i=0;switch(n[0]=3,e.t){case"n":n[2]=2,r.setFloat64(a,e.v,!0),i|=32,a+=8;break;case"b":n[2]=6,r.setFloat64(a,e.v?1:0,!0),i|=32,a+=8;break;case"s":if(-1==t.indexOf(e.v))throw new Error("Value ".concat(e.v," missing from SST!"));n[2]=3,r.setUint32(a,t.indexOf(e.v),!0),i|=16,a+=4;break;default:throw"unsupported cell type "+e.t}return r.setUint32(4,i,!0),n.slice(0,a)}function tf(e){return Jm(qm(e)[1][0].data)}function nf(e,t,n){var r,a,i,o;if(!(null==(r=e[6])?void 0:r[0])||!(null==(a=e[7])?void 0:a[0]))throw"Mutation only works on post-BNC storages!";if((null==(o=null==(i=e[8])?void 0:i[0])?void 0:o.data)&&$m(e[8][0].data)>0||!1)throw"Math only works with normal offsets";for(var s=0,l=Bm(e[7][0].data),c=0,u=[],d=Bm(e[4][0].data),p=0,h=[],m=0;m<t.length;++m)if(null!=t[m]){var f,y;switch(l.setUint16(2*m,c,!0),d.setUint16(2*m,p,!0),typeof t[m]){case"string":f=Xm({t:"s",v:t[m]},n),y=ef({t:"s",v:t[m]},n);break;case"number":f=Xm({t:"n",v:t[m]},n),y=ef({t:"n",v:t[m]},n);break;case"boolean":f=Xm({t:"b",v:t[m]},n),y=ef({t:"b",v:t[m]},n);break;default:throw new Error("Unsupported value "+t[m])}u.push(f),c+=f.length,h.push(y),p+=y.length,++s}else l.setUint16(2*m,65535,!0),d.setUint16(2*m,65535);for(e[2][0].data=Gm(s);m<e[7][0].data.length/2;++m)l.setUint16(2*m,65535,!0),d.setUint16(2*m,65535,!0);return e[6][0].data=Um(u),e[3][0].data=Um(h),s}function rf(e){!function(e){return function(t){for(var n=0;n!=e.length;++n){var r=e[n];void 0===t[r[0]]&&(t[r[0]]=r[1]),"n"===r[2]&&(t[r[0]]=Number(t[r[0]]))}}}([["cellDates",!1],["bookSST",!1],["bookType","xlsx"],["compression",!1],["WTF",!1]])(e)}function af(e,t){return"ods"==t.bookType?Fm(e,t):"numbers"==t.bookType?function(e,t){if(!t||!t.numbers)throw new Error("Must pass a `numbers` option -- check the README");var n=e.Sheets[e.SheetNames[0]];e.SheetNames.length>1&&console.error("The Numbers writer currently writes only the first table");var r=Ku(n["!ref"]);r.s.r=r.s.c=0;var a=!1;r.e.c>9&&(a=!0,r.e.c=9),r.e.r>49&&(a=!0,r.e.r=49),a&&console.error("The Numbers writer is currently limited to ".concat(Cu(r)));var i=pf(n,{range:r,header:1}),o=["~Sh33tJ5~"];i.forEach((function(e){return e.forEach((function(e){"string"==typeof e&&o.push(e)}))}));var s={},l=[],c=Tl.read(t.numbers,{type:"base64"});c.FileIndex.map((function(e,t){return[e,c.FullPaths[t]]})).forEach((function(e){var t=e[0],n=e[1];2==t.type&&t.name.match(/\.iwa/)&&Wm(Qm(t.content)).forEach((function(e){l.push(e.id),s[e.id]={deps:[],location:n,type:$m(e.messages[0].meta[1][0].data)}}))})),l.sort((function(e,t){return e-t}));var u=l.filter((function(e){return e>1})).map((function(e){return[e,Gm(e)]}));c.FileIndex.map((function(e,t){return[e,c.FullPaths[t]]})).forEach((function(e){var t=e[0];e[1],t.name.match(/\.iwa/)&&Wm(Qm(t.content)).forEach((function(e){e.messages.forEach((function(t){u.forEach((function(t){e.messages.some((function(e){return 11006!=$m(e.meta[1][0].data)&&function(e,t){e:for(var n=0;n<=e.length-t.length;++n){for(var r=0;r<t.length;++r)if(e[n+r]!=t[r])continue e;return!0}return!1}(e.data,t[1])}))&&s[t[0]].deps.push(e.id)}))}))}))}));for(var d,p=Tl.find(c,s[1].location),h=Wm(Qm(p.content)),m=0;m<h.length;++m){var f=h[m];1==f.id&&(d=f)}var y=tf(qm(d.messages[0].data)[1][0].data);for(h=Wm(Qm((p=Tl.find(c,s[y].location)).content)),m=0;m<h.length;++m)(f=h[m]).id==y&&(d=f);for(y=tf(qm(d.messages[0].data)[2][0].data),h=Wm(Qm((p=Tl.find(c,s[y].location)).content)),m=0;m<h.length;++m)(f=h[m]).id==y&&(d=f);for(y=tf(qm(d.messages[0].data)[2][0].data),h=Wm(Qm((p=Tl.find(c,s[y].location)).content)),m=0;m<h.length;++m)(f=h[m]).id==y&&(d=f);var g=qm(d.messages[0].data);g[6][0].data=Gm(r.e.r+1),g[7][0].data=Gm(r.e.c+1);for(var b=tf(g[46][0].data),v=Tl.find(c,s[b].location),w=Wm(Qm(v.content)),S=0;S<w.length&&w[S].id!=b;++S);if(w[S].id!=b)throw"Bad ColumnRowUIDMapArchive";var E=qm(w[S].messages[0].data);E[1]=[],E[2]=[],E[3]=[];for(var x=0;x<=r.e.c;++x){var _=[];_[1]=_[2]=[{type:0,data:Gm(x+420690)}],E[1].push({type:2,data:zm(_)}),E[2].push({type:0,data:Gm(x)}),E[3].push({type:0,data:Gm(x)})}E[4]=[],E[5]=[],E[6]=[];for(var k=0;k<=r.e.r;++k)(_=[])[1]=_[2]=[{type:0,data:Gm(k+726270)}],E[4].push({type:2,data:zm(_)}),E[5].push({type:0,data:Gm(k)}),E[6].push({type:0,data:Gm(k)});w[S].messages[0].data=zm(E),v.content=Zm(Ym(w)),v.size=v.content.length,delete g[46];var I=qm(g[4][0].data);I[7][0].data=Gm(r.e.r+1);var T=tf(qm(I[1][0].data)[2][0].data);if((w=Wm(Qm((v=Tl.find(c,s[T].location)).content)))[0].id!=T)throw"Bad HeaderStorageBucket";var A=qm(w[0].messages[0].data);for(k=0;k<i.length;++k){var O=qm(A[2][0].data);O[1][0].data=Gm(k),O[4][0].data=Gm(i[k].length),A[2][k]={type:A[2][0].type,data:zm(O)}}w[0].messages[0].data=zm(A),v.content=Zm(Ym(w)),v.size=v.content.length;var K=tf(I[2][0].data);if((w=Wm(Qm((v=Tl.find(c,s[K].location)).content)))[0].id!=K)throw"Bad HeaderStorageBucket";for(A=qm(w[0].messages[0].data),x=0;x<=r.e.c;++x)(O=qm(A[2][0].data))[1][0].data=Gm(x),O[4][0].data=Gm(r.e.r+1),A[2][x]={type:A[2][0].type,data:zm(O)};w[0].messages[0].data=zm(A),v.content=Zm(Ym(w)),v.size=v.content.length;var C=tf(I[4][0].data);!function(){for(var e,t=Tl.find(c,s[C].location),n=Wm(Qm(t.content)),r=0;r<n.length;++r){var a=n[r];a.id==C&&(e=a)}var i=qm(e.messages[0].data);i[3]=[];var l=[];o.forEach((function(e,t){l[1]=[{type:0,data:Gm(t)}],l[2]=[{type:0,data:Gm(1)}],l[3]=[{type:2,data:Vm(e)}],i[3].push({type:2,data:zm(l)})})),e.messages[0].data=zm(i);var u=Zm(Ym(n));t.content=u,t.size=t.content.length}();var R=qm(I[3][0].data),j=R[1][0];delete R[2];var P=qm(j.data),D=tf(P[2][0].data);!function(){for(var e,t=Tl.find(c,s[D].location),n=Wm(Qm(t.content)),a=0;a<n.length;++a){var l=n[a];l.id==D&&(e=l)}var u=qm(e.messages[0].data);delete u[6],delete R[7];var d=new Uint8Array(u[5][0].data);u[5]=[];for(var p=0,h=0;h<=r.e.r;++h){var m=qm(d);p+=nf(m,i[h],o),m[1][0].data=Gm(h),u[5].push({data:zm(m),type:2})}u[1]=[{type:0,data:Gm(r.e.c+1)}],u[2]=[{type:0,data:Gm(r.e.r+1)}],u[3]=[{type:0,data:Gm(p)}],u[4]=[{type:0,data:Gm(r.e.r+1)}],e.messages[0].data=zm(u);var f=Zm(Ym(n));t.content=f,t.size=t.content.length}(),j.data=zm(P),I[3][0].data=zm(R),g[4][0].data=zm(I),d.messages[0].data=zm(g);var N=Zm(Ym(h));return p.content=N,p.size=p.content.length,c}(e,t):"xlsb"==t.bookType?function(e,t){Fp=1024,e&&!e.SSF&&(e.SSF=$l(Js));e&&e.SSF&&(_l(),xl(e.SSF),t.revssf=jl(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF);t.rels={},t.wbrels={},t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,Ch?t.revStrings=new Map:(t.revStrings={},t.revStrings.foo=[],delete t.revStrings.foo);var n="xlsb"==t.bookType?"bin":"xml",r=$p.indexOf(t.bookType)>-1,a={workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""};rf(t=t||{});var i=Ql(),o="",s=0;t.cellXfs=[],Dh(t.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={});if(Hl(i,o="docProps/core.xml",Id(e.Props,t)),a.coreprops.push(o),Sd(t.rels,2,o,bd.CORE_PROPS),o="docProps/app.xml",e.Props&&e.Props.SheetNames);else if(e.Workbook&&e.Workbook.Sheets){for(var l=[],c=0;c<e.SheetNames.length;++c)2!=(e.Workbook.Sheets[c]||{}).Hidden&&l.push(e.SheetNames[c]);e.Props.SheetNames=l}else e.Props.SheetNames=e.SheetNames;e.Props.Worksheets=e.Props.SheetNames.length,Hl(i,o,Od(e.Props)),a.extprops.push(o),Sd(t.rels,3,o,bd.EXT_PROPS),e.Custprops!==e.Props&&Kl(e.Custprops||{}).length>0&&(Hl(i,o="docProps/custom.xml",Kd(e.Custprops)),a.custprops.push(o),Sd(t.rels,4,o,bd.CUST_PROPS));for(s=1;s<=e.SheetNames.length;++s){var u={"!id":{}},d=e.Sheets[e.SheetNames[s-1]];(d||{})["!type"];if(Hl(i,o="xl/worksheets/sheet"+s+"."+n,cm(s-1,o,t,e,u)),a.sheets.push(o),Sd(t.wbrels,-1,"worksheets/sheet"+s+"."+n,bd.WS[0]),d){var p=d["!comments"],h=!1,m="";p&&p.length>0&&(Hl(i,m="xl/comments"+s+"."+n,um(p,m)),a.comments.push(m),Sd(u,-1,"../comments"+s+"."+n,bd.CMNT),h=!0),d["!legacy"]&&h&&Hl(i,"xl/drawings/vmlDrawing"+s+".vml",Bp(s,d["!comments"])),delete d["!comments"],delete d["!legacy"]}u["!id"].rId1&&Hl(i,vd(o),wd(u))}null!=t.Strings&&t.Strings.length>0&&(Hl(i,o="xl/sharedStrings."+n,function(e,t,n){return(".bin"===t.slice(-4)?dp:cp)(e,n)}(t.Strings,o,t)),a.strs.push(o),Sd(t.wbrels,-1,"sharedStrings."+n,bd.SST));Hl(i,o="xl/workbook."+n,function(e,t,n){return(".bin"===t.slice(-4)?lm:im)(e)}(e,o)),a.workbooks.push(o),Sd(t.rels,1,o,bd.WB),Hl(i,o="xl/theme/theme1.xml",Np(e.Themes,t)),a.themes.push(o),Sd(t.wbrels,-1,"theme/theme1.xml",bd.THEME),Hl(i,o="xl/styles."+n,function(e,t,n){return(".bin"===t.slice(-4)?Dp:Ep)(e,n)}(e,o,t)),a.styles.push(o),Sd(t.wbrels,-1,"styles."+n,bd.STY),e.vbaraw&&r&&(Hl(i,o="xl/vbaProject.bin",e.vbaraw),a.vba.push(o),Sd(t.wbrels,-1,"vbaProject.bin",bd.VBA));return Hl(i,o="xl/metadata."+n,function(e){return(".bin"===e.slice(-4)?Lp:Mp)()}(o)),a.metadata.push(o),Sd(t.wbrels,-1,"metadata."+n,bd.XLMETA),Hl(i,"[Content_Types].xml",gd(a,t)),Hl(i,"_rels/.rels",wd(t.rels)),Hl(i,"xl/_rels/workbook."+n+".rels",wd(t.wbrels)),delete t.revssf,delete t.ssf,i}(e,t):function(e,t){Fp=1024,e&&!e.SSF&&(e.SSF=$l(Js));e&&e.SSF&&(_l(),xl(e.SSF),t.revssf=jl(e.SSF),t.revssf[e.SSF[65535]]=0,t.ssf=e.SSF);t.rels={},t.wbrels={},t.Strings=[],t.Strings.Count=0,t.Strings.Unique=0,Ch?t.revStrings=new Map:(t.revStrings={},t.revStrings.foo=[],delete t.revStrings.foo);var n="xml",r=$p.indexOf(t.bookType)>-1,a={workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""};rf(t=t||{});var i=Ql(),o="",s=0;t.cellXfs=[],Dh(t.cellXfs,{},{revssf:{General:0}}),e.Props||(e.Props={});if(Hl(i,o="docProps/core.xml",Id(e.Props,t)),a.coreprops.push(o),Sd(t.rels,2,o,bd.CORE_PROPS),o="docProps/app.xml",e.Props&&e.Props.SheetNames);else if(e.Workbook&&e.Workbook.Sheets){for(var l=[],c=0;c<e.SheetNames.length;++c)2!=(e.Workbook.Sheets[c]||{}).Hidden&&l.push(e.SheetNames[c]);e.Props.SheetNames=l}else e.Props.SheetNames=e.SheetNames;e.Props.Worksheets=e.Props.SheetNames.length,Hl(i,o,Od(e.Props)),a.extprops.push(o),Sd(t.rels,3,o,bd.EXT_PROPS),e.Custprops!==e.Props&&Kl(e.Custprops||{}).length>0&&(Hl(i,o="docProps/custom.xml",Kd(e.Custprops)),a.custprops.push(o),Sd(t.rels,4,o,bd.CUST_PROPS));var u=["SheetJ5"];for(t.tcid=0,s=1;s<=e.SheetNames.length;++s){var d={"!id":{}},p=e.Sheets[e.SheetNames[s-1]];(p||{})["!type"];if(Hl(i,o="xl/worksheets/sheet"+s+"."+n,Bh(s-1,t,e,d)),a.sheets.push(o),Sd(t.wbrels,-1,"worksheets/sheet"+s+"."+n,bd.WS[0]),p){var h=p["!comments"],m=!1,f="";if(h&&h.length>0){var y=!1;h.forEach((function(e){e[1].forEach((function(e){1==e.T&&(y=!0)}))})),y&&(Hl(i,f="xl/threadedComments/threadedComment"+s+"."+n,Up(h,u,t)),a.threadedcomments.push(f),Sd(d,-1,"../threadedComments/threadedComment"+s+"."+n,bd.TCMNT)),Hl(i,f="xl/comments"+s+"."+n,Vp(h)),a.comments.push(f),Sd(d,-1,"../comments"+s+"."+n,bd.CMNT),m=!0}p["!legacy"]&&m&&Hl(i,"xl/drawings/vmlDrawing"+s+".vml",Bp(s,p["!comments"])),delete p["!comments"],delete p["!legacy"]}d["!id"].rId1&&Hl(i,vd(o),wd(d))}null!=t.Strings&&t.Strings.length>0&&(Hl(i,o="xl/sharedStrings."+n,cp(t.Strings,t)),a.strs.push(o),Sd(t.wbrels,-1,"sharedStrings."+n,bd.SST));Hl(i,o="xl/workbook."+n,im(e)),a.workbooks.push(o),Sd(t.rels,1,o,bd.WB),Hl(i,o="xl/theme/theme1.xml",Np(e.Themes,t)),a.themes.push(o),Sd(t.wbrels,-1,"theme/theme1.xml",bd.THEME),Hl(i,o="xl/styles."+n,Ep(e,t)),a.styles.push(o),Sd(t.wbrels,-1,"styles."+n,bd.STY),e.vbaraw&&r&&(Hl(i,o="xl/vbaProject.bin",e.vbaraw),a.vba.push(o),Sd(t.wbrels,-1,"vbaProject.bin",bd.VBA));Hl(i,o="xl/metadata."+n,Mp()),a.metadata.push(o),Sd(t.wbrels,-1,"metadata."+n,bd.XLMETA),u.length>1&&(Hl(i,o="xl/persons/person.xml",function(e){var t=[Zl,fc("personList",null,{xmlns:Ec,"xmlns:x":Kc[0]}).replace(/[\/]>/,">")];return e.forEach((function(e,n){t.push(fc("person",null,{displayName:e,id:"{54EE7950-7262-4200-6969-"+("000000000000"+n).slice(-12)+"}",userId:e,providerId:"None"}))})),t.push("</personList>"),t.join("")}(u)),a.people.push(o),Sd(t.wbrels,-1,"persons/person.xml",bd.PEOPLE));return Hl(i,"[Content_Types].xml",gd(a,t)),Hl(i,"_rels/.rels",wd(t.rels)),Hl(i,"xl/_rels/workbook."+n+".rels",wd(t.wbrels)),delete t.revssf,delete t.ssf,i}(e,t)}function of(e,t){switch(t.type){case"base64":case"binary":break;case"buffer":case"array":t.type="";break;case"file":return Ol(t.file,Tl.write(e,{type:_s?"buffer":""}));case"string":throw new Error("'string' output type invalid for '"+t.bookType+"' files");default:throw new Error("Unrecognized type "+t.type)}return Tl.write(e,t)}function sf(e,t){var n=$l(t||{});return function(e,t){var n={},r=_s?"nodebuffer":"undefined"!=typeof Uint8Array?"array":"string";t.compression&&(n.compression="DEFLATE");if(t.password)n.type=r;else switch(t.type){case"base64":n.type="base64";break;case"binary":n.type="string";break;case"string":throw new Error("'string' output type invalid for '"+t.bookType+"' files");case"buffer":case"file":n.type=r;break;default:throw new Error("Unrecognized type "+t.type)}var a=e.FullPaths?Tl.write(e,{fileType:"zip",type:{nodebuffer:"buffer",string:"binary"}[n.type]||n.type,compression:!!t.compression}):e.generate(n);if("undefined"!=typeof Deno&&"string"==typeof a){if("binary"==t.type||"base64"==t.type)return a;a=new Uint8Array(Os(a))}return t.password&&"undefined"!=typeof encrypt_agile?of(encrypt_agile(a,t.password),t):"file"===t.type?Ol(t.file,a):"string"==t.type?cc(a):a}(af(e,n),n)}function lf(e,t,n){n||(n="");var r=n+e;switch(t.type){case"base64":return Es(uc(r));case"binary":return uc(r);case"string":return e;case"file":return Ol(t.file,r,"utf8");case"buffer":return _s?ks(r,"utf8"):"undefined"!=typeof TextEncoder?(new TextEncoder).encode(r):lf(r,{type:"binary"}).split("").map((function(e){return e.charCodeAt(0)}))}throw new Error("Unrecognized type "+t.type)}function cf(e,t){switch(t.type){case"string":case"base64":case"binary":for(var n="",r=0;r<e.length;++r)n+=String.fromCharCode(e[r]);return"base64"==t.type?Es(n):"string"==t.type?cc(n):n;case"file":return Ol(t.file,e);case"buffer":return e;default:throw new Error("Unrecognized type "+t.type)}}function uf(e,t){bs(),am(e);var n=$l(t||{});if(n.cellStyles&&(n.cellNF=!0,n.sheetStubs=!0),"array"==n.type){n.type="binary";var r=uf(e,n);return n.type="array",Os(r)}var a=0;if(n.sheet&&(a="number"==typeof n.sheet?n.sheet:e.SheetNames.indexOf(n.sheet),!e.SheetNames[a]))throw new Error("Sheet not found: "+n.sheet+" : "+typeof n.sheet);switch(n.bookType||"xlsb"){case"xml":case"xlml":return lf(ym(e,n),n);case"slk":case"sylk":return lf(rp.from_sheet(e.Sheets[e.SheetNames[a]],n),n);case"htm":case"html":return lf(jm(e.Sheets[e.SheetNames[a]],n),n);case"txt":return function(e,t){switch(t.type){case"base64":return Es(e);case"binary":case"string":return e;case"file":return Ol(t.file,e,"binary");case"buffer":return _s?ks(e,"binary"):e.split("").map((function(e){return e.charCodeAt(0)}))}throw new Error("Unrecognized type "+t.type)}(yf(e.Sheets[e.SheetNames[a]],n),n);case"csv":return lf(ff(e.Sheets[e.SheetNames[a]],n),n,"\ufeff");case"dif":return lf(ap.from_sheet(e.Sheets[e.SheetNames[a]],n),n);case"dbf":return cf(np.from_sheet(e.Sheets[e.SheetNames[a]],n),n);case"prn":return lf(op.from_sheet(e.Sheets[e.SheetNames[a]],n),n);case"rtf":return lf(hp.from_sheet(e.Sheets[e.SheetNames[a]],n),n);case"eth":return lf(ip.from_sheet(e.Sheets[e.SheetNames[a]],n),n);case"fods":return lf(Fm(e,n),n);case"wk1":return cf(sp.sheet_to_wk1(e.Sheets[e.SheetNames[a]],n),n);case"wk3":return cf(sp.book_to_wk3(e,n),n);case"biff2":n.biff||(n.biff=2);case"biff3":n.biff||(n.biff=3);case"biff4":return n.biff||(n.biff=4),cf(Cm(e,n),n);case"biff5":n.biff||(n.biff=5);case"biff8":case"xla":case"xls":return n.biff||(n.biff=8),function(e,t){var n=t||{};return of(wm(e,n),n)}(e,n);case"xlsx":case"xlsm":case"xlam":case"xlsb":case"numbers":case"ods":return sf(e,n);default:throw new Error("Unrecognized bookType |"+n.bookType+"|")}}function df(e,t,n,r,a,i,o,s){var l=ku(n),c=s.defval,u=s.raw||!Object.prototype.hasOwnProperty.call(s,"raw"),d=!0,p=1===a?[]:{};if(1!==a)if(Object.defineProperty)try{Object.defineProperty(p,"__rowNum__",{value:n,enumerable:!1})}catch(e){p.__rowNum__=n}else p.__rowNum__=n;if(!o||e[n])for(var h=t.s.c;h<=t.e.c;++h){var m=o?e[n][h]:e[r[h]+l];if(void 0!==m&&void 0!==m.t){var f=m.v;switch(m.t){case"z":if(null==f)break;continue;case"e":f=0==f?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+m.t)}if(null!=i[h]){if(null==f)if("e"==m.t&&null===f)p[i[h]]=null;else if(void 0!==c)p[i[h]]=c;else{if(!u||null!==f)continue;p[i[h]]=null}else p[i[h]]=u&&("n"!==m.t||"n"===m.t&&!1!==s.rawNumbers)?f:Pu(m,f,s);null!=f&&(d=!1)}}else{if(void 0===c)continue;null!=i[h]&&(p[i[h]]=c)}}return{row:p,isempty:d}}function pf(e,t){if(null==e||null==e["!ref"])return[];var n={t:"n",v:0},r=0,a=1,i=[],o=0,s="",l={s:{r:0,c:0},e:{r:0,c:0}},c=t||{},u=null!=c.range?c.range:e["!ref"];switch(1===c.header?r=1:"A"===c.header?r=2:Array.isArray(c.header)?r=3:null==c.header&&(r=0),typeof u){case"string":l=Ru(u);break;case"number":(l=Ru(e["!ref"])).s.r=u;break;default:l=u}r>0&&(a=0);var d=ku(l.s.r),p=[],h=[],m=0,f=0,y=Array.isArray(e),g=l.s.r,b=0,v={};y&&!e[g]&&(e[g]=[]);var w=c.skipHidden&&e["!cols"]||[],S=c.skipHidden&&e["!rows"]||[];for(b=l.s.c;b<=l.e.c;++b)if(!(w[b]||{}).hidden)switch(p[b]=Tu(b),n=y?e[g][b]:e[p[b]+d],r){case 1:i[b]=b-l.s.c;break;case 2:i[b]=p[b];break;case 3:i[b]=c.header[b-l.s.c];break;default:if(null==n&&(n={w:"__EMPTY",t:"s"}),s=o=Pu(n,null,c),f=v[o]||0){do{s=o+"_"+f++}while(v[s]);v[o]=f,v[s]=1}else v[o]=1;i[b]=s}for(g=l.s.r+a;g<=l.e.r;++g)if(!(S[g]||{}).hidden){var E=df(e,l,g,p,r,i,y,c);(!1===E.isempty||(1===r?!1!==c.blankrows:c.blankrows))&&(h[m++]=E.row)}return h.length=m,h}var hf=/"/g;function mf(e,t,n,r,a,i,o,s){for(var l=!0,c=[],u="",d=ku(n),p=t.s.c;p<=t.e.c;++p)if(r[p]){var h=s.dense?(e[n]||[])[p]:e[r[p]+d];if(null==h)u="";else if(null!=h.v){l=!1,u=""+(s.rawNumbers&&"n"==h.t?h.v:Pu(h,null,s));for(var m=0,f=0;m!==u.length;++m)if((f=u.charCodeAt(m))===a||f===i||34===f||s.forceQuotes){u='"'+u.replace(hf,'""')+'"';break}"ID"==u&&(u='"ID"')}else null==h.f||h.F?u="":(l=!1,(u="="+h.f).indexOf(",")>=0&&(u='"'+u.replace(hf,'""')+'"'));c.push(u)}return!1===s.blankrows&&l?null:c.join(o)}function ff(e,t){var n=[],r=null==t?{}:t;if(null==e||null==e["!ref"])return"";var a=Ru(e["!ref"]),i=void 0!==r.FS?r.FS:",",o=i.charCodeAt(0),s=void 0!==r.RS?r.RS:"\n",l=s.charCodeAt(0),c=new RegExp(("|"==i?"\\|":i)+"+$"),u="",d=[];r.dense=Array.isArray(e);for(var p=r.skipHidden&&e["!cols"]||[],h=r.skipHidden&&e["!rows"]||[],m=a.s.c;m<=a.e.c;++m)(p[m]||{}).hidden||(d[m]=Tu(m));for(var f=0,y=a.s.r;y<=a.e.r;++y)(h[y]||{}).hidden||null!=(u=mf(e,a,y,d,o,l,i,r))&&(r.strip&&(u=u.replace(c,"")),(u||!1!==r.blankrows)&&n.push((f++?s:"")+u));return delete r.dense,n.join("")}function yf(e,t){return t||(t={}),t.FS="\t",t.RS="\n",ff(e,t)}function gf(e,t,n){var r,a=n||{},i=+!a.skipHeader,o=e||{},s=0,l=0;if(o&&null!=a.origin)if("number"==typeof a.origin)s=a.origin;else{var c="string"==typeof a.origin?Au(a.origin):a.origin;s=c.r,l=c.c}var u={s:{c:0,r:0},e:{c:l,r:s+t.length-1+i}};if(o["!ref"]){var d=Ru(o["!ref"]);u.e.c=Math.max(u.e.c,d.e.c),u.e.r=Math.max(u.e.r,d.e.r),-1==s&&(s=d.e.r+1,u.e.r=s+t.length-1+i)}else-1==s&&(s=0,u.e.r=t.length-1+i);var p=a.header||[],h=0;t.forEach((function(e,t){Kl(e).forEach((function(n){-1==(h=p.indexOf(n))&&(p[h=p.length]=n);var c=e[n],u="z",d="",m=Ou({c:l+h,r:s+t+i});r=bf(o,m),!c||"object"!=typeof c||c instanceof Date?("number"==typeof c?u="n":"boolean"==typeof c?u="b":"string"==typeof c?u="s":c instanceof Date?(u="d",a.cellDates||(u="n",c=Dl(c)),d=a.dateNF||Js[14]):null===c&&a.nullError&&(u="e",c=0),r?(r.t=u,r.v=c,delete r.w,delete r.R,d&&(r.z=d)):o[m]=r={t:u,v:c},d&&(r.z=d)):o[m]=c}))})),u.e.c=Math.max(u.e.c,l+p.length-1);var m=ku(s);if(i)for(h=0;h<p.length;++h)o[Tu(h+l)+m]={t:"s",v:p[h]};return o["!ref"]=Cu(u),o}function bf(e,t,n){if("string"==typeof t){if(Array.isArray(e)){var r=Au(t);return e[r.r]||(e[r.r]=[]),e[r.r][r.c]||(e[r.r][r.c]={t:"z"})}return e[t]||(e[t]={t:"z"})}return bf(e,Ou("number"!=typeof t?t:{r:t,c:n||0}))}function vf(e,t,n){return t?(e.l={Target:t},n&&(e.l.Tooltip=n)):delete e.l,e}var wf={encode_col:Tu,encode_row:ku,encode_cell:Ou,encode_range:Cu,decode_col:Iu,decode_row:_u,split_cell:function(e){return e.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")},decode_cell:Au,decode_range:Ku,format_cell:Pu,sheet_add_aoa:Nu,sheet_add_json:gf,sheet_add_dom:Pm,aoa_to_sheet:Lu,json_to_sheet:function(e,t){return gf(null,e,t)},table_to_sheet:Dm,table_to_book:function(e,t){return Du(Dm(e,t),t)},sheet_to_csv:ff,sheet_to_txt:yf,sheet_to_json:pf,sheet_to_html:jm,sheet_to_formulae:function(e){var t,n="",r="";if(null==e||null==e["!ref"])return[];var a,i=Ru(e["!ref"]),o="",s=[],l=[],c=Array.isArray(e);for(a=i.s.c;a<=i.e.c;++a)s[a]=Tu(a);for(var u=i.s.r;u<=i.e.r;++u)for(o=ku(u),a=i.s.c;a<=i.e.c;++a)if(n=s[a]+o,r="",void 0!==(t=c?(e[u]||[])[a]:e[n])){if(null!=t.F){if(n=t.F,!t.f)continue;r=t.f,-1==n.indexOf(":")&&(n=n+":"+n)}if(null!=t.f)r=t.f;else{if("z"==t.t)continue;if("n"==t.t&&null!=t.v)r=""+t.v;else if("b"==t.t)r=t.v?"TRUE":"FALSE";else if(void 0!==t.w)r="'"+t.w;else{if(void 0===t.v)continue;r="s"==t.t?"'"+t.v:""+t.v}}l[l.length]=n+"="+r}return l},sheet_to_row_object_array:pf,sheet_get_cell:bf,book_new:function(){return{SheetNames:[],Sheets:{}}},book_append_sheet:function(e,t,n,r){var a=1;if(!n)for(;a<=65535&&-1!=e.SheetNames.indexOf(n="Sheet"+a);++a,n=void 0);if(!n||e.SheetNames.length>=65535)throw new Error("Too many worksheets");if(r&&e.SheetNames.indexOf(n)>=0){var i=n.match(/(^.*?)(\d+)$/);a=i&&+i[2]||0;var o=i&&i[1]||n;for(++a;a<=65535&&-1!=e.SheetNames.indexOf(n=o+a);++a);}if(rm(n),e.SheetNames.indexOf(n)>=0)throw new Error("Worksheet with name |"+n+"| already exists!");return e.SheetNames.push(n),e.Sheets[n]=t,n},book_set_sheet_visibility:function(e,t,n){e.Workbook||(e.Workbook={}),e.Workbook.Sheets||(e.Workbook.Sheets=[]);var r=function(e,t){if("number"==typeof t){if(t>=0&&e.SheetNames.length>t)return t;throw new Error("Cannot find sheet # "+t)}if("string"==typeof t){var n=e.SheetNames.indexOf(t);if(n>-1)return n;throw new Error("Cannot find sheet name |"+t+"|")}throw new Error("Cannot find sheet |"+t+"|")}(e,t);switch(e.Workbook.Sheets[r]||(e.Workbook.Sheets[r]={}),n){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+n)}e.Workbook.Sheets[r].Hidden=n},cell_set_number_format:function(e,t){return e.z=t,e},cell_set_hyperlink:vf,cell_set_internal_link:function(e,t,n){return vf(e,"#"+t,n)},cell_add_comment:function(e,t,n){e.c||(e.c=[]),e.c.push({t:t,a:n||"SheetJS"})},sheet_set_array_formula:function(e,t,n,r){for(var a="string"!=typeof t?t:Ru(t),i="string"==typeof t?t:Cu(t),o=a.s.r;o<=a.e.r;++o)for(var s=a.s.c;s<=a.e.c;++s){var l=bf(e,o,s);l.t="n",l.F=i,delete l.v,o==a.s.r&&s==a.s.c&&(l.f=n,r&&(l.D=!0))}return e},consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};class Sf{constructor(e,t){this.get=null,this.set=null,this.services=null,this.accountabilitySchema=null,this.itemsService=null,this.updateAccountabilitySchema=e=>{this.accountabilitySchema=e},this.getWACatalog=async({countryCode:e})=>{try{const t=[],n=new is;return(await n.getWorkAdvantageCatalogue(e)).dealList.forEach((e=>{const{benefits:n,name:r,id:a}=e;let{terms:i,howtoavail:o}=e;const s=r,l=a;n.forEach(((e,n)=>{const r=e.value,a=e.utid,c=e.upc_id,u=e.offer_id,d=e.price;0!=n&&(i=null,o=null),t.push({brandId:l,brandName:s,productName:r,utid:a,upc_id:c,offerId:u,price:d,terms:i,howtoavail:o})}))})),t}catch(e){return[]}},this.getQCCatalog=async({countryCode:e})=>{try{await(new Vi).log("getCatalog QC-AMAZON",!1,null,null);const e=[],t=new is,{productList:n,categoryId:r}=await t.getQCAmazonCatalog();await(new Vi).log(`getCatalog QC-AMAZON productList ${JSON.stringify(n)}`,!1,null,null);for(let t=0;t<n.length;t++){const a=n[t];e.push({categoryId:r,productName:a.name,sku:a.sku,price:`${a.currency.code} ${a.minPrice} - ${a.maxPrice}`})}return e}catch(e){return[]}},this.getQuickCilverCatalog=async({countryCode:e,vendorApiIntId:t})=>{try{const e=[],n=new Ui(this.itemsService,this.accountabilitySchema),r=(new Mi(this.itemsService,this.accountabilitySchema),new is),a=await n.getVendorFromVendorCode(t,null)?vengetQuickCilverCatalogdorDetails.categoryid:null,{productList:i,categoryId:o}=await r.getQuickCilverCatalogList(a);for(let t=0;t<i.length;t++){const n=i[t];e.push({categoryId:o,productName:n.name,sku:n.sku,price:`${n.currency.code} ${n.minPrice} - ${n.maxPrice}`})}return e}catch(e){return[]}},this.getRewardCatalog=async({countryCode:e,vendorApiIntId:t})=>{try{return await rs()}catch(e){return[]}},this.getCatalog=async({vendorApiIntId:e,countryCode:t})=>{let n=[];await(new Vi).log("getCatalog initialize",!1,null,null);try{switch(e){case Li.vendor_id_mapping.WORK_ADVANTAGE:n=await this.getWACatalog({countryCode:t});break;case Li.vendor_id_mapping.AMAZON_QC:n=await this.getQCCatalog({countryCode:t});break;case Li.vendor_id_mapping.FLIPKART_EGV:n=[];break;case Li.vendor_id_mapping.QUICKCILVER_EGV:n=await this.getQuickCilverCatalog({countryCode:t,vendorApiIntId:e});break;case Li.vendor_id_mapping.REWARD_STORE:n=await this.getRewardCatalog({countryCode:t,vendorApiIntId:e})}}catch(e){return{success:!1,error:e,catalog:null}}return{success:!0,catalog:n,error:null}},this.catalogToExcel=async({vendorApiIntId:e,catalog:t})=>{try{const n=new Mi(this.itemsService,this.accountabilitySchema),r=new Ui(this.itemsService,this.accountabilitySchema);if(t.length>0){const a=await r.getVendorFromVendorCode(e,null),i=a?a.id:null;t.forEach((n=>{e==Li.vendor_id_mapping.REWARD_STORE&&(n.sku=t.id,t.id=null),n.vendorId=i})),e!=Li.vendor_id_mapping.REWARD_STORE&&await n.vendorCatalogue(t)}if(e==Li.vendor_id_mapping.WORK_ADVANTAGE){const e=32767,n=[{header:"Brand Id",key:"brandId"},{header:"Brand Name",key:"brandName"},{header:"Product Name",key:"productName"},{header:"UTID",key:"utid"},{header:"UPC ID",key:"upc_id"},{header:"Offer Id",key:"offerId"},{header:"Price",key:"price"},{header:"TNC",key:"terms"},{header:"How to Avail",key:"howtoavail"}],r=t.map((t=>{const r={};return n.forEach((n=>{let a=t[n.key];"string"==typeof a&&a.length>e&&(a=a.slice(0,e-3)+"..."),r[n.header]=a})),r})),a=wf.json_to_sheet(r),i=wf.book_new();wf.book_append_sheet(i,a,"Sheet 1");return uf(i,{type:"buffer",bookType:"xlsx"})}if(e==Li.vendor_id_mapping.AMAZON_QC){const e=[{header:"Category Id",key:"categoryId"},{header:"Product Name",key:"productName"},{header:"SKU",key:"sku"},{header:"Price",key:"price"}],n=t.map((t=>{const n={};return e.forEach((e=>{n[e.header]=t[e.key]})),n})),r=wf.json_to_sheet(n),a=wf.book_new();wf.book_append_sheet(a,r,"Sheet 1");return uf(a,{type:"buffer",bookType:"xlsx"})}if(e==Li.vendor_id_mapping.QUICKCILVER_EGV){const e=[{header:"Category Id",key:"categoryId"},{header:"Product Name",key:"productName"},{header:"SKU",key:"sku"},{header:"Price",key:"price"}],n=t.map((t=>{const n={};return e.forEach((e=>{n[e.header]=t[e.key]})),n})),r=wf.json_to_sheet(n),a=wf.book_new();wf.book_append_sheet(a,r,"Sheet 1");return uf(a,{type:"buffer",bookType:"xlsx"})}if(e==Li.vendor_id_mapping.REWARD_STORE){const e=[{header:"Category Name",key:"category"},{header:"Sub Category",key:"sub_category"},{header:"Product Name",key:"name"},{header:"SKU",key:"sku"},{header:"Discount (%)",key:"discount"},{header:"Details",key:"details"},{header:"How to Use",key:"how_to_use"},{header:"Image URL",key:"image_url"},{header:"Delivery Time (hrs)",key:"delivery_time"},{header:"Validity (days)",key:"validity"},{header:"Delivery Type",key:"delivery_type"},{header:"Terms & Conditions",key:"terms_and_conditions"},{header:"Redemption Type",key:"redemption_type"},{header:"Country",key:"country"},{header:"Currency",key:"currency"},{header:"Denomination Min",key:"min"},{header:"Denomination Max",key:"max"}],n=t.flatMap((t=>{if(!t.denominations||0===t.denominations.length){const n={};return e.forEach((e=>{n[e.header]=t[e.key]||""})),[n]}return t.denominations.map((n=>{const r={};return e.forEach((e=>{["min","max","discount"].includes(e.key)?r[e.header]=n[e.key]:r[e.header]=t[e.key]||""})),r}))})),r=wf.json_to_sheet(n),a=wf.book_new();wf.book_append_sheet(a,r,"Sheet 1");return uf(a,{type:"buffer",bookType:"xlsx"})}}catch(e){return null}},this.getWABalance=async()=>{try{const e=new is,{success:t,balance:n}=await e.getWorkAdvantageWalletBalance();return{success:t,balance:n}}catch(e){return{success:!1,error:e}}},this.getRewardStoreBalance=async()=>{try{const e=new is,{success:t,balance:n,currency:r}=await e.getRewardStoreWalletBalance();return{success:t,balance:n,currency:r}}catch(e){return{success:!1,error:e}}},this.getFlipkartBalance=async()=>{try{const e=new is,{success:t,balance:n}=await e.getFlipkartWalletBalance();return{success:t,balance:n}}catch(e){return{success:!1,error:e}}},this.getBalance=async({vendorApiIntId:e})=>{try{switch(e){case Li.vendor_id_mapping.WORK_ADVANTAGE:return this.getWABalance();case Li.vendor_id_mapping.AMAZON_QC:return{success:!1,error:"Balance Auto updated when order placed",balance:0};case Li.vendor_id_mapping.FLIPKART_EGV:return this.getFlipkartBalance();case Li.vendor_id_mapping.QUICKCILVER_EGV:return{success:!1,error:"Balance Auto updated when order placed",balance:0};case Li.vendor_id_mapping.REWARD_STORE:return this.getRewardStoreBalance()}return{success:!1,error:"Vendor Not found"}}catch(e){return{success:!1,error:e}}},this.getRedispatchDetails=async e=>{try{const t=new is;return await t.getFlipkartRedispatch(e)}catch(e){return await(new Vi).jsonError({exception:e,error:"getRedispatchDetails"},null,null),{success:!1,error:e}}},this.generateFlipkartVoucher=async(e,t)=>{try{const n=new is;return await n.generateFlipkartVoucher(e,t)}catch(e){return await(new Vi).jsonError({exception:e,error:"generateFlipkartVoucher"},null,null),{success:!1,error:e}}},this.updateCatalog=async({vendorApiIntId:e,countryCode:t})=>{let n=[];await(new Vi).log("update catalog initialize",!1,null,null);try{if(e===Li.vendor_id_mapping.QUICKCILVER_EGV)n=await this.updateQuickCilverCatalogId({countryCode:t,vendorApiIntId:e})}catch(e){return await(new Vi).jsonError({exception:e,error:"updateCatalog"},null,null),{success:!1,error:e,message:"record"}}return n},this.updateQuickCilverCatalogId=async({countryCode:e,vendorApiIntId:t})=>{try{await(new Vi).log(`update catalog controller vendorApiIntId ${t}`,!1,null,null);const e=new Ui(this.itemsService,this.accountabilitySchema),n=new Mi(this.itemsService,this.accountabilitySchema),r=new is,a=await e.getVendorFromVendorCode(t,null);await(new Vi).log(`vendorDetails ${a}`,!1,null,null);const i=a?a.id:null,{categoryId:o}=await r.updateQuickCilverCatalog();if(await(new Vi).log(`categoryId ${o}`,!1,null,null),await(new Vi).log(`id ${i}`,!1,null,null),o&&i){return await n.updateVendorCategoryId(i,o)?{success:!0,message:"Record Updated"}:(await(new Vi).log("categoryId Record not Updated",!1,null,null),{success:!0,message:"Record not Updated"})}return{success:!0,message:"Record not Updated, Due to CategoryId / Vendorid Not Available"}}catch(e){return await(new Vi).jsonError({exception:e,error:"updateQuickCilverCatalogId"},null,null),[]}},this.getQCBalance=async(e,t)=>{try{const n=new is;await(new Vi).log("getQCBalance",!1,null,null);const{status:r,message:a,balance:i,responseJson:o}=await n.getQCWalletBalance(e,t);return{status:r,message:a,balance:i,responseJson:o}}catch(e){return{success:!1,error:e}}},this.inventoryReport=async(e,t,n)=>{try{const r=new Ui(this.itemsService,this.accountabilitySchema),a=new Mi(this.itemsService,this.accountabilitySchema),i=new is;await(new Vi).log("getQCBalance",!1,null,null);const o=await r.inventoryRedeemList(e,t,n),s=0!==o.length;if(s)for(let e=0;e<o.length;e++){let t=o[e].pin.replace(/-/g,""),n=o[e].code;if(t&&n){const{status:r,message:s,balance:l,responseJson:c}=await i.getQCWalletBalance(n,t);if(r&&l>0){let t={};t.giftcard_inventory_id=o[e].id,t.balance=c.balance,t.validity=c.expiry,t.code_status=c.status,await a.sd_giftcard_inventory_balance_report(t),await a.updateCheckBalaceStatus(o[e].id)}}else await(new Vi).log(`Pin Not Available id: ${o[e].id}`,!1,null,null)}return{success:s,inventoryList:o}}catch(e){return await(new Vi).log(`inventoryReport ${e}`,!1,null,null),{success:!1,error:e}}},this.revalidateInventoryReport=async(e,t)=>{try{const n=new Ui(this.itemsService,this.accountabilitySchema),r=new Mi(this.itemsService,this.accountabilitySchema),a=new is;await(new Vi).log("Revalidate Inventory Report",!1,null,null);const i=await n.inventoryRedeemListRevlidate(e,t),o=0!==i.length;for(let e=0;e<i.length;e++){let t=i[e].giftcard_inventory_id.pin.replace(/-/g,""),n=i[e].giftcard_inventory_id.code;if(t&&n){const{status:o,message:s,balance:l,responseJson:c}=await a.getQCWalletBalance(n,t);if(o&&l>0){const t=c.expiry;await r.revalidateCheckBalaceStatus(i[e].id,t)}}else await(new Vi).log(`Pin Not Available id: ${i[e].id}`,!1,null,null)}return{success:o,inventoryList:i}}catch(e){return await(new Vi).log(`inventoryReport ${e}`,!1,null,null),{success:!1,error:e}}},this.services=e,this.accountabilitySchema=t;const{ItemsService:n}=e;this.itemsService=n}async oldVouchersWorkAdvantage({vendor_code:e,reference_id:t,options:n}){var r,a;try{const i=new ls(this.itemsService,this.accountabilitySchema),{vouchers:o,success:s,message:l,exception:c,orderId:u}=await i.getOrderDetails(t,e),d=(n&&n.store_to_inventory,s?await i.storeToInventory({vouchers:o,reference_id:t,orderId:u,options:n,brand_sku:brand_sku,vendor_code:e}):null),p=null!==(r=null==d?void 0:d.keys)&&void 0!==r?r:null,h=null!==(a=null==d?void 0:d.VoucherList)&&void 0!==a?a:null,m={success:s,message:l,keys:p||null,exception:c,vendorCode:e,response:[]};return s&&h&&h.length&&h.forEach((({cardnumber:e,pin_or_url:t,expiry:n,link_reference_id:r,reference_code_otp:a})=>{const i={code:e,pin:t,expiry:os(n),link_reference_id:r,reference_code_otp:a};m.response.push(i)})),m}catch(n){await(new Vi).jsonError({exception:n,error:"oldVouchersWorkAdvantage Error"},t,e)}}async oldVouchersQCAmazon({vendor_code:e,reference_id:t,options:n}){var r,a;try{const i=new Ui(this.itemsService,this.accountabilitySchema),o=new Mi(this.itemsService,this.accountabilitySchema),s=await i.getVendorFromVendorCode(e,t),l=s?s.id:null;let c=[],u="",d="";let p=n.voucherSku;const h=new cs(this.itemsService,this.accountabilitySchema);c=await i.getVendorOrderFromRef(t,l,e),u=c&&c.vendor_order_id?c.vendor_order_id:null,d=c&&c.reference_append?c.reference_append:0;const m=d?`${t}-${d}`:t,f=await h.checkOrderStatus(m,e);if("CANCELED"==f.status){return{success:!1,message:"Order Status: CANCELED",keys:null,exception:!1,orderStatusFromVendor:null,statusCodeFromVendor:null,vendorCode:e,response:[]}}if("PENDING"==f.status){return{success:!1,message:"Order Status: PENDING",keys:null,exception:!1,orderStatusFromVendor:null,statusCodeFromVendor:null,vendorCode:e,response:[]}}if("PROCESSING"==f.status){return{success:!1,message:"Order Status: PROCESSING",keys:null,exception:!1,orderStatusFromVendor:null,statusCodeFromVendor:null,vendorCode:e,response:[]}}if("COMPLETE"!=f.status){return{success:!1,message:"Order not found",keys:null,exception:!1,orderStatusFromVendor:null,statusCodeFromVendor:null,vendorCode:e,response:[]}}u=f.orderId;const{vouchers:y,success:g,message:b,exception:v,orderId:w,status:S}=await h.getOrderDetails(m,u,e),E=(await o.updateVendorOrderStatus(t,u||w,g?"completed":"pending",e),g?await h.storeToInventory({vouchers:y,reference_id:t,orderId:w,options:n,sku:p,vendor_code:e}):null),x=null!==(r=null==E?void 0:E.keys)&&void 0!==r?r:null,_=null!==(a=null==E?void 0:E.VoucherList)&&void 0!==a?a:null,k={success:g,message:b,keys:x||null,exception:v,orderStatusFromVendor:S,statusCodeFromVendor:S,vendorCode:e,response:[]};return g&&_&&_.length&&_.forEach((({cardnumber:e,pin_or_url:t,expiry:n,link_reference_id:r,reference_code_otp:a})=>{const i={code:e,pin:t,expiry:new Date(n),link_reference_id:r,reference_code_otp:a};k.response.push(i)})),k}catch(n){await(new Vi).jsonError({exception:n,error:"oldVouchersQCAmazon Error"},t,e)}}async oldVouchersFlipkart({vendor_code:e,reference_id:t,options:n}){var r,a;try{const i=new Ui(this.itemsService,this.accountabilitySchema),o=new Mi(this.itemsService,this.accountabilitySchema),s=await i.getVendorFromVendorCode(e,t),l=s?s.id:null;let c=[],u="",d=[],p=n.voucherSku,h={success:!1,message:"",response:[],keys:[],orderStatusFromVendor:"",statusCodeFromVendor:"",exception:!1,vendorCode:e};const m={},f={},y=new us(this.itemsService,this.accountabilitySchema);let g=t+"-1";if(c=await i.getVendorOrderFromRef(g,l,e),u=c&&c.vendor_order_id?c.vendor_order_id:null,u){await(new Vi).log("Fetch Gift Card From SD Gift Card Inventory:",!1,t,e);const s=await i.getVendorTrasanctionDetails(u);if(0!==s.length){h.keys.push(s[0].id);const e={code:s[0].code,pin:s[0].pin,expiry:s[0].validity,link_reference_id:s[0].link_reference_id,reference_code_otp:s[0].reference_code_otp};return h.response.push(e),h.success=!0,h.exception=!1,h.message="Fetching From Inventory",h}{const i=await this.getRedispatchDetails(u);if("SUCCESS"==i.statusCode){if(m.statusCode=i.statusCode,m.statusMessage=i.statusMessage,f.code=i.egv.code||"",f.pin=i.egv.pin||"",f.expiryDate=ss(i.egv.expiryDate)||"",f.balance=i.egv.balance||"",f.storeToInventory=!0,f.transactionId=u,f.sku=n.voucherSku,f.recipient={medium:"INLINE",format:"JSON",status:"DISPATCHED",walletInfoRequired:!1},m.egv=f,d.push(m),null===d||0==d.length)return h;await o.updateVendorOrderStatus(t,u,"completed",e);const s=await y.storeToInventory({giftCardList:d,reference_id:t,options:n,vendor_code:e,sku:p}),l=null!==(r=null==s?void 0:s.keys)&&void 0!==r?r:null,c=null!==(a=null==s?void 0:s.VoucherList)&&void 0!==a?a:null;return h.keys=l,c.forEach((({egv:e,link_reference_id:t,reference_code_otp:n})=>{const r=ss(e.expiryDate),a={code:e.code,pin:e.pin,expiry:r,link_reference_id:t,reference_code_otp:n};h.response.push(a)})),h.success=!0,h.exception=!1,h.message=d[0].statusMessage||"",h}return h}}}catch(n){await(new Vi).log(`oldVouchersFlipkart Error:${n}`,!1,t,e),await(new Vi).jsonError({exception:n,error:"oldVouchersFlipkart Error"},t,e)}}async oldVouchersQuickCilver({vendor_code:e,reference_id:t,options:n}){var r,a;try{const i=new Ui(this.itemsService,this.accountabilitySchema),o=new Mi(this.itemsService,this.accountabilitySchema),s=await i.getVendorFromVendorCode(e,t),l=s?s.id:null;let c=[],u="",d="";let p=n.voucherSku;const h=new ds(this.itemsService,this.accountabilitySchema);c=await i.getVendorOrderFromRef(t,l,e),u=c&&c.vendor_order_id?c.vendor_order_id:null,d=c&&c.reference_append?c.reference_append:0;const m=d?`${t}-${d}`:t,f=await h.checkOrderStatus(m,e);if("CANCELED"==f.status){return{success:!1,message:"Order Status: CANCELED",keys:null,exception:!1,orderStatusFromVendor:null,statusCodeFromVendor:null,vendorCode:e,response:[]}}if("PENDING"==f.status){return{success:!1,message:"Order Status: PENDING",keys:null,exception:!1,orderStatusFromVendor:null,statusCodeFromVendor:null,vendorCode:e,response:[]}}if("PROCESSING"==f.status){return{success:!1,message:"Order Status: PROCESSING",keys:null,exception:!1,orderStatusFromVendor:null,statusCodeFromVendor:null,vendorCode:e,response:[]}}if("COMPLETE"!=f.status){return{success:!1,message:"Order not found",keys:null,exception:!1,orderStatusFromVendor:null,statusCodeFromVendor:null,vendorCode:e,response:[]}}u=f.orderId;const{vouchers:y,success:g,message:b,exception:v,orderId:w,status:S}=await h.getOrderDetails(m,u,e),E=(await o.updateVendorOrderStatus(t,u||w,g?"completed":"pending",e),g?await h.storeToInventory({vouchers:y,reference_id:t,orderId:w,options:n,sku:p,vendor_code:e}):null),x=null!==(r=null==E?void 0:E.keys)&&void 0!==r?r:null,_=null!==(a=null==E?void 0:E.VoucherList)&&void 0!==a?a:null,k={success:g,message:b,keys:x||null,exception:v,orderStatusFromVendor:S,statusCodeFromVendor:S,vendorCode:e,response:[]};return g&&_&&_.length&&_.forEach((({cardnumber:e,pin_or_url:t,expiry:n,link_reference_id:r,reference_code_otp:a})=>{const i={code:e,pin:t,expiry:new Date(n),link_reference_id:r,reference_code_otp:a};k.response.push(i)})),k}catch(n){await(new Vi).jsonError({exception:n,error:"oldVouchersQC Error"},t,e)}}async getAndStoreOldVouchers({vendor_code:e,reference_id:t,options:n}){try{switch(e){case Li.vendor_id_mapping.WORK_ADVANTAGE:return this.oldVouchersWorkAdvantage({vendor_code:e,reference_id:t,options:n});case Li.vendor_id_mapping.AMAZON_QC:return this.oldVouchersQCAmazon({vendor_code:e,reference_id:t,options:n});case Li.vendor_id_mapping.FLIPKART_EGV:return this.oldVouchersFlipkart({vendor_code:e,reference_id:t,options:n});case Li.vendor_id_mapping.QUICKCILVER_EGV:return this.oldVouchersQuickCilver({vendor_code:e,reference_id:t,options:n})}return{success:!1,message:"Unknown Vendor"}}catch(n){await(new Vi).jsonError({exception:n,error:"PrevOrd getOldVouchers Error"},t,e)}}async orderWorkAdvantage({vendor_code:e,reference_id:t,options:n,brand_sku:r,quantity:a}){var i,o;try{const s=new Ui(this.itemsService,this.accountabilitySchema),l=new Mi(this.itemsService,this.accountabilitySchema),c=await s.getVendorFromVendorCode(e,t),u=c?c.id:null;let d=[],p="";const h=new ls(this.itemsService,this.accountabilitySchema);if(d=await s.getVendorOrderFromRef(t,u,e),p=d&&d.vendor_order_id?d.vendor_order_id:null,!d){await l.addVendorOrder(t,u,e)}const{vouchers:m,success:f,message:y,exception:g,orderId:b}=await h.placeNewWaOrder(t,a,r,e,n),v=(await l.updateVendorOrderStatus(t,p||b,f?"completed":"pending",e),f?await h.storeToInventory({vouchers:m,reference_id:t,orderId:b,options:n,brand_sku:r,vendor_code:e}):null),w=null!==(i=null==v?void 0:v.keys)&&void 0!==i?i:null,S=null!==(o=null==v?void 0:v.VoucherList)&&void 0!==o?o:null,E={success:f,message:y,keys:w||null,exception:g,vendorCode:e,response:[]};return f&&S&&S.length&&S.forEach((({cardnumber:e,pin_or_url:t,expiry:n,link_reference_id:r,reference_code_otp:a})=>{const i={code:e,pin:t,expiry:os(n),link_reference_id:r,reference_code_otp:a};E.response.push(i)})),E}catch(n){return await(new Vi).jsonError({exception:n,error:`orderWorkAdvantage Error : ${n}`},t,e),{success:!1,message:"Server Error Occurred",vendorCode:e}}}async orderQCAmazon({vendor_code:e,reference_id:t,options:n,brand_sku:r,quantity:a,env:i}){var o,s;try{t.startsWith(i.SD_PREFIX)||(t=i.SD_PREFIX+t);const l=new Ui(this.itemsService,this.accountabilitySchema),c=new Mi(this.itemsService,this.accountabilitySchema),u=await l.getVendorFromVendorCode(e,t),d=u?u.id:null;let p=[],h="",m="",f=!1;const y=new cs(this.itemsService,this.accountabilitySchema);p=await l.getVendorOrderFromRef(t,d,e),h=p&&p.vendor_order_id?p.vendor_order_id:null,m=p&&p.reference_append?p.reference_append:0;let g=m?`${t}-${m}`:t;const b=await y.checkOrderStatus(g,e);if("CANCELED"==b.status){m=1*m+1,g=m?`${t}-${m}`:t;await c.updateVendorOrderReferenceAppend(t,m,e)}else{if("PENDING"==b.status){return{success:!1,message:"Order Status: PENDING",keys:null,exception:!1,orderStatusFromVendor:null,statusCodeFromVendor:null,vendorCode:e,response:[]}}if("PROCESSING"==b.status){return{success:!1,message:"Order Status: PROCESSING",keys:null,exception:!1,orderStatusFromVendor:null,statusCodeFromVendor:null,vendorCode:e,response:[]}}"COMPLETE"==b.status&&(h=b.orderId,f=!0)}if(!p){await c.addVendorOrder(t,d,e)}const{vouchers:v,success:w,message:S,exception:E,orderId:x,status:_,statusCode:k,walletBalance:I}=await y.placeOrder(g,a,r,n,h,f,e);await c.updateVendorOrderStatus(t,h||x,w||f?"completed":"pending",e);if(I)try{await c.updateVendorWalletBalance(d,I)}catch(n){await(new Vi).jsonError({exception:n,error:"Wallet Updation Error"},t,e)}const T=w?await y.storeToInventory({vouchers:v,reference_id:t,orderId:x,options:n,brand_sku:r,vendor_code:e}):null,A=null!==(o=null==T?void 0:T.keys)&&void 0!==o?o:null,O=null!==(s=null==T?void 0:T.VoucherList)&&void 0!==s?s:null,K={success:w,message:S,keys:A||null,exception:E,orderStatusFromVendor:_,statusCodeFromVendor:k,vendorCode:e,response:[]};return w&&O&&O.length&&O.forEach((({cardnumber:e,pin_or_url:t,expiry:n,link_reference_id:r,reference_code_otp:a})=>{const i={code:e,pin:t,expiry:new Date(n),link_reference_id:r,reference_code_otp:a};K.response.push(i)})),K}catch(n){return await(new Vi).jsonError({exception:n,error:`orderQCAmazon Error : ${n}`},t,e),{success:!1,message:`Server Error Occurred : ${n}`,vendorCode:e}}}async orderFlipkart({vendor_code:e,reference_id:t,options:n,brand_sku:r,quantity:a,env:i}){var o,s;try{const i=new Ui(this.itemsService,this.accountabilitySchema),l=(new Mi(this.itemsService,this.accountabilitySchema),await i.getVendorFromVendorCode(e,t)),c=(l&&l.id,""),u=new us(this.itemsService,this.accountabilitySchema);let{giftCardList:d,success:p,message:h,exception:m,orderId:f,vendorCode:y}=await u.flipkartplaceOrder(t,a,r,n,c,e);const g={success:p,message:h||"",response:[],keys:[],orderStatusFromVendor:"",statusCodeFromVendor:"",exception:m,vendorCode:e};a!==d.length&&(p=!1);const b=0!==d.length?await u.storeToInventory(d,t,n,e,r,p):null,v=null!==(o=null==b?void 0:b.keys)&&void 0!==o?o:null,w=null!==(s=null==b?void 0:b.VoucherList)&&void 0!==s?s:null;return g.keys=v,p&&w.forEach((({egv:e,link_reference_id:t,reference_code_otp:n})=>{const r=ss(e.expiryDate),a={code:e.code,pin:e.pin,expiry:r,link_reference_id:t,reference_code_otp:n};g.response.push(a)})),g.success=p,g.exception=!p,g}catch(n){return await(new Vi).jsonError({exception:n,error:"Flipkart Error "},t,e),{success:!1,message:"Server Error Occurred",vendorCode:e}}}async orderQuickCilver({vendor_code:e,reference_id:t,options:n,brand_sku:r,quantity:a,env:i}){var o,s;try{t.startsWith(i.SD_PREFIX)||(t=i.SD_PREFIX+t);const l=new Ui(this.itemsService,this.accountabilitySchema),c=new Mi(this.itemsService,this.accountabilitySchema),u=await l.getVendorFromVendorCode(e,t),d=u?u.id:null;let p=[],h="",m="",f=!1;const y=new ds(this.itemsService,this.accountabilitySchema);p=await l.getVendorOrderFromRef(t,d,e),h=p&&p.vendor_order_id?p.vendor_order_id:null,m=p&&p.reference_append?p.reference_append:0;let g=m?`${t}-${m}`:t;const b=await y.checkOrderStatus(g,e);if("CANCELED"==b.status){m=1*m+1,g=m?`${t}-${m}`:t;await c.updateVendorOrderReferenceAppend(t,m,e)}else{if("PENDING"==b.status){return{success:!1,message:"Order Status: PENDING",keys:null,exception:!1,orderStatusFromVendor:null,statusCodeFromVendor:null,vendorCode:e,response:[]}}if("PROCESSING"==b.status){return{success:!1,message:"Order Status: PROCESSING",keys:null,exception:!1,orderStatusFromVendor:null,statusCodeFromVendor:null,vendorCode:e,response:[]}}"COMPLETE"==b.status&&(h=b.orderId,f=!0)}if(!p){await c.addVendorOrder(t,d,e)}const{vouchers:v,success:w,message:S,exception:E,orderId:x,status:_,statusCode:k,walletBalance:I}=await y.placeOrder(g,a,r,n,h,f,e);await c.updateVendorOrderStatus(t,h||x,w||f?"completed":"pending",e);if(I)try{await c.updateVendorWalletBalance(d,I)}catch(n){await(new Vi).jsonError({exception:n,error:"Wallet Updation Error"},t,e)}const T=w?await y.storeToInventory({vouchers:v,reference_id:t,orderId:x,options:n,brand_sku:r,vendor_code:e}):null,A=null!==(o=null==T?void 0:T.keys)&&void 0!==o?o:null,O=null!==(s=null==T?void 0:T.VoucherList)&&void 0!==s?s:null,K={success:w,message:S,keys:A||null,exception:E,orderStatusFromVendor:_,statusCodeFromVendor:k,vendorCode:e,response:[]};return w&&O&&O.length&&O.forEach((({cardnumber:e,pin_or_url:t,expiry:n,link_reference_id:r,reference_code_otp:a})=>{const i={code:e,pin:t,expiry:new Date(n),link_reference_id:r,reference_code_otp:a};K.response.push(i)})),K}catch(n){return await(new Vi).jsonError({exception:n,error:`orderQC Error : ${n}`},t,e),{success:!1,message:`Server Error Occurred : ${n}`,vendorCode:e}}}async orderRewardStore({vendor_code:e,reference_id:t,options:n,brand_sku:r,quantity:a,env:i}){var o,s;try{t.startsWith(i.SD_PREFIX)||(t=i.SD_PREFIX+t);let l=[],c="",u="",d=!1;const p=new Ui(this.itemsService,this.accountabilitySchema),h=new Mi(this.itemsService,this.accountabilitySchema),m=await p.getVendorFromVendorCode(e,t),f=m?m.id:null,y=new ps(this.itemsService,this.accountabilitySchema);l=await p.getVendorOrderFromRef(t,f,e),c=l&&l.vendor_order_id?l.vendor_order_id:null,u=l&&l.reference_append?l.reference_append:0;let g=u?`${t}-${u}`:t;if(!l){await h.addVendorOrder(t,f,e)}const{vouchers:b,success:v,message:w,id:S,status:E,exception:x,statusCode:_}=await y.placeOrder(g,a,r,n,c,d,e),k=(await h.updateVendorOrderStatus(t,c||S,v||d?"completed":"pending",e),v?await y.storeToInventory({vouchers:b,reference_id:t,id:S,options:n,brand_sku:r,vendor_code:e}):null),I=null!==(o=null==k?void 0:k.keys)&&void 0!==o?o:null,T=null!==(s=null==k?void 0:k.VoucherList)&&void 0!==s?s:null,A={success:v,message:w,keys:I||null,exception:x,orderStatusFromVendor:E,statusCodeFromVendor:_,vendorCode:e,response:[]};return v&&T&&T.length&&T.forEach((({cardnumber:e,pin_or_url:t,expiry:n,link_reference_id:r,reference_code_otp:a})=>{const i={code:e,pin:t,expiry:new Date(n),link_reference_id:r,reference_code_otp:a};A.response.push(i)})),A}catch(n){return await(new Vi).jsonError({exception:n,error:"Reward Store Error "},t,e),{success:!1,message:"Server Error Occurred",vendorCode:e}}}async placeNewOrderAndStoreVoucher({vendor_code:e,reference_id:t,options:n,brand_sku:r,quantity:a,env:i}){try{new Ui(this.itemsService,this.accountabilitySchema);switch(e){case Li.vendor_id_mapping.WORK_ADVANTAGE:return this.orderWorkAdvantage({vendor_code:e,reference_id:t,options:n,brand_sku:r,quantity:a});case Li.vendor_id_mapping.AMAZON_QC:return this.orderQCAmazon({vendor_code:e,reference_id:t,options:n,brand_sku:r,quantity:a,env:i});case Li.vendor_id_mapping.FLIPKART_EGV:return this.orderFlipkart({vendor_code:e,reference_id:t,options:n,brand_sku:r,quantity:a,env:i});case Li.vendor_id_mapping.QUICKCILVER_EGV:return this.orderQuickCilver({vendor_code:e,reference_id:t,options:n,brand_sku:r,quantity:a,env:i});case Li.vendor_id_mapping.REWARD_STORE:return this.orderRewardStore({vendor_code:e,reference_id:t,options:n,brand_sku:r,quantity:a,env:i})}return{success:!1,message:"Unknown Vendor",vendorCode:e}}catch(n){await(new Vi).jsonError({exception:n,error:"PrevOrd placeNewOrderAndStoreVoucher Error"},t,e)}return{success:!1,message:"PrevOrd placeNewOrderAndStoreVoucher Error",vendorCode:e}}async getLinkVouchers({link_reference_id:e,reference_code_otp:t,env:n}){try{await(new Vi).log("get Link Voucher Controller:"+e+"-"+t,!1,null,null),await(new Vi).log(`getLinkVouchers step 2:${e}-${t} `,!1,null,null);const r=new Ui(this.itemsService,this.accountabilitySchema);let a=await r.inventoryOtpVerification(e,t);if(0!==a.length){const{product_code:t,price:r,link_ledger_reference_id:i,soft_link_redeemed_status:o,id:s}=a[0];let l=t,c=s,u=r;return await(new Vi).log(`getLinkVouchers step 3:${l}-${u}-${c}`,!1,null,null),await this.getLinkVoucherDetails({sku:l,amount:u,link_reference_id:e,link_ledger_reference_id:i,env:n,soft_link_redeemed_status:o,inventoryId:c})}return{success:!1,message:"Not Found Record!. Please Contact The administrator."}}catch(e){return await(new Vi).jsonError({exception:e,error:`getLinkVouchers Error ${e}`},null,null),{success:!1,message:"Not Found Record!. Please Contact The administrator."}}}async getLinkVoucherDetails({sku:e,amount:t,link_reference_id:n,link_ledger_reference_id:r,env:a,soft_link_redeemed_status:i,inventoryId:o}){try{const s=new Ui(this.itemsService,this.accountabilitySchema),l=new Mi(this.itemsService,this.accountabilitySchema);let c=[],u={success:!0,message:"Voucher Successfully Fetched",amount:"",voucher:"",pin:"",valid_till:"",brand_details:{}},d=await s.getBrandSkuMappingbySku(e);if(!i){let p=await s.getCampaignRedemptions(n,a);if(null==p?void 0:p.data.success){let h=(null==p?void 0:p.data.data.soft_link_redemption_id)||"";if(await(new Vi).log(`redeemedId:${h}`,!1,null,null),h){await(new Vi).log(` redeemedId:${h}`,!1,null,null);let e=await s.getInventoryByid(h);return await(new Vi).log(` voucher:${e}`,!1,null,null),i||await l.softLinkOtpVerificationUpdate(o),u.voucher=e[0].code,u.pin=e[0].pin,u.valid_till=e[0].validity,u.amount=e[0].price,u.brand_details=d,u}{await(new Vi).log("get Link VoucherDetails Controller:"+e+"-"+t+"-"+n,!1,null,null),await(new Vi).log(`getLinkVoucherDetails step 4:${e}-${t}-${n}`,!1,null,null);let i=e+"-"+n;i&&(await(new Vi).log(`getLinkVoucherDetails step 5:${i}`,!1,null,null),c=await s.getLinkVoucherDetailsbyorderid(i)),await(new Vi).log("getLinkVoucherDetails orderId:"+r,!1,null,null),await(new Vi).log(`getLinkVoucherDetails link_ledger_reference_id:${r}`,!1,null,null),r&&0===c.length&&(await(new Vi).log(`getLinkVoucherDetails step 6:${r}`,!1,null,null),c=await s.getLinkVoucherDetailsbyorderid(r)),0===c.length&&(i||r)&&(await(new Vi).log(`getLinkVoucherDetails step 7:${c.length}`,!1,null,null),c=await s.getLinkVoucherDetails(e,t));let p={};if(0!==c.length){await(new Vi).log(`getLinkVoucherDetails step 8:${c.length}`,!1,null,null);const e=c[0];return e.gift_card||(await(new Vi).log(`getLinkVoucherDetails step 9:${e.gift_card}`,!1,null,null),r?(await(new Vi).log(`link_ledger_reference_id:${r}`,!1,null,null),p=await l.updateLinkVoucherStatus(e.id,r)):(await(new Vi).log(`soft_link_order_id:${i}`,!1,null,null),p=await l.updateLinkVoucherStatus(e.id,i)),await l.softLinkOtpVerificationUpdate(o),await l.updateSoftLinkRedemptionInCampaigns(n,p,a)),u.voucher=e.code,u.pin=e.pin,u.valid_till=e.validity,u.amount=e.price,u.brand_details=d,u}return u.message="Not Fetched Voucher Details . Please Contact The administrator.",u.success=!1,u}}return u.message="Not Fetched Voucher Details! Please Contact The administrator.",u.success=!1,u}if(i){await(new Vi).log(` soft_link_redeemed_status:${i}`,!1,null,null);let e=await s.getCampaignRedemptions(n,a);if(await(new Vi).log(` getOneRedeem:${e.data}`,!1,null,null),e.data.success){let t=e.data.data.soft_link_redemption_id||"";if(t){let e=await s.getInventoryByid(t);return u.voucher=e[0].code,u.pin=e[0].pin,u.valid_till=e[0].validity,u.amount=e[0].price,u.brand_details=d,u}return u.message="Not Fetched Voucher Details! Please Contact The administrator.",u.success=!1,u}return u.message="Not Fetched Voucher Details Please Contact The administrator.",u.success=!1,u}}catch(e){return await(new Vi).jsonError({exception:e,error:"get Link Voucher Details Error"},null,null),{success:!1,message:"get Link Voucher Details Error"}}}async otpVerification({link_reference_id:e,reference_code_otp:t}){try{await(new Vi).log(` otpVerification:${e}-${t}`,!1,null,null);const n=new Ui(this.itemsService,this.accountabilitySchema);return 0!==(await n.inventoryOtpVerification(e,t)).length?(await(new Vi).log(` OTP Verified:${e}-${t}`,!1,null,null),{success:!0,message:"OTP Verified"}):{success:!1,message:"Invalid OTP/Code"}}catch(e){return await(new Vi).jsonError({exception:e,error:"otpVerification Error"},null,null),null}}async otpUpdate({link_reference_id:e,reference_code_otp:t,old_reference_code_otp:n}){try{const r=new Ui(this.itemsService,this.accountabilitySchema),a=new Mi(this.itemsService,this.accountabilitySchema);let i=await r.getInventoryByreferance(e,n);if(0!==i.length){if(i[0].link_reference_id===e){let n=await a.updateOtp(i[0].id,t,e);return i=await r.getInventoryByid(n),{success:!0,message:"OTP Updated",response:i}}return{success:!1,message:"OTP Not Updated! Due to Link Reference Id Not Matched "}}return{success:!1,message:"OTP Not Updated"}}catch(e){return await(new Vi).jsonError({exception:e,error:`OTP Not Updated ${e}`},null,null),{success:!1,message:"OTP Not Updated"}}}async getOneVocher(e){try{const t=new Ui(this.itemsService,this.accountabilitySchema);new Mi(this.itemsService,this.accountabilitySchema);let n=await t.getVoucherBySoftLinkId(e);return 0!==n.length?n:[]}catch(e){await(new Vi).jsonError({exception:e,error:"getOneVocher Error"},null,null)}}async referenceUpdate(e){try{new Ui(this.itemsService,this.accountabilitySchema);const t=new Mi(this.itemsService,this.accountabilitySchema);return await t.referenceupdate(e)?{success:!0,message:"Record Updated"}:{success:!0,message:"Record not Updated"}}catch(e){await(new Vi).jsonError({exception:e,error:"referenceUpdate"},null,null)}}}async function Ef({voucherRequest:e,services:t,accountabilitySchema:n,options:r,env:a}){let i="",o="";try{const{amt:s,qty:l,sku:c}=e;let{cur:u}=e;if(u||(u="INR"),!(s>0&&l>0&&Number.isInteger(l)&&c&&"string"==typeof c&&c.trim().length)){return{success:!1,message:"Please send a valid request",response:[],exception:void 0,orderStatusFromVendor:void 0,vendorCode:void 0,statusCodeFromVendor:void 0}}const{ItemsService:d}=t,p=new Ui(d,n);let h=[];const m={};h=await p.getVendorOrderByReferenceId(r.reference_id,null),0!==h.length?m.api_integration_id=h[0].vendor.api_integration_id||"":(h=await p.getVendorOrderByReferenceId(r.reference_id,null),0!==h.length&&(m.api_integration_id=h[0].vendor.api_integration_id||""));if(await p.checkBrandStatus(c,s,u,r.reference_id,null)){const e=await p.bestVendor(c,s,u,r.reference_id,null),d=e?e.choose_a_vendor:null,h=e?d.id:null;let f=e?d.api_integration_id:null;const y=e?d.entity_name:null,g=new Sf(t,n);if(d&&h||m.api_integration_id){let e={};switch(m.api_integration_id&&(f=m?m.api_integration_id:f),i=r.reference_id,o=f,f){case Li.vendor_id_mapping.WORK_ADVANTAGE:e=await g.placeNewOrderAndStoreVoucher({vendor_code:Li.vendor_id_mapping.WORK_ADVANTAGE,reference_id:r.reference_id,options:r,brand_sku:c,quantity:l,env:a});break;case Li.vendor_id_mapping.AMAZON_QC:e=await g.placeNewOrderAndStoreVoucher({vendor_code:Li.vendor_id_mapping.AMAZON_QC,reference_id:r.reference_id,options:r,brand_sku:c,quantity:l,env:a});break;case Li.vendor_id_mapping.FLIPKART_EGV:e=await g.placeNewOrderAndStoreVoucher({vendor_code:Li.vendor_id_mapping.FLIPKART_EGV,reference_id:r.reference_id,options:r,brand_sku:c,quantity:l,env:a});break;case Li.vendor_id_mapping.QUICKCILVER_EGV:e=await g.placeNewOrderAndStoreVoucher({vendor_code:Li.vendor_id_mapping.QUICKCILVER_EGV,reference_id:r.reference_id,options:r,brand_sku:c,quantity:l,env:a});break;default:e={success:!1,message:`Selected Vendor: '${y}', is not Integrated`,response:[]}}return e}await(new Vi).log("Vendor Not found, either vendor or brand or amount not mapped!!",!1,r.reference_id,o);return{success:!1,message:"Vendor Not found, either vendor or brand or amount not mapped!!",response:[],exception:null,orderStatusFromVendor:null,vendorCode:o,statusCodeFromVendor:null}}await(new Vi).log("Either brand for the given SKU is Inactive or SKU Not Mapped with given amount'",!1,r.reference_id,o);return{success:!1,message:"Either brand for the given SKU is Inactive or SKU Not Mapped with given amount",response:[],exception:null,orderStatusFromVendor:null,vendorCode:o,statusCodeFromVendor:null}}catch(e){await(new Vi).jsonError({exception:e,error:`vouchersController: ${e}`},r.reference_id,o);return{success:!1,exception:!0,message:`Exception Occurred: ${e}`,response:[],orderStatusFromVendor:null,vendorCode:o,statusCodeFromVendor:null}}}var xf={},_f={exports:{}};
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
!function(e,t){var n=q.default,r=n.Buffer;function a(e,t){for(var n in e)t[n]=e[n]}function i(e,t,n){return r(e,t,n)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=n:(a(n,t),t.Buffer=i),i.prototype=Object.create(r.prototype),a(r,i),i.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,n)},i.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var a=r(e);return void 0!==t?"string"==typeof n?a.fill(t,n):a.fill(t):a.fill(0),a},i.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},i.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}}(_f,_f.exports);var kf=_f.exports.Buffer,If=R.default;function Tf(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=kf.alloc(0),this;if("function"==typeof e.pipe)return this.buffer=kf.alloc(0),e.pipe(this),this;if(e.length||"object"==typeof e)return this.buffer=e,this.writable=!1,process.nextTick(function(){this.emit("end",e),this.readable=!1,this.emit("close")}.bind(this)),this;throw new TypeError("Unexpected data type ("+typeof e+")")}D.default.inherits(Tf,If),Tf.prototype.write=function(e){this.buffer=kf.concat([this.buffer,kf.from(e)]),this.emit("data",e)},Tf.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1};var Af=Tf;function Of(e){return(e/8|0)+(e%8==0?0:1)}var Kf={ES256:Of(256),ES384:Of(384),ES512:Of(521)};var Cf=function(e){var t=Kf[e];if(t)return t;throw new Error('Unknown algorithm "'+e+'"')},Rf=_f.exports.Buffer,jf=Cf;function Pf(e){if(Rf.isBuffer(e))return e;if("string"==typeof e)return Rf.from(e,"base64");throw new TypeError("ECDSA signature must be a Base64 string or a Buffer")}function Df(e,t,n){for(var r=0;t+r<n&&0===e[t+r];)++r;return e[t+r]>=128&&--r,r}var Nf={derToJose:function(e,t){e=Pf(e);var n=jf(t),r=n+1,a=e.length,i=0;if(48!==e[i++])throw new Error('Could not find expected "seq"');var o=e[i++];if(129===o&&(o=e[i++]),a-i<o)throw new Error('"seq" specified length of "'+o+'", only "'+(a-i)+'" remaining');if(2!==e[i++])throw new Error('Could not find expected "int" for "r"');var s=e[i++];if(a-i-2<s)throw new Error('"r" specified length of "'+s+'", only "'+(a-i-2)+'" available');if(r<s)throw new Error('"r" specified length of "'+s+'", max of "'+r+'" is acceptable');var l=i;if(i+=s,2!==e[i++])throw new Error('Could not find expected "int" for "s"');var c=e[i++];if(a-i!==c)throw new Error('"s" specified length of "'+c+'", expected "'+(a-i)+'"');if(r<c)throw new Error('"s" specified length of "'+c+'", max of "'+r+'" is acceptable');var u=i;if((i+=c)!==a)throw new Error('Expected to consume entire buffer, but "'+(a-i)+'" bytes remain');var d=n-s,p=n-c,h=Rf.allocUnsafe(d+s+p+c);for(i=0;i<d;++i)h[i]=0;e.copy(h,i,l+Math.max(-d,0),l+s);for(var m=i=n;i<m+p;++i)h[i]=0;return e.copy(h,i,u+Math.max(-p,0),u+c),h=(h=h.toString("base64")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},joseToDer:function(e,t){e=Pf(e);var n=jf(t),r=e.length;if(r!==2*n)throw new TypeError('"'+t+'" signatures must be "'+2*n+'" bytes, saw "'+r+'"');var a=Df(e,0,n),i=Df(e,n,e.length),o=n-a,s=n-i,l=2+o+1+1+s,c=l<128,u=Rf.allocUnsafe((c?2:3)+l),d=0;return u[d++]=48,c?u[d++]=l:(u[d++]=129,u[d++]=255&l),u[d++]=2,u[d++]=o,a<0?(u[d++]=0,d+=e.copy(u,d,0,n)):d+=e.copy(u,d,a,n),u[d++]=2,u[d++]=s,i<0?(u[d++]=0,e.copy(u,d,n)):e.copy(u,d,n+i),u}},Lf=q.default.Buffer,Mf=q.default.SlowBuffer,Ff=Bf;function Bf(e,t){if(!Lf.isBuffer(e)||!Lf.isBuffer(t))return!1;if(e.length!==t.length)return!1;for(var n=0,r=0;r<e.length;r++)n|=e[r]^t[r];return 0===n}Bf.install=function(){Lf.prototype.equal=Mf.prototype.equal=function(e){return Bf(this,e)}};var Vf=Lf.prototype.equal,Uf=Mf.prototype.equal;Bf.restore=function(){Lf.prototype.equal=Vf,Mf.prototype.equal=Uf};var Jf,Gf=_f.exports.Buffer,$f=B.default,qf=Nf,zf=D.default,Wf="secret must be a string or buffer",Yf="key must be a string or a buffer",Hf="function"==typeof $f.createPublicKey;function Qf(e){if(!Gf.isBuffer(e)&&"string"!=typeof e){if(!Hf)throw ty(Yf);if("object"!=typeof e)throw ty(Yf);if("string"!=typeof e.type)throw ty(Yf);if("string"!=typeof e.asymmetricKeyType)throw ty(Yf);if("function"!=typeof e.export)throw ty(Yf)}}function Zf(e){if(!Gf.isBuffer(e)&&"string"!=typeof e&&"object"!=typeof e)throw ty("key must be a string, a buffer or an object")}function Xf(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function ey(e){var t=4-(e=e.toString()).length%4;if(4!==t)for(var n=0;n<t;++n)e+="=";return e.replace(/\-/g,"+").replace(/_/g,"/")}function ty(e){var t=[].slice.call(arguments,1),n=zf.format.bind(zf,e).apply(null,t);return new TypeError(n)}function ny(e){var t;return t=e,Gf.isBuffer(t)||"string"==typeof t||(e=JSON.stringify(e)),e}function ry(e){return function(t,n){!function(e){if(!Gf.isBuffer(e)){if("string"==typeof e)return e;if(!Hf)throw ty(Wf);if("object"!=typeof e)throw ty(Wf);if("secret"!==e.type)throw ty(Wf);if("function"!=typeof e.export)throw ty(Wf)}}(n),t=ny(t);var r=$f.createHmac("sha"+e,n);return Xf((r.update(t),r.digest("base64")))}}Hf&&(Yf+=" or a KeyObject",Wf+="or a KeyObject");var ay="timingSafeEqual"in $f?function(e,t){return e.byteLength===t.byteLength&&$f.timingSafeEqual(e,t)}:function(e,t){return Jf||(Jf=Ff),Jf(e,t)};function iy(e){return function(t,n,r){var a=ry(e)(t,r);return ay(Gf.from(n),Gf.from(a))}}function oy(e){return function(t,n){Zf(n),t=ny(t);var r=$f.createSign("RSA-SHA"+e);return Xf((r.update(t),r.sign(n,"base64")))}}function sy(e){return function(t,n,r){Qf(r),t=ny(t),n=ey(n);var a=$f.createVerify("RSA-SHA"+e);return a.update(t),a.verify(r,n,"base64")}}function ly(e){return function(t,n){Zf(n),t=ny(t);var r=$f.createSign("RSA-SHA"+e);return Xf((r.update(t),r.sign({key:n,padding:$f.constants.RSA_PKCS1_PSS_PADDING,saltLength:$f.constants.RSA_PSS_SALTLEN_DIGEST},"base64")))}}function cy(e){return function(t,n,r){Qf(r),t=ny(t),n=ey(n);var a=$f.createVerify("RSA-SHA"+e);return a.update(t),a.verify({key:r,padding:$f.constants.RSA_PKCS1_PSS_PADDING,saltLength:$f.constants.RSA_PSS_SALTLEN_DIGEST},n,"base64")}}function uy(e){var t=oy(e);return function(){var n=t.apply(null,arguments);return n=qf.derToJose(n,"ES"+e)}}function dy(e){var t=sy(e);return function(n,r,a){return r=qf.joseToDer(r,"ES"+e).toString("base64"),t(n,r,a)}}function py(){return function(){return""}}function hy(){return function(e,t){return""===t}}var my=function(e){var t={hs:ry,rs:oy,ps:ly,es:uy,none:py},n={hs:iy,rs:sy,ps:cy,es:dy,none:hy},r=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/i);if(!r)throw ty('"%s" is not a valid algorithm.\n  Supported algorithms are:\n  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".',e);var a=(r[1]||r[3]).toLowerCase(),i=r[2];return{sign:t[a](i),verify:n[a](i)}},fy=q.default.Buffer,yy=function(e){return"string"==typeof e?e:"number"==typeof e||fy.isBuffer(e)?e.toString():JSON.stringify(e)},gy=_f.exports.Buffer,by=Af,vy=my,wy=R.default,Sy=yy,Ey=D.default;function xy(e,t){return gy.from(e,t).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function _y(e){var t=e.header,n=e.payload,r=e.secret||e.privateKey,a=e.encoding,i=vy(t.alg),o=function(e,t,n){n=n||"utf8";var r=xy(Sy(e),"binary"),a=xy(Sy(t),n);return Ey.format("%s.%s",r,a)}(t,n,a),s=i.sign(o,r);return Ey.format("%s.%s",o,s)}function ky(e){var t=e.secret||e.privateKey||e.key,n=new by(t);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=n,this.payload=new by(e.payload),this.secret.once("close",function(){!this.payload.writable&&this.readable&&this.sign()}.bind(this)),this.payload.once("close",function(){!this.secret.writable&&this.readable&&this.sign()}.bind(this))}Ey.inherits(ky,wy),ky.prototype.sign=function(){try{var e=_y({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},ky.sign=_y;var Iy=ky,Ty=_f.exports.Buffer,Ay=Af,Oy=my,Ky=R.default,Cy=yy,Ry=D.default,jy=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function Py(e){if(function(e){return"[object Object]"===Object.prototype.toString.call(e)}(e))return e;try{return JSON.parse(e)}catch(e){return}}function Dy(e){var t=e.split(".",1)[0];return Py(Ty.from(t,"base64").toString("binary"))}function Ny(e){return e.split(".")[2]}function Ly(e){return jy.test(e)&&!!Dy(e)}function My(e,t,n){if(!t){var r=new Error("Missing algorithm parameter for jws.verify");throw r.code="MISSING_ALGORITHM",r}var a=Ny(e=Cy(e)),i=function(e){return e.split(".",2).join(".")}(e);return Oy(t).verify(i,a,n)}function Fy(e,t){if(t=t||{},!Ly(e=Cy(e)))return null;var n=Dy(e);if(!n)return null;var r=function(e,t){t=t||"utf8";var n=e.split(".")[1];return Ty.from(n,"base64").toString(t)}(e);return("JWT"===n.typ||t.json)&&(r=JSON.parse(r,t.encoding)),{header:n,payload:r,signature:Ny(e)}}function By(e){var t=(e=e||{}).secret||e.publicKey||e.key,n=new Ay(t);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=n,this.signature=new Ay(e.signature),this.secret.once("close",function(){!this.signature.writable&&this.readable&&this.verify()}.bind(this)),this.signature.once("close",function(){!this.secret.writable&&this.readable&&this.verify()}.bind(this))}Ry.inherits(By,Ky),By.prototype.verify=function(){try{var e=My(this.signature.buffer,this.algorithm,this.key.buffer),t=Fy(this.signature.buffer,this.encoding);return this.emit("done",e,t),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},By.decode=Fy,By.isValid=Ly,By.verify=My;var Vy=Iy,Uy=By;xf.ALGORITHMS=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"],xf.sign=Vy.sign,xf.verify=Uy.verify,xf.decode=Uy.decode,xf.isValid=Uy.isValid,xf.createSign=function(e){return new Vy(e)},xf.createVerify=function(e){return new Uy(e)};var Jy=xf,Gy=function(e,t){t=t||{};var n=Jy.decode(e,t);if(!n)return null;var r=n.payload;if("string"==typeof r)try{var a=JSON.parse(r);null!==a&&"object"==typeof a&&(r=a)}catch(e){}return!0===t.complete?{header:n.header,payload:r,signature:n.signature}:r},$y=function(e,t){Error.call(this,e),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="JsonWebTokenError",this.message=e,t&&(this.inner=t)};($y.prototype=Object.create(Error.prototype)).constructor=$y;var qy=$y,zy=qy,Wy=function(e,t){zy.call(this,e),this.name="NotBeforeError",this.date=t};(Wy.prototype=Object.create(zy.prototype)).constructor=Wy;var Yy=Wy,Hy=qy,Qy=function(e,t){Hy.call(this,e),this.name="TokenExpiredError",this.expiredAt=t};(Qy.prototype=Object.create(Hy.prototype)).constructor=Qy;var Zy=Qy,Xy=1e3,eg=6e4,tg=60*eg,ng=24*tg;function rg(e,t,n,r){var a=t>=1.5*n;return Math.round(e/n)+" "+r+(a?"s":"")}var ag=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"weeks":case"week":case"w":return 6048e5*n;case"days":case"day":case"d":return n*ng;case"hours":case"hour":case"hrs":case"hr":case"h":return n*tg;case"minutes":case"minute":case"mins":case"min":case"m":return n*eg;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===n&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=ng)return rg(e,t,ng,"day");if(t>=tg)return rg(e,t,tg,"hour");if(t>=eg)return rg(e,t,eg,"minute");if(t>=1e3)return rg(e,t,1e3,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=ng)return Math.round(e/ng)+"d";if(t>=tg)return Math.round(e/tg)+"h";if(t>=eg)return Math.round(e/eg)+"m";if(t>=Xy)return Math.round(e/Xy)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))},ig=function(e,t){var n=t||Math.floor(Date.now()/1e3);if("string"==typeof e){var r=ag(e);if(void 0===r)return;return Math.floor(n+r/1e3)}return"number"==typeof e?n+e:void 0},og={exports:{}};var sg={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};var lg="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};!function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:a}=sg,i=lg,o=(t=e.exports={}).re=[],s=t.safeRe=[],l=t.src=[],c=t.safeSrc=[],u=t.t={};let d=0;const p="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",a],[p,r]],m=(e,t,n)=>{const r=(e=>{for(const[t,n]of h)e=e.split(`${t}*`).join(`${t}{0,${n}}`).split(`${t}+`).join(`${t}{1,${n}}`);return e})(t),a=d++;i(e,a,t),u[e]=a,l[a]=t,c[a]=r,o[a]=new RegExp(t,n?"g":void 0),s[a]=new RegExp(r,n?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),m("MAINVERSION",`(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${l[u.NONNUMERICIDENTIFIER]}|${l[u.NUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${l[u.NONNUMERICIDENTIFIER]}|${l[u.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASE",`(?:-(${l[u.PRERELEASEIDENTIFIER]}(?:\\.${l[u.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${l[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[u.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER","[a-zA-Z0-9-]+"),m("BUILD",`(?:\\+(${l[u.BUILDIDENTIFIER]}(?:\\.${l[u.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${l[u.MAINVERSION]}${l[u.PRERELEASE]}?${l[u.BUILD]}?`),m("FULL",`^${l[u.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${l[u.MAINVERSIONLOOSE]}${l[u.PRERELEASELOOSE]}?${l[u.BUILD]}?`),m("LOOSE",`^${l[u.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${l[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${l[u.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:${l[u.PRERELEASE]})?${l[u.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:${l[u.PRERELEASELOOSE]})?${l[u.BUILD]}?)?)?`),m("XRANGE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),m("COERCE",`${l[u.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",l[u.COERCEPLAIN]+`(?:${l[u.PRERELEASE]})?`+`(?:${l[u.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",l[u.COERCE],!0),m("COERCERTLFULL",l[u.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${l[u.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",m("TILDE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${l[u.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",m("CARET",`^${l[u.LONECARET]}${l[u.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${l[u.LONECARET]}${l[u.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${l[u.GTLT]}\\s*(${l[u.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]}|${l[u.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${l[u.XRANGEPLAIN]})\\s+-\\s+(${l[u.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${l[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[u.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(og,og.exports);const cg=Object.freeze({loose:!0}),ug=Object.freeze({});var dg=e=>e?"object"!=typeof e?cg:e:ug;const pg=/^[0-9]+$/,hg=(e,t)=>{const n=pg.test(e),r=pg.test(t);return n&&r&&(e=+e,t=+t),e===t?0:n&&!r?-1:r&&!n?1:e<t?-1:1};var mg={compareIdentifiers:hg,rcompareIdentifiers:(e,t)=>hg(t,e)};const fg=lg,{MAX_LENGTH:yg,MAX_SAFE_INTEGER:gg}=sg,{safeRe:bg,t:vg}=og.exports,wg=dg,{compareIdentifiers:Sg}=mg;class Eg{constructor(e,t){if(t=wg(t),e instanceof Eg){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>yg)throw new TypeError(`version is longer than ${yg} characters`);fg("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?bg[vg.LOOSE]:bg[vg.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>gg||this.major<0)throw new TypeError("Invalid major version");if(this.minor>gg||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>gg||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<gg)return t}return e})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(fg("SemVer.compare",this.version,this.options,e),!(e instanceof Eg)){if("string"==typeof e&&e===this.version)return 0;e=new Eg(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Eg||(e=new Eg(e,this.options)),Sg(this.major,e.major)||Sg(this.minor,e.minor)||Sg(this.patch,e.patch)}comparePre(e){if(e instanceof Eg||(e=new Eg(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],r=e.prerelease[t];if(fg("prerelease compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return Sg(n,r)}while(++t)}compareBuild(e){e instanceof Eg||(e=new Eg(e,this.options));let t=0;do{const n=this.build[t],r=e.build[t];if(fg("build compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return Sg(n,r)}while(++t)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&!1===n)throw new Error("invalid increment argument: identifier is empty");if(t){const e=`-${t}`.match(this.options.loose?bg[vg.PRERELEASELOOSE]:bg[vg.PRERELEASE]);if(!e||e[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(0===this.prerelease.length)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(n)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let r=this.prerelease.length;for(;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);if(-1===r){if(t===this.prerelease.join(".")&&!1===n)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let r=[t,e];!1===n&&(r=[t]),0===Sg(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=r):this.prerelease=r}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}var xg=Eg;const _g=xg;var kg=(e,t,n=!1)=>{if(e instanceof _g)return e;try{return new _g(e,t)}catch(e){if(!n)return null;throw e}};const Ig=kg;var Tg=(e,t)=>{const n=Ig(e,t);return n?n.version:null};const Ag=kg;var Og=(e,t)=>{const n=Ag(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};const Kg=xg;var Cg=(e,t,n,r,a)=>{"string"==typeof n&&(a=r,r=n,n=void 0);try{return new Kg(e instanceof Kg?e.version:e,n).inc(t,r,a).version}catch(e){return null}};const Rg=kg;var jg=(e,t)=>{const n=Rg(e,null,!0),r=Rg(t,null,!0),a=n.compare(r);if(0===a)return null;const i=a>0,o=i?n:r,s=i?r:n,l=!!o.prerelease.length;if(!!s.prerelease.length&&!l){if(!s.patch&&!s.minor)return"major";if(0===s.compareMain(o))return s.minor&&!s.patch?"minor":"patch"}const c=l?"pre":"";return n.major!==r.major?c+"major":n.minor!==r.minor?c+"minor":n.patch!==r.patch?c+"patch":"prerelease"};const Pg=xg;var Dg=(e,t)=>new Pg(e,t).major;const Ng=xg;var Lg=(e,t)=>new Ng(e,t).minor;const Mg=xg;var Fg=(e,t)=>new Mg(e,t).patch;const Bg=kg;var Vg=(e,t)=>{const n=Bg(e,t);return n&&n.prerelease.length?n.prerelease:null};const Ug=xg;var Jg=(e,t,n)=>new Ug(e,n).compare(new Ug(t,n));const Gg=Jg;var $g=(e,t,n)=>Gg(t,e,n);const qg=Jg;var zg=(e,t)=>qg(e,t,!0);const Wg=xg;var Yg=(e,t,n)=>{const r=new Wg(e,n),a=new Wg(t,n);return r.compare(a)||r.compareBuild(a)};const Hg=Yg;var Qg=(e,t)=>e.sort(((e,n)=>Hg(e,n,t)));const Zg=Yg;var Xg=(e,t)=>e.sort(((e,n)=>Zg(n,e,t)));const eb=Jg;var tb=(e,t,n)=>eb(e,t,n)>0;const nb=Jg;var rb=(e,t,n)=>nb(e,t,n)<0;const ab=Jg;var ib=(e,t,n)=>0===ab(e,t,n);const ob=Jg;var sb=(e,t,n)=>0!==ob(e,t,n);const lb=Jg;var cb=(e,t,n)=>lb(e,t,n)>=0;const ub=Jg;var db=(e,t,n)=>ub(e,t,n)<=0;const pb=ib,hb=sb,mb=tb,fb=cb,yb=rb,gb=db;var bb=(e,t,n,r)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return pb(e,n,r);case"!=":return hb(e,n,r);case">":return mb(e,n,r);case">=":return fb(e,n,r);case"<":return yb(e,n,r);case"<=":return gb(e,n,r);default:throw new TypeError(`Invalid operator: ${t}`)}};const vb=xg,wb=kg,{safeRe:Sb,t:Eb}=og.exports;var xb=(e,t)=>{if(e instanceof vb)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let n=null;if((t=t||{}).rtl){const r=t.includePrerelease?Sb[Eb.COERCERTLFULL]:Sb[Eb.COERCERTL];let a;for(;(a=r.exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&a.index+a[0].length===n.index+n[0].length||(n=a),r.lastIndex=a.index+a[1].length+a[2].length;r.lastIndex=-1}else n=e.match(t.includePrerelease?Sb[Eb.COERCEFULL]:Sb[Eb.COERCE]);if(null===n)return null;const r=n[2],a=n[3]||"0",i=n[4]||"0",o=t.includePrerelease&&n[5]?`-${n[5]}`:"",s=t.includePrerelease&&n[6]?`+${n[6]}`:"";return wb(`${r}.${a}.${i}${o}${s}`,t)};var _b=class{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);return void 0===t?void 0:(this.map.delete(e),this.map.set(e,t),t)}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){const e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}};const kb=/\s+/g;class Ib{constructor(e,t){if(t=Ob(t),e instanceof Ib)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new Ib(e.raw,t);if(e instanceof Kb)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(kb," "),this.set=this.raw.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!Bb(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&Vb(e[0])){this.set=[e];break}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");const t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&Mb)|(this.options.loose&&Fb))+":"+e,n=Ab.get(t);if(n)return n;const r=this.options.loose,a=r?jb[Pb.HYPHENRANGELOOSE]:jb[Pb.HYPHENRANGE];e=e.replace(a,Xb(this.options.includePrerelease)),Cb("hyphen replace",e),e=e.replace(jb[Pb.COMPARATORTRIM],Db),Cb("comparator trim",e),e=e.replace(jb[Pb.TILDETRIM],Nb),Cb("tilde trim",e),e=e.replace(jb[Pb.CARETTRIM],Lb),Cb("caret trim",e);let i=e.split(" ").map((e=>Jb(e,this.options))).join(" ").split(/\s+/).map((e=>Zb(e,this.options)));r&&(i=i.filter((e=>(Cb("loose invalid filter",e,this.options),!!e.match(jb[Pb.COMPARATORLOOSE]))))),Cb("range list",i);const o=new Map,s=i.map((e=>new Kb(e,this.options)));for(const e of s){if(Bb(e))return[e];o.set(e.value,e)}o.size>1&&o.has("")&&o.delete("");const l=[...o.values()];return Ab.set(t,l),l}intersects(e,t){if(!(e instanceof Ib))throw new TypeError("a Range is required");return this.set.some((n=>Ub(n,t)&&e.set.some((e=>Ub(e,t)&&n.every((n=>e.every((e=>n.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new Rb(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(ev(this.set[t],e,this.options))return!0;return!1}}var Tb=Ib;const Ab=new _b,Ob=dg,Kb=rv,Cb=lg,Rb=xg,{safeRe:jb,t:Pb,comparatorTrimReplace:Db,tildeTrimReplace:Nb,caretTrimReplace:Lb}=og.exports,{FLAG_INCLUDE_PRERELEASE:Mb,FLAG_LOOSE:Fb}=sg,Bb=e=>"<0.0.0-0"===e.value,Vb=e=>""===e.value,Ub=(e,t)=>{let n=!0;const r=e.slice();let a=r.pop();for(;n&&r.length;)n=r.every((e=>a.intersects(e,t))),a=r.pop();return n},Jb=(e,t)=>(Cb("comp",e,t),e=zb(e,t),Cb("caret",e),e=$b(e,t),Cb("tildes",e),e=Yb(e,t),Cb("xrange",e),e=Qb(e,t),Cb("stars",e),e),Gb=e=>!e||"x"===e.toLowerCase()||"*"===e,$b=(e,t)=>e.trim().split(/\s+/).map((e=>qb(e,t))).join(" "),qb=(e,t)=>{const n=t.loose?jb[Pb.TILDELOOSE]:jb[Pb.TILDE];return e.replace(n,((t,n,r,a,i)=>{let o;return Cb("tilde",e,t,n,r,a,i),Gb(n)?o="":Gb(r)?o=`>=${n}.0.0 <${+n+1}.0.0-0`:Gb(a)?o=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:i?(Cb("replaceTilde pr",i),o=`>=${n}.${r}.${a}-${i} <${n}.${+r+1}.0-0`):o=`>=${n}.${r}.${a} <${n}.${+r+1}.0-0`,Cb("tilde return",o),o}))},zb=(e,t)=>e.trim().split(/\s+/).map((e=>Wb(e,t))).join(" "),Wb=(e,t)=>{Cb("caret",e,t);const n=t.loose?jb[Pb.CARETLOOSE]:jb[Pb.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,((t,n,a,i,o)=>{let s;return Cb("caret",e,t,n,a,i,o),Gb(n)?s="":Gb(a)?s=`>=${n}.0.0${r} <${+n+1}.0.0-0`:Gb(i)?s="0"===n?`>=${n}.${a}.0${r} <${n}.${+a+1}.0-0`:`>=${n}.${a}.0${r} <${+n+1}.0.0-0`:o?(Cb("replaceCaret pr",o),s="0"===n?"0"===a?`>=${n}.${a}.${i}-${o} <${n}.${a}.${+i+1}-0`:`>=${n}.${a}.${i}-${o} <${n}.${+a+1}.0-0`:`>=${n}.${a}.${i}-${o} <${+n+1}.0.0-0`):(Cb("no pr"),s="0"===n?"0"===a?`>=${n}.${a}.${i}${r} <${n}.${a}.${+i+1}-0`:`>=${n}.${a}.${i}${r} <${n}.${+a+1}.0-0`:`>=${n}.${a}.${i} <${+n+1}.0.0-0`),Cb("caret return",s),s}))},Yb=(e,t)=>(Cb("replaceXRanges",e,t),e.split(/\s+/).map((e=>Hb(e,t))).join(" ")),Hb=(e,t)=>{e=e.trim();const n=t.loose?jb[Pb.XRANGELOOSE]:jb[Pb.XRANGE];return e.replace(n,((n,r,a,i,o,s)=>{Cb("xRange",e,n,r,a,i,o,s);const l=Gb(a),c=l||Gb(i),u=c||Gb(o),d=u;return"="===r&&d&&(r=""),s=t.includePrerelease?"-0":"",l?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&d?(c&&(i=0),o=0,">"===r?(r=">=",c?(a=+a+1,i=0,o=0):(i=+i+1,o=0)):"<="===r&&(r="<",c?a=+a+1:i=+i+1),"<"===r&&(s="-0"),n=`${r+a}.${i}.${o}${s}`):c?n=`>=${a}.0.0${s} <${+a+1}.0.0-0`:u&&(n=`>=${a}.${i}.0${s} <${a}.${+i+1}.0-0`),Cb("xRange return",n),n}))},Qb=(e,t)=>(Cb("replaceStars",e,t),e.trim().replace(jb[Pb.STAR],"")),Zb=(e,t)=>(Cb("replaceGTE0",e,t),e.trim().replace(jb[t.includePrerelease?Pb.GTE0PRE:Pb.GTE0],"")),Xb=e=>(t,n,r,a,i,o,s,l,c,u,d,p)=>`${n=Gb(r)?"":Gb(a)?`>=${r}.0.0${e?"-0":""}`:Gb(i)?`>=${r}.${a}.0${e?"-0":""}`:o?`>=${n}`:`>=${n}${e?"-0":""}`} ${l=Gb(c)?"":Gb(u)?`<${+c+1}.0.0-0`:Gb(d)?`<${c}.${+u+1}.0-0`:p?`<=${c}.${u}.${d}-${p}`:e?`<${c}.${u}.${+d+1}-0`:`<=${l}`}`.trim(),ev=(e,t,n)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(Cb(e[n].semver),e[n].semver!==Kb.ANY&&e[n].semver.prerelease.length>0){const r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0},tv=Symbol("SemVer ANY");class nv{static get ANY(){return tv}constructor(e,t){if(t=av(t),e instanceof nv){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),lv("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===tv?this.value="":this.value=this.operator+this.semver.version,lv("comp",this)}parse(e){const t=this.options.loose?iv[ov.COMPARATORLOOSE]:iv[ov.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new cv(n[2],this.options.loose):this.semver=tv}toString(){return this.value}test(e){if(lv("Comparator.test",e,this.options.loose),this.semver===tv||e===tv)return!0;if("string"==typeof e)try{e=new cv(e,this.options)}catch(e){return!1}return sv(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof nv))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new uv(e.value,t).test(this.value):""===e.operator?""===e.value||new uv(this.value,t).test(e.semver):(!(t=av(t)).includePrerelease||"<0.0.0-0"!==this.value&&"<0.0.0-0"!==e.value)&&(!(!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&(!(!this.operator.startsWith(">")||!e.operator.startsWith(">"))||(!(!this.operator.startsWith("<")||!e.operator.startsWith("<"))||(!(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))||(!!(sv(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))||!!(sv(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))))))}}var rv=nv;const av=dg,{safeRe:iv,t:ov}=og.exports,sv=bb,lv=lg,cv=xg,uv=Tb,dv=Tb;var pv=(e,t,n)=>{try{t=new dv(t,n)}catch(e){return!1}return t.test(e)};const hv=Tb;var mv=(e,t)=>new hv(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")));const fv=xg,yv=Tb;var gv=(e,t,n)=>{let r=null,a=null,i=null;try{i=new yv(t,n)}catch(e){return null}return e.forEach((e=>{i.test(e)&&(r&&-1!==a.compare(e)||(r=e,a=new fv(r,n)))})),r};const bv=xg,vv=Tb;var wv=(e,t,n)=>{let r=null,a=null,i=null;try{i=new vv(t,n)}catch(e){return null}return e.forEach((e=>{i.test(e)&&(r&&1!==a.compare(e)||(r=e,a=new bv(r,n)))})),r};const Sv=xg,Ev=Tb,xv=tb;var _v=(e,t)=>{e=new Ev(e,t);let n=new Sv("0.0.0");if(e.test(n))return n;if(n=new Sv("0.0.0-0"),e.test(n))return n;n=null;for(let t=0;t<e.set.length;++t){const r=e.set[t];let a=null;r.forEach((e=>{const t=new Sv(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":a&&!xv(t,a)||(a=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!a||n&&!xv(n,a)||(n=a)}return n&&e.test(n)?n:null};const kv=Tb;var Iv=(e,t)=>{try{return new kv(e,t).range||"*"}catch(e){return null}};const Tv=xg,Av=rv,{ANY:Ov}=Av,Kv=Tb,Cv=pv,Rv=tb,jv=rb,Pv=db,Dv=cb;var Nv=(e,t,n,r)=>{let a,i,o,s,l;switch(e=new Tv(e,r),t=new Kv(t,r),n){case">":a=Rv,i=Pv,o=jv,s=">",l=">=";break;case"<":a=jv,i=Dv,o=Rv,s="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Cv(e,t,r))return!1;for(let n=0;n<t.set.length;++n){const c=t.set[n];let u=null,d=null;if(c.forEach((e=>{e.semver===Ov&&(e=new Av(">=0.0.0")),u=u||e,d=d||e,a(e.semver,u.semver,r)?u=e:o(e.semver,d.semver,r)&&(d=e)})),u.operator===s||u.operator===l)return!1;if((!d.operator||d.operator===s)&&i(e,d.semver))return!1;if(d.operator===l&&o(e,d.semver))return!1}return!0};const Lv=Nv;var Mv=(e,t,n)=>Lv(e,t,">",n);const Fv=Nv;var Bv=(e,t,n)=>Fv(e,t,"<",n);const Vv=Tb;var Uv=(e,t,n)=>(e=new Vv(e,n),t=new Vv(t,n),e.intersects(t,n));const Jv=pv,Gv=Jg;const $v=Tb,qv=rv,{ANY:zv}=qv,Wv=pv,Yv=Jg,Hv=[new qv(">=0.0.0-0")],Qv=[new qv(">=0.0.0")],Zv=(e,t,n)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===zv){if(1===t.length&&t[0].semver===zv)return!0;e=n.includePrerelease?Hv:Qv}if(1===t.length&&t[0].semver===zv){if(n.includePrerelease)return!0;t=Qv}const r=new Set;let a,i,o,s,l,c,u;for(const t of e)">"===t.operator||">="===t.operator?a=Xv(a,t,n):"<"===t.operator||"<="===t.operator?i=ew(i,t,n):r.add(t.semver);if(r.size>1)return null;if(a&&i){if(o=Yv(a.semver,i.semver,n),o>0)return null;if(0===o&&(">="!==a.operator||"<="!==i.operator))return null}for(const e of r){if(a&&!Wv(e,String(a),n))return null;if(i&&!Wv(e,String(i),n))return null;for(const r of t)if(!Wv(e,String(r),n))return!1;return!0}let d=!(!i||n.includePrerelease||!i.semver.prerelease.length)&&i.semver,p=!(!a||n.includePrerelease||!a.semver.prerelease.length)&&a.semver;d&&1===d.prerelease.length&&"<"===i.operator&&0===d.prerelease[0]&&(d=!1);for(const e of t){if(u=u||">"===e.operator||">="===e.operator,c=c||"<"===e.operator||"<="===e.operator,a)if(p&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===p.major&&e.semver.minor===p.minor&&e.semver.patch===p.patch&&(p=!1),">"===e.operator||">="===e.operator){if(s=Xv(a,e,n),s===e&&s!==a)return!1}else if(">="===a.operator&&!Wv(a.semver,String(e),n))return!1;if(i)if(d&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===d.major&&e.semver.minor===d.minor&&e.semver.patch===d.patch&&(d=!1),"<"===e.operator||"<="===e.operator){if(l=ew(i,e,n),l===e&&l!==i)return!1}else if("<="===i.operator&&!Wv(i.semver,String(e),n))return!1;if(!e.operator&&(i||a)&&0!==o)return!1}return!(a&&c&&!i&&0!==o)&&(!(i&&u&&!a&&0!==o)&&(!p&&!d))},Xv=(e,t,n)=>{if(!e)return t;const r=Yv(e.semver,t.semver,n);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},ew=(e,t,n)=>{if(!e)return t;const r=Yv(e.semver,t.semver,n);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};const tw=og.exports,nw=sg,rw=mg,aw=(e,t,n)=>{const r=[];let a=null,i=null;const o=e.sort(((e,t)=>Gv(e,t,n)));for(const e of o){Jv(e,t,n)?(i=e,a||(a=e)):(i&&r.push([a,i]),i=null,a=null)}a&&r.push([a,null]);const s=[];for(const[e,t]of r)e===t?s.push(e):t||e!==o[0]?t?e===o[0]?s.push(`<=${t}`):s.push(`${e} - ${t}`):s.push(`>=${e}`):s.push("*");const l=s.join(" || "),c="string"==typeof t.raw?t.raw:String(t);return l.length<c.length?l:t};var iw={parse:kg,valid:Tg,clean:Og,inc:Cg,diff:jg,major:Dg,minor:Lg,patch:Fg,prerelease:Vg,compare:Jg,rcompare:$g,compareLoose:zg,compareBuild:Yg,sort:Qg,rsort:Xg,gt:tb,lt:rb,eq:ib,neq:sb,gte:cb,lte:db,cmp:bb,coerce:xb,Comparator:rv,Range:Tb,satisfies:pv,toComparators:mv,maxSatisfying:gv,minSatisfying:wv,minVersion:_v,validRange:Iv,outside:Nv,gtr:Mv,ltr:Bv,intersects:Uv,simplifyRange:aw,subset:(e,t,n={})=>{if(e===t)return!0;e=new $v(e,n),t=new $v(t,n);let r=!1;e:for(const a of e.set){for(const e of t.set){const t=Zv(a,e,n);if(r=r||null!==t,t)continue e}if(r)return!1}return!0},SemVer:xg,re:tw.re,src:tw.src,tokens:tw.t,SEMVER_SPEC_VERSION:nw.SEMVER_SPEC_VERSION,RELEASE_TYPES:nw.RELEASE_TYPES,compareIdentifiers:rw.compareIdentifiers,rcompareIdentifiers:rw.rcompareIdentifiers};var ow=iw.satisfies(process.version,">=15.7.0");var sw=iw.satisfies(process.version,">=16.9.0");const lw=ow,cw=sw,uw={ec:["ES256","ES384","ES512"],rsa:["RS256","PS256","RS384","PS384","RS512","PS512"],"rsa-pss":["PS256","PS384","PS512"]},dw={ES256:"prime256v1",ES384:"secp384r1",ES512:"secp521r1"};var pw=function(e,t){if(!e||!t)return;const n=t.asymmetricKeyType;if(!n)return;const r=uw[n];if(!r)throw new Error(`Unknown key type "${n}".`);if(!r.includes(e))throw new Error(`"alg" parameter for "${n}" key type must be one of: ${r.join(", ")}.`);if(lw)switch(n){case"ec":const n=t.asymmetricKeyDetails.namedCurve,r=dw[e];if(n!==r)throw new Error(`"alg" parameter "${e}" requires curve "${r}".`);break;case"rsa-pss":if(cw){const n=parseInt(e.slice(-3),10),{hashAlgorithm:r,mgf1HashAlgorithm:a,saltLength:i}=t.asymmetricKeyDetails;if(r!==`sha${n}`||a!==r)throw new Error(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${e}.`);if(void 0!==i&&i>n>>3)throw new Error(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${e}.`)}}},hw=iw.satisfies(process.version,"^6.12.0 || >=8.0.0");const mw=qy,fw=Yy,yw=Zy,gw=Gy,bw=ig,vw=pw,ww=hw,Sw=xf,{KeyObject:Ew,createSecretKey:xw,createPublicKey:_w}=B.default,kw=["RS256","RS384","RS512"],Iw=["ES256","ES384","ES512"],Tw=["RS256","RS384","RS512"],Aw=["HS256","HS384","HS512"];ww&&(kw.splice(kw.length,0,"PS256","PS384","PS512"),Tw.splice(Tw.length,0,"PS256","PS384","PS512"));var Ow=17976931348623157e292,Kw="[object GeneratorFunction]",Cw=/^\s+|\s+$/g,Rw=/^[-+]0x[0-9a-f]+$/i,jw=/^0b[01]+$/i,Pw=/^0o[0-7]+$/i,Dw=/^(?:0|[1-9]\d*)$/,Nw=parseInt;function Lw(e){return e!=e}function Mw(e,t){return function(e,t){for(var n=-1,r=e?e.length:0,a=Array(r);++n<r;)a[n]=t(e[n],n,e);return a}(t,(function(t){return e[t]}))}var Fw,Bw,Vw=Object.prototype,Uw=Vw.hasOwnProperty,Jw=Vw.toString,Gw=Vw.propertyIsEnumerable,$w=(Fw=Object.keys,Bw=Object,function(e){return Fw(Bw(e))}),qw=Math.max;function zw(e,t){var n=Hw(e)||function(e){return function(e){return Xw(e)&&Qw(e)}(e)&&Uw.call(e,"callee")&&(!Gw.call(e,"callee")||"[object Arguments]"==Jw.call(e))}(e)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],r=n.length,a=!!r;for(var i in e)!t&&!Uw.call(e,i)||a&&("length"==i||Yw(i,r))||n.push(i);return n}function Ww(e){if(n=(t=e)&&t.constructor,r="function"==typeof n&&n.prototype||Vw,t!==r)return $w(e);var t,n,r,a=[];for(var i in Object(e))Uw.call(e,i)&&"constructor"!=i&&a.push(i);return a}function Yw(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||Dw.test(e))&&e>-1&&e%1==0&&e<t}var Hw=Array.isArray;function Qw(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!function(e){var t=Zw(e)?Jw.call(e):"";return"[object Function]"==t||t==Kw}(e)}function Zw(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Xw(e){return!!e&&"object"==typeof e}var eS=function(e,t,n,r){e=Qw(e)?e:function(e){return e?Mw(e,function(e){return Qw(e)?zw(e):Ww(e)}(e)):[]}(e),n=n&&!r?function(e){var t=function(e){if(!e)return 0===e?e:0;if(Infinity===(e=function(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||Xw(e)&&"[object Symbol]"==Jw.call(e)}(e))return NaN;if(Zw(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Zw(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Cw,"");var n=jw.test(e);return n||Pw.test(e)?Nw(e.slice(2),n?2:8):Rw.test(e)?NaN:+e}(e))||-Infinity===e){return(e<0?-1:1)*Ow}return e==e?e:0}(e),n=t%1;return t==t?n?t-n:t:0}(n):0;var a=e.length;return n<0&&(n=qw(a+n,0)),function(e){return"string"==typeof e||!Hw(e)&&Xw(e)&&"[object String]"==Jw.call(e)}(e)?n<=a&&e.indexOf(t,n)>-1:!!a&&function(e,t,n){if(t!=t)return function(e,t,n,r){for(var a=e.length,i=n+(r?1:-1);r?i--:++i<a;)if(t(e[i],i,e))return i;return-1}(e,Lw,n);for(var r=n-1,a=e.length;++r<a;)if(e[r]===t)return r;return-1}(e,t,n)>-1},tS=Object.prototype.toString;var nS=function(e){return!0===e||!1===e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Boolean]"==tS.call(e)},rS=17976931348623157e292,aS=/^\s+|\s+$/g,iS=/^[-+]0x[0-9a-f]+$/i,oS=/^0b[01]+$/i,sS=/^0o[0-7]+$/i,lS=parseInt,cS=Object.prototype.toString;function uS(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var dS=function(e){return"number"==typeof e&&e==function(e){var t=function(e){if(!e)return 0===e?e:0;if(Infinity===(e=function(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==cS.call(e)}(e))return NaN;if(uS(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=uS(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(aS,"");var n=oS.test(e);return n||sS.test(e)?lS(e.slice(2),n?2:8):iS.test(e)?NaN:+e}(e))||-Infinity===e){return(e<0?-1:1)*rS}return e==e?e:0}(e),n=t%1;return t==t?n?t-n:t:0}(e)},pS=Object.prototype.toString;var hS=function(e){return"number"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Number]"==pS.call(e)};var mS=Function.prototype,fS=Object.prototype,yS=mS.toString,gS=fS.hasOwnProperty,bS=yS.call(Object),vS=fS.toString,wS=function(e,t){return function(n){return e(t(n))}}(Object.getPrototypeOf,Object);var SS=function(e){if(!function(e){return!!e&&"object"==typeof e}(e)||"[object Object]"!=vS.call(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e))return!1;var t=wS(e);if(null===t)return!0;var n=gS.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&yS.call(n)==bS},ES=Object.prototype.toString,xS=Array.isArray;var _S=function(e){return"string"==typeof e||!xS(e)&&function(e){return!!e&&"object"==typeof e}(e)&&"[object String]"==ES.call(e)},kS=17976931348623157e292,IS=/^\s+|\s+$/g,TS=/^[-+]0x[0-9a-f]+$/i,AS=/^0b[01]+$/i,OS=/^0o[0-7]+$/i,KS=parseInt,CS=Object.prototype.toString;function RS(e,t){var n;if("function"!=typeof t)throw new TypeError("Expected a function");return e=function(e){var t=function(e){if(!e)return 0===e?e:0;if(Infinity===(e=function(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==CS.call(e)}(e))return NaN;if(jS(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=jS(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(IS,"");var n=AS.test(e);return n||OS.test(e)?KS(e.slice(2),n?2:8):TS.test(e)?NaN:+e}(e))||-Infinity===e){return(e<0?-1:1)*kS}return e==e?e:0}(e),n=t%1;return t==t?n?t-n:t:0}(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=void 0),n}}function jS(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var PS=function(e){return RS(2,e)};const DS=ig,NS=hw,LS=pw,MS=xf,FS=eS,BS=nS,VS=dS,US=hS,JS=SS,GS=_S,$S=PS,{KeyObject:qS,createSecretKey:zS,createPrivateKey:WS}=B.default,YS=["RS256","RS384","RS512","ES256","ES384","ES512","HS256","HS384","HS512","none"];NS&&YS.splice(3,0,"PS256","PS384","PS512");const HS={expiresIn:{isValid:function(e){return VS(e)||GS(e)&&e},message:'"expiresIn" should be a number of seconds or string representing a timespan'},notBefore:{isValid:function(e){return VS(e)||GS(e)&&e},message:'"notBefore" should be a number of seconds or string representing a timespan'},audience:{isValid:function(e){return GS(e)||Array.isArray(e)},message:'"audience" must be a string or array'},algorithm:{isValid:FS.bind(null,YS),message:'"algorithm" must be a valid string enum value'},header:{isValid:JS,message:'"header" must be an object'},encoding:{isValid:GS,message:'"encoding" must be a string'},issuer:{isValid:GS,message:'"issuer" must be a string'},subject:{isValid:GS,message:'"subject" must be a string'},jwtid:{isValid:GS,message:'"jwtid" must be a string'},noTimestamp:{isValid:BS,message:'"noTimestamp" must be a boolean'},keyid:{isValid:GS,message:'"keyid" must be a string'},mutatePayload:{isValid:BS,message:'"mutatePayload" must be a boolean'},allowInsecureKeySizes:{isValid:BS,message:'"allowInsecureKeySizes" must be a boolean'},allowInvalidAsymmetricKeyTypes:{isValid:BS,message:'"allowInvalidAsymmetricKeyTypes" must be a boolean'}},QS={iat:{isValid:US,message:'"iat" should be a number of seconds'},exp:{isValid:US,message:'"exp" should be a number of seconds'},nbf:{isValid:US,message:'"nbf" should be a number of seconds'}};function ZS(e,t,n,r){if(!JS(n))throw new Error('Expected "'+r+'" to be a plain object.');Object.keys(n).forEach((function(a){const i=e[a];if(i){if(!i.isValid(n[a]))throw new Error(i.message)}else if(!t)throw new Error('"'+a+'" is not allowed in "'+r+'"')}))}const XS={audience:"aud",issuer:"iss",subject:"sub",jwtid:"jti"},eE=["expiresIn","notBefore","noTimestamp","audience","issuer","subject","jwtid"];var tE,nE,rE,aE,iE,oE,sE=function(e,t,n,r){let a;if("function"!=typeof n||r||(r=n,n={}),n||(n={}),n=Object.assign({},n),a=r||function(e,t){if(e)throw e;return t},n.clockTimestamp&&"number"!=typeof n.clockTimestamp)return a(new mw("clockTimestamp must be a number"));if(void 0!==n.nonce&&("string"!=typeof n.nonce||""===n.nonce.trim()))return a(new mw("nonce must be a non-empty string"));if(void 0!==n.allowInvalidAsymmetricKeyTypes&&"boolean"!=typeof n.allowInvalidAsymmetricKeyTypes)return a(new mw("allowInvalidAsymmetricKeyTypes must be a boolean"));const i=n.clockTimestamp||Math.floor(Date.now()/1e3);if(!e)return a(new mw("jwt must be provided"));if("string"!=typeof e)return a(new mw("jwt must be a string"));const o=e.split(".");if(3!==o.length)return a(new mw("jwt malformed"));let s;try{s=gw(e,{complete:!0})}catch(e){return a(e)}if(!s)return a(new mw("invalid token"));const l=s.header;let c;if("function"==typeof t){if(!r)return a(new mw("verify must be called asynchronous if secret or public key is provided as a callback"));c=t}else c=function(e,n){return n(null,t)};return c(l,(function(t,r){if(t)return a(new mw("error in secret or public key callback: "+t.message));const c=""!==o[2].trim();if(!c&&r)return a(new mw("jwt signature is required"));if(c&&!r)return a(new mw("secret or public key must be provided"));if(!c&&!n.algorithms)return a(new mw('please specify "none" in "algorithms" to verify unsigned tokens'));if(null!=r&&!(r instanceof Ew))try{r=_w(r)}catch(e){try{r=xw("string"==typeof r?Buffer.from(r):r)}catch(e){return a(new mw("secretOrPublicKey is not valid key material"))}}if(n.algorithms||("secret"===r.type?n.algorithms=Aw:["rsa","rsa-pss"].includes(r.asymmetricKeyType)?n.algorithms=Tw:"ec"===r.asymmetricKeyType?n.algorithms=Iw:n.algorithms=kw),-1===n.algorithms.indexOf(s.header.alg))return a(new mw("invalid algorithm"));if(l.alg.startsWith("HS")&&"secret"!==r.type)return a(new mw(`secretOrPublicKey must be a symmetric key when using ${l.alg}`));if(/^(?:RS|PS|ES)/.test(l.alg)&&"public"!==r.type)return a(new mw(`secretOrPublicKey must be an asymmetric key when using ${l.alg}`));if(!n.allowInvalidAsymmetricKeyTypes)try{vw(l.alg,r)}catch(e){return a(e)}let u;try{u=Sw.verify(e,s.header.alg,r)}catch(e){return a(e)}if(!u)return a(new mw("invalid signature"));const d=s.payload;if(void 0!==d.nbf&&!n.ignoreNotBefore){if("number"!=typeof d.nbf)return a(new mw("invalid nbf value"));if(d.nbf>i+(n.clockTolerance||0))return a(new fw("jwt not active",new Date(1e3*d.nbf)))}if(void 0!==d.exp&&!n.ignoreExpiration){if("number"!=typeof d.exp)return a(new mw("invalid exp value"));if(i>=d.exp+(n.clockTolerance||0))return a(new yw("jwt expired",new Date(1e3*d.exp)))}if(n.audience){const e=Array.isArray(n.audience)?n.audience:[n.audience];if(!(Array.isArray(d.aud)?d.aud:[d.aud]).some((function(t){return e.some((function(e){return e instanceof RegExp?e.test(t):e===t}))})))return a(new mw("jwt audience invalid. expected: "+e.join(" or ")))}if(n.issuer){if("string"==typeof n.issuer&&d.iss!==n.issuer||Array.isArray(n.issuer)&&-1===n.issuer.indexOf(d.iss))return a(new mw("jwt issuer invalid. expected: "+n.issuer))}if(n.subject&&d.sub!==n.subject)return a(new mw("jwt subject invalid. expected: "+n.subject));if(n.jwtid&&d.jti!==n.jwtid)return a(new mw("jwt jwtid invalid. expected: "+n.jwtid));if(n.nonce&&d.nonce!==n.nonce)return a(new mw("jwt nonce invalid. expected: "+n.nonce));if(n.maxAge){if("number"!=typeof d.iat)return a(new mw("iat required when maxAge is specified"));const e=bw(n.maxAge,d.iat);if(void 0===e)return a(new mw('"maxAge" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'));if(i>=e+(n.clockTolerance||0))return a(new yw("maxAge exceeded",new Date(1e3*e)))}if(!0===n.complete){const e=s.signature;return a(null,{header:l,payload:d,signature:e})}return a(null,d)}))},lE=function(e,t,n,r){"function"==typeof n?(r=n,n={}):n=n||{};const a="object"==typeof e&&!Buffer.isBuffer(e),i=Object.assign({alg:n.algorithm||"HS256",typ:a?"JWT":void 0,kid:n.keyid},n.header);function o(e){if(r)return r(e);throw e}if(!t&&"none"!==n.algorithm)return o(new Error("secretOrPrivateKey must have a value"));if(null!=t&&!(t instanceof qS))try{t=WS(t)}catch(e){try{t=zS("string"==typeof t?Buffer.from(t):t)}catch(e){return o(new Error("secretOrPrivateKey is not valid key material"))}}if(i.alg.startsWith("HS")&&"secret"!==t.type)return o(new Error(`secretOrPrivateKey must be a symmetric key when using ${i.alg}`));if(/^(?:RS|PS|ES)/.test(i.alg)){if("private"!==t.type)return o(new Error(`secretOrPrivateKey must be an asymmetric key when using ${i.alg}`));if(!n.allowInsecureKeySizes&&!i.alg.startsWith("ES")&&void 0!==t.asymmetricKeyDetails&&t.asymmetricKeyDetails.modulusLength<2048)return o(new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${i.alg}`))}if(void 0===e)return o(new Error("payload is required"));if(a){try{!function(e){ZS(QS,!0,e,"payload")}(e)}catch(e){return o(e)}n.mutatePayload||(e=Object.assign({},e))}else{const t=eE.filter((function(e){return void 0!==n[e]}));if(t.length>0)return o(new Error("invalid "+t.join(",")+" option for "+typeof e+" payload"))}if(void 0!==e.exp&&void 0!==n.expiresIn)return o(new Error('Bad "options.expiresIn" option the payload already has an "exp" property.'));if(void 0!==e.nbf&&void 0!==n.notBefore)return o(new Error('Bad "options.notBefore" option the payload already has an "nbf" property.'));try{!function(e){ZS(HS,!1,e,"options")}(n)}catch(e){return o(e)}if(!n.allowInvalidAsymmetricKeyTypes)try{LS(i.alg,t)}catch(e){return o(e)}const s=e.iat||Math.floor(Date.now()/1e3);if(n.noTimestamp?delete e.iat:a&&(e.iat=s),void 0!==n.notBefore){try{e.nbf=DS(n.notBefore,s)}catch(e){return o(e)}if(void 0===e.nbf)return o(new Error('"notBefore" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}if(void 0!==n.expiresIn&&"object"==typeof e){try{e.exp=DS(n.expiresIn,s)}catch(e){return o(e)}if(void 0===e.exp)return o(new Error('"expiresIn" should be a number of seconds or string representing a timespan eg: "1d", "20h", 60'))}Object.keys(XS).forEach((function(t){const r=XS[t];if(void 0!==n[t]){if(void 0!==e[r])return o(new Error('Bad "options.'+t+'" option. The payload already has an "'+r+'" property.'));e[r]=n[t]}}));const l=n.encoding||"utf8";if("function"!=typeof r){let r=MS.sign({header:i,payload:e,secret:t,encoding:l});if(!n.allowInsecureKeySizes&&/^(?:RS|PS)/.test(i.alg)&&r.length<256)throw new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${i.alg}`);return r}r=r&&$S(r),MS.createSign({header:i,privateKey:t,payload:e,encoding:l}).once("error",r).once("done",(function(e){if(!n.allowInsecureKeySizes&&/^(?:RS|PS)/.test(i.alg)&&e.length<256)return r(new Error(`secretOrPrivateKey has a minimum key size of 2048 bits for ${i.alg}`));r(null,e)}))};class cE{constructor(e){this.value=void 0,this.next=null,this.value=e}}class uE{constructor(){this.length=0,this.head=null,this.tail=null}push(e){const t=new cE(e);return this.length?this.tail.next=t:this.head=t,this.tail=t,this.length+=1,t}shift(){if(this.length){const e=this.head;return this.head=this.head.next,this.length-=1,e}return null}}class dE{constructor(e=!1){this.ignoreErrors=e,this.queue=new uE,this.pending=new Set,this.newPromise()}add(e){this.pending.add(e),e.then((t=>{this.pending.delete(e),0===this.queue.length&&this.resolvePromise(t),this.queue.push(t)})).catch((t=>{this.ignoreErrors&&this.queue.push(void 0),this.pending.delete(e),this.rejectPromise(t)}))}async waitAll(){await Promise.all(this.pending)}numTotal(){return this.pending.size+this.queue.length}numPending(){return this.pending.size}numQueued(){return this.queue.length}resolvePromise(e){this.resolve(e),this.newPromise()}rejectPromise(e){this.reject(e),this.newPromise()}newPromise(){this.nextPromise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}async wait(){return this.nextPromise}async fetch(){var e;if(0!==this.pending.size||0!==this.queue.length){for(;0===this.queue.length;)try{await this.wait()}catch(e){this.ignoreErrors||console.error("Unexpected Error in AsyncFifoQueue",e)}return null===(e=this.queue.shift())||void 0===e?void 0:e.value}}}class pE{static normalize(e){return Number.isFinite(e)?{type:"fixed",delay:e}:e||void 0}static calculate(e,t,n,r,a){if(e){const i=function(e,t){if(e.type in pE.builtinStrategies)return pE.builtinStrategies[e.type](e.delay,e.jitter);if(t)return t;throw new Error(`Unknown backoff strategy ${e.type}.\n      If a custom backoff strategy is used, specify it when the queue is created.`)}(e,a);return i(t,e.type,n,r)}}}pE.builtinStrategies={fixed:function(e,t=0){return function(){if(t>0){const n=e*(1-t);return Math.floor(Math.random()*e*t+n)}return e}},exponential:function(e,t=0){return function(n){if(t>0){const r=Math.round(Math.pow(2,n-1)*e),a=r*(1-t);return Math.floor(Math.random()*r*t+a)}return Math.round(Math.pow(2,n-1)*e)}}},function(e){e[e.Init=0]="Init",e[e.Start=1]="Start",e[e.Stop=2]="Stop",e[e.GetChildrenValuesResponse=3]="GetChildrenValuesResponse",e[e.GetIgnoredChildrenFailuresResponse=4]="GetIgnoredChildrenFailuresResponse"}(tE||(tE={})),function(e){e[e.JobNotExist=-1]="JobNotExist",e[e.JobLockNotExist=-2]="JobLockNotExist",e[e.JobNotInState=-3]="JobNotInState",e[e.JobPendingChildren=-4]="JobPendingChildren",e[e.ParentJobNotExist=-5]="ParentJobNotExist",e[e.JobLockMismatch=-6]="JobLockMismatch",e[e.ParentJobCannotBeReplaced=-7]="ParentJobCannotBeReplaced",e[e.JobBelongsToJobScheduler=-8]="JobBelongsToJobScheduler",e[e.JobFailedChildren=-9]="JobFailedChildren"}(nE||(nE={})),function(e){e[e.Completed=0]="Completed",e[e.Error=1]="Error",e[e.Failed=2]="Failed",e[e.InitFailed=3]="InitFailed",e[e.InitCompleted=4]="InitCompleted",e[e.Log=5]="Log",e[e.MoveToDelayed=6]="MoveToDelayed",e[e.MoveToWait=7]="MoveToWait",e[e.Progress=8]="Progress",e[e.Update=9]="Update",e[e.GetChildrenValues=10]="GetChildrenValues",e[e.GetIgnoredChildrenFailures=11]="GetIgnoredChildrenFailures"}(rE||(rE={})),function(e){e[e.ONE_MINUTE=1]="ONE_MINUTE",e[e.FIVE_MINUTES=5]="FIVE_MINUTES",e[e.FIFTEEN_MINUTES=15]="FIFTEEN_MINUTES",e[e.THIRTY_MINUTES=30]="THIRTY_MINUTES",e[e.ONE_HOUR=60]="ONE_HOUR",e[e.ONE_WEEK=10080]="ONE_WEEK",e[e.TWO_WEEKS=20160]="TWO_WEEKS",e[e.ONE_MONTH=80640]="ONE_MONTH"}(aE||(aE={})),function(e){e.QueueName="bullmq.queue.name",e.QueueOperation="bullmq.queue.operation",e.BulkCount="bullmq.job.bulk.count",e.BulkNames="bullmq.job.bulk.names",e.JobName="bullmq.job.name",e.JobId="bullmq.job.id",e.JobKey="bullmq.job.key",e.JobIds="bullmq.job.ids",e.DeduplicationKey="bullmq.job.deduplication.key",e.JobOptions="bullmq.job.options",e.JobProgress="bullmq.job.progress",e.QueueDrainDelay="bullmq.queue.drain.delay",e.QueueGrace="bullmq.queue.grace",e.QueueCleanLimit="bullmq.queue.clean.limit",e.QueueRateLimit="bullmq.queue.rate.limit",e.JobType="bullmq.job.type",e.QueueOptions="bullmq.queue.options",e.QueueEventMaxLength="bullmq.queue.event.max.length",e.WorkerOptions="bullmq.worker.options",e.WorkerName="bullmq.worker.name",e.WorkerId="bullmq.worker.id",e.WorkerRateLimit="bullmq.worker.rate.limit",e.WorkerDoNotWaitActive="bullmq.worker.do.not.wait.active",e.WorkerForceClose="bullmq.worker.force.close",e.WorkerStalledJobs="bullmq.worker.stalled.jobs",e.WorkerFailedJobs="bullmq.worker.failed.jobs",e.WorkerJobsToExtendLocks="bullmq.worker.jobs.to.extend.locks",e.JobFinishedTimestamp="bullmq.job.finished.timestamp",e.JobProcessedTimestamp="bullmq.job.processed.timestamp",e.JobResult="bullmq.job.result",e.JobFailedReason="bullmq.job.failed.reason",e.FlowName="bullmq.flow.name",e.JobSchedulerId="bullmq.job.scheduler.id"}(iE||(iE={})),function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(oE||(oE={}));const hE={1:"Uncaught Fatal Exception",2:"Unused",3:"Internal JavaScript Parse Error",4:"Internal JavaScript Evaluation Failure",5:"Fatal Error",6:"Non-function Internal Exception Handler",7:"Internal Exception Handler Run-Time Failure",8:"Unused",9:"Invalid Argument",10:"Internal JavaScript Run-Time Failure",12:"Invalid Debug Argument",13:"Unfinished Top-Level Await"};class mE extends E.EventEmitter{constructor(e,t,n={useWorkerThreads:!1}){super(),this.mainFile=e,this.processFile=t,this.opts=n,this._exitCode=null,this._signalCode=null,this._killed=!1}get pid(){if(this.childProcess)return this.childProcess.pid;if(this.worker)return Math.abs(this.worker.threadId);throw new Error("No child process or worker thread")}get exitCode(){return this._exitCode}get signalCode(){return this._signalCode}get killed(){return this.childProcess?this.childProcess.killed:this._killed}async init(){const e=await yE(process.execArgv);let t;this.opts.useWorkerThreads?this.worker=t=new S.Worker(this.mainFile,Object.assign({execArgv:e,stdin:!0,stdout:!0,stderr:!0},this.opts.workerThreadsOptions?this.opts.workerThreadsOptions:{})):this.childProcess=t=v.fork(this.mainFile,[],Object.assign({execArgv:e,stdio:"pipe"},this.opts.workerForkOptions?this.opts.workerForkOptions:{})),t.on("exit",((e,n)=>{this._exitCode=e,n=void 0===n?null:n,this._signalCode=n,this._killed=!0,this.emit("exit",e,n),t.removeAllListeners(),this.removeAllListeners()})),t.on("error",((...e)=>this.emit("error",...e))),t.on("message",((...e)=>this.emit("message",...e))),t.on("close",((...e)=>this.emit("close",...e))),t.stdout.pipe(process.stdout),t.stderr.pipe(process.stderr),await this.initChild()}async send(e){return new Promise(((t,n)=>{this.childProcess?this.childProcess.send(e,(e=>{e?n(e):t()})):this.worker?t(this.worker.postMessage(e)):t()}))}killProcess(e="SIGKILL"){this.childProcess?this.childProcess.kill(e):this.worker&&this.worker.terminate()}async kill(e="SIGKILL",t){if(this.hasProcessExited())return;const n=(r=this.childProcess||this.worker,new Promise((e=>{r.once("exit",(()=>e()))})));var r;if(this.killProcess(e),void 0!==t&&(0===t||isFinite(t))){const e=setTimeout((()=>{this.hasProcessExited()||this.killProcess("SIGKILL")}),t);await n,clearTimeout(e)}await n}async initChild(){const e=new Promise(((e,t)=>{const n=a=>{if(a.cmd===rE.InitCompleted)e();else if(a.cmd===rE.InitFailed){const e=new Error;e.stack=a.err.stack,e.message=a.err.message,t(e)}this.off("message",n),this.off("close",r)},r=(e,a)=>{e>128&&(e-=128);t(new Error(`Error initializing child: ${hE[e]||`Unknown exit code ${e}`} and signal ${a}`)),this.off("message",n),this.off("close",r)};this.on("message",n),this.on("close",r)}));await this.send({cmd:tE.Init,value:this.processFile}),await e}hasProcessExited(){return!(null===this.exitCode&&!this.signalCode)}}const fE=async()=>new Promise((e=>{const t=w.createServer();t.listen(0,(()=>{const{port:n}=t.address();t.close((()=>e(n)))}))})),yE=async e=>{const t=[],n=[];for(let r=0;r<e.length;r++){const a=e[r];if(-1===a.indexOf("--inspect"))t.push(a);else{const e=a.split("=")[0],t=await fE();n.push(`${e}=${t}`)}}return t.concat(n)};class gE{constructor({mainFile:e=L.join(process.cwd(),"dist/cjs/classes/main.js"),useWorkerThreads:t,workerForkOptions:n,workerThreadsOptions:r}){this.retained={},this.free={},this.opts={mainFile:e,useWorkerThreads:t,workerForkOptions:n,workerThreadsOptions:r}}async retain(e){let t=this.getFree(e).pop();if(t)return this.retained[t.pid]=t,t;t=new mE(this.opts.mainFile,e,{useWorkerThreads:this.opts.useWorkerThreads,workerForkOptions:this.opts.workerForkOptions,workerThreadsOptions:this.opts.workerThreadsOptions}),t.on("exit",this.remove.bind(this,t));try{if(await t.init(),null!==t.exitCode||null!==t.signalCode)throw new Error("Child exited before it could be retained");return this.retained[t.pid]=t,t}catch(e){throw console.error(e),this.release(t),e}}release(e){delete this.retained[e.pid],this.getFree(e.processFile).push(e)}remove(e){delete this.retained[e.pid];const t=this.getFree(e.processFile),n=t.indexOf(e);n>-1&&t.splice(n,1)}async kill(e,t="SIGKILL"){return this.remove(e),e.kill(t,3e4)}async clean(){const e=Object.values(this.retained).concat(this.getAllFree());this.retained={},this.free={},await Promise.all(e.map((e=>this.kill(e,"SIGTERM"))))}getFree(e){return this.free[e]=this.free[e]||[]}getAllFree(){return Object.values(this.free).reduce(((e,t)=>e.concat(t)),[])}}var bE={exports:{}},vE={},wE={},SE={acl:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},append:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},asking:{arity:1,flags:["fast"],keyStart:0,keyStop:0,step:0},auth:{arity:-2,flags:["noscript","loading","stale","fast","no_auth","allow_busy"],keyStart:0,keyStop:0,step:0},bgrewriteaof:{arity:1,flags:["admin","noscript","no_async_loading"],keyStart:0,keyStop:0,step:0},bgsave:{arity:-1,flags:["admin","noscript","no_async_loading"],keyStart:0,keyStop:0,step:0},bitcount:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},bitfield:{arity:-2,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},bitfield_ro:{arity:-2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},bitop:{arity:-4,flags:["write","denyoom"],keyStart:2,keyStop:-1,step:1},bitpos:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},blmove:{arity:6,flags:["write","denyoom","noscript","blocking"],keyStart:1,keyStop:2,step:1},blmpop:{arity:-5,flags:["write","blocking","movablekeys"],keyStart:0,keyStop:0,step:0},blpop:{arity:-3,flags:["write","noscript","blocking"],keyStart:1,keyStop:-2,step:1},brpop:{arity:-3,flags:["write","noscript","blocking"],keyStart:1,keyStop:-2,step:1},brpoplpush:{arity:4,flags:["write","denyoom","noscript","blocking"],keyStart:1,keyStop:2,step:1},bzmpop:{arity:-5,flags:["write","blocking","movablekeys"],keyStart:0,keyStop:0,step:0},bzpopmax:{arity:-3,flags:["write","noscript","blocking","fast"],keyStart:1,keyStop:-2,step:1},bzpopmin:{arity:-3,flags:["write","noscript","blocking","fast"],keyStart:1,keyStop:-2,step:1},client:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},cluster:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},command:{arity:-1,flags:["loading","stale"],keyStart:0,keyStop:0,step:0},config:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},copy:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},dbsize:{arity:1,flags:["readonly","fast"],keyStart:0,keyStop:0,step:0},debug:{arity:-2,flags:["admin","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},decr:{arity:2,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},decrby:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},del:{arity:-2,flags:["write"],keyStart:1,keyStop:-1,step:1},discard:{arity:1,flags:["noscript","loading","stale","fast","allow_busy"],keyStart:0,keyStop:0,step:0},dump:{arity:2,flags:["readonly"],keyStart:1,keyStop:1,step:1},echo:{arity:2,flags:["fast"],keyStart:0,keyStop:0,step:0},eval:{arity:-3,flags:["noscript","stale","skip_monitor","no_mandatory_keys","movablekeys"],keyStart:0,keyStop:0,step:0},eval_ro:{arity:-3,flags:["readonly","noscript","stale","skip_monitor","no_mandatory_keys","movablekeys"],keyStart:0,keyStop:0,step:0},evalsha:{arity:-3,flags:["noscript","stale","skip_monitor","no_mandatory_keys","movablekeys"],keyStart:0,keyStop:0,step:0},evalsha_ro:{arity:-3,flags:["readonly","noscript","stale","skip_monitor","no_mandatory_keys","movablekeys"],keyStart:0,keyStop:0,step:0},exec:{arity:1,flags:["noscript","loading","stale","skip_slowlog"],keyStart:0,keyStop:0,step:0},exists:{arity:-2,flags:["readonly","fast"],keyStart:1,keyStop:-1,step:1},expire:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},expireat:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},expiretime:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},failover:{arity:-1,flags:["admin","noscript","stale"],keyStart:0,keyStop:0,step:0},fcall:{arity:-3,flags:["noscript","stale","skip_monitor","no_mandatory_keys","movablekeys"],keyStart:0,keyStop:0,step:0},fcall_ro:{arity:-3,flags:["readonly","noscript","stale","skip_monitor","no_mandatory_keys","movablekeys"],keyStart:0,keyStop:0,step:0},flushall:{arity:-1,flags:["write"],keyStart:0,keyStop:0,step:0},flushdb:{arity:-1,flags:["write"],keyStart:0,keyStop:0,step:0},function:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},geoadd:{arity:-5,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},geodist:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},geohash:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},geopos:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},georadius:{arity:-6,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},georadius_ro:{arity:-6,flags:["readonly"],keyStart:1,keyStop:1,step:1},georadiusbymember:{arity:-5,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},georadiusbymember_ro:{arity:-5,flags:["readonly"],keyStart:1,keyStop:1,step:1},geosearch:{arity:-7,flags:["readonly"],keyStart:1,keyStop:1,step:1},geosearchstore:{arity:-8,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},get:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},getbit:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},getdel:{arity:2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},getex:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},getrange:{arity:4,flags:["readonly"],keyStart:1,keyStop:1,step:1},getset:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hdel:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},hello:{arity:-1,flags:["noscript","loading","stale","fast","no_auth","allow_busy"],keyStart:0,keyStop:0,step:0},hexists:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hget:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hgetall:{arity:2,flags:["readonly"],keyStart:1,keyStop:1,step:1},hincrby:{arity:4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hincrbyfloat:{arity:4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hkeys:{arity:2,flags:["readonly"],keyStart:1,keyStop:1,step:1},hlen:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hmget:{arity:-3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hmset:{arity:-4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hrandfield:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},hscan:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},hset:{arity:-4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hsetnx:{arity:4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},hstrlen:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},hvals:{arity:2,flags:["readonly"],keyStart:1,keyStop:1,step:1},incr:{arity:2,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},incrby:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},incrbyfloat:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},info:{arity:-1,flags:["loading","stale"],keyStart:0,keyStop:0,step:0},keys:{arity:2,flags:["readonly"],keyStart:0,keyStop:0,step:0},lastsave:{arity:1,flags:["loading","stale","fast"],keyStart:0,keyStop:0,step:0},latency:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},lcs:{arity:-3,flags:["readonly"],keyStart:1,keyStop:2,step:1},lindex:{arity:3,flags:["readonly"],keyStart:1,keyStop:1,step:1},linsert:{arity:5,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},llen:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},lmove:{arity:5,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},lmpop:{arity:-4,flags:["write","movablekeys"],keyStart:0,keyStop:0,step:0},lolwut:{arity:-1,flags:["readonly","fast"],keyStart:0,keyStop:0,step:0},lpop:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},lpos:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},lpush:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},lpushx:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},lrange:{arity:4,flags:["readonly"],keyStart:1,keyStop:1,step:1},lrem:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},lset:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},ltrim:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},memory:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},mget:{arity:-2,flags:["readonly","fast"],keyStart:1,keyStop:-1,step:1},migrate:{arity:-6,flags:["write","movablekeys"],keyStart:3,keyStop:3,step:1},module:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},monitor:{arity:1,flags:["admin","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},move:{arity:3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},mset:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:2},msetnx:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:2},multi:{arity:1,flags:["noscript","loading","stale","fast","allow_busy"],keyStart:0,keyStop:0,step:0},object:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},persist:{arity:2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},pexpire:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},pexpireat:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},pexpiretime:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},pfadd:{arity:-2,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},pfcount:{arity:-2,flags:["readonly"],keyStart:1,keyStop:-1,step:1},pfdebug:{arity:3,flags:["write","denyoom","admin"],keyStart:2,keyStop:2,step:1},pfmerge:{arity:-2,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:1},pfselftest:{arity:1,flags:["admin"],keyStart:0,keyStop:0,step:0},ping:{arity:-1,flags:["fast"],keyStart:0,keyStop:0,step:0},psetex:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},psubscribe:{arity:-2,flags:["pubsub","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},psync:{arity:-3,flags:["admin","noscript","no_async_loading","no_multi"],keyStart:0,keyStop:0,step:0},pttl:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},publish:{arity:3,flags:["pubsub","loading","stale","fast"],keyStart:0,keyStop:0,step:0},pubsub:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},punsubscribe:{arity:-1,flags:["pubsub","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},quit:{arity:-1,flags:["noscript","loading","stale","fast","no_auth","allow_busy"],keyStart:0,keyStop:0,step:0},randomkey:{arity:1,flags:["readonly"],keyStart:0,keyStop:0,step:0},readonly:{arity:1,flags:["loading","stale","fast"],keyStart:0,keyStop:0,step:0},readwrite:{arity:1,flags:["loading","stale","fast"],keyStart:0,keyStop:0,step:0},rename:{arity:3,flags:["write"],keyStart:1,keyStop:2,step:1},renamenx:{arity:3,flags:["write","fast"],keyStart:1,keyStop:2,step:1},replconf:{arity:-1,flags:["admin","noscript","loading","stale","allow_busy"],keyStart:0,keyStop:0,step:0},replicaof:{arity:3,flags:["admin","noscript","stale","no_async_loading"],keyStart:0,keyStop:0,step:0},reset:{arity:1,flags:["noscript","loading","stale","fast","no_auth","allow_busy"],keyStart:0,keyStop:0,step:0},restore:{arity:-4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},"restore-asking":{arity:-4,flags:["write","denyoom","asking"],keyStart:1,keyStop:1,step:1},role:{arity:1,flags:["noscript","loading","stale","fast"],keyStart:0,keyStop:0,step:0},rpop:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},rpoplpush:{arity:3,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},rpush:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},rpushx:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},sadd:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},save:{arity:1,flags:["admin","noscript","no_async_loading","no_multi"],keyStart:0,keyStop:0,step:0},scan:{arity:-2,flags:["readonly"],keyStart:0,keyStop:0,step:0},scard:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},script:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},sdiff:{arity:-2,flags:["readonly"],keyStart:1,keyStop:-1,step:1},sdiffstore:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:1},select:{arity:2,flags:["loading","stale","fast"],keyStart:0,keyStop:0,step:0},set:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},setbit:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},setex:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},setnx:{arity:3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},setrange:{arity:4,flags:["write","denyoom"],keyStart:1,keyStop:1,step:1},shutdown:{arity:-1,flags:["admin","noscript","loading","stale","no_multi","allow_busy"],keyStart:0,keyStop:0,step:0},sinter:{arity:-2,flags:["readonly"],keyStart:1,keyStop:-1,step:1},sintercard:{arity:-3,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},sinterstore:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:1},sismember:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},slaveof:{arity:3,flags:["admin","noscript","stale","no_async_loading"],keyStart:0,keyStop:0,step:0},slowlog:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},smembers:{arity:2,flags:["readonly"],keyStart:1,keyStop:1,step:1},smismember:{arity:-3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},smove:{arity:4,flags:["write","fast"],keyStart:1,keyStop:2,step:1},sort:{arity:-2,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},sort_ro:{arity:-2,flags:["readonly","movablekeys"],keyStart:1,keyStop:1,step:1},spop:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},spublish:{arity:3,flags:["pubsub","loading","stale","fast"],keyStart:1,keyStop:1,step:1},srandmember:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},srem:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},sscan:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},ssubscribe:{arity:-2,flags:["pubsub","noscript","loading","stale"],keyStart:1,keyStop:-1,step:1},strlen:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},subscribe:{arity:-2,flags:["pubsub","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},substr:{arity:4,flags:["readonly"],keyStart:1,keyStop:1,step:1},sunion:{arity:-2,flags:["readonly"],keyStart:1,keyStop:-1,step:1},sunionstore:{arity:-3,flags:["write","denyoom"],keyStart:1,keyStop:-1,step:1},sunsubscribe:{arity:-1,flags:["pubsub","noscript","loading","stale"],keyStart:1,keyStop:-1,step:1},swapdb:{arity:3,flags:["write","fast"],keyStart:0,keyStop:0,step:0},sync:{arity:1,flags:["admin","noscript","no_async_loading","no_multi"],keyStart:0,keyStop:0,step:0},time:{arity:1,flags:["loading","stale","fast"],keyStart:0,keyStop:0,step:0},touch:{arity:-2,flags:["readonly","fast"],keyStart:1,keyStop:-1,step:1},ttl:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},type:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},unlink:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:-1,step:1},unsubscribe:{arity:-1,flags:["pubsub","noscript","loading","stale"],keyStart:0,keyStop:0,step:0},unwatch:{arity:1,flags:["noscript","loading","stale","fast","allow_busy"],keyStart:0,keyStop:0,step:0},wait:{arity:3,flags:["noscript"],keyStart:0,keyStop:0,step:0},watch:{arity:-2,flags:["noscript","loading","stale","fast","allow_busy"],keyStart:1,keyStop:-1,step:1},xack:{arity:-4,flags:["write","fast"],keyStart:1,keyStop:1,step:1},xadd:{arity:-5,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},xautoclaim:{arity:-6,flags:["write","fast"],keyStart:1,keyStop:1,step:1},xclaim:{arity:-6,flags:["write","fast"],keyStart:1,keyStop:1,step:1},xdel:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},xgroup:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},xinfo:{arity:-2,flags:[],keyStart:0,keyStop:0,step:0},xlen:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},xpending:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},xrange:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},xread:{arity:-4,flags:["readonly","blocking","movablekeys"],keyStart:0,keyStop:0,step:0},xreadgroup:{arity:-7,flags:["write","blocking","movablekeys"],keyStart:0,keyStop:0,step:0},xrevrange:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},xsetid:{arity:-3,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},xtrim:{arity:-4,flags:["write"],keyStart:1,keyStop:1,step:1},zadd:{arity:-4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},zcard:{arity:2,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zcount:{arity:4,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zdiff:{arity:-3,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},zdiffstore:{arity:-4,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},zincrby:{arity:4,flags:["write","denyoom","fast"],keyStart:1,keyStop:1,step:1},zinter:{arity:-3,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},zintercard:{arity:-3,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},zinterstore:{arity:-4,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1},zlexcount:{arity:4,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zmpop:{arity:-4,flags:["write","movablekeys"],keyStart:0,keyStop:0,step:0},zmscore:{arity:-3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zpopmax:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},zpopmin:{arity:-2,flags:["write","fast"],keyStart:1,keyStop:1,step:1},zrandmember:{arity:-2,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrange:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrangebylex:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrangebyscore:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrangestore:{arity:-5,flags:["write","denyoom"],keyStart:1,keyStop:2,step:1},zrank:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zrem:{arity:-3,flags:["write","fast"],keyStart:1,keyStop:1,step:1},zremrangebylex:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},zremrangebyrank:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},zremrangebyscore:{arity:4,flags:["write"],keyStart:1,keyStop:1,step:1},zrevrange:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrevrangebylex:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrevrangebyscore:{arity:-4,flags:["readonly"],keyStart:1,keyStop:1,step:1},zrevrank:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zscan:{arity:-3,flags:["readonly"],keyStart:1,keyStop:1,step:1},zscore:{arity:3,flags:["readonly","fast"],keyStart:1,keyStop:1,step:1},zunion:{arity:-3,flags:["readonly","movablekeys"],keyStart:0,keyStop:0,step:0},zunionstore:{arity:-4,flags:["write","denyoom","movablekeys"],keyStart:1,keyStop:1,step:1}};!function(e){var t=X&&X.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.getKeyIndexes=e.hasFlag=e.exists=e.list=void 0;const n=t(SE);e.list=Object.keys(n.default);const r={};function a(e){"string"!=typeof e&&(e=String(e));const t=e.indexOf("->");return-1===t?e.length:t}e.list.forEach((e=>{r[e]=n.default[e].flags.reduce((function(e,t){return e[t]=!0,e}),{})})),e.exists=function(e){return Boolean(n.default[e])},e.hasFlag=function(e,t){if(!r[e])throw new Error("Unknown command "+e);return Boolean(r[e][t])},e.getKeyIndexes=function(e,t,r){const i=n.default[e];if(!i)throw new Error("Unknown command "+e);if(!Array.isArray(t))throw new Error("Expect args to be an array");const o=[],s=Boolean(r&&r.parseExternalKey),l=(e,t)=>{const n=[],r=Number(e[t]);for(let e=0;e<r;e++)n.push(e+t+1);return n},c=(e,t,n)=>{for(let r=t;r<e.length-1;r+=1)if(String(e[r]).toLowerCase()===n.toLowerCase())return r+1;return null};switch(e){case"zunionstore":case"zinterstore":case"zdiffstore":o.push(0,...l(t,1));break;case"eval":case"evalsha":case"eval_ro":case"evalsha_ro":case"fcall":case"fcall_ro":case"blmpop":case"bzmpop":o.push(...l(t,1));break;case"sintercard":case"lmpop":case"zunion":case"zinter":case"zmpop":case"zintercard":case"zdiff":o.push(...l(t,0));break;case"georadius":{o.push(0);const e=c(t,5,"STORE");e&&o.push(e);const n=c(t,5,"STOREDIST");n&&o.push(n);break}case"georadiusbymember":{o.push(0);const e=c(t,4,"STORE");e&&o.push(e);const n=c(t,4,"STOREDIST");n&&o.push(n);break}case"sort":case"sort_ro":o.push(0);for(let e=1;e<t.length-1;e++){let n=t[e];if("string"!=typeof n)continue;const r=n.toUpperCase();"GET"===r?(e+=1,n=t[e],"#"!==n&&(s?o.push([e,a(n)]):o.push(e))):"BY"===r?(e+=1,s?o.push([e,a(t[e])]):o.push(e)):"STORE"===r&&(e+=1,o.push(e))}break;case"migrate":if(""===t[2])for(let e=5;e<t.length-1;e++){const n=t[e];if("string"==typeof n&&"KEYS"===n.toUpperCase()){for(let n=e+1;n<t.length;n++)o.push(n);break}}else o.push(2);break;case"xreadgroup":case"xread":for(let n="xread"===e?0:3;n<t.length-1;n++)if("STREAMS"===String(t[n]).toUpperCase()){for(let e=n+1;e<=n+(t.length-1-n)/2;e++)o.push(e);break}break;default:if(i.step>0){const e=i.keyStart-1,n=i.keyStop>0?i.keyStop:t.length+i.keyStop+1;for(let t=e;t<n;t+=i.step)o.push(t)}}return o}}(wE);var EE={},xE={};!function(e){let t;function n(n,r){try{const e=t;return t=null,e.apply(this,arguments)}catch(t){return e.errorObj.e=t,e.errorObj}}Object.defineProperty(e,"__esModule",{value:!0}),e.tryCatch=e.errorObj=void 0,e.errorObj={e:{}},e.tryCatch=function(e){return t=e,n}}(xE),Object.defineProperty(EE,"__esModule",{value:!0});const _E=xE;function kE(e){setTimeout((function(){throw e}),0)}EE.default=function(e,t,n){return"function"==typeof t&&e.then((e=>{let r;r=void 0!==n&&Object(n).spread&&Array.isArray(e)?_E.tryCatch(t).apply(void 0,[null].concat(e)):void 0===e?_E.tryCatch(t)(null):_E.tryCatch(t)(null,e),r===_E.errorObj&&kE(r.e)}),(e=>{if(!e){const t=new Error(e+"");Object.assign(t,{cause:e}),e=t}const n=_E.tryCatch(t)(e);n===_E.errorObj&&kE(n.e)})),e};var IE={};const TE=j.default,AE=D.default;function OE(e){Object.defineProperty(this,"message",{value:e||"",configurable:!0,writable:!0}),Error.captureStackTrace(this,this.constructor)}function KE(e,t,n){TE(t),TE.strictEqual(typeof n,"number"),Object.defineProperty(this,"message",{value:e||"",configurable:!0,writable:!0});const r=Error.stackTraceLimit;Error.stackTraceLimit=2,Error.captureStackTrace(this,this.constructor),Error.stackTraceLimit=r,this.offset=n,this.buffer=t}function CE(e){Object.defineProperty(this,"message",{value:e||"",configurable:!0,writable:!0});const t=Error.stackTraceLimit;Error.stackTraceLimit=2,Error.captureStackTrace(this,this.constructor),Error.stackTraceLimit=t}function RE(e){Object.defineProperty(this,"message",{value:e||"",configurable:!0,writable:!0}),Error.captureStackTrace(this,this.constructor)}function jE(e){Object.defineProperty(this,"message",{value:e||"",configurable:!0,writable:!0}),Error.captureStackTrace(this,this.constructor)}AE.inherits(OE,Error),Object.defineProperty(OE.prototype,"name",{value:"RedisError",configurable:!0,writable:!0}),AE.inherits(KE,OE),Object.defineProperty(KE.prototype,"name",{value:"ParserError",configurable:!0,writable:!0}),AE.inherits(CE,OE),Object.defineProperty(CE.prototype,"name",{value:"ReplyError",configurable:!0,writable:!0}),AE.inherits(RE,OE),Object.defineProperty(RE.prototype,"name",{value:"AbortError",configurable:!0,writable:!0}),AE.inherits(jE,RE),Object.defineProperty(jE.prototype,"name",{value:"InterruptError",configurable:!0,writable:!0});var PE={RedisError:OE,ParserError:KE,ReplyError:CE,AbortError:RE,InterruptError:jE};const DE=j.default;class NE extends Error{get name(){return this.constructor.name}}class LE extends NE{get name(){return this.constructor.name}}var ME={RedisError:NE,ParserError:class extends NE{constructor(e,t,n){DE(t),DE.strictEqual(typeof n,"number");const r=Error.stackTraceLimit;Error.stackTraceLimit=2,super(e),Error.stackTraceLimit=r,this.offset=n,this.buffer=t}get name(){return this.constructor.name}},ReplyError:class extends NE{constructor(e){const t=Error.stackTraceLimit;Error.stackTraceLimit=2,super(e),Error.stackTraceLimit=t}get name(){return this.constructor.name}},AbortError:LE,InterruptError:class extends LE{get name(){return this.constructor.name}}};var FE=process.version.charCodeAt(1)<55&&46===process.version.charCodeAt(2)?PE:ME,BE={},VE={exports:{}},UE=[0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920],JE=VE.exports=function(e){for(var t,n=0,r=-1,a=0,i=0,o="string"==typeof e?function(e){for(var t,n=0,r=0,a=[],i=e.length;n<i;n++)(t=e.charCodeAt(n))<128?a[r++]=t:t<2048?(a[r++]=t>>6|192,a[r++]=63&t|128):55296==(64512&t)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(t=65536+((1023&t)<<10)+(1023&e.charCodeAt(++n)),a[r++]=t>>18|240,a[r++]=t>>12&63|128,a[r++]=t>>6&63|128,a[r++]=63&t|128):(a[r++]=t>>12|224,a[r++]=t>>6&63|128,a[r++]=63&t|128);return a}(e):e,s=o.length;n<s;){if(t=o[n++],-1===r)123===t&&(r=n);else if(125!==t)i=UE[255&(t^i>>8)]^i<<8;else if(n-1!==r)return 16383&i;a=UE[255&(t^a>>8)]^a<<8}return 16383&a};VE.exports.generateMulti=function(e){for(var t=1,n=e.length,r=JE(e[0]);t<n;)if(JE(e[t++])!==r)return-1;return r};var GE={},$E={},qE="[object GeneratorFunction]",zE=/^(?:0|[1-9]\d*)$/;function WE(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var YE=Object.prototype,HE=YE.hasOwnProperty,QE=YE.toString,ZE=YE.propertyIsEnumerable,XE=Math.max;function ex(e,t){var n=sx(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&lx(e)}(e)&&HE.call(e,"callee")&&(!ZE.call(e,"callee")||"[object Arguments]"==QE.call(e))}(e)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],r=n.length,a=!!r;for(var i in e)!t&&!HE.call(e,i)||a&&("length"==i||ix(i,r))||n.push(i);return n}function tx(e,t,n,r){return void 0===e||ox(e,YE[n])&&!HE.call(r,n)?t:e}function nx(e,t,n){var r=e[t];HE.call(e,t)&&ox(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function rx(e){if(!cx(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t,n,r,a=(n=(t=e)&&t.constructor,r="function"==typeof n&&n.prototype||YE,t===r),i=[];for(var o in e)("constructor"!=o||!a&&HE.call(e,o))&&i.push(o);return i}function ax(e,t){return t=XE(void 0===t?e.length-1:t,0),function(){for(var n=arguments,r=-1,a=XE(n.length-t,0),i=Array(a);++r<a;)i[r]=n[t+r];r=-1;for(var o=Array(t+1);++r<t;)o[r]=n[r];return o[t]=i,WE(e,this,o)}}function ix(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||zE.test(e))&&e>-1&&e%1==0&&e<t}function ox(e,t){return e===t||e!=e&&t!=t}var sx=Array.isArray;function lx(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!function(e){var t=cx(e)?QE.call(e):"";return"[object Function]"==t||t==qE}(e)}function cx(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var ux,dx=(ux=function(e,t,n,r){!function(e,t,n,r){n||(n={});for(var a=-1,i=t.length;++a<i;){var o=t[a],s=r?r(n[o],e[o],o,n,e):void 0;nx(n,o,void 0===s?e[o]:s)}}(t,function(e){return lx(e)?ex(e,!0):rx(e)}(t),e,r)},ax((function(e,t){var n=-1,r=t.length,a=r>1?t[r-1]:void 0,i=r>2?t[2]:void 0;for(a=ux.length>3&&"function"==typeof a?(r--,a):void 0,i&&function(e,t,n){if(!cx(n))return!1;var r=typeof t;return!!("number"==r?lx(n)&&ix(t,n.length):"string"==r&&t in n)&&ox(n[t],e)}(t[0],t[1],i)&&(a=r<3?void 0:a,r=1),e=Object(e);++n<r;){var o=t[n];o&&ux(e,o,n,a)}return e})));var px=ax((function(e){return e.push(void 0,tx),WE(dx,void 0,e)})),hx="[object GeneratorFunction]",mx=Object.prototype,fx=mx.hasOwnProperty,yx=mx.toString,gx=mx.propertyIsEnumerable;var bx=function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&function(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!function(e){var t=function(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}(e)?yx.call(e):"";return"[object Function]"==t||t==hx}(e)}(e)}(e)&&fx.call(e,"callee")&&(!gx.call(e,"callee")||"[object Arguments]"==yx.call(e))};Object.defineProperty($E,"__esModule",{value:!0}),$E.isArguments=$E.defaults=$E.noop=void 0;const vx=px;$E.defaults=vx;const wx=bx;$E.isArguments=wx,$E.noop=function(){};var Sx={},Ex={exports:{}},xx={exports:{}},_x=1e3,kx=6e4,Ix=60*kx,Tx=24*Ix,Ax=7*Tx,Ox=365.25*Tx,Kx=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*Ox;case"weeks":case"week":case"w":return n*Ax;case"days":case"day":case"d":return n*Tx;case"hours":case"hour":case"hrs":case"hr":case"h":return n*Ix;case"minutes":case"minute":case"mins":case"min":case"m":return n*kx;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===n&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=Tx)return Cx(e,t,Tx,"day");if(t>=Ix)return Cx(e,t,Ix,"hour");if(t>=kx)return Cx(e,t,kx,"minute");if(t>=1e3)return Cx(e,t,1e3,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=Tx)return Math.round(e/Tx)+"d";if(t>=Ix)return Math.round(e/Ix)+"h";if(t>=kx)return Math.round(e/kx)+"m";if(t>=_x)return Math.round(e/_x)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function Cx(e,t,n,r){var a=t>=1.5*n;return Math.round(e/n)+" "+r+(a?"s":"")}var Rx=function(e){function t(e){let r,a,i,o=null;function s(...e){if(!s.enabled)return;const n=s,a=Number(new Date),i=a-(r||a);n.diff=i,n.prev=r,n.curr=a,r=a,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((r,a)=>{if("%%"===r)return"%";o++;const i=t.formatters[a];if("function"==typeof i){const t=e[o];r=i.call(n,t),e.splice(o,1),o--}return r})),t.formatArgs.call(n,e);(n.log||t.log).apply(n,e)}return s.namespace=e,s.useColors=t.useColors(),s.color=t.selectColor(e),s.extend=n,s.destroy=t.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(a!==t.namespaces&&(a=t.namespaces,i=t.enabled(e)),i),set:e=>{o=e}}),"function"==typeof t.init&&t.init(s),s}function n(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function r(e,t){let n=0,r=0,a=-1,i=0;for(;n<e.length;)if(r<t.length&&(t[r]===e[n]||"*"===t[r]))"*"===t[r]?(a=r,i=n,r++):(n++,r++);else{if(-1===a)return!1;r=a+1,i++,n=i}for(;r<t.length&&"*"===t[r];)r++;return r===t.length}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names,...t.skips.map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const e of n)"-"===e[0]?t.skips.push(e.slice(1)):t.names.push(e)},t.enabled=function(e){for(const n of t.skips)if(r(e,n))return!1;for(const n of t.names)if(r(e,n))return!0;return!1},t.humanize=Kx,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t};!function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,a=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(a=r))})),t.splice(a,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")||t.storage.getItem("DEBUG")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=Rx(t);const{formatters:n}=e.exports;n.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(xx,xx.exports);var jx={exports:{}};!function(e,t){const n=Y.default,r=D.default;t.init=function(e){e.inspectOpts={};const n=Object.keys(t.inspectOpts);for(let r=0;r<n.length;r++)e.inspectOpts[n[r]]=t.inspectOpts[n[r]]},t.log=function(...e){return process.stderr.write(r.formatWithOptions(t.inspectOpts,...e)+"\n")},t.formatArgs=function(n){const{namespace:r,useColors:a}=this;if(a){const t=this.color,a="[3"+(t<8?t:"8;5;"+t),i=`  ${a};1m${r} [0m`;n[0]=i+n[0].split("\n").join("\n"+i),n.push(a+"m+"+e.exports.humanize(this.diff)+"[0m")}else n[0]=function(){if(t.inspectOpts.hideDate)return"";return(new Date).toISOString()+" "}()+r+" "+n[0]},t.save=function(e){e?process.env.DEBUG=e:delete process.env.DEBUG},t.load=function(){return process.env.DEBUG},t.useColors=function(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):n.isatty(process.stderr.fd)},t.destroy=r.deprecate((()=>{}),"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),t.colors=[6,2,3,4,5,1];try{const e=require("supports-color");e&&(e.stderr||e).level>=2&&(t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(e){}t.inspectOpts=Object.keys(process.env).filter((e=>/^debug_/i.test(e))).reduce(((e,t)=>{const n=t.substring(6).toLowerCase().replace(/_([a-z])/g,((e,t)=>t.toUpperCase()));let r=process.env[t];return r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:Number(r)),e[n]=r,e}),{}),e.exports=Rx(t);const{formatters:a}=e.exports;a.o=function(e){return this.inspectOpts.colors=this.useColors,r.inspect(e,this.inspectOpts).split("\n").map((e=>e.trim())).join(" ")},a.O=function(e){return this.inspectOpts.colors=this.useColors,r.inspect(e,this.inspectOpts)}}(jx,jx.exports),"undefined"==typeof process||"renderer"===process.type||!0===process.browser||process.__nwjs?Ex.exports=xx.exports:Ex.exports=jx.exports,Object.defineProperty(Sx,"__esModule",{value:!0}),Sx.genRedactedString=Sx.getStringValue=Sx.MAX_ARGUMENT_LENGTH=void 0;const Px=Ex.exports;Sx.MAX_ARGUMENT_LENGTH=200;function Dx(e){if(null!==e)switch(typeof e){case"boolean":case"number":return;case"object":if(Buffer.isBuffer(e))return e.toString("hex");if(Array.isArray(e))return e.join(",");try{return JSON.stringify(e)}catch(e){return}case"string":return e}}function Nx(e,t){const{length:n}=e;return n<=t?e:e.slice(0,t)+' ... <REDACTED full-length="'+n+'">'}Sx.getStringValue=Dx,Sx.genRedactedString=Nx,Sx.default=function(e){const t=(0,Px.default)(`ioredis:${e}`);function n(...e){if(t.enabled){for(let t=1;t<e.length;t++){const n=Dx(e[t]);"string"==typeof n&&n.length>200&&(e[t]=Nx(n,200))}return t.apply(null,e)}}return Object.defineProperties(n,{namespace:{get:()=>t.namespace},enabled:{get:()=>t.enabled},destroy:{get:()=>t.destroy},log:{get:()=>t.log,set(e){t.log=e}}}),n};var Lx={};Object.defineProperty(Lx,"__esModule",{value:!0});const Mx="-----BEGIN CERTIFICATE-----\nMIIDTzCCAjegAwIBAgIJAKSVpiDswLcwMA0GCSqGSIb3DQEBBQUAMD4xFjAUBgNV\nBAoMDUdhcmFudGlhIERhdGExJDAiBgNVBAMMG1NTTCBDZXJ0aWZpY2F0aW9uIEF1\ndGhvcml0eTAeFw0xMzEwMDExMjE0NTVaFw0yMzA5MjkxMjE0NTVaMD4xFjAUBgNV\nBAoMDUdhcmFudGlhIERhdGExJDAiBgNVBAMMG1NTTCBDZXJ0aWZpY2F0aW9uIEF1\ndGhvcml0eTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALZqkh/DczWP\nJnxnHLQ7QL0T4B4CDKWBKCcisriGbA6ZePWVNo4hfKQC6JrzfR+081NeD6VcWUiz\nrmd+jtPhIY4c+WVQYm5PKaN6DT1imYdxQw7aqO5j2KUCEh/cznpLxeSHoTxlR34E\nQwF28Wl3eg2vc5ct8LjU3eozWVk3gb7alx9mSA2SgmuX5lEQawl++rSjsBStemY2\nBDwOpAMXIrdEyP/cVn8mkvi/BDs5M5G+09j0gfhyCzRWMQ7Hn71u1eolRxwVxgi3\nTMn+/vTaFSqxKjgck6zuAYjBRPaHe7qLxHNr1So/Mc9nPy+3wHebFwbIcnUojwbp\n4nctkWbjb2cCAwEAAaNQME4wHQYDVR0OBBYEFP1whtcrydmW3ZJeuSoKZIKjze3w\nMB8GA1UdIwQYMBaAFP1whtcrydmW3ZJeuSoKZIKjze3wMAwGA1UdEwQFMAMBAf8w\nDQYJKoZIhvcNAQEFBQADggEBAG2erXhwRAa7+ZOBs0B6X57Hwyd1R4kfmXcs0rta\nlbPpvgULSiB+TCbf3EbhJnHGyvdCY1tvlffLjdA7HJ0PCOn+YYLBA0pTU/dyvrN6\nSu8NuS5yubnt9mb13nDGYo1rnt0YRfxN+8DM3fXIVr038A30UlPX2Ou1ExFJT0MZ\nuFKY6ZvLdI6/1cbgmguMlAhM+DhKyV6Sr5699LM3zqeI816pZmlREETYkGr91q7k\nBpXJu/dtHaGxg1ZGu6w/PCsYGUcECWENYD4VQPd8N32JjOfu6vEgoEAwfPP+3oGp\nZ4m3ewACcWOAenqflb+cQYC4PsF7qbXDmRaWrbKntOlZ3n0=\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIIGMTCCBBmgAwIBAgICEAAwDQYJKoZIhvcNAQELBQAwajELMAkGA1UEBhMCVVMx\nCzAJBgNVBAgMAkNBMQswCQYDVQQHDAJDQTESMBAGA1UECgwJUmVkaXNMYWJzMS0w\nKwYDVQQDDCRSZWRpc0xhYnMgUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwHhcN\nMTgwMjI1MTUzNzM3WhcNMjgwMjIzMTUzNzM3WjBfMQswCQYDVQQGEwJVUzELMAkG\nA1UECAwCQ0ExEjAQBgNVBAoMCVJlZGlzTGFiczEvMC0GA1UEAwwmUkNQIEludGVy\nbWVkaWF0ZSBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwggIiMA0GCSqGSIb3DQEBAQUA\nA4ICDwAwggIKAoICAQDf9dqbxc8Bq7Ctq9rWcxrGNKKHivqLAFpPq02yLPx6fsOv\nTq7GsDChAYBBc4v7Y2Ap9RD5Vs3dIhEANcnolf27QwrG9RMnnvzk8pCvp1o6zSU4\nVuOE1W66/O1/7e2rVxyrnTcP7UgK43zNIXu7+tiAqWsO92uSnuMoGPGpeaUm1jym\nhjWKtkAwDFSqvHY+XL5qDVBEjeUe+WHkYUg40cAXjusAqgm2hZt29c2wnVrxW25W\nP0meNlzHGFdA2AC5z54iRiqj57dTfBTkHoBczQxcyw6hhzxZQ4e5I5zOKjXXEhZN\nr0tA3YC14CTabKRus/JmZieyZzRgEy2oti64tmLYTqSlAD78pRL40VNoaSYetXLw\nhhNsXCHgWaY6d5bLOc/aIQMAV5oLvZQKvuXAF1IDmhPA+bZbpWipp0zagf1P1H3s\nUzsMdn2KM0ejzgotbtNlj5TcrVwpmvE3ktvUAuA+hi3FkVx1US+2Gsp5x4YOzJ7u\nP1WPk6ShF0JgnJH2ILdj6kttTWwFzH17keSFICWDfH/+kM+k7Y1v3EXMQXE7y0T9\nMjvJskz6d/nv+sQhY04xt64xFMGTnZjlJMzfQNi7zWFLTZnDD0lPowq7l3YiPoTT\nt5Xky83lu0KZsZBo0WlWaDG00gLVdtRgVbcuSWxpi5BdLb1kRab66JptWjxwXQID\nAQABo4HrMIHoMDoGA1UdHwQzMDEwL6AtoCuGKWh0dHBzOi8vcmwtY2Etc2VydmVy\nLnJlZGlzbGFicy5jb20vdjEvY3JsMEYGCCsGAQUFBwEBBDowODA2BggrBgEFBQcw\nAYYqaHR0cHM6Ly9ybC1jYS1zZXJ2ZXIucmVkaXNsYWJzLmNvbS92MS9vY3NwMB0G\nA1UdDgQWBBQHar5OKvQUpP2qWt6mckzToeCOHDAfBgNVHSMEGDAWgBQi42wH6hM4\nL2sujEvLM0/u8lRXTzASBgNVHRMBAf8ECDAGAQH/AgEAMA4GA1UdDwEB/wQEAwIB\nhjANBgkqhkiG9w0BAQsFAAOCAgEAirEn/iTsAKyhd+pu2W3Z5NjCko4NPU0EYUbr\nAP7+POK2rzjIrJO3nFYQ/LLuC7KCXG+2qwan2SAOGmqWst13Y+WHp44Kae0kaChW\nvcYLXXSoGQGC8QuFSNUdaeg3RbMDYFT04dOkqufeWVccoHVxyTSg9eD8LZuHn5jw\n7QDLiEECBmIJHk5Eeo2TAZrx4Yx6ufSUX5HeVjlAzqwtAqdt99uCJ/EL8bgpWbe+\nXoSpvUv0SEC1I1dCAhCKAvRlIOA6VBcmzg5Am12KzkqTul12/VEFIgzqu0Zy2Jbc\nAUPrYVu/+tOGXQaijy7YgwH8P8n3s7ZeUa1VABJHcxrxYduDDJBLZi+MjheUDaZ1\njQRHYevI2tlqeSBqdPKG4zBY5lS0GiAlmuze5oENt0P3XboHoZPHiqcK3VECgTVh\n/BkJcuudETSJcZDmQ8YfoKfBzRQNg2sv/hwvUv73Ss51Sco8GEt2lD8uEdib1Q6z\nzDT5lXJowSzOD5ZA9OGDjnSRL+2riNtKWKEqvtEG3VBJoBzu9GoxbAc7wIZLxmli\niF5a/Zf5X+UXD3s4TMmy6C4QZJpAA2egsSQCnraWO2ULhh7iXMysSkF/nzVfZn43\niqpaB8++9a37hWq14ZmOv0TJIDz//b2+KC4VFXWQ5W5QC6whsjT+OlG4p5ZYG0jo\n616pxqo=\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIIFujCCA6KgAwIBAgIJAJ1aTT1lu2ScMA0GCSqGSIb3DQEBCwUAMGoxCzAJBgNV\nBAYTAlVTMQswCQYDVQQIDAJDQTELMAkGA1UEBwwCQ0ExEjAQBgNVBAoMCVJlZGlz\nTGFiczEtMCsGA1UEAwwkUmVkaXNMYWJzIFJvb3QgQ2VydGlmaWNhdGUgQXV0aG9y\naXR5MB4XDTE4MDIyNTE1MjA0MloXDTM4MDIyMDE1MjA0MlowajELMAkGA1UEBhMC\nVVMxCzAJBgNVBAgMAkNBMQswCQYDVQQHDAJDQTESMBAGA1UECgwJUmVkaXNMYWJz\nMS0wKwYDVQQDDCRSZWRpc0xhYnMgUm9vdCBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkw\nggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIKAoICAQDLEjXy7YrbN5Waau5cd6g1\nG5C2tMmeTpZ0duFAPxNU4oE3RHS5gGiok346fUXuUxbZ6QkuzeN2/2Z+RmRcJhQY\nDm0ZgdG4x59An1TJfnzKKoWj8ISmoHS/TGNBdFzXV7FYNLBuqZouqePI6ReC6Qhl\npp45huV32Q3a6IDrrvx7Wo5ZczEQeFNbCeCOQYNDdTmCyEkHqc2AGo8eoIlSTutT\nULOC7R5gzJVTS0e1hesQ7jmqHjbO+VQS1NAL4/5K6cuTEqUl+XhVhPdLWBXJQ5ag\n54qhX4v+ojLzeU1R/Vc6NjMvVtptWY6JihpgplprN0Yh2556ewcXMeturcKgXfGJ\nxeYzsjzXerEjrVocX5V8BNrg64NlifzTMKNOOv4fVZszq1SIHR8F9ROrqiOdh8iC\nJpUbLpXH9hWCSEO6VRMB2xJoKu3cgl63kF30s77x7wLFMEHiwsQRKxooE1UhgS9K\n2sO4TlQ1eWUvFvHSTVDQDlGQ6zu4qjbOpb3Q8bQwoK+ai2alkXVR4Ltxe9QlgYK3\nStsnPhruzZGA0wbXdpw0bnM+YdlEm5ffSTpNIfgHeaa7Dtb801FtA71ZlH7A6TaI\nSIQuUST9EKmv7xrJyx0W1pGoPOLw5T029aTjnICSLdtV9bLwysrLhIYG5bnPq78B\ncS+jZHFGzD7PUVGQD01nOQIDAQABo2MwYTAdBgNVHQ4EFgQUIuNsB+oTOC9rLoxL\nyzNP7vJUV08wHwYDVR0jBBgwFoAUIuNsB+oTOC9rLoxLyzNP7vJUV08wDwYDVR0T\nAQH/BAUwAwEB/zAOBgNVHQ8BAf8EBAMCAYYwDQYJKoZIhvcNAQELBQADggIBAHfg\nz5pMNUAKdMzK1aS1EDdK9yKz4qicILz5czSLj1mC7HKDRy8cVADUxEICis++CsCu\nrYOvyCVergHQLREcxPq4rc5Nq1uj6J6649NEeh4WazOOjL4ZfQ1jVznMbGy+fJm3\n3Hoelv6jWRG9iqeJZja7/1s6YC6bWymI/OY1e4wUKeNHAo+Vger7MlHV+RuabaX+\nhSJ8bJAM59NCM7AgMTQpJCncrcdLeceYniGy5Q/qt2b5mJkQVkIdy4TPGGB+AXDJ\nD0q3I/JDRkDUFNFdeW0js7fHdsvCR7O3tJy5zIgEV/o/BCkmJVtuwPYOrw/yOlKj\nTY/U7ATAx9VFF6/vYEOMYSmrZlFX+98L6nJtwDqfLB5VTltqZ4H/KBxGE3IRSt9l\nFXy40U+LnXzhhW+7VBAvyYX8GEXhHkKU8Gqk1xitrqfBXY74xKgyUSTolFSfFVgj\nmcM/X4K45bka+qpkj7Kfv/8D4j6aZekwhN2ly6hhC1SmQ8qjMjpG/mrWOSSHZFmf\nybu9iD2AYHeIOkshIl6xYIa++Q/00/vs46IzAbQyriOi0XxlSMMVtPx0Q3isp+ji\nn8Mq9eOuxYOEQ4of8twUkUDd528iwGtEdwf0Q01UyT84S62N8AySl1ZBKXJz6W4F\nUhWfa/HQYOAPDdEjNgnVwLI23b8t0TozyCWw7q8h\n-----END CERTIFICATE-----\n\n-----BEGIN CERTIFICATE-----\nMIIEjzCCA3egAwIBAgIQe55B/ALCKJDZtdNT8kD6hTANBgkqhkiG9w0BAQsFADBM\nMSAwHgYDVQQLExdHbG9iYWxTaWduIFJvb3QgQ0EgLSBSMzETMBEGA1UEChMKR2xv\nYmFsU2lnbjETMBEGA1UEAxMKR2xvYmFsU2lnbjAeFw0yMjAxMjYxMjAwMDBaFw0y\nNTAxMjYwMDAwMDBaMFgxCzAJBgNVBAYTAkJFMRkwFwYDVQQKExBHbG9iYWxTaWdu\nIG52LXNhMS4wLAYDVQQDEyVHbG9iYWxTaWduIEF0bGFzIFIzIE9WIFRMUyBDQSAy\nMDIyIFEyMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAmGmg1LW9b7Lf\n8zDD83yBDTEkt+FOxKJZqF4veWc5KZsQj9HfnUS2e5nj/E+JImlGPsQuoiosLuXD\nBVBNAMcUFa11buFMGMeEMwiTmCXoXRrXQmH0qjpOfKgYc5gHG3BsRGaRrf7VR4eg\nofNMG9wUBw4/g/TT7+bQJdA4NfE7Y4d5gEryZiBGB/swaX6Jp/8MF4TgUmOWmalK\ndZCKyb4sPGQFRTtElk67F7vU+wdGcrcOx1tDcIB0ncjLPMnaFicagl+daWGsKqTh\ncounQb6QJtYHa91KvCfKWocMxQ7OIbB5UARLPmC4CJ1/f8YFm35ebfzAeULYdGXu\njE9CLor0OwIDAQABo4IBXzCCAVswDgYDVR0PAQH/BAQDAgGGMB0GA1UdJQQWMBQG\nCCsGAQUFBwMBBggrBgEFBQcDAjASBgNVHRMBAf8ECDAGAQH/AgEAMB0GA1UdDgQW\nBBSH5Zq7a7B/t95GfJWkDBpA8HHqdjAfBgNVHSMEGDAWgBSP8Et/qC5FJK5NUPpj\nmove4t0bvDB7BggrBgEFBQcBAQRvMG0wLgYIKwYBBQUHMAGGImh0dHA6Ly9vY3Nw\nMi5nbG9iYWxzaWduLmNvbS9yb290cjMwOwYIKwYBBQUHMAKGL2h0dHA6Ly9zZWN1\ncmUuZ2xvYmFsc2lnbi5jb20vY2FjZXJ0L3Jvb3QtcjMuY3J0MDYGA1UdHwQvMC0w\nK6ApoCeGJWh0dHA6Ly9jcmwuZ2xvYmFsc2lnbi5jb20vcm9vdC1yMy5jcmwwIQYD\nVR0gBBowGDAIBgZngQwBAgIwDAYKKwYBBAGgMgoBAjANBgkqhkiG9w0BAQsFAAOC\nAQEAKRic9/f+nmhQU/wz04APZLjgG5OgsuUOyUEZjKVhNGDwxGTvKhyXGGAMW2B/\n3bRi+aElpXwoxu3pL6fkElbX3B0BeS5LoDtxkyiVEBMZ8m+sXbocwlPyxrPbX6mY\n0rVIvnuUeBH8X0L5IwfpNVvKnBIilTbcebfHyXkPezGwz7E1yhUULjJFm2bt0SdX\ny+4X/WeiiYIv+fTVgZZgl+/2MKIsu/qdBJc3f3TvJ8nz+Eax1zgZmww+RSQWeOj3\n15Iw6Z5FX+NwzY/Ab+9PosR5UosSeq+9HhtaxZttXG1nVh+avYPGYddWmiMT90J5\nZgKnO/Fx2hBgTxhOTMYaD312kg==\n-----END CERTIFICATE-----\n\n-----BEGIN CERTIFICATE-----\nMIIDXzCCAkegAwIBAgILBAAAAAABIVhTCKIwDQYJKoZIhvcNAQELBQAwTDEgMB4G\nA1UECxMXR2xvYmFsU2lnbiBSb290IENBIC0gUjMxEzARBgNVBAoTCkdsb2JhbFNp\nZ24xEzARBgNVBAMTCkdsb2JhbFNpZ24wHhcNMDkwMzE4MTAwMDAwWhcNMjkwMzE4\nMTAwMDAwWjBMMSAwHgYDVQQLExdHbG9iYWxTaWduIFJvb3QgQ0EgLSBSMzETMBEG\nA1UEChMKR2xvYmFsU2lnbjETMBEGA1UEAxMKR2xvYmFsU2lnbjCCASIwDQYJKoZI\nhvcNAQEBBQADggEPADCCAQoCggEBAMwldpB5BngiFvXAg7aEyiie/QV2EcWtiHL8\nRgJDx7KKnQRfJMsuS+FggkbhUqsMgUdwbN1k0ev1LKMPgj0MK66X17YUhhB5uzsT\ngHeMCOFJ0mpiLx9e+pZo34knlTifBtc+ycsmWQ1z3rDI6SYOgxXG71uL0gRgykmm\nKPZpO/bLyCiR5Z2KYVc3rHQU3HTgOu5yLy6c+9C7v/U9AOEGM+iCK65TpjoWc4zd\nQQ4gOsC0p6Hpsk+QLjJg6VfLuQSSaGjlOCZgdbKfd/+RFO+uIEn8rUAVSNECMWEZ\nXriX7613t2Saer9fwRPvm2L7DWzgVGkWqQPabumDk3F2xmmFghcCAwEAAaNCMEAw\nDgYDVR0PAQH/BAQDAgEGMA8GA1UdEwEB/wQFMAMBAf8wHQYDVR0OBBYEFI/wS3+o\nLkUkrk1Q+mOai97i3Ru8MA0GCSqGSIb3DQEBCwUAA4IBAQBLQNvAUKr+yAzv95ZU\nRUm7lgAJQayzE4aGKAczymvmdLm6AC2upArT9fHxD4q/c2dKg8dEe3jgr25sbwMp\njjM5RcOO5LlXbKr8EpbsU8Yt5CRsuZRj+9xTaGdWPoO4zzUhw8lo/s7awlOqzJCK\n6fBdRoyV3XpYKBovHd7NADdBj+1EbddTKJd+82cEHhXXipa0095MJ6RMG3NzdvQX\nmcIfeg7jLQitChws/zyrVQ4PkX4268NXSb7hLi18YIvDQVETI53O9zJrlAGomecs\nMx86OyXShkDOOyyGeMlhLxS67ttVb9+E7gUJTb0o2HLO02JQZR7rkpeDMdmztcpH\nWD9f\n-----END CERTIFICATE-----",Fx={RedisCloudFixed:{ca:Mx},RedisCloudFlexible:{ca:Mx}};Lx.default=Fx,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.noop=e.defaults=e.Debug=e.zipMap=e.CONNECTION_CLOSED_ERROR_MSG=e.shuffle=e.sample=e.resolveTLSProfile=e.parseURL=e.optimizeErrorStack=e.toArg=e.convertMapToArray=e.convertObjectToArray=e.timeout=e.packObject=e.isInt=e.wrapMultiResult=e.convertBufferToString=void 0;const t=C.default,n=$E;Object.defineProperty(e,"defaults",{enumerable:!0,get:function(){return n.defaults}}),Object.defineProperty(e,"noop",{enumerable:!0,get:function(){return n.noop}});const r=Sx;e.Debug=r.default;const a=Lx;function i(e){const t=parseFloat(e);return!isNaN(e)&&(0|t)===t}e.convertBufferToString=function e(t,n){if(t instanceof Buffer)return t.toString(n);if(Array.isArray(t)){const r=t.length,a=Array(r);for(let i=0;i<r;++i)a[i]=t[i]instanceof Buffer&&"utf8"===n?t[i].toString():e(t[i],n);return a}return t},e.wrapMultiResult=function(e){if(!e)return null;const t=[],n=e.length;for(let r=0;r<n;++r){const n=e[r];n instanceof Error?t.push([n]):t.push([null,n])}return t},e.isInt=i,e.packObject=function(e){const t={},n=e.length;for(let r=1;r<n;r+=2)t[e[r-1]]=e[r];return t},e.timeout=function(e,t){let n=null;const r=function(){n&&(clearTimeout(n),n=null,e.apply(this,arguments))};return n=setTimeout(r,t,new Error("timeout")),r},e.convertObjectToArray=function(e){const t=[],n=Object.keys(e);for(let r=0,a=n.length;r<a;r++)t.push(n[r],e[n[r]]);return t},e.convertMapToArray=function(e){const t=[];let n=0;return e.forEach((function(e,r){t[n]=r,t[n+1]=e,n+=2})),t},e.toArg=function(e){return null==e?"":String(e)},e.optimizeErrorStack=function(e,t,n){const r=t.split("\n");let a,i="";for(a=1;a<r.length&&-1!==r[a].indexOf(n);++a);for(let e=a;e<r.length;++e)i+="\n"+r[e];if(e.stack){const t=e.stack.indexOf("\n");e.stack=e.stack.slice(0,t)+i}return e},e.parseURL=function(e){if(i(e))return{port:e};let r=(0,t.parse)(e,!0,!0);r.slashes||"/"===e[0]||(e="//"+e,r=(0,t.parse)(e,!0,!0));const a=r.query||{},o={};if(r.auth){const e=r.auth.indexOf(":");o.username=-1===e?r.auth:r.auth.slice(0,e),o.password=-1===e?"":r.auth.slice(e+1)}if(r.pathname&&("redis:"===r.protocol||"rediss:"===r.protocol?r.pathname.length>1&&(o.db=r.pathname.slice(1)):o.path=r.pathname),r.host&&(o.host=r.hostname),r.port&&(o.port=r.port),"string"==typeof a.family){const e=Number.parseInt(a.family,10);Number.isNaN(e)||(o.family=e)}return(0,n.defaults)(o,a),o},e.resolveTLSProfile=function(e){let t=null==e?void 0:e.tls;"string"==typeof t&&(t={profile:t});const n=a.default[null==t?void 0:t.profile];return n&&(t=Object.assign({},n,t),delete t.profile,e=Object.assign({},e,{tls:t})),e},e.sample=function(e,t=0){const n=e.length;return t>=n?null:e[t+Math.floor(Math.random()*(n-t))]},e.shuffle=function(e){let t=e.length;for(;t>0;){const n=Math.floor(Math.random()*t);t--,[e[t],e[n]]=[e[n],e[t]]}return e},e.CONNECTION_CLOSED_ERROR_MSG="Connection is closed.",e.zipMap=function(e,t){const n=new Map;return e.forEach(((e,r)=>{n.set(e,t[r])})),n}}(GE),Object.defineProperty(BE,"__esModule",{value:!0});const Bx=wE,Vx=VE.exports,Ux=EE,Jx=GE;class Gx{constructor(e,t=[],n={},r){if(this.name=e,this.inTransaction=!1,this.isResolved=!1,this.transformed=!1,this.replyEncoding=n.replyEncoding,this.errorStack=n.errorStack,this.args=t.flat(),this.callback=r,this.initPromise(),n.keyPrefix){const e=n.keyPrefix instanceof Buffer;let t=e?n.keyPrefix:null;this._iterateKeys((r=>r instanceof Buffer?(null===t&&(t=Buffer.from(n.keyPrefix)),Buffer.concat([t,r])):e?Buffer.concat([n.keyPrefix,Buffer.from(String(r))]):n.keyPrefix+r))}n.readOnly&&(this.isReadOnly=!0)}static checkFlag(e,t){return!!this.getFlagMap()[e][t]}static setArgumentTransformer(e,t){this._transformer.argument[e]=t}static setReplyTransformer(e,t){this._transformer.reply[e]=t}static getFlagMap(){return this.flagMap||(this.flagMap=Object.keys(Gx.FLAGS).reduce(((e,t)=>(e[t]={},Gx.FLAGS[t].forEach((n=>{e[t][n]=!0})),e)),{})),this.flagMap}getSlot(){if(void 0===this.slot){const e=this.getKeys()[0];this.slot=null==e?null:Vx(e)}return this.slot}getKeys(){return this._iterateKeys()}toWritable(e){let t;const n="*"+(this.args.length+1)+"\r\n$"+Buffer.byteLength(this.name)+"\r\n"+this.name+"\r\n";if(this.bufferMode){const e=new zx;e.push(n);for(let t=0;t<this.args.length;++t){const n=this.args[t];n instanceof Buffer?0===n.length?e.push("$0\r\n\r\n"):(e.push("$"+n.length+"\r\n"),e.push(n),e.push("\r\n")):e.push("$"+Buffer.byteLength(n)+"\r\n"+n+"\r\n")}t=e.toBuffer()}else{t=n;for(let e=0;e<this.args.length;++e){const n=this.args[e];t+="$"+Buffer.byteLength(n)+"\r\n"+n+"\r\n"}}return t}stringifyArguments(){for(let e=0;e<this.args.length;++e){const t=this.args[e];"string"==typeof t||(t instanceof Buffer?this.bufferMode=!0:this.args[e]=(0,Jx.toArg)(t))}}transformReply(e){this.replyEncoding&&(e=(0,Jx.convertBufferToString)(e,this.replyEncoding));const t=Gx._transformer.reply[this.name];return t&&(e=t(e)),e}setTimeout(e){this._commandTimeoutTimer||(this._commandTimeoutTimer=setTimeout((()=>{this.isResolved||this.reject(new Error("Command timed out"))}),e))}initPromise(){const e=new Promise(((e,t)=>{if(!this.transformed){this.transformed=!0;const e=Gx._transformer.argument[this.name];e&&(this.args=e(this.args)),this.stringifyArguments()}this.resolve=this._convertValue(e),this.errorStack?this.reject=e=>{t((0,Jx.optimizeErrorStack)(e,this.errorStack.stack,__dirname))}:this.reject=t}));this.promise=(0,Ux.default)(e,this.callback)}_iterateKeys(e=(e=>e)){if(void 0===this.keys&&(this.keys=[],(0,Bx.exists)(this.name))){const t=(0,Bx.getKeyIndexes)(this.name,this.args);for(const n of t)this.args[n]=e(this.args[n]),this.keys.push(this.args[n])}return this.keys}_convertValue(e){return t=>{try{const n=this._commandTimeoutTimer;n&&(clearTimeout(n),delete this._commandTimeoutTimer),e(this.transformReply(t)),this.isResolved=!0}catch(e){this.reject(e)}return this.promise}}}BE.default=Gx,Gx.FLAGS={VALID_IN_SUBSCRIBER_MODE:["subscribe","psubscribe","unsubscribe","punsubscribe","ssubscribe","sunsubscribe","ping","quit"],VALID_IN_MONITOR_MODE:["monitor","auth"],ENTER_SUBSCRIBER_MODE:["subscribe","psubscribe","ssubscribe"],EXIT_SUBSCRIBER_MODE:["unsubscribe","punsubscribe","sunsubscribe"],WILL_DISCONNECT:["quit"]},Gx._transformer={argument:{},reply:{}};const $x=function(e){if(1===e.length){if(e[0]instanceof Map)return(0,Jx.convertMapToArray)(e[0]);if("object"==typeof e[0]&&null!==e[0])return(0,Jx.convertObjectToArray)(e[0])}return e},qx=function(e){if(2===e.length){if(e[1]instanceof Map)return[e[0]].concat((0,Jx.convertMapToArray)(e[1]));if("object"==typeof e[1]&&null!==e[1])return[e[0]].concat((0,Jx.convertObjectToArray)(e[1]))}return e};Gx.setArgumentTransformer("mset",$x),Gx.setArgumentTransformer("msetnx",$x),Gx.setArgumentTransformer("hset",qx),Gx.setArgumentTransformer("hmset",qx),Gx.setReplyTransformer("hgetall",(function(e){if(Array.isArray(e)){const t={};for(let n=0;n<e.length;n+=2){const r=e[n],a=e[n+1];r in t?Object.defineProperty(t,r,{value:a,configurable:!0,enumerable:!0,writable:!0}):t[r]=a}return t}return e}));class zx{constructor(){this.length=0,this.items=[]}push(e){this.length+=Buffer.byteLength(e),this.items.push(e)}toBuffer(){const e=Buffer.allocUnsafe(this.length);let t=0;for(const n of this.items){const r=Buffer.byteLength(n);Buffer.isBuffer(n)?n.copy(e,t):e.write(n,t,r),t+=r}return e}}var Wx={};Object.defineProperty(Wx,"__esModule",{value:!0});const Yx=FE;class Hx extends Yx.RedisError{constructor(e,t){super(e),this.lastNodeError=t,Error.captureStackTrace(this,this.constructor)}get name(){return this.constructor.name}}Wx.default=Hx,Hx.defaultMessage="Failed to refresh slots cache.";var Qx={};Object.defineProperty(Qx,"__esModule",{value:!0});const Zx=R.default;class Xx extends Zx.Readable{constructor(e){super(e),this.opt=e,this._redisCursor="0",this._redisDrained=!1}_read(){if(this._redisDrained)return void this.push(null);const e=[this._redisCursor];this.opt.key&&e.unshift(this.opt.key),this.opt.match&&e.push("MATCH",this.opt.match),this.opt.type&&e.push("TYPE",this.opt.type),this.opt.count&&e.push("COUNT",String(this.opt.count)),this.opt.noValues&&e.push("NOVALUES"),this.opt.redis[this.opt.command](e,((e,t)=>{e?this.emit("error",e):(this._redisCursor=t[0]instanceof Buffer?t[0].toString():t[0],"0"===this._redisCursor&&(this._redisDrained=!0),this.push(t[1]))}))}close(){this._redisDrained=!0}}Qx.default=Xx;var e_={},t_={},n_={},r_={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.executeWithAutoPipelining=e.getFirstValueInFlattenedArray=e.shouldUseAutoPipelining=e.notAllowedAutoPipelineCommands=e.kCallbacks=e.kExec=void 0;const t=$E,n=VE.exports,r=EE;function a(t,n){if(t._runningAutoPipelines.has(n))return;if(!t._autoPipelines.has(n))return;t._runningAutoPipelines.add(n);const r=t._autoPipelines.get(n);t._autoPipelines.delete(n);const i=r[e.kCallbacks];r[e.kCallbacks]=null,r.exec((function(e,r){if(t._runningAutoPipelines.delete(n),e)for(let t=0;t<i.length;t++)process.nextTick(i[t],e);else for(let e=0;e<i.length;e++)process.nextTick(i[e],...r[e]);t._autoPipelines.has(n)&&a(t,n)}))}function i(e){for(let n=0;n<e.length;n++){const r=e[n];if("string"==typeof r)return r;if(Array.isArray(r)||(0,t.isArguments)(r)){if(0===r.length)continue;return r[0]}const a=[r].flat();if(a.length>0)return a[0]}}e.kExec=Symbol("exec"),e.kCallbacks=Symbol("callbacks"),e.notAllowedAutoPipelineCommands=["auth","info","script","quit","cluster","pipeline","multi","subscribe","psubscribe","unsubscribe","unpsubscribe","select"],e.shouldUseAutoPipelining=function(t,n,r){return n&&t.options.enableAutoPipelining&&!t.isPipeline&&!e.notAllowedAutoPipelineCommands.includes(r)&&!t.options.autoPipeliningIgnoredCommands.includes(r)},e.getFirstValueInFlattenedArray=i,e.executeWithAutoPipelining=function o(s,l,c,u,d){if(s.isCluster&&!s.slots.length)return"wait"===s.status&&s.connect().catch(t.noop),(0,r.default)(new Promise((function(e,t){s.delayUntilReady((n=>{n?t(n):o(s,l,c,u,null).then(e,t)}))})),d);const p=s.options.keyPrefix||"",h=s.isCluster?s.slots[n(`${p}${i(u)}`)].join(","):"main";if(!s._autoPipelines.has(h)){const t=s.pipeline();t[e.kExec]=!1,t[e.kCallbacks]=[],s._autoPipelines.set(h,t)}const m=s._autoPipelines.get(h);m[e.kExec]||(m[e.kExec]=!0,setImmediate(a,s,h));const f=new Promise((function(t,n){m[e.kCallbacks].push((function(e,r){e?n(e):t(r)})),"call"===l&&u.unshift(c),m[l](...u)}));return(0,r.default)(f,d)}}(r_);var a_={};Object.defineProperty(a_,"__esModule",{value:!0});const i_=B.default,o_=BE,s_=EE;a_.default=class{constructor(e,t=null,n="",r=!1){this.lua=e,this.numberOfKeys=t,this.keyPrefix=n,this.readOnly=r,this.sha=(0,i_.createHash)("sha1").update(e).digest("hex");const a=this.sha,i=new WeakSet;this.Command=class extends o_.default{toWritable(t){const n=this.reject;return this.reject=e=>{-1!==e.message.indexOf("NOSCRIPT")&&i.delete(t),n.call(this,e)},i.has(t)?"eval"===this.name&&(this.name="evalsha",this.args[0]=a):(i.add(t),this.name="eval",this.args[0]=e),super.toWritable(t)}}}execute(e,t,n,r){"number"==typeof this.numberOfKeys&&t.unshift(this.numberOfKeys),this.keyPrefix&&(n.keyPrefix=this.keyPrefix),this.readOnly&&(n.readOnly=!0);const a=new this.Command("evalsha",[this.sha,...t],n);return a.promise=a.promise.catch((r=>{if(-1===r.message.indexOf("NOSCRIPT"))throw r;const a=new this.Command("evalsha",[this.sha,...t],n);return(e.isPipeline?e.redis:e).sendCommand(a)})),(0,s_.default)(a.promise,r),e.sendCommand(a)}},Object.defineProperty(n_,"__esModule",{value:!0});const l_=wE,c_=r_,u_=BE,d_=a_;class p_{constructor(){this.options={},this.scriptsSet={},this.addedBuiltinSet=new Set}getBuiltinCommands(){return h_.slice(0)}createBuiltinCommand(e){return{string:m_(null,e,"utf8"),buffer:m_(null,e,null)}}addBuiltinCommand(e){this.addedBuiltinSet.add(e),this[e]=m_(e,e,"utf8"),this[e+"Buffer"]=m_(e+"Buffer",e,null)}defineCommand(e,t){const n=new d_.default(t.lua,t.numberOfKeys,this.options.keyPrefix,t.readOnly);this.scriptsSet[e]=n,this[e]=f_(e,e,n,"utf8"),this[e+"Buffer"]=f_(e+"Buffer",e,n,null)}sendCommand(e,t,n){throw new Error('"sendCommand" is not implemented')}}const h_=l_.list.filter((e=>"monitor"!==e));function m_(e,t,n){return void 0===n&&(n=t,t=null),function(...r){const a=t||r.shift();let i=r[r.length-1];"function"==typeof i?r.pop():i=void 0;const o={errorStack:this.options.showFriendlyErrorStack?new Error:void 0,keyPrefix:this.options.keyPrefix,replyEncoding:n};return(0,c_.shouldUseAutoPipelining)(this,e,a)?(0,c_.executeWithAutoPipelining)(this,e,a,r,i):this.sendCommand(new u_.default(a,r,o,i))}}function f_(e,t,n,r){return function(...a){const i="function"==typeof a[a.length-1]?a.pop():void 0,o={replyEncoding:r};return this.options.showFriendlyErrorStack&&(o.errorStack=new Error),(0,c_.shouldUseAutoPipelining)(this,e,t)?(0,c_.executeWithAutoPipelining)(this,e,t,a,i):n.execute(this,a,o,i)}}h_.push("sentinel"),h_.forEach((function(e){p_.prototype[e]=m_(e,e,"utf8"),p_.prototype[e+"Buffer"]=m_(e+"Buffer",e,null)})),p_.prototype.call=m_("call","utf8"),p_.prototype.callBuffer=m_("callBuffer",null),p_.prototype.send_command=p_.prototype.call,n_.default=p_,Object.defineProperty(t_,"__esModule",{value:!0});const y_=VE.exports,g_=wE,b_=EE,v_=D.default,w_=BE,S_=GE,E_=n_;function x_(e,t){const n=y_(t[0]),r=e._groupsBySlot[n];for(let n=1;n<t.length;n++)if(e._groupsBySlot[y_(t[n])]!==r)return-1;return n}class __ extends E_.default{constructor(e){super(),this.redis=e,this.isPipeline=!0,this.replyPending=0,this._queue=[],this._result=[],this._transactions=0,this._shaToScript={},this.isCluster="Cluster"===this.redis.constructor.name||this.redis.isCluster,this.options=e.options,Object.keys(e.scriptsSet).forEach((t=>{const n=e.scriptsSet[t];this._shaToScript[n.sha]=n,this[t]=e[t],this[t+"Buffer"]=e[t+"Buffer"]})),e.addedBuiltinSet.forEach((t=>{this[t]=e[t],this[t+"Buffer"]=e[t+"Buffer"]})),this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}));const t=this;Object.defineProperty(this,"length",{get:function(){return t._queue.length}})}fillResult(e,t){if("exec"===this._queue[t].name&&Array.isArray(e[1])){const n=e[1].length;for(let r=0;r<n;r++){if(e[1][r]instanceof Error)continue;const a=this._queue[t-(n-r)];try{e[1][r]=a.transformReply(e[1][r])}catch(t){e[1][r]=t}}}if(this._result[t]=e,--this.replyPending)return;if(this.isCluster){let e,t=!0;for(let n=0;n<this._result.length;++n){const r=this._result[n][0],a=this._queue[n];if(r){if("exec"===a.name&&"EXECABORT Transaction discarded because of previous errors."===r.message)continue;if(e){if(e.name!==r.name||e.message!==r.message){t=!1;break}}else e={name:r.name,message:r.message}}else if(!a.inTransaction){if(!((0,g_.exists)(a.name)&&(0,g_.hasFlag)(a.name,"readonly"))){t=!1;break}}}if(e&&t){const t=this,n=e.message.split(" "),r=this._queue;let a=!1;this._queue=[];for(let e=0;e<r.length;++e){if(!("ASK"!==n[0]||a||"asking"===r[e].name||r[e-1]&&"asking"===r[e-1].name)){const e=new w_.default("asking");e.ignore=!0,this.sendCommand(e)}r[e].initPromise(),this.sendCommand(r[e]),a=r[e].inTransaction}let i=!0;void 0===this.leftRedirections&&(this.leftRedirections={});const o=function(){t.exec()},s=this.redis;if(s.handleError(e,this.leftRedirections,{moved:function(e,r){t.preferKey=r,s.slots[n[1]]=[r],s._groupsBySlot[n[1]]=s._groupsIds[s.slots[n[1]].join(";")],s.refreshSlotsCache(),t.exec()},ask:function(e,n){t.preferKey=n,t.exec()},tryagain:o,clusterDown:o,connectionClosed:o,maxRedirections:()=>{i=!1},defaults:()=>{i=!1}}),i)return}}let n=0;for(let e=0;e<this._queue.length-n;++e)this._queue[e+n].ignore&&(n+=1),this._result[e]=this._result[e+n];this.resolve(this._result.slice(0,this._result.length-n))}sendCommand(e){this._transactions>0&&(e.inTransaction=!0);const t=this._queue.length;return e.pipelineIndex=t,e.promise.then((e=>{this.fillResult([null,e],t)})).catch((e=>{this.fillResult([e],t)})),this._queue.push(e),this}addBatch(e){let t,n,r;for(let a=0;a<e.length;++a)t=e[a],n=t[0],r=t.slice(1),this[n].apply(this,r);return this}}t_.default=__;const k_=__.prototype.multi;__.prototype.multi=function(){return this._transactions+=1,k_.apply(this,arguments)};const I_=__.prototype.execBuffer;__.prototype.execBuffer=(0,v_.deprecate)((function(){return this._transactions>0&&(this._transactions-=1),I_.apply(this,arguments)}),"Pipeline#execBuffer: Use Pipeline#exec instead"),__.prototype.exec=function(e){if(this.isCluster&&!this.redis.slots.length)return"wait"===this.redis.status&&this.redis.connect().catch(S_.noop),e&&!this.nodeifiedPromise&&(this.nodeifiedPromise=!0,(0,b_.default)(this.promise,e)),this.redis.delayUntilReady((t=>{t?this.reject(t):this.exec(e)})),this.promise;if(this._transactions>0)return this._transactions-=1,I_.apply(this,arguments);let t;if(this.nodeifiedPromise||(this.nodeifiedPromise=!0,(0,b_.default)(this.promise,e)),this._queue.length||this.resolve([]),this.isCluster){const e=[];for(let t=0;t<this._queue.length;t++){const n=this._queue[t].getKeys();if(n.length&&e.push(n[0]),n.length&&y_.generateMulti(n)<0)return this.reject(new Error("All the keys in a pipeline command should belong to the same slot")),this.promise}if(e.length){if(t=x_(this.redis,e),t<0)return this.reject(new Error("All keys in the pipeline should belong to the same slots allocation group")),this.promise}else t=16384*Math.random()|0}const n=this;return r(),this.promise;function r(){let e,r=n.replyPending=n._queue.length;n.isCluster&&(e={slot:t,redis:n.redis.connectionPool.nodes.all[n.preferKey]});let a,i="";const o={isPipeline:!0,destination:n.isCluster?e:{redis:n.redis},write(e){"string"!=typeof e?(a||(a=[]),i&&(a.push(Buffer.from(i,"utf8")),i=""),a.push(e)):i+=e,--r||(a?(i&&a.push(Buffer.from(i,"utf8")),o.destination.redis.stream.write(Buffer.concat(a))):o.destination.redis.stream.write(i),r=n._queue.length,i="",a=void 0)}};for(let t=0;t<n._queue.length;++t)n.redis.sendCommand(n._queue[t],o,e);return n.promise}},Object.defineProperty(e_,"__esModule",{value:!0}),e_.addTransactionSupport=void 0;const T_=GE,A_=EE,O_=t_;e_.addTransactionSupport=function(e){e.pipeline=function(e){const t=new O_.default(this);return Array.isArray(e)&&t.addBatch(e),t};const{multi:t}=e;e.multi=function(e,n){if(void 0!==n||Array.isArray(e)||(n=e,e=null),n&&!1===n.pipeline)return t.call(this);const r=new O_.default(this);r.multi(),Array.isArray(e)&&r.addBatch(e);const a=r.exec;r.exec=function(e){if(this.isCluster&&!this.redis.slots.length)return"wait"===this.redis.status&&this.redis.connect().catch(T_.noop),(0,A_.default)(new Promise(((e,t)=>{this.redis.delayUntilReady((n=>{n?t(n):this.exec(r).then(e,t)}))})),e);if(this._transactions>0&&a.call(r),this.nodeifiedPromise)return a.call(r);const t=a.call(r);return(0,A_.default)(t.then((function(e){const t=e[e.length-1];if(void 0===t)throw new Error("Pipeline cannot be used to send any commands when the `exec()` has been called on it.");if(t[0]){t[0].previousErrors=[];for(let n=0;n<e.length-1;++n)e[n][0]&&t[0].previousErrors.push(e[n][0]);throw t[0]}return(0,T_.wrapMultiResult)(t[1])})),e)};const{execBuffer:i}=r;return r.execBuffer=function(e){return this._transactions>0&&i.call(r),r.exec(e)},r};const{exec:n}=e;e.exec=function(e){return(0,A_.default)(n.call(this).then((function(e){return Array.isArray(e)&&(e=(0,T_.wrapMultiResult)(e)),e})),e)}};var K_={};Object.defineProperty(K_,"__esModule",{value:!0}),K_.default=function(e,t){Object.getOwnPropertyNames(t.prototype).forEach((n=>{Object.defineProperty(e.prototype,n,Object.getOwnPropertyDescriptor(t.prototype,n))}))};var C_={};Object.defineProperty(C_,"__esModule",{value:!0}),C_.DEFAULT_CLUSTER_OPTIONS=void 0;const R_=H.default;C_.DEFAULT_CLUSTER_OPTIONS={clusterRetryStrategy:e=>Math.min(100+2*e,2e3),enableOfflineQueue:!0,enableReadyCheck:!0,scaleReads:"master",maxRedirections:16,retryDelayOnMoved:0,retryDelayOnFailover:100,retryDelayOnClusterDown:100,retryDelayOnTryAgain:100,slotsRefreshTimeout:1e3,useSRVRecords:!1,resolveSrv:R_.resolveSrv,dnsLookup:R_.lookup,enableAutoPipelining:!1,autoPipeliningIgnoredCommands:[],shardedSubscribers:!1};var j_={},P_={};Object.defineProperty(P_,"__esModule",{value:!0}),P_.getConnectionName=P_.weightSrvRecords=P_.groupSrvRecords=P_.getUniqueHostnamesFromOptions=P_.normalizeNodeOptions=P_.nodeKeyToRedisOptions=P_.getNodeKey=void 0;const D_=GE,N_=z.default;P_.getNodeKey=function(e){return e.port=e.port||6379,e.host=e.host||"127.0.0.1",e.host+":"+e.port},P_.nodeKeyToRedisOptions=function(e){const t=e.lastIndexOf(":");if(-1===t)throw new Error(`Invalid node key ${e}`);return{host:e.slice(0,t),port:Number(e.slice(t+1))}},P_.normalizeNodeOptions=function(e){return e.map((e=>{const t={};if("object"==typeof e)Object.assign(t,e);else if("string"==typeof e)Object.assign(t,(0,D_.parseURL)(e));else{if("number"!=typeof e)throw new Error("Invalid argument "+e);t.port=e}return"string"==typeof t.port&&(t.port=parseInt(t.port,10)),delete t.db,t.port||(t.port=6379),t.host||(t.host="127.0.0.1"),(0,D_.resolveTLSProfile)(t)}))},P_.getUniqueHostnamesFromOptions=function(e){const t={};return e.forEach((e=>{t[e.host]=!0})),Object.keys(t).filter((e=>!(0,N_.isIP)(e)))},P_.groupSrvRecords=function(e){const t={};for(const n of e)t.hasOwnProperty(n.priority)?(t[n.priority].totalWeight+=n.weight,t[n.priority].records.push(n)):t[n.priority]={totalWeight:n.weight,records:[n]};return t},P_.weightSrvRecords=function(e){if(1===e.records.length)return e.totalWeight=0,e.records.shift();const t=Math.floor(Math.random()*(e.totalWeight+e.records.length));let n=0;for(const[r,a]of e.records.entries())if(n+=1+a.weight,n>t)return e.totalWeight-=a.weight,e.records.splice(r,1),a},P_.getConnectionName=function(e,t){const n=`ioredis-cluster(${e})`;return t?`${n}:${t}`:n},Object.defineProperty(j_,"__esModule",{value:!0});const L_=P_,M_=GE,F_=vE,B_=(0,M_.Debug)("cluster:subscriber");j_.default=class{constructor(e,t,n=!1){this.connectionPool=e,this.emitter=t,this.isSharded=n,this.started=!1,this.subscriber=null,this.slotRange=[],this.onSubscriberEnd=()=>{this.started?(B_("subscriber has disconnected, selecting a new one..."),this.selectSubscriber()):B_("subscriber has disconnected, but ClusterSubscriber is not started, so not reconnecting.")},this.connectionPool.on("-node",((e,t)=>{this.started&&this.subscriber&&(0,L_.getNodeKey)(this.subscriber.options)===t&&(B_("subscriber has left, selecting a new one..."),this.selectSubscriber())})),this.connectionPool.on("+node",(()=>{this.started&&!this.subscriber&&(B_("a new node is discovered and there is no subscriber, selecting a new one..."),this.selectSubscriber())}))}getInstance(){return this.subscriber}associateSlotRange(e){return this.isSharded&&(this.slotRange=e),this.slotRange}start(){this.started=!0,this.selectSubscriber(),B_("started")}stop(){this.started=!1,this.subscriber&&(this.subscriber.disconnect(),this.subscriber=null)}isStarted(){return this.started}selectSubscriber(){const e=this.lastActiveSubscriber;e&&(e.off("end",this.onSubscriberEnd),e.disconnect()),this.subscriber&&(this.subscriber.off("end",this.onSubscriberEnd),this.subscriber.disconnect());const t=(0,M_.sample)(this.connectionPool.getNodes());if(!t)return B_("selecting subscriber failed since there is no node discovered in the cluster yet"),void(this.subscriber=null);const{options:n}=t;B_("selected a subscriber %s:%s",n.host,n.port);let r="subscriber";this.isSharded&&(r="ssubscriber"),this.subscriber=new F_.default({port:n.port,host:n.host,username:n.username,password:n.password,enableReadyCheck:!0,connectionName:(0,L_.getConnectionName)(r,n.connectionName),lazyConnect:!0,tls:n.tls,retryStrategy:null}),this.subscriber.on("error",M_.noop),this.subscriber.once("end",this.onSubscriberEnd);const a={subscribe:[],psubscribe:[],ssubscribe:[]};if(e){const t=e.condition||e.prevCondition;t&&t.subscriber&&(a.subscribe=t.subscriber.channels("subscribe"),a.psubscribe=t.subscriber.channels("psubscribe"),a.ssubscribe=t.subscriber.channels("ssubscribe"))}if(a.subscribe.length||a.psubscribe.length||a.ssubscribe.length){let e=0;for(const t of["subscribe","psubscribe","ssubscribe"]){const n=a[t];n.length&&(e+=1,B_("%s %d channels",t,n.length),this.subscriber[t](n).then((()=>{--e||(this.lastActiveSubscriber=this.subscriber)})).catch((()=>{B_("failed to %s %d channels",t,n.length)})))}}else this.lastActiveSubscriber=this.subscriber;for(const e of["message","messageBuffer"])this.subscriber.on(e,((t,n)=>{this.emitter.emit(e,t,n)}));for(const e of["pmessage","pmessageBuffer"])this.subscriber.on(e,((t,n,r)=>{this.emitter.emit(e,t,n,r)}));if(1==this.isSharded)for(const e of["smessage","smessageBuffer"])this.subscriber.on(e,((t,n)=>{this.emitter.emit(e,t,n)}))}};var V_={};Object.defineProperty(V_,"__esModule",{value:!0});const U_=W.default,J_=GE,G_=P_,$_=vE,q_=(0,J_.Debug)("cluster:connectionPool");class z_ extends U_.EventEmitter{constructor(e){super(),this.redisOptions=e,this.nodes={all:{},master:{},slave:{}},this.specifiedOptions={}}getNodes(e="all"){const t=this.nodes[e];return Object.keys(t).map((e=>t[e]))}getInstanceByKey(e){return this.nodes.all[e]}getSampleInstance(e){const t=Object.keys(this.nodes[e]),n=(0,J_.sample)(t);return this.nodes[e][n]}addMasterNode(e){const t=(0,G_.getNodeKey)(e.options),n=this.createRedisFromOptions(e,e.options.readOnly);return!e.options.readOnly&&(this.nodes.all[t]=n,this.nodes.master[t]=n,!0)}createRedisFromOptions(e,t){return new $_.default((0,J_.defaults)({retryStrategy:null,enableOfflineQueue:!0,readOnly:t},e,this.redisOptions,{lazyConnect:!0}))}findOrCreate(e,t=!1){const n=(0,G_.getNodeKey)(e);let r;return t=Boolean(t),this.specifiedOptions[n]?Object.assign(e,this.specifiedOptions[n]):this.specifiedOptions[n]=e,this.nodes.all[n]?(r=this.nodes.all[n],r.options.readOnly!==t&&(r.options.readOnly=t,q_("Change role of %s to %s",n,t?"slave":"master"),r[t?"readonly":"readwrite"]().catch(J_.noop),t?(delete this.nodes.master[n],this.nodes.slave[n]=r):(delete this.nodes.slave[n],this.nodes.master[n]=r))):(q_("Connecting to %s as %s",n,t?"slave":"master"),r=this.createRedisFromOptions(e,t),this.nodes.all[n]=r,this.nodes[t?"slave":"master"][n]=r,r.once("end",(()=>{this.removeNode(n),this.emit("-node",r,n),Object.keys(this.nodes.all).length||this.emit("drain")})),this.emit("+node",r,n),r.on("error",(function(e){this.emit("nodeError",e,n)}))),r}reset(e){q_("Reset with %O",e);const t={};e.forEach((e=>{const n=(0,G_.getNodeKey)(e);e.readOnly&&t[n]||(t[n]=e)})),Object.keys(this.nodes.all).forEach((e=>{t[e]||(q_("Disconnect %s because the node does not hold any slot",e),this.nodes.all[e].disconnect(),this.removeNode(e))})),Object.keys(t).forEach((e=>{const n=t[e];this.findOrCreate(n,n.readOnly)}))}removeNode(e){const{nodes:t}=this;t.all[e]&&(q_("Remove %s from the pool",e),delete t.all[e]),delete t.master[e],delete t.slave[e]}}V_.default=z_;var W_={};function Y_(e,t){t=t||{};this._capacity=t.capacity,this._head=0,this._tail=0,Array.isArray(e)?this._fromArray(e):(this._capacityMask=3,this._list=new Array(4))}Y_.prototype.peekAt=function(e){var t=e;if(t===(0|t)){var n=this.size();if(!(t>=n||t<-n))return t<0&&(t+=n),t=this._head+t&this._capacityMask,this._list[t]}},Y_.prototype.get=function(e){return this.peekAt(e)},Y_.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},Y_.prototype.peekFront=function(){return this.peek()},Y_.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(Y_.prototype,"length",{get:function(){return this.size()}}),Y_.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},Y_.prototype.unshift=function(e){if(0===arguments.length)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},Y_.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}},Y_.prototype.push=function(e){if(0===arguments.length)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},Y_.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),n}},Y_.prototype.removeOne=function(e){var t=e;if(t===(0|t)&&this._head!==this._tail){var n=this.size(),r=this._list.length;if(!(t>=n||t<-n)){t<0&&(t+=n),t=this._head+t&this._capacityMask;var a,i=this._list[t];if(e<n/2){for(a=e;a>0;a--)this._list[t]=this._list[t=t-1+r&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+r&this._capacityMask}else{for(a=n-1-e;a>0;a--)this._list[t]=this._list[t=t+1+r&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+r&this._capacityMask}return i}}},Y_.prototype.remove=function(e,t){var n,r=e,a=t;if(r===(0|r)&&this._head!==this._tail){var i=this.size(),o=this._list.length;if(!(r>=i||r<-i||t<1)){if(r<0&&(r+=i),1===t||!t)return(n=new Array(1))[0]=this.removeOne(r),n;if(0===r&&r+t>=i)return n=this.toArray(),this.clear(),n;var s;for(r+t>i&&(t=i-r),n=new Array(t),s=0;s<t;s++)n[s]=this._list[this._head+r+s&this._capacityMask];if(r=this._head+r&this._capacityMask,e+t===i){for(this._tail=this._tail-t+o&this._capacityMask,s=t;s>0;s--)this._list[r=r+1+o&this._capacityMask]=void 0;return n}if(0===e){for(this._head=this._head+t+o&this._capacityMask,s=t-1;s>0;s--)this._list[r=r+1+o&this._capacityMask]=void 0;return n}if(r<i/2){for(this._head=this._head+e+t+o&this._capacityMask,s=e;s>0;s--)this.unshift(this._list[r=r-1+o&this._capacityMask]);for(r=this._head-1+o&this._capacityMask;a>0;)this._list[r=r-1+o&this._capacityMask]=void 0,a--;e<0&&(this._tail=r)}else{for(this._tail=r,r=r+t+o&this._capacityMask,s=i-(t+e);s>0;s--)this.push(this._list[r++]);for(r=this._tail;a>0;)this._list[r=r+1+o&this._capacityMask]=void 0,a--}return this._head<2&&this._tail>1e4&&this._tail<=o>>>2&&this._shrinkArray(),n}}},Y_.prototype.splice=function(e,t){var n=e;if(n===(0|n)){var r=this.size();if(n<0&&(n+=r),!(n>r)){if(arguments.length>2){var a,i,o,s=arguments.length,l=this._list.length,c=2;if(!r||n<r/2){for(i=new Array(n),a=0;a<n;a++)i[a]=this._list[this._head+a&this._capacityMask];for(0===t?(o=[],n>0&&(this._head=this._head+n+l&this._capacityMask)):(o=this.remove(n,t),this._head=this._head+n+l&this._capacityMask);s>c;)this.unshift(arguments[--s]);for(a=n;a>0;a--)this.unshift(i[a-1])}else{var u=(i=new Array(r-(n+t))).length;for(a=0;a<u;a++)i[a]=this._list[this._head+n+t+a&this._capacityMask];for(0===t?(o=[],n!=r&&(this._tail=this._head+n+l&this._capacityMask)):(o=this.remove(n,t),this._tail=this._tail-u+l&this._capacityMask);c<s;)this.push(arguments[c++]);for(a=0;a<u;a++)this.push(i[a])}return o}return this.remove(n,t)}}},Y_.prototype.clear=function(){this._list=new Array(this._list.length),this._head=0,this._tail=0},Y_.prototype.isEmpty=function(){return this._head===this._tail},Y_.prototype.toArray=function(){return this._copyArray(!1)},Y_.prototype._fromArray=function(e){var t=e.length,n=this._nextPowerOf2(t);this._list=new Array(n),this._capacityMask=n-1,this._tail=t;for(var r=0;r<t;r++)this._list[r]=e[r]},Y_.prototype._copyArray=function(e,t){var n=this._list,r=n.length,a=this.length;if((t|=a)==a&&this._head<this._tail)return this._list.slice(this._head,this._tail);var i,o=new Array(t),s=0;if(e||this._head>this._tail){for(i=this._head;i<r;i++)o[s++]=n[i];for(i=0;i<this._tail;i++)o[s++]=n[i]}else for(i=this._head;i<this._tail;i++)o[s++]=n[i];return o},Y_.prototype._growArray=function(){if(0!=this._head){var e=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=e}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1},Y_.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},Y_.prototype._nextPowerOf2=function(e){var t=1<<Math.log(e)/Math.log(2)+1;return Math.max(t,4)};var H_=Y_;Object.defineProperty(W_,"__esModule",{value:!0});const Q_=H_,Z_=(0,GE.Debug)("delayqueue");W_.default=class{constructor(){this.queues={},this.timeouts={}}push(e,t,n){const r=n.callback||process.nextTick;this.queues[e]||(this.queues[e]=new Q_);this.queues[e].push(t),this.timeouts[e]||(this.timeouts[e]=setTimeout((()=>{r((()=>{this.timeouts[e]=null,this.execute(e)}))}),n.timeout))}execute(e){const t=this.queues[e];if(!t)return;const{length:n}=t;if(n)for(Z_("send %d commands in %s queue",n,e),this.queues[e]=null;t.length>0;)t.shift()()}};var X_={};Object.defineProperty(X_,"__esModule",{value:!0});const ek=GE,tk=j_,nk=V_,rk=P_,ak=VE.exports,ik=(0,ek.Debug)("cluster:subscriberGroup");X_.default=class{constructor(e){this.cluster=e,this.shardedSubscribers=new Map,this.clusterSlots=[],this.subscriberToSlotsIndex=new Map,this.channels=new Map,e.on("+node",(e=>{this._addSubscriber(e)})),e.on("-node",(e=>{this._removeSubscriber(e)})),e.on("refresh",(()=>{this._refreshSlots(e)}))}getResponsibleSubscriber(e){const t=this.clusterSlots[e][0];return this.shardedSubscribers.get(t)}addChannels(e){const t=ak(e[0]);e.forEach((e=>{if(ak(e)!=t)return-1}));const n=this.channels.get(t);return n?this.channels.set(t,n.concat(e)):this.channels.set(t,e),[...this.channels.values()].flatMap((e=>e)).length}removeChannels(e){const t=ak(e[0]);e.forEach((e=>{if(ak(e)!=t)return-1}));const n=this.channels.get(t);if(n){const r=n.filter((t=>!e.includes(t)));this.channels.set(t,r)}return[...this.channels.values()].flatMap((e=>e)).length}stop(){for(const e of this.shardedSubscribers.values())e.stop()}start(){for(const e of this.shardedSubscribers.values())e.isStarted()||e.start()}_addSubscriber(e){const t=new nk.default(e.options);if(t.addMasterNode(e)){const n=new tk.default(t,this.cluster,!0),r=(0,rk.getNodeKey)(e.options);return this.shardedSubscribers.set(r,n),n.start(),this._resubscribe(),this.cluster.emit("+subscriber"),n}return null}_removeSubscriber(e){const t=(0,rk.getNodeKey)(e.options),n=this.shardedSubscribers.get(t);return n&&(n.stop(),this.shardedSubscribers.delete(t),this._resubscribe(),this.cluster.emit("-subscriber")),this.shardedSubscribers}_refreshSlots(e){if(!this._slotsAreEqual(e.slots)){ik("Refreshing the slots of the subscriber group."),this.subscriberToSlotsIndex=new Map;for(let t=0;t<e.slots.length;t++){const n=e.slots[t][0];this.subscriberToSlotsIndex.has(n)||this.subscriberToSlotsIndex.set(n,[]),this.subscriberToSlotsIndex.get(n).push(Number(t))}return this._resubscribe(),this.clusterSlots=JSON.parse(JSON.stringify(e.slots)),this.cluster.emit("subscribersReady"),!0}return ik("Nothing to refresh because the new cluster map is equal to the previous one."),!1}_resubscribe(){this.shardedSubscribers&&this.shardedSubscribers.forEach(((e,t)=>{const n=this.subscriberToSlotsIndex.get(t);n&&(e.associateSlotRange(n),n.forEach((t=>{const n=e.getInstance(),r=this.channels.get(t);r&&r.length>0&&n&&(n.ssubscribe(r),n.on("ready",(()=>{n.ssubscribe(r)})))})))}))}_slotsAreEqual(e){return void 0!==this.clusterSlots&&JSON.stringify(this.clusterSlots)===JSON.stringify(e)}},Object.defineProperty(IE,"__esModule",{value:!0});const ok=wE,sk=W.default,lk=FE,ck=EE,uk=BE,dk=Wx,pk=vE,hk=Qx,mk=e_,fk=GE,yk=K_,gk=n_,bk=C_,vk=j_,wk=V_,Sk=W_,Ek=P_,xk=H_,_k=X_,kk=(0,fk.Debug)("cluster"),Ik=new WeakSet;class Tk extends gk.default{constructor(e,t={}){if(super(),this.slots=[],this._groupsIds={},this._groupsBySlot=Array(16384),this.isCluster=!0,this.retryAttempts=0,this.delayQueue=new Sk.default,this.offlineQueue=new xk,this.isRefreshing=!1,this._refreshSlotsCacheCallbacks=[],this._autoPipelines=new Map,this._runningAutoPipelines=new Set,this._readyDelayedCallbacks=[],this.connectionEpoch=0,sk.EventEmitter.call(this),this.startupNodes=e,this.options=(0,fk.defaults)({},t,bk.DEFAULT_CLUSTER_OPTIONS,this.options),1==this.options.shardedSubscribers&&(this.shardedSubscribers=new _k.default(this)),this.options.redisOptions&&this.options.redisOptions.keyPrefix&&!this.options.keyPrefix&&(this.options.keyPrefix=this.options.redisOptions.keyPrefix),"function"!=typeof this.options.scaleReads&&-1===["all","master","slave"].indexOf(this.options.scaleReads))throw new Error('Invalid option scaleReads "'+this.options.scaleReads+'". Expected "all", "master", "slave" or a custom function');this.connectionPool=new wk.default(this.options.redisOptions),this.connectionPool.on("-node",((e,t)=>{this.emit("-node",e)})),this.connectionPool.on("+node",(e=>{this.emit("+node",e)})),this.connectionPool.on("drain",(()=>{this.setStatus("close")})),this.connectionPool.on("nodeError",((e,t)=>{this.emit("node error",e,t)})),this.subscriber=new vk.default(this.connectionPool,this),this.options.scripts&&Object.entries(this.options.scripts).forEach((([e,t])=>{this.defineCommand(e,t)})),this.options.lazyConnect?this.setStatus("wait"):this.connect().catch((e=>{kk("connecting failed: %s",e)}))}connect(){return new Promise(((e,t)=>{if("connecting"===this.status||"connect"===this.status||"ready"===this.status)return void t(new Error("Redis is already connecting/connected"));const n=++this.connectionEpoch;this.setStatus("connecting"),this.resolveStartupNodeHostnames().then((r=>{if(this.connectionEpoch!==n)return kk("discard connecting after resolving startup nodes because epoch not match: %d != %d",n,this.connectionEpoch),void t(new lk.RedisError("Connection is discarded because a new connection is made"));if("connecting"!==this.status)return kk("discard connecting after resolving startup nodes because the status changed to %s",this.status),void t(new lk.RedisError("Connection is aborted"));this.connectionPool.reset(r);const a=()=>{this.setStatus("ready"),this.retryAttempts=0,this.executeOfflineCommands(),this.resetNodesRefreshInterval(),e()};let i;const o=()=>{this.invokeReadyDelayedCallbacks(void 0),this.removeListener("close",i),this.manuallyClosing=!1,this.setStatus("connect"),this.options.enableReadyCheck?this.readyCheck(((e,t)=>{e||t?(kk("Ready check failed (%s). Reconnecting...",e||t),"connect"===this.status&&this.disconnect(!0)):a()})):a()};i=()=>{const e=new Error("None of startup nodes is available");this.removeListener("refresh",o),this.invokeReadyDelayedCallbacks(e),t(e)},this.once("refresh",o),this.once("close",i),this.once("close",this.handleCloseEvent.bind(this)),this.refreshSlotsCache((e=>{e&&e.message===dk.default.defaultMessage&&(pk.default.prototype.silentEmit.call(this,"error",e),this.connectionPool.reset([]))})),this.subscriber.start(),this.options.shardedSubscribers&&this.shardedSubscribers.start()})).catch((e=>{this.setStatus("close"),this.handleCloseEvent(e),this.invokeReadyDelayedCallbacks(e),t(e)}))}))}disconnect(e=!1){const t=this.status;this.setStatus("disconnecting"),e||(this.manuallyClosing=!0),this.reconnectTimeout&&!e&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null,kk("Canceled reconnecting attempts")),this.clearNodesRefreshInterval(),this.subscriber.stop(),this.options.shardedSubscribers&&this.shardedSubscribers.stop(),"wait"===t?(this.setStatus("close"),this.handleCloseEvent()):this.connectionPool.reset([])}quit(e){const t=this.status;if(this.setStatus("disconnecting"),this.manuallyClosing=!0,this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),this.clearNodesRefreshInterval(),this.subscriber.stop(),this.options.shardedSubscribers&&this.shardedSubscribers.stop(),"wait"===t){const t=(0,ck.default)(Promise.resolve("OK"),e);return setImmediate(function(){this.setStatus("close"),this.handleCloseEvent()}.bind(this)),t}return(0,ck.default)(Promise.all(this.nodes().map((e=>e.quit().catch((e=>{if(e.message===fk.CONNECTION_CLOSED_ERROR_MSG)return"OK";throw e}))))).then((()=>"OK")),e)}duplicate(e=[],t={}){const n=e.length>0?e:this.startupNodes.slice(0),r=Object.assign({},this.options,t);return new Tk(n,r)}nodes(e="all"){if("all"!==e&&"master"!==e&&"slave"!==e)throw new Error('Invalid role "'+e+'". Expected "all", "master" or "slave"');return this.connectionPool.getNodes(e)}delayUntilReady(e){this._readyDelayedCallbacks.push(e)}get autoPipelineQueueSize(){let e=0;for(const t of this._autoPipelines.values())e+=t.length;return e}refreshSlotsCache(e){if(e&&this._refreshSlotsCacheCallbacks.push(e),this.isRefreshing)return;this.isRefreshing=!0;const t=this,n=e=>{this.isRefreshing=!1;for(const t of this._refreshSlotsCacheCallbacks)t(e);this._refreshSlotsCacheCallbacks=[]},r=(0,fk.shuffle)(this.connectionPool.getNodes());let a=null;!function e(i){if(i===r.length){const e=new dk.default(dk.default.defaultMessage,a);return n(e)}const o=r[i],s=`${o.options.host}:${o.options.port}`;kk("getting slot cache from %s",s),t.getInfoFromNode(o,(function(r){switch(t.status){case"close":case"end":return n(new Error("Cluster is disconnected."));case"disconnecting":return n(new Error("Cluster is disconnecting."))}r?(t.emit("node error",r,s),a=r,e(i+1)):(t.emit("refresh"),n())}))}(0)}sendCommand(e,t,n){if("wait"===this.status&&this.connect().catch(fk.noop),"end"===this.status)return e.reject(new Error(fk.CONNECTION_CLOSED_ERROR_MSG)),e.promise;let r=this.options.scaleReads;if("master"!==r){e.isReadOnly||(0,ok.exists)(e.name)&&(0,ok.hasFlag)(e.name,"readonly")||(r="master")}let a=n?n.slot:e.getSlot();const i={},o=this;if(!n&&!Ik.has(e)){Ik.add(e);const t=e.reject;e.reject=function(n){const r=s.bind(null,!0);o.handleError(n,i,{moved:function(t,n){kk("command %s is moved to %s",e.name,n),a=Number(t),o.slots[t]?o.slots[t][0]=n:o.slots[t]=[n],o._groupsBySlot[t]=o._groupsIds[o.slots[t].join(";")],o.connectionPool.findOrCreate(o.natMapper(n)),s(),kk("refreshing slot caches... (triggered by MOVED error)"),o.refreshSlotsCache()},ask:function(t,n){kk("command %s is required to ask %s:%s",e.name,n);const r=o.natMapper(n);o.connectionPool.findOrCreate(r),s(!1,`${r.host}:${r.port}`)},tryagain:r,clusterDown:r,connectionClosed:r,maxRedirections:function(n){t.call(e,n)},defaults:function(){t.call(e,n)}})}}function s(i,s){if("end"===o.status)return void e.reject(new lk.AbortError("Cluster is ended."));let l;if("ready"===o.status||"cluster"===e.name){if(n&&n.redis)l=n.redis;else if(uk.default.checkFlag("ENTER_SUBSCRIBER_MODE",e.name)||uk.default.checkFlag("EXIT_SUBSCRIBER_MODE",e.name)){if(1!=o.options.shardedSubscribers||"ssubscribe"!=e.name&&"sunsubscribe"!=e.name)l=o.subscriber.getInstance();else{const t=o.shardedSubscribers.getResponsibleSubscriber(a);let n=-1;"ssubscribe"==e.name&&(n=o.shardedSubscribers.addChannels(e.getKeys())),"sunsubscribe"==e.name&&(n=o.shardedSubscribers.removeChannels(e.getKeys())),-1!==n?l=t.getInstance():e.reject(new lk.AbortError("Can't add or remove the given channels. Are they in the same slot?"))}if(!l)return void e.reject(new lk.AbortError("No subscriber for the cluster"))}else{if(!i){if("number"==typeof a&&o.slots[a]){const t=o.slots[a];if("function"==typeof r){const n=t.map((function(e){return o.connectionPool.getInstanceByKey(e)}));l=r(n,e),Array.isArray(l)&&(l=(0,fk.sample)(l)),l||(l=n[0])}else{let e;e="all"===r?(0,fk.sample)(t):"slave"===r&&t.length>1?(0,fk.sample)(t,1):t[0],l=o.connectionPool.getInstanceByKey(e)}}s&&(l=o.connectionPool.getInstanceByKey(s),l.asking())}l||(l=("function"==typeof r?null:o.connectionPool.getSampleInstance(r))||o.connectionPool.getSampleInstance("all"))}n&&!n.redis&&(n.redis=l)}l?l.sendCommand(e,t):o.options.enableOfflineQueue?o.offlineQueue.push({command:e,stream:t,node:n}):e.reject(new Error("Cluster isn't ready and enableOfflineQueue options is false"))}return s(),e.promise}sscanStream(e,t){return this.createScanStream("sscan",{key:e,options:t})}sscanBufferStream(e,t){return this.createScanStream("sscanBuffer",{key:e,options:t})}hscanStream(e,t){return this.createScanStream("hscan",{key:e,options:t})}hscanBufferStream(e,t){return this.createScanStream("hscanBuffer",{key:e,options:t})}zscanStream(e,t){return this.createScanStream("zscan",{key:e,options:t})}zscanBufferStream(e,t){return this.createScanStream("zscanBuffer",{key:e,options:t})}handleError(e,t,n){if(void 0===t.value?t.value=this.options.maxRedirections:t.value-=1,t.value<=0)return void n.maxRedirections(new Error("Too many Cluster redirections. Last error: "+e));const r=e.message.split(" ");if("MOVED"===r[0]){const e=this.options.retryDelayOnMoved;e&&"number"==typeof e?this.delayQueue.push("moved",n.moved.bind(null,r[1],r[2]),{timeout:e}):n.moved(r[1],r[2])}else"ASK"===r[0]?n.ask(r[1],r[2]):"TRYAGAIN"===r[0]?this.delayQueue.push("tryagain",n.tryagain,{timeout:this.options.retryDelayOnTryAgain}):"CLUSTERDOWN"===r[0]&&this.options.retryDelayOnClusterDown>0?this.delayQueue.push("clusterdown",n.connectionClosed,{timeout:this.options.retryDelayOnClusterDown,callback:this.refreshSlotsCache.bind(this)}):e.message===fk.CONNECTION_CLOSED_ERROR_MSG&&this.options.retryDelayOnFailover>0&&"ready"===this.status?this.delayQueue.push("failover",n.connectionClosed,{timeout:this.options.retryDelayOnFailover,callback:this.refreshSlotsCache.bind(this)}):n.defaults()}resetOfflineQueue(){this.offlineQueue=new xk}clearNodesRefreshInterval(){this.slotsTimer&&(clearTimeout(this.slotsTimer),this.slotsTimer=null)}resetNodesRefreshInterval(){if(this.slotsTimer||!this.options.slotsRefreshInterval)return;const e=()=>{this.slotsTimer=setTimeout((()=>{kk('refreshing slot caches... (triggered by "slotsRefreshInterval" option)'),this.refreshSlotsCache((()=>{e()}))}),this.options.slotsRefreshInterval)};e()}setStatus(e){kk("status: %s -> %s",this.status||"[empty]",e),this.status=e,process.nextTick((()=>{this.emit(e)}))}handleCloseEvent(e){let t;e&&kk("closed because %s",e),this.manuallyClosing||"function"!=typeof this.options.clusterRetryStrategy||(t=this.options.clusterRetryStrategy.call(this,++this.retryAttempts,e)),"number"==typeof t?(this.setStatus("reconnecting"),this.reconnectTimeout=setTimeout((()=>{this.reconnectTimeout=null,kk("Cluster is disconnected. Retrying after %dms",t),this.connect().catch((function(e){kk("Got error %s when reconnecting. Ignoring...",e)}))}),t)):(this.setStatus("end"),this.flushQueue(new Error("None of startup nodes is available")))}flushQueue(e){let t;for(;t=this.offlineQueue.shift();)t.command.reject(e)}executeOfflineCommands(){if(this.offlineQueue.length){kk("send %d commands in offline queue",this.offlineQueue.length);const e=this.offlineQueue;let t;for(this.resetOfflineQueue();t=e.shift();)this.sendCommand(t.command,t.stream,t.node)}}natMapper(e){const t="string"==typeof e?e:`${e.host}:${e.port}`;let n=null;return this.options.natMap&&"function"==typeof this.options.natMap?n=this.options.natMap(t):this.options.natMap&&"object"==typeof this.options.natMap&&(n=this.options.natMap[t]),n?(kk("NAT mapping %s -> %O",t,n),Object.assign({},n)):"string"==typeof e?(0,Ek.nodeKeyToRedisOptions)(e):e}getInfoFromNode(e,t){if(!e)return t(new Error("Node is disconnected"));const n=e.duplicate({enableOfflineQueue:!0,enableReadyCheck:!1,retryStrategy:null,connectionName:(0,Ek.getConnectionName)("refresher",this.options.redisOptions&&this.options.redisOptions.connectionName)});n.on("error",fk.noop),n.cluster("SLOTS",(0,fk.timeout)(((e,r)=>{if(n.disconnect(),e)return kk("error encountered running CLUSTER.SLOTS: %s",e),t(e);if("disconnecting"===this.status||"close"===this.status||"end"===this.status)return kk("ignore CLUSTER.SLOTS results (count: %d) since cluster status is %s",r.length,this.status),void t();const a=[];kk("cluster slots result count: %d",r.length);for(let e=0;e<r.length;++e){const t=r[e],n=t[0],i=t[1],o=[];for(let e=2;e<t.length;e++){if(!t[e][0])continue;const n=this.natMapper({host:t[e][0],port:t[e][1]});n.readOnly=2!==e,a.push(n),o.push(n.host+":"+n.port)}kk("cluster slots result [%d]: slots %d~%d served by %s",e,n,i,o);for(let e=n;e<=i;e++)this.slots[e]=o}this._groupsIds=Object.create(null);let i=0;for(let e=0;e<16384;e++){const t=(this.slots[e]||[]).join(";");t.length?(this._groupsIds[t]||(this._groupsIds[t]=++i),this._groupsBySlot[e]=this._groupsIds[t]):this._groupsBySlot[e]=void 0}this.connectionPool.reset(a),t()}),this.options.slotsRefreshTimeout))}invokeReadyDelayedCallbacks(e){for(const t of this._readyDelayedCallbacks)process.nextTick(t,e);this._readyDelayedCallbacks=[]}readyCheck(e){this.cluster("INFO",((t,n)=>{if(t)return e(t);if("string"!=typeof n)return e();let r;const a=n.split("\r\n");for(let e=0;e<a.length;++e){const t=a[e].split(":");if("cluster_state"===t[0]){r=t[1];break}}"fail"===r?(kk("cluster state not ok (%s)",r),e(null,r)):e()}))}resolveSrv(e){return new Promise(((t,n)=>{this.options.resolveSrv(e,((e,r)=>{if(e)return n(e);const a=this,i=(0,Ek.groupSrvRecords)(r),o=Object.keys(i).sort(((e,t)=>parseInt(e)-parseInt(t)));!function e(r){if(!o.length)return n(r);const s=o[0],l=i[s],c=(0,Ek.weightSrvRecords)(l);l.records.length||o.shift(),a.dnsLookup(c.name).then((e=>t({host:e,port:c.port})),e)}()}))}))}dnsLookup(e){return new Promise(((t,n)=>{this.options.dnsLookup(e,((r,a)=>{r?(kk("failed to resolve hostname %s to IP: %s",e,r.message),n(r)):(kk("resolved hostname %s to IP %s",e,a),t(a))}))}))}async resolveStartupNodeHostnames(){if(!Array.isArray(this.startupNodes)||0===this.startupNodes.length)throw new Error("`startupNodes` should contain at least one node.");const e=(0,Ek.normalizeNodeOptions)(this.startupNodes),t=(0,Ek.getUniqueHostnamesFromOptions)(e);if(0===t.length)return e;const n=await Promise.all(t.map((this.options.useSRVRecords?this.resolveSrv:this.dnsLookup).bind(this))),r=(0,fk.zipMap)(t,n);return e.map((e=>{const t=r.get(e.host);return t?this.options.useSRVRecords?Object.assign({},e,t):Object.assign({},e,{host:t}):e}))}createScanStream(e,{key:t,options:n={}}){return new hk.default({objectMode:!0,key:t,redis:this,command:e,...n})}}(0,yk.default)(Tk,sk.EventEmitter),(0,mk.addTransactionSupport)(Tk.prototype),IE.default=Tk;var Ak={},Ok={},Kk={};Object.defineProperty(Kk,"__esModule",{value:!0});const Ck=(0,GE.Debug)("AbstractConnector");Kk.default=class{constructor(e){this.connecting=!1,this.disconnectTimeout=e}check(e){return!0}disconnect(){if(this.connecting=!1,this.stream){const e=this.stream,t=setTimeout((()=>{Ck("stream %s:%s still open, destroying it",e.remoteAddress,e.remotePort),e.destroy()}),this.disconnectTimeout);e.on("close",(()=>clearTimeout(t))),e.end()}}},Object.defineProperty(Ok,"__esModule",{value:!0});const Rk=z.default,jk=Q.default,Pk=GE,Dk=Kk;class Nk extends Dk.default{constructor(e){super(e.disconnectTimeout),this.options=e}connect(e){const{options:t}=this;let n;return this.connecting=!0,"path"in t&&t.path?n={path:t.path}:(n={},"port"in t&&null!=t.port&&(n.port=t.port),"host"in t&&null!=t.host&&(n.host=t.host),"family"in t&&null!=t.family&&(n.family=t.family)),t.tls&&Object.assign(n,t.tls),new Promise(((e,r)=>{process.nextTick((()=>{if(this.connecting){try{t.tls?this.stream=(0,jk.connect)(n):this.stream=(0,Rk.createConnection)(n)}catch(e){return void r(e)}this.stream.once("error",(e=>{this.firstError=e})),e(this.stream)}else r(new Error(Pk.CONNECTION_CLOSED_ERROR_MSG))}))}))}}Ok.default=Nk;var Lk={},Mk={};Object.defineProperty(Mk,"__esModule",{value:!0});Mk.default=class{constructor(e){this.cursor=0,this.sentinels=e.slice(0)}next(){const e=this.cursor>=this.sentinels.length;return{done:e,value:e?void 0:this.sentinels[this.cursor++]}}reset(e){e&&this.sentinels.length>1&&1!==this.cursor&&this.sentinels.unshift(...this.sentinels.splice(this.cursor-1)),this.cursor=0}add(e){for(let r=0;r<this.sentinels.length;r++)if(t=e,n=this.sentinels[r],(t.host||"127.0.0.1")===(n.host||"127.0.0.1")&&(t.port||26379)===(n.port||26379))return!1;var t,n;return this.sentinels.push(e),!0}toString(){return`${JSON.stringify(this.sentinels)} @${this.cursor}`}};var Fk={};Object.defineProperty(Fk,"__esModule",{value:!0}),Fk.FailoverDetector=void 0;const Bk=(0,GE.Debug)("FailoverDetector");Fk.FailoverDetector=class{constructor(e,t){this.isDisconnected=!1,this.connector=e,this.sentinels=t}cleanup(){this.isDisconnected=!0;for(const e of this.sentinels)e.client.disconnect()}async subscribe(){Bk("Starting FailoverDetector");const e=[];for(const t of this.sentinels){const n=t.client.subscribe("+switch-master").catch((e=>{Bk("Failed to subscribe to failover messages on sentinel %s:%s (%s)",t.address.host||"127.0.0.1",t.address.port||26739,e.message)}));e.push(n),t.client.on("message",(e=>{this.isDisconnected||"+switch-master"!==e||this.disconnect()}))}await Promise.all(e)}disconnect(){this.isDisconnected=!0,Bk("Failover detected, disconnecting"),this.connector.disconnect()}},Object.defineProperty(Lk,"__esModule",{value:!0}),Lk.SentinelIterator=void 0;const Vk=z.default,Uk=GE,Jk=Q.default,Gk=Mk;Lk.SentinelIterator=Gk.default;const $k=Kk,qk=vE,zk=Fk,Wk=(0,Uk.Debug)("SentinelConnector");class Yk extends $k.default{constructor(e){if(super(e.disconnectTimeout),this.options=e,this.emitter=null,this.failoverDetector=null,!this.options.sentinels.length)throw new Error("Requires at least one sentinel to connect to.");if(!this.options.name)throw new Error("Requires the name of master.");this.sentinelIterator=new Gk.default(this.options.sentinels)}check(e){const t=!e.role||this.options.role===e.role;return t||(Wk("role invalid, expected %s, but got %s",this.options.role,e.role),this.sentinelIterator.next(),this.sentinelIterator.next(),this.sentinelIterator.reset(!0)),t}disconnect(){super.disconnect(),this.failoverDetector&&this.failoverDetector.cleanup()}connect(e){let t;this.connecting=!0,this.retryAttempts=0;const n=async()=>{const r=this.sentinelIterator.next();if(r.done){this.sentinelIterator.reset(!1);const r="function"==typeof this.options.sentinelRetryStrategy?this.options.sentinelRetryStrategy(++this.retryAttempts):null;let a="number"!=typeof r?"All sentinels are unreachable and retry is disabled.":`All sentinels are unreachable. Retrying from scratch after ${r}ms.`;t&&(a+=` Last error: ${t.message}`),Wk(a);const i=new Error(a);if("number"==typeof r)return e("error",i),await new Promise((e=>setTimeout(e,r))),n();throw i}let a=null,i=null;try{a=await this.resolve(r.value)}catch(e){i=e}if(!this.connecting)throw new Error(Uk.CONNECTION_CLOSED_ERROR_MSG);const o=r.value.host+":"+r.value.port;if(a)return Wk("resolved: %s:%s from sentinel %s",a.host,a.port,o),this.options.enableTLSForSentinelMode&&this.options.tls?(Object.assign(a,this.options.tls),this.stream=(0,Jk.connect)(a),this.stream.once("secureConnect",this.initFailoverDetector.bind(this))):(this.stream=(0,Vk.createConnection)(a),this.stream.once("connect",this.initFailoverDetector.bind(this))),this.stream.once("error",(e=>{this.firstError=e})),this.stream;{const r=i?"failed to connect to sentinel "+o+" because "+i.message:"connected to sentinel "+o+" successfully, but got an invalid reply: "+a;return Wk(r),e("sentinelError",new Error(r)),i&&(t=i),n()}};return n()}async updateSentinels(e){if(!this.options.updateSentinels)return;const t=await e.sentinel("sentinels",this.options.name);Array.isArray(t)&&(t.map(Uk.packObject).forEach((e=>{if(-1===(e.flags?e.flags.split(","):[]).indexOf("disconnected")&&e.ip&&e.port){const t=this.sentinelNatResolve(Hk(e));this.sentinelIterator.add(t)&&Wk("adding sentinel %s:%s",t.host,t.port)}})),Wk("Updated internal sentinels: %s",this.sentinelIterator))}async resolveMaster(e){const t=await e.sentinel("get-master-addr-by-name",this.options.name);return await this.updateSentinels(e),this.sentinelNatResolve(Array.isArray(t)?{host:t[0],port:Number(t[1])}:null)}async resolveSlave(e){const t=await e.sentinel("slaves",this.options.name);if(!Array.isArray(t))return null;const n=t.map(Uk.packObject).filter((e=>e.flags&&!e.flags.match(/(disconnected|s_down|o_down)/)));return this.sentinelNatResolve(function(e,t){if(0===e.length)return null;let n;if("function"==typeof t)n=t(e);else if(null!==t&&"object"==typeof t){const r=Array.isArray(t)?t:[t];r.sort(((e,t)=>(e.prio||(e.prio=1),t.prio||(t.prio=1),e.prio<t.prio?-1:e.prio>t.prio?1:0)));for(let t=0;t<r.length;t++){for(let a=0;a<e.length;a++){const i=e[a];if(i.ip===r[t].ip&&i.port===r[t].port){n=i;break}}if(n)break}}n||(n=(0,Uk.sample)(e));return Hk(n)}(n,this.options.preferredSlaves))}sentinelNatResolve(e){if(!e||!this.options.natMap)return e;const t=`${e.host}:${e.port}`;let n=e;return"function"==typeof this.options.natMap?n=this.options.natMap(t)||e:"object"==typeof this.options.natMap&&(n=this.options.natMap[t]||e),n}connectToSentinel(e,t){return new qk.default({port:e.port||26379,host:e.host,username:this.options.sentinelUsername||null,password:this.options.sentinelPassword||null,family:e.family||("path"in this.options&&this.options.path?void 0:this.options.family),tls:this.options.sentinelTLS,retryStrategy:null,enableReadyCheck:!1,connectTimeout:this.options.connectTimeout,commandTimeout:this.options.sentinelCommandTimeout,...t})}async resolve(e){const t=this.connectToSentinel(e);t.on("error",Qk);try{return"slave"===this.options.role?await this.resolveSlave(t):await this.resolveMaster(t)}finally{t.disconnect()}}async initFailoverDetector(){var e;if(!this.options.failoverDetector)return;this.sentinelIterator.reset(!0);const t=[];for(;t.length<this.options.sentinelMaxConnections;){const{done:e,value:n}=this.sentinelIterator.next();if(e)break;const r=this.connectToSentinel(n,{lazyConnect:!0,retryStrategy:this.options.sentinelReconnectStrategy});r.on("reconnecting",(()=>{var e;null===(e=this.emitter)||void 0===e||e.emit("sentinelReconnecting")})),t.push({address:n,client:r})}this.sentinelIterator.reset(!1),this.failoverDetector&&this.failoverDetector.cleanup(),this.failoverDetector=new zk.FailoverDetector(this,t),await this.failoverDetector.subscribe(),null===(e=this.emitter)||void 0===e||e.emit("failoverSubscribed")}}function Hk(e){return{host:e.ip,port:Number(e.port)}}function Qk(){}Lk.default=Yk,Object.defineProperty(Ak,"__esModule",{value:!0}),Ak.SentinelConnector=Ak.StandaloneConnector=void 0;const Zk=Ok;Ak.StandaloneConnector=Zk.default;const Xk=Lk;Ak.SentinelConnector=Xk.default;var eI={},tI={},nI={};Object.defineProperty(nI,"__esModule",{value:!0});const rI=FE;nI.default=class extends rI.AbortError{constructor(e){super(`Reached the max retries per request limit (which is ${e}). Refer to "maxRetriesPerRequest" option for details.`),Error.captureStackTrace(this,this.constructor)}get name(){return this.constructor.name}},Object.defineProperty(tI,"__esModule",{value:!0}),tI.MaxRetriesPerRequestError=void 0;const aI=nI;tI.MaxRetriesPerRequestError=aI.default;var iI={};const oI=q.default.Buffer,sI=new(0,Z.default.StringDecoder),lI=FE.ReplyError,cI=FE.ParserError;var uI=oI.allocUnsafe(32768),dI=0,pI=null,hI=0,mI=0;function fI(e){const t=e.offset,n=e.buffer,r=n.length-1;for(var a=t;a<r;)if(13===n[a++])return e.offset=a+1,!0===e.optionReturnBuffers?e.buffer.slice(t,a-1):e.buffer.toString("utf8",t,a-1)}function yI(e){const t=e.buffer.length-1;for(var n=e.offset,r=0;n<t;){const t=e.buffer[n++];if(13===t)return e.offset=n+1,r;r=10*r+(t-48)}}function gI(e,t,n){e.arrayCache.push(t),e.arrayPos.push(n)}function bI(e){const t=e.arrayCache.pop();var n=e.arrayPos.pop();if(e.arrayCache.length){const r=bI(e);if(void 0===r)return void gI(e,t,n);t[n++]=r}return vI(e,t,n)}function vI(e,t,n){const r=e.buffer.length;for(;n<t.length;){const a=e.offset;if(e.offset>=r)return void gI(e,t,n);const i=wI(e,e.buffer[e.offset++]);if(void 0===i)return e.arrayCache.length||e.bufferCache.length||(e.offset=a),void gI(e,t,n);t[n]=i,n++}return t}function wI(e,t){switch(t){case 36:return function(e){const t=yI(e);if(void 0===t)return;if(t<0)return null;const n=e.offset+t;if(n+2>e.buffer.length)return e.bigStrSize=n+2,e.totalChunkSize=e.buffer.length,void e.bufferCache.push(e.buffer);const r=e.offset;return e.offset=n+2,!0===e.optionReturnBuffers?e.buffer.slice(r,n):e.buffer.toString("utf8",r,n)}(e);case 43:return fI(e);case 42:return function(e){const t=yI(e);if(void 0===t)return;return t<0?null:vI(e,new Array(t),0)}(e);case 58:return function(e){return!0===e.optionStringNumbers?function(e){const t=e.buffer.length-1;var n=e.offset,r=0,a="";for(45===e.buffer[n]&&(a+="-",n++);n<t;){var i=e.buffer[n++];if(13===i)return e.offset=n+1,0!==r&&(a+=r),a;r>429496728?(a+=10*r+(i-48),r=0):48===i&&0===r?a+=0:r=10*r+(i-48)}}(e):function(e){const t=e.buffer.length-1;var n=e.offset,r=0,a=1;for(45===e.buffer[n]&&(a=-1,n++);n<t;){const t=e.buffer[n++];if(13===t)return e.offset=n+1,a*r;r=10*r+(t-48)}}(e)}(e);case 45:return function(e){var t=fI(e);if(void 0!==t)return!0===e.optionReturnBuffers&&(t=t.toString()),new lI(t)}(e);default:return function(e,t){const n=new cI("Protocol error, got "+JSON.stringify(String.fromCharCode(t))+" as reply type byte",JSON.stringify(e.buffer),e.offset);e.buffer=null,e.returnFatalError(n)}(e,t)}}function SI(){if(uI.length>51200)if(1===hI||mI>2*hI){const e=Math.floor(uI.length/10),t=e<dI?dI:e;dI=0,uI=uI.slice(t,uI.length)}else mI++,hI--;else clearInterval(pI),hI=0,mI=0,pI=null}function EI(e){const t=e.bufferCache,n=e.offset,r=e.bigStrSize-n-2;var a=t.length,i=e.bigStrSize-e.totalChunkSize;if(e.offset=i,i<=2){if(2===a)return t[0].slice(n,t[0].length+i-2);a--,i=t[t.length-2].length+i}!function(e){if(uI.length<e+dI){const t=e>78643200?2:3;dI>116391936&&(dI=52428800),uI=oI.allocUnsafe(e*t+dI),dI=0,hI++,null===pI&&(pI=setInterval(SI,50))}}(r);const o=dI;t[0].copy(uI,o,n,t[0].length),dI+=t[0].length-n;for(var s=1;s<a-1;s++)t[s].copy(uI,dI),dI+=t[s].length;return t[s].copy(uI,dI,0,i-2),dI+=i-2,uI.slice(o,dI)}var xI=class{constructor(e){if(!e)throw new TypeError("Options are mandatory.");if("function"!=typeof e.returnError||"function"!=typeof e.returnReply)throw new TypeError("The returnReply and returnError options have to be functions.");this.setReturnBuffers(!!e.returnBuffers),this.setStringNumbers(!!e.stringNumbers),this.returnError=e.returnError,this.returnFatalError=e.returnFatalError||e.returnError,this.returnReply=e.returnReply,this.reset()}reset(){this.offset=0,this.buffer=null,this.bigStrSize=0,this.totalChunkSize=0,this.bufferCache=[],this.arrayCache=[],this.arrayPos=[]}setReturnBuffers(e){if("boolean"!=typeof e)throw new TypeError("The returnBuffers argument has to be a boolean");this.optionReturnBuffers=e}setStringNumbers(e){if("boolean"!=typeof e)throw new TypeError("The stringNumbers argument has to be a boolean");this.optionStringNumbers=e}execute(e){if(null===this.buffer)this.buffer=e,this.offset=0;else if(0===this.bigStrSize){const t=this.buffer.length,n=t-this.offset,r=oI.allocUnsafe(n+e.length);if(this.buffer.copy(r,0,this.offset,t),e.copy(r,n,0,e.length),this.buffer=r,this.offset=0,this.arrayCache.length){const e=bI(this);if(void 0===e)return;this.returnReply(e)}}else{if(!(this.totalChunkSize+e.length>=this.bigStrSize))return this.bufferCache.push(e),void(this.totalChunkSize+=e.length);this.bufferCache.push(e);var t=this.optionReturnBuffers?EI(this):function(e){const t=e.bufferCache,n=e.offset;var r=t.length,a=e.bigStrSize-e.totalChunkSize;if(e.offset=a,a<=2){if(2===r)return t[0].toString("utf8",n,t[0].length+a-2);r--,a=t[t.length-2].length+a}for(var i=sI.write(t[0].slice(n)),o=1;o<r-1;o++)i+=sI.write(t[o]);return i+sI.end(t[o].slice(0,a-2))}(this);if(this.bigStrSize=0,this.bufferCache=[],this.buffer=e,this.arrayCache.length&&(this.arrayCache[0][this.arrayPos[0]++]=t,void 0===(t=bI(this))))return;this.returnReply(t)}for(;this.offset<this.buffer.length;){const e=this.offset,t=this.buffer[this.offset++],n=wI(this,t);if(void 0===n)return void(this.arrayCache.length||this.bufferCache.length||(this.offset=e));45===t?this.returnError(n):this.returnReply(n)}this.buffer=null}},_I=xI,kI={};Object.defineProperty(kI,"__esModule",{value:!0});function II(e){return"unsubscribe"===e?"subscribe":"punsubscribe"===e?"psubscribe":"sunsubscribe"===e?"ssubscribe":e}kI.default=class{constructor(){this.set={subscribe:{},psubscribe:{},ssubscribe:{}}}add(e,t){this.set[II(e)][t]=!0}del(e,t){delete this.set[II(e)][t]}channels(e){return Object.keys(this.set[II(e)])}isEmpty(){return 0===this.channels("subscribe").length&&0===this.channels("psubscribe").length&&0===this.channels("ssubscribe").length}},Object.defineProperty(iI,"__esModule",{value:!0});const TI=BE,AI=_I,OI=kI,KI=(0,GE.Debug)("dataHandler");iI.default=class{constructor(e,t){this.redis=e;const n=new AI({stringNumbers:t.stringNumbers,returnBuffers:!0,returnError:e=>{this.returnError(e)},returnFatalError:e=>{this.returnFatalError(e)},returnReply:e=>{this.returnReply(e)}});e.stream.prependListener("data",(e=>{n.execute(e)})),e.stream.resume()}returnFatalError(e){e.message+=". Please report this.",this.redis.recoverFromFatalError(e,e,{offlineQueue:!1})}returnError(e){const t=this.shiftCommand(e);t&&(e.command={name:t.command.name,args:t.command.args},this.redis.handleReconnection(e,t))}returnReply(e){if(this.handleMonitorReply(e))return;if(this.handleSubscriberReply(e))return;const t=this.shiftCommand(e);t&&(TI.default.checkFlag("ENTER_SUBSCRIBER_MODE",t.command.name)?(this.redis.condition.subscriber=new OI.default,this.redis.condition.subscriber.add(t.command.name,e[1].toString()),RI(t.command,e[2])||this.redis.commandQueue.unshift(t)):TI.default.checkFlag("EXIT_SUBSCRIBER_MODE",t.command.name)?jI(t.command,e[2])||this.redis.commandQueue.unshift(t):t.command.resolve(e))}handleSubscriberReply(e){if(!this.redis.condition.subscriber)return!1;const t=Array.isArray(e)?e[0].toString():null;switch(KI('receive reply "%s" in subscriber mode',t),t){case"message":this.redis.listeners("message").length>0&&this.redis.emit("message",e[1].toString(),e[2]?e[2].toString():""),this.redis.emit("messageBuffer",e[1],e[2]);break;case"pmessage":{const t=e[1].toString();this.redis.listeners("pmessage").length>0&&this.redis.emit("pmessage",t,e[2].toString(),e[3].toString()),this.redis.emit("pmessageBuffer",t,e[2],e[3]);break}case"smessage":this.redis.listeners("smessage").length>0&&this.redis.emit("smessage",e[1].toString(),e[2]?e[2].toString():""),this.redis.emit("smessageBuffer",e[1],e[2]);break;case"ssubscribe":case"subscribe":case"psubscribe":{const n=e[1].toString();this.redis.condition.subscriber.add(t,n);const r=this.shiftCommand(e);if(!r)return;RI(r.command,e[2])||this.redis.commandQueue.unshift(r);break}case"sunsubscribe":case"unsubscribe":case"punsubscribe":{const n=e[1]?e[1].toString():null;n&&this.redis.condition.subscriber.del(t,n);const r=e[2];0===Number(r)&&(this.redis.condition.subscriber=!1);const a=this.shiftCommand(e);if(!a)return;jI(a.command,r)||this.redis.commandQueue.unshift(a);break}default:{const t=this.shiftCommand(e);if(!t)return;t.command.resolve(e)}}return!0}handleMonitorReply(e){if("monitoring"!==this.redis.status)return!1;const t=e.toString();if("OK"===t)return!1;const n=t.indexOf(" "),r=t.slice(0,n),a=t.indexOf('"'),i=t.slice(a+1,-1).split('" "').map((e=>e.replace(/\\"/g,'"'))),o=t.slice(n+2,a-2).split(" ");return this.redis.emit("monitor",r,i,o[1],o[0]),!0}shiftCommand(e){const t=this.redis.commandQueue.shift();if(!t){const t=new Error("Command queue state error. If you can reproduce this, please report it."+(e instanceof Error?` Last error: ${e.message}`:` Last reply: ${e.toString()}`));return this.redis.emit("error",t),null}return t}};const CI=new WeakMap;function RI(e,t){let n=CI.has(e)?CI.get(e):e.args.length;return n-=1,n<=0?(e.resolve(t),CI.delete(e),!0):(CI.set(e,n),!1)}function jI(e,t){let n=CI.has(e)?CI.get(e):e.args.length;return 0===n?0===Number(t)&&(CI.delete(e),e.resolve(t),!0):(n-=1,n<=0?(e.resolve(t),!0):(CI.set(e,n),!1))}!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.readyHandler=e.errorHandler=e.closeHandler=e.connectHandler=void 0;const t=FE,n=BE,r=tI,a=GE,i=iI,o=(0,a.Debug)("connection");function s(e){const n=new t.AbortError("Command aborted due to connection close");return n.command={name:e.name,args:e.args},n}e.connectHandler=function(t){return function(){t.setStatus("connect"),t.resetCommandQueue();let n=!1;const{connectionEpoch:r}=t;t.condition.auth&&t.auth(t.condition.auth,(function(e){r===t.connectionEpoch&&e&&(-1!==e.message.indexOf("no password is set")?console.warn("[WARN] Redis server does not require a password, but a password was supplied."):-1!==e.message.indexOf("without any password configured for the default user")?console.warn("[WARN] This Redis server's `default` user does not require a password, but a password was supplied"):-1!==e.message.indexOf("wrong number of arguments for 'auth' command")?console.warn("[ERROR] The server returned \"wrong number of arguments for 'auth' command\". You are probably passing both username and password to Redis version 5 or below. You should only pass the 'password' option for Redis version 5 and under."):(n=!0,t.recoverFromFatalError(e,e)))})),t.condition.select&&t.select(t.condition.select).catch((e=>{t.silentEmit("error",e)})),t.options.enableReadyCheck||e.readyHandler(t)(),new i.default(t,{stringNumbers:t.options.stringNumbers}),t.options.enableReadyCheck&&t._readyCheck((function(a,i){r===t.connectionEpoch&&(a?n||t.recoverFromFatalError(new Error("Ready check failed: "+a.message),a):t.connector.check(i)?e.readyHandler(t)():t.disconnect(!0))}))}},e.closeHandler=function(e){return function(){const n=e.status;if(e.setStatus("close"),e.commandQueue.length&&function(e){var t;let n=0;for(let r=0;r<e.length;){const a=null===(t=e.peekAt(r))||void 0===t?void 0:t.command,i=a.pipelineIndex;void 0!==i&&0!==i||(n=0),void 0===i||i===n++?r++:(e.remove(r,1),a.reject(s(a)))}}(e.commandQueue),e.offlineQueue.length&&function(e){var t;for(let n=0;n<e.length;){const r=null===(t=e.peekAt(n))||void 0===t?void 0:t.command;if("multi"===r.name)break;if("exec"===r.name){e.remove(n,1),r.reject(s(r));break}r.inTransaction?(e.remove(n,1),r.reject(s(r))):n++}}(e.offlineQueue),"ready"===n&&(e.prevCondition||(e.prevCondition=e.condition),e.commandQueue.length&&(e.prevCommandQueue=e.commandQueue)),e.manuallyClosing)return e.manuallyClosing=!1,o("skip reconnecting since the connection is manually closed."),t();if("function"!=typeof e.options.retryStrategy)return o("skip reconnecting because `retryStrategy` is not a function"),t();const i=e.options.retryStrategy(++e.retryAttempts);if("number"!=typeof i)return o("skip reconnecting because `retryStrategy` doesn't return a number"),t();o("reconnect in %sms",i),e.setStatus("reconnecting",i),e.reconnectTimeout=setTimeout((function(){e.reconnectTimeout=null,e.connect().catch(a.noop)}),i);const{maxRetriesPerRequest:l}=e.options;if("number"==typeof l)if(l<0)o("maxRetriesPerRequest is negative, ignoring...");else{0===e.retryAttempts%(l+1)&&(o("reach maxRetriesPerRequest limitation, flushing command queue..."),e.flushQueue(new r.MaxRetriesPerRequestError(l)))}};function t(){e.setStatus("end"),e.flushQueue(new Error(a.CONNECTION_CLOSED_ERROR_MSG))}},e.errorHandler=function(e){return function(t){o("error: %s",t),e.silentEmit("error",t)}},e.readyHandler=function(e){return function(){if(e.setStatus("ready"),e.retryAttempts=0,e.options.monitor){e.call("monitor").then((()=>e.setStatus("monitoring")),(t=>e.emit("error",t)));const{sendCommand:t}=e;return e.sendCommand=function(r){return n.default.checkFlag("VALID_IN_MONITOR_MODE",r.name)?t.call(e,r):(r.reject(new Error("Connection is in monitoring mode, can't process commands.")),r.promise)},void e.once("close",(function(){delete e.sendCommand}))}const t=e.prevCondition?e.prevCondition.select:e.condition.select;if(e.options.connectionName&&(o("set the connection name [%s]",e.options.connectionName),e.client("setname",e.options.connectionName).catch(a.noop)),e.options.readOnly&&(o("set the connection to readonly mode"),e.readonly().catch(a.noop)),e.prevCondition){const n=e.prevCondition;if(e.prevCondition=null,n.subscriber&&e.options.autoResubscribe){e.condition.select!==t&&(o("connect to db [%d]",t),e.select(t));const r=n.subscriber.channels("subscribe");r.length&&(o("subscribe %d channels",r.length),e.subscribe(r));const a=n.subscriber.channels("psubscribe");a.length&&(o("psubscribe %d channels",a.length),e.psubscribe(a));const i=n.subscriber.channels("ssubscribe");i.length&&(o("ssubscribe %d channels",i.length),e.ssubscribe(i))}}if(e.prevCommandQueue)if(e.options.autoResendUnfulfilledCommands)for(o("resend %d unfulfilled commands",e.prevCommandQueue.length);e.prevCommandQueue.length>0;){const t=e.prevCommandQueue.shift();t.select!==e.condition.select&&"select"!==t.command.name&&e.select(t.select),e.sendCommand(t.command,t.stream)}else e.prevCommandQueue=null;if(e.offlineQueue.length){o("send %d commands in offline queue",e.offlineQueue.length);const t=e.offlineQueue;for(e.resetOfflineQueue();t.length>0;){const n=t.shift();n.select!==e.condition.select&&"select"!==n.command.name&&e.select(n.select),e.sendCommand(n.command,n.stream)}}e.condition.select!==t&&(o("connect to db [%d]",t),e.select(t))}}}(eI);var PI={};Object.defineProperty(PI,"__esModule",{value:!0}),PI.DEFAULT_REDIS_OPTIONS=void 0,PI.DEFAULT_REDIS_OPTIONS={port:6379,host:"localhost",family:4,connectTimeout:1e4,disconnectTimeout:2e3,retryStrategy:function(e){return Math.min(50*e,2e3)},keepAlive:0,noDelay:!0,connectionName:null,sentinels:null,name:null,role:"master",sentinelRetryStrategy:function(e){return Math.min(10*e,1e3)},sentinelReconnectStrategy:function(){return 6e4},natMap:null,enableTLSForSentinelMode:!1,updateSentinels:!0,failoverDetector:!1,username:null,password:null,db:0,enableOfflineQueue:!0,enableReadyCheck:!0,autoResubscribe:!0,autoResendUnfulfilledCommands:!0,lazyConnect:!1,keyPrefix:"",reconnectOnError:null,readOnly:!1,stringNumbers:!1,maxRetriesPerRequest:20,maxLoadingRetryTime:1e4,enableAutoPipelining:!1,autoPipeliningIgnoredCommands:[],sentinelMaxConnections:10},Object.defineProperty(vE,"__esModule",{value:!0});const DI=wE,NI=W.default,LI=EE,MI=IE,FI=BE,BI=Ak,VI=Lk,UI=eI,JI=PI,GI=Qx,$I=e_,qI=GE,zI=K_,WI=n_,YI=$E,HI=H_,QI=(0,qI.Debug)("redis");class ZI extends WI.default{constructor(e,t,n){if(super(),this.status="wait",this.isCluster=!1,this.reconnectTimeout=null,this.connectionEpoch=0,this.retryAttempts=0,this.manuallyClosing=!1,this._autoPipelines=new Map,this._runningAutoPipelines=new Set,this.parseOptions(e,t,n),NI.EventEmitter.call(this),this.resetCommandQueue(),this.resetOfflineQueue(),this.options.Connector)this.connector=new this.options.Connector(this.options);else if(this.options.sentinels){const e=new VI.default(this.options);e.emitter=this,this.connector=e}else this.connector=new BI.StandaloneConnector(this.options);this.options.scripts&&Object.entries(this.options.scripts).forEach((([e,t])=>{this.defineCommand(e,t)})),this.options.lazyConnect?this.setStatus("wait"):this.connect().catch(YI.noop)}static createClient(...e){return new ZI(...e)}get autoPipelineQueueSize(){let e=0;for(const t of this._autoPipelines.values())e+=t.length;return e}connect(e){const t=new Promise(((e,t)=>{if("connecting"===this.status||"connect"===this.status||"ready"===this.status)return void t(new Error("Redis is already connecting/connected"));this.connectionEpoch+=1,this.setStatus("connecting");const{options:n}=this;this.condition={select:n.db,auth:n.username?[n.username,n.password]:n.password,subscriber:!1};const r=this;(0,LI.default)(this.connector.connect((function(e,t){r.silentEmit(e,t)})),(function(a,i){if(a)return r.flushQueue(a),r.silentEmit("error",a),t(a),void r.setStatus("end");let o=n.tls?"secureConnect":"connect";if("sentinels"in n&&n.sentinels&&!n.enableTLSForSentinelMode&&(o="connect"),r.stream=i,n.noDelay&&i.setNoDelay(!0),"number"==typeof n.keepAlive&&(i.connecting?i.once(o,(()=>{i.setKeepAlive(!0,n.keepAlive)})):i.setKeepAlive(!0,n.keepAlive)),i.connecting){if(i.once(o,UI.connectHandler(r)),n.connectTimeout){let e=!1;i.setTimeout(n.connectTimeout,(function(){if(e)return;i.setTimeout(0),i.destroy();const t=new Error("connect ETIMEDOUT");t.errorno="ETIMEDOUT",t.code="ETIMEDOUT",t.syscall="connect",UI.errorHandler(r)(t)})),i.once(o,(function(){e=!0,i.setTimeout(0)}))}}else if(i.destroyed){const e=r.connector.firstError;e&&process.nextTick((()=>{UI.errorHandler(r)(e)})),process.nextTick(UI.closeHandler(r))}else process.nextTick(UI.connectHandler(r));i.destroyed||(i.once("error",UI.errorHandler(r)),i.once("close",UI.closeHandler(r)));const s=function(){r.removeListener("close",l),e()};var l=function(){r.removeListener("ready",s),t(new Error(qI.CONNECTION_CLOSED_ERROR_MSG))};r.once("ready",s),r.once("close",l)}))}));return(0,LI.default)(t,e)}disconnect(e=!1){e||(this.manuallyClosing=!0),this.reconnectTimeout&&!e&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null),"wait"===this.status?UI.closeHandler(this)():this.connector.disconnect()}end(){this.disconnect()}duplicate(e){return new ZI({...this.options,...e})}get mode(){var e;return this.options.monitor?"monitor":(null===(e=this.condition)||void 0===e?void 0:e.subscriber)?"subscriber":"normal"}monitor(e){const t=this.duplicate({monitor:!0,lazyConnect:!1});return(0,LI.default)(new Promise((function(e,n){t.once("error",n),t.once("monitoring",(function(){e(t)}))})),e)}sendCommand(e,t){var n,r;if("wait"===this.status&&this.connect().catch(YI.noop),"end"===this.status)return e.reject(new Error(qI.CONNECTION_CLOSED_ERROR_MSG)),e.promise;if((null===(n=this.condition)||void 0===n?void 0:n.subscriber)&&!FI.default.checkFlag("VALID_IN_SUBSCRIBER_MODE",e.name))return e.reject(new Error("Connection in subscriber mode, only subscriber commands may be used")),e.promise;"number"==typeof this.options.commandTimeout&&e.setTimeout(this.options.commandTimeout);let a="ready"===this.status||!t&&"connect"===this.status&&(0,DI.exists)(e.name)&&(0,DI.hasFlag)(e.name,"loading");if(this.stream&&this.stream.writable?this.stream._writableState&&this.stream._writableState.ended&&(a=!1):a=!1,a)QI.enabled&&QI("write command[%s]: %d -> %s(%o)",this._getDescription(),null===(r=this.condition)||void 0===r?void 0:r.select,e.name,e.args),t?"isPipeline"in t&&t.isPipeline?t.write(e.toWritable(t.destination.redis.stream)):t.write(e.toWritable(t)):this.stream.write(e.toWritable(this.stream)),this.commandQueue.push({command:e,stream:t,select:this.condition.select}),FI.default.checkFlag("WILL_DISCONNECT",e.name)&&(this.manuallyClosing=!0),void 0!==this.options.socketTimeout&&void 0===this.socketTimeoutTimer&&this.setSocketTimeout();else{if(!this.options.enableOfflineQueue)return e.reject(new Error("Stream isn't writeable and enableOfflineQueue options is false")),e.promise;if("quit"===e.name&&0===this.offlineQueue.length)return this.disconnect(),e.resolve(Buffer.from("OK")),e.promise;QI.enabled&&QI("queue command[%s]: %d -> %s(%o)",this._getDescription(),this.condition.select,e.name,e.args),this.offlineQueue.push({command:e,stream:t,select:this.condition.select})}if("select"===e.name&&(0,qI.isInt)(e.args[0])){const t=parseInt(e.args[0],10);this.condition.select!==t&&(this.condition.select=t,this.emit("select",t),QI("switch to db [%d]",this.condition.select))}return e.promise}setSocketTimeout(){this.socketTimeoutTimer=setTimeout((()=>{this.stream.destroy(new Error(`Socket timeout. Expecting data, but didn't receive any in ${this.options.socketTimeout}ms.`)),this.socketTimeoutTimer=void 0}),this.options.socketTimeout),this.stream.once("data",(()=>{clearTimeout(this.socketTimeoutTimer),this.socketTimeoutTimer=void 0,0!==this.commandQueue.length&&this.setSocketTimeout()}))}scanStream(e){return this.createScanStream("scan",{options:e})}scanBufferStream(e){return this.createScanStream("scanBuffer",{options:e})}sscanStream(e,t){return this.createScanStream("sscan",{key:e,options:t})}sscanBufferStream(e,t){return this.createScanStream("sscanBuffer",{key:e,options:t})}hscanStream(e,t){return this.createScanStream("hscan",{key:e,options:t})}hscanBufferStream(e,t){return this.createScanStream("hscanBuffer",{key:e,options:t})}zscanStream(e,t){return this.createScanStream("zscan",{key:e,options:t})}zscanBufferStream(e,t){return this.createScanStream("zscanBuffer",{key:e,options:t})}silentEmit(e,t){let n;if("error"===e){if(n=t,"end"===this.status)return;if(this.manuallyClosing&&n instanceof Error&&(n.message===qI.CONNECTION_CLOSED_ERROR_MSG||"connect"===n.syscall||"read"===n.syscall))return}return this.listeners(e).length>0?this.emit.apply(this,arguments):(n&&n instanceof Error&&console.error("[ioredis] Unhandled error event:",n.stack),!1)}recoverFromFatalError(e,t,n){this.flushQueue(t,n),this.silentEmit("error",t),this.disconnect(!0)}handleReconnection(e,t){var n;let r=!1;switch(this.options.reconnectOnError&&(r=this.options.reconnectOnError(e)),r){case 1:case!0:"reconnecting"!==this.status&&this.disconnect(!0),t.command.reject(e);break;case 2:"reconnecting"!==this.status&&this.disconnect(!0),(null===(n=this.condition)||void 0===n?void 0:n.select)!==t.select&&"select"!==t.command.name&&this.select(t.select),this.sendCommand(t.command);break;default:t.command.reject(e)}}_getDescription(){let e;return e="path"in this.options&&this.options.path?this.options.path:this.stream&&this.stream.remoteAddress&&this.stream.remotePort?this.stream.remoteAddress+":"+this.stream.remotePort:"host"in this.options&&this.options.host?this.options.host+":"+this.options.port:"",this.options.connectionName&&(e+=` (${this.options.connectionName})`),e}resetCommandQueue(){this.commandQueue=new HI}resetOfflineQueue(){this.offlineQueue=new HI}parseOptions(...e){const t={};let n=!1;for(let r=0;r<e.length;++r){const a=e[r];if(null!=a)if("object"==typeof a)(0,YI.defaults)(t,a);else if("string"==typeof a)(0,YI.defaults)(t,(0,qI.parseURL)(a)),a.startsWith("rediss://")&&(n=!0);else{if("number"!=typeof a)throw new Error("Invalid argument "+a);t.port=a}}n&&(0,YI.defaults)(t,{tls:!0}),(0,YI.defaults)(t,ZI.defaultOptions),"string"==typeof t.port&&(t.port=parseInt(t.port,10)),"string"==typeof t.db&&(t.db=parseInt(t.db,10)),this.options=(0,qI.resolveTLSProfile)(t)}setStatus(e,t){QI.enabled&&QI("status[%s]: %s -> %s",this._getDescription(),this.status||"[empty]",e),this.status=e,process.nextTick(this.emit.bind(this,e,t))}createScanStream(e,{key:t,options:n={}}){return new GI.default({objectMode:!0,key:t,redis:this,command:e,...n})}flushQueue(e,t){let n;if((t=(0,YI.defaults)({},t,{offlineQueue:!0,commandQueue:!0})).offlineQueue)for(;n=this.offlineQueue.shift();)n.command.reject(e);if(t.commandQueue&&this.commandQueue.length>0)for(this.stream&&this.stream.removeAllListeners("data");n=this.commandQueue.shift();)n.command.reject(e)}_readyCheck(e){const t=this;this.info((function(n,r){if(n)return n.message&&n.message.includes("NOPERM")?(console.warn(`Skipping the ready check because INFO command fails: "${n.message}". You can disable ready check with "enableReadyCheck". More: https://github.com/luin/ioredis/wiki/Disable-ready-check.`),e(null,{})):e(n);if("string"!=typeof r)return e(null,r);const a={},i=r.split("\r\n");for(let e=0;e<i.length;++e){const[t,...n]=i[e].split(":"),r=n.join(":");r&&(a[t]=r)}if(a.loading&&"0"!==a.loading){const n=1e3*(a.loading_eta_seconds||1),r=t.options.maxLoadingRetryTime&&t.options.maxLoadingRetryTime<n?t.options.maxLoadingRetryTime:n;QI("Redis server still loading, trying again in "+r+"ms"),setTimeout((function(){t._readyCheck(e)}),r)}else e(null,a)})).catch(YI.noop)}}ZI.Cluster=MI.default,ZI.Command=FI.default,ZI.defaultOptions=JI.DEFAULT_REDIS_OPTIONS,(0,zI.default)(ZI,NI.EventEmitter),(0,$I.addTransactionSupport)(ZI.prototype),vE.default=ZI,function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.print=t.ReplyError=t.SentinelIterator=t.SentinelConnector=t.AbstractConnector=t.Pipeline=t.ScanStream=t.Command=t.Cluster=t.Redis=t.default=void 0,t=e.exports=vE.default;var n=vE;Object.defineProperty(t,"default",{enumerable:!0,get:function(){return n.default}});var r=vE;Object.defineProperty(t,"Redis",{enumerable:!0,get:function(){return r.default}});var a=IE;Object.defineProperty(t,"Cluster",{enumerable:!0,get:function(){return a.default}});var i=BE;Object.defineProperty(t,"Command",{enumerable:!0,get:function(){return i.default}});var o=Qx;Object.defineProperty(t,"ScanStream",{enumerable:!0,get:function(){return o.default}});var s=t_;Object.defineProperty(t,"Pipeline",{enumerable:!0,get:function(){return s.default}});var l=Kk;Object.defineProperty(t,"AbstractConnector",{enumerable:!0,get:function(){return l.default}});var c=Lk;Object.defineProperty(t,"SentinelConnector",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"SentinelIterator",{enumerable:!0,get:function(){return c.SentinelIterator}}),t.ReplyError=FE.ReplyError,Object.defineProperty(t,"Promise",{get:()=>(console.warn("ioredis v5 does not support plugging third-party Promise library anymore. Native Promise will be used."),Promise),set(e){console.warn("ioredis v5 does not support plugging third-party Promise library anymore. Native Promise will be used.")}}),t.print=function(e,t){e?console.log("Error: "+e):console.log("Reply: "+t)}}(bE,bE.exports);var XI,eT,tT,nT=ee(bE.exports);try{XI=new TextDecoder}catch(e){}var rT,aT,iT,oT,sT,lT=0,cT={},uT=0,dT=0,pT=[],hT={useRecords:!1,mapsAsObjects:!0};class mT{}const fT=new mT;fT.name="MessagePack 0xC1";var yT=!1,gT=2;try{new Function("")}catch(e){gT=1/0}class bT{constructor(e){e&&(!1===e.useRecords&&void 0===e.mapsAsObjects&&(e.mapsAsObjects=!0),e.sequential&&!1!==e.trusted&&(e.trusted=!0,e.structures||0==e.useRecords||(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,t){if(eT)return zT((()=>(WT(),this?this.unpack(e,t):bT.prototype.unpack.call(hT,e,t))));e.buffer||e.constructor!==ArrayBuffer||(e="undefined"!=typeof Buffer?Buffer.from(e):new Uint8Array(e)),"object"==typeof t?(tT=t.end||e.length,lT=t.start||0):(lT=0,tT=t>-1?t:e.length),dT=0,aT=null,iT=null,eT=e;try{sT=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(t){if(eT=null,e instanceof Uint8Array)throw t;throw new Error("Source must be a Uint8Array or Buffer but was a "+(e&&"object"==typeof e?e.constructor.name:typeof e))}if(this instanceof bT){if(cT=this,this.structures)return rT=this.structures,vT(t);(!rT||rT.length>0)&&(rT=[])}else cT=hT,(!rT||rT.length>0)&&(rT=[]);return vT(t)}unpackMultiple(e,t){let n,r=0;try{yT=!0;let a=e.length,i=this?this.unpack(e,a):HT.unpack(e,a);if(!t){for(n=[i];lT<a;)r=lT,n.push(vT());return n}if(!1===t(i,r,lT))return;for(;lT<a;)if(r=lT,!1===t(vT(),r,lT))return}catch(e){throw e.lastPosition=r,e.values=n,e}finally{yT=!1,WT()}}_mergeStructures(e,t){e=e||[],Object.isFrozen(e)&&(e=e.map((e=>e.slice(0))));for(let t=0,n=e.length;t<n;t++){let n=e[t];n&&(n.isShared=!0,t>=32&&(n.highByte=t-32>>5))}e.sharedLength=e.length;for(let n in t||[])if(n>=0){let r=e[n],a=t[n];a&&(r&&((e.restoreStructures||(e.restoreStructures=[]))[n]=r),e[n]=a)}return this.structures=e}decode(e,t){return this.unpack(e,t)}}function vT(e){try{if(!cT.trusted&&!yT){let e=rT.sharedLength||0;e<rT.length&&(rT.length=e)}let e;if(cT.randomAccessStructure&&eT[lT]<64&&eT[lT],e=ST(),iT&&(lT=iT.postBundlePosition,iT=null),yT&&(rT.restoreStructures=null),lT==tT)rT&&rT.restoreStructures&&wT(),rT=null,eT=null,oT&&(oT=null);else{if(lT>tT)throw new Error("Unexpected end of MessagePack data");if(!yT){let t;try{t=JSON.stringify(e,((e,t)=>"bigint"==typeof t?`${t}n`:t)).slice(0,100)}catch(e){t="(JSON view not available "+e+")"}throw new Error("Data read, but end of buffer not reached "+t)}}return e}catch(e){throw rT&&rT.restoreStructures&&wT(),WT(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||lT>tT)&&(e.incomplete=!0),e}}function wT(){for(let e in rT.restoreStructures)rT[e]=rT.restoreStructures[e];rT.restoreStructures=null}function ST(){let e=eT[lT++];if(e<160){if(e<128){if(e<64)return e;{let t=rT[63&e]||cT.getStructures&&kT()[63&e];return t?(t.read||(t.read=xT(t,63&e)),t.read()):e}}if(e<144){if(e-=128,cT.mapsAsObjects){let t={};for(let n=0;n<e;n++){let e=BT();"__proto__"===e&&(e="__proto_"),t[e]=ST()}return t}{let t=new Map;for(let n=0;n<e;n++)t.set(ST(),ST());return t}}{e-=144;let t=new Array(e);for(let n=0;n<e;n++)t[n]=ST();return cT.freezeData?Object.freeze(t):t}}if(e<192){let t=e-160;if(dT>=lT)return aT.slice(lT-uT,(lT+=t)-uT);if(0==dT&&tT<140){let e=t<16?DT(t):PT(t);if(null!=e)return e}return IT(t)}{let t;switch(e){case 192:return null;case 193:return iT?(t=ST(),t>0?iT[1].slice(iT.position1,iT.position1+=t):iT[0].slice(iT.position0,iT.position0-=t)):fT;case 194:return!1;case 195:return!0;case 196:if(t=eT[lT++],void 0===t)throw new Error("Unexpected end of buffer");return LT(t);case 197:return t=sT.getUint16(lT),lT+=2,LT(t);case 198:return t=sT.getUint32(lT),lT+=4,LT(t);case 199:return MT(eT[lT++]);case 200:return t=sT.getUint16(lT),lT+=2,MT(t);case 201:return t=sT.getUint32(lT),lT+=4,MT(t);case 202:if(t=sT.getFloat32(lT),cT.useFloat32>2){let e=YT[(127&eT[lT])<<1|eT[lT+1]>>7];return lT+=4,(e*t+(t>0?.5:-.5)>>0)/e}return lT+=4,t;case 203:return t=sT.getFloat64(lT),lT+=8,t;case 204:return eT[lT++];case 205:return t=sT.getUint16(lT),lT+=2,t;case 206:return t=sT.getUint32(lT),lT+=4,t;case 207:return"number"===cT.int64AsType?(t=4294967296*sT.getUint32(lT),t+=sT.getUint32(lT+4)):"string"===cT.int64AsType?t=sT.getBigUint64(lT).toString():"auto"===cT.int64AsType?(t=sT.getBigUint64(lT),t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=sT.getBigUint64(lT),lT+=8,t;case 208:return sT.getInt8(lT++);case 209:return t=sT.getInt16(lT),lT+=2,t;case 210:return t=sT.getInt32(lT),lT+=4,t;case 211:return"number"===cT.int64AsType?(t=4294967296*sT.getInt32(lT),t+=sT.getUint32(lT+4)):"string"===cT.int64AsType?t=sT.getBigInt64(lT).toString():"auto"===cT.int64AsType?(t=sT.getBigInt64(lT),t>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t))):t=sT.getBigInt64(lT),lT+=8,t;case 212:if(t=eT[lT++],114==t)return UT(63&eT[lT++]);{let e=pT[t];if(e)return e.read?(lT++,e.read(ST())):e.noBuffer?(lT++,e()):e(eT.subarray(lT,++lT));throw new Error("Unknown extension "+t)}case 213:return t=eT[lT],114==t?(lT++,UT(63&eT[lT++],eT[lT++])):MT(2);case 214:return MT(4);case 215:return MT(8);case 216:return MT(16);case 217:return t=eT[lT++],dT>=lT?aT.slice(lT-uT,(lT+=t)-uT):TT(t);case 218:return t=sT.getUint16(lT),dT>=(lT+=2)?aT.slice(lT-uT,(lT+=t)-uT):AT(t);case 219:return t=sT.getUint32(lT),dT>=(lT+=4)?aT.slice(lT-uT,(lT+=t)-uT):OT(t);case 220:return t=sT.getUint16(lT),lT+=2,CT(t);case 221:return t=sT.getUint32(lT),lT+=4,CT(t);case 222:return t=sT.getUint16(lT),lT+=2,RT(t);case 223:return t=sT.getUint32(lT),lT+=4,RT(t);default:if(e>=224)return e-256;if(void 0===e){let e=new Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}throw new Error("Unknown MessagePack token "+e)}}}const ET=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function xT(e,t){function n(){if(n.count++>gT){let n=e.read=new Function("r","return function(){return "+(cT.freezeData?"Object.freeze":"")+"({"+e.map((e=>"__proto__"===e?"__proto_:r()":ET.test(e)?e+":r()":"["+JSON.stringify(e)+"]:r()")).join(",")+"})}")(ST);return 0===e.highByte&&(e.read=_T(t,e.read)),n()}let r={};for(let t=0,n=e.length;t<n;t++){let n=e[t];"__proto__"===n&&(n="__proto_"),r[n]=ST()}return cT.freezeData?Object.freeze(r):r}return n.count=0,0===e.highByte?_T(t,n):n}const _T=(e,t)=>function(){let n=eT[lT++];if(0===n)return t();let r=e<32?-(e+(n<<5)):e+(n<<5),a=rT[r]||kT()[r];if(!a)throw new Error("Record id is not defined for "+r);return a.read||(a.read=xT(a,e)),a.read()};function kT(){let e=zT((()=>(eT=null,cT.getStructures())));return rT=cT._mergeStructures(e,rT)}var IT=KT,TT=KT,AT=KT,OT=KT;function KT(e){let t;if(e<16&&(t=DT(e)))return t;if(e>64&&XI)return XI.decode(eT.subarray(lT,lT+=e));const n=lT+e,r=[];for(t="";lT<n;){const e=eT[lT++];if(0==(128&e))r.push(e);else if(192==(224&e)){const t=63&eT[lT++];r.push((31&e)<<6|t)}else if(224==(240&e)){const t=63&eT[lT++],n=63&eT[lT++];r.push((31&e)<<12|t<<6|n)}else if(240==(248&e)){let t=(7&e)<<18|(63&eT[lT++])<<12|(63&eT[lT++])<<6|63&eT[lT++];t>65535&&(t-=65536,r.push(t>>>10&1023|55296),t=56320|1023&t),r.push(t)}else r.push(e);r.length>=4096&&(t+=jT.apply(String,r),r.length=0)}return r.length>0&&(t+=jT.apply(String,r)),t}function CT(e){let t=new Array(e);for(let n=0;n<e;n++)t[n]=ST();return cT.freezeData?Object.freeze(t):t}function RT(e){if(cT.mapsAsObjects){let t={};for(let n=0;n<e;n++){let e=BT();"__proto__"===e&&(e="__proto_"),t[e]=ST()}return t}{let t=new Map;for(let n=0;n<e;n++)t.set(ST(),ST());return t}}var jT=String.fromCharCode;function PT(e){let t=lT,n=new Array(e);for(let r=0;r<e;r++){const e=eT[lT++];if((128&e)>0)return void(lT=t);n[r]=e}return jT.apply(String,n)}function DT(e){if(e<4){if(e<2){if(0===e)return"";{let e=eT[lT++];return(128&e)>1?void(lT-=1):jT(e)}}{let t=eT[lT++],n=eT[lT++];if((128&t)>0||(128&n)>0)return void(lT-=2);if(e<3)return jT(t,n);let r=eT[lT++];return(128&r)>0?void(lT-=3):jT(t,n,r)}}{let t=eT[lT++],n=eT[lT++],r=eT[lT++],a=eT[lT++];if((128&t)>0||(128&n)>0||(128&r)>0||(128&a)>0)return void(lT-=4);if(e<6){if(4===e)return jT(t,n,r,a);{let e=eT[lT++];return(128&e)>0?void(lT-=5):jT(t,n,r,a,e)}}if(e<8){let i=eT[lT++],o=eT[lT++];if((128&i)>0||(128&o)>0)return void(lT-=6);if(e<7)return jT(t,n,r,a,i,o);let s=eT[lT++];return(128&s)>0?void(lT-=7):jT(t,n,r,a,i,o,s)}{let i=eT[lT++],o=eT[lT++],s=eT[lT++],l=eT[lT++];if((128&i)>0||(128&o)>0||(128&s)>0||(128&l)>0)return void(lT-=8);if(e<10){if(8===e)return jT(t,n,r,a,i,o,s,l);{let e=eT[lT++];return(128&e)>0?void(lT-=9):jT(t,n,r,a,i,o,s,l,e)}}if(e<12){let c=eT[lT++],u=eT[lT++];if((128&c)>0||(128&u)>0)return void(lT-=10);if(e<11)return jT(t,n,r,a,i,o,s,l,c,u);let d=eT[lT++];return(128&d)>0?void(lT-=11):jT(t,n,r,a,i,o,s,l,c,u,d)}{let c=eT[lT++],u=eT[lT++],d=eT[lT++],p=eT[lT++];if((128&c)>0||(128&u)>0||(128&d)>0||(128&p)>0)return void(lT-=12);if(e<14){if(12===e)return jT(t,n,r,a,i,o,s,l,c,u,d,p);{let e=eT[lT++];return(128&e)>0?void(lT-=13):jT(t,n,r,a,i,o,s,l,c,u,d,p,e)}}{let h=eT[lT++],m=eT[lT++];if((128&h)>0||(128&m)>0)return void(lT-=14);if(e<15)return jT(t,n,r,a,i,o,s,l,c,u,d,p,h,m);let f=eT[lT++];return(128&f)>0?void(lT-=15):jT(t,n,r,a,i,o,s,l,c,u,d,p,h,m,f)}}}}}function NT(){let e,t=eT[lT++];if(t<192)e=t-160;else switch(t){case 217:e=eT[lT++];break;case 218:e=sT.getUint16(lT),lT+=2;break;case 219:e=sT.getUint32(lT),lT+=4;break;default:throw new Error("Expected string")}return KT(e)}function LT(e){return cT.copyBuffers?Uint8Array.prototype.slice.call(eT,lT,lT+=e):eT.subarray(lT,lT+=e)}function MT(e){let t=eT[lT++];if(pT[t]){let n;return pT[t](eT.subarray(lT,n=lT+=e),(e=>{lT=e;try{return ST()}finally{lT=n}}))}throw new Error("Unknown extension type "+t)}var FT=new Array(4096);function BT(){let e=eT[lT++];if(!(e>=160&&e<192))return lT--,VT(ST());if(e-=160,dT>=lT)return aT.slice(lT-uT,(lT+=e)-uT);if(!(0==dT&&tT<180))return IT(e);let t,n=4095&(e<<5^(e>1?sT.getUint16(lT):e>0?eT[lT]:0)),r=FT[n],a=lT,i=lT+e-3,o=0;if(r&&r.bytes==e){for(;a<i;){if(t=sT.getUint32(a),t!=r[o++]){a=1879048192;break}a+=4}for(i+=3;a<i;)if(t=eT[a++],t!=r[o++]){a=1879048192;break}if(a===i)return lT=a,r.string;i-=3,a=lT}for(r=[],FT[n]=r,r.bytes=e;a<i;)t=sT.getUint32(a),r.push(t),a+=4;for(i+=3;a<i;)t=eT[a++],r.push(t);let s=e<16?DT(e):PT(e);return r.string=null!=s?s:IT(e)}function VT(e){if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e||"bigint"==typeof e)return e.toString();if(null==e)return e+"";if(cT.allowArraysInMapKeys&&Array.isArray(e)&&e.flat().every((e=>["string","number","boolean","bigint"].includes(typeof e))))return e.flat().toString();throw new Error("Invalid property type for record: "+typeof e)}const UT=(e,t)=>{let n=ST().map(VT),r=e;void 0!==t&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let a=rT[e];return a&&(a.isShared||yT)&&((rT.restoreStructures||(rT.restoreStructures=[]))[e]=a),rT[e]=n,n.read=xT(n,r),n.read()};pT[0]=()=>{},pT[0].noBuffer=!0,pT[66]=e=>{let t=e.length,n=BigInt(128&e[0]?e[0]-256:e[0]);for(let r=1;r<t;r++)n<<=BigInt(8),n+=BigInt(e[r]);return n};let JT={Error:Error,TypeError:TypeError,ReferenceError:ReferenceError};pT[101]=()=>{let e=ST();return(JT[e[0]]||Error)(e[1],{cause:e[2]})},pT[105]=e=>{if(!1===cT.structuredClone)throw new Error("Structured clone extension is disabled");let t=sT.getUint32(lT-4);oT||(oT=new Map);let n,r=eT[lT];n=r>=144&&r<160||220==r||221==r?[]:r>=128&&r<144||222==r||223==r?new Map:(r>=199&&r<=201||r>=212&&r<=216)&&115===eT[lT+1]?new Set:{};let a={target:n};oT.set(t,a);let i=ST();if(!a.used)return a.target=i;if(Object.assign(n,i),n instanceof Map)for(let[e,t]of i.entries())n.set(e,t);if(n instanceof Set)for(let e of Array.from(i))n.add(e);return n},pT[112]=e=>{if(!1===cT.structuredClone)throw new Error("Structured clone extension is disabled");let t=sT.getUint32(lT-4),n=oT.get(t);return n.used=!0,n.target},pT[115]=()=>new Set(ST());const GT=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map((e=>e+"Array"));let $T="object"==typeof globalThis?globalThis:window;pT[116]=e=>{let t=e[0],n=Uint8Array.prototype.slice.call(e,1).buffer,r=GT[t];if(!r){if(16===t)return n;if(17===t)return new DataView(n);throw new Error("Could not find typed array for code "+t)}return new $T[r](n)},pT[120]=()=>{let e=ST();return new RegExp(e[0],e[1])};const qT=[];function zT(e){let t=tT,n=lT,r=uT,a=dT,i=aT,o=oT,s=iT,l=new Uint8Array(eT.slice(0,tT)),c=rT,u=rT.slice(0,rT.length),d=cT,p=yT,h=e();return tT=t,lT=n,uT=r,dT=a,aT=i,oT=o,iT=s,eT=l,yT=p,(rT=c).splice(0,rT.length,...u),cT=d,sT=new DataView(eT.buffer,eT.byteOffset,eT.byteLength),h}function WT(){eT=null,oT=null,rT=null}pT[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=lT;return lT+=t-e.length,iT=qT,(iT=[NT(),NT()]).position0=0,iT.position1=0,iT.postBundlePosition=lT,lT=n,ST()},pT[255]=e=>4==e.length?new Date(1e3*(16777216*e[0]+(e[1]<<16)+(e[2]<<8)+e[3])):8==e.length?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+1e3*(4294967296*(3&e[3])+16777216*e[4]+(e[5]<<16)+(e[6]<<8)+e[7])):12==e.length?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+1e3*((128&e[4]?-281474976710656:0)+1099511627776*e[6]+4294967296*e[7]+16777216*e[8]+(e[9]<<16)+(e[10]<<8)+e[11])):new Date("invalid");const YT=new Array(147);for(let e=0;e<256;e++)YT[e]=+("1e"+Math.floor(45.15-.30103*e));var HT=new bT({useRecords:!1});HT.unpack,HT.unpackMultiple,HT.unpack;let QT,ZT,XT,eA=new Float32Array(1);new Uint8Array(eA.buffer,0,4);try{QT=new TextEncoder}catch(e){}const tA="undefined"!=typeof Buffer,nA=tA?function(e){return Buffer.allocUnsafeSlow(e)}:Uint8Array,rA=tA?Buffer:Uint8Array,aA=tA?4294967296:2144337920;let iA,oA,sA,lA,cA=0,uA=null;const dA=/[\u0080-\uFFFF]/,pA=Symbol("record-id");class hA extends bT{constructor(e){let t,n,r,a;super(e),this.offset=0;let i=rA.prototype.utf8Write?function(e,t){return iA.utf8Write(e,t,iA.byteLength-t)}:!(!QT||!QT.encodeInto)&&function(e,t){return QT.encodeInto(e,iA.subarray(t)).written},o=this;e||(e={});let s=e&&e.sequential,l=e.structures||e.saveStructures,c=e.maxSharedStructures;if(null==c&&(c=l?32:0),c>8160)throw new Error("Maximum maxSharedStructure is 8160");e.structuredClone&&null==e.moreTypes&&(this.moreTypes=!0);let u=e.maxOwnStructures;null==u&&(u=l?32:64),this.structures||0==e.useRecords||(this.structures=[]);let d=c>32||u+c>64,p=c+64,h=c+u+64;if(h>8256)throw new Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let m=[],f=0,y=0;this.pack=this.encode=function(e,i){if(iA||(iA=new nA(8192),sA=iA.dataView||(iA.dataView=new DataView(iA.buffer,0,8192)),cA=0),lA=iA.length-10,lA-cA<2048?(iA=new nA(iA.length),sA=iA.dataView||(iA.dataView=new DataView(iA.buffer,0,iA.length)),lA=iA.length-10,cA=0):cA=cA+7&2147483640,t=cA,i&SA&&(cA+=255&i),a=o.structuredClone?new Map:null,o.bundleStrings&&"string"!=typeof e?(uA=[],uA.size=1/0):uA=null,r=o.structures,r){r.uninitialized&&(r=o._mergeStructures(o.getStructures()));let e=r.sharedLength||0;if(e>c)throw new Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+r.sharedLength);if(!r.transitions){r.transitions=Object.create(null);for(let t=0;t<e;t++){let e=r[t];if(!e)continue;let n,a=r.transitions;for(let t=0,r=e.length;t<r;t++){let r=e[t];n=a[r],n||(n=a[r]=Object.create(null)),a=n}a[pA]=t+64}this.lastNamedStructuresLength=e}s||(r.nextId=e+64)}let l;n&&(n=!1);try{o.randomAccessStructure&&e&&e.constructor&&e.constructor===Object?T(e):v(e);let s=uA;if(uA&&gA(t,v,0),a&&a.idsToInsert){let e=a.idsToInsert.sort(((e,t)=>e.offset>t.offset?1:-1)),n=e.length,r=-1;for(;s&&n>0;){let a=e[--n].offset+t;a<s.stringsPosition+t&&-1===r&&(r=0),a>s.position+t?r>=0&&(r+=6):(r>=0&&(sA.setUint32(s.position+t,sA.getUint32(s.position+t)+r),r=-1),s=s.previous,n++)}r>=0&&s&&sA.setUint32(s.position+t,sA.getUint32(s.position+t)+r),cA+=6*e.length,cA>lA&&_(cA),o.offset=cA;let i=function(e,t){let n,r=6*t.length,a=e.length-r;for(;n=t.pop();){let t=n.offset,i=n.id;e.copyWithin(t+r,t,a),r-=6;let o=t+r;e[o++]=214,e[o++]=105,e[o++]=i>>24,e[o++]=i>>16&255,e[o++]=i>>8&255,e[o++]=255&i,a=t}return e}(iA.subarray(t,cA),e);return a=null,i}return o.offset=cA,i&vA?(iA.start=t,iA.end=cA,iA):iA.subarray(t,cA)}catch(e){throw l=e,e}finally{if(r&&(g(),n&&o.saveStructures)){let n=r.sharedLength||0,a=iA.subarray(t,cA),s=function(e,t){return e.isCompatible=e=>{let n=!e||(t.lastNamedStructuresLength||0)===e.length;return n||t._mergeStructures(e),n},e}(r,o);if(!l)return!1===o.saveStructures(s,s.isCompatible)?o.pack(e,i):(o.lastNamedStructuresLength=n,iA.length>1073741824&&(iA=null),a)}iA.length>1073741824&&(iA=null),i&wA&&(cA=t)}};const g=()=>{y<10&&y++;let e=r.sharedLength||0;if(r.length>e&&!s&&(r.length=e),f>1e4)r.transitions=null,y=0,f=0,m.length>0&&(m=[]);else if(m.length>0&&!s){for(let e=0,t=m.length;e<t;e++)m[e][pA]=0;m=[]}},b=e=>{var t=e.length;t<16?iA[cA++]=144|t:t<65536?(iA[cA++]=220,iA[cA++]=t>>8,iA[cA++]=255&t):(iA[cA++]=221,sA.setUint32(cA,t),cA+=4);for(let n=0;n<t;n++)v(e[n])},v=e=>{cA>lA&&(iA=_(cA));var n,r=typeof e;if("string"===r){let r,a=e.length;if(uA&&a>=4&&a<4096){if((uA.size+=a)>21760){let e,n,r=(uA[0]?3*uA[0].length+uA[1].length:0)+10;cA+r>lA&&(iA=_(cA+r)),uA.position?(n=uA,iA[cA]=200,cA+=3,iA[cA++]=98,e=cA-t,cA+=4,gA(t,v,0),sA.setUint16(e+t-3,cA-t-e)):(iA[cA++]=214,iA[cA++]=98,e=cA-t,cA+=4),uA=["",""],uA.previous=n,uA.size=0,uA.position=e}let n=dA.test(e);return uA[n?0:1]+=e,iA[cA++]=193,void v(n?-a:a)}r=a<32?1:a<256?2:a<65536?3:5;let o=3*a;if(cA+o>lA&&(iA=_(cA+o)),a<64||!i){let t,i,o,s=cA+r;for(t=0;t<a;t++)i=e.charCodeAt(t),i<128?iA[s++]=i:i<2048?(iA[s++]=i>>6|192,iA[s++]=63&i|128):55296==(64512&i)&&56320==(64512&(o=e.charCodeAt(t+1)))?(i=65536+((1023&i)<<10)+(1023&o),t++,iA[s++]=i>>18|240,iA[s++]=i>>12&63|128,iA[s++]=i>>6&63|128,iA[s++]=63&i|128):(iA[s++]=i>>12|224,iA[s++]=i>>6&63|128,iA[s++]=63&i|128);n=s-cA-r}else n=i(e,cA+r);n<32?iA[cA++]=160|n:n<256?(r<2&&iA.copyWithin(cA+2,cA+1,cA+1+n),iA[cA++]=217,iA[cA++]=n):n<65536?(r<3&&iA.copyWithin(cA+3,cA+2,cA+2+n),iA[cA++]=218,iA[cA++]=n>>8,iA[cA++]=255&n):(r<5&&iA.copyWithin(cA+5,cA+3,cA+3+n),iA[cA++]=219,sA.setUint32(cA,n),cA+=4),cA+=n}else if("number"===r)if(e>>>0===e)e<32||e<128&&!1===this.useRecords||e<64&&!this.randomAccessStructure?iA[cA++]=e:e<256?(iA[cA++]=204,iA[cA++]=e):e<65536?(iA[cA++]=205,iA[cA++]=e>>8,iA[cA++]=255&e):(iA[cA++]=206,sA.setUint32(cA,e),cA+=4);else if(e>>0===e)e>=-32?iA[cA++]=256+e:e>=-128?(iA[cA++]=208,iA[cA++]=e+256):e>=-32768?(iA[cA++]=209,sA.setInt16(cA,e),cA+=2):(iA[cA++]=210,sA.setInt32(cA,e),cA+=4);else{let t;if((t=this.useFloat32)>0&&e<4294967296&&e>=-2147483648){let n;if(iA[cA++]=202,sA.setFloat32(cA,e),t<4||(n=e*YT[(127&iA[cA])<<1|iA[cA+1]>>7])>>0===n)return void(cA+=4);cA--}iA[cA++]=203,sA.setFloat64(cA,e),cA+=8}else if("object"===r||"function"===r)if(e){if(a){let n=a.get(e);if(n){if(!n.id){let e=a.idsToInsert||(a.idsToInsert=[]);n.id=e.push(n)}return iA[cA++]=214,iA[cA++]=112,sA.setUint32(cA,n.id),void(cA+=4)}a.set(e,{offset:cA-t})}let i=e.constructor;if(i===Object)x(e);else if(i===Array)b(e);else if(i===Map)if(this.mapAsEmptyObject)iA[cA++]=128;else{(n=e.size)<16?iA[cA++]=128|n:n<65536?(iA[cA++]=222,iA[cA++]=n>>8,iA[cA++]=255&n):(iA[cA++]=223,sA.setUint32(cA,n),cA+=4);for(let[t,n]of e)v(t),v(n)}else{for(let t=0,n=ZT.length;t<n;t++){if(e instanceof XT[t]){let n=ZT[t];if(n.write){n.type&&(iA[cA++]=212,iA[cA++]=n.type,iA[cA++]=0);let t=n.write.call(this,e);return void(t===e?Array.isArray(e)?b(e):x(e):v(t))}let r,a=iA,i=sA,o=cA;iA=null;try{r=n.pack.call(this,e,(e=>(iA=a,a=null,cA+=e,cA>lA&&_(cA),{target:iA,targetView:sA,position:cA-e})),v)}finally{a&&(iA=a,sA=i,cA=o,lA=iA.length-10)}return void(r&&(r.length+cA>lA&&_(r.length+cA),cA=yA(r,iA,cA,n.type)))}}if(Array.isArray(e))b(e);else{if(e.toJSON){const t=e.toJSON();if(t!==e)return v(t)}if("function"===r)return v(this.writeFunction&&this.writeFunction(e));x(e)}}}else iA[cA++]=192;else if("boolean"===r)iA[cA++]=e?195:194;else if("bigint"===r){if(e<0x8000000000000000&&e>=-0x8000000000000000)iA[cA++]=211,sA.setBigInt64(cA,e);else if(e<0x10000000000000000&&e>0)iA[cA++]=207,sA.setBigUint64(cA,e);else{if(!this.largeBigIntToFloat){if(this.largeBigIntToString)return v(e.toString());if((this.useBigIntExtension||this.moreTypes)&&e<BigInt(2)**BigInt(1023)&&e>-(BigInt(2)**BigInt(1023))){iA[cA++]=199,cA++,iA[cA++]=66;let t,n=[];do{let r=e&BigInt(255);t=(r&BigInt(128))===(e<BigInt(0)?BigInt(128):BigInt(0)),n.push(r),e>>=BigInt(8)}while(e!==BigInt(0)&&e!==BigInt(-1)||!t);iA[cA-2]=n.length;for(let e=n.length;e>0;)iA[cA++]=Number(n[--e]);return}throw new RangeError(e+" was too large to fit in MessagePack 64-bit integer format, use useBigIntExtension, or set largeBigIntToFloat to convert to float-64, or set largeBigIntToString to convert to string")}iA[cA++]=203,sA.setFloat64(cA,Number(e))}cA+=8}else{if("undefined"!==r)throw new Error("Unknown type: "+r);this.encodeUndefinedAsNil?iA[cA++]=192:(iA[cA++]=212,iA[cA++]=0,iA[cA++]=0)}},w=this.variableMapSize||this.coercibleKeyAsNumber||this.skipValues?e=>{let t;if(this.skipValues){t=[];for(let n in e)"function"==typeof e.hasOwnProperty&&!e.hasOwnProperty(n)||this.skipValues.includes(e[n])||t.push(n)}else t=Object.keys(e);let n,r=t.length;if(r<16?iA[cA++]=128|r:r<65536?(iA[cA++]=222,iA[cA++]=r>>8,iA[cA++]=255&r):(iA[cA++]=223,sA.setUint32(cA,r),cA+=4),this.coercibleKeyAsNumber)for(let a=0;a<r;a++){n=t[a];let r=Number(n);v(isNaN(r)?n:r),v(e[n])}else for(let a=0;a<r;a++)v(n=t[a]),v(e[n])}:e=>{iA[cA++]=222;let n=cA-t;cA+=2;let r=0;for(let t in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(t))&&(v(t),v(e[t]),r++);if(r>65535)throw new Error('Object is too large to serialize with fast 16-bit map size, use the "variableMapSize" option to serialize this object');iA[n+++t]=r>>8,iA[n+t]=255&r},S=!1===this.useRecords?w:e.progressiveRecords&&!d?e=>{let n,a,i=r.transitions||(r.transitions=Object.create(null)),o=cA++-t;for(let s in e)if("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(s)){if(n=i[s],n)i=n;else{let l=Object.keys(e),c=i;i=r.transitions;let u=0;for(let e=0,t=l.length;e<t;e++){let t=l[e];n=i[t],n||(n=i[t]=Object.create(null),u++),i=n}o+t+1==cA?(cA--,k(i,l,u)):I(i,l,o,u),a=!0,i=c[s]}v(e[s])}if(!a){let n=i[pA];n?iA[o+t]=n:I(i,Object.keys(e),o,0)}}:e=>{let t,n=r.transitions||(r.transitions=Object.create(null)),a=0;for(let r in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(r))&&(t=n[r],t||(t=n[r]=Object.create(null),a++),n=t);let i=n[pA];i?i>=96&&d?(iA[cA++]=96+(31&(i-=96)),iA[cA++]=i>>5):iA[cA++]=i:k(n,n.__keys__||Object.keys(e),a);for(let t in e)("function"!=typeof e.hasOwnProperty||e.hasOwnProperty(t))&&v(e[t])},E="function"==typeof this.useRecords&&this.useRecords,x=E?e=>{E(e)?S(e):w(e)}:S,_=e=>{let n;if(e>16777216){if(e-t>aA)throw new Error("Packed buffer would be larger than maximum buffer size");n=Math.min(aA,4096*Math.round(Math.max((e-t)*(e>67108864?1.25:2),4194304)/4096))}else n=1+(Math.max(e-t<<2,iA.length-1)>>12)<<12;let r=new nA(n);return sA=r.dataView||(r.dataView=new DataView(r.buffer,0,n)),e=Math.min(e,iA.length),iA.copy?iA.copy(r,0,t,e):r.set(iA.slice(t,e)),cA-=t,t=0,lA=r.length-10,iA=r},k=(e,t,a)=>{let i=r.nextId;i||(i=64),i<p&&this.shouldShareStructure&&!this.shouldShareStructure(t)?(i=r.nextOwnId,i<h||(i=p),r.nextOwnId=i+1):(i>=h&&(i=p),r.nextId=i+1);let o=t.highByte=i>=96&&d?i-96>>5:-1;e[pA]=i,e.__keys__=t,r[i-64]=t,i<p?(t.isShared=!0,r.sharedLength=i-63,n=!0,o>=0?(iA[cA++]=96+(31&i),iA[cA++]=o):iA[cA++]=i):(o>=0?(iA[cA++]=213,iA[cA++]=114,iA[cA++]=96+(31&i),iA[cA++]=o):(iA[cA++]=212,iA[cA++]=114,iA[cA++]=i),a&&(f+=y*a),m.length>=u&&(m.shift()[pA]=0),m.push(e),v(t))},I=(e,n,r,a)=>{let i=iA,o=cA,s=lA,l=t;iA=oA,cA=0,t=0,iA||(oA=iA=new nA(8192)),lA=iA.length-10,k(e,n,a),oA=iA;let c=cA;if(iA=i,cA=o,lA=s,t=l,c>1){let e=cA+c-1;e>lA&&_(e);let n=r+t;iA.copyWithin(n+c,n+1,cA),iA.set(oA.slice(0,c),n),cA=e}else iA[r+t]=oA[0]},T=e=>{let a=undefined(e,iA,t,cA,r,_,((e,t,r)=>{if(r)return n=!0;cA=t;let a=iA;return v(e),g(),a!==iA?{position:cA,targetView:sA,target:iA}:cA}),this);if(0===a)return x(e);cA=a}}useBuffer(e){iA=e,iA.dataView||(iA.dataView=new DataView(iA.buffer,iA.byteOffset,iA.byteLength)),cA=0}set position(e){cA=e}get position(){return cA}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}function mA(e,t,n,r){let a=e.byteLength;if(a+1<256){var{target:i,position:o}=n(4+a);i[o++]=199,i[o++]=a+1}else if(a+1<65536){var{target:i,position:o}=n(5+a);i[o++]=200,i[o++]=a+1>>8,i[o++]=a+1&255}else{var{target:i,position:o,targetView:s}=n(7+a);i[o++]=201,s.setUint32(o,a+1),o+=4}i[o++]=116,i[o++]=t,e.buffer||(e=new Uint8Array(e)),i.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),o)}function fA(e,t){let n=e.byteLength;var r,a;if(n<256){var{target:r,position:a}=t(n+2);r[a++]=196,r[a++]=n}else if(n<65536){var{target:r,position:a}=t(n+3);r[a++]=197,r[a++]=n>>8,r[a++]=255&n}else{var{target:r,position:a,targetView:i}=t(n+5);r[a++]=198,i.setUint32(a,n),a+=4}r.set(e,a)}function yA(e,t,n,r){let a=e.length;switch(a){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:a<256?(t[n++]=199,t[n++]=a):a<65536?(t[n++]=200,t[n++]=a>>8,t[n++]=255&a):(t[n++]=201,t[n++]=a>>24,t[n++]=a>>16&255,t[n++]=a>>8&255,t[n++]=255&a)}return t[n++]=r,t.set(e,n),n+=a}function gA(e,t,n){if(uA.length>0){sA.setUint32(uA.position+e,cA+n-uA.position-e),uA.stringsPosition=cA-e;let r=uA;uA=null,t(r[0]),t(r[1])}}XT=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,DataView,mT],ZT=[{pack(e,t,n){let r=e.getTime()/1e3;if((this.useTimestamp32||0===e.getMilliseconds())&&r>=0&&r<4294967296){let{target:e,targetView:n,position:a}=t(6);e[a++]=214,e[a++]=255,n.setUint32(a,r)}else if(r>0&&r<4294967296){let{target:n,targetView:a,position:i}=t(10);n[i++]=215,n[i++]=255,a.setUint32(i,4e6*e.getMilliseconds()+(r/1e3/4294967296>>0)),a.setUint32(i+4,r)}else if(isNaN(r)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:e,targetView:r,position:a}=t(3);e[a++]=212,e[a++]=255,e[a++]=255}else{let{target:n,targetView:a,position:i}=t(15);n[i++]=199,n[i++]=12,n[i++]=255,a.setUint32(i,1e6*e.getMilliseconds()),a.setBigInt64(i+4,BigInt(Math.floor(r)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let r=Array.from(e),{target:a,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(a[i++]=212,a[i++]=115,a[i++]=0),n(r)}},{pack(e,t,n){let{target:r,position:a}=t(this.moreTypes?3:0);this.moreTypes&&(r[a++]=212,r[a++]=101,r[a++]=0),n([e.name,e.message,e.cause])}},{pack(e,t,n){let{target:r,position:a}=t(this.moreTypes?3:0);this.moreTypes&&(r[a++]=212,r[a++]=120,r[a++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?mA(e,16,t):fA(tA?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==rA&&this.moreTypes?mA(e,GT.indexOf(n.name),t):fA(e,t)}},{pack(e,t){this.moreTypes?mA(e,17,t):fA(tA?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let{target:n,position:r}=t(1);n[r]=193}}];let bA=new hA({useRecords:!1});bA.pack,bA.pack;const vA=512,wA=1024,SA=2048,EA=new hA({useRecords:!1,encodeUndefinedAsNil:!0}).pack;class xA{constructor(e){this.queue=e,this.version="5.56.0";const t=this.queue.keys;this.moveToFinishedKeys=[t.wait,t.active,t.prioritized,t.events,t.stalled,t.limiter,t.delayed,t.paused,t.meta,t.pc,void 0,void 0,void 0,void 0]}execCommand(e,t,n){return e[`${t}:${this.version}`](n)}async isJobInList(e,t){const n=await this.queue.client;let r;return r=BC(this.queue.redisVersion,"6.0.6")?await this.execCommand(n,"isJobInList",[e,t]):await n.lpos(e,t),Number.isInteger(r)}addDelayedJobArgs(e,t,n){const r=this.queue.keys,a=[r.marker,r.meta,r.id,r.delayed,r.completed,r.events];return a.push(EA(n),e.data,t),a}addDelayedJob(e,t,n,r){const a=this.addDelayedJobArgs(t,n,r);return this.execCommand(e,"addDelayedJob",a)}addPrioritizedJobArgs(e,t,n){const r=this.queue.keys,a=[r.marker,r.meta,r.id,r.prioritized,r.delayed,r.completed,r.active,r.events,r.pc];return a.push(EA(n),e.data,t),a}addPrioritizedJob(e,t,n,r){const a=this.addPrioritizedJobArgs(t,n,r);return this.execCommand(e,"addPrioritizedJob",a)}addParentJobArgs(e,t,n){const r=this.queue.keys,a=[r.meta,r.id,r.delayed,r.completed,r.events];return a.push(EA(n),e.data,t),a}addParentJob(e,t,n,r){const a=this.addParentJobArgs(t,n,r);return this.execCommand(e,"addParentJob",a)}addStandardJobArgs(e,t,n){const r=this.queue.keys,a=[r.wait,r.paused,r.meta,r.id,r.completed,r.delayed,r.active,r.events,r.marker];return a.push(EA(n),e.data,t),a}addStandardJob(e,t,n,r){const a=this.addStandardJobArgs(t,n,r);return this.execCommand(e,"addStandardJob",a)}async addJob(e,t,n,r,a={}){const i=this.queue.keys,o=t.parent,s=[i[""],void 0!==r?r:"",t.name,t.timestamp,t.parentKey||null,a.waitChildrenKey||null,a.parentDependenciesKey||null,o,t.repeatJobKey,t.deduplicationId?`${i.de}:${t.deduplicationId}`:null];let l,c;if(n.repeat){const e=Object.assign({},n.repeat);e.startDate&&(e.startDate=+new Date(e.startDate)),e.endDate&&(e.endDate=+new Date(e.endDate)),l=EA(Object.assign(Object.assign({},n),{repeat:e}))}else l=EA(n);if(c=a.waitChildrenKey?await this.addParentJob(e,t,l,s):"number"==typeof n.delay&&n.delay>0?await this.addDelayedJob(e,t,l,s):n.priority?await this.addPrioritizedJob(e,t,l,s):await this.addStandardJob(e,t,l,s),c<0)throw this.finishedErrors({code:c,parentKey:a.parentKey,command:"addJob"});return c}pauseArgs(e){let t="wait",n="paused";e||(t="paused",n="wait");const r=[t,n,"meta","prioritized"].map((e=>this.queue.toKey(e)));r.push(this.queue.keys.events,this.queue.keys.delayed,this.queue.keys.marker);const a=[e?"paused":"resumed"];return r.concat(a)}async pause(e){const t=await this.queue.client,n=this.pauseArgs(e);return this.execCommand(t,"pause",n)}addRepeatableJobArgs(e,t,n,r){const a=this.queue.keys,i=[a.repeat,a.delayed],o=[t,EA(n),r,e,a[""]];return i.concat(o)}async addRepeatableJob(e,t,n,r){const a=await this.queue.client,i=this.addRepeatableJobArgs(e,t,n,r);return this.execCommand(a,"addRepeatableJob",i)}async addJobScheduler(e,t,n,r,a,i,o){const s=await this.queue.client,l=this.queue.keys,c=[l.repeat,l.delayed,l.wait,l.paused,l.meta,l.prioritized,l.marker,l.id,l.events,l.pc,l.active],u=[t,EA(a),e,n,EA(r),EA(i),Date.now(),l[""],o?this.queue.toKey(o):""];return this.execCommand(s,"addJobScheduler",c.concat(u))}async updateRepeatableJobMillis(e,t,n,r){const a=[this.queue.keys.repeat,n,t,r];return this.execCommand(e,"updateRepeatableJobMillis",a)}async updateJobSchedulerNextMillis(e,t,n,r,a){const i=await this.queue.client,o=this.queue.keys,s=[o.repeat,o.delayed,o.wait,o.paused,o.meta,o.prioritized,o.marker,o.id,o.events,o.pc,a?this.queue.toKey(a):"",o.active],l=[t,e,n,EA(r),Date.now(),o[""],a];return this.execCommand(i,"updateJobScheduler",s.concat(l))}removeRepeatableArgs(e,t,n){const r=this.queue.keys,a=[r.repeat,r.delayed,r.events],i=[e,this.getRepeatConcatOptions(t,n),n,r[""]];return a.concat(i)}getRepeatConcatOptions(e,t){return t&&t.split(":").length>2?t:e}async removeRepeatable(e,t,n){const r=await this.queue.client,a=this.removeRepeatableArgs(e,t,n);return this.execCommand(r,"removeRepeatable",a)}async removeJobScheduler(e){const t=await this.queue.client,n=this.queue.keys,r=[n.repeat,n.delayed,n.events],a=[e,n[""]];return this.execCommand(t,"removeJobScheduler",r.concat(a))}removeArgs(e,t){const n=[e,"repeat"].map((e=>this.queue.toKey(e))),r=[e,t?1:0,this.queue.toKey("")];return n.concat(r)}async remove(e,t){const n=await this.queue.client,r=this.removeArgs(e,t),a=await this.execCommand(n,"removeJob",r);if(a<0)throw this.finishedErrors({code:a,jobId:e,command:"removeJob"});return a}async removeUnprocessedChildren(e){const t=await this.queue.client,n=[this.queue.toKey(e),this.queue.keys.meta,this.queue.toKey(""),e];await this.execCommand(t,"removeUnprocessedChildren",n)}async extendLock(e,t,n,r){r=r||await this.queue.client;const a=[this.queue.toKey(e)+":lock",this.queue.keys.stalled,t,n,e];return this.execCommand(r,"extendLock",a)}async extendLocks(e,t,n){const r=await this.queue.client,a=[this.queue.keys.stalled,this.queue.toKey(""),EA(t),EA(e),n];return this.execCommand(r,"extendLocks",a)}async updateData(e,t){const n=await this.queue.client,r=[this.queue.toKey(e.id)],a=JSON.stringify(t),i=await this.execCommand(n,"updateData",r.concat([a]));if(i<0)throw this.finishedErrors({code:i,jobId:e.id,command:"updateData"})}async updateProgress(e,t){const n=await this.queue.client,r=[this.queue.toKey(e),this.queue.keys.events,this.queue.keys.meta],a=JSON.stringify(t),i=await this.execCommand(n,"updateProgress",r.concat([e,a]));if(i<0)throw this.finishedErrors({code:i,jobId:e,command:"updateProgress"})}async addLog(e,t,n){const r=await this.queue.client,a=[this.queue.toKey(e),this.queue.toKey(e)+":logs"],i=await this.execCommand(r,"addLog",a.concat([e,t,n||""]));if(i<0)throw this.finishedErrors({code:i,jobId:e,command:"addLog"});return i}moveToFinishedArgs(e,t,n,r,a,i,o,s=!0,l){var c,u,d,p,h,m,f;const y=this.queue.keys,g=this.queue.opts,b="completed"===a?g.removeOnComplete:g.removeOnFail,v=this.queue.toKey(`metrics:${a}`),w=this.moveToFinishedKeys;w[10]=y[a],w[11]=this.queue.toKey(null!==(c=e.id)&&void 0!==c?c:""),w[12]=v,w[13]=this.queue.keys.marker;const S=this.getKeepJobs(r,b),E=[e.id,o,n,void 0===t?"null":t,a,!s||this.queue.closing?0:1,y[""],EA({token:i,name:g.name,keepJobs:S,limiter:g.limiter,lockDuration:g.lockDuration,attempts:e.opts.attempts,maxMetricsSize:(null===(u=g.metrics)||void 0===u?void 0:u.maxDataPoints)?null===(d=g.metrics)||void 0===d?void 0:d.maxDataPoints:"",fpof:!!(null===(p=e.opts)||void 0===p?void 0:p.failParentOnFailure),cpof:!!(null===(h=e.opts)||void 0===h?void 0:h.continueParentOnFailure),idof:!!(null===(m=e.opts)||void 0===m?void 0:m.ignoreDependencyOnFailure),rdof:!!(null===(f=e.opts)||void 0===f?void 0:f.removeDependencyOnFailure)}),l?EA(AC(l)):void 0];return w.concat(E)}getKeepJobs(e,t){return void 0===e?t||{count:e?0:-1}:"object"==typeof e?e:"number"==typeof e?{count:e}:{count:e?0:-1}}async moveToFinished(e,t){const n=await this.queue.client,r=await this.execCommand(n,"moveToFinished",t);if(r<0)throw this.finishedErrors({code:r,jobId:e,command:"moveToFinished",state:"active"});if(void 0!==r)return _A(r)}drainArgs(e){const t=this.queue.keys,n=[t.wait,t.paused,t.delayed,t.prioritized,t.repeat],r=[t[""],e?"1":"0"];return n.concat(r)}async drain(e){const t=await this.queue.client,n=this.drainArgs(e);return this.execCommand(t,"drain",n)}removeChildDependencyArgs(e,t){const n=[this.queue.keys[""]],r=[this.queue.toKey(e),t];return n.concat(r)}async removeChildDependency(e,t){const n=await this.queue.client,r=this.removeChildDependencyArgs(e,t),a=await this.execCommand(n,"removeChildDependency",r);switch(a){case 0:return!0;case 1:return!1;default:throw this.finishedErrors({code:a,jobId:e,parentKey:t,command:"removeChildDependency"})}}getRangesArgs(e,t,n,r){const a=this.queue.keys,i=e.map((e=>"waiting"===e?"wait":e)),o=[t,n,r?"1":"0",...i];return[a[""]].concat(o)}async getRanges(e,t=0,n=1,r=!1){const a=await this.queue.client,i=this.getRangesArgs(e,t,n,r);return await this.execCommand(a,"getRanges",i)}getCountsArgs(e){const t=this.queue.keys,n=e.map((e=>"waiting"===e?"wait":e)),r=[...n];return[t[""]].concat(r)}async getCounts(e){const t=await this.queue.client,n=this.getCountsArgs(e);return await this.execCommand(t,"getCounts",n)}getCountsPerPriorityArgs(e){const t=e;return[this.queue.keys.wait,this.queue.keys.paused,this.queue.keys.meta,this.queue.keys.prioritized].concat(t)}async getCountsPerPriority(e){const t=await this.queue.client,n=this.getCountsPerPriorityArgs(e);return await this.execCommand(t,"getCountsPerPriority",n)}getDependencyCountsArgs(e,t){const n=t;return[`${e}:processed`,`${e}:dependencies`,`${e}:failed`,`${e}:unsuccessful`].map((e=>this.queue.toKey(e))).concat(n)}async getDependencyCounts(e,t){const n=await this.queue.client,r=this.getDependencyCountsArgs(e,t);return await this.execCommand(n,"getDependencyCounts",r)}moveToCompletedArgs(e,t,n,r,a=!1){const i=Date.now();return this.moveToFinishedArgs(e,t,"returnvalue",n,"completed",r,i,a)}moveToFailedArgs(e,t,n,r,a=!1,i){const o=Date.now();return this.moveToFinishedArgs(e,t,"failedReason",n,"failed",r,o,a,i)}async isFinished(e,t=!1){const n=await this.queue.client,r=["completed","failed",e].map((e=>this.queue.toKey(e)));return this.execCommand(n,"isFinished",r.concat([e,t?"1":""]))}async getState(e){const t=await this.queue.client,n=["completed","failed","delayed","active","wait","paused","waiting-children","prioritized"].map((e=>this.queue.toKey(e)));return BC(this.queue.redisVersion,"6.0.6")?this.execCommand(t,"getState",n.concat([e])):this.execCommand(t,"getStateV2",n.concat([e]))}async changeDelay(e,t){const n=await this.queue.client,r=this.changeDelayArgs(e,t),a=await this.execCommand(n,"changeDelay",r);if(a<0)throw this.finishedErrors({code:a,jobId:e,command:"changeDelay",state:"delayed"})}changeDelayArgs(e,t){const n=Date.now();return[this.queue.keys.delayed,this.queue.keys.meta,this.queue.keys.marker,this.queue.keys.events].concat([t,JSON.stringify(n),e,this.queue.toKey(e)])}async changePriority(e,t=0,n=!1){const r=await this.queue.client,a=this.changePriorityArgs(e,t,n),i=await this.execCommand(r,"changePriority",a);if(i<0)throw this.finishedErrors({code:i,jobId:e,command:"changePriority"})}changePriorityArgs(e,t=0,n=!1){return[this.queue.keys.wait,this.queue.keys.paused,this.queue.keys.meta,this.queue.keys.prioritized,this.queue.keys.active,this.queue.keys.pc,this.queue.keys.marker].concat([t,this.queue.toKey(""),e,n?1:0])}moveToDelayedArgs(e,t,n,r,a={}){const i=this.queue.keys;return[i.marker,i.active,i.prioritized,i.delayed,this.queue.toKey(e),i.events,i.meta,i.stalled].concat([this.queue.keys[""],t,e,n,r,a.skipAttempt?"1":"0",a.fieldsToUpdate?EA(AC(a.fieldsToUpdate)):void 0])}moveToWaitingChildrenArgs(e,t,n){const r=Date.now(),a=NC(n.child);return["active","waiting-children",e,`${e}:dependencies`,`${e}:unsuccessful`,"stalled","failed","events"].map((e=>this.queue.toKey(e))).concat([t,null!=a?a:"",JSON.stringify(r),e,this.queue.toKey("")])}isMaxedArgs(){const e=this.queue.keys;return[e.meta,e.active]}async isMaxed(){const e=await this.queue.client,t=this.isMaxedArgs();return!!await this.execCommand(e,"isMaxed",t)}async moveToDelayed(e,t,n,r="0",a={}){const i=await this.queue.client,o=this.moveToDelayedArgs(e,t,r,n,a),s=await this.execCommand(i,"moveToDelayed",o);if(s<0)throw this.finishedErrors({code:s,jobId:e,command:"moveToDelayed",state:"active"})}async moveToWaitingChildren(e,t,n={}){const r=await this.queue.client,a=this.moveToWaitingChildrenArgs(e,t,n),i=await this.execCommand(r,"moveToWaitingChildren",a);switch(i){case 0:return!0;case 1:return!1;default:throw this.finishedErrors({code:i,jobId:e,command:"moveToWaitingChildren",state:"active"})}}getRateLimitTtlArgs(e){return[this.queue.keys.limiter].concat([null!=e?e:"0"])}async getRateLimitTtl(e){const t=await this.queue.client,n=this.getRateLimitTtlArgs(e);return this.execCommand(t,"getRateLimitTtl",n)}async cleanJobsInSet(e,t,n=0){const r=await this.queue.client;return this.execCommand(r,"cleanJobsInSet",[this.queue.toKey(e),this.queue.toKey("events"),this.queue.toKey("repeat"),this.queue.toKey(""),t,n,e])}getJobSchedulerArgs(e){return[this.queue.keys.repeat].concat([e])}async getJobScheduler(e){const t=await this.queue.client,n=this.getJobSchedulerArgs(e);return this.execCommand(t,"getJobScheduler",n)}retryJobArgs(e,t,n,r={}){const a=(t?"R":"L")+"PUSH";return[this.queue.keys.active,this.queue.keys.wait,this.queue.keys.paused,this.queue.toKey(e),this.queue.keys.meta,this.queue.keys.events,this.queue.keys.delayed,this.queue.keys.prioritized,this.queue.keys.pc,this.queue.keys.marker,this.queue.keys.stalled].concat([this.queue.toKey(""),Date.now(),a,e,n,r.fieldsToUpdate?EA(AC(r.fieldsToUpdate)):void 0])}async retryJob(e,t,n="0",r={}){const a=await this.queue.client,i=this.retryJobArgs(e,t,n,r),o=await this.execCommand(a,"retryJob",i);if(o<0)throw this.finishedErrors({code:o,jobId:e,command:"retryJob",state:"active"})}moveJobsToWaitArgs(e,t,n){const r=[t,n,e];return[this.queue.toKey(""),this.queue.keys.events,this.queue.toKey(e),this.queue.toKey("wait"),this.queue.toKey("paused"),this.queue.keys.meta,this.queue.keys.active,this.queue.keys.marker].concat(r)}async retryJobs(e="failed",t=1e3,n=(new Date).getTime()){const r=await this.queue.client,a=this.moveJobsToWaitArgs(e,t,n);return this.execCommand(r,"moveJobsToWait",a)}async promoteJobs(e=1e3){const t=await this.queue.client,n=this.moveJobsToWaitArgs("delayed",e,Number.MAX_VALUE);return this.execCommand(t,"moveJobsToWait",n)}async reprocessJob(e,t){const n=await this.queue.client,r=[this.queue.toKey(e.id),this.queue.keys.events,this.queue.toKey(t),this.queue.keys.wait,this.queue.keys.meta,this.queue.keys.paused,this.queue.keys.active,this.queue.keys.marker],a=[e.id,(e.opts.lifo?"R":"L")+"PUSH","failed"===t?"failedReason":"returnvalue",t],i=await this.execCommand(n,"reprocessJob",r.concat(a));if(1!==i)throw this.finishedErrors({code:i,jobId:e.id,command:"reprocessJob",state:t})}async moveToActive(e,t,n){const r=this.queue.opts,a=this.queue.keys,i=[a.wait,a.active,a.prioritized,a.events,a.stalled,a.limiter,a.delayed,a.paused,a.meta,a.pc,a.marker],o=[a[""],Date.now(),EA({token:t,lockDuration:r.lockDuration,limiter:r.limiter,name:n})];return _A(await this.execCommand(e,"moveToActive",i.concat(o)))}async promote(e){const t=await this.queue.client,n=[this.queue.keys.delayed,this.queue.keys.wait,this.queue.keys.paused,this.queue.keys.meta,this.queue.keys.prioritized,this.queue.keys.active,this.queue.keys.pc,this.queue.keys.events,this.queue.keys.marker],r=[this.queue.toKey(""),e],a=await this.execCommand(t,"promote",n.concat(r));if(a<0)throw this.finishedErrors({code:a,jobId:e,command:"promote",state:"delayed"})}moveStalledJobsToWaitArgs(){const e=this.queue.opts,t=[this.queue.keys.stalled,this.queue.keys.wait,this.queue.keys.active,this.queue.keys["stalled-check"],this.queue.keys.meta,this.queue.keys.paused,this.queue.keys.marker,this.queue.keys.events],n=[e.maxStalledCount,this.queue.toKey(""),Date.now(),e.stalledInterval];return t.concat(n)}async moveStalledJobsToWait(){const e=await this.queue.client,t=this.moveStalledJobsToWaitArgs();return this.execCommand(e,"moveStalledJobsToWait",t)}async moveJobFromActiveToWait(e,t="0"){const n=await this.queue.client,r=[this.queue.keys.active,this.queue.keys.wait,this.queue.keys.stalled,this.queue.keys.paused,this.queue.keys.meta,this.queue.keys.limiter,this.queue.keys.prioritized,this.queue.keys.marker,this.queue.keys.events],a=[e,t,this.queue.toKey(e)],i=await this.execCommand(n,"moveJobFromActiveToWait",r.concat(a));if(i<0)throw this.finishedErrors({code:i,jobId:e,command:"moveJobFromActiveToWait",state:"active"});return i}async obliterate(e){const t=await this.queue.client,n=[this.queue.keys.meta,this.queue.toKey("")],r=[e.count,e.force?"force":null],a=await this.execCommand(t,"obliterate",n.concat(r));if(a<0)switch(a){case-1:throw new Error("Cannot obliterate non-paused queue");case-2:throw new Error("Cannot obliterate queue with active jobs")}return a}async paginate(e,t){const n=await this.queue.client,r=[e],a=t.end>=0?t.end-t.start+1:1/0;let i,o,s,l="0",c=0,u=[],d=[];do{const e=[t.start+u.length,t.end,l,c,5];t.fetchJobs&&e.push(1),[l,c,i,o,s]=await this.execCommand(n,"paginate",r.concat(e)),u=u.concat(i),s&&s.length&&(d=d.concat(s.map(TC)))}while("0"!=l&&u.length<a);if(u.length&&Array.isArray(u[0])){const e=[];for(let t=0;t<u.length;t++){const[n,r]=u[t];try{e.push({id:n,v:JSON.parse(r)})}catch(t){e.push({id:n,err:t.message})}}return{cursor:l,items:e,total:o,jobs:d}}return{cursor:l,items:u.map((e=>({id:e}))),total:o,jobs:d}}finishedErrors({code:e,jobId:t,parentKey:n,command:r,state:a}){switch(e){case nE.JobNotExist:return new Error(`Missing key for job ${t}. ${r}`);case nE.JobLockNotExist:return new Error(`Missing lock for job ${t}. ${r}`);case nE.JobNotInState:return new Error(`Job ${t} is not in the ${a} state. ${r}`);case nE.JobPendingChildren:return new Error(`Job ${t} has pending dependencies. ${r}`);case nE.ParentJobNotExist:return new Error(`Missing key for parent job ${n}. ${r}`);case nE.JobLockMismatch:return new Error(`Lock mismatch for job ${t}. Cmd ${r} from ${a}`);case nE.ParentJobCannotBeReplaced:return new Error(`The parent job ${n} cannot be replaced. ${r}`);case nE.JobBelongsToJobScheduler:return new Error(`Job ${t} belongs to a job scheduler and cannot be removed directly. ${r}`);case nE.JobFailedChildren:return new Error(`Job ${t} has failed children. ${r}`);default:return new Error(`Unknown code ${e} error for ${t}. ${r}`)}}}function _A(e){if(e){const t=[null,e[1],e[2],e[3]];return e[0]&&(t[0]=TC(e[0])),t}return[]}var kA={exports:{}};var IA={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:16,MAX_SAFE_BUILD_LENGTH:250,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:"2.0.0",FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};var TA="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};!function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:a}=IA,i=TA,o=(t=e.exports={}).re=[],s=t.safeRe=[],l=t.src=[],c=t.safeSrc=[],u=t.t={};let d=0;const p="[a-zA-Z0-9-]",h=[["\\s",1],["\\d",a],[p,r]],m=(e,t,n)=>{const r=(e=>{for(const[t,n]of h)e=e.split(`${t}*`).join(`${t}{0,${n}}`).split(`${t}+`).join(`${t}{1,${n}}`);return e})(t),a=d++;i(e,a,t),u[e]=a,l[a]=t,c[a]=r,o[a]=new RegExp(t,n?"g":void 0),s[a]=new RegExp(r,n?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),m("MAINVERSION",`(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})\\.(${l[u.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})\\.(${l[u.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${l[u.NONNUMERICIDENTIFIER]}|${l[u.NUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${l[u.NONNUMERICIDENTIFIER]}|${l[u.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASE",`(?:-(${l[u.PRERELEASEIDENTIFIER]}(?:\\.${l[u.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${l[u.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${l[u.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER","[a-zA-Z0-9-]+"),m("BUILD",`(?:\\+(${l[u.BUILDIDENTIFIER]}(?:\\.${l[u.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${l[u.MAINVERSION]}${l[u.PRERELEASE]}?${l[u.BUILD]}?`),m("FULL",`^${l[u.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${l[u.MAINVERSIONLOOSE]}${l[u.PRERELEASELOOSE]}?${l[u.BUILD]}?`),m("LOOSE",`^${l[u.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${l[u.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${l[u.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:\\.(${l[u.XRANGEIDENTIFIER]})(?:${l[u.PRERELEASE]})?${l[u.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:\\.(${l[u.XRANGEIDENTIFIERLOOSE]})(?:${l[u.PRERELEASELOOSE]})?${l[u.BUILD]}?)?)?`),m("XRANGE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${l[u.GTLT]}\\s*${l[u.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${n}})(?:\\.(\\d{1,${n}}))?(?:\\.(\\d{1,${n}}))?`),m("COERCE",`${l[u.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",l[u.COERCEPLAIN]+`(?:${l[u.PRERELEASE]})?`+`(?:${l[u.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",l[u.COERCE],!0),m("COERCERTLFULL",l[u.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${l[u.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",m("TILDE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${l[u.LONETILDE]}${l[u.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${l[u.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",m("CARET",`^${l[u.LONECARET]}${l[u.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${l[u.LONECARET]}${l[u.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${l[u.GTLT]}\\s*(${l[u.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${l[u.GTLT]}\\s*(${l[u.LOOSEPLAIN]}|${l[u.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${l[u.XRANGEPLAIN]})\\s+-\\s+(${l[u.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${l[u.XRANGEPLAINLOOSE]})\\s+-\\s+(${l[u.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(kA,kA.exports);const AA=Object.freeze({loose:!0}),OA=Object.freeze({});var KA=e=>e?"object"!=typeof e?AA:e:OA;const CA=/^[0-9]+$/,RA=(e,t)=>{const n=CA.test(e),r=CA.test(t);return n&&r&&(e=+e,t=+t),e===t?0:n&&!r?-1:r&&!n?1:e<t?-1:1};var jA={compareIdentifiers:RA,rcompareIdentifiers:(e,t)=>RA(t,e)};const PA=TA,{MAX_LENGTH:DA,MAX_SAFE_INTEGER:NA}=IA,{safeRe:LA,t:MA}=kA.exports,FA=KA,{compareIdentifiers:BA}=jA;class VA{constructor(e,t){if(t=FA(t),e instanceof VA){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>DA)throw new TypeError(`version is longer than ${DA} characters`);PA("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const n=e.trim().match(t.loose?LA[MA.LOOSE]:LA[MA.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>NA||this.major<0)throw new TypeError("Invalid major version");if(this.minor>NA||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>NA||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<NA)return t}return e})):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(PA("SemVer.compare",this.version,this.options,e),!(e instanceof VA)){if("string"==typeof e&&e===this.version)return 0;e=new VA(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof VA||(e=new VA(e,this.options)),BA(this.major,e.major)||BA(this.minor,e.minor)||BA(this.patch,e.patch)}comparePre(e){if(e instanceof VA||(e=new VA(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const n=this.prerelease[t],r=e.prerelease[t];if(PA("prerelease compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return BA(n,r)}while(++t)}compareBuild(e){e instanceof VA||(e=new VA(e,this.options));let t=0;do{const n=this.build[t],r=e.build[t];if(PA("build compare",t,n,r),void 0===n&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===n)return-1;if(n!==r)return BA(n,r)}while(++t)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&!1===n)throw new Error("invalid increment argument: identifier is empty");if(t){const e=`-${t}`.match(this.options.loose?LA[MA.PRERELEASELOOSE]:LA[MA.PRERELEASE]);if(!e||e[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(0===this.prerelease.length)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":{const e=Number(n)?1:0;if(0===this.prerelease.length)this.prerelease=[e];else{let r=this.prerelease.length;for(;--r>=0;)"number"==typeof this.prerelease[r]&&(this.prerelease[r]++,r=-2);if(-1===r){if(t===this.prerelease.join(".")&&!1===n)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(e)}}if(t){let r=[t,e];!1===n&&(r=[t]),0===BA(this.prerelease[0],t)?isNaN(this.prerelease[1])&&(this.prerelease=r):this.prerelease=r}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}var UA=VA;const JA=UA;var GA=(e,t,n=!1)=>{if(e instanceof JA)return e;try{return new JA(e,t)}catch(e){if(!n)return null;throw e}};const $A=GA;var qA=(e,t)=>{const n=$A(e,t);return n?n.version:null};const zA=GA;var WA=(e,t)=>{const n=zA(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null};const YA=UA;var HA=(e,t,n,r,a)=>{"string"==typeof n&&(a=r,r=n,n=void 0);try{return new YA(e instanceof YA?e.version:e,n).inc(t,r,a).version}catch(e){return null}};const QA=GA;var ZA=(e,t)=>{const n=QA(e,null,!0),r=QA(t,null,!0),a=n.compare(r);if(0===a)return null;const i=a>0,o=i?n:r,s=i?r:n,l=!!o.prerelease.length;if(!!s.prerelease.length&&!l){if(!s.patch&&!s.minor)return"major";if(0===s.compareMain(o))return s.minor&&!s.patch?"minor":"patch"}const c=l?"pre":"";return n.major!==r.major?c+"major":n.minor!==r.minor?c+"minor":n.patch!==r.patch?c+"patch":"prerelease"};const XA=UA;var eO=(e,t)=>new XA(e,t).major;const tO=UA;var nO=(e,t)=>new tO(e,t).minor;const rO=UA;var aO=(e,t)=>new rO(e,t).patch;const iO=GA;var oO=(e,t)=>{const n=iO(e,t);return n&&n.prerelease.length?n.prerelease:null};const sO=UA;var lO=(e,t,n)=>new sO(e,n).compare(new sO(t,n));const cO=lO;var uO=(e,t,n)=>cO(t,e,n);const dO=lO;var pO=(e,t)=>dO(e,t,!0);const hO=UA;var mO=(e,t,n)=>{const r=new hO(e,n),a=new hO(t,n);return r.compare(a)||r.compareBuild(a)};const fO=mO;var yO=(e,t)=>e.sort(((e,n)=>fO(e,n,t)));const gO=mO;var bO=(e,t)=>e.sort(((e,n)=>gO(n,e,t)));const vO=lO;var wO=(e,t,n)=>vO(e,t,n)>0;const SO=lO;var EO=(e,t,n)=>SO(e,t,n)<0;const xO=lO;var _O=(e,t,n)=>0===xO(e,t,n);const kO=lO;var IO=(e,t,n)=>0!==kO(e,t,n);const TO=lO;var AO=(e,t,n)=>TO(e,t,n)>=0;const OO=lO;var KO=(e,t,n)=>OO(e,t,n)<=0;const CO=_O,RO=IO,jO=wO,PO=AO,DO=EO,NO=KO;var LO=(e,t,n,r)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return CO(e,n,r);case"!=":return RO(e,n,r);case">":return jO(e,n,r);case">=":return PO(e,n,r);case"<":return DO(e,n,r);case"<=":return NO(e,n,r);default:throw new TypeError(`Invalid operator: ${t}`)}};const MO=UA,FO=GA,{safeRe:BO,t:VO}=kA.exports;var UO=(e,t)=>{if(e instanceof MO)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let n=null;if((t=t||{}).rtl){const r=t.includePrerelease?BO[VO.COERCERTLFULL]:BO[VO.COERCERTL];let a;for(;(a=r.exec(e))&&(!n||n.index+n[0].length!==e.length);)n&&a.index+a[0].length===n.index+n[0].length||(n=a),r.lastIndex=a.index+a[1].length+a[2].length;r.lastIndex=-1}else n=e.match(t.includePrerelease?BO[VO.COERCEFULL]:BO[VO.COERCE]);if(null===n)return null;const r=n[2],a=n[3]||"0",i=n[4]||"0",o=t.includePrerelease&&n[5]?`-${n[5]}`:"",s=t.includePrerelease&&n[6]?`+${n[6]}`:"";return FO(`${r}.${a}.${i}${o}${s}`,t)};var JO=class{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);return void 0===t?void 0:(this.map.delete(e),this.map.set(e,t),t)}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&void 0!==t){if(this.map.size>=this.max){const e=this.map.keys().next().value;this.delete(e)}this.map.set(e,t)}return this}};const GO=/\s+/g;class $O{constructor(e,t){if(t=WO(t),e instanceof $O)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new $O(e.raw,t);if(e instanceof YO)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(GO," "),this.set=this.raw.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!iK(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&oK(e[0])){this.set=[e];break}}this.formatted=void 0}get range(){if(void 0===this.formatted){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");const t=this.set[e];for(let e=0;e<t.length;e++)e>0&&(this.formatted+=" "),this.formatted+=t[e].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){const t=((this.options.includePrerelease&&rK)|(this.options.loose&&aK))+":"+e,n=zO.get(t);if(n)return n;const r=this.options.loose,a=r?ZO[XO.HYPHENRANGELOOSE]:ZO[XO.HYPHENRANGE];e=e.replace(a,bK(this.options.includePrerelease)),HO("hyphen replace",e),e=e.replace(ZO[XO.COMPARATORTRIM],eK),HO("comparator trim",e),e=e.replace(ZO[XO.TILDETRIM],tK),HO("tilde trim",e),e=e.replace(ZO[XO.CARETTRIM],nK),HO("caret trim",e);let i=e.split(" ").map((e=>lK(e,this.options))).join(" ").split(/\s+/).map((e=>gK(e,this.options)));r&&(i=i.filter((e=>(HO("loose invalid filter",e,this.options),!!e.match(ZO[XO.COMPARATORLOOSE]))))),HO("range list",i);const o=new Map,s=i.map((e=>new YO(e,this.options)));for(const e of s){if(iK(e))return[e];o.set(e.value,e)}o.size>1&&o.has("")&&o.delete("");const l=[...o.values()];return zO.set(t,l),l}intersects(e,t){if(!(e instanceof $O))throw new TypeError("a Range is required");return this.set.some((n=>sK(n,t)&&e.set.some((e=>sK(e,t)&&n.every((n=>e.every((e=>n.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new QO(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(vK(this.set[t],e,this.options))return!0;return!1}}var qO=$O;const zO=new JO,WO=KA,YO=EK,HO=TA,QO=UA,{safeRe:ZO,t:XO,comparatorTrimReplace:eK,tildeTrimReplace:tK,caretTrimReplace:nK}=kA.exports,{FLAG_INCLUDE_PRERELEASE:rK,FLAG_LOOSE:aK}=IA,iK=e=>"<0.0.0-0"===e.value,oK=e=>""===e.value,sK=(e,t)=>{let n=!0;const r=e.slice();let a=r.pop();for(;n&&r.length;)n=r.every((e=>a.intersects(e,t))),a=r.pop();return n},lK=(e,t)=>(HO("comp",e,t),e=pK(e,t),HO("caret",e),e=uK(e,t),HO("tildes",e),e=mK(e,t),HO("xrange",e),e=yK(e,t),HO("stars",e),e),cK=e=>!e||"x"===e.toLowerCase()||"*"===e,uK=(e,t)=>e.trim().split(/\s+/).map((e=>dK(e,t))).join(" "),dK=(e,t)=>{const n=t.loose?ZO[XO.TILDELOOSE]:ZO[XO.TILDE];return e.replace(n,((t,n,r,a,i)=>{let o;return HO("tilde",e,t,n,r,a,i),cK(n)?o="":cK(r)?o=`>=${n}.0.0 <${+n+1}.0.0-0`:cK(a)?o=`>=${n}.${r}.0 <${n}.${+r+1}.0-0`:i?(HO("replaceTilde pr",i),o=`>=${n}.${r}.${a}-${i} <${n}.${+r+1}.0-0`):o=`>=${n}.${r}.${a} <${n}.${+r+1}.0-0`,HO("tilde return",o),o}))},pK=(e,t)=>e.trim().split(/\s+/).map((e=>hK(e,t))).join(" "),hK=(e,t)=>{HO("caret",e,t);const n=t.loose?ZO[XO.CARETLOOSE]:ZO[XO.CARET],r=t.includePrerelease?"-0":"";return e.replace(n,((t,n,a,i,o)=>{let s;return HO("caret",e,t,n,a,i,o),cK(n)?s="":cK(a)?s=`>=${n}.0.0${r} <${+n+1}.0.0-0`:cK(i)?s="0"===n?`>=${n}.${a}.0${r} <${n}.${+a+1}.0-0`:`>=${n}.${a}.0${r} <${+n+1}.0.0-0`:o?(HO("replaceCaret pr",o),s="0"===n?"0"===a?`>=${n}.${a}.${i}-${o} <${n}.${a}.${+i+1}-0`:`>=${n}.${a}.${i}-${o} <${n}.${+a+1}.0-0`:`>=${n}.${a}.${i}-${o} <${+n+1}.0.0-0`):(HO("no pr"),s="0"===n?"0"===a?`>=${n}.${a}.${i}${r} <${n}.${a}.${+i+1}-0`:`>=${n}.${a}.${i}${r} <${n}.${+a+1}.0-0`:`>=${n}.${a}.${i} <${+n+1}.0.0-0`),HO("caret return",s),s}))},mK=(e,t)=>(HO("replaceXRanges",e,t),e.split(/\s+/).map((e=>fK(e,t))).join(" ")),fK=(e,t)=>{e=e.trim();const n=t.loose?ZO[XO.XRANGELOOSE]:ZO[XO.XRANGE];return e.replace(n,((n,r,a,i,o,s)=>{HO("xRange",e,n,r,a,i,o,s);const l=cK(a),c=l||cK(i),u=c||cK(o),d=u;return"="===r&&d&&(r=""),s=t.includePrerelease?"-0":"",l?n=">"===r||"<"===r?"<0.0.0-0":"*":r&&d?(c&&(i=0),o=0,">"===r?(r=">=",c?(a=+a+1,i=0,o=0):(i=+i+1,o=0)):"<="===r&&(r="<",c?a=+a+1:i=+i+1),"<"===r&&(s="-0"),n=`${r+a}.${i}.${o}${s}`):c?n=`>=${a}.0.0${s} <${+a+1}.0.0-0`:u&&(n=`>=${a}.${i}.0${s} <${a}.${+i+1}.0-0`),HO("xRange return",n),n}))},yK=(e,t)=>(HO("replaceStars",e,t),e.trim().replace(ZO[XO.STAR],"")),gK=(e,t)=>(HO("replaceGTE0",e,t),e.trim().replace(ZO[t.includePrerelease?XO.GTE0PRE:XO.GTE0],"")),bK=e=>(t,n,r,a,i,o,s,l,c,u,d,p)=>`${n=cK(r)?"":cK(a)?`>=${r}.0.0${e?"-0":""}`:cK(i)?`>=${r}.${a}.0${e?"-0":""}`:o?`>=${n}`:`>=${n}${e?"-0":""}`} ${l=cK(c)?"":cK(u)?`<${+c+1}.0.0-0`:cK(d)?`<${c}.${+u+1}.0-0`:p?`<=${c}.${u}.${d}-${p}`:e?`<${c}.${u}.${+d+1}-0`:`<=${l}`}`.trim(),vK=(e,t,n)=>{for(let n=0;n<e.length;n++)if(!e[n].test(t))return!1;if(t.prerelease.length&&!n.includePrerelease){for(let n=0;n<e.length;n++)if(HO(e[n].semver),e[n].semver!==YO.ANY&&e[n].semver.prerelease.length>0){const r=e[n].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0},wK=Symbol("SemVer ANY");class SK{static get ANY(){return wK}constructor(e,t){if(t=xK(t),e instanceof SK){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),TK("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===wK?this.value="":this.value=this.operator+this.semver.version,TK("comp",this)}parse(e){const t=this.options.loose?_K[kK.COMPARATORLOOSE]:_K[kK.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==n[1]?n[1]:"","="===this.operator&&(this.operator=""),n[2]?this.semver=new AK(n[2],this.options.loose):this.semver=wK}toString(){return this.value}test(e){if(TK("Comparator.test",e,this.options.loose),this.semver===wK||e===wK)return!0;if("string"==typeof e)try{e=new AK(e,this.options)}catch(e){return!1}return IK(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof SK))throw new TypeError("a Comparator is required");return""===this.operator?""===this.value||new OK(e.value,t).test(this.value):""===e.operator?""===e.value||new OK(this.value,t).test(e.semver):(!(t=xK(t)).includePrerelease||"<0.0.0-0"!==this.value&&"<0.0.0-0"!==e.value)&&(!(!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0")))&&(!(!this.operator.startsWith(">")||!e.operator.startsWith(">"))||(!(!this.operator.startsWith("<")||!e.operator.startsWith("<"))||(!(this.semver.version!==e.semver.version||!this.operator.includes("=")||!e.operator.includes("="))||(!!(IK(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<"))||!!(IK(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))))))}}var EK=SK;const xK=KA,{safeRe:_K,t:kK}=kA.exports,IK=LO,TK=TA,AK=UA,OK=qO,KK=qO;var CK=(e,t,n)=>{try{t=new KK(t,n)}catch(e){return!1}return t.test(e)};const RK=qO;var jK=(e,t)=>new RK(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")));const PK=UA,DK=qO;var NK=(e,t,n)=>{let r=null,a=null,i=null;try{i=new DK(t,n)}catch(e){return null}return e.forEach((e=>{i.test(e)&&(r&&-1!==a.compare(e)||(r=e,a=new PK(r,n)))})),r};const LK=UA,MK=qO;var FK=(e,t,n)=>{let r=null,a=null,i=null;try{i=new MK(t,n)}catch(e){return null}return e.forEach((e=>{i.test(e)&&(r&&1!==a.compare(e)||(r=e,a=new LK(r,n)))})),r};const BK=UA,VK=qO,UK=wO;var JK=(e,t)=>{e=new VK(e,t);let n=new BK("0.0.0");if(e.test(n))return n;if(n=new BK("0.0.0-0"),e.test(n))return n;n=null;for(let t=0;t<e.set.length;++t){const r=e.set[t];let a=null;r.forEach((e=>{const t=new BK(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":a&&!UK(t,a)||(a=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!a||n&&!UK(n,a)||(n=a)}return n&&e.test(n)?n:null};const GK=qO;var $K=(e,t)=>{try{return new GK(e,t).range||"*"}catch(e){return null}};const qK=UA,zK=EK,{ANY:WK}=zK,YK=qO,HK=CK,QK=wO,ZK=EO,XK=KO,eC=AO;var tC=(e,t,n,r)=>{let a,i,o,s,l;switch(e=new qK(e,r),t=new YK(t,r),n){case">":a=QK,i=XK,o=ZK,s=">",l=">=";break;case"<":a=ZK,i=eC,o=QK,s="<",l="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(HK(e,t,r))return!1;for(let n=0;n<t.set.length;++n){const c=t.set[n];let u=null,d=null;if(c.forEach((e=>{e.semver===WK&&(e=new zK(">=0.0.0")),u=u||e,d=d||e,a(e.semver,u.semver,r)?u=e:o(e.semver,d.semver,r)&&(d=e)})),u.operator===s||u.operator===l)return!1;if((!d.operator||d.operator===s)&&i(e,d.semver))return!1;if(d.operator===l&&o(e,d.semver))return!1}return!0};const nC=tC;var rC=(e,t,n)=>nC(e,t,">",n);const aC=tC;var iC=(e,t,n)=>aC(e,t,"<",n);const oC=qO;var sC=(e,t,n)=>(e=new oC(e,n),t=new oC(t,n),e.intersects(t,n));const lC=CK,cC=lO;const uC=qO,dC=EK,{ANY:pC}=dC,hC=CK,mC=lO,fC=[new dC(">=0.0.0-0")],yC=[new dC(">=0.0.0")],gC=(e,t,n)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===pC){if(1===t.length&&t[0].semver===pC)return!0;e=n.includePrerelease?fC:yC}if(1===t.length&&t[0].semver===pC){if(n.includePrerelease)return!0;t=yC}const r=new Set;let a,i,o,s,l,c,u;for(const t of e)">"===t.operator||">="===t.operator?a=bC(a,t,n):"<"===t.operator||"<="===t.operator?i=vC(i,t,n):r.add(t.semver);if(r.size>1)return null;if(a&&i){if(o=mC(a.semver,i.semver,n),o>0)return null;if(0===o&&(">="!==a.operator||"<="!==i.operator))return null}for(const e of r){if(a&&!hC(e,String(a),n))return null;if(i&&!hC(e,String(i),n))return null;for(const r of t)if(!hC(e,String(r),n))return!1;return!0}let d=!(!i||n.includePrerelease||!i.semver.prerelease.length)&&i.semver,p=!(!a||n.includePrerelease||!a.semver.prerelease.length)&&a.semver;d&&1===d.prerelease.length&&"<"===i.operator&&0===d.prerelease[0]&&(d=!1);for(const e of t){if(u=u||">"===e.operator||">="===e.operator,c=c||"<"===e.operator||"<="===e.operator,a)if(p&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===p.major&&e.semver.minor===p.minor&&e.semver.patch===p.patch&&(p=!1),">"===e.operator||">="===e.operator){if(s=bC(a,e,n),s===e&&s!==a)return!1}else if(">="===a.operator&&!hC(a.semver,String(e),n))return!1;if(i)if(d&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===d.major&&e.semver.minor===d.minor&&e.semver.patch===d.patch&&(d=!1),"<"===e.operator||"<="===e.operator){if(l=vC(i,e,n),l===e&&l!==i)return!1}else if("<="===i.operator&&!hC(i.semver,String(e),n))return!1;if(!e.operator&&(i||a)&&0!==o)return!1}return!(a&&c&&!i&&0!==o)&&(!(i&&u&&!a&&0!==o)&&(!p&&!d))},bC=(e,t,n)=>{if(!e)return t;const r=mC(e.semver,t.semver,n);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},vC=(e,t,n)=>{if(!e)return t;const r=mC(e.semver,t.semver,n);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};const wC=kA.exports,SC=IA,EC=jA,xC=(e,t,n)=>{const r=[];let a=null,i=null;const o=e.sort(((e,t)=>cC(e,t,n)));for(const e of o){lC(e,t,n)?(i=e,a||(a=e)):(i&&r.push([a,i]),i=null,a=null)}a&&r.push([a,null]);const s=[];for(const[e,t]of r)e===t?s.push(e):t||e!==o[0]?t?e===o[0]?s.push(`<=${t}`):s.push(`${e} - ${t}`):s.push(`>=${e}`):s.push("*");const l=s.join(" || "),c="string"==typeof t.raw?t.raw:String(t);return l.length<c.length?l:t};var _C={parse:GA,valid:qA,clean:WA,inc:HA,diff:ZA,major:eO,minor:nO,patch:aO,prerelease:oO,compare:lO,rcompare:uO,compareLoose:pO,compareBuild:mO,sort:yO,rsort:bO,gt:wO,lt:EO,eq:_O,neq:IO,gte:AO,lte:KO,cmp:LO,coerce:UO,Comparator:EK,Range:qO,satisfies:CK,toComparators:jK,maxSatisfying:NK,minSatisfying:FK,minVersion:JK,validRange:$K,outside:tC,gtr:rC,ltr:iC,intersects:sC,simplifyRange:xC,subset:(e,t,n={})=>{if(e===t)return!0;e=new uC(e,n),t=new uC(t,n);let r=!1;e:for(const a of e.set){for(const e of t.set){const t=gC(a,e,n);if(r=r||null!==t,t)continue e}if(r)return!1}return!0},SemVer:UA,re:wC.re,src:wC.src,tokens:wC.t,SEMVER_SPEC_VERSION:SC.SEMVER_SPEC_VERSION,RELEASE_TYPES:SC.RELEASE_TYPES,compareIdentifiers:EC.compareIdentifiers,rcompareIdentifiers:EC.rcompareIdentifiers};const kC={value:null};function IC(e,t,n){try{return e.apply(t,n)}catch(e){return kC.value=e,kC}}function TC(e){const t={};for(let n=0;n<e.length;n+=2)t[e[n]]=e[n+1];return t}function AC(e){const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&void 0!==e[n]&&(t[t.length]=n,t[t.length]=e[n]);return t}function OC(e,t){return new Promise((n=>{let r;const a=()=>{null==t||t.signal.removeEventListener("abort",a),clearTimeout(r),n()};r=setTimeout(a,e),null==t||t.signal.addEventListener("abort",a)}))}function KC(e,t){const n=e.getMaxListeners();e.setMaxListeners(n+t)}const CC={de:"deduplication",fpof:"failParentOnFailure",cpof:"continueParentOnFailure",idof:"ignoreDependencyOnFailure",kl:"keepLogs",rdof:"removeDependencyOnFailure"},RC=Object.assign(Object.assign({},(jC=CC,Object.entries(jC).reduce(((e,[t,n])=>(e[n]=t,e)),{}))),{debounce:"de"});var jC;function PC(e){if(!e)return!1;return["connect","disconnect","duplicate"].every((t=>"function"==typeof e[t]))}function DC(e,t){KC(e,-t)}function NC(e){if(e)return`${e.queue}:${e.id}`}const LC=/ERR unknown command ['`]\s*client\s*['`]/;function MC(e){const t=`${e.message}`;return t!==GE.CONNECTION_CLOSED_ERROR_MSG&&!t.includes("ECONNREFUSED")}const FC=e=>new xA({keys:e.keys,client:e.client,get redisVersion(){return e.redisVersion},toKey:e.toKey,opts:e.opts,closing:e.closing}),BC=(e,t)=>{const n=_C.valid(_C.coerce(e));return _C.lt(n,t)},VC=e=>{const t={};for(const n of Object.entries(e))t[n[0]]=JSON.parse(n[1]);return t};var UC;!function(e){e[e.Idle=0]="Idle",e[e.Started=1]="Started",e[e.Terminating=2]="Terminating",e[e.Errored=3]="Errored"}(UC||(UC={}));class JC extends Error{constructor(e="bullmq:movedToDelayed"){super(e),this.name=this.constructor.name,Object.setPrototypeOf(this,new.target.prototype)}}class GC extends Error{constructor(e="bullmq:rateLimitExceeded"){super(e),this.name=this.constructor.name,Object.setPrototypeOf(this,new.target.prototype)}}class $C extends Error{constructor(e="bullmq:unrecoverable"){super(e),this.name=this.constructor.name,Object.setPrototypeOf(this,new.target.prototype)}}class qC extends Error{constructor(e="bullmq:movedToWaitingChildren"){super(e),this.name=this.constructor.name,Object.setPrototypeOf(this,new.target.prototype)}}class zC extends Error{constructor(e="bullmq:movedToWait"){super(e),this.name=this.constructor.name,Object.setPrototypeOf(this,new.target.prototype)}}let WC;const YC=new Uint8Array(16);function HC(){if(!WC&&(WC="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!WC))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return WC(YC)}const QC=[];for(let e=0;e<256;++e)QC.push((e+256).toString(16).slice(1));var ZC={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function XC(e,t,n){if(ZC.randomUUID&&!t&&!e)return ZC.randomUUID();const r=(e=e||{}).random||(e.rng||HC)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return QC[e[t+0]]+QC[e[t+1]]+QC[e[t+2]]+QC[e[t+3]]+"-"+QC[e[t+4]]+QC[e[t+5]]+"-"+QC[e[t+6]]+QC[e[t+7]]+"-"+QC[e[t+8]]+QC[e[t+9]]+"-"+QC[e[t+10]]+QC[e[t+11]]+QC[e[t+12]]+QC[e[t+13]]+QC[e[t+14]]+QC[e[t+15]]}(r)}function eR(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}const tR=o.debuglog("bull");class nR{constructor(e,t,n,r={},a){this.queue=e,this.name=t,this.data=n,this.opts=r,this.id=a,this.progress=0,this.returnvalue=null,this.stacktrace=null,this.delay=0,this.priority=0,this.attemptsStarted=0,this.attemptsMade=0,this.stalledCounter=0;const i=this.opts,{repeatJobKey:o}=i,s=eR(i,["repeatJobKey"]);this.opts=Object.assign({attempts:0},s),this.delay=this.opts.delay,this.priority=this.opts.priority||0,this.repeatJobKey=o,this.timestamp=r.timestamp?r.timestamp:Date.now(),this.opts.backoff=pE.normalize(r.backoff),this.parentKey=NC(r.parent),r.parent&&(this.parent={id:r.parent.id,queueKey:r.parent.queue},r.failParentOnFailure&&(this.parent.fpof=!0),r.removeDependencyOnFailure&&(this.parent.rdof=!0),r.ignoreDependencyOnFailure&&(this.parent.idof=!0),r.continueParentOnFailure&&(this.parent.cpof=!0)),this.debounceId=r.debounce?r.debounce.id:void 0,this.deduplicationId=r.deduplication?r.deduplication.id:this.debounceId,this.toKey=e.toKey.bind(e),this.createScripts(),this.queueQualifiedName=e.qualifiedName}static async create(e,t,n,r){const a=await e.client,i=new this(e,t,n,r,r&&r.jobId);return i.id=await i.addJob(a,{parentKey:i.parentKey,parentDependenciesKey:i.parentKey?`${i.parentKey}:dependencies`:""}),i}static async createBulk(e,t){const n=await e.client,r=t.map((t=>{var n;return new this(e,t.name,t.data,t.opts,null===(n=t.opts)||void 0===n?void 0:n.jobId)})),a=n.pipeline();for(const e of r)e.addJob(a,{parentKey:e.parentKey,parentDependenciesKey:e.parentKey?`${e.parentKey}:dependencies`:""});const i=await a.exec();for(let e=0;e<i.length;++e){const[t,n]=i[e];if(t)throw t;r[e].id=n}return r}static fromJSON(e,t,n){const r=JSON.parse(t.data||"{}"),a=nR.optsFromJSON(t.opts),i=new this(e,t.name,r,a,t.id||n);return i.progress=JSON.parse(t.progress||"0"),i.delay=parseInt(t.delay),i.priority=parseInt(t.priority),i.timestamp=parseInt(t.timestamp),t.finishedOn&&(i.finishedOn=parseInt(t.finishedOn)),t.processedOn&&(i.processedOn=parseInt(t.processedOn)),t.rjk&&(i.repeatJobKey=t.rjk),t.deid&&(i.debounceId=t.deid,i.deduplicationId=t.deid),t.failedReason&&(i.failedReason=t.failedReason),i.attemptsStarted=parseInt(t.ats||"0"),i.attemptsMade=parseInt(t.attemptsMade||t.atm||"0"),i.stalledCounter=parseInt(t.stc||"0"),t.defa&&(i.deferredFailure=t.defa),i.stacktrace=function(e){const t=IC(JSON.parse,JSON,[e]);return t!==kC&&t instanceof Array?t:[]}(t.stacktrace),"string"==typeof t.returnvalue&&(i.returnvalue=rR(t.returnvalue)),t.parentKey&&(i.parentKey=t.parentKey),t.parent&&(i.parent=JSON.parse(t.parent)),t.pb&&(i.processedBy=t.pb),t.nrjid&&(i.nextRepeatableJobId=t.nrjid),i}createScripts(){this.scripts=FC(this.queue)}static optsFromJSON(e,t=CC){const n=JSON.parse(e||"{}"),r=Object.entries(n),a={};for(const e of r){const[n,r]=e;t[n]?a[t[n]]=r:"tm"===n?a.telemetry=Object.assign(Object.assign({},a.telemetry),{metadata:r}):"omc"===n?a.telemetry=Object.assign(Object.assign({},a.telemetry),{omitContext:r}):a[n]=r}return a}static async fromId(e,t){if(t){const n=await e.client,r=await n.hgetall(e.toKey(t));return function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(r)?void 0:this.fromJSON(e,r,t)}}static addJobLog(e,t,n,r){return e.scripts.addLog(t,n,r)}toJSON(){return eR(this,["queue","scripts"])}asJSON(){return function(e){const t={};for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}({id:this.id,name:this.name,data:JSON.stringify(void 0===this.data?{}:this.data),opts:nR.optsAsJSON(this.opts),parent:this.parent?Object.assign({},this.parent):void 0,parentKey:this.parentKey,progress:this.progress,attemptsMade:this.attemptsMade,attemptsStarted:this.attemptsStarted,stalledCounter:this.stalledCounter,finishedOn:this.finishedOn,processedOn:this.processedOn,timestamp:this.timestamp,failedReason:JSON.stringify(this.failedReason),stacktrace:JSON.stringify(this.stacktrace),debounceId:this.debounceId,deduplicationId:this.deduplicationId,repeatJobKey:this.repeatJobKey,returnvalue:JSON.stringify(this.returnvalue),nrjid:this.nextRepeatableJobId})}static optsAsJSON(e={},t=RC){const n=Object.entries(e),r={};for(const[e,a]of n)if(void 0!==a)if(e in t){r[t[e]]=a}else"telemetry"===e?(r.tm=a.metadata,r.omc=a.omitContext):r[e]=a;return r}asJSONSandbox(){return Object.assign(Object.assign({},this.asJSON()),{queueName:this.queueName,prefix:this.prefix})}updateData(e){return this.data=e,this.scripts.updateData(this,e)}async updateProgress(e){this.progress=e,await this.scripts.updateProgress(this.id,e),this.queue.emit("progress",this,e)}async log(e){return nR.addJobLog(this.queue,this.id,e,this.opts.keepLogs)}async removeChildDependency(){return!!await this.scripts.removeChildDependency(this.id,this.parentKey)&&(this.parent=void 0,this.parentKey=void 0,!0)}async clearLogs(e){const t=await this.queue.client,n=this.toKey(this.id)+":logs";e?await t.ltrim(n,-e,-1):await t.del(n)}async remove({removeChildren:e=!0}={}){await this.queue.waitUntilReady();const t=this.queue,n=this;if(!await this.scripts.remove(n.id,e))throw new Error(`Job ${this.id} could not be removed because it is locked by another worker`);t.emit("removed",n)}async removeUnprocessedChildren(){const e=this.id;await this.scripts.removeUnprocessedChildren(e)}extendLock(e,t){return this.scripts.extendLock(this.id,e,t)}async moveToCompleted(e,t,n=!0){return this.queue.trace(oE.INTERNAL,"complete",this.queue.name,(async(r,a)=>{var i,o;null===(o=null===(i=this.opts)||void 0===i?void 0:i.telemetry)||void 0===o||o.omitContext,await this.queue.waitUntilReady(),this.returnvalue=e||void 0;const s=IC(JSON.stringify,JSON,[e]);if(s===kC)throw kC.value;const l=this.scripts.moveToCompletedArgs(this,s,this.opts.removeOnComplete,t,n),c=await this.scripts.moveToFinished(this.id,l);return this.finishedOn=l[this.scripts.moveToFinishedKeys.length+1],this.attemptsMade+=1,c}))}moveToWait(e){return this.scripts.moveJobFromActiveToWait(this.id,e)}async shouldRetryJob(e){if(this.attemptsMade+1<this.opts.attempts&&!this.discarded&&!(e instanceof $C||"UnrecoverableError"==e.name)){const t=this.queue.opts,n=await pE.calculate(this.opts.backoff,this.attemptsMade+1,e,this,t.settings&&t.settings.backoffStrategy);return[-1!=n,-1==n?0:n]}return[!1,0]}async moveToFailed(e,t,n=!1){this.failedReason=null==e?void 0:e.message;const[r,a]=await this.shouldRetryJob(e);return this.queue.trace(oE.INTERNAL,this.getSpanOperation(r,a),this.queue.name,(async(i,o)=>{var s,l;let c,u;!(null===(l=null===(s=this.opts)||void 0===s?void 0:s.telemetry)||void 0===l?void 0:l.omitContext)&&o&&(c=o),this.updateStacktrace(e);const d={failedReason:this.failedReason,stacktrace:JSON.stringify(this.stacktrace),tm:c};let p;if(r)u=a?await this.scripts.moveToDelayed(this.id,Date.now(),a,t,{fieldsToUpdate:d}):await this.scripts.retryJob(this.id,this.opts.lifo,t,{fieldsToUpdate:d});else{const e=this.scripts.moveToFailedArgs(this,this.failedReason,this.opts.removeOnFail,t,n,d);u=await this.scripts.moveToFinished(this.id,e),p=e[this.scripts.moveToFinishedKeys.length+1]}return p&&"number"==typeof p&&(this.finishedOn=p),a&&"number"==typeof a&&(this.delay=a),this.attemptsMade+=1,u}))}getSpanOperation(e,t){return e?t?"delay":"retry":"fail"}isCompleted(){return this.isInZSet("completed")}isFailed(){return this.isInZSet("failed")}isDelayed(){return this.isInZSet("delayed")}isWaitingChildren(){return this.isInZSet("waiting-children")}isActive(){return this.isInList("active")}async isWaiting(){return await this.isInList("wait")||await this.isInList("paused")}get queueName(){return this.queue.name}get prefix(){return this.queue.opts.prefix}getState(){return this.scripts.getState(this.id)}async changeDelay(e){await this.scripts.changeDelay(this.id,e),this.delay=e}async changePriority(e){await this.scripts.changePriority(this.id,e.priority,e.lifo),this.priority=e.priority||0}async getChildrenValues(){const e=await this.queue.client,t=await e.hgetall(this.toKey(`${this.id}:processed`));if(t)return VC(t)}async getIgnoredChildrenFailures(){return(await this.queue.client).hgetall(this.toKey(`${this.id}:failed`))}async getFailedChildrenValues(){return(await this.queue.client).hgetall(this.toKey(`${this.id}:failed`))}async getDependencies(e={}){const t=(await this.queue.client).multi();if(e.processed||e.unprocessed||e.ignored||e.failed){const n={cursor:0,count:20},r=[];if(e.processed){r.push("processed");const a=Object.assign(Object.assign({},n),e.processed);t.hscan(this.toKey(`${this.id}:processed`),a.cursor,"COUNT",a.count)}if(e.unprocessed){r.push("unprocessed");const a=Object.assign(Object.assign({},n),e.unprocessed);t.sscan(this.toKey(`${this.id}:dependencies`),a.cursor,"COUNT",a.count)}if(e.ignored){r.push("ignored");const a=Object.assign(Object.assign({},n),e.ignored);t.hscan(this.toKey(`${this.id}:failed`),a.cursor,"COUNT",a.count)}let a;if(e.failed){r.push("failed");const i=Object.assign(Object.assign({},n),e.failed);a=i.cursor+i.count,t.zrange(this.toKey(`${this.id}:unsuccessful`),i.cursor,i.count-1)}const i=await t.exec();let o,s,l,c,u,d,p;return r.forEach(((e,t)=>{switch(e){case"processed":{o=i[t][1][0];const e=i[t][1][1],n={};for(let t=0;t<e.length;++t)t%2&&(n[e[t-1]]=JSON.parse(e[t]));s=n;break}case"failed":u=i[t][1];break;case"ignored":{d=i[t][1][0];const e=i[t][1][1],n={};for(let t=0;t<e.length;++t)t%2&&(n[e[t-1]]=e[t]);p=n;break}case"unprocessed":l=i[t][1][0],c=i[t][1][1]}})),Object.assign(Object.assign(Object.assign(Object.assign({},o?{processed:s,nextProcessedCursor:Number(o)}:{}),d?{ignored:p,nextIgnoredCursor:Number(d)}:{}),a?{failed:u,nextFailedCursor:a}:{}),l?{unprocessed:c,nextUnprocessedCursor:Number(l)}:{})}{t.hgetall(this.toKey(`${this.id}:processed`)),t.smembers(this.toKey(`${this.id}:dependencies`)),t.hgetall(this.toKey(`${this.id}:failed`)),t.zrange(this.toKey(`${this.id}:unsuccessful`),0,-1);const[[e,n],[r,a],[i,o],[s,l]]=await t.exec();return{processed:VC(n),unprocessed:a,failed:l,ignored:o}}}async getDependenciesCount(e={}){const t=[];Object.entries(e).forEach((([e,n])=>{n&&t.push(e)}));const n=t.length?t:["processed","unprocessed","ignored","failed"],r=await this.scripts.getDependencyCounts(this.id,n),a={};return r.forEach(((e,t)=>{a[`${n[t]}`]=e||0})),a}async waitUntilFinished(e,t){await this.queue.waitUntilReady();const n=this.id;return new Promise((async(r,a)=>{let i;function o(e){u(),r(e.returnvalue)}function s(e){u(),a(new Error(e.failedReason||e))}t&&(i=setTimeout((()=>s(`Job wait ${this.name} timed out before finishing, no finish notification arrived after ${t}ms (id=${n})`)),t));const l=`completed:${n}`,c=`failed:${n}`;e.on(l,o),e.on(c,s),this.queue.on("closing",s);const u=()=>{clearInterval(i),e.removeListener(l,o),e.removeListener(c,s),this.queue.removeListener("closing",s)};await e.waitUntilReady();const[d,p]=await this.scripts.isFinished(n,!0);0!=d&&(-1==d||2==d?s({failedReason:p}):o({returnvalue:rR(p)}))}))}async moveToDelayed(e,t){const n=Date.now(),r=e-n,a=r>0?r:0,i=await this.scripts.moveToDelayed(this.id,n,a,t,{skipAttempt:!0});return this.delay=a,i}async moveToWaitingChildren(e,t={}){return await this.scripts.moveToWaitingChildren(this.id,e,t)}async promote(){const e=this.id;await this.scripts.promote(e),this.delay=0}retry(e="failed"){return this.failedReason=null,this.finishedOn=null,this.processedOn=null,this.returnvalue=null,this.scripts.reprocessJob(this,e)}discard(){this.discarded=!0}async isInZSet(e){const t=await this.queue.client;return null!==await t.zscore(this.queue.toKey(e),this.id)}async isInList(e){return this.scripts.isJobInList(this.queue.toKey(e),this.id)}addJob(e,t){const n=this.asJSON();return this.validateOptions(n),this.scripts.addJob(e,n,n.opts,this.id,t)}validateOptions(e){var t;var n;if(this.opts.sizeLimit&&(n=e.data,Buffer.byteLength(n,"utf8")>this.opts.sizeLimit))throw new Error(`The size of job ${this.name} exceeds the limit ${this.opts.sizeLimit} bytes`);if(this.opts.delay&&this.opts.repeat&&!(null===(t=this.opts.repeat)||void 0===t?void 0:t.count))throw new Error("Delay and repeat options could not be used together");const r=["removeDependencyOnFailure","failParentOnFailure","continueParentOnFailure","ignoreDependencyOnFailure"].filter((e=>this.opts[e]));if(r.length>1){const e=r.join(", ");throw new Error(`The following options cannot be used together: ${e}`)}if(`${parseInt(this.id,10)}`===this.id)throw new Error("Custom Ids cannot be integers");if(this.opts.priority){if(Math.trunc(this.opts.priority)!==this.opts.priority)throw new Error("Priority should not be float");if(this.opts.priority>2097152)throw new Error("Priority should be between 0 and 2097152")}if("object"==typeof this.opts.backoff&&"number"==typeof this.opts.backoff.jitter&&(this.opts.backoff.jitter<0||this.opts.backoff.jitter>1))throw new Error("Jitter should be between 0 and 1")}updateStacktrace(e){this.stacktrace=this.stacktrace||[],(null==e?void 0:e.stack)&&(this.stacktrace.push(e.stack),0===this.opts.stackTraceLimit?this.stacktrace=[]:this.opts.stackTraceLimit&&(this.stacktrace=this.stacktrace.slice(-this.opts.stackTraceLimit)))}}function rR(e){const t=IC(JSON.parse,JSON,[e]);if(t!==kC)return t;tR("corrupted returnvalue: "+e,t)}class aR{constructor(e="bull"){this.prefix=e}getKeys(e){const t={};return["","active","wait","waiting-children","paused","id","delayed","prioritized","stalled-check","completed","failed","stalled","repeat","limiter","meta","events","pc","marker","de"].forEach((n=>{t[n]=this.toKey(e,n)})),t}toKey(e,t){return`${this.getQueueQualifiedName(e)}:${t}`}getQueueQualifiedName(e){return`${this.prefix}:${e}`}}const iR={name:"addDelayedJob",content:'--[[\n  Adds a delayed job to the queue by doing the following:\n    - Increases the job counter if needed.\n    - Creates a new job key with the job data.\n    - computes timestamp.\n    - adds to delayed zset.\n    - Emits a global event \'delayed\' if the job is delayed.\n    Input:\n      KEYS[1] \'marker\',\n      KEYS[2] \'meta\'\n      KEYS[3] \'id\'\n      KEYS[4] \'delayed\'\n      KEYS[5] \'completed\'\n      KEYS[6] events stream key\n      ARGV[1] msgpacked arguments array\n            [1]  key prefix,\n            [2]  custom id (use custom instead of one generated automatically)\n            [3]  name\n            [4]  timestamp\n            [5]  parentKey?\n          x [6]  waitChildrenKey key.\n            [7]  parent dependencies key.\n            [8]  parent? {id, queueKey}\n            [9]  repeat job key\n            [10] deduplication key\n      ARGV[2] Json stringified job data\n      ARGV[3] msgpacked options\n      Output:\n        jobId  - OK\n        -5     - Missing parent key\n]]\nlocal metaKey = KEYS[2]\nlocal idKey = KEYS[3]\nlocal delayedKey = KEYS[4]\nlocal completedKey = KEYS[5]\nlocal eventsKey = KEYS[6]\nlocal jobId\nlocal jobIdKey\nlocal rcall = redis.call\nlocal args = cmsgpack.unpack(ARGV[1])\nlocal data = ARGV[2]\nlocal parentKey = args[5]\nlocal parent = args[8]\nlocal repeatJobKey = args[9]\nlocal deduplicationKey = args[10]\nlocal parentData\n-- Includes\n--[[\n  Adds a delayed job to the queue by doing the following:\n    - Creates a new job key with the job data.\n    - adds to delayed zset.\n    - Emits a global event \'delayed\' if the job is delayed.\n]]\n-- Includes\n--[[\n  Add delay marker if needed.\n]]\n-- Includes\n--[[\n  Function to return the next delayed job timestamp.\n]]\nlocal function getNextDelayedTimestamp(delayedKey)\n  local result = rcall("ZRANGE", delayedKey, 0, 0, "WITHSCORES")\n  if #result then\n    local nextTimestamp = tonumber(result[2])\n    if nextTimestamp ~= nil then\n      return nextTimestamp / 0x1000\n    end\n  end\nend\nlocal function addDelayMarkerIfNeeded(markerKey, delayedKey)\n  local nextTimestamp = getNextDelayedTimestamp(delayedKey)\n  if nextTimestamp ~= nil then\n    -- Replace the score of the marker with the newest known\n    -- next timestamp.\n    rcall("ZADD", markerKey, nextTimestamp, "1")\n  end\nend\n--[[\n  Bake in the job id first 12 bits into the timestamp\n  to guarantee correct execution order of delayed jobs\n  (up to 4096 jobs per given timestamp or 4096 jobs apart per timestamp)\n  WARNING: Jobs that are so far apart that they wrap around will cause FIFO to fail\n]]\nlocal function getDelayedScore(delayedKey, timestamp, delay)\n  local delayedTimestamp = (delay > 0 and (tonumber(timestamp) + delay)) or tonumber(timestamp)\n  local minScore = delayedTimestamp * 0x1000\n  local maxScore = (delayedTimestamp + 1 ) * 0x1000 - 1\n  local result = rcall("ZREVRANGEBYSCORE", delayedKey, maxScore,\n    minScore, "WITHSCORES","LIMIT", 0, 1)\n  if #result then\n    local currentMaxScore = tonumber(result[2])\n    if currentMaxScore ~= nil then\n      if currentMaxScore >= maxScore then\n        return maxScore, delayedTimestamp\n      else\n        return currentMaxScore + 1, delayedTimestamp\n      end\n    end\n  end\n  return minScore, delayedTimestamp\nend\nlocal function addDelayedJob(jobId, delayedKey, eventsKey, timestamp,\n  maxEvents, markerKey, delay)\n  local score, delayedTimestamp = getDelayedScore(delayedKey, timestamp, tonumber(delay))\n  rcall("ZADD", delayedKey, score, jobId)\n  rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "delayed",\n    "jobId", jobId, "delay", delayedTimestamp)\n  -- mark that a delayed job is available\n  addDelayMarkerIfNeeded(markerKey, delayedKey)\nend\n--[[\n  Function to debounce a job.\n]]\n-- Includes\n--[[\n  Function to remove job keys.\n]]\nlocal function removeJobKeys(jobKey)\n  return rcall("DEL", jobKey, jobKey .. \':logs\', jobKey .. \':dependencies\',\n    jobKey .. \':processed\', jobKey .. \':failed\', jobKey .. \':unsuccessful\')\nend\nlocal function deduplicateJob(deduplicationOpts, jobId, delayedKey, deduplicationKey, eventsKey, maxEvents,\n    prefix)\n    local deduplicationId = deduplicationOpts and deduplicationOpts[\'id\']\n    if deduplicationId then\n        local ttl = deduplicationOpts[\'ttl\']\n        if deduplicationOpts[\'replace\'] and ttl and ttl > 0 then\n            local currentDebounceJobId = rcall(\'GET\', deduplicationKey)\n            if currentDebounceJobId then\n                if rcall("ZREM", delayedKey, currentDebounceJobId) > 0 then\n                    removeJobKeys(prefix .. currentDebounceJobId)\n                    rcall("XADD", eventsKey, "*", "event", "removed", "jobId", currentDebounceJobId,\n                        "prev", "delayed")\n                    if deduplicationOpts[\'extend\'] then\n                        rcall(\'SET\', deduplicationKey, jobId, \'PX\', ttl)\n                    else\n                        rcall(\'SET\', deduplicationKey, jobId, \'KEEPTTL\')\n                    end\n                    rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "deduplicated", "jobId",\n                        jobId, "deduplicationId", deduplicationId, "deduplicatedJobId", currentDebounceJobId)\n                    return\n                else\n                    return currentDebounceJobId\n                end\n            else\n                rcall(\'SET\', deduplicationKey, jobId, \'PX\', ttl)\n                return\n            end\n        else\n            local ttl = deduplicationOpts[\'ttl\']\n            local deduplicationKeyExists\n            if ttl then\n                if deduplicationOpts[\'extend\'] then\n                    local currentDebounceJobId = rcall(\'GET\', deduplicationKey)\n                    if currentDebounceJobId then\n                        rcall(\'SET\', deduplicationKey, currentDebounceJobId, \'PX\', ttl)\n                        rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "debounced",\n                            "jobId", currentDebounceJobId, "debounceId", deduplicationId)\n                        rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "deduplicated", "jobId",\n                            currentDebounceJobId, "deduplicationId", deduplicationId, "deduplicatedJobId", jobId)\n                        return currentDebounceJobId\n                    else\n                        rcall(\'SET\', deduplicationKey, jobId, \'PX\', ttl)\n                        return\n                    end\n                else\n                    deduplicationKeyExists = not rcall(\'SET\', deduplicationKey, jobId, \'PX\', ttl, \'NX\')\n                end\n            else\n                deduplicationKeyExists = not rcall(\'SET\', deduplicationKey, jobId, \'NX\')\n            end\n            if deduplicationKeyExists then\n                local currentDebounceJobId = rcall(\'GET\', deduplicationKey)\n                rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "debounced", "jobId",\n                    currentDebounceJobId, "debounceId", deduplicationId)\n                rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "deduplicated", "jobId",\n                    currentDebounceJobId, "deduplicationId", deduplicationId, "deduplicatedJobId", jobId)\n                return currentDebounceJobId\n            end\n        end\n    end\nend\n--[[\n  Function to get max events value or set by default 10000.\n]]\nlocal function getOrSetMaxEvents(metaKey)\n  local maxEvents = rcall("HGET", metaKey, "opts.maxLenEvents")\n  if not maxEvents then\n    maxEvents = 10000\n    rcall("HSET", metaKey, "opts.maxLenEvents", maxEvents)\n  end\n  return maxEvents\nend\n--[[\n  Function to handle the case when job is duplicated.\n]]\n-- Includes\n--[[\n    This function is used to update the parent\'s dependencies if the job\n    is already completed and about to be ignored. The parent must get its\n    dependencies updated to avoid the parent job being stuck forever in \n    the waiting-children state.\n]]\n-- Includes\n--[[\n  Validate and move or add dependencies to parent.\n]]\n-- Includes\n--[[\n  Validate and move parent to a wait status (waiting, delayed or prioritized)\n  if no pending dependencies.\n]]\n-- Includes\n--[[\n  Validate and move parent to a wait status (waiting, delayed or prioritized) if needed.\n]]\n-- Includes\n--[[\n  Move parent to a wait status (wait, prioritized or delayed)\n]]\n-- Includes\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to add job considering priority.\n]]\n-- Includes\n--[[\n  Function to get priority score.\n]]\nlocal function getPriorityScore(priority, priorityCounterKey)\n  local prioCounter = rcall("INCR", priorityCounterKey)\n  return priority * 0x100000000 + prioCounter % 0x100000000\nend\nlocal function addJobWithPriority(markerKey, prioritizedKey, priority, jobId, priorityCounterKey,\n  isPausedOrMaxed)\n  local score = getPriorityScore(priority, priorityCounterKey)\n  rcall("ZADD", prioritizedKey, score, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to check if queue is paused or maxed\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function isQueuePausedOrMaxed(queueMetaKey, activeKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      return activeCount >= tonumber(queueAttributes[2])\n    end\n  end\n  return false\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\nlocal function moveParentToWait(parentQueueKey, parentKey, parentId, timestamp)\n    local parentWaitKey = parentQueueKey .. ":wait"\n    local parentPausedKey = parentQueueKey .. ":paused"\n    local parentActiveKey = parentQueueKey .. ":active"\n    local parentMetaKey = parentQueueKey .. ":meta"\n    local parentMarkerKey = parentQueueKey .. ":marker"\n    local jobAttributes = rcall("HMGET", parentKey, "priority", "delay")\n    local priority = tonumber(jobAttributes[1]) or 0\n    local delay = tonumber(jobAttributes[2]) or 0\n    if delay > 0 then\n        local delayedTimestamp = tonumber(timestamp) + delay\n        local score = delayedTimestamp * 0x1000\n        local parentDelayedKey = parentQueueKey .. ":delayed"\n        rcall("ZADD", parentDelayedKey, score, parentId)\n        rcall("XADD", parentQueueKey .. ":events", "*", "event", "delayed", "jobId", parentId, "delay",\n            delayedTimestamp)\n        addDelayMarkerIfNeeded(parentMarkerKey, parentDelayedKey)\n    else\n        if priority == 0 then\n            local parentTarget, isParentPausedOrMaxed = getTargetQueueList(parentMetaKey, parentActiveKey,\n                parentWaitKey, parentPausedKey)\n            addJobInTargetList(parentTarget, parentMarkerKey, "RPUSH", isParentPausedOrMaxed, parentId)\n        else\n            local isPausedOrMaxed = isQueuePausedOrMaxed(parentMetaKey, parentActiveKey)\n            addJobWithPriority(parentMarkerKey, parentQueueKey .. ":prioritized", priority, parentId,\n                parentQueueKey .. ":pc", isPausedOrMaxed)\n        end\n        rcall("XADD", parentQueueKey .. ":events", "*", "event", "waiting", "jobId", parentId, "prev",\n            "waiting-children")\n    end\nend\nlocal function moveParentToWaitIfNeeded(parentQueueKey, parentKey, parentId, timestamp)\n  if rcall("EXISTS", parentKey) == 1 then\n    local parentWaitingChildrenKey = parentQueueKey .. ":waiting-children"\n    if rcall("ZSCORE", parentWaitingChildrenKey, parentId) then    \n      rcall("ZREM", parentWaitingChildrenKey, parentId)\n      moveParentToWait(parentQueueKey, parentKey, parentId, timestamp)\n    end\n  end\nend\nlocal function moveParentToWaitIfNoPendingDependencies(parentQueueKey, parentDependenciesKey, parentKey,\n  parentId, timestamp)\n  local doNotHavePendingDependencies = rcall("SCARD", parentDependenciesKey) == 0\n  if doNotHavePendingDependencies then\n    moveParentToWaitIfNeeded(parentQueueKey, parentKey, parentId, timestamp)\n  end\nend\nlocal function updateParentDepsIfNeeded(parentKey, parentQueueKey, parentDependenciesKey,\n  parentId, jobIdKey, returnvalue, timestamp )\n  local processedSet = parentKey .. ":processed"\n  rcall("HSET", processedSet, jobIdKey, returnvalue)\n  moveParentToWaitIfNoPendingDependencies(parentQueueKey, parentDependenciesKey, parentKey, parentId, timestamp)\nend\nlocal function updateExistingJobsParent(parentKey, parent, parentData,\n                                        parentDependenciesKey, completedKey,\n                                        jobIdKey, jobId, timestamp)\n    if parentKey ~= nil then\n        if rcall("ZSCORE", completedKey, jobId) then\n            local returnvalue = rcall("HGET", jobIdKey, "returnvalue")\n            updateParentDepsIfNeeded(parentKey, parent[\'queueKey\'],\n                                     parentDependenciesKey, parent[\'id\'],\n                                     jobIdKey, returnvalue, timestamp)\n        else\n            if parentDependenciesKey ~= nil then\n                rcall("SADD", parentDependenciesKey, jobIdKey)\n            end\n        end\n        rcall("HMSET", jobIdKey, "parentKey", parentKey, "parent", parentData)\n    end\nend\nlocal function handleDuplicatedJob(jobKey, jobId, currentParentKey, currentParent,\n  parentData, parentDependenciesKey, completedKey, eventsKey, maxEvents, timestamp)\n  local existedParentKey = rcall("HGET", jobKey, "parentKey")\n  if not existedParentKey or existedParentKey == currentParentKey then\n    updateExistingJobsParent(currentParentKey, currentParent, parentData,\n      parentDependenciesKey, completedKey, jobKey,\n      jobId, timestamp)\n  else\n    if currentParentKey ~= nil and currentParentKey ~= existedParentKey\n      and (rcall("EXISTS", existedParentKey) == 1) then\n      return -7\n    end\n  end\n  rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event",\n    "duplicated", "jobId", jobId)\n  return jobId .. "" -- convert to string\nend\n--[[\n  Function to store a job\n]]\nlocal function storeJob(eventsKey, jobIdKey, jobId, name, data, opts, timestamp,\n                        parentKey, parentData, repeatJobKey)\n    local jsonOpts = cjson.encode(opts)\n    local delay = opts[\'delay\'] or 0\n    local priority = opts[\'priority\'] or 0\n    local debounceId = opts[\'de\'] and opts[\'de\'][\'id\']\n    local optionalValues = {}\n    if parentKey ~= nil then\n        table.insert(optionalValues, "parentKey")\n        table.insert(optionalValues, parentKey)\n        table.insert(optionalValues, "parent")\n        table.insert(optionalValues, parentData)\n    end\n    if repeatJobKey then\n        table.insert(optionalValues, "rjk")\n        table.insert(optionalValues, repeatJobKey)\n    end\n    if debounceId then\n        table.insert(optionalValues, "deid")\n        table.insert(optionalValues, debounceId)\n    end\n    rcall("HMSET", jobIdKey, "name", name, "data", data, "opts", jsonOpts,\n          "timestamp", timestamp, "delay", delay, "priority", priority,\n          unpack(optionalValues))\n    rcall("XADD", eventsKey, "*", "event", "added", "jobId", jobId, "name", name)\n    return delay, priority\nend\nif parentKey ~= nil then\n    if rcall("EXISTS", parentKey) ~= 1 then return -5 end\n    parentData = cjson.encode(parent)\nend\nlocal jobCounter = rcall("INCR", idKey)\nlocal maxEvents = getOrSetMaxEvents(metaKey)\nlocal opts = cmsgpack.unpack(ARGV[3])\nlocal parentDependenciesKey = args[7]\nlocal timestamp = args[4]\nif args[2] == "" then\n    jobId = jobCounter\n    jobIdKey = args[1] .. jobId\nelse\n    jobId = args[2]\n    jobIdKey = args[1] .. jobId\n    if rcall("EXISTS", jobIdKey) == 1 then\n        return handleDuplicatedJob(jobIdKey, jobId, parentKey, parent,\n            parentData, parentDependenciesKey, completedKey, eventsKey,\n            maxEvents, timestamp)\n    end\nend\nlocal deduplicationJobId = deduplicateJob(opts[\'de\'], jobId, delayedKey, deduplicationKey,\n  eventsKey, maxEvents, args[1])\nif deduplicationJobId then\n  return deduplicationJobId\nend\nlocal delay, priority = storeJob(eventsKey, jobIdKey, jobId, args[3], ARGV[2],\n    opts, timestamp, parentKey, parentData, repeatJobKey)\naddDelayedJob(jobId, delayedKey, eventsKey, timestamp, maxEvents, KEYS[1], delay)\n-- Check if this job is a child of another job, if so add it to the parents dependencies\nif parentDependenciesKey ~= nil then\n    rcall("SADD", parentDependenciesKey, jobIdKey)\nend\nreturn jobId .. "" -- convert to string\n',keys:6},oR={name:"addJobScheduler",content:'--[[\n  Adds a job scheduler, i.e. a job factory that creates jobs based on a given schedule (repeat options).\n    Input:\n      KEYS[1]  \'repeat\' key\n      KEYS[2]  \'delayed\' key\n      KEYS[3]  \'wait\' key\n      KEYS[4]  \'paused\' key\n      KEYS[5]  \'meta\' key\n      KEYS[6]  \'prioritized\' key\n      KEYS[7]  \'marker\' key\n      KEYS[8]  \'id\' key\n      KEYS[9]  \'events\' key\n      KEYS[10] \'pc\' priority counter\n      KEYS[11] \'active\' key\n      ARGV[1] next milliseconds\n      ARGV[2] msgpacked options\n            [1]  name\n            [2]  tz?\n            [3]  patten?\n            [4]  endDate?\n            [5]  every?\n      ARGV[3] jobs scheduler id\n      ARGV[4] Json stringified template data\n      ARGV[5] mspacked template opts\n      ARGV[6] msgpacked delayed opts\n      ARGV[7] timestamp\n      ARGV[8] prefix key\n      ARGV[9] producer key\n      Output:\n        repeatableKey  - OK\n]]\nlocal rcall = redis.call\nlocal repeatKey = KEYS[1]\nlocal delayedKey = KEYS[2]\nlocal waitKey = KEYS[3]\nlocal pausedKey = KEYS[4]\nlocal metaKey = KEYS[5]\nlocal prioritizedKey = KEYS[6]\nlocal eventsKey = KEYS[9]\nlocal nextMillis = ARGV[1]\nlocal jobSchedulerId = ARGV[3]\nlocal templateOpts = cmsgpack.unpack(ARGV[5])\nlocal prefixKey = ARGV[8]\n-- Includes\n--[[\n  Add delay marker if needed.\n]]\n-- Includes\n--[[\n  Adds a delayed job to the queue by doing the following:\n    - Creates a new job key with the job data.\n    - adds to delayed zset.\n    - Emits a global event \'delayed\' if the job is delayed.\n]]\n-- Includes\n--[[\n  Add delay marker if needed.\n]]\n-- Includes\n--[[\n  Function to return the next delayed job timestamp.\n]]\nlocal function getNextDelayedTimestamp(delayedKey)\n  local result = rcall("ZRANGE", delayedKey, 0, 0, "WITHSCORES")\n  if #result then\n    local nextTimestamp = tonumber(result[2])\n    if nextTimestamp ~= nil then\n      return nextTimestamp / 0x1000\n    end\n  end\nend\nlocal function addDelayMarkerIfNeeded(markerKey, delayedKey)\n  local nextTimestamp = getNextDelayedTimestamp(delayedKey)\n  if nextTimestamp ~= nil then\n    -- Replace the score of the marker with the newest known\n    -- next timestamp.\n    rcall("ZADD", markerKey, nextTimestamp, "1")\n  end\nend\n--[[\n  Bake in the job id first 12 bits into the timestamp\n  to guarantee correct execution order of delayed jobs\n  (up to 4096 jobs per given timestamp or 4096 jobs apart per timestamp)\n  WARNING: Jobs that are so far apart that they wrap around will cause FIFO to fail\n]]\nlocal function getDelayedScore(delayedKey, timestamp, delay)\n  local delayedTimestamp = (delay > 0 and (tonumber(timestamp) + delay)) or tonumber(timestamp)\n  local minScore = delayedTimestamp * 0x1000\n  local maxScore = (delayedTimestamp + 1 ) * 0x1000 - 1\n  local result = rcall("ZREVRANGEBYSCORE", delayedKey, maxScore,\n    minScore, "WITHSCORES","LIMIT", 0, 1)\n  if #result then\n    local currentMaxScore = tonumber(result[2])\n    if currentMaxScore ~= nil then\n      if currentMaxScore >= maxScore then\n        return maxScore, delayedTimestamp\n      else\n        return currentMaxScore + 1, delayedTimestamp\n      end\n    end\n  end\n  return minScore, delayedTimestamp\nend\nlocal function addDelayedJob(jobId, delayedKey, eventsKey, timestamp,\n  maxEvents, markerKey, delay)\n  local score, delayedTimestamp = getDelayedScore(delayedKey, timestamp, tonumber(delay))\n  rcall("ZADD", delayedKey, score, jobId)\n  rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "delayed",\n    "jobId", jobId, "delay", delayedTimestamp)\n  -- mark that a delayed job is available\n  addDelayMarkerIfNeeded(markerKey, delayedKey)\nend\n--[[\n  Function to add job considering priority.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\n--[[\n  Function to get priority score.\n]]\nlocal function getPriorityScore(priority, priorityCounterKey)\n  local prioCounter = rcall("INCR", priorityCounterKey)\n  return priority * 0x100000000 + prioCounter % 0x100000000\nend\nlocal function addJobWithPriority(markerKey, prioritizedKey, priority, jobId, priorityCounterKey,\n  isPausedOrMaxed)\n  local score = getPriorityScore(priority, priorityCounterKey)\n  rcall("ZADD", prioritizedKey, score, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function isQueuePaused(queueMetaKey)\n  return rcall("HEXISTS", queueMetaKey, "paused") == 1\nend\n--[[\n  Function to store a job\n]]\nlocal function storeJob(eventsKey, jobIdKey, jobId, name, data, opts, timestamp,\n                        parentKey, parentData, repeatJobKey)\n    local jsonOpts = cjson.encode(opts)\n    local delay = opts[\'delay\'] or 0\n    local priority = opts[\'priority\'] or 0\n    local debounceId = opts[\'de\'] and opts[\'de\'][\'id\']\n    local optionalValues = {}\n    if parentKey ~= nil then\n        table.insert(optionalValues, "parentKey")\n        table.insert(optionalValues, parentKey)\n        table.insert(optionalValues, "parent")\n        table.insert(optionalValues, parentData)\n    end\n    if repeatJobKey then\n        table.insert(optionalValues, "rjk")\n        table.insert(optionalValues, repeatJobKey)\n    end\n    if debounceId then\n        table.insert(optionalValues, "deid")\n        table.insert(optionalValues, debounceId)\n    end\n    rcall("HMSET", jobIdKey, "name", name, "data", data, "opts", jsonOpts,\n          "timestamp", timestamp, "delay", delay, "priority", priority,\n          unpack(optionalValues))\n    rcall("XADD", eventsKey, "*", "event", "added", "jobId", jobId, "name", name)\n    return delay, priority\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\nlocal function addJobFromScheduler(jobKey, jobId, rawOpts, waitKey, pausedKey, activeKey, metaKey, \n  prioritizedKey, priorityCounter, delayedKey, markerKey, eventsKey, name, maxEvents, timestamp,\n  data, jobSchedulerId)\n  local opts = cmsgpack.unpack(rawOpts)\n  local delay, priority = storeJob(eventsKey, jobKey, jobId, name, data,\n    opts, timestamp, nil, nil, jobSchedulerId)\n  if delay ~= 0 then\n    addDelayedJob(jobId, delayedKey, eventsKey, timestamp, maxEvents, markerKey, delay)\n  else\n    local target, isPausedOrMaxed = getTargetQueueList(metaKey, activeKey, waitKey, pausedKey)\n    -- Standard or priority add\n    if priority == 0 then\n      local pushCmd = opts[\'lifo\'] and \'RPUSH\' or \'LPUSH\'\n      addJobInTargetList(target, markerKey, pushCmd, isPausedOrMaxed, jobId)\n    else\n      -- Priority add\n      addJobWithPriority(markerKey, prioritizedKey, priority, jobId, priorityCounter, isPausedOrMaxed)\n    end\n    -- Emit waiting event\n    rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents,  "*", "event", "waiting", "jobId", jobId)\n  end\nend\n--[[\n  Function to get max events value or set by default 10000.\n]]\nlocal function getOrSetMaxEvents(metaKey)\n  local maxEvents = rcall("HGET", metaKey, "opts.maxLenEvents")\n  if not maxEvents then\n    maxEvents = 10000\n    rcall("HSET", metaKey, "opts.maxLenEvents", maxEvents)\n  end\n  return maxEvents\nend\n--[[\n  Function to remove job.\n]]\n-- Includes\n--[[\n  Function to remove deduplication key if needed\n  when a job is being removed.\n]]\nlocal function removeDeduplicationKeyIfNeededOnRemoval(prefixKey,\n  jobKey, jobId)\n  local deduplicationId = rcall("HGET", jobKey, "deid")\n  if deduplicationId then\n    local deduplicationKey = prefixKey .. "de:" .. deduplicationId\n    local currentJobId = rcall(\'GET\', deduplicationKey)\n    if currentJobId and currentJobId == jobId then\n      return rcall("DEL", deduplicationKey)\n    end\n  end\nend\n--[[\n  Function to remove job keys.\n]]\nlocal function removeJobKeys(jobKey)\n  return rcall("DEL", jobKey, jobKey .. \':logs\', jobKey .. \':dependencies\',\n    jobKey .. \':processed\', jobKey .. \':failed\', jobKey .. \':unsuccessful\')\nend\n--[[\n  Check if this job has a parent. If so we will just remove it from\n  the parent child list, but if it is the last child we should move the parent to "wait/paused"\n  which requires code from "moveToFinished"\n]]\n-- Includes\n--[[\n  Functions to destructure job key.\n  Just a bit of warning, these functions may be a bit slow and affect performance significantly.\n]]\nlocal getJobIdFromKey = function (jobKey)\n  return string.match(jobKey, ".*:(.*)")\nend\nlocal getJobKeyPrefix = function (jobKey, jobId)\n  return string.sub(jobKey, 0, #jobKey - #jobId)\nend\nlocal function _moveParentToWait(parentPrefix, parentId, emitEvent)\n  local parentTarget, isPausedOrMaxed = getTargetQueueList(parentPrefix .. "meta", parentPrefix .. "active",\n    parentPrefix .. "wait", parentPrefix .. "paused")\n  addJobInTargetList(parentTarget, parentPrefix .. "marker", "RPUSH", isPausedOrMaxed, parentId)\n  if emitEvent then\n    local parentEventStream = parentPrefix .. "events"\n    rcall("XADD", parentEventStream, "*", "event", "waiting", "jobId", parentId, "prev", "waiting-children")\n  end\nend\nlocal function removeParentDependencyKey(jobKey, hard, parentKey, baseKey, debounceId)\n  if parentKey then\n    local parentDependenciesKey = parentKey .. ":dependencies"\n    local result = rcall("SREM", parentDependenciesKey, jobKey)\n    if result > 0 then\n      local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n      if pendingDependencies == 0 then\n        local parentId = getJobIdFromKey(parentKey)\n        local parentPrefix = getJobKeyPrefix(parentKey, parentId)\n        local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n        if numRemovedElements == 1 then\n          if hard then -- remove parent in same queue\n            if parentPrefix == baseKey then\n              removeParentDependencyKey(parentKey, hard, nil, baseKey, nil)\n              removeJobKeys(parentKey)\n              if debounceId then\n                rcall("DEL", parentPrefix .. "de:" .. debounceId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId)\n            end\n          else\n            _moveParentToWait(parentPrefix, parentId, true)\n          end\n        end\n      end\n      return true\n    end\n  else\n    local parentAttributes = rcall("HMGET", jobKey, "parentKey", "deid")\n    local missedParentKey = parentAttributes[1]\n    if( (type(missedParentKey) == "string") and missedParentKey ~= ""\n      and (rcall("EXISTS", missedParentKey) == 1)) then\n      local parentDependenciesKey = missedParentKey .. ":dependencies"\n      local result = rcall("SREM", parentDependenciesKey, jobKey)\n      if result > 0 then\n        local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n        if pendingDependencies == 0 then\n          local parentId = getJobIdFromKey(missedParentKey)\n          local parentPrefix = getJobKeyPrefix(missedParentKey, parentId)\n          local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n          if numRemovedElements == 1 then\n            if hard then\n              if parentPrefix == baseKey then\n                removeParentDependencyKey(missedParentKey, hard, nil, baseKey, nil)\n                removeJobKeys(missedParentKey)\n                if parentAttributes[2] then\n                  rcall("DEL", parentPrefix .. "de:" .. parentAttributes[2])\n                end\n              else\n                _moveParentToWait(parentPrefix, parentId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId, true)\n            end\n          end\n        end\n        return true\n      end\n    end\n  end\n  return false\nend\nlocal function removeJob(jobId, hard, baseKey, shouldRemoveDeduplicationKey)\n  local jobKey = baseKey .. jobId\n  removeParentDependencyKey(jobKey, hard, nil, baseKey)\n  if shouldRemoveDeduplicationKey then\n    removeDeduplicationKeyIfNeededOnRemoval(baseKey, jobKey, jobId)\n  end\n  removeJobKeys(jobKey)\nend\n--[[\n  Function to store a job scheduler\n]]\nlocal function storeJobScheduler(schedulerId, schedulerKey, repeatKey, nextMillis, opts,\n  templateData, templateOpts)\n  rcall("ZADD", repeatKey, nextMillis, schedulerId)\n  local optionalValues = {}\n  if opts[\'tz\'] then\n    table.insert(optionalValues, "tz")\n    table.insert(optionalValues, opts[\'tz\'])\n  end\n  if opts[\'limit\'] then\n    table.insert(optionalValues, "limit")\n    table.insert(optionalValues, opts[\'limit\'])\n  end\n  if opts[\'pattern\'] then\n    table.insert(optionalValues, "pattern")\n    table.insert(optionalValues, opts[\'pattern\'])\n  end\n  if opts[\'endDate\'] then\n    table.insert(optionalValues, "endDate")\n    table.insert(optionalValues, opts[\'endDate\'])\n  end\n  if opts[\'every\'] then\n    table.insert(optionalValues, "every")\n    table.insert(optionalValues, opts[\'every\'])\n  end\n  if opts[\'offset\'] then\n    table.insert(optionalValues, "offset")\n    table.insert(optionalValues, opts[\'offset\'])\n  end\n  local jsonTemplateOpts = cjson.encode(templateOpts)\n  if jsonTemplateOpts and jsonTemplateOpts ~= \'{}\' then\n    table.insert(optionalValues, "opts")\n    table.insert(optionalValues, jsonTemplateOpts)\n  end\n  if templateData and templateData ~= \'{}\' then\n    table.insert(optionalValues, "data")\n    table.insert(optionalValues, templateData)\n  end\n  rcall("DEL", schedulerKey) -- remove all attributes and then re-insert new ones\n  rcall("HMSET", schedulerKey, "name", opts[\'name\'], "ic", 1, unpack(optionalValues))\nend\n-- If we are overriding a repeatable job we must delete the delayed job for\n-- the next iteration.\nlocal schedulerKey = repeatKey .. ":" .. jobSchedulerId\nlocal nextDelayedJobKey = schedulerKey .. ":" .. nextMillis\nlocal nextDelayedJobId = "repeat:" .. jobSchedulerId .. ":" .. nextMillis\nlocal maxEvents = getOrSetMaxEvents(metaKey)\nlocal function removeJobFromScheduler(prefixKey, delayedKey, prioritizedKey, waitKey, pausedKey, jobId,\n    metaKey, eventsKey)\n    if rcall("ZSCORE", delayedKey, jobId) then\n        removeJob(jobId, true, prefixKey, true --[[remove debounce key]] )\n        rcall("ZREM", delayedKey, jobId)\n        return true\n    elseif rcall("ZSCORE", prioritizedKey, jobId) then\n        removeJob(jobId, true, prefixKey, true --[[remove debounce key]] )\n        rcall("ZREM", prioritizedKey, jobId)\n        return true\n    else\n        local pausedOrWaitKey = waitKey\n        if isQueuePaused(metaKey) then\n            pausedOrWaitKey = pausedKey\n        end\n        if rcall("LREM", pausedOrWaitKey, 1, jobId) > 0 then\n            removeJob(jobId, true, prefixKey, true --[[remove debounce key]] )\n            return true\n        end\n    end\n    return false\nend\nif rcall("EXISTS", nextDelayedJobKey) == 1 then\n    if not removeJobFromScheduler(prefixKey, delayedKey, prioritizedKey, waitKey, pausedKey,\n        nextDelayedJobId, metaKey, eventsKey) then\n        rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event",\n            "duplicated", "jobId", nextDelayedJobId)\n        return nextDelayedJobId .. "" -- convert to string\n    end\nend\nlocal prevMillis = rcall("ZSCORE", repeatKey, jobSchedulerId)\nif prevMillis then    \n    local currentJobId = "repeat:" .. jobSchedulerId .. ":" .. prevMillis\n    local currentDelayedJobKey = schedulerKey .. ":" .. prevMillis\n    if currentJobId ~= nextDelayedJobId and rcall("EXISTS", currentDelayedJobKey) == 1 then\n        removeJobFromScheduler(prefixKey, delayedKey, prioritizedKey, waitKey, pausedKey,\n            currentJobId, metaKey, eventsKey)\n    end\nend\nlocal schedulerOpts = cmsgpack.unpack(ARGV[2])\nstoreJobScheduler(jobSchedulerId, schedulerKey, repeatKey, nextMillis, schedulerOpts, ARGV[4], templateOpts)\nrcall("INCR", KEYS[8])\naddJobFromScheduler(nextDelayedJobKey, nextDelayedJobId, ARGV[6], waitKey, pausedKey,\n    KEYS[11], metaKey, prioritizedKey, KEYS[10], delayedKey, KEYS[7], eventsKey,\n    schedulerOpts[\'name\'], maxEvents, ARGV[7], ARGV[4], jobSchedulerId)\nif ARGV[9] ~= "" then\n    rcall("HSET", ARGV[9], "nrjid", nextDelayedJobId)\nend\nreturn nextDelayedJobId .. "" -- convert to string\n',keys:11},sR={name:"addLog",content:'--[[\n  Add job log\n  Input:\n    KEYS[1] job id key\n    KEYS[2] job logs key\n    ARGV[1] id\n    ARGV[2] log\n    ARGV[3] keepLogs\n  Output:\n    -1 - Missing job.\n]]\nlocal rcall = redis.call\nif rcall("EXISTS", KEYS[1]) == 1 then -- // Make sure job exists\n  local logCount = rcall("RPUSH", KEYS[2], ARGV[2])\n  if ARGV[3] ~= \'\' then\n    local keepLogs = tonumber(ARGV[3])\n    rcall("LTRIM", KEYS[2], -keepLogs, -1)\n    return math.min(keepLogs, logCount)\n  end\n  return logCount\nelse\n  return -1\nend\n',keys:2},lR={name:"addParentJob",content:'--[[\n  Adds a parent job to the queue by doing the following:\n    - Increases the job counter if needed.\n    - Creates a new job key with the job data.\n    - adds the job to the waiting-children zset\n    Input:\n      KEYS[1] \'meta\'\n      KEYS[2] \'id\'\n      KEYS[3] \'delayed\'\n      KEYS[4] \'completed\'\n      KEYS[5] events stream key\n      ARGV[1] msgpacked arguments array\n            [1]  key prefix,\n            [2]  custom id (will not generate one automatically)\n            [3]  name\n            [4]  timestamp\n            [5]  parentKey?\n            [6]  waitChildrenKey key.\n            [7]  parent dependencies key.\n            [8]  parent? {id, queueKey}\n            [9]  repeat job key\n            [10] deduplication key\n      ARGV[2] Json stringified job data\n      ARGV[3] msgpacked options\n      Output:\n        jobId  - OK\n        -5     - Missing parent key\n]]\nlocal metaKey = KEYS[1]\nlocal idKey = KEYS[2]\nlocal completedKey = KEYS[4]\nlocal eventsKey = KEYS[5]\nlocal jobId\nlocal jobIdKey\nlocal rcall = redis.call\nlocal args = cmsgpack.unpack(ARGV[1])\nlocal data = ARGV[2]\nlocal opts = cmsgpack.unpack(ARGV[3])\nlocal parentKey = args[5]\nlocal parent = args[8]\nlocal repeatJobKey = args[9]\nlocal deduplicationKey = args[10]\nlocal parentData\n-- Includes\n--[[\n  Function to debounce a job.\n]]\n-- Includes\n--[[\n  Function to remove job keys.\n]]\nlocal function removeJobKeys(jobKey)\n  return rcall("DEL", jobKey, jobKey .. \':logs\', jobKey .. \':dependencies\',\n    jobKey .. \':processed\', jobKey .. \':failed\', jobKey .. \':unsuccessful\')\nend\nlocal function deduplicateJob(deduplicationOpts, jobId, delayedKey, deduplicationKey, eventsKey, maxEvents,\n    prefix)\n    local deduplicationId = deduplicationOpts and deduplicationOpts[\'id\']\n    if deduplicationId then\n        local ttl = deduplicationOpts[\'ttl\']\n        if deduplicationOpts[\'replace\'] and ttl and ttl > 0 then\n            local currentDebounceJobId = rcall(\'GET\', deduplicationKey)\n            if currentDebounceJobId then\n                if rcall("ZREM", delayedKey, currentDebounceJobId) > 0 then\n                    removeJobKeys(prefix .. currentDebounceJobId)\n                    rcall("XADD", eventsKey, "*", "event", "removed", "jobId", currentDebounceJobId,\n                        "prev", "delayed")\n                    if deduplicationOpts[\'extend\'] then\n                        rcall(\'SET\', deduplicationKey, jobId, \'PX\', ttl)\n                    else\n                        rcall(\'SET\', deduplicationKey, jobId, \'KEEPTTL\')\n                    end\n                    rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "deduplicated", "jobId",\n                        jobId, "deduplicationId", deduplicationId, "deduplicatedJobId", currentDebounceJobId)\n                    return\n                else\n                    return currentDebounceJobId\n                end\n            else\n                rcall(\'SET\', deduplicationKey, jobId, \'PX\', ttl)\n                return\n            end\n        else\n            local ttl = deduplicationOpts[\'ttl\']\n            local deduplicationKeyExists\n            if ttl then\n                if deduplicationOpts[\'extend\'] then\n                    local currentDebounceJobId = rcall(\'GET\', deduplicationKey)\n                    if currentDebounceJobId then\n                        rcall(\'SET\', deduplicationKey, currentDebounceJobId, \'PX\', ttl)\n                        rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "debounced",\n                            "jobId", currentDebounceJobId, "debounceId", deduplicationId)\n                        rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "deduplicated", "jobId",\n                            currentDebounceJobId, "deduplicationId", deduplicationId, "deduplicatedJobId", jobId)\n                        return currentDebounceJobId\n                    else\n                        rcall(\'SET\', deduplicationKey, jobId, \'PX\', ttl)\n                        return\n                    end\n                else\n                    deduplicationKeyExists = not rcall(\'SET\', deduplicationKey, jobId, \'PX\', ttl, \'NX\')\n                end\n            else\n                deduplicationKeyExists = not rcall(\'SET\', deduplicationKey, jobId, \'NX\')\n            end\n            if deduplicationKeyExists then\n                local currentDebounceJobId = rcall(\'GET\', deduplicationKey)\n                rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "debounced", "jobId",\n                    currentDebounceJobId, "debounceId", deduplicationId)\n                rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "deduplicated", "jobId",\n                    currentDebounceJobId, "deduplicationId", deduplicationId, "deduplicatedJobId", jobId)\n                return currentDebounceJobId\n            end\n        end\n    end\nend\n--[[\n  Function to get max events value or set by default 10000.\n]]\nlocal function getOrSetMaxEvents(metaKey)\n  local maxEvents = rcall("HGET", metaKey, "opts.maxLenEvents")\n  if not maxEvents then\n    maxEvents = 10000\n    rcall("HSET", metaKey, "opts.maxLenEvents", maxEvents)\n  end\n  return maxEvents\nend\n--[[\n  Function to handle the case when job is duplicated.\n]]\n-- Includes\n--[[\n    This function is used to update the parent\'s dependencies if the job\n    is already completed and about to be ignored. The parent must get its\n    dependencies updated to avoid the parent job being stuck forever in \n    the waiting-children state.\n]]\n-- Includes\n--[[\n  Validate and move or add dependencies to parent.\n]]\n-- Includes\n--[[\n  Validate and move parent to a wait status (waiting, delayed or prioritized)\n  if no pending dependencies.\n]]\n-- Includes\n--[[\n  Validate and move parent to a wait status (waiting, delayed or prioritized) if needed.\n]]\n-- Includes\n--[[\n  Move parent to a wait status (wait, prioritized or delayed)\n]]\n-- Includes\n--[[\n  Add delay marker if needed.\n]]\n-- Includes\n--[[\n  Function to return the next delayed job timestamp.\n]]\nlocal function getNextDelayedTimestamp(delayedKey)\n  local result = rcall("ZRANGE", delayedKey, 0, 0, "WITHSCORES")\n  if #result then\n    local nextTimestamp = tonumber(result[2])\n    if nextTimestamp ~= nil then\n      return nextTimestamp / 0x1000\n    end\n  end\nend\nlocal function addDelayMarkerIfNeeded(markerKey, delayedKey)\n  local nextTimestamp = getNextDelayedTimestamp(delayedKey)\n  if nextTimestamp ~= nil then\n    -- Replace the score of the marker with the newest known\n    -- next timestamp.\n    rcall("ZADD", markerKey, nextTimestamp, "1")\n  end\nend\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to add job considering priority.\n]]\n-- Includes\n--[[\n  Function to get priority score.\n]]\nlocal function getPriorityScore(priority, priorityCounterKey)\n  local prioCounter = rcall("INCR", priorityCounterKey)\n  return priority * 0x100000000 + prioCounter % 0x100000000\nend\nlocal function addJobWithPriority(markerKey, prioritizedKey, priority, jobId, priorityCounterKey,\n  isPausedOrMaxed)\n  local score = getPriorityScore(priority, priorityCounterKey)\n  rcall("ZADD", prioritizedKey, score, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to check if queue is paused or maxed\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function isQueuePausedOrMaxed(queueMetaKey, activeKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      return activeCount >= tonumber(queueAttributes[2])\n    end\n  end\n  return false\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\nlocal function moveParentToWait(parentQueueKey, parentKey, parentId, timestamp)\n    local parentWaitKey = parentQueueKey .. ":wait"\n    local parentPausedKey = parentQueueKey .. ":paused"\n    local parentActiveKey = parentQueueKey .. ":active"\n    local parentMetaKey = parentQueueKey .. ":meta"\n    local parentMarkerKey = parentQueueKey .. ":marker"\n    local jobAttributes = rcall("HMGET", parentKey, "priority", "delay")\n    local priority = tonumber(jobAttributes[1]) or 0\n    local delay = tonumber(jobAttributes[2]) or 0\n    if delay > 0 then\n        local delayedTimestamp = tonumber(timestamp) + delay\n        local score = delayedTimestamp * 0x1000\n        local parentDelayedKey = parentQueueKey .. ":delayed"\n        rcall("ZADD", parentDelayedKey, score, parentId)\n        rcall("XADD", parentQueueKey .. ":events", "*", "event", "delayed", "jobId", parentId, "delay",\n            delayedTimestamp)\n        addDelayMarkerIfNeeded(parentMarkerKey, parentDelayedKey)\n    else\n        if priority == 0 then\n            local parentTarget, isParentPausedOrMaxed = getTargetQueueList(parentMetaKey, parentActiveKey,\n                parentWaitKey, parentPausedKey)\n            addJobInTargetList(parentTarget, parentMarkerKey, "RPUSH", isParentPausedOrMaxed, parentId)\n        else\n            local isPausedOrMaxed = isQueuePausedOrMaxed(parentMetaKey, parentActiveKey)\n            addJobWithPriority(parentMarkerKey, parentQueueKey .. ":prioritized", priority, parentId,\n                parentQueueKey .. ":pc", isPausedOrMaxed)\n        end\n        rcall("XADD", parentQueueKey .. ":events", "*", "event", "waiting", "jobId", parentId, "prev",\n            "waiting-children")\n    end\nend\nlocal function moveParentToWaitIfNeeded(parentQueueKey, parentKey, parentId, timestamp)\n  if rcall("EXISTS", parentKey) == 1 then\n    local parentWaitingChildrenKey = parentQueueKey .. ":waiting-children"\n    if rcall("ZSCORE", parentWaitingChildrenKey, parentId) then    \n      rcall("ZREM", parentWaitingChildrenKey, parentId)\n      moveParentToWait(parentQueueKey, parentKey, parentId, timestamp)\n    end\n  end\nend\nlocal function moveParentToWaitIfNoPendingDependencies(parentQueueKey, parentDependenciesKey, parentKey,\n  parentId, timestamp)\n  local doNotHavePendingDependencies = rcall("SCARD", parentDependenciesKey) == 0\n  if doNotHavePendingDependencies then\n    moveParentToWaitIfNeeded(parentQueueKey, parentKey, parentId, timestamp)\n  end\nend\nlocal function updateParentDepsIfNeeded(parentKey, parentQueueKey, parentDependenciesKey,\n  parentId, jobIdKey, returnvalue, timestamp )\n  local processedSet = parentKey .. ":processed"\n  rcall("HSET", processedSet, jobIdKey, returnvalue)\n  moveParentToWaitIfNoPendingDependencies(parentQueueKey, parentDependenciesKey, parentKey, parentId, timestamp)\nend\nlocal function updateExistingJobsParent(parentKey, parent, parentData,\n                                        parentDependenciesKey, completedKey,\n                                        jobIdKey, jobId, timestamp)\n    if parentKey ~= nil then\n        if rcall("ZSCORE", completedKey, jobId) then\n            local returnvalue = rcall("HGET", jobIdKey, "returnvalue")\n            updateParentDepsIfNeeded(parentKey, parent[\'queueKey\'],\n                                     parentDependenciesKey, parent[\'id\'],\n                                     jobIdKey, returnvalue, timestamp)\n        else\n            if parentDependenciesKey ~= nil then\n                rcall("SADD", parentDependenciesKey, jobIdKey)\n            end\n        end\n        rcall("HMSET", jobIdKey, "parentKey", parentKey, "parent", parentData)\n    end\nend\nlocal function handleDuplicatedJob(jobKey, jobId, currentParentKey, currentParent,\n  parentData, parentDependenciesKey, completedKey, eventsKey, maxEvents, timestamp)\n  local existedParentKey = rcall("HGET", jobKey, "parentKey")\n  if not existedParentKey or existedParentKey == currentParentKey then\n    updateExistingJobsParent(currentParentKey, currentParent, parentData,\n      parentDependenciesKey, completedKey, jobKey,\n      jobId, timestamp)\n  else\n    if currentParentKey ~= nil and currentParentKey ~= existedParentKey\n      and (rcall("EXISTS", existedParentKey) == 1) then\n      return -7\n    end\n  end\n  rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event",\n    "duplicated", "jobId", jobId)\n  return jobId .. "" -- convert to string\nend\n--[[\n  Function to store a job\n]]\nlocal function storeJob(eventsKey, jobIdKey, jobId, name, data, opts, timestamp,\n                        parentKey, parentData, repeatJobKey)\n    local jsonOpts = cjson.encode(opts)\n    local delay = opts[\'delay\'] or 0\n    local priority = opts[\'priority\'] or 0\n    local debounceId = opts[\'de\'] and opts[\'de\'][\'id\']\n    local optionalValues = {}\n    if parentKey ~= nil then\n        table.insert(optionalValues, "parentKey")\n        table.insert(optionalValues, parentKey)\n        table.insert(optionalValues, "parent")\n        table.insert(optionalValues, parentData)\n    end\n    if repeatJobKey then\n        table.insert(optionalValues, "rjk")\n        table.insert(optionalValues, repeatJobKey)\n    end\n    if debounceId then\n        table.insert(optionalValues, "deid")\n        table.insert(optionalValues, debounceId)\n    end\n    rcall("HMSET", jobIdKey, "name", name, "data", data, "opts", jsonOpts,\n          "timestamp", timestamp, "delay", delay, "priority", priority,\n          unpack(optionalValues))\n    rcall("XADD", eventsKey, "*", "event", "added", "jobId", jobId, "name", name)\n    return delay, priority\nend\nif parentKey ~= nil then\n    if rcall("EXISTS", parentKey) ~= 1 then return -5 end\n    parentData = cjson.encode(parent)\nend\nlocal jobCounter = rcall("INCR", idKey)\nlocal maxEvents = getOrSetMaxEvents(metaKey)\nlocal parentDependenciesKey = args[7]\nlocal timestamp = args[4]\nif args[2] == "" then\n    jobId = jobCounter\n    jobIdKey = args[1] .. jobId\nelse\n    jobId = args[2]\n    jobIdKey = args[1] .. jobId\n    if rcall("EXISTS", jobIdKey) == 1 then\n        return handleDuplicatedJob(jobIdKey, jobId, parentKey, parent,\n            parentData, parentDependenciesKey, completedKey, eventsKey,\n            maxEvents, timestamp)\n    end\nend\nlocal deduplicationJobId = deduplicateJob(opts[\'de\'], jobId, KEYS[3],\n  deduplicationKey, eventsKey, maxEvents, args[1])\nif deduplicationJobId then\n  return deduplicationJobId\nend\n-- Store the job.\nstoreJob(eventsKey, jobIdKey, jobId, args[3], ARGV[2], opts, timestamp,\n         parentKey, parentData, repeatJobKey)\nlocal waitChildrenKey = args[6]\nrcall("ZADD", waitChildrenKey, timestamp, jobId)\nrcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event",\n      "waiting-children", "jobId", jobId)\n-- Check if this job is a child of another job, if so add it to the parents dependencies\nif parentDependenciesKey ~= nil then\n    rcall("SADD", parentDependenciesKey, jobIdKey)\nend\nreturn jobId .. "" -- convert to string\n',keys:5},cR={name:"addPrioritizedJob",content:'--[[\n  Adds a priotitized job to the queue by doing the following:\n    - Increases the job counter if needed.\n    - Creates a new job key with the job data.\n    - Adds the job to the "added" list so that workers gets notified.\n    Input:\n      KEYS[1] \'marker\',\n      KEYS[2] \'meta\'\n      KEYS[3] \'id\'\n      KEYS[4] \'prioritized\'\n      KEYS[5] \'delayed\'\n      KEYS[6] \'completed\'\n      KEYS[7] \'active\'\n      KEYS[8] events stream key\n      KEYS[9] \'pc\' priority counter\n      ARGV[1] msgpacked arguments array\n            [1]  key prefix,\n            [2]  custom id (will not generate one automatically)\n            [3]  name\n            [4]  timestamp\n            [5]  parentKey?\n            [6]  waitChildrenKey key.\n            [7]  parent dependencies key.\n            [8]  parent? {id, queueKey}\n            [9]  repeat job key\n            [10] deduplication key\n      ARGV[2] Json stringified job data\n      ARGV[3] msgpacked options\n      Output:\n        jobId  - OK\n        -5     - Missing parent key\n]] \nlocal metaKey = KEYS[2]\nlocal idKey = KEYS[3]\nlocal priorityKey = KEYS[4]\nlocal completedKey = KEYS[6]\nlocal activeKey = KEYS[7]\nlocal eventsKey = KEYS[8]\nlocal priorityCounterKey = KEYS[9]\nlocal jobId\nlocal jobIdKey\nlocal rcall = redis.call\nlocal args = cmsgpack.unpack(ARGV[1])\nlocal data = ARGV[2]\nlocal opts = cmsgpack.unpack(ARGV[3])\nlocal parentKey = args[5]\nlocal parent = args[8]\nlocal repeatJobKey = args[9]\nlocal deduplicationKey = args[10]\nlocal parentData\n-- Includes\n--[[\n  Function to add job considering priority.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\n--[[\n  Function to get priority score.\n]]\nlocal function getPriorityScore(priority, priorityCounterKey)\n  local prioCounter = rcall("INCR", priorityCounterKey)\n  return priority * 0x100000000 + prioCounter % 0x100000000\nend\nlocal function addJobWithPriority(markerKey, prioritizedKey, priority, jobId, priorityCounterKey,\n  isPausedOrMaxed)\n  local score = getPriorityScore(priority, priorityCounterKey)\n  rcall("ZADD", prioritizedKey, score, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to debounce a job.\n]]\n-- Includes\n--[[\n  Function to remove job keys.\n]]\nlocal function removeJobKeys(jobKey)\n  return rcall("DEL", jobKey, jobKey .. \':logs\', jobKey .. \':dependencies\',\n    jobKey .. \':processed\', jobKey .. \':failed\', jobKey .. \':unsuccessful\')\nend\nlocal function deduplicateJob(deduplicationOpts, jobId, delayedKey, deduplicationKey, eventsKey, maxEvents,\n    prefix)\n    local deduplicationId = deduplicationOpts and deduplicationOpts[\'id\']\n    if deduplicationId then\n        local ttl = deduplicationOpts[\'ttl\']\n        if deduplicationOpts[\'replace\'] and ttl and ttl > 0 then\n            local currentDebounceJobId = rcall(\'GET\', deduplicationKey)\n            if currentDebounceJobId then\n                if rcall("ZREM", delayedKey, currentDebounceJobId) > 0 then\n                    removeJobKeys(prefix .. currentDebounceJobId)\n                    rcall("XADD", eventsKey, "*", "event", "removed", "jobId", currentDebounceJobId,\n                        "prev", "delayed")\n                    if deduplicationOpts[\'extend\'] then\n                        rcall(\'SET\', deduplicationKey, jobId, \'PX\', ttl)\n                    else\n                        rcall(\'SET\', deduplicationKey, jobId, \'KEEPTTL\')\n                    end\n                    rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "deduplicated", "jobId",\n                        jobId, "deduplicationId", deduplicationId, "deduplicatedJobId", currentDebounceJobId)\n                    return\n                else\n                    return currentDebounceJobId\n                end\n            else\n                rcall(\'SET\', deduplicationKey, jobId, \'PX\', ttl)\n                return\n            end\n        else\n            local ttl = deduplicationOpts[\'ttl\']\n            local deduplicationKeyExists\n            if ttl then\n                if deduplicationOpts[\'extend\'] then\n                    local currentDebounceJobId = rcall(\'GET\', deduplicationKey)\n                    if currentDebounceJobId then\n                        rcall(\'SET\', deduplicationKey, currentDebounceJobId, \'PX\', ttl)\n                        rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "debounced",\n                            "jobId", currentDebounceJobId, "debounceId", deduplicationId)\n                        rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "deduplicated", "jobId",\n                            currentDebounceJobId, "deduplicationId", deduplicationId, "deduplicatedJobId", jobId)\n                        return currentDebounceJobId\n                    else\n                        rcall(\'SET\', deduplicationKey, jobId, \'PX\', ttl)\n                        return\n                    end\n                else\n                    deduplicationKeyExists = not rcall(\'SET\', deduplicationKey, jobId, \'PX\', ttl, \'NX\')\n                end\n            else\n                deduplicationKeyExists = not rcall(\'SET\', deduplicationKey, jobId, \'NX\')\n            end\n            if deduplicationKeyExists then\n                local currentDebounceJobId = rcall(\'GET\', deduplicationKey)\n                rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "debounced", "jobId",\n                    currentDebounceJobId, "debounceId", deduplicationId)\n                rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "deduplicated", "jobId",\n                    currentDebounceJobId, "deduplicationId", deduplicationId, "deduplicatedJobId", jobId)\n                return currentDebounceJobId\n            end\n        end\n    end\nend\n--[[\n  Function to store a job\n]]\nlocal function storeJob(eventsKey, jobIdKey, jobId, name, data, opts, timestamp,\n                        parentKey, parentData, repeatJobKey)\n    local jsonOpts = cjson.encode(opts)\n    local delay = opts[\'delay\'] or 0\n    local priority = opts[\'priority\'] or 0\n    local debounceId = opts[\'de\'] and opts[\'de\'][\'id\']\n    local optionalValues = {}\n    if parentKey ~= nil then\n        table.insert(optionalValues, "parentKey")\n        table.insert(optionalValues, parentKey)\n        table.insert(optionalValues, "parent")\n        table.insert(optionalValues, parentData)\n    end\n    if repeatJobKey then\n        table.insert(optionalValues, "rjk")\n        table.insert(optionalValues, repeatJobKey)\n    end\n    if debounceId then\n        table.insert(optionalValues, "deid")\n        table.insert(optionalValues, debounceId)\n    end\n    rcall("HMSET", jobIdKey, "name", name, "data", data, "opts", jsonOpts,\n          "timestamp", timestamp, "delay", delay, "priority", priority,\n          unpack(optionalValues))\n    rcall("XADD", eventsKey, "*", "event", "added", "jobId", jobId, "name", name)\n    return delay, priority\nend\n--[[\n  Function to get max events value or set by default 10000.\n]]\nlocal function getOrSetMaxEvents(metaKey)\n  local maxEvents = rcall("HGET", metaKey, "opts.maxLenEvents")\n  if not maxEvents then\n    maxEvents = 10000\n    rcall("HSET", metaKey, "opts.maxLenEvents", maxEvents)\n  end\n  return maxEvents\nend\n--[[\n  Function to handle the case when job is duplicated.\n]]\n-- Includes\n--[[\n    This function is used to update the parent\'s dependencies if the job\n    is already completed and about to be ignored. The parent must get its\n    dependencies updated to avoid the parent job being stuck forever in \n    the waiting-children state.\n]]\n-- Includes\n--[[\n  Validate and move or add dependencies to parent.\n]]\n-- Includes\n--[[\n  Validate and move parent to a wait status (waiting, delayed or prioritized)\n  if no pending dependencies.\n]]\n-- Includes\n--[[\n  Validate and move parent to a wait status (waiting, delayed or prioritized) if needed.\n]]\n-- Includes\n--[[\n  Move parent to a wait status (wait, prioritized or delayed)\n]]\n-- Includes\n--[[\n  Add delay marker if needed.\n]]\n-- Includes\n--[[\n  Function to return the next delayed job timestamp.\n]]\nlocal function getNextDelayedTimestamp(delayedKey)\n  local result = rcall("ZRANGE", delayedKey, 0, 0, "WITHSCORES")\n  if #result then\n    local nextTimestamp = tonumber(result[2])\n    if nextTimestamp ~= nil then\n      return nextTimestamp / 0x1000\n    end\n  end\nend\nlocal function addDelayMarkerIfNeeded(markerKey, delayedKey)\n  local nextTimestamp = getNextDelayedTimestamp(delayedKey)\n  if nextTimestamp ~= nil then\n    -- Replace the score of the marker with the newest known\n    -- next timestamp.\n    rcall("ZADD", markerKey, nextTimestamp, "1")\n  end\nend\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to check if queue is paused or maxed\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function isQueuePausedOrMaxed(queueMetaKey, activeKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      return activeCount >= tonumber(queueAttributes[2])\n    end\n  end\n  return false\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\nlocal function moveParentToWait(parentQueueKey, parentKey, parentId, timestamp)\n    local parentWaitKey = parentQueueKey .. ":wait"\n    local parentPausedKey = parentQueueKey .. ":paused"\n    local parentActiveKey = parentQueueKey .. ":active"\n    local parentMetaKey = parentQueueKey .. ":meta"\n    local parentMarkerKey = parentQueueKey .. ":marker"\n    local jobAttributes = rcall("HMGET", parentKey, "priority", "delay")\n    local priority = tonumber(jobAttributes[1]) or 0\n    local delay = tonumber(jobAttributes[2]) or 0\n    if delay > 0 then\n        local delayedTimestamp = tonumber(timestamp) + delay\n        local score = delayedTimestamp * 0x1000\n        local parentDelayedKey = parentQueueKey .. ":delayed"\n        rcall("ZADD", parentDelayedKey, score, parentId)\n        rcall("XADD", parentQueueKey .. ":events", "*", "event", "delayed", "jobId", parentId, "delay",\n            delayedTimestamp)\n        addDelayMarkerIfNeeded(parentMarkerKey, parentDelayedKey)\n    else\n        if priority == 0 then\n            local parentTarget, isParentPausedOrMaxed = getTargetQueueList(parentMetaKey, parentActiveKey,\n                parentWaitKey, parentPausedKey)\n            addJobInTargetList(parentTarget, parentMarkerKey, "RPUSH", isParentPausedOrMaxed, parentId)\n        else\n            local isPausedOrMaxed = isQueuePausedOrMaxed(parentMetaKey, parentActiveKey)\n            addJobWithPriority(parentMarkerKey, parentQueueKey .. ":prioritized", priority, parentId,\n                parentQueueKey .. ":pc", isPausedOrMaxed)\n        end\n        rcall("XADD", parentQueueKey .. ":events", "*", "event", "waiting", "jobId", parentId, "prev",\n            "waiting-children")\n    end\nend\nlocal function moveParentToWaitIfNeeded(parentQueueKey, parentKey, parentId, timestamp)\n  if rcall("EXISTS", parentKey) == 1 then\n    local parentWaitingChildrenKey = parentQueueKey .. ":waiting-children"\n    if rcall("ZSCORE", parentWaitingChildrenKey, parentId) then    \n      rcall("ZREM", parentWaitingChildrenKey, parentId)\n      moveParentToWait(parentQueueKey, parentKey, parentId, timestamp)\n    end\n  end\nend\nlocal function moveParentToWaitIfNoPendingDependencies(parentQueueKey, parentDependenciesKey, parentKey,\n  parentId, timestamp)\n  local doNotHavePendingDependencies = rcall("SCARD", parentDependenciesKey) == 0\n  if doNotHavePendingDependencies then\n    moveParentToWaitIfNeeded(parentQueueKey, parentKey, parentId, timestamp)\n  end\nend\nlocal function updateParentDepsIfNeeded(parentKey, parentQueueKey, parentDependenciesKey,\n  parentId, jobIdKey, returnvalue, timestamp )\n  local processedSet = parentKey .. ":processed"\n  rcall("HSET", processedSet, jobIdKey, returnvalue)\n  moveParentToWaitIfNoPendingDependencies(parentQueueKey, parentDependenciesKey, parentKey, parentId, timestamp)\nend\nlocal function updateExistingJobsParent(parentKey, parent, parentData,\n                                        parentDependenciesKey, completedKey,\n                                        jobIdKey, jobId, timestamp)\n    if parentKey ~= nil then\n        if rcall("ZSCORE", completedKey, jobId) then\n            local returnvalue = rcall("HGET", jobIdKey, "returnvalue")\n            updateParentDepsIfNeeded(parentKey, parent[\'queueKey\'],\n                                     parentDependenciesKey, parent[\'id\'],\n                                     jobIdKey, returnvalue, timestamp)\n        else\n            if parentDependenciesKey ~= nil then\n                rcall("SADD", parentDependenciesKey, jobIdKey)\n            end\n        end\n        rcall("HMSET", jobIdKey, "parentKey", parentKey, "parent", parentData)\n    end\nend\nlocal function handleDuplicatedJob(jobKey, jobId, currentParentKey, currentParent,\n  parentData, parentDependenciesKey, completedKey, eventsKey, maxEvents, timestamp)\n  local existedParentKey = rcall("HGET", jobKey, "parentKey")\n  if not existedParentKey or existedParentKey == currentParentKey then\n    updateExistingJobsParent(currentParentKey, currentParent, parentData,\n      parentDependenciesKey, completedKey, jobKey,\n      jobId, timestamp)\n  else\n    if currentParentKey ~= nil and currentParentKey ~= existedParentKey\n      and (rcall("EXISTS", existedParentKey) == 1) then\n      return -7\n    end\n  end\n  rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event",\n    "duplicated", "jobId", jobId)\n  return jobId .. "" -- convert to string\nend\nif parentKey ~= nil then\n    if rcall("EXISTS", parentKey) ~= 1 then return -5 end\n    parentData = cjson.encode(parent)\nend\nlocal jobCounter = rcall("INCR", idKey)\nlocal maxEvents = getOrSetMaxEvents(metaKey)\nlocal parentDependenciesKey = args[7]\nlocal timestamp = args[4]\nif args[2] == "" then\n    jobId = jobCounter\n    jobIdKey = args[1] .. jobId\nelse\n    jobId = args[2]\n    jobIdKey = args[1] .. jobId\n    if rcall("EXISTS", jobIdKey) == 1 then\n        return handleDuplicatedJob(jobIdKey, jobId, parentKey, parent,\n            parentData, parentDependenciesKey, completedKey, eventsKey,\n            maxEvents, timestamp)\n    end\nend\nlocal deduplicationJobId = deduplicateJob(opts[\'de\'], jobId, KEYS[5],\n  deduplicationKey, eventsKey, maxEvents, args[1])\nif deduplicationJobId then\n  return deduplicationJobId\nend\n-- Store the job.\nlocal delay, priority = storeJob(eventsKey, jobIdKey, jobId, args[3], ARGV[2],\n                                 opts, timestamp, parentKey, parentData,\n                                 repeatJobKey)\n-- Add the job to the prioritized set\nlocal isPausedOrMaxed = isQueuePausedOrMaxed(metaKey, activeKey)\naddJobWithPriority( KEYS[1], priorityKey, priority, jobId, priorityCounterKey, isPausedOrMaxed)\n-- Emit waiting event\nrcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "waiting",\n      "jobId", jobId)\n-- Check if this job is a child of another job, if so add it to the parents dependencies\nif parentDependenciesKey ~= nil then\n    rcall("SADD", parentDependenciesKey, jobIdKey)\nend\nreturn jobId .. "" -- convert to string\n',keys:9},uR={name:"addRepeatableJob",content:'--[[\n  Adds a repeatable job\n    Input:\n      KEYS[1] \'repeat\' key\n      KEYS[2] \'delayed\' key\n      ARGV[1] next milliseconds\n      ARGV[2] msgpacked options\n            [1]  name\n            [2]  tz?\n            [3]  patten?\n            [4]  endDate?\n            [5]  every?\n      ARGV[3] legacy custom key TODO: remove this logic in next breaking change\n      ARGV[4] custom key\n      ARGV[5] prefix key\n      Output:\n        repeatableKey  - OK\n]]\nlocal rcall = redis.call\nlocal repeatKey = KEYS[1]\nlocal delayedKey = KEYS[2]\nlocal nextMillis = ARGV[1]\nlocal legacyCustomKey = ARGV[3]\nlocal customKey = ARGV[4]\nlocal prefixKey = ARGV[5]\n-- Includes\n--[[\n  Function to remove job.\n]]\n-- Includes\n--[[\n  Function to remove deduplication key if needed\n  when a job is being removed.\n]]\nlocal function removeDeduplicationKeyIfNeededOnRemoval(prefixKey,\n  jobKey, jobId)\n  local deduplicationId = rcall("HGET", jobKey, "deid")\n  if deduplicationId then\n    local deduplicationKey = prefixKey .. "de:" .. deduplicationId\n    local currentJobId = rcall(\'GET\', deduplicationKey)\n    if currentJobId and currentJobId == jobId then\n      return rcall("DEL", deduplicationKey)\n    end\n  end\nend\n--[[\n  Function to remove job keys.\n]]\nlocal function removeJobKeys(jobKey)\n  return rcall("DEL", jobKey, jobKey .. \':logs\', jobKey .. \':dependencies\',\n    jobKey .. \':processed\', jobKey .. \':failed\', jobKey .. \':unsuccessful\')\nend\n--[[\n  Check if this job has a parent. If so we will just remove it from\n  the parent child list, but if it is the last child we should move the parent to "wait/paused"\n  which requires code from "moveToFinished"\n]]\n-- Includes\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Functions to destructure job key.\n  Just a bit of warning, these functions may be a bit slow and affect performance significantly.\n]]\nlocal getJobIdFromKey = function (jobKey)\n  return string.match(jobKey, ".*:(.*)")\nend\nlocal getJobKeyPrefix = function (jobKey, jobId)\n  return string.sub(jobKey, 0, #jobKey - #jobId)\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\nlocal function _moveParentToWait(parentPrefix, parentId, emitEvent)\n  local parentTarget, isPausedOrMaxed = getTargetQueueList(parentPrefix .. "meta", parentPrefix .. "active",\n    parentPrefix .. "wait", parentPrefix .. "paused")\n  addJobInTargetList(parentTarget, parentPrefix .. "marker", "RPUSH", isPausedOrMaxed, parentId)\n  if emitEvent then\n    local parentEventStream = parentPrefix .. "events"\n    rcall("XADD", parentEventStream, "*", "event", "waiting", "jobId", parentId, "prev", "waiting-children")\n  end\nend\nlocal function removeParentDependencyKey(jobKey, hard, parentKey, baseKey, debounceId)\n  if parentKey then\n    local parentDependenciesKey = parentKey .. ":dependencies"\n    local result = rcall("SREM", parentDependenciesKey, jobKey)\n    if result > 0 then\n      local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n      if pendingDependencies == 0 then\n        local parentId = getJobIdFromKey(parentKey)\n        local parentPrefix = getJobKeyPrefix(parentKey, parentId)\n        local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n        if numRemovedElements == 1 then\n          if hard then -- remove parent in same queue\n            if parentPrefix == baseKey then\n              removeParentDependencyKey(parentKey, hard, nil, baseKey, nil)\n              removeJobKeys(parentKey)\n              if debounceId then\n                rcall("DEL", parentPrefix .. "de:" .. debounceId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId)\n            end\n          else\n            _moveParentToWait(parentPrefix, parentId, true)\n          end\n        end\n      end\n      return true\n    end\n  else\n    local parentAttributes = rcall("HMGET", jobKey, "parentKey", "deid")\n    local missedParentKey = parentAttributes[1]\n    if( (type(missedParentKey) == "string") and missedParentKey ~= ""\n      and (rcall("EXISTS", missedParentKey) == 1)) then\n      local parentDependenciesKey = missedParentKey .. ":dependencies"\n      local result = rcall("SREM", parentDependenciesKey, jobKey)\n      if result > 0 then\n        local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n        if pendingDependencies == 0 then\n          local parentId = getJobIdFromKey(missedParentKey)\n          local parentPrefix = getJobKeyPrefix(missedParentKey, parentId)\n          local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n          if numRemovedElements == 1 then\n            if hard then\n              if parentPrefix == baseKey then\n                removeParentDependencyKey(missedParentKey, hard, nil, baseKey, nil)\n                removeJobKeys(missedParentKey)\n                if parentAttributes[2] then\n                  rcall("DEL", parentPrefix .. "de:" .. parentAttributes[2])\n                end\n              else\n                _moveParentToWait(parentPrefix, parentId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId, true)\n            end\n          end\n        end\n        return true\n      end\n    end\n  end\n  return false\nend\nlocal function removeJob(jobId, hard, baseKey, shouldRemoveDeduplicationKey)\n  local jobKey = baseKey .. jobId\n  removeParentDependencyKey(jobKey, hard, nil, baseKey)\n  if shouldRemoveDeduplicationKey then\n    removeDeduplicationKeyIfNeededOnRemoval(baseKey, jobKey, jobId)\n  end\n  removeJobKeys(jobKey)\nend\nlocal function storeRepeatableJob(repeatKey, customKey, nextMillis, rawOpts)\n  rcall("ZADD", repeatKey, nextMillis, customKey)\n  local opts = cmsgpack.unpack(rawOpts)\n  local optionalValues = {}\n  if opts[\'tz\'] then\n    table.insert(optionalValues, "tz")\n    table.insert(optionalValues, opts[\'tz\'])\n  end\n  if opts[\'pattern\'] then\n    table.insert(optionalValues, "pattern")\n    table.insert(optionalValues, opts[\'pattern\'])\n  end\n  if opts[\'endDate\'] then\n    table.insert(optionalValues, "endDate")\n    table.insert(optionalValues, opts[\'endDate\'])\n  end\n  if opts[\'every\'] then\n    table.insert(optionalValues, "every")\n    table.insert(optionalValues, opts[\'every\'])\n  end\n  rcall("HMSET", repeatKey .. ":" .. customKey, "name", opts[\'name\'],\n    unpack(optionalValues))\n  return customKey\nend\n-- If we are overriding a repeatable job we must delete the delayed job for\n-- the next iteration.\nlocal prevMillis = rcall("ZSCORE", repeatKey, customKey)\nif prevMillis then\n  local delayedJobId =  "repeat:" .. customKey .. ":" .. prevMillis\n  local nextDelayedJobId =  repeatKey .. ":" .. customKey .. ":" .. nextMillis\n  if rcall("ZSCORE", delayedKey, delayedJobId)\n   and rcall("EXISTS", nextDelayedJobId) ~= 1 then\n    removeJob(delayedJobId, true, prefixKey, true --[[remove debounce key]])\n    rcall("ZREM", delayedKey, delayedJobId)\n  end\nend\n-- Keep backwards compatibility with old repeatable jobs (<= 3.0.0)\nif rcall("ZSCORE", repeatKey, legacyCustomKey) ~= false then\n  return storeRepeatableJob(repeatKey, legacyCustomKey, nextMillis, ARGV[2])\nend\nreturn storeRepeatableJob(repeatKey, customKey, nextMillis, ARGV[2])\n',keys:2},dR={name:"addStandardJob",content:'--[[\n  Adds a job to the queue by doing the following:\n    - Increases the job counter if needed.\n    - Creates a new job key with the job data.\n    - if delayed:\n      - computes timestamp.\n      - adds to delayed zset.\n      - Emits a global event \'delayed\' if the job is delayed.\n    - if not delayed\n      - Adds the jobId to the wait/paused list in one of three ways:\n         - LIFO\n         - FIFO\n         - prioritized.\n      - Adds the job to the "added" list so that workers gets notified.\n    Input:\n      KEYS[1] \'wait\',\n      KEYS[2] \'paused\'\n      KEYS[3] \'meta\'\n      KEYS[4] \'id\'\n      KEYS[5] \'completed\'\n      KEYS[6] \'delayed\'\n      KEYS[7] \'active\'\n      KEYS[8] events stream key\n      KEYS[9] marker key\n      ARGV[1] msgpacked arguments array\n            [1]  key prefix,\n            [2]  custom id (will not generate one automatically)\n            [3]  name\n            [4]  timestamp\n            [5]  parentKey?\n            [6]  waitChildrenKey key.\n            [7]  parent dependencies key.\n            [8]  parent? {id, queueKey}\n            [9]  repeat job key\n            [10] deduplication key\n      ARGV[2] Json stringified job data\n      ARGV[3] msgpacked options\n      Output:\n        jobId  - OK\n        -5     - Missing parent key\n]]\nlocal eventsKey = KEYS[8]\nlocal jobId\nlocal jobIdKey\nlocal rcall = redis.call\nlocal args = cmsgpack.unpack(ARGV[1])\nlocal data = ARGV[2]\nlocal opts = cmsgpack.unpack(ARGV[3])\nlocal parentKey = args[5]\nlocal parent = args[8]\nlocal repeatJobKey = args[9]\nlocal deduplicationKey = args[10]\nlocal parentData\n-- Includes\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to debounce a job.\n]]\n-- Includes\n--[[\n  Function to remove job keys.\n]]\nlocal function removeJobKeys(jobKey)\n  return rcall("DEL", jobKey, jobKey .. \':logs\', jobKey .. \':dependencies\',\n    jobKey .. \':processed\', jobKey .. \':failed\', jobKey .. \':unsuccessful\')\nend\nlocal function deduplicateJob(deduplicationOpts, jobId, delayedKey, deduplicationKey, eventsKey, maxEvents,\n    prefix)\n    local deduplicationId = deduplicationOpts and deduplicationOpts[\'id\']\n    if deduplicationId then\n        local ttl = deduplicationOpts[\'ttl\']\n        if deduplicationOpts[\'replace\'] and ttl and ttl > 0 then\n            local currentDebounceJobId = rcall(\'GET\', deduplicationKey)\n            if currentDebounceJobId then\n                if rcall("ZREM", delayedKey, currentDebounceJobId) > 0 then\n                    removeJobKeys(prefix .. currentDebounceJobId)\n                    rcall("XADD", eventsKey, "*", "event", "removed", "jobId", currentDebounceJobId,\n                        "prev", "delayed")\n                    if deduplicationOpts[\'extend\'] then\n                        rcall(\'SET\', deduplicationKey, jobId, \'PX\', ttl)\n                    else\n                        rcall(\'SET\', deduplicationKey, jobId, \'KEEPTTL\')\n                    end\n                    rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "deduplicated", "jobId",\n                        jobId, "deduplicationId", deduplicationId, "deduplicatedJobId", currentDebounceJobId)\n                    return\n                else\n                    return currentDebounceJobId\n                end\n            else\n                rcall(\'SET\', deduplicationKey, jobId, \'PX\', ttl)\n                return\n            end\n        else\n            local ttl = deduplicationOpts[\'ttl\']\n            local deduplicationKeyExists\n            if ttl then\n                if deduplicationOpts[\'extend\'] then\n                    local currentDebounceJobId = rcall(\'GET\', deduplicationKey)\n                    if currentDebounceJobId then\n                        rcall(\'SET\', deduplicationKey, currentDebounceJobId, \'PX\', ttl)\n                        rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "debounced",\n                            "jobId", currentDebounceJobId, "debounceId", deduplicationId)\n                        rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "deduplicated", "jobId",\n                            currentDebounceJobId, "deduplicationId", deduplicationId, "deduplicatedJobId", jobId)\n                        return currentDebounceJobId\n                    else\n                        rcall(\'SET\', deduplicationKey, jobId, \'PX\', ttl)\n                        return\n                    end\n                else\n                    deduplicationKeyExists = not rcall(\'SET\', deduplicationKey, jobId, \'PX\', ttl, \'NX\')\n                end\n            else\n                deduplicationKeyExists = not rcall(\'SET\', deduplicationKey, jobId, \'NX\')\n            end\n            if deduplicationKeyExists then\n                local currentDebounceJobId = rcall(\'GET\', deduplicationKey)\n                rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "debounced", "jobId",\n                    currentDebounceJobId, "debounceId", deduplicationId)\n                rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "deduplicated", "jobId",\n                    currentDebounceJobId, "deduplicationId", deduplicationId, "deduplicatedJobId", jobId)\n                return currentDebounceJobId\n            end\n        end\n    end\nend\n--[[\n  Function to get max events value or set by default 10000.\n]]\nlocal function getOrSetMaxEvents(metaKey)\n  local maxEvents = rcall("HGET", metaKey, "opts.maxLenEvents")\n  if not maxEvents then\n    maxEvents = 10000\n    rcall("HSET", metaKey, "opts.maxLenEvents", maxEvents)\n  end\n  return maxEvents\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\n--[[\n  Function to handle the case when job is duplicated.\n]]\n-- Includes\n--[[\n    This function is used to update the parent\'s dependencies if the job\n    is already completed and about to be ignored. The parent must get its\n    dependencies updated to avoid the parent job being stuck forever in \n    the waiting-children state.\n]]\n-- Includes\n--[[\n  Validate and move or add dependencies to parent.\n]]\n-- Includes\n--[[\n  Validate and move parent to a wait status (waiting, delayed or prioritized)\n  if no pending dependencies.\n]]\n-- Includes\n--[[\n  Validate and move parent to a wait status (waiting, delayed or prioritized) if needed.\n]]\n-- Includes\n--[[\n  Move parent to a wait status (wait, prioritized or delayed)\n]]\n-- Includes\n--[[\n  Add delay marker if needed.\n]]\n-- Includes\n--[[\n  Function to return the next delayed job timestamp.\n]]\nlocal function getNextDelayedTimestamp(delayedKey)\n  local result = rcall("ZRANGE", delayedKey, 0, 0, "WITHSCORES")\n  if #result then\n    local nextTimestamp = tonumber(result[2])\n    if nextTimestamp ~= nil then\n      return nextTimestamp / 0x1000\n    end\n  end\nend\nlocal function addDelayMarkerIfNeeded(markerKey, delayedKey)\n  local nextTimestamp = getNextDelayedTimestamp(delayedKey)\n  if nextTimestamp ~= nil then\n    -- Replace the score of the marker with the newest known\n    -- next timestamp.\n    rcall("ZADD", markerKey, nextTimestamp, "1")\n  end\nend\n--[[\n  Function to add job considering priority.\n]]\n-- Includes\n--[[\n  Function to get priority score.\n]]\nlocal function getPriorityScore(priority, priorityCounterKey)\n  local prioCounter = rcall("INCR", priorityCounterKey)\n  return priority * 0x100000000 + prioCounter % 0x100000000\nend\nlocal function addJobWithPriority(markerKey, prioritizedKey, priority, jobId, priorityCounterKey,\n  isPausedOrMaxed)\n  local score = getPriorityScore(priority, priorityCounterKey)\n  rcall("ZADD", prioritizedKey, score, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to check if queue is paused or maxed\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function isQueuePausedOrMaxed(queueMetaKey, activeKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      return activeCount >= tonumber(queueAttributes[2])\n    end\n  end\n  return false\nend\nlocal function moveParentToWait(parentQueueKey, parentKey, parentId, timestamp)\n    local parentWaitKey = parentQueueKey .. ":wait"\n    local parentPausedKey = parentQueueKey .. ":paused"\n    local parentActiveKey = parentQueueKey .. ":active"\n    local parentMetaKey = parentQueueKey .. ":meta"\n    local parentMarkerKey = parentQueueKey .. ":marker"\n    local jobAttributes = rcall("HMGET", parentKey, "priority", "delay")\n    local priority = tonumber(jobAttributes[1]) or 0\n    local delay = tonumber(jobAttributes[2]) or 0\n    if delay > 0 then\n        local delayedTimestamp = tonumber(timestamp) + delay\n        local score = delayedTimestamp * 0x1000\n        local parentDelayedKey = parentQueueKey .. ":delayed"\n        rcall("ZADD", parentDelayedKey, score, parentId)\n        rcall("XADD", parentQueueKey .. ":events", "*", "event", "delayed", "jobId", parentId, "delay",\n            delayedTimestamp)\n        addDelayMarkerIfNeeded(parentMarkerKey, parentDelayedKey)\n    else\n        if priority == 0 then\n            local parentTarget, isParentPausedOrMaxed = getTargetQueueList(parentMetaKey, parentActiveKey,\n                parentWaitKey, parentPausedKey)\n            addJobInTargetList(parentTarget, parentMarkerKey, "RPUSH", isParentPausedOrMaxed, parentId)\n        else\n            local isPausedOrMaxed = isQueuePausedOrMaxed(parentMetaKey, parentActiveKey)\n            addJobWithPriority(parentMarkerKey, parentQueueKey .. ":prioritized", priority, parentId,\n                parentQueueKey .. ":pc", isPausedOrMaxed)\n        end\n        rcall("XADD", parentQueueKey .. ":events", "*", "event", "waiting", "jobId", parentId, "prev",\n            "waiting-children")\n    end\nend\nlocal function moveParentToWaitIfNeeded(parentQueueKey, parentKey, parentId, timestamp)\n  if rcall("EXISTS", parentKey) == 1 then\n    local parentWaitingChildrenKey = parentQueueKey .. ":waiting-children"\n    if rcall("ZSCORE", parentWaitingChildrenKey, parentId) then    \n      rcall("ZREM", parentWaitingChildrenKey, parentId)\n      moveParentToWait(parentQueueKey, parentKey, parentId, timestamp)\n    end\n  end\nend\nlocal function moveParentToWaitIfNoPendingDependencies(parentQueueKey, parentDependenciesKey, parentKey,\n  parentId, timestamp)\n  local doNotHavePendingDependencies = rcall("SCARD", parentDependenciesKey) == 0\n  if doNotHavePendingDependencies then\n    moveParentToWaitIfNeeded(parentQueueKey, parentKey, parentId, timestamp)\n  end\nend\nlocal function updateParentDepsIfNeeded(parentKey, parentQueueKey, parentDependenciesKey,\n  parentId, jobIdKey, returnvalue, timestamp )\n  local processedSet = parentKey .. ":processed"\n  rcall("HSET", processedSet, jobIdKey, returnvalue)\n  moveParentToWaitIfNoPendingDependencies(parentQueueKey, parentDependenciesKey, parentKey, parentId, timestamp)\nend\nlocal function updateExistingJobsParent(parentKey, parent, parentData,\n                                        parentDependenciesKey, completedKey,\n                                        jobIdKey, jobId, timestamp)\n    if parentKey ~= nil then\n        if rcall("ZSCORE", completedKey, jobId) then\n            local returnvalue = rcall("HGET", jobIdKey, "returnvalue")\n            updateParentDepsIfNeeded(parentKey, parent[\'queueKey\'],\n                                     parentDependenciesKey, parent[\'id\'],\n                                     jobIdKey, returnvalue, timestamp)\n        else\n            if parentDependenciesKey ~= nil then\n                rcall("SADD", parentDependenciesKey, jobIdKey)\n            end\n        end\n        rcall("HMSET", jobIdKey, "parentKey", parentKey, "parent", parentData)\n    end\nend\nlocal function handleDuplicatedJob(jobKey, jobId, currentParentKey, currentParent,\n  parentData, parentDependenciesKey, completedKey, eventsKey, maxEvents, timestamp)\n  local existedParentKey = rcall("HGET", jobKey, "parentKey")\n  if not existedParentKey or existedParentKey == currentParentKey then\n    updateExistingJobsParent(currentParentKey, currentParent, parentData,\n      parentDependenciesKey, completedKey, jobKey,\n      jobId, timestamp)\n  else\n    if currentParentKey ~= nil and currentParentKey ~= existedParentKey\n      and (rcall("EXISTS", existedParentKey) == 1) then\n      return -7\n    end\n  end\n  rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event",\n    "duplicated", "jobId", jobId)\n  return jobId .. "" -- convert to string\nend\n--[[\n  Function to store a job\n]]\nlocal function storeJob(eventsKey, jobIdKey, jobId, name, data, opts, timestamp,\n                        parentKey, parentData, repeatJobKey)\n    local jsonOpts = cjson.encode(opts)\n    local delay = opts[\'delay\'] or 0\n    local priority = opts[\'priority\'] or 0\n    local debounceId = opts[\'de\'] and opts[\'de\'][\'id\']\n    local optionalValues = {}\n    if parentKey ~= nil then\n        table.insert(optionalValues, "parentKey")\n        table.insert(optionalValues, parentKey)\n        table.insert(optionalValues, "parent")\n        table.insert(optionalValues, parentData)\n    end\n    if repeatJobKey then\n        table.insert(optionalValues, "rjk")\n        table.insert(optionalValues, repeatJobKey)\n    end\n    if debounceId then\n        table.insert(optionalValues, "deid")\n        table.insert(optionalValues, debounceId)\n    end\n    rcall("HMSET", jobIdKey, "name", name, "data", data, "opts", jsonOpts,\n          "timestamp", timestamp, "delay", delay, "priority", priority,\n          unpack(optionalValues))\n    rcall("XADD", eventsKey, "*", "event", "added", "jobId", jobId, "name", name)\n    return delay, priority\nend\nif parentKey ~= nil then\n    if rcall("EXISTS", parentKey) ~= 1 then return -5 end\n    parentData = cjson.encode(parent)\nend\nlocal jobCounter = rcall("INCR", KEYS[4])\nlocal metaKey = KEYS[3]\nlocal maxEvents = getOrSetMaxEvents(metaKey)\nlocal parentDependenciesKey = args[7]\nlocal timestamp = args[4]\nif args[2] == "" then\n    jobId = jobCounter\n    jobIdKey = args[1] .. jobId\nelse\n    jobId = args[2]\n    jobIdKey = args[1] .. jobId\n    if rcall("EXISTS", jobIdKey) == 1 then\n        return handleDuplicatedJob(jobIdKey, jobId, parentKey, parent,\n            parentData, parentDependenciesKey, KEYS[5], eventsKey,\n            maxEvents, timestamp)\n    end\nend\nlocal deduplicationJobId = deduplicateJob(opts[\'de\'], jobId, KEYS[6],\n  deduplicationKey, eventsKey, maxEvents, args[1])\nif deduplicationJobId then\n  return deduplicationJobId\nend\n-- Store the job.\nstoreJob(eventsKey, jobIdKey, jobId, args[3], ARGV[2], opts, timestamp,\n         parentKey, parentData, repeatJobKey)\nlocal target, isPausedOrMaxed = getTargetQueueList(metaKey, KEYS[7], KEYS[1], KEYS[2])\n-- LIFO or FIFO\nlocal pushCmd = opts[\'lifo\'] and \'RPUSH\' or \'LPUSH\'\naddJobInTargetList(target, KEYS[9], pushCmd, isPausedOrMaxed, jobId)\n-- Emit waiting event\nrcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "waiting",\n      "jobId", jobId)\n-- Check if this job is a child of another job, if so add it to the parents dependencies\nif parentDependenciesKey ~= nil then\n    rcall("SADD", parentDependenciesKey, jobIdKey)\nend\nreturn jobId .. "" -- convert to string\n',keys:9},pR={name:"changeDelay",content:'--[[\n  Change job delay when it is in delayed set.\n  Input:\n    KEYS[1] delayed key\n    KEYS[2] meta key\n    KEYS[3] marker key\n    KEYS[4] events stream\n    ARGV[1] delay\n    ARGV[2] timestamp\n    ARGV[3] the id of the job\n    ARGV[4] job key\n  Output:\n    0 - OK\n   -1 - Missing job.\n   -3 - Job not in delayed set.\n  Events:\n    - delayed key.\n]]\nlocal rcall = redis.call\n-- Includes\n--[[\n  Add delay marker if needed.\n]]\n-- Includes\n--[[\n  Function to return the next delayed job timestamp.\n]]\nlocal function getNextDelayedTimestamp(delayedKey)\n  local result = rcall("ZRANGE", delayedKey, 0, 0, "WITHSCORES")\n  if #result then\n    local nextTimestamp = tonumber(result[2])\n    if nextTimestamp ~= nil then\n      return nextTimestamp / 0x1000\n    end\n  end\nend\nlocal function addDelayMarkerIfNeeded(markerKey, delayedKey)\n  local nextTimestamp = getNextDelayedTimestamp(delayedKey)\n  if nextTimestamp ~= nil then\n    -- Replace the score of the marker with the newest known\n    -- next timestamp.\n    rcall("ZADD", markerKey, nextTimestamp, "1")\n  end\nend\n--[[\n  Bake in the job id first 12 bits into the timestamp\n  to guarantee correct execution order of delayed jobs\n  (up to 4096 jobs per given timestamp or 4096 jobs apart per timestamp)\n  WARNING: Jobs that are so far apart that they wrap around will cause FIFO to fail\n]]\nlocal function getDelayedScore(delayedKey, timestamp, delay)\n  local delayedTimestamp = (delay > 0 and (tonumber(timestamp) + delay)) or tonumber(timestamp)\n  local minScore = delayedTimestamp * 0x1000\n  local maxScore = (delayedTimestamp + 1 ) * 0x1000 - 1\n  local result = rcall("ZREVRANGEBYSCORE", delayedKey, maxScore,\n    minScore, "WITHSCORES","LIMIT", 0, 1)\n  if #result then\n    local currentMaxScore = tonumber(result[2])\n    if currentMaxScore ~= nil then\n      if currentMaxScore >= maxScore then\n        return maxScore, delayedTimestamp\n      else\n        return currentMaxScore + 1, delayedTimestamp\n      end\n    end\n  end\n  return minScore, delayedTimestamp\nend\n--[[\n  Function to get max events value or set by default 10000.\n]]\nlocal function getOrSetMaxEvents(metaKey)\n  local maxEvents = rcall("HGET", metaKey, "opts.maxLenEvents")\n  if not maxEvents then\n    maxEvents = 10000\n    rcall("HSET", metaKey, "opts.maxLenEvents", maxEvents)\n  end\n  return maxEvents\nend\nif rcall("EXISTS", ARGV[4]) == 1 then\n  local jobId = ARGV[3]\n  local delay = tonumber(ARGV[1])\n  local score, delayedTimestamp = getDelayedScore(KEYS[1], ARGV[2], delay)\n  local numRemovedElements = rcall("ZREM", KEYS[1], jobId)\n  if numRemovedElements < 1 then\n    return -3\n  end\n  rcall("HSET", ARGV[4], "delay", delay)\n  rcall("ZADD", KEYS[1], score, jobId)\n  local maxEvents = getOrSetMaxEvents(KEYS[2])\n  rcall("XADD", KEYS[4], "MAXLEN", "~", maxEvents, "*", "event", "delayed",\n    "jobId", jobId, "delay", delayedTimestamp)\n  -- mark that a delayed job is available\n  addDelayMarkerIfNeeded(KEYS[3], KEYS[1])\n  return 0\nelse\n  return -1\nend',keys:4},hR={name:"changePriority",content:'--[[\n  Change job priority\n  Input:\n    KEYS[1] \'wait\',\n    KEYS[2] \'paused\'\n    KEYS[3] \'meta\'\n    KEYS[4] \'prioritized\'\n    KEYS[5] \'active\'\n    KEYS[6] \'pc\' priority counter\n    KEYS[7] \'marker\'\n    ARGV[1] priority value\n    ARGV[2] prefix key\n    ARGV[3] job id\n    ARGV[4] lifo\n    Output:\n       0  - OK\n      -1  - Missing job\n]]\nlocal jobId = ARGV[3]\nlocal jobKey = ARGV[2] .. jobId\nlocal priority = tonumber(ARGV[1])\nlocal rcall = redis.call\n-- Includes\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to add job considering priority.\n]]\n-- Includes\n--[[\n  Function to get priority score.\n]]\nlocal function getPriorityScore(priority, priorityCounterKey)\n  local prioCounter = rcall("INCR", priorityCounterKey)\n  return priority * 0x100000000 + prioCounter % 0x100000000\nend\nlocal function addJobWithPriority(markerKey, prioritizedKey, priority, jobId, priorityCounterKey,\n  isPausedOrMaxed)\n  local score = getPriorityScore(priority, priorityCounterKey)\n  rcall("ZADD", prioritizedKey, score, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\n--[[\n  Function to push back job considering priority in front of same prioritized jobs.\n]]\nlocal function pushBackJobWithPriority(prioritizedKey, priority, jobId)\n  -- in order to put it at front of same prioritized jobs\n  -- we consider prioritized counter as 0\n  local score = priority * 0x100000000\n  rcall("ZADD", prioritizedKey, score, jobId)\nend\nlocal function reAddJobWithNewPriority( prioritizedKey, markerKey, targetKey,\n    priorityCounter, lifo, priority, jobId, isPausedOrMaxed)\n    if priority == 0 then\n        local pushCmd = lifo and \'RPUSH\' or \'LPUSH\'\n        addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n    else\n        if lifo then\n            pushBackJobWithPriority(prioritizedKey, priority, jobId)\n        else\n            addJobWithPriority(markerKey, prioritizedKey, priority, jobId,\n                priorityCounter, isPausedOrMaxed)\n        end\n    end\nend\nif rcall("EXISTS", jobKey) == 1 then\n    local metaKey = KEYS[3]\n    local target, isPausedOrMaxed = getTargetQueueList(metaKey, KEYS[5], KEYS[1], KEYS[2])\n    local prioritizedKey = KEYS[4]\n    local priorityCounterKey = KEYS[6]\n    local markerKey = KEYS[7]\n    -- Re-add with the new priority\n    if rcall("ZREM", prioritizedKey, jobId) > 0 then\n        reAddJobWithNewPriority( prioritizedKey, markerKey, target,\n            priorityCounterKey, ARGV[4] == \'1\', priority, jobId, isPausedOrMaxed)\n    elseif rcall("LREM", target, -1, jobId) > 0 then\n        reAddJobWithNewPriority( prioritizedKey, markerKey, target,\n            priorityCounterKey, ARGV[4] == \'1\', priority, jobId, isPausedOrMaxed)\n    end\n    rcall("HSET", jobKey, "priority", priority)\n    return 0\nelse\n    return -1\nend\n',keys:7},mR={name:"cleanJobsInSet",content:'--[[\n  Remove jobs from the specific set.\n  Input:\n    KEYS[1]  set key,\n    KEYS[2]  events stream key\n    KEYS[3]  repeat key\n    ARGV[1]  jobKey prefix\n    ARGV[2]  timestamp\n    ARGV[3]  limit the number of jobs to be removed. 0 is unlimited\n    ARGV[4]  set name, can be any of \'wait\', \'active\', \'paused\', \'delayed\', \'completed\', or \'failed\'\n]]\nlocal rcall = redis.call\nlocal repeatKey = KEYS[3]\nlocal rangeStart = 0\nlocal rangeEnd = -1\nlocal limit = tonumber(ARGV[3])\n-- If we\'re only deleting _n_ items, avoid retrieving all items\n-- for faster performance\n--\n-- Start from the tail of the list, since that\'s where oldest elements\n-- are generally added for FIFO lists\nif limit > 0 then\n  rangeStart = -1 - limit + 1\n  rangeEnd = -1\nend\n-- Includes\n--[[\n  Function to clean job list.\n  Returns jobIds and deleted count number.\n]]\n-- Includes\n--[[\n  Function to get the latest saved timestamp.\n]]\nlocal function getTimestamp(jobKey, attributes)\n  if #attributes == 1 then\n    return rcall("HGET", jobKey, attributes[1])\n  end\n  local jobTs\n  for _, ts in ipairs(rcall("HMGET", jobKey, unpack(attributes))) do\n    if (ts) then\n      jobTs = ts\n      break\n    end\n  end\n  return jobTs\nend\n--[[\n  Function to check if the job belongs to a job scheduler and\n  current delayed job matches with jobId\n]]\nlocal function isJobSchedulerJob(jobId, jobKey, jobSchedulersKey)\n  local repeatJobKey = rcall("HGET", jobKey, "rjk")\n  if repeatJobKey  then\n    local prevMillis = rcall("ZSCORE", jobSchedulersKey, repeatJobKey)\n    if prevMillis then\n      local currentDelayedJobId = "repeat:" .. repeatJobKey .. ":" .. prevMillis\n      return jobId == currentDelayedJobId\n    end\n  end\n  return false\nend\n--[[\n  Function to remove job.\n]]\n-- Includes\n--[[\n  Function to remove deduplication key if needed\n  when a job is being removed.\n]]\nlocal function removeDeduplicationKeyIfNeededOnRemoval(prefixKey,\n  jobKey, jobId)\n  local deduplicationId = rcall("HGET", jobKey, "deid")\n  if deduplicationId then\n    local deduplicationKey = prefixKey .. "de:" .. deduplicationId\n    local currentJobId = rcall(\'GET\', deduplicationKey)\n    if currentJobId and currentJobId == jobId then\n      return rcall("DEL", deduplicationKey)\n    end\n  end\nend\n--[[\n  Function to remove job keys.\n]]\nlocal function removeJobKeys(jobKey)\n  return rcall("DEL", jobKey, jobKey .. \':logs\', jobKey .. \':dependencies\',\n    jobKey .. \':processed\', jobKey .. \':failed\', jobKey .. \':unsuccessful\')\nend\n--[[\n  Check if this job has a parent. If so we will just remove it from\n  the parent child list, but if it is the last child we should move the parent to "wait/paused"\n  which requires code from "moveToFinished"\n]]\n-- Includes\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Functions to destructure job key.\n  Just a bit of warning, these functions may be a bit slow and affect performance significantly.\n]]\nlocal getJobIdFromKey = function (jobKey)\n  return string.match(jobKey, ".*:(.*)")\nend\nlocal getJobKeyPrefix = function (jobKey, jobId)\n  return string.sub(jobKey, 0, #jobKey - #jobId)\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\nlocal function _moveParentToWait(parentPrefix, parentId, emitEvent)\n  local parentTarget, isPausedOrMaxed = getTargetQueueList(parentPrefix .. "meta", parentPrefix .. "active",\n    parentPrefix .. "wait", parentPrefix .. "paused")\n  addJobInTargetList(parentTarget, parentPrefix .. "marker", "RPUSH", isPausedOrMaxed, parentId)\n  if emitEvent then\n    local parentEventStream = parentPrefix .. "events"\n    rcall("XADD", parentEventStream, "*", "event", "waiting", "jobId", parentId, "prev", "waiting-children")\n  end\nend\nlocal function removeParentDependencyKey(jobKey, hard, parentKey, baseKey, debounceId)\n  if parentKey then\n    local parentDependenciesKey = parentKey .. ":dependencies"\n    local result = rcall("SREM", parentDependenciesKey, jobKey)\n    if result > 0 then\n      local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n      if pendingDependencies == 0 then\n        local parentId = getJobIdFromKey(parentKey)\n        local parentPrefix = getJobKeyPrefix(parentKey, parentId)\n        local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n        if numRemovedElements == 1 then\n          if hard then -- remove parent in same queue\n            if parentPrefix == baseKey then\n              removeParentDependencyKey(parentKey, hard, nil, baseKey, nil)\n              removeJobKeys(parentKey)\n              if debounceId then\n                rcall("DEL", parentPrefix .. "de:" .. debounceId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId)\n            end\n          else\n            _moveParentToWait(parentPrefix, parentId, true)\n          end\n        end\n      end\n      return true\n    end\n  else\n    local parentAttributes = rcall("HMGET", jobKey, "parentKey", "deid")\n    local missedParentKey = parentAttributes[1]\n    if( (type(missedParentKey) == "string") and missedParentKey ~= ""\n      and (rcall("EXISTS", missedParentKey) == 1)) then\n      local parentDependenciesKey = missedParentKey .. ":dependencies"\n      local result = rcall("SREM", parentDependenciesKey, jobKey)\n      if result > 0 then\n        local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n        if pendingDependencies == 0 then\n          local parentId = getJobIdFromKey(missedParentKey)\n          local parentPrefix = getJobKeyPrefix(missedParentKey, parentId)\n          local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n          if numRemovedElements == 1 then\n            if hard then\n              if parentPrefix == baseKey then\n                removeParentDependencyKey(missedParentKey, hard, nil, baseKey, nil)\n                removeJobKeys(missedParentKey)\n                if parentAttributes[2] then\n                  rcall("DEL", parentPrefix .. "de:" .. parentAttributes[2])\n                end\n              else\n                _moveParentToWait(parentPrefix, parentId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId, true)\n            end\n          end\n        end\n        return true\n      end\n    end\n  end\n  return false\nend\nlocal function removeJob(jobId, hard, baseKey, shouldRemoveDeduplicationKey)\n  local jobKey = baseKey .. jobId\n  removeParentDependencyKey(jobKey, hard, nil, baseKey)\n  if shouldRemoveDeduplicationKey then\n    removeDeduplicationKeyIfNeededOnRemoval(baseKey, jobKey, jobId)\n  end\n  removeJobKeys(jobKey)\nend\nlocal function cleanList(listKey, jobKeyPrefix, rangeStart, rangeEnd,\n  timestamp, isWaiting, jobSchedulersKey)\n  local jobs = rcall("LRANGE", listKey, rangeStart, rangeEnd)\n  local deleted = {}\n  local deletedCount = 0\n  local jobTS\n  local deletionMarker = \'\'\n  local jobIdsLen = #jobs\n  for i, job in ipairs(jobs) do\n    if limit > 0 and deletedCount >= limit then\n      break\n    end\n    local jobKey = jobKeyPrefix .. job\n    if (isWaiting or rcall("EXISTS", jobKey .. ":lock") == 0) and\n      not isJobSchedulerJob(job, jobKey, jobSchedulersKey) then\n      -- Find the right timestamp of the job to compare to maxTimestamp:\n      -- * finishedOn says when the job was completed, but it isn\'t set unless the job has actually completed\n      -- * processedOn represents when the job was last attempted, but it doesn\'t get populated until\n      --   the job is first tried\n      -- * timestamp is the original job submission time\n      -- Fetch all three of these (in that order) and use the first one that is set so that we\'ll leave jobs\n      -- that have been active within the grace period:\n      jobTS = getTimestamp(jobKey, {"finishedOn", "processedOn", "timestamp"})\n      if (not jobTS or jobTS <= timestamp) then\n        -- replace the entry with a deletion marker; the actual deletion will\n        -- occur at the end of the script\n        rcall("LSET", listKey, rangeEnd - jobIdsLen + i, deletionMarker)\n        removeJob(job, true, jobKeyPrefix, true --[[remove debounce key]])\n        deletedCount = deletedCount + 1\n        table.insert(deleted, job)\n      end\n    end\n  end\n  rcall("LREM", listKey, 0, deletionMarker)\n  return {deleted, deletedCount}\nend\n--[[\n  Function to clean job set.\n  Returns jobIds and deleted count number.\n]] \n-- Includes\n--[[\n  Function to loop in batches.\n  Just a bit of warning, some commands as ZREM\n  could receive a maximum of 7000 parameters per call.\n]]\nlocal function batches(n, batchSize)\n  local i = 0\n  return function()\n    local from = i * batchSize + 1\n    i = i + 1\n    if (from <= n) then\n      local to = math.min(from + batchSize - 1, n)\n      return from, to\n    end\n  end\nend\n--[[\n  We use ZRANGEBYSCORE to make the case where we\'re deleting a limited number\n  of items in a sorted set only run a single iteration. If we simply used\n  ZRANGE, we may take a long time traversing through jobs that are within the\n  grace period.\n]]\nlocal function getJobsInZset(zsetKey, rangeEnd, limit)\n  if limit > 0 then\n    return rcall("ZRANGEBYSCORE", zsetKey, 0, rangeEnd, "LIMIT", 0, limit)\n  else\n    return rcall("ZRANGEBYSCORE", zsetKey, 0, rangeEnd)\n  end\nend\nlocal function cleanSet(\n    setKey,\n    jobKeyPrefix,\n    rangeEnd,\n    timestamp,\n    limit,\n    attributes,\n    isFinished,\n    jobSchedulersKey)\n    local jobs = getJobsInZset(setKey, rangeEnd, limit)\n    local deleted = {}\n    local deletedCount = 0\n    local jobTS\n    for i, job in ipairs(jobs) do\n        if limit > 0 and deletedCount >= limit then\n            break\n        end\n        local jobKey = jobKeyPrefix .. job\n        -- Extract a Job Scheduler Id from jobId ("repeat:job-scheduler-id:millis") \n        -- and check if it is in the scheduled jobs\n        if not (jobSchedulersKey and isJobSchedulerJob(job, jobKey, jobSchedulersKey)) then\n            if isFinished then\n                removeJob(job, true, jobKeyPrefix, true --[[remove debounce key]] )\n                deletedCount = deletedCount + 1\n                table.insert(deleted, job)\n            else\n                -- * finishedOn says when the job was completed, but it isn\'t set unless the job has actually completed\n                jobTS = getTimestamp(jobKey, attributes)\n                if (not jobTS or jobTS <= timestamp) then\n                    removeJob(job, true, jobKeyPrefix, true --[[remove debounce key]] )\n                    deletedCount = deletedCount + 1\n                    table.insert(deleted, job)\n                end\n            end\n        end\n    end\n    if (#deleted > 0) then\n        for from, to in batches(#deleted, 7000) do\n            rcall("ZREM", setKey, unpack(deleted, from, to))\n        end\n    end\n    return {deleted, deletedCount}\nend\nlocal result\nif ARGV[4] == "active" then\n  result = cleanList(KEYS[1], ARGV[1], rangeStart, rangeEnd, ARGV[2], false --[[ hasFinished ]],\n                      repeatKey)\nelseif ARGV[4] == "delayed" then\n  rangeEnd = "+inf"\n  result = cleanSet(KEYS[1], ARGV[1], rangeEnd, ARGV[2], limit,\n                    {"processedOn", "timestamp"}, false  --[[ hasFinished ]], repeatKey)\nelseif ARGV[4] == "prioritized" then\n  rangeEnd = "+inf"\n  result = cleanSet(KEYS[1], ARGV[1], rangeEnd, ARGV[2], limit,\n                    {"timestamp"}, false  --[[ hasFinished ]], repeatKey)\nelseif ARGV[4] == "wait" or ARGV[4] == "paused" then\n  result = cleanList(KEYS[1], ARGV[1], rangeStart, rangeEnd, ARGV[2], true --[[ hasFinished ]],\n                      repeatKey)\nelse\n  rangeEnd = ARGV[2]\n  -- No need to pass repeat key as in that moment job won\'t be related to a job scheduler\n  result = cleanSet(KEYS[1], ARGV[1], rangeEnd, ARGV[2], limit,\n                    {"finishedOn"}, true  --[[ hasFinished ]])\nend\nrcall("XADD", KEYS[2], "*", "event", "cleaned", "count", result[2])\nreturn result[1]\n',keys:3},fR={name:"drain",content:'--[[\n  Drains the queue, removes all jobs that are waiting\n  or delayed, but not active, completed or failed\n  Input:\n    KEYS[1] \'wait\',\n    KEYS[2] \'paused\'\n    KEYS[3] \'delayed\'\n    KEYS[4] \'prioritized\'\n    KEYS[5] \'jobschedulers\' (repeat)\n    ARGV[1]  queue key prefix\n    ARGV[2]  should clean delayed jobs\n]]\nlocal rcall = redis.call\nlocal queueBaseKey = ARGV[1]\n--[[\n  Functions to remove jobs.\n]]\n-- Includes\n--[[\n  Function to filter out jobs to ignore from a table.\n]]\nlocal function filterOutJobsToIgnore(jobs, jobsToIgnore)\n  local filteredJobs = {}\n  for i = 1, #jobs do\n    if not jobsToIgnore[jobs[i]] then\n      table.insert(filteredJobs, jobs[i])\n    end\n  end\n  return filteredJobs\nend\n--[[\n  Functions to remove jobs.\n]]\n-- Includes\n--[[\n  Function to remove job.\n]]\n-- Includes\n--[[\n  Function to remove deduplication key if needed\n  when a job is being removed.\n]]\nlocal function removeDeduplicationKeyIfNeededOnRemoval(prefixKey,\n  jobKey, jobId)\n  local deduplicationId = rcall("HGET", jobKey, "deid")\n  if deduplicationId then\n    local deduplicationKey = prefixKey .. "de:" .. deduplicationId\n    local currentJobId = rcall(\'GET\', deduplicationKey)\n    if currentJobId and currentJobId == jobId then\n      return rcall("DEL", deduplicationKey)\n    end\n  end\nend\n--[[\n  Function to remove job keys.\n]]\nlocal function removeJobKeys(jobKey)\n  return rcall("DEL", jobKey, jobKey .. \':logs\', jobKey .. \':dependencies\',\n    jobKey .. \':processed\', jobKey .. \':failed\', jobKey .. \':unsuccessful\')\nend\n--[[\n  Check if this job has a parent. If so we will just remove it from\n  the parent child list, but if it is the last child we should move the parent to "wait/paused"\n  which requires code from "moveToFinished"\n]]\n-- Includes\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Functions to destructure job key.\n  Just a bit of warning, these functions may be a bit slow and affect performance significantly.\n]]\nlocal getJobIdFromKey = function (jobKey)\n  return string.match(jobKey, ".*:(.*)")\nend\nlocal getJobKeyPrefix = function (jobKey, jobId)\n  return string.sub(jobKey, 0, #jobKey - #jobId)\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\nlocal function _moveParentToWait(parentPrefix, parentId, emitEvent)\n  local parentTarget, isPausedOrMaxed = getTargetQueueList(parentPrefix .. "meta", parentPrefix .. "active",\n    parentPrefix .. "wait", parentPrefix .. "paused")\n  addJobInTargetList(parentTarget, parentPrefix .. "marker", "RPUSH", isPausedOrMaxed, parentId)\n  if emitEvent then\n    local parentEventStream = parentPrefix .. "events"\n    rcall("XADD", parentEventStream, "*", "event", "waiting", "jobId", parentId, "prev", "waiting-children")\n  end\nend\nlocal function removeParentDependencyKey(jobKey, hard, parentKey, baseKey, debounceId)\n  if parentKey then\n    local parentDependenciesKey = parentKey .. ":dependencies"\n    local result = rcall("SREM", parentDependenciesKey, jobKey)\n    if result > 0 then\n      local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n      if pendingDependencies == 0 then\n        local parentId = getJobIdFromKey(parentKey)\n        local parentPrefix = getJobKeyPrefix(parentKey, parentId)\n        local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n        if numRemovedElements == 1 then\n          if hard then -- remove parent in same queue\n            if parentPrefix == baseKey then\n              removeParentDependencyKey(parentKey, hard, nil, baseKey, nil)\n              removeJobKeys(parentKey)\n              if debounceId then\n                rcall("DEL", parentPrefix .. "de:" .. debounceId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId)\n            end\n          else\n            _moveParentToWait(parentPrefix, parentId, true)\n          end\n        end\n      end\n      return true\n    end\n  else\n    local parentAttributes = rcall("HMGET", jobKey, "parentKey", "deid")\n    local missedParentKey = parentAttributes[1]\n    if( (type(missedParentKey) == "string") and missedParentKey ~= ""\n      and (rcall("EXISTS", missedParentKey) == 1)) then\n      local parentDependenciesKey = missedParentKey .. ":dependencies"\n      local result = rcall("SREM", parentDependenciesKey, jobKey)\n      if result > 0 then\n        local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n        if pendingDependencies == 0 then\n          local parentId = getJobIdFromKey(missedParentKey)\n          local parentPrefix = getJobKeyPrefix(missedParentKey, parentId)\n          local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n          if numRemovedElements == 1 then\n            if hard then\n              if parentPrefix == baseKey then\n                removeParentDependencyKey(missedParentKey, hard, nil, baseKey, nil)\n                removeJobKeys(missedParentKey)\n                if parentAttributes[2] then\n                  rcall("DEL", parentPrefix .. "de:" .. parentAttributes[2])\n                end\n              else\n                _moveParentToWait(parentPrefix, parentId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId, true)\n            end\n          end\n        end\n        return true\n      end\n    end\n  end\n  return false\nend\nlocal function removeJob(jobId, hard, baseKey, shouldRemoveDeduplicationKey)\n  local jobKey = baseKey .. jobId\n  removeParentDependencyKey(jobKey, hard, nil, baseKey)\n  if shouldRemoveDeduplicationKey then\n    removeDeduplicationKeyIfNeededOnRemoval(baseKey, jobKey, jobId)\n  end\n  removeJobKeys(jobKey)\nend\nlocal function removeJobs(keys, hard, baseKey, max)\n  for i, key in ipairs(keys) do\n    removeJob(key, hard, baseKey, true --[[remove debounce key]])\n  end\n  return max - #keys\nend\nlocal function getListItems(keyName, max)\n  return rcall(\'LRANGE\', keyName, 0, max - 1)\nend\nlocal function removeListJobs(keyName, hard, baseKey, max, jobsToIgnore)\n  local jobs = getListItems(keyName, max)\n  if jobsToIgnore then\n    jobs = filterOutJobsToIgnore(jobs, jobsToIgnore)\n  end\n  local count = removeJobs(jobs, hard, baseKey, max)\n  rcall("LTRIM", keyName, #jobs, -1)\n  return count\nend\n-- Includes\n--[[\n  Function to loop in batches.\n  Just a bit of warning, some commands as ZREM\n  could receive a maximum of 7000 parameters per call.\n]]\nlocal function batches(n, batchSize)\n  local i = 0\n  return function()\n    local from = i * batchSize + 1\n    i = i + 1\n    if (from <= n) then\n      local to = math.min(from + batchSize - 1, n)\n      return from, to\n    end\n  end\nend\n--[[\n  Function to get ZSet items.\n]]\nlocal function getZSetItems(keyName, max)\n  return rcall(\'ZRANGE\', keyName, 0, max - 1)\nend\nlocal function removeZSetJobs(keyName, hard, baseKey, max, jobsToIgnore)\n  local jobs = getZSetItems(keyName, max)\n  if jobsToIgnore then\n    jobs = filterOutJobsToIgnore(jobs, jobsToIgnore)\n  end\n  local count = removeJobs(jobs, hard, baseKey, max)\n  if(#jobs > 0) then\n    for from, to in batches(#jobs, 7000) do\n      rcall("ZREM", keyName, unpack(jobs, from, to))\n    end\n  end\n  return count\nend\n-- We must not remove delayed jobs if they are associated to a job scheduler.\nlocal scheduledJobs = {}\nlocal jobSchedulers = rcall("ZRANGE", KEYS[5], 0, -1, "WITHSCORES")\n-- For every job scheduler, get the current delayed job id.\nfor i = 1, #jobSchedulers, 2 do\n    local jobSchedulerId = jobSchedulers[i]\n    local jobSchedulerMillis = jobSchedulers[i + 1]\n    local delayedJobId = "repeat:" .. jobSchedulerId .. ":" .. jobSchedulerMillis\n    scheduledJobs[delayedJobId] = true\nend\nremoveListJobs(KEYS[1], true, queueBaseKey, 0, scheduledJobs) -- wait\nremoveListJobs(KEYS[2], true, queueBaseKey, 0, scheduledJobs) -- paused\nif ARGV[2] == "1" then\n  removeZSetJobs(KEYS[3], true, queueBaseKey, 0, scheduledJobs) -- delayed\nend\nremoveZSetJobs(KEYS[4], true, queueBaseKey, 0, scheduledJobs) -- prioritized\n',keys:5},yR={name:"extendLock",content:'--[[\n  Extend lock and removes the job from the stalled set.\n  Input:\n    KEYS[1] \'lock\',\n    KEYS[2] \'stalled\'\n    ARGV[1]  token\n    ARGV[2]  lock duration in milliseconds\n    ARGV[3]  jobid\n  Output:\n    "1" if lock extented succesfully.\n]]\nlocal rcall = redis.call\nif rcall("GET", KEYS[1]) == ARGV[1] then\n  --   if rcall("SET", KEYS[1], ARGV[1], "PX", ARGV[2], "XX") then\n  if rcall("SET", KEYS[1], ARGV[1], "PX", ARGV[2]) then\n    rcall("SREM", KEYS[2], ARGV[3])\n    return 1\n  end\nend\nreturn 0\n',keys:2},gR={name:"extendLocks",content:'--[[\n  Extend locks for multiple jobs and remove them from the stalled set if successful.\n  Return the list of job IDs for which the operation failed.\n  KEYS[1] = stalledKey\n  ARGV[1] = baseKey\n  ARGV[2] = tokens\n  ARGV[3] = jobIds\n  ARGV[4] = lockDuration (ms)\n  Output:\n    An array of failed job IDs. If empty, all succeeded.\n]]\nlocal rcall = redis.call\nlocal stalledKey = KEYS[1]\nlocal baseKey = ARGV[1]\nlocal tokens = cmsgpack.unpack(ARGV[2])\nlocal jobIds = cmsgpack.unpack(ARGV[3])\nlocal lockDuration = ARGV[4]\nlocal jobCount = #jobIds\nlocal failedJobs = {}\nfor i = 1, jobCount, 1 do\n    local lockKey = baseKey .. jobIds[i] .. \':lock\'\n    local jobId = jobIds[i]\n    local token = tokens[i]\n    local currentToken = rcall("GET", lockKey)\n    if currentToken == token then\n        local setResult = rcall("SET", lockKey, token, "PX", lockDuration)\n        if setResult then\n            rcall("SREM", stalledKey, jobId)\n        else\n            table.insert(failedJobs, jobId)\n        end\n    else\n        table.insert(failedJobs, jobId)\n    end\nend\nreturn failedJobs\n',keys:1},bR={name:"getCounts",content:'--[[\n  Get counts per provided states\n    Input:\n      KEYS[1]    \'prefix\'\n      ARGV[1...] types\n]]\nlocal rcall = redis.call;\nlocal prefix = KEYS[1]\nlocal results = {}\nfor i = 1, #ARGV do\n  local stateKey = prefix .. ARGV[i]\n  if ARGV[i] == "wait" or ARGV[i] == "paused" then\n    -- Markers in waitlist DEPRECATED in v5: Remove in v6.\n    local marker = rcall("LINDEX", stateKey, -1)\n    if marker and string.sub(marker, 1, 2) == "0:" then\n      local count = rcall("LLEN", stateKey)\n      if count > 1 then\n        rcall("RPOP", stateKey)\n        results[#results+1] = count-1\n      else\n        results[#results+1] = 0\n      end\n    else\n      results[#results+1] = rcall("LLEN", stateKey)\n    end\n  elseif ARGV[i] == "active" then\n    results[#results+1] = rcall("LLEN", stateKey)\n  else\n    results[#results+1] = rcall("ZCARD", stateKey)\n  end\nend\nreturn results\n',keys:1},vR={name:"getCountsPerPriority",content:'--[[\n  Get counts per provided states\n    Input:\n      KEYS[1] wait key\n      KEYS[2] paused key\n      KEYS[3] meta key\n      KEYS[4] prioritized key\n      ARGV[1...] priorities\n]]\nlocal rcall = redis.call\nlocal results = {}\nlocal waitKey = KEYS[1]\nlocal pausedKey = KEYS[2]\nlocal prioritizedKey = KEYS[4]\n-- Includes\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function isQueuePaused(queueMetaKey)\n  return rcall("HEXISTS", queueMetaKey, "paused") == 1\nend\nfor i = 1, #ARGV do\n  local priority = tonumber(ARGV[i])\n  if priority == 0 then\n    if isQueuePaused(KEYS[3]) then\n      results[#results+1] = rcall("LLEN", pausedKey)\n    else\n      results[#results+1] = rcall("LLEN", waitKey)\n    end\n  else\n    results[#results+1] = rcall("ZCOUNT", prioritizedKey,\n      priority * 0x100000000, (priority + 1)  * 0x100000000 - 1)\n  end\nend\nreturn results\n',keys:4},wR={name:"getDependencyCounts",content:'--[[\n  Get counts per child states\n    Input:\n      KEYS[1]    processed key\n      KEYS[2]    unprocessed key\n      KEYS[3]    ignored key\n      KEYS[4]    failed key\n      ARGV[1...] types\n]]\nlocal rcall = redis.call;\nlocal processedKey = KEYS[1]\nlocal unprocessedKey = KEYS[2]\nlocal ignoredKey = KEYS[3]\nlocal failedKey = KEYS[4]\nlocal results = {}\nfor i = 1, #ARGV do\n  if ARGV[i] == "processed" then\n    results[#results+1] = rcall("HLEN", processedKey)\n  elseif ARGV[i] == "unprocessed" then\n    results[#results+1] = rcall("SCARD", unprocessedKey)\n  elseif ARGV[i] == "ignored" then\n    results[#results+1] = rcall("HLEN", ignoredKey)\n  else\n    results[#results+1] = rcall("ZCARD", failedKey)\n  end\nend\nreturn results\n',keys:4},SR={name:"getJobScheduler",content:'--[[\n  Get job scheduler record.\n  Input:\n    KEYS[1] \'repeat\' key\n    ARGV[1] id\n]]\nlocal rcall = redis.call\nlocal jobSchedulerKey = KEYS[1] .. ":" .. ARGV[1]\nlocal score = rcall("ZSCORE", KEYS[1], ARGV[1])\nif score then\n  return {rcall("HGETALL", jobSchedulerKey), score} -- get job data\nend\nreturn {nil, nil}\n',keys:1},ER={name:"getRanges",content:'--[[\n  Get job ids per provided states\n    Input:\n      KEYS[1]    \'prefix\'\n      ARGV[1]    start\n      ARGV[2]    end\n      ARGV[3]    asc\n      ARGV[4...] types\n]]\nlocal rcall = redis.call\nlocal prefix = KEYS[1]\nlocal rangeStart = tonumber(ARGV[1])\nlocal rangeEnd = tonumber(ARGV[2])\nlocal asc = ARGV[3]\nlocal results = {}\nlocal function getRangeInList(listKey, asc, rangeStart, rangeEnd, results)\n  if asc == "1" then\n    local modifiedRangeStart\n    local modifiedRangeEnd\n    if rangeStart == -1 then\n      modifiedRangeStart = 0\n    else\n      modifiedRangeStart = -(rangeStart + 1)\n    end\n    if rangeEnd == -1 then\n      modifiedRangeEnd = 0\n    else\n      modifiedRangeEnd = -(rangeEnd + 1)\n    end\n    results[#results+1] = rcall("LRANGE", listKey,\n      modifiedRangeEnd,\n      modifiedRangeStart)\n  else\n    results[#results+1] = rcall("LRANGE", listKey, rangeStart, rangeEnd)\n  end\nend\nfor i = 4, #ARGV do\n  local stateKey = prefix .. ARGV[i]\n  if ARGV[i] == "wait" or ARGV[i] == "paused" then\n    -- Markers in waitlist DEPRECATED in v5: Remove in v6.\n    local marker = rcall("LINDEX", stateKey, -1)\n    if marker and string.sub(marker, 1, 2) == "0:" then\n      local count = rcall("LLEN", stateKey)\n      if count > 1 then\n        rcall("RPOP", stateKey)\n        getRangeInList(stateKey, asc, rangeStart, rangeEnd, results)\n      else\n        results[#results+1] = {}\n      end\n    else\n      getRangeInList(stateKey, asc, rangeStart, rangeEnd, results)\n    end\n  elseif ARGV[i] == "active" then\n    getRangeInList(stateKey, asc, rangeStart, rangeEnd, results)\n  else\n    if asc == "1" then\n      results[#results+1] = rcall("ZRANGE", stateKey, rangeStart, rangeEnd)\n    else\n      results[#results+1] = rcall("ZREVRANGE", stateKey, rangeStart, rangeEnd)\n    end\n  end\nend\nreturn results\n',keys:1},xR={name:"getRateLimitTtl",content:'--[[\n  Get rate limit ttl\n    Input:\n      KEYS[1] \'limiter\'\n      ARGV[1] maxJobs\n]]\nlocal rcall = redis.call\n-- Includes\n--[[\n  Function to get current rate limit ttl.\n]]\nlocal function getRateLimitTTL(maxJobs, rateLimiterKey)\n  if maxJobs and maxJobs <= tonumber(rcall("GET", rateLimiterKey) or 0) then\n    local pttl = rcall("PTTL", rateLimiterKey)\n    if pttl == 0 then\n      rcall("DEL", rateLimiterKey)\n    end\n    if pttl > 0 then\n      return pttl\n    end\n  end\n  return 0\nend\nlocal rateLimiterKey = KEYS[1]\nif ARGV[1] ~= "0" then\n  return getRateLimitTTL(tonumber(ARGV[1]), rateLimiterKey)\nelse\n  return rcall("PTTL", rateLimiterKey)\nend\n',keys:1},_R={name:"getState",content:'--[[\n  Get a job state\n  Input: \n    KEYS[1] \'completed\' key,\n    KEYS[2] \'failed\' key\n    KEYS[3] \'delayed\' key\n    KEYS[4] \'active\' key\n    KEYS[5] \'wait\' key\n    KEYS[6] \'paused\' key\n    KEYS[7] \'waiting-children\' key\n    KEYS[8] \'prioritized\' key\n    ARGV[1] job id\n  Output:\n    \'completed\'\n    \'failed\'\n    \'delayed\'\n    \'active\'\n    \'prioritized\'\n    \'waiting\'\n    \'waiting-children\'\n    \'unknown\'\n]]\nlocal rcall = redis.call\nif rcall("ZSCORE", KEYS[1], ARGV[1]) then\n  return "completed"\nend\nif rcall("ZSCORE", KEYS[2], ARGV[1]) then\n  return "failed"\nend\nif rcall("ZSCORE", KEYS[3], ARGV[1]) then\n  return "delayed"\nend\nif rcall("ZSCORE", KEYS[8], ARGV[1]) then\n  return "prioritized"\nend\n-- Includes\n--[[\n  Functions to check if a item belongs to a list.\n]]\nlocal function checkItemInList(list, item)\n  for _, v in pairs(list) do\n    if v == item then\n      return 1\n    end\n  end\n  return nil\nend\nlocal active_items = rcall("LRANGE", KEYS[4] , 0, -1)\nif checkItemInList(active_items, ARGV[1]) ~= nil then\n  return "active"\nend\nlocal wait_items = rcall("LRANGE", KEYS[5] , 0, -1)\nif checkItemInList(wait_items, ARGV[1]) ~= nil then\n  return "waiting"\nend\nlocal paused_items = rcall("LRANGE", KEYS[6] , 0, -1)\nif checkItemInList(paused_items, ARGV[1]) ~= nil then\n  return "waiting"\nend\nif rcall("ZSCORE", KEYS[7], ARGV[1]) then\n  return "waiting-children"\nend\nreturn "unknown"\n',keys:8},kR={name:"getStateV2",content:'--[[\n  Get a job state\n  Input: \n    KEYS[1] \'completed\' key,\n    KEYS[2] \'failed\' key\n    KEYS[3] \'delayed\' key\n    KEYS[4] \'active\' key\n    KEYS[5] \'wait\' key\n    KEYS[6] \'paused\' key\n    KEYS[7] \'waiting-children\' key\n    KEYS[8] \'prioritized\' key\n    ARGV[1] job id\n  Output:\n    \'completed\'\n    \'failed\'\n    \'delayed\'\n    \'active\'\n    \'waiting\'\n    \'waiting-children\'\n    \'unknown\'\n]]\nlocal rcall = redis.call\nif rcall("ZSCORE", KEYS[1], ARGV[1]) then\n  return "completed"\nend\nif rcall("ZSCORE", KEYS[2], ARGV[1]) then\n  return "failed"\nend\nif rcall("ZSCORE", KEYS[3], ARGV[1]) then\n  return "delayed"\nend\nif rcall("ZSCORE", KEYS[8], ARGV[1]) then\n  return "prioritized"\nend\nif rcall("LPOS", KEYS[4] , ARGV[1]) then\n  return "active"\nend\nif rcall("LPOS", KEYS[5] , ARGV[1]) then\n  return "waiting"\nend\nif rcall("LPOS", KEYS[6] , ARGV[1]) then\n  return "waiting"\nend\nif rcall("ZSCORE", KEYS[7] , ARGV[1]) then\n  return "waiting-children"\nend\nreturn "unknown"\n',keys:8},IR={name:"isFinished",content:'--[[\n  Checks if a job is finished (.i.e. is in the completed or failed set)\n  Input: \n    KEYS[1] completed key\n    KEYS[2] failed key\n    KEYS[3] job key\n    ARGV[1] job id\n    ARGV[2] return value?\n  Output:\n    0 - Not finished.\n    1 - Completed.\n    2 - Failed.\n   -1 - Missing job. \n]]\nlocal rcall = redis.call\nif rcall("EXISTS", KEYS[3]) ~= 1 then\n  if ARGV[2] == "1" then\n    return {-1,"Missing key for job " .. KEYS[3] .. ". isFinished"}\n  end  \n  return -1\nend\nif rcall("ZSCORE", KEYS[1], ARGV[1]) then\n  if ARGV[2] == "1" then\n    local returnValue = rcall("HGET", KEYS[3], "returnvalue")\n    return {1,returnValue}\n  end\n  return 1\nend\nif rcall("ZSCORE", KEYS[2], ARGV[1]) then\n  if ARGV[2] == "1" then\n    local failedReason = rcall("HGET", KEYS[3], "failedReason")\n    return {2,failedReason}\n  end\n  return 2\nend\nif ARGV[2] == "1" then\n  return {0}\nend\nreturn 0\n',keys:3},TR={name:"isJobInList",content:'--[[\n  Checks if job is in a given list.\n  Input:\n    KEYS[1]\n    ARGV[1]\n  Output:\n    1 if element found in the list.\n]]\n-- Includes\n--[[\n  Functions to check if a item belongs to a list.\n]]\nlocal function checkItemInList(list, item)\n  for _, v in pairs(list) do\n    if v == item then\n      return 1\n    end\n  end\n  return nil\nend\nlocal items = redis.call("LRANGE", KEYS[1] , 0, -1)\nreturn checkItemInList(items, ARGV[1])\n',keys:1},AR={name:"isMaxed",content:'--[[\n  Checks if queue is maxed.\n  Input:\n    KEYS[1] meta key\n    KEYS[2] active key\n  Output:\n    1 if element found in the list.\n]]\nlocal rcall = redis.call\n-- Includes\n--[[\n  Function to check if queue is maxed or not.\n]]\nlocal function isQueueMaxed(queueMetaKey, activeKey)\n  local maxConcurrency = rcall("HGET", queueMetaKey, "concurrency")\n  if maxConcurrency then\n    local activeCount = rcall("LLEN", activeKey)\n    if activeCount >= tonumber(maxConcurrency) then\n      return true\n    end\n  end\n  return false\nend\nreturn isQueueMaxed(KEYS[1], KEYS[2])\n',keys:2},OR={name:"moveJobFromActiveToWait",content:'--[[\n  Function to move job from active state to wait.\n  Input:\n    KEYS[1]  active key\n    KEYS[2]  wait key\n    KEYS[3]  stalled key\n    KEYS[4]  paused key\n    KEYS[5]  meta key\n    KEYS[6]  limiter key\n    KEYS[7]  prioritized key\n    KEYS[8]  marker key\n    KEYS[9] event key\n    ARGV[1] job id\n    ARGV[2] lock token\n    ARGV[3] job id key\n]]\nlocal rcall = redis.call\n-- Includes\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to push back job considering priority in front of same prioritized jobs.\n]]\nlocal function pushBackJobWithPriority(prioritizedKey, priority, jobId)\n  -- in order to put it at front of same prioritized jobs\n  -- we consider prioritized counter as 0\n  local score = priority * 0x100000000\n  rcall("ZADD", prioritizedKey, score, jobId)\nend\n--[[\n  Function to get max events value or set by default 10000.\n]]\nlocal function getOrSetMaxEvents(metaKey)\n  local maxEvents = rcall("HGET", metaKey, "opts.maxLenEvents")\n  if not maxEvents then\n    maxEvents = 10000\n    rcall("HSET", metaKey, "opts.maxLenEvents", maxEvents)\n  end\n  return maxEvents\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\nlocal function removeLock(jobKey, stalledKey, token, jobId)\n  if token ~= "0" then\n    local lockKey = jobKey .. \':lock\'\n    local lockToken = rcall("GET", lockKey)\n    if lockToken == token then\n      rcall("DEL", lockKey)\n      rcall("SREM", stalledKey, jobId)\n    else\n      if lockToken then\n        -- Lock exists but token does not match\n        return -6\n      else\n        -- Lock is missing completely\n        return -2\n      end\n    end\n  end\n  return 0\nend\nlocal jobId = ARGV[1]\nlocal token = ARGV[2]\nlocal jobKey = ARGV[3]\nlocal errorCode = removeLock(jobKey, KEYS[3], token, jobId)\nif errorCode < 0 then\n  return errorCode\nend\nlocal metaKey = KEYS[5]\nlocal removed = rcall("LREM", KEYS[1], 1, jobId)\nif removed > 0 then\n  local target, isPausedOrMaxed = getTargetQueueList(metaKey, KEYS[1], KEYS[2], KEYS[4])\n  local priority = tonumber(rcall("HGET", ARGV[3], "priority")) or 0\n  if priority > 0 then\n    pushBackJobWithPriority(KEYS[7], priority, jobId)\n  else\n    addJobInTargetList(target, KEYS[8], "RPUSH", isPausedOrMaxed, jobId)\n  end\n  local maxEvents = getOrSetMaxEvents(metaKey)\n  -- Emit waiting event\n  rcall("XADD", KEYS[9], "MAXLEN", "~", maxEvents, "*", "event", "waiting",\n    "jobId", jobId, "prev", "active")\nend\nlocal pttl = rcall("PTTL", KEYS[6])\nif pttl > 0 then\n  return pttl\nelse\n  return 0\nend',keys:9},KR={name:"moveJobsToWait",content:'--[[\n  Move completed, failed or delayed jobs to wait.\n  Note: Does not support jobs with priorities.\n  Input:\n    KEYS[1] base key\n    KEYS[2] events stream\n    KEYS[3] state key (failed, completed, delayed)\n    KEYS[4] \'wait\'\n    KEYS[5] \'paused\'\n    KEYS[6] \'meta\'\n    KEYS[7] \'active\'\n    KEYS[8] \'marker\'\n    ARGV[1] count\n    ARGV[2] timestamp\n    ARGV[3] prev state\n  Output:\n    1  means the operation is not completed\n    0  means the operation is completed\n]]\nlocal maxCount = tonumber(ARGV[1])\nlocal timestamp = tonumber(ARGV[2])\nlocal rcall = redis.call;\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\n--[[\n  Function to loop in batches.\n  Just a bit of warning, some commands as ZREM\n  could receive a maximum of 7000 parameters per call.\n]]\nlocal function batches(n, batchSize)\n  local i = 0\n  return function()\n    local from = i * batchSize + 1\n    i = i + 1\n    if (from <= n) then\n      local to = math.min(from + batchSize - 1, n)\n      return from, to\n    end\n  end\nend\n--[[\n  Function to get max events value or set by default 10000.\n]]\nlocal function getOrSetMaxEvents(metaKey)\n  local maxEvents = rcall("HGET", metaKey, "opts.maxLenEvents")\n  if not maxEvents then\n    maxEvents = 10000\n    rcall("HSET", metaKey, "opts.maxLenEvents", maxEvents)\n  end\n  return maxEvents\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\nlocal metaKey = KEYS[6]\nlocal target, isPausedOrMaxed = getTargetQueueList(metaKey, KEYS[7], KEYS[4], KEYS[5])\nlocal jobs = rcall(\'ZRANGEBYSCORE\', KEYS[3], 0, timestamp, \'LIMIT\', 0, maxCount)\nif (#jobs > 0) then\n    if ARGV[3] == "failed" then\n        for i, key in ipairs(jobs) do\n            local jobKey = KEYS[1] .. key\n            rcall("HDEL", jobKey, "finishedOn", "processedOn", "failedReason")\n        end\n    elseif ARGV[3] == "completed" then\n        for i, key in ipairs(jobs) do\n            local jobKey = KEYS[1] .. key\n            rcall("HDEL", jobKey, "finishedOn", "processedOn", "returnvalue")\n        end\n    end\n    local maxEvents = getOrSetMaxEvents(metaKey)\n    for i, key in ipairs(jobs) do\n        -- Emit waiting event\n        rcall("XADD", KEYS[2], "MAXLEN", "~", maxEvents, "*", "event",\n              "waiting", "jobId", key, "prev", ARGV[3]);\n    end\n    for from, to in batches(#jobs, 7000) do\n        rcall("ZREM", KEYS[3], unpack(jobs, from, to))\n        rcall("LPUSH", target, unpack(jobs, from, to))\n    end\n    addBaseMarkerIfNeeded(KEYS[8], isPausedOrMaxed)\nend\nmaxCount = maxCount - #jobs\nif (maxCount <= 0) then return 1 end\nreturn 0\n',keys:8},CR={name:"moveStalledJobsToWait",content:'--[[\n  Move stalled jobs to wait.\n    Input:\n      KEYS[1] \'stalled\' (SET)\n      KEYS[2] \'wait\',   (LIST)\n      KEYS[3] \'active\', (LIST)\n      KEYS[4] \'stalled-check\', (KEY)\n      KEYS[5] \'meta\', (KEY)\n      KEYS[6] \'paused\', (LIST)\n      KEYS[7] \'marker\'\n      KEYS[8] \'event stream\' (STREAM)\n      ARGV[1]  Max stalled job count\n      ARGV[2]  queue.toKey(\'\')\n      ARGV[3]  timestamp\n      ARGV[4]  max check time\n    Events:\n      \'stalled\' with stalled job id.\n]]\nlocal rcall = redis.call\n-- Includes\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to loop in batches.\n  Just a bit of warning, some commands as ZREM\n  could receive a maximum of 7000 parameters per call.\n]]\nlocal function batches(n, batchSize)\n  local i = 0\n  return function()\n    local from = i * batchSize + 1\n    i = i + 1\n    if (from <= n) then\n      local to = math.min(from + batchSize - 1, n)\n      return from, to\n    end\n  end\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\n--[[\n  Function to trim events, default 10000.\n]]\n-- Includes\n--[[\n  Function to get max events value or set by default 10000.\n]]\nlocal function getOrSetMaxEvents(metaKey)\n  local maxEvents = rcall("HGET", metaKey, "opts.maxLenEvents")\n  if not maxEvents then\n    maxEvents = 10000\n    rcall("HSET", metaKey, "opts.maxLenEvents", maxEvents)\n  end\n  return maxEvents\nend\nlocal function trimEvents(metaKey, eventStreamKey)\n  local maxEvents = getOrSetMaxEvents(metaKey)\n  if maxEvents then\n    rcall("XTRIM", eventStreamKey, "MAXLEN", "~", maxEvents)\n  else\n    rcall("XTRIM", eventStreamKey, "MAXLEN", "~", 10000)\n  end\nend\nlocal stalledKey = KEYS[1]\nlocal waitKey = KEYS[2]\nlocal activeKey = KEYS[3]\nlocal stalledCheckKey = KEYS[4]\nlocal metaKey = KEYS[5]\nlocal pausedKey = KEYS[6]\nlocal markerKey = KEYS[7]\nlocal eventStreamKey = KEYS[8]\nlocal maxStalledJobCount = tonumber(ARGV[1])\nlocal queueKeyPrefix = ARGV[2]\nlocal timestamp = ARGV[3]\nlocal maxCheckTime = ARGV[4]\nif rcall("EXISTS", stalledCheckKey) == 1 then\n    return {}\nend\nrcall("SET", stalledCheckKey, timestamp, "PX", maxCheckTime)\n-- Trim events before emiting them to avoid trimming events emitted in this script\ntrimEvents(metaKey, eventStreamKey)\n-- Move all stalled jobs to wait\nlocal stalling = rcall(\'SMEMBERS\', stalledKey)\nlocal stalled = {}\nif (#stalling > 0) then\n    rcall(\'DEL\', stalledKey)\n    -- Remove from active list\n    for i, jobId in ipairs(stalling) do\n        -- Markers in waitlist DEPRECATED in v5: Remove in v6.\n        if string.sub(jobId, 1, 2) == "0:" then\n            -- If the jobId is a delay marker ID we just remove it.\n            rcall("LREM", activeKey, 1, jobId)\n        else\n            local jobKey = queueKeyPrefix .. jobId\n            -- Check that the lock is also missing, then we can handle this job as really stalled.\n            if (rcall("EXISTS", jobKey .. ":lock") == 0) then\n                --  Remove from the active queue.\n                local removed = rcall("LREM", activeKey, 1, jobId)\n                if (removed > 0) then\n                    -- If this job has been stalled too many times, such as if it crashes the worker, then fail it.\n                    local stalledCount = rcall("HINCRBY", jobKey, "stc", 1)\n                    if stalledCount > maxStalledJobCount then\n                        local jobAttributes = rcall("HMGET", jobKey, "opts", "parent")\n                        local rawOpts = jobAttributes[1]\n                        local rawParentData = jobAttributes[2]\n                        local opts = cjson.decode(rawOpts)\n                        local failedReason = "job stalled more than allowable limit"\n                        rcall("HSET", jobKey, "defa", failedReason)\n                    end\n                    local target, isPausedOrMaxed = getTargetQueueList(metaKey, activeKey, waitKey, pausedKey)\n                    -- Move the job back to the wait queue, to immediately be picked up by a waiting worker.\n                    addJobInTargetList(target, markerKey, "RPUSH", isPausedOrMaxed, jobId)\n                    rcall("XADD", eventStreamKey, "*", "event", "waiting", "jobId", jobId, \'prev\', \'active\')\n                    -- Emit the stalled event\n                    rcall("XADD", eventStreamKey, "*", "event", "stalled", "jobId", jobId)\n                    table.insert(stalled, jobId)\n                end\n            end\n        end\n    end\nend\n-- Mark potentially stalled jobs\nlocal active = rcall(\'LRANGE\', activeKey, 0, -1)\nif (#active > 0) then\n    for from, to in batches(#active, 7000) do\n        rcall(\'SADD\', stalledKey, unpack(active, from, to))\n    end\nend\nreturn stalled\n',keys:8},RR={name:"moveToActive",content:'--[[\n  Move next job to be processed to active, lock it and fetch its data. The job\n  may be delayed, in that case we need to move it to the delayed set instead.\n  This operation guarantees that the worker owns the job during the lock\n  expiration time. The worker is responsible of keeping the lock fresh\n  so that no other worker picks this job again.\n  Input:\n    KEYS[1] wait key\n    KEYS[2] active key\n    KEYS[3] prioritized key\n    KEYS[4] stream events key\n    KEYS[5] stalled key\n    -- Rate limiting\n    KEYS[6] rate limiter key\n    KEYS[7] delayed key\n    -- Delayed jobs\n    KEYS[8] paused key\n    KEYS[9] meta key\n    KEYS[10] pc priority counter\n    -- Marker\n    KEYS[11] marker key\n    -- Arguments\n    ARGV[1] key prefix\n    ARGV[2] timestamp\n    ARGV[3] opts\n    opts - token - lock token\n    opts - lockDuration\n    opts - limiter\n    opts - name - worker name\n]]\nlocal rcall = redis.call\nlocal waitKey = KEYS[1]\nlocal activeKey = KEYS[2]\nlocal eventStreamKey = KEYS[4]\nlocal rateLimiterKey = KEYS[6]\nlocal delayedKey = KEYS[7]\nlocal opts = cmsgpack.unpack(ARGV[3])\n-- Includes\n--[[\n  Function to return the next delayed job timestamp.\n]]\nlocal function getNextDelayedTimestamp(delayedKey)\n  local result = rcall("ZRANGE", delayedKey, 0, 0, "WITHSCORES")\n  if #result then\n    local nextTimestamp = tonumber(result[2])\n    if nextTimestamp ~= nil then\n      return nextTimestamp / 0x1000\n    end\n  end\nend\n--[[\n  Function to get current rate limit ttl.\n]]\nlocal function getRateLimitTTL(maxJobs, rateLimiterKey)\n  if maxJobs and maxJobs <= tonumber(rcall("GET", rateLimiterKey) or 0) then\n    local pttl = rcall("PTTL", rateLimiterKey)\n    if pttl == 0 then\n      rcall("DEL", rateLimiterKey)\n    end\n    if pttl > 0 then\n      return pttl\n    end\n  end\n  return 0\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\n--[[\n  Function to move job from prioritized state to active.\n]]\nlocal function moveJobFromPrioritizedToActive(priorityKey, activeKey, priorityCounterKey)\n  local prioritizedJob = rcall("ZPOPMIN", priorityKey)\n  if #prioritizedJob > 0 then\n    rcall("LPUSH", activeKey, prioritizedJob[1])\n    return prioritizedJob[1]\n  else\n    rcall("DEL", priorityCounterKey)\n  end\nend\n--[[\n  Function to move job from wait state to active.\n  Input:\n    opts - token - lock token\n    opts - lockDuration\n    opts - limiter\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function prepareJobForProcessing(keyPrefix, rateLimiterKey, eventStreamKey,\n    jobId, processedOn, maxJobs, markerKey, opts)\n  local jobKey = keyPrefix .. jobId\n  -- Check if we need to perform rate limiting.\n  if maxJobs then\n    local jobCounter = tonumber(rcall("INCR", rateLimiterKey))\n    if jobCounter == 1 then\n      local limiterDuration = opts[\'limiter\'] and opts[\'limiter\'][\'duration\']\n      local integerDuration = math.floor(math.abs(limiterDuration))\n      rcall("PEXPIRE", rateLimiterKey, integerDuration)\n    end\n  end\n  local lockKey = jobKey .. \':lock\'\n  -- get a lock\n  if opts[\'token\'] ~= "0" then\n    rcall("SET", lockKey, opts[\'token\'], "PX", opts[\'lockDuration\'])\n  end\n  local optionalValues = {}\n  if opts[\'name\'] then\n    -- Set "processedBy" field to the worker name\n    table.insert(optionalValues, "pb")\n    table.insert(optionalValues, opts[\'name\'])\n  end\n  rcall("XADD", eventStreamKey, "*", "event", "active", "jobId", jobId, "prev", "waiting")\n  rcall("HMSET", jobKey, "processedOn", processedOn, unpack(optionalValues))\n  rcall("HINCRBY", jobKey, "ats", 1)\n  addBaseMarkerIfNeeded(markerKey, false)\n  return {rcall("HGETALL", jobKey), jobId, 0, 0} -- get job data\nend\n--[[\n  Updates the delay set, by moving delayed jobs that should\n  be processed now to "wait".\n     Events:\n      \'waiting\'\n]]\n-- Includes\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to add job considering priority.\n]]\n-- Includes\n--[[\n  Function to get priority score.\n]]\nlocal function getPriorityScore(priority, priorityCounterKey)\n  local prioCounter = rcall("INCR", priorityCounterKey)\n  return priority * 0x100000000 + prioCounter % 0x100000000\nend\nlocal function addJobWithPriority(markerKey, prioritizedKey, priority, jobId, priorityCounterKey,\n  isPausedOrMaxed)\n  local score = getPriorityScore(priority, priorityCounterKey)\n  rcall("ZADD", prioritizedKey, score, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n-- Try to get as much as 1000 jobs at once\nlocal function promoteDelayedJobs(delayedKey, markerKey, targetKey, prioritizedKey,\n                                  eventStreamKey, prefix, timestamp, priorityCounterKey, isPaused)\n    local jobs = rcall("ZRANGEBYSCORE", delayedKey, 0, (timestamp + 1) * 0x1000 - 1, "LIMIT", 0, 1000)\n    if (#jobs > 0) then\n        rcall("ZREM", delayedKey, unpack(jobs))\n        for _, jobId in ipairs(jobs) do\n            local jobKey = prefix .. jobId\n            local priority =\n                tonumber(rcall("HGET", jobKey, "priority")) or 0\n            if priority == 0 then\n                -- LIFO or FIFO\n                rcall("LPUSH", targetKey, jobId)\n            else\n                local score = getPriorityScore(priority, priorityCounterKey)\n                rcall("ZADD", prioritizedKey, score, jobId)\n            end\n            -- Emit waiting event\n            rcall("XADD", eventStreamKey, "*", "event", "waiting", "jobId",\n                  jobId, "prev", "delayed")\n            rcall("HSET", jobKey, "delay", 0)\n        end\n        addBaseMarkerIfNeeded(markerKey, isPaused)\n    end\nend\nlocal target, isPausedOrMaxed = getTargetQueueList(KEYS[9], activeKey, waitKey, KEYS[8])\n-- Check if there are delayed jobs that we can move to wait.\nlocal markerKey = KEYS[11]\npromoteDelayedJobs(delayedKey, markerKey, target, KEYS[3], eventStreamKey, ARGV[1],\n                   ARGV[2], KEYS[10], isPausedOrMaxed)\nlocal maxJobs = tonumber(opts[\'limiter\'] and opts[\'limiter\'][\'max\'])\nlocal expireTime = getRateLimitTTL(maxJobs, rateLimiterKey)\n-- Check if we are rate limited first.\nif expireTime > 0 then return {0, 0, expireTime, 0} end\n-- paused or maxed queue\nif isPausedOrMaxed then return {0, 0, 0, 0} end\n-- no job ID, try non-blocking move from wait to active\nlocal jobId = rcall("RPOPLPUSH", waitKey, activeKey)\n-- Markers in waitlist DEPRECATED in v5: Will be completely removed in v6.\nif jobId and string.sub(jobId, 1, 2) == "0:" then\n    rcall("LREM", activeKey, 1, jobId)\n    jobId = rcall("RPOPLPUSH", waitKey, activeKey)\nend\nif jobId then\n    return prepareJobForProcessing(ARGV[1], rateLimiterKey, eventStreamKey, jobId, ARGV[2],\n                                   maxJobs, markerKey, opts)\nelse\n    jobId = moveJobFromPrioritizedToActive(KEYS[3], activeKey, KEYS[10])\n    if jobId then\n        return prepareJobForProcessing(ARGV[1], rateLimiterKey, eventStreamKey, jobId, ARGV[2],\n                                       maxJobs, markerKey, opts)\n    end\nend\n-- Return the timestamp for the next delayed job if any.\nlocal nextTimestamp = getNextDelayedTimestamp(delayedKey)\nif nextTimestamp ~= nil then return {0, 0, 0, nextTimestamp} end\nreturn {0, 0, 0, 0}\n',keys:11},jR={name:"moveToDelayed",content:'--[[\n  Moves job from active to delayed set.\n  Input:\n    KEYS[1] marker key\n    KEYS[2] active key\n    KEYS[3] prioritized key\n    KEYS[4] delayed key\n    KEYS[5] job key\n    KEYS[6] events stream\n    KEYS[7] meta key\n    KEYS[8] stalled key\n    ARGV[1] key prefix\n    ARGV[2] timestamp\n    ARGV[3] the id of the job\n    ARGV[4] queue token\n    ARGV[5] delay value\n    ARGV[6] skip attempt\n    ARGV[7] optional job fields to update\n  Output:\n    0 - OK\n   -1 - Missing job.\n   -3 - Job not in active set.\n  Events:\n    - delayed key.\n]]\nlocal rcall = redis.call\n-- Includes\n--[[\n  Add delay marker if needed.\n]]\n-- Includes\n--[[\n  Function to return the next delayed job timestamp.\n]]\nlocal function getNextDelayedTimestamp(delayedKey)\n  local result = rcall("ZRANGE", delayedKey, 0, 0, "WITHSCORES")\n  if #result then\n    local nextTimestamp = tonumber(result[2])\n    if nextTimestamp ~= nil then\n      return nextTimestamp / 0x1000\n    end\n  end\nend\nlocal function addDelayMarkerIfNeeded(markerKey, delayedKey)\n  local nextTimestamp = getNextDelayedTimestamp(delayedKey)\n  if nextTimestamp ~= nil then\n    -- Replace the score of the marker with the newest known\n    -- next timestamp.\n    rcall("ZADD", markerKey, nextTimestamp, "1")\n  end\nend\n--[[\n  Bake in the job id first 12 bits into the timestamp\n  to guarantee correct execution order of delayed jobs\n  (up to 4096 jobs per given timestamp or 4096 jobs apart per timestamp)\n  WARNING: Jobs that are so far apart that they wrap around will cause FIFO to fail\n]]\nlocal function getDelayedScore(delayedKey, timestamp, delay)\n  local delayedTimestamp = (delay > 0 and (tonumber(timestamp) + delay)) or tonumber(timestamp)\n  local minScore = delayedTimestamp * 0x1000\n  local maxScore = (delayedTimestamp + 1 ) * 0x1000 - 1\n  local result = rcall("ZREVRANGEBYSCORE", delayedKey, maxScore,\n    minScore, "WITHSCORES","LIMIT", 0, 1)\n  if #result then\n    local currentMaxScore = tonumber(result[2])\n    if currentMaxScore ~= nil then\n      if currentMaxScore >= maxScore then\n        return maxScore, delayedTimestamp\n      else\n        return currentMaxScore + 1, delayedTimestamp\n      end\n    end\n  end\n  return minScore, delayedTimestamp\nend\n--[[\n  Function to get max events value or set by default 10000.\n]]\nlocal function getOrSetMaxEvents(metaKey)\n  local maxEvents = rcall("HGET", metaKey, "opts.maxLenEvents")\n  if not maxEvents then\n    maxEvents = 10000\n    rcall("HSET", metaKey, "opts.maxLenEvents", maxEvents)\n  end\n  return maxEvents\nend\nlocal function removeLock(jobKey, stalledKey, token, jobId)\n  if token ~= "0" then\n    local lockKey = jobKey .. \':lock\'\n    local lockToken = rcall("GET", lockKey)\n    if lockToken == token then\n      rcall("DEL", lockKey)\n      rcall("SREM", stalledKey, jobId)\n    else\n      if lockToken then\n        -- Lock exists but token does not match\n        return -6\n      else\n        -- Lock is missing completely\n        return -2\n      end\n    end\n  end\n  return 0\nend\n--[[\n  Function to update a bunch of fields in a job.\n]]\nlocal function updateJobFields(jobKey, msgpackedFields)\n  if msgpackedFields and #msgpackedFields > 0 then\n    local fieldsToUpdate = cmsgpack.unpack(msgpackedFields)\n    if fieldsToUpdate then\n      rcall("HMSET", jobKey, unpack(fieldsToUpdate))\n    end\n  end\nend\nlocal jobKey = KEYS[5]\nlocal metaKey = KEYS[7]\nlocal token = ARGV[4] \nif rcall("EXISTS", jobKey) == 1 then\n    local errorCode = removeLock(jobKey, KEYS[8], token, ARGV[3])\n    if errorCode < 0 then\n        return errorCode\n    end\n    updateJobFields(jobKey, ARGV[7])\n    local delayedKey = KEYS[4]\n    local jobId = ARGV[3]\n    local delay = tonumber(ARGV[5])\n    local score, delayedTimestamp = getDelayedScore(delayedKey, ARGV[2], delay)\n    local numRemovedElements = rcall("LREM", KEYS[2], -1, jobId)\n    if numRemovedElements < 1 then return -3 end\n    if ARGV[6] == "0" then\n        rcall("HINCRBY", jobKey, "atm", 1)\n    end\n    rcall("HSET", jobKey, "delay", ARGV[5])\n    local maxEvents = getOrSetMaxEvents(metaKey)\n    rcall("ZADD", delayedKey, score, jobId)\n    rcall("XADD", KEYS[6], "MAXLEN", "~", maxEvents, "*", "event", "delayed",\n          "jobId", jobId, "delay", delayedTimestamp)\n    -- Check if we need to push a marker job to wake up sleeping workers.\n    local markerKey = KEYS[1]\n    addDelayMarkerIfNeeded(markerKey, delayedKey)\n    return 0\nelse\n    return -1\nend\n',keys:8},PR={name:"moveToFinished",content:'--[[\n  Move job from active to a finished status (completed o failed)\n  A job can only be moved to completed if it was active.\n  The job must be locked before it can be moved to a finished status,\n  and the lock must be released in this script.\n    Input:\n      KEYS[1] wait key\n      KEYS[2] active key\n      KEYS[3] prioritized key\n      KEYS[4] event stream key\n      KEYS[5] stalled key\n      -- Rate limiting\n      KEYS[6] rate limiter key\n      KEYS[7] delayed key\n      KEYS[8] paused key\n      KEYS[9] meta key\n      KEYS[10] pc priority counter\n      KEYS[11] completed/failed key\n      KEYS[12] jobId key\n      KEYS[13] metrics key\n      KEYS[14] marker key\n      ARGV[1]  jobId\n      ARGV[2]  timestamp\n      ARGV[3]  msg property returnvalue / failedReason\n      ARGV[4]  return value / failed reason\n      ARGV[5]  target (completed/failed)\n      ARGV[6]  fetch next?\n      ARGV[7]  keys prefix\n      ARGV[8]  opts\n      ARGV[9]  job fields to update\n      opts - token - lock token\n      opts - keepJobs\n      opts - lockDuration - lock duration in milliseconds\n      opts - attempts max attempts\n      opts - maxMetricsSize\n      opts - fpof - fail parent on fail\n      opts - cpof - continue parent on fail\n      opts - idof - ignore dependency on fail\n      opts - rdof - remove dependency on fail\n      opts - name - worker name\n    Output:\n      0 OK\n      -1 Missing key.\n      -2 Missing lock.\n      -3 Job not in active set\n      -4 Job has pending children\n      -6 Lock is not owned by this client\n      -9 Job has failed children\n    Events:\n      \'completed/failed\'\n]]\nlocal rcall = redis.call\n--- Includes\n--[[\n  Functions to collect metrics based on a current and previous count of jobs.\n  Granualarity is fixed at 1 minute.\n]]\n--[[\n  Function to loop in batches.\n  Just a bit of warning, some commands as ZREM\n  could receive a maximum of 7000 parameters per call.\n]]\nlocal function batches(n, batchSize)\n  local i = 0\n  return function()\n    local from = i * batchSize + 1\n    i = i + 1\n    if (from <= n) then\n      local to = math.min(from + batchSize - 1, n)\n      return from, to\n    end\n  end\nend\nlocal function collectMetrics(metaKey, dataPointsList, maxDataPoints,\n                                 timestamp)\n    -- Increment current count\n    local count = rcall("HINCRBY", metaKey, "count", 1) - 1\n    -- Compute how many data points we need to add to the list, N.\n    local prevTS = rcall("HGET", metaKey, "prevTS")\n    if not prevTS then\n        -- If prevTS is nil, set it to the current timestamp\n        rcall("HSET", metaKey, "prevTS", timestamp, "prevCount", 0)\n        return\n    end\n    local N = math.min(math.floor(timestamp / 60000) - math.floor(prevTS / 60000), tonumber(maxDataPoints))\n    if N > 0 then\n        local delta = count - rcall("HGET", metaKey, "prevCount")\n        -- If N > 1, add N-1 zeros to the list\n        if N > 1 then\n            local points = {}\n            points[1] = delta\n            for i = 2, N do\n                points[i] = 0\n            end\n            for from, to in batches(#points, 7000) do\n                rcall("LPUSH", dataPointsList, unpack(points, from, to))\n            end\n        else\n            -- LPUSH delta to the list\n            rcall("LPUSH", dataPointsList, delta)\n        end\n        -- LTRIM to keep list to its max size\n        rcall("LTRIM", dataPointsList, 0, maxDataPoints - 1)\n        -- update prev count with current count\n        rcall("HSET", metaKey, "prevCount", count, "prevTS", timestamp)\n    end\nend\n--[[\n  Function to return the next delayed job timestamp.\n]]\nlocal function getNextDelayedTimestamp(delayedKey)\n  local result = rcall("ZRANGE", delayedKey, 0, 0, "WITHSCORES")\n  if #result then\n    local nextTimestamp = tonumber(result[2])\n    if nextTimestamp ~= nil then\n      return nextTimestamp / 0x1000\n    end\n  end\nend\n--[[\n  Function to get current rate limit ttl.\n]]\nlocal function getRateLimitTTL(maxJobs, rateLimiterKey)\n  if maxJobs and maxJobs <= tonumber(rcall("GET", rateLimiterKey) or 0) then\n    local pttl = rcall("PTTL", rateLimiterKey)\n    if pttl == 0 then\n      rcall("DEL", rateLimiterKey)\n    end\n    if pttl > 0 then\n      return pttl\n    end\n  end\n  return 0\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\n--[[\n  Function to move job from prioritized state to active.\n]]\nlocal function moveJobFromPrioritizedToActive(priorityKey, activeKey, priorityCounterKey)\n  local prioritizedJob = rcall("ZPOPMIN", priorityKey)\n  if #prioritizedJob > 0 then\n    rcall("LPUSH", activeKey, prioritizedJob[1])\n    return prioritizedJob[1]\n  else\n    rcall("DEL", priorityCounterKey)\n  end\nend\n--[[\n  Function to recursively move from waitingChildren to failed.\n]]\n-- Includes\n--[[\n  Validate and move parent to a wait status (waiting, delayed or prioritized)\n  if no pending dependencies.\n]]\n-- Includes\n--[[\n  Validate and move parent to a wait status (waiting, delayed or prioritized) if needed.\n]]\n-- Includes\n--[[\n  Move parent to a wait status (wait, prioritized or delayed)\n]]\n-- Includes\n--[[\n  Add delay marker if needed.\n]]\n-- Includes\nlocal function addDelayMarkerIfNeeded(markerKey, delayedKey)\n  local nextTimestamp = getNextDelayedTimestamp(delayedKey)\n  if nextTimestamp ~= nil then\n    -- Replace the score of the marker with the newest known\n    -- next timestamp.\n    rcall("ZADD", markerKey, nextTimestamp, "1")\n  end\nend\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to add job considering priority.\n]]\n-- Includes\n--[[\n  Function to get priority score.\n]]\nlocal function getPriorityScore(priority, priorityCounterKey)\n  local prioCounter = rcall("INCR", priorityCounterKey)\n  return priority * 0x100000000 + prioCounter % 0x100000000\nend\nlocal function addJobWithPriority(markerKey, prioritizedKey, priority, jobId, priorityCounterKey,\n  isPausedOrMaxed)\n  local score = getPriorityScore(priority, priorityCounterKey)\n  rcall("ZADD", prioritizedKey, score, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to check if queue is paused or maxed\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function isQueuePausedOrMaxed(queueMetaKey, activeKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      return activeCount >= tonumber(queueAttributes[2])\n    end\n  end\n  return false\nend\nlocal function moveParentToWait(parentQueueKey, parentKey, parentId, timestamp)\n    local parentWaitKey = parentQueueKey .. ":wait"\n    local parentPausedKey = parentQueueKey .. ":paused"\n    local parentActiveKey = parentQueueKey .. ":active"\n    local parentMetaKey = parentQueueKey .. ":meta"\n    local parentMarkerKey = parentQueueKey .. ":marker"\n    local jobAttributes = rcall("HMGET", parentKey, "priority", "delay")\n    local priority = tonumber(jobAttributes[1]) or 0\n    local delay = tonumber(jobAttributes[2]) or 0\n    if delay > 0 then\n        local delayedTimestamp = tonumber(timestamp) + delay\n        local score = delayedTimestamp * 0x1000\n        local parentDelayedKey = parentQueueKey .. ":delayed"\n        rcall("ZADD", parentDelayedKey, score, parentId)\n        rcall("XADD", parentQueueKey .. ":events", "*", "event", "delayed", "jobId", parentId, "delay",\n            delayedTimestamp)\n        addDelayMarkerIfNeeded(parentMarkerKey, parentDelayedKey)\n    else\n        if priority == 0 then\n            local parentTarget, isParentPausedOrMaxed = getTargetQueueList(parentMetaKey, parentActiveKey,\n                parentWaitKey, parentPausedKey)\n            addJobInTargetList(parentTarget, parentMarkerKey, "RPUSH", isParentPausedOrMaxed, parentId)\n        else\n            local isPausedOrMaxed = isQueuePausedOrMaxed(parentMetaKey, parentActiveKey)\n            addJobWithPriority(parentMarkerKey, parentQueueKey .. ":prioritized", priority, parentId,\n                parentQueueKey .. ":pc", isPausedOrMaxed)\n        end\n        rcall("XADD", parentQueueKey .. ":events", "*", "event", "waiting", "jobId", parentId, "prev",\n            "waiting-children")\n    end\nend\nlocal function moveParentToWaitIfNeeded(parentQueueKey, parentKey, parentId, timestamp)\n  if rcall("EXISTS", parentKey) == 1 then\n    local parentWaitingChildrenKey = parentQueueKey .. ":waiting-children"\n    if rcall("ZSCORE", parentWaitingChildrenKey, parentId) then    \n      rcall("ZREM", parentWaitingChildrenKey, parentId)\n      moveParentToWait(parentQueueKey, parentKey, parentId, timestamp)\n    end\n  end\nend\nlocal function moveParentToWaitIfNoPendingDependencies(parentQueueKey, parentDependenciesKey, parentKey,\n  parentId, timestamp)\n  local doNotHavePendingDependencies = rcall("SCARD", parentDependenciesKey) == 0\n  if doNotHavePendingDependencies then\n    moveParentToWaitIfNeeded(parentQueueKey, parentKey, parentId, timestamp)\n  end\nend\n--[[\n  Functions to remove jobs when removeOnFail option is provided.\n]]\n-- Includes\n--[[\n  Function to remove job.\n]]\n-- Includes\n--[[\n  Function to remove deduplication key if needed\n  when a job is being removed.\n]]\nlocal function removeDeduplicationKeyIfNeededOnRemoval(prefixKey,\n  jobKey, jobId)\n  local deduplicationId = rcall("HGET", jobKey, "deid")\n  if deduplicationId then\n    local deduplicationKey = prefixKey .. "de:" .. deduplicationId\n    local currentJobId = rcall(\'GET\', deduplicationKey)\n    if currentJobId and currentJobId == jobId then\n      return rcall("DEL", deduplicationKey)\n    end\n  end\nend\n--[[\n  Function to remove job keys.\n]]\nlocal function removeJobKeys(jobKey)\n  return rcall("DEL", jobKey, jobKey .. \':logs\', jobKey .. \':dependencies\',\n    jobKey .. \':processed\', jobKey .. \':failed\', jobKey .. \':unsuccessful\')\nend\n--[[\n  Check if this job has a parent. If so we will just remove it from\n  the parent child list, but if it is the last child we should move the parent to "wait/paused"\n  which requires code from "moveToFinished"\n]]\n-- Includes\n--[[\n  Functions to destructure job key.\n  Just a bit of warning, these functions may be a bit slow and affect performance significantly.\n]]\nlocal getJobIdFromKey = function (jobKey)\n  return string.match(jobKey, ".*:(.*)")\nend\nlocal getJobKeyPrefix = function (jobKey, jobId)\n  return string.sub(jobKey, 0, #jobKey - #jobId)\nend\nlocal function _moveParentToWait(parentPrefix, parentId, emitEvent)\n  local parentTarget, isPausedOrMaxed = getTargetQueueList(parentPrefix .. "meta", parentPrefix .. "active",\n    parentPrefix .. "wait", parentPrefix .. "paused")\n  addJobInTargetList(parentTarget, parentPrefix .. "marker", "RPUSH", isPausedOrMaxed, parentId)\n  if emitEvent then\n    local parentEventStream = parentPrefix .. "events"\n    rcall("XADD", parentEventStream, "*", "event", "waiting", "jobId", parentId, "prev", "waiting-children")\n  end\nend\nlocal function removeParentDependencyKey(jobKey, hard, parentKey, baseKey, debounceId)\n  if parentKey then\n    local parentDependenciesKey = parentKey .. ":dependencies"\n    local result = rcall("SREM", parentDependenciesKey, jobKey)\n    if result > 0 then\n      local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n      if pendingDependencies == 0 then\n        local parentId = getJobIdFromKey(parentKey)\n        local parentPrefix = getJobKeyPrefix(parentKey, parentId)\n        local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n        if numRemovedElements == 1 then\n          if hard then -- remove parent in same queue\n            if parentPrefix == baseKey then\n              removeParentDependencyKey(parentKey, hard, nil, baseKey, nil)\n              removeJobKeys(parentKey)\n              if debounceId then\n                rcall("DEL", parentPrefix .. "de:" .. debounceId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId)\n            end\n          else\n            _moveParentToWait(parentPrefix, parentId, true)\n          end\n        end\n      end\n      return true\n    end\n  else\n    local parentAttributes = rcall("HMGET", jobKey, "parentKey", "deid")\n    local missedParentKey = parentAttributes[1]\n    if( (type(missedParentKey) == "string") and missedParentKey ~= ""\n      and (rcall("EXISTS", missedParentKey) == 1)) then\n      local parentDependenciesKey = missedParentKey .. ":dependencies"\n      local result = rcall("SREM", parentDependenciesKey, jobKey)\n      if result > 0 then\n        local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n        if pendingDependencies == 0 then\n          local parentId = getJobIdFromKey(missedParentKey)\n          local parentPrefix = getJobKeyPrefix(missedParentKey, parentId)\n          local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n          if numRemovedElements == 1 then\n            if hard then\n              if parentPrefix == baseKey then\n                removeParentDependencyKey(missedParentKey, hard, nil, baseKey, nil)\n                removeJobKeys(missedParentKey)\n                if parentAttributes[2] then\n                  rcall("DEL", parentPrefix .. "de:" .. parentAttributes[2])\n                end\n              else\n                _moveParentToWait(parentPrefix, parentId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId, true)\n            end\n          end\n        end\n        return true\n      end\n    end\n  end\n  return false\nend\nlocal function removeJob(jobId, hard, baseKey, shouldRemoveDeduplicationKey)\n  local jobKey = baseKey .. jobId\n  removeParentDependencyKey(jobKey, hard, nil, baseKey)\n  if shouldRemoveDeduplicationKey then\n    removeDeduplicationKeyIfNeededOnRemoval(baseKey, jobKey, jobId)\n  end\n  removeJobKeys(jobKey)\nend\n--[[\n  Functions to remove jobs by max age.\n]]\n-- Includes\nlocal function removeJobsByMaxAge(timestamp, maxAge, targetSet, prefix,\n  shouldRemoveDebounceKey)\n  local start = timestamp - maxAge * 1000\n  local jobIds = rcall("ZREVRANGEBYSCORE", targetSet, start, "-inf")\n  for i, jobId in ipairs(jobIds) do\n    removeJob(jobId, false, prefix, false --[[remove debounce key]])\n  end\n  rcall("ZREMRANGEBYSCORE", targetSet, "-inf", start)\nend\n--[[\n  Functions to remove jobs by max count.\n]]\n-- Includes\nlocal function removeJobsByMaxCount(maxCount, targetSet, prefix)\n  local start = maxCount\n  local jobIds = rcall("ZREVRANGE", targetSet, start, -1)\n  for i, jobId in ipairs(jobIds) do\n    removeJob(jobId, false, prefix, false --[[remove debounce key]])\n  end\n  rcall("ZREMRANGEBYRANK", targetSet, 0, -(maxCount + 1))\nend\nlocal function removeJobsOnFail(queueKeyPrefix, failedKey, jobId, opts, timestamp)\n  local removeOnFailType = type(opts["removeOnFail"])\n  if removeOnFailType == "number" then\n    removeJobsByMaxCount(opts["removeOnFail"],\n                        failedKey, queueKeyPrefix)\n  elseif removeOnFailType == "boolean" then\n    if opts["removeOnFail"] then\n      removeJob(jobId, false, queueKeyPrefix,\n                false --[[remove debounce key]])\n      rcall("ZREM", failedKey, jobId)\n    end\n  elseif removeOnFailType ~= "nil" then\n    local maxAge = opts["removeOnFail"]["age"]\n    local maxCount = opts["removeOnFail"]["count"]\n    if maxAge ~= nil then\n      removeJobsByMaxAge(timestamp, maxAge,\n                        failedKey, queueKeyPrefix)\n    end\n    if maxCount ~= nil and maxCount > 0 then\n      removeJobsByMaxCount(maxCount, failedKey,\n                            queueKeyPrefix)\n    end\n  end \nend\nlocal moveParentToFailedIfNeeded = function (parentQueueKey, parentKey, parentId, jobIdKey, timestamp)\n  if rcall("EXISTS", parentKey) == 1 then\n    local parentWaitingChildrenKey = parentQueueKey .. ":waiting-children"\n    local parentDelayedKey = parentQueueKey .. ":delayed"\n    local parentPrioritizedKey = parentQueueKey .. ":prioritized"\n    local parentWaitingChildrenOrDelayedKey\n    local prevState\n    if rcall("ZSCORE", parentWaitingChildrenKey, parentId) then\n      parentWaitingChildrenOrDelayedKey = parentWaitingChildrenKey\n      prevState = "waiting-children"\n    elseif rcall("ZSCORE", parentDelayedKey, parentId) then\n      parentWaitingChildrenOrDelayedKey = parentDelayedKey\n      prevState = "delayed"\n      rcall("HSET", parentKey, "delay", 0)\n    end\n    if parentWaitingChildrenOrDelayedKey then\n      rcall("ZREM", parentWaitingChildrenOrDelayedKey, parentId)\n      local parentQueuePrefix = parentQueueKey .. ":"\n      local parentFailedKey = parentQueueKey .. ":failed"\n      local deferredFailure = "child " .. jobIdKey .. " failed"\n      rcall("HSET", parentKey, "defa", deferredFailure)\n      moveParentToWait(parentQueueKey, parentKey, parentId, timestamp)\n    else\n      if not rcall("ZSCORE", parentQueueKey .. ":failed", parentId) then\n        local deferredFailure = "child " .. jobIdKey .. " failed"\n        rcall("HSET", parentKey, "defa", deferredFailure)\n      end\n    end\n  end\nend\nlocal moveChildFromDependenciesIfNeeded = function (rawParentData, childKey, failedReason, timestamp)\n  if rawParentData then\n    local parentData = cjson.decode(rawParentData)\n    local parentKey = parentData[\'queueKey\'] .. \':\' .. parentData[\'id\']\n    local parentDependenciesChildrenKey = parentKey .. ":dependencies"\n    if parentData[\'fpof\'] then\n      if rcall("SREM", parentDependenciesChildrenKey, childKey) == 1 then\n        local parentUnsuccesssfulChildrenKey = parentKey .. ":unsuccessful"\n        rcall("ZADD", parentUnsuccesssfulChildrenKey, timestamp, childKey)\n        moveParentToFailedIfNeeded(\n          parentData[\'queueKey\'],\n          parentKey,\n          parentData[\'id\'],\n          childKey,\n          timestamp\n        )\n      end\n    elseif parentData[\'cpof\'] then\n      if rcall("SREM", parentDependenciesChildrenKey, childKey) == 1 then\n        local parentFailedChildrenKey = parentKey .. ":failed"\n        rcall("HSET", parentFailedChildrenKey, childKey, failedReason)\n        moveParentToWaitIfNeeded(parentData[\'queueKey\'], parentKey, parentData[\'id\'], timestamp)\n      end\n    elseif parentData[\'idof\'] or parentData[\'rdof\'] then\n      if rcall("SREM", parentDependenciesChildrenKey, childKey) == 1 then\n        moveParentToWaitIfNoPendingDependencies(parentData[\'queueKey\'], parentDependenciesChildrenKey,\n          parentKey, parentData[\'id\'], timestamp)\n        if parentData[\'idof\'] then\n          local parentFailedChildrenKey = parentKey .. ":failed"\n          rcall("HSET", parentFailedChildrenKey, childKey, failedReason)\n        end\n      end\n    end\n  end\nend\n--[[\n  Function to move job from wait state to active.\n  Input:\n    opts - token - lock token\n    opts - lockDuration\n    opts - limiter\n]]\n-- Includes\nlocal function prepareJobForProcessing(keyPrefix, rateLimiterKey, eventStreamKey,\n    jobId, processedOn, maxJobs, markerKey, opts)\n  local jobKey = keyPrefix .. jobId\n  -- Check if we need to perform rate limiting.\n  if maxJobs then\n    local jobCounter = tonumber(rcall("INCR", rateLimiterKey))\n    if jobCounter == 1 then\n      local limiterDuration = opts[\'limiter\'] and opts[\'limiter\'][\'duration\']\n      local integerDuration = math.floor(math.abs(limiterDuration))\n      rcall("PEXPIRE", rateLimiterKey, integerDuration)\n    end\n  end\n  local lockKey = jobKey .. \':lock\'\n  -- get a lock\n  if opts[\'token\'] ~= "0" then\n    rcall("SET", lockKey, opts[\'token\'], "PX", opts[\'lockDuration\'])\n  end\n  local optionalValues = {}\n  if opts[\'name\'] then\n    -- Set "processedBy" field to the worker name\n    table.insert(optionalValues, "pb")\n    table.insert(optionalValues, opts[\'name\'])\n  end\n  rcall("XADD", eventStreamKey, "*", "event", "active", "jobId", jobId, "prev", "waiting")\n  rcall("HMSET", jobKey, "processedOn", processedOn, unpack(optionalValues))\n  rcall("HINCRBY", jobKey, "ats", 1)\n  addBaseMarkerIfNeeded(markerKey, false)\n  return {rcall("HGETALL", jobKey), jobId, 0, 0} -- get job data\nend\n--[[\n  Updates the delay set, by moving delayed jobs that should\n  be processed now to "wait".\n     Events:\n      \'waiting\'\n]]\n-- Includes\n-- Try to get as much as 1000 jobs at once\nlocal function promoteDelayedJobs(delayedKey, markerKey, targetKey, prioritizedKey,\n                                  eventStreamKey, prefix, timestamp, priorityCounterKey, isPaused)\n    local jobs = rcall("ZRANGEBYSCORE", delayedKey, 0, (timestamp + 1) * 0x1000 - 1, "LIMIT", 0, 1000)\n    if (#jobs > 0) then\n        rcall("ZREM", delayedKey, unpack(jobs))\n        for _, jobId in ipairs(jobs) do\n            local jobKey = prefix .. jobId\n            local priority =\n                tonumber(rcall("HGET", jobKey, "priority")) or 0\n            if priority == 0 then\n                -- LIFO or FIFO\n                rcall("LPUSH", targetKey, jobId)\n            else\n                local score = getPriorityScore(priority, priorityCounterKey)\n                rcall("ZADD", prioritizedKey, score, jobId)\n            end\n            -- Emit waiting event\n            rcall("XADD", eventStreamKey, "*", "event", "waiting", "jobId",\n                  jobId, "prev", "delayed")\n            rcall("HSET", jobKey, "delay", 0)\n        end\n        addBaseMarkerIfNeeded(markerKey, isPaused)\n    end\nend\n--[[\n  Function to remove deduplication key if needed\n  when a job is moved to completed or failed states.\n]]\nlocal function removeDeduplicationKeyIfNeededOnFinalization(prefixKey,\n  deduplicationId, jobId)\n  if deduplicationId then\n    local deduplicationKey = prefixKey .. "de:" .. deduplicationId\n    local pttl = rcall("PTTL", deduplicationKey)\n    if pttl == 0 then\n      return rcall("DEL", deduplicationKey)\n    end\n    if pttl == -1 then\n      local currentJobId = rcall(\'GET\', deduplicationKey)\n      if currentJobId and currentJobId == jobId then\n        return rcall("DEL", deduplicationKey)\n      end\n    end\n  end\nend\nlocal function removeLock(jobKey, stalledKey, token, jobId)\n  if token ~= "0" then\n    local lockKey = jobKey .. \':lock\'\n    local lockToken = rcall("GET", lockKey)\n    if lockToken == token then\n      rcall("DEL", lockKey)\n      rcall("SREM", stalledKey, jobId)\n    else\n      if lockToken then\n        -- Lock exists but token does not match\n        return -6\n      else\n        -- Lock is missing completely\n        return -2\n      end\n    end\n  end\n  return 0\nend\n--[[\n  Function to trim events, default 10000.\n]]\n-- Includes\n--[[\n  Function to get max events value or set by default 10000.\n]]\nlocal function getOrSetMaxEvents(metaKey)\n  local maxEvents = rcall("HGET", metaKey, "opts.maxLenEvents")\n  if not maxEvents then\n    maxEvents = 10000\n    rcall("HSET", metaKey, "opts.maxLenEvents", maxEvents)\n  end\n  return maxEvents\nend\nlocal function trimEvents(metaKey, eventStreamKey)\n  local maxEvents = getOrSetMaxEvents(metaKey)\n  if maxEvents then\n    rcall("XTRIM", eventStreamKey, "MAXLEN", "~", maxEvents)\n  else\n    rcall("XTRIM", eventStreamKey, "MAXLEN", "~", 10000)\n  end\nend\n--[[\n  Validate and move or add dependencies to parent.\n]]\n-- Includes\nlocal function updateParentDepsIfNeeded(parentKey, parentQueueKey, parentDependenciesKey,\n  parentId, jobIdKey, returnvalue, timestamp )\n  local processedSet = parentKey .. ":processed"\n  rcall("HSET", processedSet, jobIdKey, returnvalue)\n  moveParentToWaitIfNoPendingDependencies(parentQueueKey, parentDependenciesKey, parentKey, parentId, timestamp)\nend\n--[[\n  Function to update a bunch of fields in a job.\n]]\nlocal function updateJobFields(jobKey, msgpackedFields)\n  if msgpackedFields and #msgpackedFields > 0 then\n    local fieldsToUpdate = cmsgpack.unpack(msgpackedFields)\n    if fieldsToUpdate then\n      rcall("HMSET", jobKey, unpack(fieldsToUpdate))\n    end\n  end\nend\nlocal jobIdKey = KEYS[12]\nif rcall("EXISTS", jobIdKey) == 1 then -- Make sure job exists\n    -- Make sure it does not have pending dependencies\n    -- It must happen before removing lock\n    if ARGV[5] == "completed" then\n        if rcall("SCARD", jobIdKey .. ":dependencies") ~= 0 then\n            return -4\n        end\n        if rcall("ZCARD", jobIdKey .. ":unsuccessful") ~= 0 then\n            return -9\n        end\n    end\n    local opts = cmsgpack.unpack(ARGV[8])\n    local token = opts[\'token\']\n    local errorCode = removeLock(jobIdKey, KEYS[5], token, ARGV[1])\n    if errorCode < 0 then\n        return errorCode\n    end\n    updateJobFields(jobIdKey, ARGV[9]);\n    local attempts = opts[\'attempts\']\n    local maxMetricsSize = opts[\'maxMetricsSize\']\n    local maxCount = opts[\'keepJobs\'][\'count\']\n    local maxAge = opts[\'keepJobs\'][\'age\']\n    local jobAttributes = rcall("HMGET", jobIdKey, "parentKey", "parent", "deid")\n    local parentKey = jobAttributes[1] or ""\n    local parentId = ""\n    local parentQueueKey = ""\n    if jobAttributes[2] then -- TODO: need to revisit this logic if it\'s still needed\n        local jsonDecodedParent = cjson.decode(jobAttributes[2])\n        parentId = jsonDecodedParent[\'id\']\n        parentQueueKey = jsonDecodedParent[\'queueKey\']\n    end\n    local jobId = ARGV[1]\n    local timestamp = ARGV[2]\n    -- Remove from active list (if not active we shall return error)\n    local numRemovedElements = rcall("LREM", KEYS[2], -1, jobId)\n    if (numRemovedElements < 1) then\n        return -3\n    end\n    local eventStreamKey = KEYS[4]\n    local metaKey = KEYS[9]\n    -- Trim events before emiting them to avoid trimming events emitted in this script\n    trimEvents(metaKey, eventStreamKey)\n    local prefix = ARGV[7]\n    removeDeduplicationKeyIfNeededOnFinalization(prefix, jobAttributes[3], jobId)\n    -- If job has a parent we need to\n    -- 1) remove this job id from parents dependencies\n    -- 2) move the job Id to parent "processed" set\n    -- 3) push the results into parent "results" list\n    -- 4) if parent\'s dependencies is empty, then move parent to "wait/paused". Note it may be a different queue!.\n    if parentId == "" and parentKey ~= "" then\n        parentId = getJobIdFromKey(parentKey)\n        parentQueueKey = getJobKeyPrefix(parentKey, ":" .. parentId)\n    end\n    if parentId ~= "" then\n        if ARGV[5] == "completed" then\n            local dependenciesSet = parentKey .. ":dependencies"\n            if rcall("SREM", dependenciesSet, jobIdKey) == 1 then\n                updateParentDepsIfNeeded(parentKey, parentQueueKey, dependenciesSet, parentId, jobIdKey, ARGV[4],\n                    timestamp)\n            end\n        else\n            moveChildFromDependenciesIfNeeded(jobAttributes[2], jobIdKey, ARGV[4], timestamp)\n        end\n    end\n    local attemptsMade = rcall("HINCRBY", jobIdKey, "atm", 1)\n    -- Remove job?\n    if maxCount ~= 0 then\n        local targetSet = KEYS[11]\n        -- Add to complete/failed set\n        rcall("ZADD", targetSet, timestamp, jobId)\n        rcall("HSET", jobIdKey, ARGV[3], ARGV[4], "finishedOn", timestamp)\n        -- "returnvalue" / "failedReason" and "finishedOn"\n        if ARGV[5] == "failed" then\n            rcall("HDEL", jobIdKey, "defa")\n        end\n        -- Remove old jobs?\n        if maxAge ~= nil then\n            removeJobsByMaxAge(timestamp, maxAge, targetSet, prefix)\n        end\n        if maxCount ~= nil and maxCount > 0 then\n            removeJobsByMaxCount(maxCount, targetSet, prefix)\n        end\n    else\n        removeJobKeys(jobIdKey)\n        if parentKey ~= "" then\n            -- TODO: when a child is removed when finished, result or failure in parent\n            -- must not be deleted, those value references should be deleted when the parent\n            -- is deleted\n            removeParentDependencyKey(jobIdKey, false, parentKey, jobAttributes[3])\n        end\n    end\n    rcall("XADD", eventStreamKey, "*", "event", ARGV[5], "jobId", jobId, ARGV[3], ARGV[4], "prev", "active")\n    if ARGV[5] == "failed" then\n        if tonumber(attemptsMade) >= tonumber(attempts) then\n            rcall("XADD", eventStreamKey, "*", "event", "retries-exhausted", "jobId", jobId, "attemptsMade",\n                attemptsMade)\n        end\n    end\n    -- Collect metrics\n    if maxMetricsSize ~= "" then\n        collectMetrics(KEYS[13], KEYS[13] .. \':data\', maxMetricsSize, timestamp)\n    end\n    -- Try to get next job to avoid an extra roundtrip if the queue is not closing,\n    -- and not rate limited.\n    if (ARGV[6] == "1") then\n        local target, isPausedOrMaxed = getTargetQueueList(metaKey, KEYS[2], KEYS[1], KEYS[8])\n        local markerKey = KEYS[14]\n        -- Check if there are delayed jobs that can be promoted\n        promoteDelayedJobs(KEYS[7], markerKey, target, KEYS[3], eventStreamKey, prefix, timestamp, KEYS[10],\n            isPausedOrMaxed)\n        local maxJobs = tonumber(opts[\'limiter\'] and opts[\'limiter\'][\'max\'])\n        -- Check if we are rate limited first.\n        local expireTime = getRateLimitTTL(maxJobs, KEYS[6])\n        if expireTime > 0 then\n            return {0, 0, expireTime, 0}\n        end\n        -- paused or maxed queue\n        if isPausedOrMaxed then\n            return {0, 0, 0, 0}\n        end\n        jobId = rcall("RPOPLPUSH", KEYS[1], KEYS[2])\n        if jobId then\n            -- Markers in waitlist DEPRECATED in v5: Remove in v6.\n            if string.sub(jobId, 1, 2) == "0:" then\n                rcall("LREM", KEYS[2], 1, jobId)\n                -- If jobId is special ID 0:delay (delay greater than 0), then there is no job to process\n                -- but if ID is 0:0, then there is at least 1 prioritized job to process\n                if jobId == "0:0" then\n                    jobId = moveJobFromPrioritizedToActive(KEYS[3], KEYS[2], KEYS[10])\n                    return prepareJobForProcessing(prefix, KEYS[6], eventStreamKey, jobId, timestamp, maxJobs,\n                        markerKey, opts)\n                end\n            else\n                return prepareJobForProcessing(prefix, KEYS[6], eventStreamKey, jobId, timestamp, maxJobs, markerKey,\n                    opts)\n            end\n        else\n            jobId = moveJobFromPrioritizedToActive(KEYS[3], KEYS[2], KEYS[10])\n            if jobId then\n                return prepareJobForProcessing(prefix, KEYS[6], eventStreamKey, jobId, timestamp, maxJobs, markerKey,\n                    opts)\n            end\n        end\n        -- Return the timestamp for the next delayed job if any.\n        local nextTimestamp = getNextDelayedTimestamp(KEYS[7])\n        if nextTimestamp ~= nil then\n            -- The result is guaranteed to be positive, since the\n            -- ZRANGEBYSCORE command would have return a job otherwise.\n            return {0, 0, 0, nextTimestamp}\n        end\n    end\n    local waitLen = rcall("LLEN", KEYS[1])\n    if waitLen == 0 then\n        local activeLen = rcall("LLEN", KEYS[2])\n        if activeLen == 0 then\n            local prioritizedLen = rcall("ZCARD", KEYS[3])\n            if prioritizedLen == 0 then\n                rcall("XADD", eventStreamKey, "*", "event", "drained")\n            end\n        end\n    end\n    return 0\nelse\n    return -1\nend\n',keys:14},DR={name:"moveToWaitingChildren",content:'--[[\n  Moves job from active to waiting children set.\n  Input:\n    KEYS[1] active key\n    KEYS[2] wait-children key\n    KEYS[3] job key\n    KEYS[4] job dependencies key\n    KEYS[5] job unsuccessful key\n    KEYS[6] stalled key\n    KEYS[7] failed key\n    KEYS[8] events key\n    ARGV[1] token\n    ARGV[2] child key\n    ARGV[3] timestamp\n    ARGV[4] jobId\n    ARGV[5] prefix\n  Output:\n    0 - OK\n    1 - There are not pending dependencies.\n   -1 - Missing job.\n   -2 - Missing lock\n   -3 - Job not in active set\n]]\nlocal rcall = redis.call\nlocal activeKey = KEYS[1]\nlocal waitingChildrenKey = KEYS[2]\nlocal jobKey = KEYS[3]\nlocal jobDependenciesKey = KEYS[4]\nlocal jobUnsuccessfulKey = KEYS[5]\nlocal stalledKey = KEYS[6]\nlocal failedKey = KEYS[7]\nlocal timestamp = ARGV[3]\nlocal jobId = ARGV[4]\n--- Includes\n--[[\n  Function to recursively move from waitingChildren to failed.\n]]\n-- Includes\n--[[\n  Validate and move parent to a wait status (waiting, delayed or prioritized)\n  if no pending dependencies.\n]]\n-- Includes\n--[[\n  Validate and move parent to a wait status (waiting, delayed or prioritized) if needed.\n]]\n-- Includes\n--[[\n  Move parent to a wait status (wait, prioritized or delayed)\n]]\n-- Includes\n--[[\n  Add delay marker if needed.\n]]\n-- Includes\n--[[\n  Function to return the next delayed job timestamp.\n]]\nlocal function getNextDelayedTimestamp(delayedKey)\n  local result = rcall("ZRANGE", delayedKey, 0, 0, "WITHSCORES")\n  if #result then\n    local nextTimestamp = tonumber(result[2])\n    if nextTimestamp ~= nil then\n      return nextTimestamp / 0x1000\n    end\n  end\nend\nlocal function addDelayMarkerIfNeeded(markerKey, delayedKey)\n  local nextTimestamp = getNextDelayedTimestamp(delayedKey)\n  if nextTimestamp ~= nil then\n    -- Replace the score of the marker with the newest known\n    -- next timestamp.\n    rcall("ZADD", markerKey, nextTimestamp, "1")\n  end\nend\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to add job considering priority.\n]]\n-- Includes\n--[[\n  Function to get priority score.\n]]\nlocal function getPriorityScore(priority, priorityCounterKey)\n  local prioCounter = rcall("INCR", priorityCounterKey)\n  return priority * 0x100000000 + prioCounter % 0x100000000\nend\nlocal function addJobWithPriority(markerKey, prioritizedKey, priority, jobId, priorityCounterKey,\n  isPausedOrMaxed)\n  local score = getPriorityScore(priority, priorityCounterKey)\n  rcall("ZADD", prioritizedKey, score, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to check if queue is paused or maxed\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function isQueuePausedOrMaxed(queueMetaKey, activeKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      return activeCount >= tonumber(queueAttributes[2])\n    end\n  end\n  return false\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\nlocal function moveParentToWait(parentQueueKey, parentKey, parentId, timestamp)\n    local parentWaitKey = parentQueueKey .. ":wait"\n    local parentPausedKey = parentQueueKey .. ":paused"\n    local parentActiveKey = parentQueueKey .. ":active"\n    local parentMetaKey = parentQueueKey .. ":meta"\n    local parentMarkerKey = parentQueueKey .. ":marker"\n    local jobAttributes = rcall("HMGET", parentKey, "priority", "delay")\n    local priority = tonumber(jobAttributes[1]) or 0\n    local delay = tonumber(jobAttributes[2]) or 0\n    if delay > 0 then\n        local delayedTimestamp = tonumber(timestamp) + delay\n        local score = delayedTimestamp * 0x1000\n        local parentDelayedKey = parentQueueKey .. ":delayed"\n        rcall("ZADD", parentDelayedKey, score, parentId)\n        rcall("XADD", parentQueueKey .. ":events", "*", "event", "delayed", "jobId", parentId, "delay",\n            delayedTimestamp)\n        addDelayMarkerIfNeeded(parentMarkerKey, parentDelayedKey)\n    else\n        if priority == 0 then\n            local parentTarget, isParentPausedOrMaxed = getTargetQueueList(parentMetaKey, parentActiveKey,\n                parentWaitKey, parentPausedKey)\n            addJobInTargetList(parentTarget, parentMarkerKey, "RPUSH", isParentPausedOrMaxed, parentId)\n        else\n            local isPausedOrMaxed = isQueuePausedOrMaxed(parentMetaKey, parentActiveKey)\n            addJobWithPriority(parentMarkerKey, parentQueueKey .. ":prioritized", priority, parentId,\n                parentQueueKey .. ":pc", isPausedOrMaxed)\n        end\n        rcall("XADD", parentQueueKey .. ":events", "*", "event", "waiting", "jobId", parentId, "prev",\n            "waiting-children")\n    end\nend\nlocal function moveParentToWaitIfNeeded(parentQueueKey, parentKey, parentId, timestamp)\n  if rcall("EXISTS", parentKey) == 1 then\n    local parentWaitingChildrenKey = parentQueueKey .. ":waiting-children"\n    if rcall("ZSCORE", parentWaitingChildrenKey, parentId) then    \n      rcall("ZREM", parentWaitingChildrenKey, parentId)\n      moveParentToWait(parentQueueKey, parentKey, parentId, timestamp)\n    end\n  end\nend\nlocal function moveParentToWaitIfNoPendingDependencies(parentQueueKey, parentDependenciesKey, parentKey,\n  parentId, timestamp)\n  local doNotHavePendingDependencies = rcall("SCARD", parentDependenciesKey) == 0\n  if doNotHavePendingDependencies then\n    moveParentToWaitIfNeeded(parentQueueKey, parentKey, parentId, timestamp)\n  end\nend\n--[[\n  Functions to remove jobs when removeOnFail option is provided.\n]]\n-- Includes\n--[[\n  Function to remove job.\n]]\n-- Includes\n--[[\n  Function to remove deduplication key if needed\n  when a job is being removed.\n]]\nlocal function removeDeduplicationKeyIfNeededOnRemoval(prefixKey,\n  jobKey, jobId)\n  local deduplicationId = rcall("HGET", jobKey, "deid")\n  if deduplicationId then\n    local deduplicationKey = prefixKey .. "de:" .. deduplicationId\n    local currentJobId = rcall(\'GET\', deduplicationKey)\n    if currentJobId and currentJobId == jobId then\n      return rcall("DEL", deduplicationKey)\n    end\n  end\nend\n--[[\n  Function to remove job keys.\n]]\nlocal function removeJobKeys(jobKey)\n  return rcall("DEL", jobKey, jobKey .. \':logs\', jobKey .. \':dependencies\',\n    jobKey .. \':processed\', jobKey .. \':failed\', jobKey .. \':unsuccessful\')\nend\n--[[\n  Check if this job has a parent. If so we will just remove it from\n  the parent child list, but if it is the last child we should move the parent to "wait/paused"\n  which requires code from "moveToFinished"\n]]\n-- Includes\n--[[\n  Functions to destructure job key.\n  Just a bit of warning, these functions may be a bit slow and affect performance significantly.\n]]\nlocal getJobIdFromKey = function (jobKey)\n  return string.match(jobKey, ".*:(.*)")\nend\nlocal getJobKeyPrefix = function (jobKey, jobId)\n  return string.sub(jobKey, 0, #jobKey - #jobId)\nend\nlocal function _moveParentToWait(parentPrefix, parentId, emitEvent)\n  local parentTarget, isPausedOrMaxed = getTargetQueueList(parentPrefix .. "meta", parentPrefix .. "active",\n    parentPrefix .. "wait", parentPrefix .. "paused")\n  addJobInTargetList(parentTarget, parentPrefix .. "marker", "RPUSH", isPausedOrMaxed, parentId)\n  if emitEvent then\n    local parentEventStream = parentPrefix .. "events"\n    rcall("XADD", parentEventStream, "*", "event", "waiting", "jobId", parentId, "prev", "waiting-children")\n  end\nend\nlocal function removeParentDependencyKey(jobKey, hard, parentKey, baseKey, debounceId)\n  if parentKey then\n    local parentDependenciesKey = parentKey .. ":dependencies"\n    local result = rcall("SREM", parentDependenciesKey, jobKey)\n    if result > 0 then\n      local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n      if pendingDependencies == 0 then\n        local parentId = getJobIdFromKey(parentKey)\n        local parentPrefix = getJobKeyPrefix(parentKey, parentId)\n        local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n        if numRemovedElements == 1 then\n          if hard then -- remove parent in same queue\n            if parentPrefix == baseKey then\n              removeParentDependencyKey(parentKey, hard, nil, baseKey, nil)\n              removeJobKeys(parentKey)\n              if debounceId then\n                rcall("DEL", parentPrefix .. "de:" .. debounceId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId)\n            end\n          else\n            _moveParentToWait(parentPrefix, parentId, true)\n          end\n        end\n      end\n      return true\n    end\n  else\n    local parentAttributes = rcall("HMGET", jobKey, "parentKey", "deid")\n    local missedParentKey = parentAttributes[1]\n    if( (type(missedParentKey) == "string") and missedParentKey ~= ""\n      and (rcall("EXISTS", missedParentKey) == 1)) then\n      local parentDependenciesKey = missedParentKey .. ":dependencies"\n      local result = rcall("SREM", parentDependenciesKey, jobKey)\n      if result > 0 then\n        local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n        if pendingDependencies == 0 then\n          local parentId = getJobIdFromKey(missedParentKey)\n          local parentPrefix = getJobKeyPrefix(missedParentKey, parentId)\n          local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n          if numRemovedElements == 1 then\n            if hard then\n              if parentPrefix == baseKey then\n                removeParentDependencyKey(missedParentKey, hard, nil, baseKey, nil)\n                removeJobKeys(missedParentKey)\n                if parentAttributes[2] then\n                  rcall("DEL", parentPrefix .. "de:" .. parentAttributes[2])\n                end\n              else\n                _moveParentToWait(parentPrefix, parentId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId, true)\n            end\n          end\n        end\n        return true\n      end\n    end\n  end\n  return false\nend\nlocal function removeJob(jobId, hard, baseKey, shouldRemoveDeduplicationKey)\n  local jobKey = baseKey .. jobId\n  removeParentDependencyKey(jobKey, hard, nil, baseKey)\n  if shouldRemoveDeduplicationKey then\n    removeDeduplicationKeyIfNeededOnRemoval(baseKey, jobKey, jobId)\n  end\n  removeJobKeys(jobKey)\nend\n--[[\n  Functions to remove jobs by max age.\n]]\n-- Includes\nlocal function removeJobsByMaxAge(timestamp, maxAge, targetSet, prefix,\n  shouldRemoveDebounceKey)\n  local start = timestamp - maxAge * 1000\n  local jobIds = rcall("ZREVRANGEBYSCORE", targetSet, start, "-inf")\n  for i, jobId in ipairs(jobIds) do\n    removeJob(jobId, false, prefix, false --[[remove debounce key]])\n  end\n  rcall("ZREMRANGEBYSCORE", targetSet, "-inf", start)\nend\n--[[\n  Functions to remove jobs by max count.\n]]\n-- Includes\nlocal function removeJobsByMaxCount(maxCount, targetSet, prefix)\n  local start = maxCount\n  local jobIds = rcall("ZREVRANGE", targetSet, start, -1)\n  for i, jobId in ipairs(jobIds) do\n    removeJob(jobId, false, prefix, false --[[remove debounce key]])\n  end\n  rcall("ZREMRANGEBYRANK", targetSet, 0, -(maxCount + 1))\nend\nlocal function removeJobsOnFail(queueKeyPrefix, failedKey, jobId, opts, timestamp)\n  local removeOnFailType = type(opts["removeOnFail"])\n  if removeOnFailType == "number" then\n    removeJobsByMaxCount(opts["removeOnFail"],\n                        failedKey, queueKeyPrefix)\n  elseif removeOnFailType == "boolean" then\n    if opts["removeOnFail"] then\n      removeJob(jobId, false, queueKeyPrefix,\n                false --[[remove debounce key]])\n      rcall("ZREM", failedKey, jobId)\n    end\n  elseif removeOnFailType ~= "nil" then\n    local maxAge = opts["removeOnFail"]["age"]\n    local maxCount = opts["removeOnFail"]["count"]\n    if maxAge ~= nil then\n      removeJobsByMaxAge(timestamp, maxAge,\n                        failedKey, queueKeyPrefix)\n    end\n    if maxCount ~= nil and maxCount > 0 then\n      removeJobsByMaxCount(maxCount, failedKey,\n                            queueKeyPrefix)\n    end\n  end \nend\nlocal moveParentToFailedIfNeeded = function (parentQueueKey, parentKey, parentId, jobIdKey, timestamp)\n  if rcall("EXISTS", parentKey) == 1 then\n    local parentWaitingChildrenKey = parentQueueKey .. ":waiting-children"\n    local parentDelayedKey = parentQueueKey .. ":delayed"\n    local parentPrioritizedKey = parentQueueKey .. ":prioritized"\n    local parentWaitingChildrenOrDelayedKey\n    local prevState\n    if rcall("ZSCORE", parentWaitingChildrenKey, parentId) then\n      parentWaitingChildrenOrDelayedKey = parentWaitingChildrenKey\n      prevState = "waiting-children"\n    elseif rcall("ZSCORE", parentDelayedKey, parentId) then\n      parentWaitingChildrenOrDelayedKey = parentDelayedKey\n      prevState = "delayed"\n      rcall("HSET", parentKey, "delay", 0)\n    end\n    if parentWaitingChildrenOrDelayedKey then\n      rcall("ZREM", parentWaitingChildrenOrDelayedKey, parentId)\n      local parentQueuePrefix = parentQueueKey .. ":"\n      local parentFailedKey = parentQueueKey .. ":failed"\n      local deferredFailure = "child " .. jobIdKey .. " failed"\n      rcall("HSET", parentKey, "defa", deferredFailure)\n      moveParentToWait(parentQueueKey, parentKey, parentId, timestamp)\n    else\n      if not rcall("ZSCORE", parentQueueKey .. ":failed", parentId) then\n        local deferredFailure = "child " .. jobIdKey .. " failed"\n        rcall("HSET", parentKey, "defa", deferredFailure)\n      end\n    end\n  end\nend\nlocal moveChildFromDependenciesIfNeeded = function (rawParentData, childKey, failedReason, timestamp)\n  if rawParentData then\n    local parentData = cjson.decode(rawParentData)\n    local parentKey = parentData[\'queueKey\'] .. \':\' .. parentData[\'id\']\n    local parentDependenciesChildrenKey = parentKey .. ":dependencies"\n    if parentData[\'fpof\'] then\n      if rcall("SREM", parentDependenciesChildrenKey, childKey) == 1 then\n        local parentUnsuccesssfulChildrenKey = parentKey .. ":unsuccessful"\n        rcall("ZADD", parentUnsuccesssfulChildrenKey, timestamp, childKey)\n        moveParentToFailedIfNeeded(\n          parentData[\'queueKey\'],\n          parentKey,\n          parentData[\'id\'],\n          childKey,\n          timestamp\n        )\n      end\n    elseif parentData[\'cpof\'] then\n      if rcall("SREM", parentDependenciesChildrenKey, childKey) == 1 then\n        local parentFailedChildrenKey = parentKey .. ":failed"\n        rcall("HSET", parentFailedChildrenKey, childKey, failedReason)\n        moveParentToWaitIfNeeded(parentData[\'queueKey\'], parentKey, parentData[\'id\'], timestamp)\n      end\n    elseif parentData[\'idof\'] or parentData[\'rdof\'] then\n      if rcall("SREM", parentDependenciesChildrenKey, childKey) == 1 then\n        moveParentToWaitIfNoPendingDependencies(parentData[\'queueKey\'], parentDependenciesChildrenKey,\n          parentKey, parentData[\'id\'], timestamp)\n        if parentData[\'idof\'] then\n          local parentFailedChildrenKey = parentKey .. ":failed"\n          rcall("HSET", parentFailedChildrenKey, childKey, failedReason)\n        end\n      end\n    end\n  end\nend\n--[[\n  Function to remove deduplication key if needed\n  when a job is moved to completed or failed states.\n]]\nlocal function removeDeduplicationKeyIfNeededOnFinalization(prefixKey,\n  deduplicationId, jobId)\n  if deduplicationId then\n    local deduplicationKey = prefixKey .. "de:" .. deduplicationId\n    local pttl = rcall("PTTL", deduplicationKey)\n    if pttl == 0 then\n      return rcall("DEL", deduplicationKey)\n    end\n    if pttl == -1 then\n      local currentJobId = rcall(\'GET\', deduplicationKey)\n      if currentJobId and currentJobId == jobId then\n        return rcall("DEL", deduplicationKey)\n      end\n    end\n  end\nend\nlocal function removeLock(jobKey, stalledKey, token, jobId)\n  if token ~= "0" then\n    local lockKey = jobKey .. \':lock\'\n    local lockToken = rcall("GET", lockKey)\n    if lockToken == token then\n      rcall("DEL", lockKey)\n      rcall("SREM", stalledKey, jobId)\n    else\n      if lockToken then\n        -- Lock exists but token does not match\n        return -6\n      else\n        -- Lock is missing completely\n        return -2\n      end\n    end\n  end\n  return 0\nend\nlocal function moveToWaitingChildren(activeKey, waitingChildrenKey, jobId,\n    timestamp)\n  local score = tonumber(timestamp)\n  local numRemovedElements = rcall("LREM", activeKey, -1, jobId)\n  if(numRemovedElements < 1) then\n    return -3\n  end\n  rcall("ZADD", waitingChildrenKey, score, jobId)\n  return 0\nend\nif rcall("EXISTS", jobKey) == 1 then\n  if rcall("ZCARD", jobUnsuccessfulKey) ~= 0 then\n    -- TODO: refactor this logic in an include later\n    local jobAttributes = rcall("HMGET", jobKey, "parent", "deid", "opts")\n    removeDeduplicationKeyIfNeededOnFinalization(ARGV[5], jobAttributes[2], jobId)\n    local failedReason = "children are failed"\n    rcall("ZADD", failedKey, timestamp, jobId)\n    rcall("HSET", jobKey, "finishedOn", timestamp)\n    rcall("XADD", KEYS[8], "*", "event", "failed", "jobId", jobId, "failedReason",\n      failedReason, "prev", "active")\n    local rawParentData = jobAttributes[1]\n    local rawOpts = jobAttributes[3]\n    local opts = cjson.decode(rawOpts)\n    moveChildFromDependenciesIfNeeded(rawParentData, jobKey, failedReason, timestamp)\n    removeJobsOnFail(ARGV[5], failedKey, jobId, opts, timestamp)\n    return 0\n  else\n    if ARGV[2] ~= "" then\n      if rcall("SISMEMBER", jobDependenciesKey, ARGV[2]) ~= 0 then\n        local errorCode = removeLock(jobKey, stalledKey, ARGV[1], jobId)\n        if errorCode < 0 then\n          return errorCode\n        end\n        return moveToWaitingChildren(activeKey, waitingChildrenKey, jobId, timestamp)\n      end\n      return 1\n    else\n      if rcall("SCARD", jobDependenciesKey) ~= 0 then \n        local errorCode = removeLock(jobKey, stalledKey, ARGV[1], jobId)\n        if errorCode < 0 then\n          return errorCode\n        end\n        return moveToWaitingChildren(activeKey, waitingChildrenKey, jobId, timestamp)\n      end\n      return 1\n    end    \n  end\nend\nreturn -1\n',keys:8},NR={name:"obliterate",content:'--[[\n  Completely obliterates a queue and all of its contents\n  This command completely destroys a queue including all of its jobs, current or past \n  leaving no trace of its existence. Since this script needs to iterate to find all the job\n  keys, consider that this call may be slow for very large queues.\n  The queue needs to be "paused" or it will return an error\n  If the queue has currently active jobs then the script by default will return error,\n  however this behaviour can be overrided using the \'force\' option.\n  Input:\n    KEYS[1] meta\n    KEYS[2] base\n    ARGV[1] count\n    ARGV[2] force\n]]\nlocal maxCount = tonumber(ARGV[1])\nlocal baseKey = KEYS[2]\nlocal rcall = redis.call\n-- Includes\n--[[\n  Functions to remove jobs.\n]]\n-- Includes\n--[[\n  Function to remove job.\n]]\n-- Includes\n--[[\n  Function to remove deduplication key if needed\n  when a job is being removed.\n]]\nlocal function removeDeduplicationKeyIfNeededOnRemoval(prefixKey,\n  jobKey, jobId)\n  local deduplicationId = rcall("HGET", jobKey, "deid")\n  if deduplicationId then\n    local deduplicationKey = prefixKey .. "de:" .. deduplicationId\n    local currentJobId = rcall(\'GET\', deduplicationKey)\n    if currentJobId and currentJobId == jobId then\n      return rcall("DEL", deduplicationKey)\n    end\n  end\nend\n--[[\n  Function to remove job keys.\n]]\nlocal function removeJobKeys(jobKey)\n  return rcall("DEL", jobKey, jobKey .. \':logs\', jobKey .. \':dependencies\',\n    jobKey .. \':processed\', jobKey .. \':failed\', jobKey .. \':unsuccessful\')\nend\n--[[\n  Check if this job has a parent. If so we will just remove it from\n  the parent child list, but if it is the last child we should move the parent to "wait/paused"\n  which requires code from "moveToFinished"\n]]\n-- Includes\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Functions to destructure job key.\n  Just a bit of warning, these functions may be a bit slow and affect performance significantly.\n]]\nlocal getJobIdFromKey = function (jobKey)\n  return string.match(jobKey, ".*:(.*)")\nend\nlocal getJobKeyPrefix = function (jobKey, jobId)\n  return string.sub(jobKey, 0, #jobKey - #jobId)\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\nlocal function _moveParentToWait(parentPrefix, parentId, emitEvent)\n  local parentTarget, isPausedOrMaxed = getTargetQueueList(parentPrefix .. "meta", parentPrefix .. "active",\n    parentPrefix .. "wait", parentPrefix .. "paused")\n  addJobInTargetList(parentTarget, parentPrefix .. "marker", "RPUSH", isPausedOrMaxed, parentId)\n  if emitEvent then\n    local parentEventStream = parentPrefix .. "events"\n    rcall("XADD", parentEventStream, "*", "event", "waiting", "jobId", parentId, "prev", "waiting-children")\n  end\nend\nlocal function removeParentDependencyKey(jobKey, hard, parentKey, baseKey, debounceId)\n  if parentKey then\n    local parentDependenciesKey = parentKey .. ":dependencies"\n    local result = rcall("SREM", parentDependenciesKey, jobKey)\n    if result > 0 then\n      local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n      if pendingDependencies == 0 then\n        local parentId = getJobIdFromKey(parentKey)\n        local parentPrefix = getJobKeyPrefix(parentKey, parentId)\n        local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n        if numRemovedElements == 1 then\n          if hard then -- remove parent in same queue\n            if parentPrefix == baseKey then\n              removeParentDependencyKey(parentKey, hard, nil, baseKey, nil)\n              removeJobKeys(parentKey)\n              if debounceId then\n                rcall("DEL", parentPrefix .. "de:" .. debounceId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId)\n            end\n          else\n            _moveParentToWait(parentPrefix, parentId, true)\n          end\n        end\n      end\n      return true\n    end\n  else\n    local parentAttributes = rcall("HMGET", jobKey, "parentKey", "deid")\n    local missedParentKey = parentAttributes[1]\n    if( (type(missedParentKey) == "string") and missedParentKey ~= ""\n      and (rcall("EXISTS", missedParentKey) == 1)) then\n      local parentDependenciesKey = missedParentKey .. ":dependencies"\n      local result = rcall("SREM", parentDependenciesKey, jobKey)\n      if result > 0 then\n        local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n        if pendingDependencies == 0 then\n          local parentId = getJobIdFromKey(missedParentKey)\n          local parentPrefix = getJobKeyPrefix(missedParentKey, parentId)\n          local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n          if numRemovedElements == 1 then\n            if hard then\n              if parentPrefix == baseKey then\n                removeParentDependencyKey(missedParentKey, hard, nil, baseKey, nil)\n                removeJobKeys(missedParentKey)\n                if parentAttributes[2] then\n                  rcall("DEL", parentPrefix .. "de:" .. parentAttributes[2])\n                end\n              else\n                _moveParentToWait(parentPrefix, parentId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId, true)\n            end\n          end\n        end\n        return true\n      end\n    end\n  end\n  return false\nend\nlocal function removeJob(jobId, hard, baseKey, shouldRemoveDeduplicationKey)\n  local jobKey = baseKey .. jobId\n  removeParentDependencyKey(jobKey, hard, nil, baseKey)\n  if shouldRemoveDeduplicationKey then\n    removeDeduplicationKeyIfNeededOnRemoval(baseKey, jobKey, jobId)\n  end\n  removeJobKeys(jobKey)\nend\nlocal function removeJobs(keys, hard, baseKey, max)\n  for i, key in ipairs(keys) do\n    removeJob(key, hard, baseKey, true --[[remove debounce key]])\n  end\n  return max - #keys\nend\n--[[\n  Functions to remove jobs.\n]]\n-- Includes\n--[[\n  Function to filter out jobs to ignore from a table.\n]]\nlocal function filterOutJobsToIgnore(jobs, jobsToIgnore)\n  local filteredJobs = {}\n  for i = 1, #jobs do\n    if not jobsToIgnore[jobs[i]] then\n      table.insert(filteredJobs, jobs[i])\n    end\n  end\n  return filteredJobs\nend\nlocal function getListItems(keyName, max)\n  return rcall(\'LRANGE\', keyName, 0, max - 1)\nend\nlocal function removeListJobs(keyName, hard, baseKey, max, jobsToIgnore)\n  local jobs = getListItems(keyName, max)\n  if jobsToIgnore then\n    jobs = filterOutJobsToIgnore(jobs, jobsToIgnore)\n  end\n  local count = removeJobs(jobs, hard, baseKey, max)\n  rcall("LTRIM", keyName, #jobs, -1)\n  return count\nend\n-- Includes\n--[[\n  Function to loop in batches.\n  Just a bit of warning, some commands as ZREM\n  could receive a maximum of 7000 parameters per call.\n]]\nlocal function batches(n, batchSize)\n  local i = 0\n  return function()\n    local from = i * batchSize + 1\n    i = i + 1\n    if (from <= n) then\n      local to = math.min(from + batchSize - 1, n)\n      return from, to\n    end\n  end\nend\n--[[\n  Function to get ZSet items.\n]]\nlocal function getZSetItems(keyName, max)\n  return rcall(\'ZRANGE\', keyName, 0, max - 1)\nend\nlocal function removeZSetJobs(keyName, hard, baseKey, max, jobsToIgnore)\n  local jobs = getZSetItems(keyName, max)\n  if jobsToIgnore then\n    jobs = filterOutJobsToIgnore(jobs, jobsToIgnore)\n  end\n  local count = removeJobs(jobs, hard, baseKey, max)\n  if(#jobs > 0) then\n    for from, to in batches(#jobs, 7000) do\n      rcall("ZREM", keyName, unpack(jobs, from, to))\n    end\n  end\n  return count\nend\nlocal function removeLockKeys(keys)\n  for i, key in ipairs(keys) do\n    rcall("DEL", baseKey .. key .. \':lock\')\n  end\nend\n-- 1) Check if paused, if not return with error.\nif rcall("HEXISTS", KEYS[1], "paused") ~= 1 then\n  return -1 -- Error, NotPaused\nend\n-- 2) Check if there are active jobs, if there are and not "force" return error.\nlocal activeKey = baseKey .. \'active\'\nlocal activeJobs = getListItems(activeKey, maxCount)\nif (#activeJobs > 0) then\n  if(ARGV[2] == "") then \n    return -2 -- Error, ExistActiveJobs\n  end\nend\nremoveLockKeys(activeJobs)\nmaxCount = removeJobs(activeJobs, true, baseKey, maxCount)\nrcall("LTRIM", activeKey, #activeJobs, -1)\nif(maxCount <= 0) then\n  return 1\nend\nlocal delayedKey = baseKey .. \'delayed\'\nmaxCount = removeZSetJobs(delayedKey, true, baseKey, maxCount)\nif(maxCount <= 0) then\n  return 1\nend\nlocal repeatKey = baseKey .. \'repeat\'\nlocal repeatJobsIds = getZSetItems(repeatKey, maxCount)\nfor i, key in ipairs(repeatJobsIds) do\n  local jobKey = repeatKey .. ":" .. key\n  rcall("DEL", jobKey)\nend\nif(#repeatJobsIds > 0) then\n  for from, to in batches(#repeatJobsIds, 7000) do\n    rcall("ZREM", repeatKey, unpack(repeatJobsIds, from, to))\n  end\nend\nmaxCount = maxCount - #repeatJobsIds\nif(maxCount <= 0) then\n  return 1\nend\nlocal completedKey = baseKey .. \'completed\'\nmaxCount = removeZSetJobs(completedKey, true, baseKey, maxCount)\nif(maxCount <= 0) then\n  return 1\nend\nlocal waitKey = baseKey .. \'paused\'\nmaxCount = removeListJobs(waitKey, true, baseKey, maxCount)\nif(maxCount <= 0) then\n  return 1\nend\nlocal prioritizedKey = baseKey .. \'prioritized\'\nmaxCount = removeZSetJobs(prioritizedKey, true, baseKey, maxCount)\nif(maxCount <= 0) then\n  return 1\nend\nlocal failedKey = baseKey .. \'failed\'\nmaxCount = removeZSetJobs(failedKey, true, baseKey, maxCount)\nif(maxCount <= 0) then\n  return 1\nend\nif(maxCount > 0) then\n  rcall("DEL",\n    baseKey .. \'events\',\n    baseKey .. \'delay\', \n    baseKey .. \'stalled-check\',\n    baseKey .. \'stalled\',\n    baseKey .. \'id\',\n    baseKey .. \'pc\',\n    baseKey .. \'meta\',\n    baseKey .. \'metrics:completed\',\n    baseKey .. \'metrics:completed:data\',\n    baseKey .. \'metrics:failed\',\n    baseKey .. \'metrics:failed:data\')\n  return 0\nelse\n  return 1\nend\n',keys:2},LR={name:"paginate",content:'--[[\n    Paginate a set or hash\n    Input:\n      KEYS[1] key pointing to the set or hash to be paginated.\n      ARGV[1]  page start offset\n      ARGV[2]  page end offset (-1 for all the elements)\n      ARGV[3]  cursor\n      ARGV[4]  offset\n      ARGV[5]  max iterations\n      ARGV[6]  fetch jobs?\n    Output:\n      [cursor, offset, items, numItems]\n]]\nlocal rcall = redis.call\n-- Includes\n--[[\n  Function to achieve pagination for a set or hash.\n  This function simulates pagination in the most efficient way possible\n  for a set using sscan or hscan.\n  The main limitation is that sets are not order preserving, so the\n  pagination is not stable. This means that if the set is modified\n  between pages, the same element may appear in different pages.\n]] -- Maximum number of elements to be returned by sscan per iteration.\nlocal maxCount = 100\n-- Finds the cursor, and returns the first elements available for the requested page.\nlocal function findPage(key, command, pageStart, pageSize, cursor, offset,\n                        maxIterations, fetchJobs)\n    local items = {}\n    local jobs = {}\n    local iterations = 0\n    repeat\n        -- Iterate over the set using sscan/hscan.\n        local result = rcall(command, key, cursor, "COUNT", maxCount)\n        cursor = result[1]\n        local members = result[2]\n        local step = 1\n        if command == "HSCAN" then\n            step = 2\n        end\n        if #members == 0 then\n            -- If the result is empty, we can return the result.\n            return cursor, offset, items, jobs\n        end\n        local chunkStart = offset\n        local chunkEnd = offset + #members / step\n        local pageEnd = pageStart + pageSize\n        if chunkEnd < pageStart then\n            -- If the chunk is before the page, we can skip it.\n            offset = chunkEnd\n        elseif chunkStart > pageEnd then\n            -- If the chunk is after the page, we can return the result.\n            return cursor, offset, items, jobs\n        else\n            -- If the chunk is overlapping the page, we need to add the elements to the result.\n            for i = 1, #members, step do\n                if offset >= pageEnd then\n                    return cursor, offset, items, jobs\n                end\n                if offset >= pageStart then\n                    local index = #items + 1\n                    if fetchJobs ~= nil then\n                        jobs[#jobs+1] = rcall("HGETALL", members[i])\n                    end\n                    if step == 2 then\n                        items[index] = {members[i], members[i + 1]}\n                    else\n                        items[index] = members[i]\n                    end\n                end\n                offset = offset + 1\n            end\n        end\n        iterations = iterations + 1\n    until cursor == "0" or iterations >= maxIterations\n    return cursor, offset, items, jobs\nend\nlocal key = KEYS[1]\nlocal scanCommand = "SSCAN"\nlocal countCommand = "SCARD"\nlocal type = rcall("TYPE", key)["ok"]\nif type == "none" then\n    return {0, 0, {}, 0}\nelseif type == "hash" then\n    scanCommand = "HSCAN"\n    countCommand = "HLEN"\nelseif type ~= "set" then\n    return\n        redis.error_reply("Pagination is only supported for sets and hashes.")\nend\nlocal numItems = rcall(countCommand, key)\nlocal startOffset = tonumber(ARGV[1])\nlocal endOffset = tonumber(ARGV[2])\nif endOffset == -1 then \n  endOffset = numItems\nend\nlocal pageSize = (endOffset - startOffset) + 1\nlocal cursor, offset, items, jobs = findPage(key, scanCommand, startOffset,\n                                       pageSize, ARGV[3], tonumber(ARGV[4]),\n                                       tonumber(ARGV[5]), ARGV[6])\nreturn {cursor, offset, items, numItems, jobs}\n',keys:1},MR={name:"pause",content:'--[[\n  Pauses or resumes a queue globably.\n  Input:\n    KEYS[1] \'wait\' or \'paused\'\'\n    KEYS[2] \'paused\' or \'wait\'\n    KEYS[3] \'meta\'\n    KEYS[4] \'prioritized\'\n    KEYS[5] events stream key\n    KEYS[6] \'delayed\'\n    KEYS|7] \'marker\'\n    ARGV[1] \'paused\' or \'resumed\'\n  Event:\n    publish paused or resumed event.\n]]\nlocal rcall = redis.call\n-- Includes\n--[[\n  Add delay marker if needed.\n]]\n-- Includes\n--[[\n  Function to return the next delayed job timestamp.\n]]\nlocal function getNextDelayedTimestamp(delayedKey)\n  local result = rcall("ZRANGE", delayedKey, 0, 0, "WITHSCORES")\n  if #result then\n    local nextTimestamp = tonumber(result[2])\n    if nextTimestamp ~= nil then\n      return nextTimestamp / 0x1000\n    end\n  end\nend\nlocal function addDelayMarkerIfNeeded(markerKey, delayedKey)\n  local nextTimestamp = getNextDelayedTimestamp(delayedKey)\n  if nextTimestamp ~= nil then\n    -- Replace the score of the marker with the newest known\n    -- next timestamp.\n    rcall("ZADD", markerKey, nextTimestamp, "1")\n  end\nend\nlocal markerKey = KEYS[7]\nlocal hasJobs = rcall("EXISTS", KEYS[1]) == 1\n--TODO: check this logic to be reused when changing a delay\nif hasJobs then rcall("RENAME", KEYS[1], KEYS[2]) end\nif ARGV[1] == "paused" then\n    rcall("HSET", KEYS[3], "paused", 1)\n    rcall("DEL", markerKey)\nelse\n    rcall("HDEL", KEYS[3], "paused")\n    if hasJobs or rcall("ZCARD", KEYS[4]) > 0 then\n        -- Add marker if there are waiting or priority jobs\n        rcall("ZADD", markerKey, 0, "0")\n    else\n        addDelayMarkerIfNeeded(markerKey, KEYS[6])\n    end\nend\nrcall("XADD", KEYS[5], "*", "event", ARGV[1]);\n',keys:7},FR={name:"promote",content:'--[[\n  Promotes a job that is currently "delayed" to the "waiting" state\n    Input:\n      KEYS[1] \'delayed\'\n      KEYS[2] \'wait\'\n      KEYS[3] \'paused\'\n      KEYS[4] \'meta\'\n      KEYS[5] \'prioritized\'\n      KEYS[6] \'active\'\n      KEYS[7] \'pc\' priority counter\n      KEYS[8] \'event stream\'\n      KEYS[9] \'marker\'\n      ARGV[1]  queue.toKey(\'\')\n      ARGV[2]  jobId\n    Output:\n       0 - OK\n      -3 - Job not in delayed zset.\n    Events:\n      \'waiting\'\n]]\nlocal rcall = redis.call\nlocal jobId = ARGV[2]\n-- Includes\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to add job considering priority.\n]]\n-- Includes\n--[[\n  Function to get priority score.\n]]\nlocal function getPriorityScore(priority, priorityCounterKey)\n  local prioCounter = rcall("INCR", priorityCounterKey)\n  return priority * 0x100000000 + prioCounter % 0x100000000\nend\nlocal function addJobWithPriority(markerKey, prioritizedKey, priority, jobId, priorityCounterKey,\n  isPausedOrMaxed)\n  local score = getPriorityScore(priority, priorityCounterKey)\n  rcall("ZADD", prioritizedKey, score, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\nif rcall("ZREM", KEYS[1], jobId) == 1 then\n    local jobKey = ARGV[1] .. jobId\n    local priority = tonumber(rcall("HGET", jobKey, "priority")) or 0\n    local metaKey = KEYS[4]\n    local markerKey = KEYS[9]\n    -- Remove delayed "marker" from the wait list if there is any.\n    -- Since we are adding a job we do not need the marker anymore.\n    -- Markers in waitlist DEPRECATED in v5: Remove in v6.\n    local target, isPausedOrMaxed = getTargetQueueList(metaKey, KEYS[6], KEYS[2], KEYS[3])\n    local marker = rcall("LINDEX", target, 0)\n    if marker and string.sub(marker, 1, 2) == "0:" then rcall("LPOP", target) end\n    if priority == 0 then\n        -- LIFO or FIFO\n        addJobInTargetList(target, markerKey, "LPUSH", isPausedOrMaxed, jobId)\n    else\n        addJobWithPriority(markerKey, KEYS[5], priority, jobId, KEYS[7], isPausedOrMaxed)\n    end\n    -- Emit waiting event (wait..ing@token)\n    rcall("XADD", KEYS[8], "*", "event", "waiting", "jobId", jobId, "prev",\n          "delayed");\n    rcall("HSET", jobKey, "delay", 0)\n    return 0\nelse\n    return -3\nend\n',keys:9},BR={name:"releaseLock",content:'--[[\n  Release lock\n    Input:\n      KEYS[1] \'lock\',\n      ARGV[1]  token\n      ARGV[2]  lock duration in milliseconds\n    Output:\n      "OK" if lock extented succesfully.\n]]\nlocal rcall = redis.call\nif rcall("GET", KEYS[1]) == ARGV[1] then\n  return rcall("DEL", KEYS[1])\nelse\n  return 0\nend\n',keys:1},VR={name:"removeChildDependency",content:'--[[\n  Break parent-child dependency by removing\n  child reference from parent\n  Input:\n    KEYS[1] \'key\' prefix,\n    ARGV[1] job key\n    ARGV[2] parent key\n    Output:\n       0  - OK\n       1  - There is not relationship.\n      -1  - Missing job key\n      -5  - Missing parent key\n]]\nlocal rcall = redis.call\nlocal jobKey = ARGV[1]\nlocal parentKey = ARGV[2]\n-- Includes\n--[[\n  Check if this job has a parent. If so we will just remove it from\n  the parent child list, but if it is the last child we should move the parent to "wait/paused"\n  which requires code from "moveToFinished"\n]]\n-- Includes\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Functions to destructure job key.\n  Just a bit of warning, these functions may be a bit slow and affect performance significantly.\n]]\nlocal getJobIdFromKey = function (jobKey)\n  return string.match(jobKey, ".*:(.*)")\nend\nlocal getJobKeyPrefix = function (jobKey, jobId)\n  return string.sub(jobKey, 0, #jobKey - #jobId)\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\n--[[\n  Function to remove job keys.\n]]\nlocal function removeJobKeys(jobKey)\n  return rcall("DEL", jobKey, jobKey .. \':logs\', jobKey .. \':dependencies\',\n    jobKey .. \':processed\', jobKey .. \':failed\', jobKey .. \':unsuccessful\')\nend\nlocal function _moveParentToWait(parentPrefix, parentId, emitEvent)\n  local parentTarget, isPausedOrMaxed = getTargetQueueList(parentPrefix .. "meta", parentPrefix .. "active",\n    parentPrefix .. "wait", parentPrefix .. "paused")\n  addJobInTargetList(parentTarget, parentPrefix .. "marker", "RPUSH", isPausedOrMaxed, parentId)\n  if emitEvent then\n    local parentEventStream = parentPrefix .. "events"\n    rcall("XADD", parentEventStream, "*", "event", "waiting", "jobId", parentId, "prev", "waiting-children")\n  end\nend\nlocal function removeParentDependencyKey(jobKey, hard, parentKey, baseKey, debounceId)\n  if parentKey then\n    local parentDependenciesKey = parentKey .. ":dependencies"\n    local result = rcall("SREM", parentDependenciesKey, jobKey)\n    if result > 0 then\n      local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n      if pendingDependencies == 0 then\n        local parentId = getJobIdFromKey(parentKey)\n        local parentPrefix = getJobKeyPrefix(parentKey, parentId)\n        local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n        if numRemovedElements == 1 then\n          if hard then -- remove parent in same queue\n            if parentPrefix == baseKey then\n              removeParentDependencyKey(parentKey, hard, nil, baseKey, nil)\n              removeJobKeys(parentKey)\n              if debounceId then\n                rcall("DEL", parentPrefix .. "de:" .. debounceId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId)\n            end\n          else\n            _moveParentToWait(parentPrefix, parentId, true)\n          end\n        end\n      end\n      return true\n    end\n  else\n    local parentAttributes = rcall("HMGET", jobKey, "parentKey", "deid")\n    local missedParentKey = parentAttributes[1]\n    if( (type(missedParentKey) == "string") and missedParentKey ~= ""\n      and (rcall("EXISTS", missedParentKey) == 1)) then\n      local parentDependenciesKey = missedParentKey .. ":dependencies"\n      local result = rcall("SREM", parentDependenciesKey, jobKey)\n      if result > 0 then\n        local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n        if pendingDependencies == 0 then\n          local parentId = getJobIdFromKey(missedParentKey)\n          local parentPrefix = getJobKeyPrefix(missedParentKey, parentId)\n          local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n          if numRemovedElements == 1 then\n            if hard then\n              if parentPrefix == baseKey then\n                removeParentDependencyKey(missedParentKey, hard, nil, baseKey, nil)\n                removeJobKeys(missedParentKey)\n                if parentAttributes[2] then\n                  rcall("DEL", parentPrefix .. "de:" .. parentAttributes[2])\n                end\n              else\n                _moveParentToWait(parentPrefix, parentId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId, true)\n            end\n          end\n        end\n        return true\n      end\n    end\n  end\n  return false\nend\nif rcall("EXISTS", jobKey) ~= 1 then return -1 end\nif rcall("EXISTS", parentKey) ~= 1 then return -5 end\nif removeParentDependencyKey(jobKey, false, parentKey, KEYS[1], nil) then\n  rcall("HDEL", jobKey, "parentKey", "parent")\n  return 0\nelse\n  return 1\nend',keys:1},UR={name:"removeJob",content:'--[[\n    Remove a job from all the statuses it may be in as well as all its data.\n    In order to be able to remove a job, it cannot be active.\n    Input:\n      KEYS[1] jobKey\n      KEYS[2] repeat key\n      ARGV[1] jobId\n      ARGV[2] remove children\n      ARGV[3] queue prefix\n    Events:\n      \'removed\'\n]]\nlocal rcall = redis.call\n-- Includes\n--[[\n  Function to check if the job belongs to a job scheduler and\n  current delayed job matches with jobId\n]]\nlocal function isJobSchedulerJob(jobId, jobKey, jobSchedulersKey)\n  local repeatJobKey = rcall("HGET", jobKey, "rjk")\n  if repeatJobKey  then\n    local prevMillis = rcall("ZSCORE", jobSchedulersKey, repeatJobKey)\n    if prevMillis then\n      local currentDelayedJobId = "repeat:" .. repeatJobKey .. ":" .. prevMillis\n      return jobId == currentDelayedJobId\n    end\n  end\n  return false\nend\n--[[\n  Function to recursively check if there are no locks\n  on the jobs to be removed.\n  returns:\n    boolean\n]]\n--[[\n  Functions to destructure job key.\n  Just a bit of warning, these functions may be a bit slow and affect performance significantly.\n]]\nlocal getJobIdFromKey = function (jobKey)\n  return string.match(jobKey, ".*:(.*)")\nend\nlocal getJobKeyPrefix = function (jobKey, jobId)\n  return string.sub(jobKey, 0, #jobKey - #jobId)\nend\nlocal function isLocked( prefix, jobId, removeChildren)\n  local jobKey = prefix .. jobId;\n  -- Check if this job is locked\n  local lockKey = jobKey .. \':lock\'\n  local lock = rcall("GET", lockKey)\n  if not lock then\n    if removeChildren == "1" then\n      local dependencies = rcall("SMEMBERS", jobKey .. ":dependencies")\n      if (#dependencies > 0) then\n        for i, childJobKey in ipairs(dependencies) do\n          -- We need to get the jobId for this job.\n          local childJobId = getJobIdFromKey(childJobKey)\n          local childJobPrefix = getJobKeyPrefix(childJobKey, childJobId)\n          local result = isLocked( childJobPrefix, childJobId, removeChildren )\n          if result then\n            return true\n          end\n        end\n      end\n    end\n    return false\n  end\n  return true\nend\n--[[\n    Remove a job from all the statuses it may be in as well as all its data,\n    including its children. Active children can be ignored.\n    Events:\n      \'removed\'\n]]\nlocal rcall = redis.call\n-- Includes\n--[[\n  Function to get max events value or set by default 10000.\n]]\nlocal function getOrSetMaxEvents(metaKey)\n  local maxEvents = rcall("HGET", metaKey, "opts.maxLenEvents")\n  if not maxEvents then\n    maxEvents = 10000\n    rcall("HSET", metaKey, "opts.maxLenEvents", maxEvents)\n  end\n  return maxEvents\nend\n--[[\n  Function to remove deduplication key if needed\n  when a job is being removed.\n]]\nlocal function removeDeduplicationKeyIfNeededOnRemoval(prefixKey,\n  jobKey, jobId)\n  local deduplicationId = rcall("HGET", jobKey, "deid")\n  if deduplicationId then\n    local deduplicationKey = prefixKey .. "de:" .. deduplicationId\n    local currentJobId = rcall(\'GET\', deduplicationKey)\n    if currentJobId and currentJobId == jobId then\n      return rcall("DEL", deduplicationKey)\n    end\n  end\nend\n--[[\n  Function to remove from any state.\n  returns:\n    prev state\n]]\nlocal function removeJobFromAnyState( prefix, jobId)\n  -- We start with the ZSCORE checks, since they have O(1) complexity\n  if rcall("ZSCORE", prefix .. "completed", jobId) then\n    rcall("ZREM", prefix .. "completed", jobId)\n    return "completed"\n  elseif rcall("ZSCORE", prefix .. "waiting-children", jobId) then\n    rcall("ZREM", prefix .. "waiting-children", jobId)\n    return "waiting-children"\n  elseif rcall("ZSCORE", prefix .. "delayed", jobId) then\n    rcall("ZREM", prefix .. "delayed", jobId)\n    return "delayed"\n  elseif rcall("ZSCORE", prefix .. "failed", jobId) then\n    rcall("ZREM", prefix .. "failed", jobId)\n    return "failed"\n  elseif rcall("ZSCORE", prefix .. "prioritized", jobId) then\n    rcall("ZREM", prefix .. "prioritized", jobId)\n    return "prioritized"\n  -- We remove only 1 element from the list, since we assume they are not added multiple times\n  elseif rcall("LREM", prefix .. "wait", 1, jobId) == 1 then\n    return "wait"\n  elseif rcall("LREM", prefix .. "paused", 1, jobId) == 1 then\n    return "paused"\n  elseif rcall("LREM", prefix .. "active", 1, jobId) == 1 then\n    return "active"\n  end\n  return "unknown"\nend\n--[[\n  Function to remove job keys.\n]]\nlocal function removeJobKeys(jobKey)\n  return rcall("DEL", jobKey, jobKey .. \':logs\', jobKey .. \':dependencies\',\n    jobKey .. \':processed\', jobKey .. \':failed\', jobKey .. \':unsuccessful\')\nend\n--[[\n  Check if this job has a parent. If so we will just remove it from\n  the parent child list, but if it is the last child we should move the parent to "wait/paused"\n  which requires code from "moveToFinished"\n]]\n-- Includes\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\nlocal function _moveParentToWait(parentPrefix, parentId, emitEvent)\n  local parentTarget, isPausedOrMaxed = getTargetQueueList(parentPrefix .. "meta", parentPrefix .. "active",\n    parentPrefix .. "wait", parentPrefix .. "paused")\n  addJobInTargetList(parentTarget, parentPrefix .. "marker", "RPUSH", isPausedOrMaxed, parentId)\n  if emitEvent then\n    local parentEventStream = parentPrefix .. "events"\n    rcall("XADD", parentEventStream, "*", "event", "waiting", "jobId", parentId, "prev", "waiting-children")\n  end\nend\nlocal function removeParentDependencyKey(jobKey, hard, parentKey, baseKey, debounceId)\n  if parentKey then\n    local parentDependenciesKey = parentKey .. ":dependencies"\n    local result = rcall("SREM", parentDependenciesKey, jobKey)\n    if result > 0 then\n      local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n      if pendingDependencies == 0 then\n        local parentId = getJobIdFromKey(parentKey)\n        local parentPrefix = getJobKeyPrefix(parentKey, parentId)\n        local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n        if numRemovedElements == 1 then\n          if hard then -- remove parent in same queue\n            if parentPrefix == baseKey then\n              removeParentDependencyKey(parentKey, hard, nil, baseKey, nil)\n              removeJobKeys(parentKey)\n              if debounceId then\n                rcall("DEL", parentPrefix .. "de:" .. debounceId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId)\n            end\n          else\n            _moveParentToWait(parentPrefix, parentId, true)\n          end\n        end\n      end\n      return true\n    end\n  else\n    local parentAttributes = rcall("HMGET", jobKey, "parentKey", "deid")\n    local missedParentKey = parentAttributes[1]\n    if( (type(missedParentKey) == "string") and missedParentKey ~= ""\n      and (rcall("EXISTS", missedParentKey) == 1)) then\n      local parentDependenciesKey = missedParentKey .. ":dependencies"\n      local result = rcall("SREM", parentDependenciesKey, jobKey)\n      if result > 0 then\n        local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n        if pendingDependencies == 0 then\n          local parentId = getJobIdFromKey(missedParentKey)\n          local parentPrefix = getJobKeyPrefix(missedParentKey, parentId)\n          local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n          if numRemovedElements == 1 then\n            if hard then\n              if parentPrefix == baseKey then\n                removeParentDependencyKey(missedParentKey, hard, nil, baseKey, nil)\n                removeJobKeys(missedParentKey)\n                if parentAttributes[2] then\n                  rcall("DEL", parentPrefix .. "de:" .. parentAttributes[2])\n                end\n              else\n                _moveParentToWait(parentPrefix, parentId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId, true)\n            end\n          end\n        end\n        return true\n      end\n    end\n  end\n  return false\nend\nlocal removeJobChildren\nlocal removeJobWithChildren\nremoveJobChildren = function(prefix, jobKey, options)\n    -- Check if this job has children\n    -- If so, we are going to try to remove the children recursively in a depth-first way\n    -- because if some job is locked, we must exit with an error.\n    if not options.ignoreProcessed then\n        local processed = rcall("HGETALL", jobKey .. ":processed")\n        if #processed > 0 then\n            for i = 1, #processed, 2 do\n                local childJobId = getJobIdFromKey(processed[i])\n                local childJobPrefix = getJobKeyPrefix(processed[i], childJobId)\n                removeJobWithChildren(childJobPrefix, childJobId, jobKey, options)\n            end\n        end\n        local failed = rcall("HGETALL", jobKey .. ":failed")\n        if #failed > 0 then\n            for i = 1, #failed, 2 do\n                local childJobId = getJobIdFromKey(failed[i])\n                local childJobPrefix = getJobKeyPrefix(failed[i], childJobId)\n                removeJobWithChildren(childJobPrefix, childJobId, jobKey, options)\n            end\n        end\n        local unsuccessful = rcall("ZRANGE", jobKey .. ":unsuccessful", 0, -1)\n        if #unsuccessful > 0 then\n            for i = 1, #unsuccessful, 1 do\n                local childJobId = getJobIdFromKey(unsuccessful[i])\n                local childJobPrefix = getJobKeyPrefix(unsuccessful[i], childJobId)\n                removeJobWithChildren(childJobPrefix, childJobId, jobKey, options)\n            end\n        end\n    end\n    local dependencies = rcall("SMEMBERS", jobKey .. ":dependencies")\n    if #dependencies > 0 then\n        for i, childJobKey in ipairs(dependencies) do\n            local childJobId = getJobIdFromKey(childJobKey)\n            local childJobPrefix = getJobKeyPrefix(childJobKey, childJobId)\n            removeJobWithChildren(childJobPrefix, childJobId, jobKey, options)\n        end\n    end\nend\nremoveJobWithChildren = function(prefix, jobId, parentKey, options)\n    local jobKey = prefix .. jobId\n    if options.ignoreLocked then\n        if isLocked(prefix, jobId) then\n            return\n        end\n    end\n    -- Check if job is in the failed zset\n    local failedSet = prefix .. "failed"\n    if not (options.ignoreProcessed and rcall("ZSCORE", failedSet, jobId)) then\n        removeParentDependencyKey(jobKey, false, parentKey, nil)\n        if options.removeChildren then\n            removeJobChildren(prefix, jobKey, options)\n        end\n        local prev = removeJobFromAnyState(prefix, jobId)\n        removeDeduplicationKeyIfNeededOnRemoval(prefix, jobKey, jobId)\n        if removeJobKeys(jobKey) > 0 then\n            local metaKey = prefix .. "meta"\n            local maxEvents = getOrSetMaxEvents(metaKey)\n            rcall("XADD", prefix .. "events", "MAXLEN", "~", maxEvents, "*", "event", "removed",\n                "jobId", jobId, "prev", prev)\n        end\n    end\nend\nlocal jobId = ARGV[1]\nlocal shouldRemoveChildren = ARGV[2]\nlocal prefix = ARGV[3]\nlocal jobKey = KEYS[1]\nlocal repeatKey = KEYS[2]\nif isJobSchedulerJob(jobId, jobKey, repeatKey) then\n    return -8\nend\nif not isLocked(prefix, jobId, shouldRemoveChildren) then\n    local options = {\n        removeChildren = shouldRemoveChildren == "1",\n        ignoreProcessed = false,\n        ignoreLocked = false\n    }\n    removeJobWithChildren(prefix, jobId, nil, options)\n    return 1\nend\nreturn 0\n',keys:2},JR={name:"removeJobScheduler",content:'--[[\n  Removes a job scheduler and its next scheduled job.\n  Input:\n    KEYS[1] job schedulers key\n    KEYS[2] delayed jobs key\n    KEYS[3] events key\n    ARGV[1] job scheduler id\n    ARGV[2] prefix key\n  Output:\n    0 - OK\n    1 - Missing repeat job\n  Events:\n    \'removed\'\n]]\nlocal rcall = redis.call\n-- Includes\n--[[\n  Function to remove job keys.\n]]\nlocal function removeJobKeys(jobKey)\n  return rcall("DEL", jobKey, jobKey .. \':logs\', jobKey .. \':dependencies\',\n    jobKey .. \':processed\', jobKey .. \':failed\', jobKey .. \':unsuccessful\')\nend\nlocal jobSchedulerId = ARGV[1]\nlocal prefix = ARGV[2]\nlocal millis = rcall("ZSCORE", KEYS[1], jobSchedulerId)\nif millis then\n  -- Delete next programmed job.\n  local delayedJobId = "repeat:" .. jobSchedulerId .. ":" .. millis\n  if(rcall("ZREM", KEYS[2], delayedJobId) == 1) then\n    removeJobKeys(prefix .. delayedJobId)\n    rcall("XADD", KEYS[3], "*", "event", "removed", "jobId", delayedJobId, "prev", "delayed")\n  end\nend\nif(rcall("ZREM", KEYS[1], jobSchedulerId) == 1) then\n  rcall("DEL", KEYS[1] .. ":" .. jobSchedulerId)\n  return 0\nend\nreturn 1\n',keys:3},GR={name:"removeRepeatable",content:'--[[\n  Removes a repeatable job\n  Input:\n    KEYS[1] repeat jobs key\n    KEYS[2] delayed jobs key\n    KEYS[3] events key\n    ARGV[1] old repeat job id\n    ARGV[2] options concat\n    ARGV[3] repeat job key\n    ARGV[4] prefix key\n  Output:\n    0 - OK\n    1 - Missing repeat job\n  Events:\n    \'removed\'\n]]\nlocal rcall = redis.call\nlocal millis = rcall("ZSCORE", KEYS[1], ARGV[2])\n-- Includes\n--[[\n  Function to remove job keys.\n]]\nlocal function removeJobKeys(jobKey)\n  return rcall("DEL", jobKey, jobKey .. \':logs\', jobKey .. \':dependencies\',\n    jobKey .. \':processed\', jobKey .. \':failed\', jobKey .. \':unsuccessful\')\nend\n-- legacy removal TODO: remove in next breaking change\nif millis then\n  -- Delete next programmed job.\n  local repeatJobId = ARGV[1] .. millis\n  if(rcall("ZREM", KEYS[2], repeatJobId) == 1) then\n    removeJobKeys(ARGV[4] .. repeatJobId)\n    rcall("XADD", KEYS[3], "*", "event", "removed", "jobId", repeatJobId, "prev", "delayed");\n  end\nend\nif(rcall("ZREM", KEYS[1], ARGV[2]) == 1) then\n  return 0\nend\n-- new removal\nmillis = rcall("ZSCORE", KEYS[1], ARGV[3])\nif millis then\n  -- Delete next programmed job.\n  local repeatJobId = "repeat:" .. ARGV[3] .. ":" .. millis\n  if(rcall("ZREM", KEYS[2], repeatJobId) == 1) then\n    removeJobKeys(ARGV[4] .. repeatJobId)\n    rcall("XADD", KEYS[3], "*", "event", "removed", "jobId", repeatJobId, "prev", "delayed")\n  end\nend\nif(rcall("ZREM", KEYS[1], ARGV[3]) == 1) then\n  rcall("DEL", KEYS[1] .. ":" .. ARGV[3])\n  return 0\nend\nreturn 1\n',keys:3},$R={name:"removeUnprocessedChildren",content:'--[[\n    Remove a job from all the statuses it may be in as well as all its data.\n    In order to be able to remove a job, it cannot be active.\n    Input:\n      KEYS[1] jobKey\n      KEYS[2] meta key\n      ARGV[1] prefix\n      ARGV[2] jobId\n    Events:\n      \'removed\' for every children removed\n]]\n-- Includes\n--[[\n    Remove a job from all the statuses it may be in as well as all its data,\n    including its children. Active children can be ignored.\n    Events:\n      \'removed\'\n]]\nlocal rcall = redis.call\n-- Includes\n--[[\n  Functions to destructure job key.\n  Just a bit of warning, these functions may be a bit slow and affect performance significantly.\n]]\nlocal getJobIdFromKey = function (jobKey)\n  return string.match(jobKey, ".*:(.*)")\nend\nlocal getJobKeyPrefix = function (jobKey, jobId)\n  return string.sub(jobKey, 0, #jobKey - #jobId)\nend\n--[[\n  Function to get max events value or set by default 10000.\n]]\nlocal function getOrSetMaxEvents(metaKey)\n  local maxEvents = rcall("HGET", metaKey, "opts.maxLenEvents")\n  if not maxEvents then\n    maxEvents = 10000\n    rcall("HSET", metaKey, "opts.maxLenEvents", maxEvents)\n  end\n  return maxEvents\nend\n--[[\n  Function to check if the job belongs to a job scheduler and\n  current delayed job matches with jobId\n]]\nlocal function isJobSchedulerJob(jobId, jobKey, jobSchedulersKey)\n  local repeatJobKey = rcall("HGET", jobKey, "rjk")\n  if repeatJobKey  then\n    local prevMillis = rcall("ZSCORE", jobSchedulersKey, repeatJobKey)\n    if prevMillis then\n      local currentDelayedJobId = "repeat:" .. repeatJobKey .. ":" .. prevMillis\n      return jobId == currentDelayedJobId\n    end\n  end\n  return false\nend\n--[[\n  Function to remove deduplication key if needed\n  when a job is being removed.\n]]\nlocal function removeDeduplicationKeyIfNeededOnRemoval(prefixKey,\n  jobKey, jobId)\n  local deduplicationId = rcall("HGET", jobKey, "deid")\n  if deduplicationId then\n    local deduplicationKey = prefixKey .. "de:" .. deduplicationId\n    local currentJobId = rcall(\'GET\', deduplicationKey)\n    if currentJobId and currentJobId == jobId then\n      return rcall("DEL", deduplicationKey)\n    end\n  end\nend\n--[[\n  Function to remove from any state.\n  returns:\n    prev state\n]]\nlocal function removeJobFromAnyState( prefix, jobId)\n  -- We start with the ZSCORE checks, since they have O(1) complexity\n  if rcall("ZSCORE", prefix .. "completed", jobId) then\n    rcall("ZREM", prefix .. "completed", jobId)\n    return "completed"\n  elseif rcall("ZSCORE", prefix .. "waiting-children", jobId) then\n    rcall("ZREM", prefix .. "waiting-children", jobId)\n    return "waiting-children"\n  elseif rcall("ZSCORE", prefix .. "delayed", jobId) then\n    rcall("ZREM", prefix .. "delayed", jobId)\n    return "delayed"\n  elseif rcall("ZSCORE", prefix .. "failed", jobId) then\n    rcall("ZREM", prefix .. "failed", jobId)\n    return "failed"\n  elseif rcall("ZSCORE", prefix .. "prioritized", jobId) then\n    rcall("ZREM", prefix .. "prioritized", jobId)\n    return "prioritized"\n  -- We remove only 1 element from the list, since we assume they are not added multiple times\n  elseif rcall("LREM", prefix .. "wait", 1, jobId) == 1 then\n    return "wait"\n  elseif rcall("LREM", prefix .. "paused", 1, jobId) == 1 then\n    return "paused"\n  elseif rcall("LREM", prefix .. "active", 1, jobId) == 1 then\n    return "active"\n  end\n  return "unknown"\nend\n--[[\n  Function to remove job keys.\n]]\nlocal function removeJobKeys(jobKey)\n  return rcall("DEL", jobKey, jobKey .. \':logs\', jobKey .. \':dependencies\',\n    jobKey .. \':processed\', jobKey .. \':failed\', jobKey .. \':unsuccessful\')\nend\n--[[\n  Check if this job has a parent. If so we will just remove it from\n  the parent child list, but if it is the last child we should move the parent to "wait/paused"\n  which requires code from "moveToFinished"\n]]\n-- Includes\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\nlocal function _moveParentToWait(parentPrefix, parentId, emitEvent)\n  local parentTarget, isPausedOrMaxed = getTargetQueueList(parentPrefix .. "meta", parentPrefix .. "active",\n    parentPrefix .. "wait", parentPrefix .. "paused")\n  addJobInTargetList(parentTarget, parentPrefix .. "marker", "RPUSH", isPausedOrMaxed, parentId)\n  if emitEvent then\n    local parentEventStream = parentPrefix .. "events"\n    rcall("XADD", parentEventStream, "*", "event", "waiting", "jobId", parentId, "prev", "waiting-children")\n  end\nend\nlocal function removeParentDependencyKey(jobKey, hard, parentKey, baseKey, debounceId)\n  if parentKey then\n    local parentDependenciesKey = parentKey .. ":dependencies"\n    local result = rcall("SREM", parentDependenciesKey, jobKey)\n    if result > 0 then\n      local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n      if pendingDependencies == 0 then\n        local parentId = getJobIdFromKey(parentKey)\n        local parentPrefix = getJobKeyPrefix(parentKey, parentId)\n        local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n        if numRemovedElements == 1 then\n          if hard then -- remove parent in same queue\n            if parentPrefix == baseKey then\n              removeParentDependencyKey(parentKey, hard, nil, baseKey, nil)\n              removeJobKeys(parentKey)\n              if debounceId then\n                rcall("DEL", parentPrefix .. "de:" .. debounceId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId)\n            end\n          else\n            _moveParentToWait(parentPrefix, parentId, true)\n          end\n        end\n      end\n      return true\n    end\n  else\n    local parentAttributes = rcall("HMGET", jobKey, "parentKey", "deid")\n    local missedParentKey = parentAttributes[1]\n    if( (type(missedParentKey) == "string") and missedParentKey ~= ""\n      and (rcall("EXISTS", missedParentKey) == 1)) then\n      local parentDependenciesKey = missedParentKey .. ":dependencies"\n      local result = rcall("SREM", parentDependenciesKey, jobKey)\n      if result > 0 then\n        local pendingDependencies = rcall("SCARD", parentDependenciesKey)\n        if pendingDependencies == 0 then\n          local parentId = getJobIdFromKey(missedParentKey)\n          local parentPrefix = getJobKeyPrefix(missedParentKey, parentId)\n          local numRemovedElements = rcall("ZREM", parentPrefix .. "waiting-children", parentId)\n          if numRemovedElements == 1 then\n            if hard then\n              if parentPrefix == baseKey then\n                removeParentDependencyKey(missedParentKey, hard, nil, baseKey, nil)\n                removeJobKeys(missedParentKey)\n                if parentAttributes[2] then\n                  rcall("DEL", parentPrefix .. "de:" .. parentAttributes[2])\n                end\n              else\n                _moveParentToWait(parentPrefix, parentId)\n              end\n            else\n              _moveParentToWait(parentPrefix, parentId, true)\n            end\n          end\n        end\n        return true\n      end\n    end\n  end\n  return false\nend\n--[[\n  Function to recursively check if there are no locks\n  on the jobs to be removed.\n  returns:\n    boolean\n]]\nlocal function isLocked( prefix, jobId, removeChildren)\n  local jobKey = prefix .. jobId;\n  -- Check if this job is locked\n  local lockKey = jobKey .. \':lock\'\n  local lock = rcall("GET", lockKey)\n  if not lock then\n    if removeChildren == "1" then\n      local dependencies = rcall("SMEMBERS", jobKey .. ":dependencies")\n      if (#dependencies > 0) then\n        for i, childJobKey in ipairs(dependencies) do\n          -- We need to get the jobId for this job.\n          local childJobId = getJobIdFromKey(childJobKey)\n          local childJobPrefix = getJobKeyPrefix(childJobKey, childJobId)\n          local result = isLocked( childJobPrefix, childJobId, removeChildren )\n          if result then\n            return true\n          end\n        end\n      end\n    end\n    return false\n  end\n  return true\nend\nlocal removeJobChildren\nlocal removeJobWithChildren\nremoveJobChildren = function(prefix, jobKey, options)\n    -- Check if this job has children\n    -- If so, we are going to try to remove the children recursively in a depth-first way\n    -- because if some job is locked, we must exit with an error.\n    if not options.ignoreProcessed then\n        local processed = rcall("HGETALL", jobKey .. ":processed")\n        if #processed > 0 then\n            for i = 1, #processed, 2 do\n                local childJobId = getJobIdFromKey(processed[i])\n                local childJobPrefix = getJobKeyPrefix(processed[i], childJobId)\n                removeJobWithChildren(childJobPrefix, childJobId, jobKey, options)\n            end\n        end\n        local failed = rcall("HGETALL", jobKey .. ":failed")\n        if #failed > 0 then\n            for i = 1, #failed, 2 do\n                local childJobId = getJobIdFromKey(failed[i])\n                local childJobPrefix = getJobKeyPrefix(failed[i], childJobId)\n                removeJobWithChildren(childJobPrefix, childJobId, jobKey, options)\n            end\n        end\n        local unsuccessful = rcall("ZRANGE", jobKey .. ":unsuccessful", 0, -1)\n        if #unsuccessful > 0 then\n            for i = 1, #unsuccessful, 1 do\n                local childJobId = getJobIdFromKey(unsuccessful[i])\n                local childJobPrefix = getJobKeyPrefix(unsuccessful[i], childJobId)\n                removeJobWithChildren(childJobPrefix, childJobId, jobKey, options)\n            end\n        end\n    end\n    local dependencies = rcall("SMEMBERS", jobKey .. ":dependencies")\n    if #dependencies > 0 then\n        for i, childJobKey in ipairs(dependencies) do\n            local childJobId = getJobIdFromKey(childJobKey)\n            local childJobPrefix = getJobKeyPrefix(childJobKey, childJobId)\n            removeJobWithChildren(childJobPrefix, childJobId, jobKey, options)\n        end\n    end\nend\nremoveJobWithChildren = function(prefix, jobId, parentKey, options)\n    local jobKey = prefix .. jobId\n    if options.ignoreLocked then\n        if isLocked(prefix, jobId) then\n            return\n        end\n    end\n    -- Check if job is in the failed zset\n    local failedSet = prefix .. "failed"\n    if not (options.ignoreProcessed and rcall("ZSCORE", failedSet, jobId)) then\n        removeParentDependencyKey(jobKey, false, parentKey, nil)\n        if options.removeChildren then\n            removeJobChildren(prefix, jobKey, options)\n        end\n        local prev = removeJobFromAnyState(prefix, jobId)\n        removeDeduplicationKeyIfNeededOnRemoval(prefix, jobKey, jobId)\n        if removeJobKeys(jobKey) > 0 then\n            local metaKey = prefix .. "meta"\n            local maxEvents = getOrSetMaxEvents(metaKey)\n            rcall("XADD", prefix .. "events", "MAXLEN", "~", maxEvents, "*", "event", "removed",\n                "jobId", jobId, "prev", prev)\n        end\n    end\nend\nlocal prefix = ARGV[1]\nlocal jobId = ARGV[2]\nlocal jobKey = KEYS[1]\nlocal metaKey = KEYS[2]\nlocal options = {\n  removeChildren = "1",\n  ignoreProcessed = true,\n  ignoreLocked = true\n}\nremoveJobChildren(prefix, jobKey, options) \n',keys:2},qR={name:"reprocessJob",content:'--[[\n  Attempts to reprocess a job\n  Input:\n    KEYS[1] job key\n    KEYS[2] events stream\n    KEYS[3] job state\n    KEYS[4] wait key\n    KEYS[5] meta\n    KEYS[6] paused key\n    KEYS[7] active key\n    KEYS[8] marker key\n    ARGV[1] job.id\n    ARGV[2] (job.opts.lifo ? \'R\' : \'L\') + \'PUSH\'\n    ARGV[3] propVal - failedReason/returnvalue\n    ARGV[4] prev state - failed/completed\n  Output:\n     1 means the operation was a success\n    -1 means the job does not exist\n    -3 means the job was not found in the expected set.\n]]\nlocal rcall = redis.call;\n-- Includes\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to get max events value or set by default 10000.\n]]\nlocal function getOrSetMaxEvents(metaKey)\n  local maxEvents = rcall("HGET", metaKey, "opts.maxLenEvents")\n  if not maxEvents then\n    maxEvents = 10000\n    rcall("HSET", metaKey, "opts.maxLenEvents", maxEvents)\n  end\n  return maxEvents\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\nif rcall("EXISTS", KEYS[1]) == 1 then\n  local jobId = ARGV[1]\n  if (rcall("ZREM", KEYS[3], jobId) == 1) then\n    rcall("HDEL", KEYS[1], "finishedOn", "processedOn", ARGV[3])\n    local target, isPausedOrMaxed = getTargetQueueList(KEYS[5], KEYS[7], KEYS[4], KEYS[6])\n    addJobInTargetList(target, KEYS[8], ARGV[2], isPausedOrMaxed, jobId)\n    local maxEvents = getOrSetMaxEvents(KEYS[5])\n    -- Emit waiting event\n    rcall("XADD", KEYS[2], "MAXLEN", "~", maxEvents, "*", "event", "waiting",\n      "jobId", jobId, "prev", ARGV[4]);\n    return 1\n  else\n    return -3\n  end\nelse\n  return -1\nend\n',keys:8},zR={name:"retryJob",content:'--[[\n  Retries a failed job by moving it back to the wait queue.\n    Input:\n      KEYS[1]  \'active\',\n      KEYS[2]  \'wait\'\n      KEYS[3]  \'paused\'\n      KEYS[4]  job key\n      KEYS[5]  \'meta\'\n      KEYS[6]  events stream\n      KEYS[7]  delayed key\n      KEYS[8]  prioritized key\n      KEYS[9]  \'pc\' priority counter\n      KEYS[10] \'marker\'\n      KEYS[11] \'stalled\'\n      ARGV[1]  key prefix\n      ARGV[2]  timestamp\n      ARGV[3]  pushCmd\n      ARGV[4]  jobId\n      ARGV[5]  token\n      ARGV[6]  optional job fields to update\n    Events:\n      \'waiting\'\n    Output:\n     0  - OK\n     -1 - Missing key\n     -2 - Missing lock\n     -3 - Job not in active set\n]]\nlocal rcall = redis.call\n-- Includes\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to add job considering priority.\n]]\n-- Includes\n--[[\n  Function to get priority score.\n]]\nlocal function getPriorityScore(priority, priorityCounterKey)\n  local prioCounter = rcall("INCR", priorityCounterKey)\n  return priority * 0x100000000 + prioCounter % 0x100000000\nend\nlocal function addJobWithPriority(markerKey, prioritizedKey, priority, jobId, priorityCounterKey,\n  isPausedOrMaxed)\n  local score = getPriorityScore(priority, priorityCounterKey)\n  rcall("ZADD", prioritizedKey, score, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to get max events value or set by default 10000.\n]]\nlocal function getOrSetMaxEvents(metaKey)\n  local maxEvents = rcall("HGET", metaKey, "opts.maxLenEvents")\n  if not maxEvents then\n    maxEvents = 10000\n    rcall("HSET", metaKey, "opts.maxLenEvents", maxEvents)\n  end\n  return maxEvents\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\n--[[\n  Function to check if queue is paused or maxed\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function isQueuePausedOrMaxed(queueMetaKey, activeKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      return activeCount >= tonumber(queueAttributes[2])\n    end\n  end\n  return false\nend\n--[[\n  Updates the delay set, by moving delayed jobs that should\n  be processed now to "wait".\n     Events:\n      \'waiting\'\n]]\n-- Includes\n-- Try to get as much as 1000 jobs at once\nlocal function promoteDelayedJobs(delayedKey, markerKey, targetKey, prioritizedKey,\n                                  eventStreamKey, prefix, timestamp, priorityCounterKey, isPaused)\n    local jobs = rcall("ZRANGEBYSCORE", delayedKey, 0, (timestamp + 1) * 0x1000 - 1, "LIMIT", 0, 1000)\n    if (#jobs > 0) then\n        rcall("ZREM", delayedKey, unpack(jobs))\n        for _, jobId in ipairs(jobs) do\n            local jobKey = prefix .. jobId\n            local priority =\n                tonumber(rcall("HGET", jobKey, "priority")) or 0\n            if priority == 0 then\n                -- LIFO or FIFO\n                rcall("LPUSH", targetKey, jobId)\n            else\n                local score = getPriorityScore(priority, priorityCounterKey)\n                rcall("ZADD", prioritizedKey, score, jobId)\n            end\n            -- Emit waiting event\n            rcall("XADD", eventStreamKey, "*", "event", "waiting", "jobId",\n                  jobId, "prev", "delayed")\n            rcall("HSET", jobKey, "delay", 0)\n        end\n        addBaseMarkerIfNeeded(markerKey, isPaused)\n    end\nend\nlocal function removeLock(jobKey, stalledKey, token, jobId)\n  if token ~= "0" then\n    local lockKey = jobKey .. \':lock\'\n    local lockToken = rcall("GET", lockKey)\n    if lockToken == token then\n      rcall("DEL", lockKey)\n      rcall("SREM", stalledKey, jobId)\n    else\n      if lockToken then\n        -- Lock exists but token does not match\n        return -6\n      else\n        -- Lock is missing completely\n        return -2\n      end\n    end\n  end\n  return 0\nend\n--[[\n  Function to update a bunch of fields in a job.\n]]\nlocal function updateJobFields(jobKey, msgpackedFields)\n  if msgpackedFields and #msgpackedFields > 0 then\n    local fieldsToUpdate = cmsgpack.unpack(msgpackedFields)\n    if fieldsToUpdate then\n      rcall("HMSET", jobKey, unpack(fieldsToUpdate))\n    end\n  end\nend\nlocal target, isPausedOrMaxed = getTargetQueueList(KEYS[5], KEYS[1], KEYS[2], KEYS[3])\nlocal markerKey = KEYS[10]\n-- Check if there are delayed jobs that we can move to wait.\n-- test example: when there are delayed jobs between retries\npromoteDelayedJobs(KEYS[7], markerKey, target, KEYS[8], KEYS[6], ARGV[1], ARGV[2], KEYS[9], isPausedOrMaxed)\nlocal jobKey = KEYS[4]\nif rcall("EXISTS", jobKey) == 1 then\n  local errorCode = removeLock(jobKey, KEYS[11], ARGV[5], ARGV[4]) \n  if errorCode < 0 then\n    return errorCode\n  end\n  updateJobFields(jobKey, ARGV[6])\n  local numRemovedElements = rcall("LREM", KEYS[1], -1, ARGV[4])\n  if (numRemovedElements < 1) then return -3 end\n  local priority = tonumber(rcall("HGET", jobKey, "priority")) or 0\n  --need to re-evaluate after removing job from active\n  isPausedOrMaxed = isQueuePausedOrMaxed(KEYS[5], KEYS[1])\n  -- Standard or priority add\n  if priority == 0 then\n    addJobInTargetList(target, markerKey, ARGV[3], isPausedOrMaxed, ARGV[4])\n  else\n    addJobWithPriority(markerKey, KEYS[8], priority, ARGV[4], KEYS[9], isPausedOrMaxed)\n  end\n  rcall("HINCRBY", jobKey, "atm", 1)\n  local maxEvents = getOrSetMaxEvents(KEYS[5])\n  -- Emit waiting event\n  rcall("XADD", KEYS[6], "MAXLEN", "~", maxEvents, "*", "event", "waiting",\n    "jobId", ARGV[4], "prev", "failed")\n  return 0\nelse\n  return -1\nend\n',keys:11},WR={name:"saveStacktrace",content:'--[[\n  Save stacktrace and failedReason.\n  Input:\n    KEYS[1] job key\n    ARGV[1]  stacktrace\n    ARGV[2]  failedReason\n  Output:\n     0 - OK\n    -1 - Missing key\n]]\nlocal rcall = redis.call\nif rcall("EXISTS", KEYS[1]) == 1 then\n  rcall("HMSET", KEYS[1], "stacktrace", ARGV[1], "failedReason", ARGV[2])\n  return 0\nelse\n  return -1\nend\n',keys:1},YR={name:"updateData",content:'--[[\n  Update job data\n  Input:\n    KEYS[1] Job id key\n    ARGV[1] data\n  Output:\n    0 - OK\n   -1 - Missing job.\n]]\nlocal rcall = redis.call\nif rcall("EXISTS",KEYS[1]) == 1 then -- // Make sure job exists\n  rcall("HSET", KEYS[1], "data", ARGV[1])\n  return 0\nelse\n  return -1\nend\n',keys:1},HR={name:"updateJobScheduler",content:'--[[\n  Updates a job scheduler and adds next delayed job\n  Input:\n    KEYS[1]  \'repeat\' key\n    KEYS[2]  \'delayed\'\n    KEYS[3]  \'wait\' key\n    KEYS[4]  \'paused\' key\n    KEYS[5]  \'meta\'\n    KEYS[6]  \'prioritized\' key\n    KEYS[7]  \'marker\',\n    KEYS[8]  \'id\'\n    KEYS[9]  events stream key\n    KEYS[10] \'pc\' priority counter\n    KEYS[11] producer key\n    KEYS[12] \'active\' key\n    ARGV[1] next milliseconds\n    ARGV[2] jobs scheduler id\n    ARGV[3] Json stringified delayed data\n    ARGV[4] msgpacked delayed opts\n    ARGV[5] timestamp\n    ARGV[6] prefix key\n    ARGV[7] producer id\n    Output:\n      next delayed job id  - OK\n]]\nlocal rcall = redis.call\nlocal repeatKey = KEYS[1]\nlocal delayedKey = KEYS[2]\nlocal waitKey = KEYS[3]\nlocal pausedKey = KEYS[4]\nlocal metaKey = KEYS[5]\nlocal prioritizedKey = KEYS[6]\nlocal nextMillis = ARGV[1]\nlocal jobSchedulerId = ARGV[2]\nlocal timestamp = ARGV[5]\nlocal prefixKey = ARGV[6]\nlocal producerId = ARGV[7]\n-- Includes\n--[[\n  Add delay marker if needed.\n]]\n-- Includes\n--[[\n  Adds a delayed job to the queue by doing the following:\n    - Creates a new job key with the job data.\n    - adds to delayed zset.\n    - Emits a global event \'delayed\' if the job is delayed.\n]]\n-- Includes\n--[[\n  Add delay marker if needed.\n]]\n-- Includes\n--[[\n  Function to return the next delayed job timestamp.\n]]\nlocal function getNextDelayedTimestamp(delayedKey)\n  local result = rcall("ZRANGE", delayedKey, 0, 0, "WITHSCORES")\n  if #result then\n    local nextTimestamp = tonumber(result[2])\n    if nextTimestamp ~= nil then\n      return nextTimestamp / 0x1000\n    end\n  end\nend\nlocal function addDelayMarkerIfNeeded(markerKey, delayedKey)\n  local nextTimestamp = getNextDelayedTimestamp(delayedKey)\n  if nextTimestamp ~= nil then\n    -- Replace the score of the marker with the newest known\n    -- next timestamp.\n    rcall("ZADD", markerKey, nextTimestamp, "1")\n  end\nend\n--[[\n  Bake in the job id first 12 bits into the timestamp\n  to guarantee correct execution order of delayed jobs\n  (up to 4096 jobs per given timestamp or 4096 jobs apart per timestamp)\n  WARNING: Jobs that are so far apart that they wrap around will cause FIFO to fail\n]]\nlocal function getDelayedScore(delayedKey, timestamp, delay)\n  local delayedTimestamp = (delay > 0 and (tonumber(timestamp) + delay)) or tonumber(timestamp)\n  local minScore = delayedTimestamp * 0x1000\n  local maxScore = (delayedTimestamp + 1 ) * 0x1000 - 1\n  local result = rcall("ZREVRANGEBYSCORE", delayedKey, maxScore,\n    minScore, "WITHSCORES","LIMIT", 0, 1)\n  if #result then\n    local currentMaxScore = tonumber(result[2])\n    if currentMaxScore ~= nil then\n      if currentMaxScore >= maxScore then\n        return maxScore, delayedTimestamp\n      else\n        return currentMaxScore + 1, delayedTimestamp\n      end\n    end\n  end\n  return minScore, delayedTimestamp\nend\nlocal function addDelayedJob(jobId, delayedKey, eventsKey, timestamp,\n  maxEvents, markerKey, delay)\n  local score, delayedTimestamp = getDelayedScore(delayedKey, timestamp, tonumber(delay))\n  rcall("ZADD", delayedKey, score, jobId)\n  rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event", "delayed",\n    "jobId", jobId, "delay", delayedTimestamp)\n  -- mark that a delayed job is available\n  addDelayMarkerIfNeeded(markerKey, delayedKey)\nend\n--[[\n  Function to add job considering priority.\n]]\n-- Includes\n--[[\n  Add marker if needed when a job is available.\n]]\nlocal function addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\n  if not isPausedOrMaxed then\n    rcall("ZADD", markerKey, 0, "0")\n  end  \nend\n--[[\n  Function to get priority score.\n]]\nlocal function getPriorityScore(priority, priorityCounterKey)\n  local prioCounter = rcall("INCR", priorityCounterKey)\n  return priority * 0x100000000 + prioCounter % 0x100000000\nend\nlocal function addJobWithPriority(markerKey, prioritizedKey, priority, jobId, priorityCounterKey,\n  isPausedOrMaxed)\n  local score = getPriorityScore(priority, priorityCounterKey)\n  rcall("ZADD", prioritizedKey, score, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function isQueuePaused(queueMetaKey)\n  return rcall("HEXISTS", queueMetaKey, "paused") == 1\nend\n--[[\n  Function to store a job\n]]\nlocal function storeJob(eventsKey, jobIdKey, jobId, name, data, opts, timestamp,\n                        parentKey, parentData, repeatJobKey)\n    local jsonOpts = cjson.encode(opts)\n    local delay = opts[\'delay\'] or 0\n    local priority = opts[\'priority\'] or 0\n    local debounceId = opts[\'de\'] and opts[\'de\'][\'id\']\n    local optionalValues = {}\n    if parentKey ~= nil then\n        table.insert(optionalValues, "parentKey")\n        table.insert(optionalValues, parentKey)\n        table.insert(optionalValues, "parent")\n        table.insert(optionalValues, parentData)\n    end\n    if repeatJobKey then\n        table.insert(optionalValues, "rjk")\n        table.insert(optionalValues, repeatJobKey)\n    end\n    if debounceId then\n        table.insert(optionalValues, "deid")\n        table.insert(optionalValues, debounceId)\n    end\n    rcall("HMSET", jobIdKey, "name", name, "data", data, "opts", jsonOpts,\n          "timestamp", timestamp, "delay", delay, "priority", priority,\n          unpack(optionalValues))\n    rcall("XADD", eventsKey, "*", "event", "added", "jobId", jobId, "name", name)\n    return delay, priority\nend\n--[[\n  Function to check for the meta.paused key to decide if we are paused or not\n  (since an empty list and !EXISTS are not really the same).\n]]\nlocal function getTargetQueueList(queueMetaKey, activeKey, waitKey, pausedKey)\n  local queueAttributes = rcall("HMGET", queueMetaKey, "paused", "concurrency")\n  if queueAttributes[1] then\n    return pausedKey, true\n  else\n    if queueAttributes[2] then\n      local activeCount = rcall("LLEN", activeKey)\n      if activeCount >= tonumber(queueAttributes[2]) then\n        return waitKey, true\n      else\n        return waitKey, false\n      end\n    end\n  end\n  return waitKey, false\nend\n--[[\n  Function to add job in target list and add marker if needed.\n]]\n-- Includes\nlocal function addJobInTargetList(targetKey, markerKey, pushCmd, isPausedOrMaxed, jobId)\n  rcall(pushCmd, targetKey, jobId)\n  addBaseMarkerIfNeeded(markerKey, isPausedOrMaxed)\nend\nlocal function addJobFromScheduler(jobKey, jobId, rawOpts, waitKey, pausedKey, activeKey, metaKey, \n  prioritizedKey, priorityCounter, delayedKey, markerKey, eventsKey, name, maxEvents, timestamp,\n  data, jobSchedulerId)\n  local opts = cmsgpack.unpack(rawOpts)\n  local delay, priority = storeJob(eventsKey, jobKey, jobId, name, data,\n    opts, timestamp, nil, nil, jobSchedulerId)\n  if delay ~= 0 then\n    addDelayedJob(jobId, delayedKey, eventsKey, timestamp, maxEvents, markerKey, delay)\n  else\n    local target, isPausedOrMaxed = getTargetQueueList(metaKey, activeKey, waitKey, pausedKey)\n    -- Standard or priority add\n    if priority == 0 then\n      local pushCmd = opts[\'lifo\'] and \'RPUSH\' or \'LPUSH\'\n      addJobInTargetList(target, markerKey, pushCmd, isPausedOrMaxed, jobId)\n    else\n      -- Priority add\n      addJobWithPriority(markerKey, prioritizedKey, priority, jobId, priorityCounter, isPausedOrMaxed)\n    end\n    -- Emit waiting event\n    rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents,  "*", "event", "waiting", "jobId", jobId)\n  end\nend\n--[[\n  Function to get max events value or set by default 10000.\n]]\nlocal function getOrSetMaxEvents(metaKey)\n  local maxEvents = rcall("HGET", metaKey, "opts.maxLenEvents")\n  if not maxEvents then\n    maxEvents = 10000\n    rcall("HSET", metaKey, "opts.maxLenEvents", maxEvents)\n  end\n  return maxEvents\nend\nlocal schedulerKey = repeatKey .. ":" .. jobSchedulerId\nlocal nextDelayedJobId = "repeat:" .. jobSchedulerId .. ":" .. nextMillis\nlocal nextDelayedJobKey = schedulerKey .. ":" .. nextMillis\n-- Validate that scheduler exists.\nlocal prevMillis = rcall("ZSCORE", repeatKey, jobSchedulerId)\nif prevMillis then\n    local currentDelayedJobId = "repeat:" .. jobSchedulerId .. ":" .. prevMillis\n    if producerId == currentDelayedJobId then\n        local eventsKey = KEYS[9]\n        local maxEvents = getOrSetMaxEvents(metaKey)\n        if rcall("EXISTS", nextDelayedJobKey) ~= 1 then\n            local schedulerAttributes = rcall("HMGET", schedulerKey, "name", "data")\n            rcall("ZADD", repeatKey, nextMillis, jobSchedulerId)\n            rcall("HINCRBY", schedulerKey, "ic", 1)\n            rcall("INCR", KEYS[8])\n            -- TODO: remove this workaround in next breaking change,\n            -- all job-schedulers must save job data\n            local templateData = schedulerAttributes[2] or ARGV[3]\n            if templateData and templateData ~= \'{}\' then\n                rcall("HSET", schedulerKey, "data", templateData)\n            end\n            addJobFromScheduler(nextDelayedJobKey, nextDelayedJobId, ARGV[4], waitKey, pausedKey, \n                KEYS[12], metaKey, prioritizedKey, KEYS[10], delayedKey, KEYS[7], eventsKey, \n                schedulerAttributes[1], maxEvents, ARGV[5], templateData or \'{}\', jobSchedulerId)\n            -- TODO: remove this workaround in next breaking change\n            if KEYS[11] ~= "" then\n                rcall("HSET", KEYS[11], "nrjid", nextDelayedJobId)\n            end\n            return nextDelayedJobId .. "" -- convert to string\n        else\n            rcall("XADD", eventsKey, "MAXLEN", "~", maxEvents, "*", "event",\n                "duplicated", "jobId", nextDelayedJobId)\n        end\n    end\nend\n',keys:12},QR={name:"updateProgress",content:'--[[\n  Update job progress\n  Input:\n    KEYS[1] Job id key\n    KEYS[2] event stream key\n    KEYS[3] meta key\n    ARGV[1] id\n    ARGV[2] progress\n  Output:\n     0 - OK\n    -1 - Missing job.\n  Event:\n    progress(jobId, progress)\n]]\nlocal rcall = redis.call\n-- Includes\n--[[\n  Function to get max events value or set by default 10000.\n]]\nlocal function getOrSetMaxEvents(metaKey)\n  local maxEvents = rcall("HGET", metaKey, "opts.maxLenEvents")\n  if not maxEvents then\n    maxEvents = 10000\n    rcall("HSET", metaKey, "opts.maxLenEvents", maxEvents)\n  end\n  return maxEvents\nend\nif rcall("EXISTS", KEYS[1]) == 1 then -- // Make sure job exists\n    local maxEvents = getOrSetMaxEvents(KEYS[3])\n    rcall("HSET", KEYS[1], "progress", ARGV[2])\n    rcall("XADD", KEYS[2], "MAXLEN", "~", maxEvents, "*", "event", "progress",\n          "jobId", ARGV[1], "data", ARGV[2]);\n    return 0\nelse\n    return -1\nend\n',keys:3},ZR={name:"updateRepeatableJobMillis",content:'--[[\n  Adds a repeatable job\n    Input:\n      KEYS[1] \'repeat\' key\n      ARGV[1] next milliseconds\n      ARGV[2] custom key\n      ARGV[3] legacy custom key TODO: remove this logic in next breaking change\n      Output:\n        repeatableKey  - OK\n]]\nlocal rcall = redis.call\nlocal repeatKey = KEYS[1]\nlocal nextMillis = ARGV[1]\nlocal customKey = ARGV[2]\nlocal legacyCustomKey = ARGV[3]\nif rcall("ZSCORE", repeatKey, customKey) then\n    rcall("ZADD", repeatKey, nextMillis, customKey)\n    return customKey\nelseif rcall("ZSCORE", repeatKey, legacyCustomKey) ~= false then\n    rcall("ZADD", repeatKey, nextMillis, legacyCustomKey)\n    return legacyCustomKey\nend\nreturn \'\'\n',keys:1};var XR=Object.freeze({__proto__:null,addDelayedJob:iR,addJobScheduler:oR,addLog:sR,addParentJob:lR,addPrioritizedJob:cR,addRepeatableJob:uR,addStandardJob:dR,changeDelay:pR,changePriority:hR,cleanJobsInSet:mR,drain:fR,extendLock:yR,extendLocks:gR,getCounts:bR,getCountsPerPriority:vR,getDependencyCounts:wR,getJobScheduler:SR,getRanges:ER,getRateLimitTtl:xR,getState:_R,getStateV2:kR,isFinished:IR,isJobInList:TR,isMaxed:AR,moveJobFromActiveToWait:OR,moveJobsToWait:KR,moveStalledJobsToWait:CR,moveToActive:RR,moveToDelayed:jR,moveToFinished:PR,moveToWaitingChildren:DR,obliterate:NR,paginate:LR,pause:MR,promote:FR,releaseLock:BR,removeChildDependency:VR,removeJob:UR,removeJobScheduler:JR,removeRepeatable:GR,removeUnprocessedChildren:$R,reprocessJob:qR,retryJob:zR,saveStacktrace:WR,updateData:YR,updateJobScheduler:HR,updateProgress:QR,updateRepeatableJobMillis:ZR});const ej=["BullMQ: WARNING! Your redis options maxRetriesPerRequest must be null","and will be overridden by BullMQ."].join(" ");class tj extends E.EventEmitter{constructor(e,t){if(super(),this.extraOptions=t,this.capabilities={canDoubleTimeout:!1,canBlockFor1Ms:!0},this.status="initializing",this.packageVersion="5.56.0",this.extraOptions=Object.assign({shared:!1,blocking:!0,skipVersionCheck:!1,skipWaitingForReady:!1},t),PC(e)){if(this._client=e,this._client.options.keyPrefix)throw new Error("BullMQ: ioredis does not support ioredis prefixes, use the prefix option instead.");!function(e){return PC(e)&&e.isCluster}(this._client)?this.opts=this._client.options:this.opts=this._client.options.redisOptions,this.checkBlockingOptions("BullMQ: Your redis options maxRetriesPerRequest must be null.",this.opts,!0)}else this.checkBlockingOptions(ej,e),this.opts=Object.assign({port:6379,host:"127.0.0.1",retryStrategy:function(e){return Math.max(Math.min(Math.exp(e),2e4),1e3)}},e),this.extraOptions.blocking&&(this.opts.maxRetriesPerRequest=null);this.skipVersionCheck=(null==t?void 0:t.skipVersionCheck)||!(!this.opts||!this.opts.skipVersionCheck),this.handleClientError=e=>{this.emit("error",e)},this.handleClientClose=()=>{this.emit("close")},this.handleClientReady=()=>{this.emit("ready")},this.initializing=this.init(),this.initializing.catch((e=>this.emit("error",e)))}checkBlockingOptions(e,t,n=!1){if(this.extraOptions.blocking&&t&&t.maxRetriesPerRequest){if(n)throw new Error(e);console.error(e)}}static async waitUntilReady(e){if("ready"===e.status)return;if("wait"===e.status)return e.connect();if("end"===e.status)throw new Error(GE.CONNECTION_CLOSED_ERROR_MSG);let t,n,r;try{await new Promise(((a,i)=>{let o;r=e=>{o=e},t=()=>{a()},n=()=>{"end"!==e.status?i(o||new Error(GE.CONNECTION_CLOSED_ERROR_MSG)):o?i(o):a()},KC(e,3),e.once("ready",t),e.on("end",n),e.once("error",r)}))}finally{e.removeListener("end",n),e.removeListener("error",r),e.removeListener("ready",t),DC(e,3)}}get client(){return this.initializing}loadCommands(e,t){const n=t||XR;for(const t in n){const r=`${n[t].name}:${e}`;this._client[r]||this._client.defineCommand(r,{numberOfKeys:n[t].keys,lua:n[t].content})}}async init(){if(!this._client){const e=this.opts,{url:t}=e,n=eR(e,["url"]);this._client=t?new nT(t,n):new nT(n)}if(KC(this._client,3),this._client.on("error",this.handleClientError),this._client.on("close",this.handleClientClose),this._client.on("ready",this.handleClientReady),this.extraOptions.skipWaitingForReady||await tj.waitUntilReady(this._client),this.loadCommands(this.packageVersion),"end"!==this._client.status){if(this.version=await this.getRedisVersion(),!0!==this.skipVersionCheck&&!this.closing){if(BC(this.version,tj.minimumVersion))throw new Error(`Redis version needs to be greater or equal than ${tj.minimumVersion} Current: ${this.version}`);BC(this.version,tj.recommendedMinimumVersion)&&console.warn(`It is highly recommended to use a minimum Redis version of ${tj.recommendedMinimumVersion}\n             Current: ${this.version}`)}this.capabilities={canDoubleTimeout:!BC(this.version,"6.0.0"),canBlockFor1Ms:!BC(this.version,"7.0.8")},this.status="ready"}return this._client}async disconnect(e=!0){const t=await this.client;if("end"!==t.status){let n,r;if(!e)return t.disconnect();const a=new Promise(((e,a)=>{KC(t,2),t.once("end",e),t.once("error",a),n=e,r=a}));t.disconnect();try{await a}finally{DC(t,2),t.removeListener("end",n),t.removeListener("error",r)}}}async reconnect(){return(await this.client).connect()}async close(e=!1){if(!this.closing){const t=this.status;this.status="closing",this.closing=!0;try{"ready"===t&&await this.initializing,this.extraOptions.shared||("initializing"==t||e?this._client.disconnect():await this._client.quit(),this._client.status="end")}catch(e){if(MC(e))throw e}finally{this._client.off("error",this.handleClientError),this._client.off("close",this.handleClientClose),this._client.off("ready",this.handleClientReady),DC(this._client,3),this.removeAllListeners(),this.status="closed"}}}async getRedisVersion(){const e="redis_version:",t="maxmemory_policy:",n=(await this._client.info()).split(/\r?\n/);let r;for(let a=0;a<n.length;a++){if(0===n[a].indexOf(t)){const e=n[a].substr(t.length);"noeviction"!==e&&console.warn(`IMPORTANT! Eviction policy is ${e}. It should be "noeviction"`)}0===n[a].indexOf(e)&&(r=n[a].substr(e.length))}return r}get redisVersion(){return this.version}}tj.minimumVersion="5.0.0",tj.recommendedMinimumVersion="6.2.0";var nj={};Object.defineProperty(nj,"__esModule",{value:!0});class rj extends Error{}class aj extends rj{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class ij extends rj{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class oj extends rj{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class sj extends rj{}class lj extends rj{constructor(e){super(`Invalid unit ${e}`)}}class cj extends rj{}class uj extends rj{constructor(){super("Zone is an abstract class")}}const dj="numeric",pj="short",hj="long",mj={year:dj,month:dj,day:dj},fj={year:dj,month:pj,day:dj},yj={year:dj,month:pj,day:dj,weekday:pj},gj={year:dj,month:hj,day:dj},bj={year:dj,month:hj,day:dj,weekday:hj},vj={hour:dj,minute:dj},wj={hour:dj,minute:dj,second:dj},Sj={hour:dj,minute:dj,second:dj,timeZoneName:pj},Ej={hour:dj,minute:dj,second:dj,timeZoneName:hj},xj={hour:dj,minute:dj,hourCycle:"h23"},_j={hour:dj,minute:dj,second:dj,hourCycle:"h23"},kj={hour:dj,minute:dj,second:dj,hourCycle:"h23",timeZoneName:pj},Ij={hour:dj,minute:dj,second:dj,hourCycle:"h23",timeZoneName:hj},Tj={year:dj,month:dj,day:dj,hour:dj,minute:dj},Aj={year:dj,month:dj,day:dj,hour:dj,minute:dj,second:dj},Oj={year:dj,month:pj,day:dj,hour:dj,minute:dj},Kj={year:dj,month:pj,day:dj,hour:dj,minute:dj,second:dj},Cj={year:dj,month:pj,day:dj,weekday:pj,hour:dj,minute:dj},Rj={year:dj,month:hj,day:dj,hour:dj,minute:dj,timeZoneName:pj},jj={year:dj,month:hj,day:dj,hour:dj,minute:dj,second:dj,timeZoneName:pj},Pj={year:dj,month:hj,day:dj,weekday:hj,hour:dj,minute:dj,timeZoneName:hj},Dj={year:dj,month:hj,day:dj,weekday:hj,hour:dj,minute:dj,second:dj,timeZoneName:hj};class Nj{get type(){throw new uj}get name(){throw new uj}get ianaName(){return this.name}get isUniversal(){throw new uj}offsetName(e,t){throw new uj}formatOffset(e,t){throw new uj}offset(e){throw new uj}equals(e){throw new uj}get isValid(){throw new uj}}let Lj=null;class Mj extends Nj{static get instance(){return null===Lj&&(Lj=new Mj),Lj}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:t,locale:n}){return aD(e,t,n)}formatOffset(e,t){return lD(this.offset(e),t)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return"system"===e.type}get isValid(){return!0}}const Fj=new Map;const Bj={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};const Vj=new Map;class Uj extends Nj{static create(e){let t=Vj.get(e);return void 0===t&&Vj.set(e,t=new Uj(e)),t}static resetCache(){Vj.clear(),Fj.clear()}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch(e){return!1}}constructor(e){super(),this.zoneName=e,this.valid=Uj.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:t,locale:n}){return aD(e,t,n,this.name)}formatOffset(e,t){return lD(this.offset(e),t)}offset(e){if(!this.valid)return NaN;const t=new Date(e);if(isNaN(t))return NaN;const n=function(e){let t=Fj.get(e);return void 0===t&&(t=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:e,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"}),Fj.set(e,t)),t}(this.name);let[r,a,i,o,s,l,c]=n.formatToParts?function(e,t){const n=e.formatToParts(t),r=[];for(let e=0;e<n.length;e++){const{type:t,value:a}=n[e],i=Bj[t];"era"===t?r[i]=a:LP(i)||(r[i]=parseInt(a,10))}return r}(n,t):function(e,t){const n=e.format(t).replace(/\u200E/g,""),r=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(n),[,a,i,o,s,l,c,u]=r;return[o,a,i,s,l,c,u]}(n,t);"BC"===o&&(r=1-Math.abs(r));let u=+t;const d=u%1e3;return u-=d>=0?d:1e3+d,(eD({year:r,month:a,day:i,hour:24===s?0:s,minute:l,second:c,millisecond:0})-u)/6e4}equals(e){return"iana"===e.type&&e.name===this.name}get isValid(){return this.valid}}let Jj={};const Gj=new Map;function $j(e,t={}){const n=JSON.stringify([e,t]);let r=Gj.get(n);return void 0===r&&(r=new Intl.DateTimeFormat(e,t),Gj.set(n,r)),r}const qj=new Map;const zj=new Map;let Wj=null;const Yj=new Map;function Hj(e){let t=Yj.get(e);return void 0===t&&(t=new Intl.DateTimeFormat(e).resolvedOptions(),Yj.set(e,t)),t}const Qj=new Map;function Zj(e,t,n,r){const a=e.listingMode();return"error"===a?null:"en"===a?n(t):r(t)}class Xj{constructor(e,t,n){this.padTo=n.padTo||0,this.floor=n.floor||!1;const{padTo:r,floor:a,...i}=n;if(!t||Object.keys(i).length>0){const t={useGrouping:!1,...n};n.padTo>0&&(t.minimumIntegerDigits=n.padTo),this.inf=function(e,t={}){const n=JSON.stringify([e,t]);let r=qj.get(n);return void 0===r&&(r=new Intl.NumberFormat(e,t),qj.set(n,r)),r}(e,t)}}format(e){if(this.inf){const t=this.floor?Math.floor(e):e;return this.inf.format(t)}return qP(this.floor?Math.floor(e):HP(e,3),this.padTo)}}class eP{constructor(e,t,n){let r;if(this.opts=n,this.originalZone=void 0,this.opts.timeZone)this.dt=e;else if("fixed"===e.zone.type){const t=e.offset/60*-1,n=t>=0?`Etc/GMT+${t}`:`Etc/GMT${t}`;0!==e.offset&&Uj.create(n).valid?(r=n,this.dt=e):(r="UTC",this.dt=0===e.offset?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else"system"===e.zone.type?this.dt=e:"iana"===e.zone.type?(this.dt=e,r=e.zone.name):(r="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const a={...this.opts};a.timeZone=a.timeZone||r,this.dtf=$j(t,a)}format(){return this.originalZone?this.formatToParts().map((({value:e})=>e)).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map((e=>{if("timeZoneName"===e.type){const t=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...e,value:t}}return e})):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class tP{constructor(e,t,n){this.opts={style:"long",...n},!t&&BP()&&(this.rtf=function(e,t={}){const{base:n,...r}=t,a=JSON.stringify([e,r]);let i=zj.get(a);return void 0===i&&(i=new Intl.RelativeTimeFormat(e,t),zj.set(a,i)),i}(e,n))}format(e,t){return this.rtf?this.rtf.format(e,t):function(e,t,n="always",r=!1){const a={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},i=-1===["hours","minutes","seconds"].indexOf(e);if("auto"===n&&i){const n="days"===e;switch(t){case 1:return n?"tomorrow":`next ${a[e][0]}`;case-1:return n?"yesterday":`last ${a[e][0]}`;case 0:return n?"today":`this ${a[e][0]}`}}const o=Object.is(t,-0)||t<0,s=Math.abs(t),l=1===s,c=a[e],u=r?l?c[1]:c[2]||c[1]:l?a[e][0]:e;return o?`${s} ${u} ago`:`in ${s} ${u}`}(t,e,this.opts.numeric,"long"!==this.opts.style)}formatToParts(e,t){return this.rtf?this.rtf.formatToParts(e,t):[]}}const nP={firstDay:1,minimalDays:4,weekend:[6,7]};class rP{static fromOpts(e){return rP.create(e.locale,e.numberingSystem,e.outputCalendar,e.weekSettings,e.defaultToEN)}static create(e,t,n,r,a=!1){const i=e||SP.defaultLocale,o=i||(a?"en-US":Wj||(Wj=(new Intl.DateTimeFormat).resolvedOptions().locale,Wj)),s=t||SP.defaultNumberingSystem,l=n||SP.defaultOutputCalendar,c=GP(r)||SP.defaultWeekSettings;return new rP(o,s,l,c,i)}static resetCache(){Wj=null,Gj.clear(),qj.clear(),zj.clear(),Yj.clear(),Qj.clear()}static fromObject({locale:e,numberingSystem:t,outputCalendar:n,weekSettings:r}={}){return rP.create(e,t,n,r)}constructor(e,t,n,r,a){const[i,o,s]=function(e){const t=e.indexOf("-x-");-1!==t&&(e=e.substring(0,t));const n=e.indexOf("-u-");if(-1===n)return[e];{let t,r;try{t=$j(e).resolvedOptions(),r=e}catch(a){const i=e.substring(0,n);t=$j(i).resolvedOptions(),r=i}const{numberingSystem:a,calendar:i}=t;return[r,a,i]}}(e);this.locale=i,this.numberingSystem=t||o||null,this.outputCalendar=n||s||null,this.weekSettings=r,this.intl=function(e,t,n){return n||t?(e.includes("-u-")||(e+="-u"),n&&(e+=`-ca-${n}`),t&&(e+=`-nu-${t}`),e):e}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=a,this.fastNumbersCached=null}get fastNumbers(){var e;return null==this.fastNumbersCached&&(this.fastNumbersCached=(!(e=this).numberingSystem||"latn"===e.numberingSystem)&&("latn"===e.numberingSystem||!e.locale||e.locale.startsWith("en")||"latn"===Hj(e.locale).numberingSystem)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),t=!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar);return e&&t?"en":"intl"}clone(e){return e&&0!==Object.getOwnPropertyNames(e).length?rP.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,GP(e.weekSettings)||this.weekSettings,e.defaultToEN||!1):this}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,t=!1){return Zj(this,e,hD,(()=>{const n=t?{month:e,day:"numeric"}:{month:e},r=t?"format":"standalone";return this.monthsCache[r][e]||(this.monthsCache[r][e]=function(e){const t=[];for(let n=1;n<=12;n++){const r=pL.utc(2009,n,1);t.push(e(r))}return t}((e=>this.extract(e,n,"month")))),this.monthsCache[r][e]}))}weekdays(e,t=!1){return Zj(this,e,gD,(()=>{const n=t?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},r=t?"format":"standalone";return this.weekdaysCache[r][e]||(this.weekdaysCache[r][e]=function(e){const t=[];for(let n=1;n<=7;n++){const r=pL.utc(2016,11,13+n);t.push(e(r))}return t}((e=>this.extract(e,n,"weekday")))),this.weekdaysCache[r][e]}))}meridiems(){return Zj(this,void 0,(()=>bD),(()=>{if(!this.meridiemCache){const e={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[pL.utc(2016,11,13,9),pL.utc(2016,11,13,19)].map((t=>this.extract(t,e,"dayperiod")))}return this.meridiemCache}))}eras(e){return Zj(this,e,ED,(()=>{const t={era:e};return this.eraCache[e]||(this.eraCache[e]=[pL.utc(-40,1,1),pL.utc(2017,1,1)].map((e=>this.extract(e,t,"era")))),this.eraCache[e]}))}extract(e,t,n){const r=this.dtFormatter(e,t).formatToParts().find((e=>e.type.toLowerCase()===n));return r?r.value:null}numberFormatter(e={}){return new Xj(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,t={}){return new eP(e,this.intl,t)}relFormatter(e={}){return new tP(this.intl,this.isEnglish(),e)}listFormatter(e={}){return function(e,t={}){const n=JSON.stringify([e,t]);let r=Jj[n];return r||(r=new Intl.ListFormat(e,t),Jj[n]=r),r}(this.intl,e)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||Hj(this.intl).locale.startsWith("en-us")}getWeekSettings(){return this.weekSettings?this.weekSettings:VP()?function(e){let t=Qj.get(e);if(!t){const n=new Intl.Locale(e);t="getWeekInfo"in n?n.getWeekInfo():n.weekInfo,"minimalDays"in t||(t={...nP,...t}),Qj.set(e,t)}return t}(this.locale):nP}getStartOfWeek(){return this.getWeekSettings().firstDay}getMinDaysInFirstWeek(){return this.getWeekSettings().minimalDays}getWeekendDays(){return this.getWeekSettings().weekend}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}toString(){return`Locale(${this.locale}, ${this.numberingSystem}, ${this.outputCalendar})`}}let aP=null;class iP extends Nj{static get utcInstance(){return null===aP&&(aP=new iP(0)),aP}static instance(e){return 0===e?iP.utcInstance:new iP(e)}static parseSpecifier(e){if(e){const t=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(t)return new iP(iD(t[1],t[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":`UTC${lD(this.fixed,"narrow")}`}get ianaName(){return 0===this.fixed?"Etc/UTC":`Etc/GMT${lD(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,t){return lD(this.fixed,t)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return"fixed"===e.type&&e.fixed===this.fixed}get isValid(){return!0}}class oP extends Nj{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function sP(e,t){if(LP(e)||null===e)return t;if(e instanceof Nj)return e;if("string"==typeof e){const n=e.toLowerCase();return"default"===n?t:"local"===n||"system"===n?Mj.instance:"utc"===n||"gmt"===n?iP.utcInstance:iP.parseSpecifier(n)||Uj.create(e)}return MP(e)?iP.instance(e):"object"==typeof e&&"offset"in e&&"function"==typeof e.offset?e:new oP(e)}const lP={arab:"[٠-٩]",arabext:"[۰-۹]",bali:"[᭐-᭙]",beng:"[০-৯]",deva:"[०-९]",fullwide:"[０-９]",gujr:"[૦-૯]",hanidec:"[〇|一|二|三|四|五|六|七|八|九]",khmr:"[០-៩]",knda:"[೦-೯]",laoo:"[໐-໙]",limb:"[᥆-᥏]",mlym:"[൦-൯]",mong:"[᠐-᠙]",mymr:"[၀-၉]",orya:"[୦-୯]",tamldec:"[௦-௯]",telu:"[౦-౯]",thai:"[๐-๙]",tibt:"[༠-༩]",latn:"\\d"},cP={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},uP=lP.hanidec.replace(/[\[|\]]/g,"").split("");const dP=new Map;function pP({numberingSystem:e},t=""){const n=e||"latn";let r=dP.get(n);void 0===r&&(r=new Map,dP.set(n,r));let a=r.get(t);return void 0===a&&(a=new RegExp(`${lP[n]}${t}`),r.set(t,a)),a}let hP,mP=()=>Date.now(),fP="system",yP=null,gP=null,bP=null,vP=60,wP=null;class SP{static get now(){return mP}static set now(e){mP=e}static set defaultZone(e){fP=e}static get defaultZone(){return sP(fP,Mj.instance)}static get defaultLocale(){return yP}static set defaultLocale(e){yP=e}static get defaultNumberingSystem(){return gP}static set defaultNumberingSystem(e){gP=e}static get defaultOutputCalendar(){return bP}static set defaultOutputCalendar(e){bP=e}static get defaultWeekSettings(){return wP}static set defaultWeekSettings(e){wP=GP(e)}static get twoDigitCutoffYear(){return vP}static set twoDigitCutoffYear(e){vP=e%100}static get throwOnInvalid(){return hP}static set throwOnInvalid(e){hP=e}static resetCaches(){rP.resetCache(),Uj.resetCache(),pL.resetCache(),dP.clear()}}class EP{constructor(e,t){this.reason=e,this.explanation=t}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const xP=[0,31,59,90,120,151,181,212,243,273,304,334],_P=[0,31,60,91,121,152,182,213,244,274,305,335];function kP(e,t){return new EP("unit out of range",`you specified ${t} (of type ${typeof t}) as a ${e}, which is invalid`)}function IP(e,t,n){const r=new Date(Date.UTC(e,t-1,n));e<100&&e>=0&&r.setUTCFullYear(r.getUTCFullYear()-1900);const a=r.getUTCDay();return 0===a?7:a}function TP(e,t,n){return n+(QP(e)?_P:xP)[t-1]}function AP(e,t){const n=QP(e)?_P:xP,r=n.findIndex((e=>e<t));return{month:r+1,day:t-n[r]}}function OP(e,t){return(e-t+7)%7+1}function KP(e,t=4,n=1){const{year:r,month:a,day:i}=e,o=TP(r,a,i),s=OP(IP(r,a,i),n);let l,c=Math.floor((o-s+14-t)/7);return c<1?(l=r-1,c=nD(l,t,n)):c>nD(r,t,n)?(l=r+1,c=1):l=r,{weekYear:l,weekNumber:c,weekday:s,...cD(e)}}function CP(e,t=4,n=1){const{weekYear:r,weekNumber:a,weekday:i}=e,o=OP(IP(r,1,t),n),s=ZP(r);let l,c=7*a+i-o-7+t;c<1?(l=r-1,c+=ZP(l)):c>s?(l=r+1,c-=ZP(r)):l=r;const{month:u,day:d}=AP(l,c);return{year:l,month:u,day:d,...cD(e)}}function RP(e){const{year:t,month:n,day:r}=e;return{year:t,ordinal:TP(t,n,r),...cD(e)}}function jP(e){const{year:t,ordinal:n}=e,{month:r,day:a}=AP(t,n);return{year:t,month:r,day:a,...cD(e)}}function PP(e,t){if(!LP(e.localWeekday)||!LP(e.localWeekNumber)||!LP(e.localWeekYear)){if(!LP(e.weekday)||!LP(e.weekNumber)||!LP(e.weekYear))throw new sj("Cannot mix locale-based week fields with ISO-based week fields");return LP(e.localWeekday)||(e.weekday=e.localWeekday),LP(e.localWeekNumber)||(e.weekNumber=e.localWeekNumber),LP(e.localWeekYear)||(e.weekYear=e.localWeekYear),delete e.localWeekday,delete e.localWeekNumber,delete e.localWeekYear,{minDaysInFirstWeek:t.getMinDaysInFirstWeek(),startOfWeek:t.getStartOfWeek()}}return{minDaysInFirstWeek:4,startOfWeek:1}}function DP(e){const t=FP(e.year),n=$P(e.month,1,12),r=$P(e.day,1,XP(e.year,e.month));return t?n?!r&&kP("day",e.day):kP("month",e.month):kP("year",e.year)}function NP(e){const{hour:t,minute:n,second:r,millisecond:a}=e,i=$P(t,0,23)||24===t&&0===n&&0===r&&0===a,o=$P(n,0,59),s=$P(r,0,59),l=$P(a,0,999);return i?o?s?!l&&kP("millisecond",a):kP("second",r):kP("minute",n):kP("hour",t)}function LP(e){return void 0===e}function MP(e){return"number"==typeof e}function FP(e){return"number"==typeof e&&e%1==0}function BP(){try{return"undefined"!=typeof Intl&&!!Intl.RelativeTimeFormat}catch(e){return!1}}function VP(){try{return"undefined"!=typeof Intl&&!!Intl.Locale&&("weekInfo"in Intl.Locale.prototype||"getWeekInfo"in Intl.Locale.prototype)}catch(e){return!1}}function UP(e,t,n){if(0!==e.length)return e.reduce(((e,r)=>{const a=[t(r),r];return e&&n(e[0],a[0])===e[0]?e:a}),null)[1]}function JP(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function GP(e){if(null==e)return null;if("object"!=typeof e)throw new cj("Week settings must be an object");if(!$P(e.firstDay,1,7)||!$P(e.minimalDays,1,7)||!Array.isArray(e.weekend)||e.weekend.some((e=>!$P(e,1,7))))throw new cj("Invalid week settings");return{firstDay:e.firstDay,minimalDays:e.minimalDays,weekend:Array.from(e.weekend)}}function $P(e,t,n){return FP(e)&&e>=t&&e<=n}function qP(e,t=2){let n;return n=e<0?"-"+(""+-e).padStart(t,"0"):(""+e).padStart(t,"0"),n}function zP(e){return LP(e)||null===e||""===e?void 0:parseInt(e,10)}function WP(e){return LP(e)||null===e||""===e?void 0:parseFloat(e)}function YP(e){if(!LP(e)&&null!==e&&""!==e){const t=1e3*parseFloat("0."+e);return Math.floor(t)}}function HP(e,t,n=!1){const r=10**t;return(n?Math.trunc:Math.round)(e*r)/r}function QP(e){return e%4==0&&(e%100!=0||e%400==0)}function ZP(e){return QP(e)?366:365}function XP(e,t){const n=function(e,t){return e-t*Math.floor(e/t)}(t-1,12)+1;return 2===n?QP(e+(t-n)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][n-1]}function eD(e){let t=Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second,e.millisecond);return e.year<100&&e.year>=0&&(t=new Date(t),t.setUTCFullYear(e.year,e.month-1,e.day)),+t}function tD(e,t,n){return-OP(IP(e,1,t),n)+t-1}function nD(e,t=4,n=1){const r=tD(e,t,n),a=tD(e+1,t,n);return(ZP(e)-r+a)/7}function rD(e){return e>99?e:e>SP.twoDigitCutoffYear?1900+e:2e3+e}function aD(e,t,n,r=null){const a=new Date(e),i={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};r&&(i.timeZone=r);const o={timeZoneName:t,...i},s=new Intl.DateTimeFormat(n,o).formatToParts(a).find((e=>"timezonename"===e.type.toLowerCase()));return s?s.value:null}function iD(e,t){let n=parseInt(e,10);Number.isNaN(n)&&(n=0);const r=parseInt(t,10)||0;return 60*n+(n<0||Object.is(n,-0)?-r:r)}function oD(e){const t=Number(e);if("boolean"==typeof e||""===e||Number.isNaN(t))throw new cj(`Invalid unit value ${e}`);return t}function sD(e,t){const n={};for(const r in e)if(JP(e,r)){const a=e[r];if(null==a)continue;n[t(r)]=oD(a)}return n}function lD(e,t){const n=Math.trunc(Math.abs(e/60)),r=Math.trunc(Math.abs(e%60)),a=e>=0?"+":"-";switch(t){case"short":return`${a}${qP(n,2)}:${qP(r,2)}`;case"narrow":return`${a}${n}${r>0?`:${r}`:""}`;case"techie":return`${a}${qP(n,2)}${qP(r,2)}`;default:throw new RangeError(`Value format ${t} is out of range for property format`)}}function cD(e){return function(e,t){return t.reduce(((t,n)=>(t[n]=e[n],t)),{})}(e,["hour","minute","second","millisecond"])}const uD=["January","February","March","April","May","June","July","August","September","October","November","December"],dD=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],pD=["J","F","M","A","M","J","J","A","S","O","N","D"];function hD(e){switch(e){case"narrow":return[...pD];case"short":return[...dD];case"long":return[...uD];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const mD=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],fD=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],yD=["M","T","W","T","F","S","S"];function gD(e){switch(e){case"narrow":return[...yD];case"short":return[...fD];case"long":return[...mD];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const bD=["AM","PM"],vD=["Before Christ","Anno Domini"],wD=["BC","AD"],SD=["B","A"];function ED(e){switch(e){case"narrow":return[...SD];case"short":return[...wD];case"long":return[...vD];default:return null}}function xD(e,t){let n="";for(const r of e)r.literal?n+=r.val:n+=t(r.val);return n}const _D={D:mj,DD:fj,DDD:gj,DDDD:bj,t:vj,tt:wj,ttt:Sj,tttt:Ej,T:xj,TT:_j,TTT:kj,TTTT:Ij,f:Tj,ff:Oj,fff:Rj,ffff:Pj,F:Aj,FF:Kj,FFF:jj,FFFF:Dj};class kD{static create(e,t={}){return new kD(e,t)}static parseFormat(e){let t=null,n="",r=!1;const a=[];for(let i=0;i<e.length;i++){const o=e.charAt(i);"'"===o?(n.length>0&&a.push({literal:r||/^\s+$/.test(n),val:n}),t=null,n="",r=!r):r||o===t?n+=o:(n.length>0&&a.push({literal:/^\s+$/.test(n),val:n}),n=o,t=o)}return n.length>0&&a.push({literal:r||/^\s+$/.test(n),val:n}),a}static macroTokenToFormatOpts(e){return _D[e]}constructor(e,t){this.opts=t,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,t){null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem());return this.systemLoc.dtFormatter(e,{...this.opts,...t}).format()}dtFormatter(e,t={}){return this.loc.dtFormatter(e,{...this.opts,...t})}formatDateTime(e,t){return this.dtFormatter(e,t).format()}formatDateTimeParts(e,t){return this.dtFormatter(e,t).formatToParts()}formatInterval(e,t){return this.dtFormatter(e.start,t).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,t){return this.dtFormatter(e,t).resolvedOptions()}num(e,t=0){if(this.opts.forceSimple)return qP(e,t);const n={...this.opts};return t>0&&(n.padTo=t),this.loc.numberFormatter(n).format(e)}formatDateTimeFromString(e,t){const n="en"===this.loc.listingMode(),r=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,a=(t,n)=>this.loc.extract(e,t,n),i=t=>e.isOffsetFixed&&0===e.offset&&t.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,t.format):"",o=()=>n?function(e){return bD[e.hour<12?0:1]}(e):a({hour:"numeric",hourCycle:"h12"},"dayperiod"),s=(t,r)=>n?function(e,t){return hD(t)[e.month-1]}(e,t):a(r?{month:t}:{month:t,day:"numeric"},"month"),l=(t,r)=>n?function(e,t){return gD(t)[e.weekday-1]}(e,t):a(r?{weekday:t}:{weekday:t,month:"long",day:"numeric"},"weekday"),c=t=>{const n=kD.macroTokenToFormatOpts(t);return n?this.formatWithSystemDefault(e,n):t},u=t=>n?function(e,t){return ED(t)[e.year<0?0:1]}(e,t):a({era:t},"era");return xD(kD.parseFormat(t),(t=>{switch(t){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12==0?12:e.hour%12);case"hh":return this.num(e.hour%12==0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return i({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return i({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return i({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return o();case"d":return r?a({day:"numeric"},"day"):this.num(e.day);case"dd":return r?a({day:"2-digit"},"day"):this.num(e.day,2);case"c":case"E":return this.num(e.weekday);case"ccc":return l("short",!0);case"cccc":return l("long",!0);case"ccccc":return l("narrow",!0);case"EEE":return l("short",!1);case"EEEE":return l("long",!1);case"EEEEE":return l("narrow",!1);case"L":return r?a({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return r?a({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return s("short",!0);case"LLLL":return s("long",!0);case"LLLLL":return s("narrow",!0);case"M":return r?a({month:"numeric"},"month"):this.num(e.month);case"MM":return r?a({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return s("short",!1);case"MMMM":return s("long",!1);case"MMMMM":return s("narrow",!1);case"y":return r?a({year:"numeric"},"year"):this.num(e.year);case"yy":return r?a({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return r?a({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return r?a({year:"numeric"},"year"):this.num(e.year,6);case"G":return u("short");case"GG":return u("long");case"GGGGG":return u("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"n":return this.num(e.localWeekNumber);case"nn":return this.num(e.localWeekNumber,2);case"ii":return this.num(e.localWeekYear.toString().slice(-2),2);case"iiii":return this.num(e.localWeekYear,4);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return c(t)}}))}formatDurationFromString(e,t){const n=e=>{switch(e[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},r=kD.parseFormat(t),a=r.reduce(((e,{literal:t,val:n})=>t?e:e.concat(n)),[]),i=e.shiftTo(...a.map(n).filter((e=>e)));return xD(r,(e=>t=>{const r=n(t);return r?this.num(e.get(r),t.length):t})(i))}}const ID=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function TD(...e){const t=e.reduce(((e,t)=>e+t.source),"");return RegExp(`^${t}$`)}function AD(...e){return t=>e.reduce((([e,n,r],a)=>{const[i,o,s]=a(t,r);return[{...e,...i},o||n,s]}),[{},null,1]).slice(0,2)}function OD(e,...t){if(null==e)return[null,null];for(const[n,r]of t){const t=n.exec(e);if(t)return r(t)}return[null,null]}function KD(...e){return(t,n)=>{const r={};let a;for(a=0;a<e.length;a++)r[e[a]]=zP(t[n+a]);return[r,null,n+a]}}const CD=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,RD=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,jD=RegExp(`${RD.source}${`(?:${CD.source}?(?:\\[(${ID.source})\\])?)?`}`),PD=RegExp(`(?:T${jD.source})?`),DD=KD("weekYear","weekNumber","weekDay"),ND=KD("year","ordinal"),LD=RegExp(`${RD.source} ?(?:${CD.source}|(${ID.source}))?`),MD=RegExp(`(?: ${LD.source})?`);function FD(e,t,n){const r=e[t];return LP(r)?n:zP(r)}function BD(e,t){return[{hours:FD(e,t,0),minutes:FD(e,t+1,0),seconds:FD(e,t+2,0),milliseconds:YP(e[t+3])},null,t+4]}function VD(e,t){const n=!e[t]&&!e[t+1],r=iD(e[t+1],e[t+2]);return[{},n?null:iP.instance(r),t+3]}function UD(e,t){return[{},e[t]?Uj.create(e[t]):null,t+1]}const JD=RegExp(`^T?${RD.source}$`),GD=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function $D(e){const[t,n,r,a,i,o,s,l,c]=e,u="-"===t[0],d=l&&"-"===l[0],p=(e,t=!1)=>void 0!==e&&(t||e&&u)?-e:e;return[{years:p(WP(n)),months:p(WP(r)),weeks:p(WP(a)),days:p(WP(i)),hours:p(WP(o)),minutes:p(WP(s)),seconds:p(WP(l),"-0"===l),milliseconds:p(YP(c),d)}]}const qD={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function zD(e,t,n,r,a,i,o){const s={year:2===t.length?rD(zP(t)):zP(t),month:dD.indexOf(n)+1,day:zP(r),hour:zP(a),minute:zP(i)};return o&&(s.second=zP(o)),e&&(s.weekday=e.length>3?mD.indexOf(e)+1:fD.indexOf(e)+1),s}const WD=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function YD(e){const[,t,n,r,a,i,o,s,l,c,u,d]=e,p=zD(t,a,r,n,i,o,s);let h;return h=l?qD[l]:c?0:iD(u,d),[p,new iP(h)]}const HD=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,QD=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,ZD=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function XD(e){const[,t,n,r,a,i,o,s]=e;return[zD(t,a,r,n,i,o,s),iP.utcInstance]}function eN(e){const[,t,n,r,a,i,o,s]=e;return[zD(t,s,n,r,a,i,o),iP.utcInstance]}const tN=TD(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,PD),nN=TD(/(\d{4})-?W(\d\d)(?:-?(\d))?/,PD),rN=TD(/(\d{4})-?(\d{3})/,PD),aN=TD(jD),iN=AD((function(e,t){return[{year:FD(e,t),month:FD(e,t+1,1),day:FD(e,t+2,1)},null,t+3]}),BD,VD,UD),oN=AD(DD,BD,VD,UD),sN=AD(ND,BD,VD,UD),lN=AD(BD,VD,UD);const cN=AD(BD);const uN=TD(/(\d{4})-(\d\d)-(\d\d)/,MD),dN=TD(LD),pN=AD(BD,VD,UD);const hN={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},mN={years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6},...hN},fN={years:{quarters:4,months:12,weeks:52.1775,days:365.2425,hours:8765.82,minutes:525949.2,seconds:525949.2*60,milliseconds:525949.2*60*1e3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:525949.2*60/4,milliseconds:7889237999.999999},months:{weeks:30.436875/7,days:30.436875,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746e3},...hN},yN=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],gN=yN.slice(0).reverse();function bN(e,t,n=!1){const r={values:n?t.values:{...e.values,...t.values||{}},loc:e.loc.clone(t.loc),conversionAccuracy:t.conversionAccuracy||e.conversionAccuracy,matrix:t.matrix||e.matrix};return new SN(r)}function vN(e,t){var n;let r=null!=(n=t.milliseconds)?n:0;for(const n of gN.slice(1))t[n]&&(r+=t[n]*e[n].milliseconds);return r}function wN(e,t){const n=vN(e,t)<0?-1:1;yN.reduceRight(((r,a)=>{if(LP(t[a]))return r;if(r){const i=t[r]*n,o=e[a][r],s=Math.floor(i/o);t[a]+=s*n,t[r]-=s*o*n}return a}),null),yN.reduce(((n,r)=>{if(LP(t[r]))return n;if(n){const a=t[n]%1;t[n]-=a,t[r]+=a*e[n][r]}return r}),null)}class SN{constructor(e){const t="longterm"===e.conversionAccuracy||!1;let n=t?fN:mN;e.matrix&&(n=e.matrix),this.values=e.values,this.loc=e.loc||rP.create(),this.conversionAccuracy=t?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=n,this.isLuxonDuration=!0}static fromMillis(e,t){return SN.fromObject({milliseconds:e},t)}static fromObject(e,t={}){if(null==e||"object"!=typeof e)throw new cj("Duration.fromObject: argument expected to be an object, got "+(null===e?"null":typeof e));return new SN({values:sD(e,SN.normalizeUnit),loc:rP.fromObject(t),conversionAccuracy:t.conversionAccuracy,matrix:t.matrix})}static fromDurationLike(e){if(MP(e))return SN.fromMillis(e);if(SN.isDuration(e))return e;if("object"==typeof e)return SN.fromObject(e);throw new cj(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,t){const[n]=function(e){return OD(e,[GD,$D])}(e);return n?SN.fromObject(n,t):SN.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,t){const[n]=function(e){return OD(e,[JD,cN])}(e);return n?SN.fromObject(n,t):SN.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,t=null){if(!e)throw new cj("need to specify a reason the Duration is invalid");const n=e instanceof EP?e:new EP(e,t);if(SP.throwOnInvalid)throw new oj(n);return new SN({invalid:n})}static normalizeUnit(e){const t={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e?e.toLowerCase():e];if(!t)throw new lj(e);return t}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,t={}){const n={...t,floor:!1!==t.round&&!1!==t.floor};return this.isValid?kD.create(this.loc,n).formatDurationFromString(this,e):"Invalid Duration"}toHuman(e={}){if(!this.isValid)return"Invalid Duration";const t=yN.map((t=>{const n=this.values[t];return LP(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:t.slice(0,-1)}).format(n)})).filter((e=>e));return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(t)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return 0!==this.years&&(e+=this.years+"Y"),0===this.months&&0===this.quarters||(e+=this.months+3*this.quarters+"M"),0!==this.weeks&&(e+=this.weeks+"W"),0!==this.days&&(e+=this.days+"D"),0===this.hours&&0===this.minutes&&0===this.seconds&&0===this.milliseconds||(e+="T"),0!==this.hours&&(e+=this.hours+"H"),0!==this.minutes&&(e+=this.minutes+"M"),0===this.seconds&&0===this.milliseconds||(e+=HP(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===e&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const t=this.toMillis();if(t<0||t>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e,includeOffset:!1};return pL.fromMillis(t,{zone:"UTC"}).toISOTime(e)}toJSON(){return this.toISO()}toString(){return this.toISO()}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Duration { values: ${JSON.stringify(this.values)} }`:`Duration { Invalid, reason: ${this.invalidReason} }`}toMillis(){return this.isValid?vN(this.matrix,this.values):NaN}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const t=SN.fromDurationLike(e),n={};for(const e of yN)(JP(t.values,e)||JP(this.values,e))&&(n[e]=t.get(e)+this.get(e));return bN(this,{values:n},!0)}minus(e){if(!this.isValid)return this;const t=SN.fromDurationLike(e);return this.plus(t.negate())}mapUnits(e){if(!this.isValid)return this;const t={};for(const n of Object.keys(this.values))t[n]=oD(e(this.values[n],n));return bN(this,{values:t},!0)}get(e){return this[SN.normalizeUnit(e)]}set(e){if(!this.isValid)return this;return bN(this,{values:{...this.values,...sD(e,SN.normalizeUnit)}})}reconfigure({locale:e,numberingSystem:t,conversionAccuracy:n,matrix:r}={}){return bN(this,{loc:this.loc.clone({locale:e,numberingSystem:t}),matrix:r,conversionAccuracy:n})}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return wN(this.matrix,e),bN(this,{values:e},!0)}rescale(){if(!this.isValid)return this;return bN(this,{values:function(e){const t={};for(const[n,r]of Object.entries(e))0!==r&&(t[n]=r);return t}(this.normalize().shiftToAll().toObject())},!0)}shiftTo(...e){if(!this.isValid)return this;if(0===e.length)return this;e=e.map((e=>SN.normalizeUnit(e)));const t={},n={},r=this.toObject();let a;for(const i of yN)if(e.indexOf(i)>=0){a=i;let e=0;for(const t in n)e+=this.matrix[t][i]*n[t],n[t]=0;MP(r[i])&&(e+=r[i]);const o=Math.trunc(e);t[i]=o,n[i]=(1e3*e-1e3*o)/1e3}else MP(r[i])&&(n[i]=r[i]);for(const e in n)0!==n[e]&&(t[a]+=e===a?n[e]:n[e]/this.matrix[a][e]);return wN(this.matrix,t),bN(this,{values:t},!0)}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const t of Object.keys(this.values))e[t]=0===this.values[t]?0:-this.values[t];return bN(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid)return!1;if(!this.loc.equals(e.loc))return!1;for(const r of yN)if(t=this.values[r],n=e.values[r],!(void 0===t||0===t?void 0===n||0===n:t===n))return!1;var t,n;return!0}}const EN="Invalid Interval";class xN{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,t=null){if(!e)throw new cj("need to specify a reason the Interval is invalid");const n=e instanceof EP?e:new EP(e,t);if(SP.throwOnInvalid)throw new ij(n);return new xN({invalid:n})}static fromDateTimes(e,t){const n=hL(e),r=hL(t),a=function(e,t){return e&&e.isValid?t&&t.isValid?t<e?xN.invalid("end before start",`The end of an interval must be after its start, but you had start=${e.toISO()} and end=${t.toISO()}`):null:xN.invalid("missing or invalid end"):xN.invalid("missing or invalid start")}(n,r);return null==a?new xN({start:n,end:r}):a}static after(e,t){const n=SN.fromDurationLike(t),r=hL(e);return xN.fromDateTimes(r,r.plus(n))}static before(e,t){const n=SN.fromDurationLike(t),r=hL(e);return xN.fromDateTimes(r.minus(n),r)}static fromISO(e,t){const[n,r]=(e||"").split("/",2);if(n&&r){let e,a,i,o;try{e=pL.fromISO(n,t),a=e.isValid}catch(r){a=!1}try{i=pL.fromISO(r,t),o=i.isValid}catch(r){o=!1}if(a&&o)return xN.fromDateTimes(e,i);if(a){const n=SN.fromISO(r,t);if(n.isValid)return xN.after(e,n)}else if(o){const e=SN.fromISO(n,t);if(e.isValid)return xN.before(i,e)}}return xN.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get lastDateTime(){return this.isValid&&this.e?this.e.minus(1):null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds",t){if(!this.isValid)return NaN;const n=this.start.startOf(e,t);let r;return r=null!=t&&t.useLocaleWeeks?this.end.reconfigure({locale:n.locale}):this.end,r=r.startOf(e,t),Math.floor(r.diff(n,e).get(e))+(r.valueOf()!==this.end.valueOf())}hasSame(e){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,e))}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return!!this.isValid&&this.s>e}isBefore(e){return!!this.isValid&&this.e<=e}contains(e){return!!this.isValid&&(this.s<=e&&this.e>e)}set({start:e,end:t}={}){return this.isValid?xN.fromDateTimes(e||this.s,t||this.e):this}splitAt(...e){if(!this.isValid)return[];const t=e.map(hL).filter((e=>this.contains(e))).sort(((e,t)=>e.toMillis()-t.toMillis())),n=[];let{s:r}=this,a=0;for(;r<this.e;){const e=t[a]||this.e,i=+e>+this.e?this.e:e;n.push(xN.fromDateTimes(r,i)),r=i,a+=1}return n}splitBy(e){const t=SN.fromDurationLike(e);if(!this.isValid||!t.isValid||0===t.as("milliseconds"))return[];let n,{s:r}=this,a=1;const i=[];for(;r<this.e;){const e=this.start.plus(t.mapUnits((e=>e*a)));n=+e>+this.e?this.e:e,i.push(xN.fromDateTimes(r,n)),r=n,a+=1}return i}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return!!this.isValid&&+this.e==+e.s}abutsEnd(e){return!!this.isValid&&+e.e==+this.s}engulfs(e){return!!this.isValid&&(this.s<=e.s&&this.e>=e.e)}equals(e){return!(!this.isValid||!e.isValid)&&(this.s.equals(e.s)&&this.e.equals(e.e))}intersection(e){if(!this.isValid)return this;const t=this.s>e.s?this.s:e.s,n=this.e<e.e?this.e:e.e;return t>=n?null:xN.fromDateTimes(t,n)}union(e){if(!this.isValid)return this;const t=this.s<e.s?this.s:e.s,n=this.e>e.e?this.e:e.e;return xN.fromDateTimes(t,n)}static merge(e){const[t,n]=e.sort(((e,t)=>e.s-t.s)).reduce((([e,t],n)=>t?t.overlaps(n)||t.abutsStart(n)?[e,t.union(n)]:[e.concat([t]),n]:[e,n]),[[],null]);return n&&t.push(n),t}static xor(e){let t=null,n=0;const r=[],a=e.map((e=>[{time:e.s,type:"s"},{time:e.e,type:"e"}])),i=Array.prototype.concat(...a).sort(((e,t)=>e.time-t.time));for(const e of i)n+="s"===e.type?1:-1,1===n?t=e.time:(t&&+t!=+e.time&&r.push(xN.fromDateTimes(t,e.time)),t=null);return xN.merge(r)}difference(...e){return xN.xor([this].concat(e)).map((e=>this.intersection(e))).filter((e=>e&&!e.isEmpty()))}toString(){return this.isValid?`[${this.s.toISO()} – ${this.e.toISO()})`:EN}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`Interval { start: ${this.s.toISO()}, end: ${this.e.toISO()} }`:`Interval { Invalid, reason: ${this.invalidReason} }`}toLocaleString(e=mj,t={}){return this.isValid?kD.create(this.s.loc.clone(t),e).formatInterval(this):EN}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:EN}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:EN}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:EN}toFormat(e,{separator:t=" – "}={}){return this.isValid?`${this.s.toFormat(e)}${t}${this.e.toFormat(e)}`:EN}toDuration(e,t){return this.isValid?this.e.diff(this.s,e,t):SN.invalid(this.invalidReason)}mapEndpoints(e){return xN.fromDateTimes(e(this.s),e(this.e))}}class _N{static hasDST(e=SP.defaultZone){const t=pL.now().setZone(e).set({month:12});return!e.isUniversal&&t.offset!==t.set({month:6}).offset}static isValidIANAZone(e){return Uj.isValidZone(e)}static normalizeZone(e){return sP(e,SP.defaultZone)}static getStartOfWeek({locale:e=null,locObj:t=null}={}){return(t||rP.create(e)).getStartOfWeek()}static getMinimumDaysInFirstWeek({locale:e=null,locObj:t=null}={}){return(t||rP.create(e)).getMinDaysInFirstWeek()}static getWeekendWeekdays({locale:e=null,locObj:t=null}={}){return(t||rP.create(e)).getWeekendDays().slice()}static months(e="long",{locale:t=null,numberingSystem:n=null,locObj:r=null,outputCalendar:a="gregory"}={}){return(r||rP.create(t,n,a)).months(e)}static monthsFormat(e="long",{locale:t=null,numberingSystem:n=null,locObj:r=null,outputCalendar:a="gregory"}={}){return(r||rP.create(t,n,a)).months(e,!0)}static weekdays(e="long",{locale:t=null,numberingSystem:n=null,locObj:r=null}={}){return(r||rP.create(t,n,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:t=null,numberingSystem:n=null,locObj:r=null}={}){return(r||rP.create(t,n,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return rP.create(e).meridiems()}static eras(e="short",{locale:t=null}={}){return rP.create(t,null,"gregory").eras(e)}static features(){return{relative:BP(),localeWeek:VP()}}}function kN(e,t){const n=e=>e.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),r=n(t)-n(e);return Math.floor(SN.fromMillis(r).as("days"))}function IN(e,t,n,r){let[a,i,o,s]=function(e,t,n){const r=[["years",(e,t)=>t.year-e.year],["quarters",(e,t)=>t.quarter-e.quarter+4*(t.year-e.year)],["months",(e,t)=>t.month-e.month+12*(t.year-e.year)],["weeks",(e,t)=>{const n=kN(e,t);return(n-n%7)/7}],["days",kN]],a={},i=e;let o,s;for(const[l,c]of r)n.indexOf(l)>=0&&(o=l,a[l]=c(e,t),s=i.plus(a),s>t?(a[l]--,(e=i.plus(a))>t&&(s=e,a[l]--,e=i.plus(a))):e=s);return[e,a,s,o]}(e,t,n);const l=t-a,c=n.filter((e=>["hours","minutes","seconds","milliseconds"].indexOf(e)>=0));0===c.length&&(o<t&&(o=a.plus({[s]:1})),o!==a&&(i[s]=(i[s]||0)+l/(o-a)));const u=SN.fromObject(i,r);return c.length>0?SN.fromMillis(l,r).shiftTo(...c).plus(u):u}function TN(e,t=(e=>e)){return{regex:e,deser:([e])=>t(function(e){let t=parseInt(e,10);if(isNaN(t)){t="";for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);if(-1!==e[n].search(lP.hanidec))t+=uP.indexOf(e[n]);else for(const e in cP){const[n,a]=cP[e];r>=n&&r<=a&&(t+=r-n)}}return parseInt(t,10)}return t}(e))}}const AN=`[ ${String.fromCharCode(160)}]`,ON=new RegExp(AN,"g");function KN(e){return e.replace(/\./g,"\\.?").replace(ON,AN)}function CN(e){return e.replace(/\./g,"").replace(ON," ").toLowerCase()}function RN(e,t){return null===e?null:{regex:RegExp(e.map(KN).join("|")),deser:([n])=>e.findIndex((e=>CN(n)===CN(e)))+t}}function jN(e,t){return{regex:e,deser:([,e,t])=>iD(e,t),groups:t}}function PN(e){return{regex:e,deser:([e])=>e}}const DN={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour12:{numeric:"h","2-digit":"hh"},hour24:{numeric:"H","2-digit":"HH"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};let NN=null;function LN(e,t){return Array.prototype.concat(...e.map((e=>function(e,t){if(e.literal)return e;const n=BN(kD.macroTokenToFormatOpts(e.val),t);return null==n||n.includes(void 0)?e:n}(e,t))))}class MN{constructor(e,t){if(this.locale=e,this.format=t,this.tokens=LN(kD.parseFormat(t),e),this.units=this.tokens.map((t=>function(e,t){const n=pP(t),r=pP(t,"{2}"),a=pP(t,"{3}"),i=pP(t,"{4}"),o=pP(t,"{6}"),s=pP(t,"{1,2}"),l=pP(t,"{1,3}"),c=pP(t,"{1,6}"),u=pP(t,"{1,9}"),d=pP(t,"{2,4}"),p=pP(t,"{4,6}"),h=e=>{return{regex:RegExp((t=e.val,t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"))),deser:([e])=>e,literal:!0};var t},m=(m=>{if(e.literal)return h(m);switch(m.val){case"G":return RN(t.eras("short"),0);case"GG":return RN(t.eras("long"),0);case"y":return TN(c);case"yy":case"kk":return TN(d,rD);case"yyyy":case"kkkk":return TN(i);case"yyyyy":return TN(p);case"yyyyyy":return TN(o);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return TN(s);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return TN(r);case"MMM":return RN(t.months("short",!0),1);case"MMMM":return RN(t.months("long",!0),1);case"LLL":return RN(t.months("short",!1),1);case"LLLL":return RN(t.months("long",!1),1);case"o":case"S":return TN(l);case"ooo":case"SSS":return TN(a);case"u":return PN(u);case"uu":return PN(s);case"uuu":case"E":case"c":return TN(n);case"a":return RN(t.meridiems(),0);case"EEE":return RN(t.weekdays("short",!1),1);case"EEEE":return RN(t.weekdays("long",!1),1);case"ccc":return RN(t.weekdays("short",!0),1);case"cccc":return RN(t.weekdays("long",!0),1);case"Z":case"ZZ":return jN(new RegExp(`([+-]${s.source})(?::(${r.source}))?`),2);case"ZZZ":return jN(new RegExp(`([+-]${s.source})(${r.source})?`),2);case"z":return PN(/[a-z_+-/]{1,256}?/i);case" ":return PN(/[^\S\n\r]/);default:return h(m)}})(e)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"};return m.token=e,m}(t,e))),this.disqualifyingUnit=this.units.find((e=>e.invalidReason)),!this.disqualifyingUnit){const[e,t]=function(e){const t=e.map((e=>e.regex)).reduce(((e,t)=>`${e}(${t.source})`),"");return[`^${t}$`,e]}(this.units);this.regex=RegExp(e,"i"),this.handlers=t}}explainFromTokens(e){if(this.isValid){const[t,n]=function(e,t,n){const r=e.match(t);if(r){const e={};let t=1;for(const a in n)if(JP(n,a)){const i=n[a],o=i.groups?i.groups+1:1;!i.literal&&i.token&&(e[i.token.val[0]]=i.deser(r.slice(t,t+o))),t+=o}return[r,e]}return[r,{}]}(e,this.regex,this.handlers),[r,a,i]=n?function(e){let t,n=null;LP(e.z)||(n=Uj.create(e.z)),LP(e.Z)||(n||(n=new iP(e.Z)),t=e.Z),LP(e.q)||(e.M=3*(e.q-1)+1),LP(e.h)||(e.h<12&&1===e.a?e.h+=12:12===e.h&&0===e.a&&(e.h=0)),0===e.G&&e.y&&(e.y=-e.y),LP(e.u)||(e.S=YP(e.u));const r=Object.keys(e).reduce(((t,n)=>{const r=(e=>{switch(e){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}})(n);return r&&(t[r]=e[n]),t}),{});return[r,n,t]}(n):[null,null,void 0];if(JP(n,"a")&&JP(n,"H"))throw new sj("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:this.tokens,regex:this.regex,rawMatches:t,matches:n,result:r,zone:a,specificOffset:i}}return{input:e,tokens:this.tokens,invalidReason:this.invalidReason}}get isValid(){return!this.disqualifyingUnit}get invalidReason(){return this.disqualifyingUnit?this.disqualifyingUnit.invalidReason:null}}function FN(e,t,n){return new MN(e,n).explainFromTokens(t)}function BN(e,t){if(!e)return null;const n=kD.create(t,e).dtFormatter((NN||(NN=pL.fromMillis(1555555555555)),NN)),r=n.formatToParts(),a=n.resolvedOptions();return r.map((t=>function(e,t,n){const{type:r,value:a}=e;if("literal"===r){const e=/^\s+$/.test(a);return{literal:!e,val:e?" ":a}}const i=t[r];let o=r;"hour"===r&&(o=null!=t.hour12?t.hour12?"hour12":"hour24":null!=t.hourCycle?"h11"===t.hourCycle||"h12"===t.hourCycle?"hour12":"hour24":n.hour12?"hour12":"hour24");let s=DN[o];if("object"==typeof s&&(s=s[i]),s)return{literal:!1,val:s}}(t,e,a)))}const VN="Invalid DateTime";function UN(e){return new EP("unsupported zone",`the zone "${e.name}" is not supported`)}function JN(e){return null===e.weekData&&(e.weekData=KP(e.c)),e.weekData}function GN(e){return null===e.localWeekData&&(e.localWeekData=KP(e.c,e.loc.getMinDaysInFirstWeek(),e.loc.getStartOfWeek())),e.localWeekData}function $N(e,t){const n={ts:e.ts,zone:e.zone,c:e.c,o:e.o,loc:e.loc,invalid:e.invalid};return new pL({...n,...t,old:n})}function qN(e,t,n){let r=e-60*t*1e3;const a=n.offset(r);if(t===a)return[r,t];r-=60*(a-t)*1e3;const i=n.offset(r);return a===i?[r,a]:[e-60*Math.min(a,i)*1e3,Math.max(a,i)]}function zN(e,t){const n=new Date(e+=60*t*1e3);return{year:n.getUTCFullYear(),month:n.getUTCMonth()+1,day:n.getUTCDate(),hour:n.getUTCHours(),minute:n.getUTCMinutes(),second:n.getUTCSeconds(),millisecond:n.getUTCMilliseconds()}}function WN(e,t,n){return qN(eD(e),t,n)}function YN(e,t){const n=e.o,r=e.c.year+Math.trunc(t.years),a=e.c.month+Math.trunc(t.months)+3*Math.trunc(t.quarters),i={...e.c,year:r,month:a,day:Math.min(e.c.day,XP(r,a))+Math.trunc(t.days)+7*Math.trunc(t.weeks)},o=SN.fromObject({years:t.years-Math.trunc(t.years),quarters:t.quarters-Math.trunc(t.quarters),months:t.months-Math.trunc(t.months),weeks:t.weeks-Math.trunc(t.weeks),days:t.days-Math.trunc(t.days),hours:t.hours,minutes:t.minutes,seconds:t.seconds,milliseconds:t.milliseconds}).as("milliseconds"),s=eD(i);let[l,c]=qN(s,n,e.zone);return 0!==o&&(l+=o,c=e.zone.offset(l)),{ts:l,o:c}}function HN(e,t,n,r,a,i){const{setZone:o,zone:s}=n;if(e&&0!==Object.keys(e).length||t){const r=t||s,a=pL.fromObject(e,{...n,zone:r,specificOffset:i});return o?a:a.setZone(s)}return pL.invalid(new EP("unparsable",`the input "${a}" can't be parsed as ${r}`))}function QN(e,t,n=!0){return e.isValid?kD.create(rP.create("en-US"),{allowZ:n,forceSimple:!0}).formatDateTimeFromString(e,t):null}function ZN(e,t){const n=e.c.year>9999||e.c.year<0;let r="";return n&&e.c.year>=0&&(r+="+"),r+=qP(e.c.year,n?6:4),t?(r+="-",r+=qP(e.c.month),r+="-",r+=qP(e.c.day)):(r+=qP(e.c.month),r+=qP(e.c.day)),r}function XN(e,t,n,r,a,i){let o=qP(e.c.hour);return t?(o+=":",o+=qP(e.c.minute),0===e.c.millisecond&&0===e.c.second&&n||(o+=":")):o+=qP(e.c.minute),0===e.c.millisecond&&0===e.c.second&&n||(o+=qP(e.c.second),0===e.c.millisecond&&r||(o+=".",o+=qP(e.c.millisecond,3))),a&&(e.isOffsetFixed&&0===e.offset&&!i?o+="Z":e.o<0?(o+="-",o+=qP(Math.trunc(-e.o/60)),o+=":",o+=qP(Math.trunc(-e.o%60))):(o+="+",o+=qP(Math.trunc(e.o/60)),o+=":",o+=qP(Math.trunc(e.o%60)))),i&&(o+="["+e.zone.ianaName+"]"),o}const eL={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},tL={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},nL={ordinal:1,hour:0,minute:0,second:0,millisecond:0},rL=["year","month","day","hour","minute","second","millisecond"],aL=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],iL=["year","ordinal","hour","minute","second","millisecond"];function oL(e){switch(e.toLowerCase()){case"localweekday":case"localweekdays":return"localWeekday";case"localweeknumber":case"localweeknumbers":return"localWeekNumber";case"localweekyear":case"localweekyears":return"localWeekYear";default:return function(e){const t={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[e.toLowerCase()];if(!t)throw new lj(e);return t}(e)}}function sL(e,t){const n=sP(t.zone,SP.defaultZone);if(!n.isValid)return pL.invalid(UN(n));const r=rP.fromObject(t);let a,i;if(LP(e.year))a=SP.now();else{for(const t of rL)LP(e[t])&&(e[t]=eL[t]);const t=DP(e)||NP(e);if(t)return pL.invalid(t);const r=function(e){if(void 0===uL&&(uL=SP.now()),"iana"!==e.type)return e.offset(uL);const t=e.name;let n=dL.get(t);return void 0===n&&(n=e.offset(uL),dL.set(t,n)),n}(n);[a,i]=WN(e,r,n)}return new pL({ts:a,zone:n,loc:r,o:i})}function lL(e,t,n){const r=!!LP(n.round)||n.round,a=(e,a)=>{e=HP(e,r||n.calendary?0:2,!0);return t.loc.clone(n).relFormatter(n).format(e,a)},i=r=>n.calendary?t.hasSame(e,r)?0:t.startOf(r).diff(e.startOf(r),r).get(r):t.diff(e,r).get(r);if(n.unit)return a(i(n.unit),n.unit);for(const e of n.units){const t=i(e);if(Math.abs(t)>=1)return a(t,e)}return a(e>t?-0:0,n.units[n.units.length-1])}function cL(e){let t,n={};return e.length>0&&"object"==typeof e[e.length-1]?(n=e[e.length-1],t=Array.from(e).slice(0,e.length-1)):t=Array.from(e),[n,t]}let uL;const dL=new Map;class pL{constructor(e){const t=e.zone||SP.defaultZone;let n=e.invalid||(Number.isNaN(e.ts)?new EP("invalid input"):null)||(t.isValid?null:UN(t));this.ts=LP(e.ts)?SP.now():e.ts;let r=null,a=null;if(!n){if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(t))[r,a]=[e.old.c,e.old.o];else{const i=MP(e.o)&&!e.old?e.o:t.offset(this.ts);r=zN(this.ts,i),n=Number.isNaN(r.year)?new EP("invalid input"):null,r=n?null:r,a=n?null:i}}this._zone=t,this.loc=e.loc||rP.create(),this.invalid=n,this.weekData=null,this.localWeekData=null,this.c=r,this.o=a,this.isLuxonDateTime=!0}static now(){return new pL({})}static local(){const[e,t]=cL(arguments),[n,r,a,i,o,s,l]=t;return sL({year:n,month:r,day:a,hour:i,minute:o,second:s,millisecond:l},e)}static utc(){const[e,t]=cL(arguments),[n,r,a,i,o,s,l]=t;return e.zone=iP.utcInstance,sL({year:n,month:r,day:a,hour:i,minute:o,second:s,millisecond:l},e)}static fromJSDate(e,t={}){const n=(r=e,"[object Date]"===Object.prototype.toString.call(r)?e.valueOf():NaN);var r;if(Number.isNaN(n))return pL.invalid("invalid input");const a=sP(t.zone,SP.defaultZone);return a.isValid?new pL({ts:n,zone:a,loc:rP.fromObject(t)}):pL.invalid(UN(a))}static fromMillis(e,t={}){if(MP(e))return e<-864e13||e>864e13?pL.invalid("Timestamp out of range"):new pL({ts:e,zone:sP(t.zone,SP.defaultZone),loc:rP.fromObject(t)});throw new cj(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,t={}){if(MP(e))return new pL({ts:1e3*e,zone:sP(t.zone,SP.defaultZone),loc:rP.fromObject(t)});throw new cj("fromSeconds requires a numerical input")}static fromObject(e,t={}){e=e||{};const n=sP(t.zone,SP.defaultZone);if(!n.isValid)return pL.invalid(UN(n));const r=rP.fromObject(t),a=sD(e,oL),{minDaysInFirstWeek:i,startOfWeek:o}=PP(a,r),s=SP.now(),l=LP(t.specificOffset)?n.offset(s):t.specificOffset,c=!LP(a.ordinal),u=!LP(a.year),d=!LP(a.month)||!LP(a.day),p=u||d,h=a.weekYear||a.weekNumber;if((p||c)&&h)throw new sj("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(d&&c)throw new sj("Can't mix ordinal dates with month/day");const m=h||a.weekday&&!p;let f,y,g=zN(s,l);m?(f=aL,y=tL,g=KP(g,i,o)):c?(f=iL,y=nL,g=RP(g)):(f=rL,y=eL);let b=!1;for(const e of f){LP(a[e])?a[e]=b?y[e]:g[e]:b=!0}const v=m?function(e,t=4,n=1){const r=FP(e.weekYear),a=$P(e.weekNumber,1,nD(e.weekYear,t,n)),i=$P(e.weekday,1,7);return r?a?!i&&kP("weekday",e.weekday):kP("week",e.weekNumber):kP("weekYear",e.weekYear)}(a,i,o):c?function(e){const t=FP(e.year),n=$P(e.ordinal,1,ZP(e.year));return t?!n&&kP("ordinal",e.ordinal):kP("year",e.year)}(a):DP(a),w=v||NP(a);if(w)return pL.invalid(w);const S=m?CP(a,i,o):c?jP(a):a,[E,x]=WN(S,l,n),_=new pL({ts:E,zone:n,o:x,loc:r});return a.weekday&&p&&e.weekday!==_.weekday?pL.invalid("mismatched weekday",`you can't specify both a weekday of ${a.weekday} and a date of ${_.toISO()}`):_.isValid?_:pL.invalid(_.invalid)}static fromISO(e,t={}){const[n,r]=function(e){return OD(e,[tN,iN],[nN,oN],[rN,sN],[aN,lN])}(e);return HN(n,r,t,"ISO 8601",e)}static fromRFC2822(e,t={}){const[n,r]=function(e){return OD(function(e){return e.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}(e),[WD,YD])}(e);return HN(n,r,t,"RFC 2822",e)}static fromHTTP(e,t={}){const[n,r]=function(e){return OD(e,[HD,XD],[QD,XD],[ZD,eN])}(e);return HN(n,r,t,"HTTP",t)}static fromFormat(e,t,n={}){if(LP(e)||LP(t))throw new cj("fromFormat requires an input string and a format");const{locale:r=null,numberingSystem:a=null}=n,i=rP.fromOpts({locale:r,numberingSystem:a,defaultToEN:!0}),[o,s,l,c]=function(e,t,n){const{result:r,zone:a,specificOffset:i,invalidReason:o}=FN(e,t,n);return[r,a,i,o]}(i,e,t);return c?pL.invalid(c):HN(o,s,n,`format ${t}`,e,l)}static fromString(e,t,n={}){return pL.fromFormat(e,t,n)}static fromSQL(e,t={}){const[n,r]=function(e){return OD(e,[uN,iN],[dN,pN])}(e);return HN(n,r,t,"SQL",e)}static invalid(e,t=null){if(!e)throw new cj("need to specify a reason the DateTime is invalid");const n=e instanceof EP?e:new EP(e,t);if(SP.throwOnInvalid)throw new aj(n);return new pL({invalid:n})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,t={}){const n=BN(e,rP.fromObject(t));return n?n.map((e=>e?e.val:null)).join(""):null}static expandFormat(e,t={}){return LN(kD.parseFormat(e),rP.fromObject(t)).map((e=>e.val)).join("")}static resetCache(){uL=void 0,dL.clear()}get(e){return this[e]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?JN(this).weekYear:NaN}get weekNumber(){return this.isValid?JN(this).weekNumber:NaN}get weekday(){return this.isValid?JN(this).weekday:NaN}get isWeekend(){return this.isValid&&this.loc.getWeekendDays().includes(this.weekday)}get localWeekday(){return this.isValid?GN(this).weekday:NaN}get localWeekNumber(){return this.isValid?GN(this).weekNumber:NaN}get localWeekYear(){return this.isValid?GN(this).weekYear:NaN}get ordinal(){return this.isValid?RP(this.c).ordinal:NaN}get monthShort(){return this.isValid?_N.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?_N.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?_N.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?_N.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}getPossibleOffsets(){if(!this.isValid||this.isOffsetFixed)return[this];const e=864e5,t=6e4,n=eD(this.c),r=this.zone.offset(n-e),a=this.zone.offset(n+e),i=this.zone.offset(n-r*t),o=this.zone.offset(n-a*t);if(i===o)return[this];const s=n-i*t,l=n-o*t,c=zN(s,i),u=zN(l,o);return c.hour===u.hour&&c.minute===u.minute&&c.second===u.second&&c.millisecond===u.millisecond?[$N(this,{ts:s}),$N(this,{ts:l})]:[this]}get isInLeapYear(){return QP(this.year)}get daysInMonth(){return XP(this.year,this.month)}get daysInYear(){return this.isValid?ZP(this.year):NaN}get weeksInWeekYear(){return this.isValid?nD(this.weekYear):NaN}get weeksInLocalWeekYear(){return this.isValid?nD(this.localWeekYear,this.loc.getMinDaysInFirstWeek(),this.loc.getStartOfWeek()):NaN}resolvedLocaleOptions(e={}){const{locale:t,numberingSystem:n,calendar:r}=kD.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:t,numberingSystem:n,outputCalendar:r}}toUTC(e=0,t={}){return this.setZone(iP.instance(e),t)}toLocal(){return this.setZone(SP.defaultZone)}setZone(e,{keepLocalTime:t=!1,keepCalendarTime:n=!1}={}){if((e=sP(e,SP.defaultZone)).equals(this.zone))return this;if(e.isValid){let r=this.ts;if(t||n){const t=e.offset(this.ts),n=this.toObject();[r]=WN(n,t,e)}return $N(this,{ts:r,zone:e})}return pL.invalid(UN(e))}reconfigure({locale:e,numberingSystem:t,outputCalendar:n}={}){return $N(this,{loc:this.loc.clone({locale:e,numberingSystem:t,outputCalendar:n})})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const t=sD(e,oL),{minDaysInFirstWeek:n,startOfWeek:r}=PP(t,this.loc),a=!LP(t.weekYear)||!LP(t.weekNumber)||!LP(t.weekday),i=!LP(t.ordinal),o=!LP(t.year),s=!LP(t.month)||!LP(t.day),l=o||s,c=t.weekYear||t.weekNumber;if((l||i)&&c)throw new sj("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(s&&i)throw new sj("Can't mix ordinal dates with month/day");let u;a?u=CP({...KP(this.c,n,r),...t},n,r):LP(t.ordinal)?(u={...this.toObject(),...t},LP(t.day)&&(u.day=Math.min(XP(u.year,u.month),u.day))):u=jP({...RP(this.c),...t});const[d,p]=WN(u,this.o,this.zone);return $N(this,{ts:d,o:p})}plus(e){if(!this.isValid)return this;return $N(this,YN(this,SN.fromDurationLike(e)))}minus(e){if(!this.isValid)return this;return $N(this,YN(this,SN.fromDurationLike(e).negate()))}startOf(e,{useLocaleWeeks:t=!1}={}){if(!this.isValid)return this;const n={},r=SN.normalizeUnit(e);switch(r){case"years":n.month=1;case"quarters":case"months":n.day=1;case"weeks":case"days":n.hour=0;case"hours":n.minute=0;case"minutes":n.second=0;case"seconds":n.millisecond=0}if("weeks"===r)if(t){const e=this.loc.getStartOfWeek(),{weekday:t}=this;t<e&&(n.weekNumber=this.weekNumber-1),n.weekday=e}else n.weekday=1;if("quarters"===r){const e=Math.ceil(this.month/3);n.month=3*(e-1)+1}return this.set(n)}endOf(e,t){return this.isValid?this.plus({[e]:1}).startOf(e,t).minus(1):this}toFormat(e,t={}){return this.isValid?kD.create(this.loc.redefaultToEN(t)).formatDateTimeFromString(this,e):VN}toLocaleString(e=mj,t={}){return this.isValid?kD.create(this.loc.clone(t),e).formatDateTime(this):VN}toLocaleParts(e={}){return this.isValid?kD.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:t=!1,suppressMilliseconds:n=!1,includeOffset:r=!0,extendedZone:a=!1}={}){if(!this.isValid)return null;const i="extended"===e;let o=ZN(this,i);return o+="T",o+=XN(this,i,t,n,r,a),o}toISODate({format:e="extended"}={}){return this.isValid?ZN(this,"extended"===e):null}toISOWeekDate(){return QN(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:t=!1,includeOffset:n=!0,includePrefix:r=!1,extendedZone:a=!1,format:i="extended"}={}){if(!this.isValid)return null;return(r?"T":"")+XN(this,"extended"===i,t,e,n,a)}toRFC2822(){return QN(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return QN(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?ZN(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:t=!1,includeOffsetSpace:n=!0}={}){let r="HH:mm:ss.SSS";return(t||e)&&(n&&(r+=" "),t?r+="z":e&&(r+="ZZ")),QN(this,r,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():VN}[Symbol.for("nodejs.util.inspect.custom")](){return this.isValid?`DateTime { ts: ${this.toISO()}, zone: ${this.zone.name}, locale: ${this.locale} }`:`DateTime { Invalid, reason: ${this.invalidReason} }`}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const t={...this.c};return e.includeConfig&&(t.outputCalendar=this.outputCalendar,t.numberingSystem=this.loc.numberingSystem,t.locale=this.loc.locale),t}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,t="milliseconds",n={}){if(!this.isValid||!e.isValid)return SN.invalid("created by diffing an invalid DateTime");const r={locale:this.locale,numberingSystem:this.numberingSystem,...n},a=(s=t,Array.isArray(s)?s:[s]).map(SN.normalizeUnit),i=e.valueOf()>this.valueOf(),o=IN(i?this:e,i?e:this,a,r);var s;return i?o.negate():o}diffNow(e="milliseconds",t={}){return this.diff(pL.now(),e,t)}until(e){return this.isValid?xN.fromDateTimes(this,e):this}hasSame(e,t,n){if(!this.isValid)return!1;const r=e.valueOf(),a=this.setZone(e.zone,{keepLocalTime:!0});return a.startOf(t,n)<=r&&r<=a.endOf(t,n)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const t=e.base||pL.fromObject({},{zone:this.zone}),n=e.padding?this<t?-e.padding:e.padding:0;let r=["years","months","days","hours","minutes","seconds"],a=e.unit;return Array.isArray(e.unit)&&(r=e.unit,a=void 0),lL(t,this.plus(n),{...e,numeric:"always",units:r,unit:a})}toRelativeCalendar(e={}){return this.isValid?lL(e.base||pL.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(pL.isDateTime))throw new cj("min requires all arguments be DateTimes");return UP(e,(e=>e.valueOf()),Math.min)}static max(...e){if(!e.every(pL.isDateTime))throw new cj("max requires all arguments be DateTimes");return UP(e,(e=>e.valueOf()),Math.max)}static fromFormatExplain(e,t,n={}){const{locale:r=null,numberingSystem:a=null}=n;return FN(rP.fromOpts({locale:r,numberingSystem:a,defaultToEN:!0}),e,t)}static fromStringExplain(e,t,n={}){return pL.fromFormatExplain(e,t,n)}static buildFormatParser(e,t={}){const{locale:n=null,numberingSystem:r=null}=t,a=rP.fromOpts({locale:n,numberingSystem:r,defaultToEN:!0});return new MN(a,e)}static fromFormatParser(e,t,n={}){if(LP(e)||LP(t))throw new cj("fromFormatParser requires an input string and a format parser");const{locale:r=null,numberingSystem:a=null}=n,i=rP.fromOpts({locale:r,numberingSystem:a,defaultToEN:!0});if(!i.equals(t.locale))throw new cj(`fromFormatParser called with a locale of ${i}, but the format parser was created for ${t.locale}`);const{result:o,zone:s,specificOffset:l,invalidReason:c}=t.explainFromTokens(e);return c?pL.invalid(c):HN(o,s,n,`format ${t.format}`,e,l)}static get DATE_SHORT(){return mj}static get DATE_MED(){return fj}static get DATE_MED_WITH_WEEKDAY(){return yj}static get DATE_FULL(){return gj}static get DATE_HUGE(){return bj}static get TIME_SIMPLE(){return vj}static get TIME_WITH_SECONDS(){return wj}static get TIME_WITH_SHORT_OFFSET(){return Sj}static get TIME_WITH_LONG_OFFSET(){return Ej}static get TIME_24_SIMPLE(){return xj}static get TIME_24_WITH_SECONDS(){return _j}static get TIME_24_WITH_SHORT_OFFSET(){return kj}static get TIME_24_WITH_LONG_OFFSET(){return Ij}static get DATETIME_SHORT(){return Tj}static get DATETIME_SHORT_WITH_SECONDS(){return Aj}static get DATETIME_MED(){return Oj}static get DATETIME_MED_WITH_SECONDS(){return Kj}static get DATETIME_MED_WITH_WEEKDAY(){return Cj}static get DATETIME_FULL(){return Rj}static get DATETIME_FULL_WITH_SECONDS(){return jj}static get DATETIME_HUGE(){return Pj}static get DATETIME_HUGE_WITH_SECONDS(){return Dj}}function hL(e){if(pL.isDateTime(e))return e;if(e&&e.valueOf&&MP(e.valueOf()))return pL.fromJSDate(e);if(e&&"object"==typeof e)return pL.fromObject(e);throw new cj(`Unknown datetime argument: ${e}, of type ${typeof e}`)}nj.DateTime=pL,nj.Duration=SN,nj.FixedOffsetZone=iP,nj.IANAZone=Uj,nj.Info=_N,nj.Interval=xN,nj.InvalidZone=oP,nj.Settings=SP,nj.SystemZone=Mj,nj.VERSION="3.6.1",nj.Zone=Nj;var mL=nj;function fL(e,t){var n={zone:t};if(e?e instanceof fL?this._date=e._date:e instanceof Date?this._date=mL.DateTime.fromJSDate(e,n):"number"==typeof e?this._date=mL.DateTime.fromMillis(e,n):"string"==typeof e&&(this._date=mL.DateTime.fromISO(e,n),this._date.isValid||(this._date=mL.DateTime.fromRFC2822(e,n)),this._date.isValid||(this._date=mL.DateTime.fromSQL(e,n)),this._date.isValid||(this._date=mL.DateTime.fromFormat(e,"EEE, d MMM yyyy HH:mm:ss",n))):this._date=mL.DateTime.local(),!this._date||!this._date.isValid)throw new Error("CronDate: unhandled timestamp: "+JSON.stringify(e));t&&t!==this._date.zoneName&&(this._date=this._date.setZone(t))}function yL(e){return{start:e,count:1}}function gL(e,t){e.end=t,e.step=t-e.start,e.count=2}function bL(e,t,n){t&&(2===t.count?(e.push(yL(t.start)),e.push(yL(t.end))):e.push(t)),n&&e.push(n)}fL.prototype.addYear=function(){this._date=this._date.plus({years:1})},fL.prototype.addMonth=function(){this._date=this._date.plus({months:1}).startOf("month")},fL.prototype.addDay=function(){this._date=this._date.plus({days:1}).startOf("day")},fL.prototype.addHour=function(){var e=this._date;this._date=this._date.plus({hours:1}).startOf("hour"),this._date<=e&&(this._date=this._date.plus({hours:1}))},fL.prototype.addMinute=function(){var e=this._date;this._date=this._date.plus({minutes:1}).startOf("minute"),this._date<e&&(this._date=this._date.plus({hours:1}))},fL.prototype.addSecond=function(){var e=this._date;this._date=this._date.plus({seconds:1}).startOf("second"),this._date<e&&(this._date=this._date.plus({hours:1}))},fL.prototype.subtractYear=function(){this._date=this._date.minus({years:1})},fL.prototype.subtractMonth=function(){this._date=this._date.minus({months:1}).endOf("month").startOf("second")},fL.prototype.subtractDay=function(){this._date=this._date.minus({days:1}).endOf("day").startOf("second")},fL.prototype.subtractHour=function(){var e=this._date;this._date=this._date.minus({hours:1}).endOf("hour").startOf("second"),this._date>=e&&(this._date=this._date.minus({hours:1}))},fL.prototype.subtractMinute=function(){var e=this._date;this._date=this._date.minus({minutes:1}).endOf("minute").startOf("second"),this._date>e&&(this._date=this._date.minus({hours:1}))},fL.prototype.subtractSecond=function(){var e=this._date;this._date=this._date.minus({seconds:1}).startOf("second"),this._date>e&&(this._date=this._date.minus({hours:1}))},fL.prototype.getDate=function(){return this._date.day},fL.prototype.getFullYear=function(){return this._date.year},fL.prototype.getDay=function(){var e=this._date.weekday;return 7==e?0:e},fL.prototype.getMonth=function(){return this._date.month-1},fL.prototype.getHours=function(){return this._date.hour},fL.prototype.getMinutes=function(){return this._date.minute},fL.prototype.getSeconds=function(){return this._date.second},fL.prototype.getMilliseconds=function(){return this._date.millisecond},fL.prototype.getTime=function(){return this._date.valueOf()},fL.prototype.getUTCDate=function(){return this._getUTC().day},fL.prototype.getUTCFullYear=function(){return this._getUTC().year},fL.prototype.getUTCDay=function(){var e=this._getUTC().weekday;return 7==e?0:e},fL.prototype.getUTCMonth=function(){return this._getUTC().month-1},fL.prototype.getUTCHours=function(){return this._getUTC().hour},fL.prototype.getUTCMinutes=function(){return this._getUTC().minute},fL.prototype.getUTCSeconds=function(){return this._getUTC().second},fL.prototype.toISOString=function(){return this._date.toUTC().toISO()},fL.prototype.toJSON=function(){return this._date.toJSON()},fL.prototype.setDate=function(e){this._date=this._date.set({day:e})},fL.prototype.setFullYear=function(e){this._date=this._date.set({year:e})},fL.prototype.setDay=function(e){this._date=this._date.set({weekday:e})},fL.prototype.setMonth=function(e){this._date=this._date.set({month:e+1})},fL.prototype.setHours=function(e){this._date=this._date.set({hour:e})},fL.prototype.setMinutes=function(e){this._date=this._date.set({minute:e})},fL.prototype.setSeconds=function(e){this._date=this._date.set({second:e})},fL.prototype.setMilliseconds=function(e){this._date=this._date.set({millisecond:e})},fL.prototype._getUTC=function(){return this._date.toUTC()},fL.prototype.toString=function(){return this.toDate().toString()},fL.prototype.toDate=function(){return this._date.toJSDate()},fL.prototype.isLastDayOfMonth=function(){var e=this._date.plus({days:1}).startOf("day");return this._date.month!==e.month},fL.prototype.isLastWeekdayOfMonth=function(){var e=this._date.plus({days:7}).startOf("day");return this._date.month!==e.month};var vL=function(e){for(var t=[],n=void 0,r=0;r<e.length;r++){var a=e[r];"number"!=typeof a?(bL(t,n,yL(a)),n=void 0):n?1===n.count?gL(n,a):n.step===a-n.end?(n.count++,n.end=a):2===n.count?(t.push(yL(n.start)),gL(n=yL(n.end),a)):(bL(t,n),n=yL(a)):n=yL(a)}return bL(t,n),t},wL=vL;var SL=function(e,t,n){var r=wL(e);if(1===r.length){var a=r[0];if(1===(c=a.step)&&a.start===t&&a.end===n)return"*";if(1!==c&&a.start===t&&a.end===n-c+1)return"*/"+c}for(var i=[],o=0,s=r.length;o<s;++o){var l=r[o];if(1!==l.count){var c=l.step;if(1!==l.step){var u=0==l.start?l.count-1:l.count;l.step*u>l.end?i=i.concat(Array.from({length:l.end-l.start+1}).map((function(e,t){var n=l.start+t;return(n-l.start)%l.step==0?n:null})).filter((function(e){return null!=e}))):l.end===n-l.step+1?i.push(l.start+"/"+l.step):i.push(l.start+"-"+l.end+"/"+l.step)}else i.push(l.start+"-"+l.end)}else i.push(l.start)}return i.join(",")},EL=fL,xL=SL;function _L(e,t){this._options=t,this._utc=t.utc||!1,this._tz=this._utc?"UTC":t.tz,this._currentDate=new EL(t.currentDate,this._tz),this._startDate=t.startDate?new EL(t.startDate,this._tz):null,this._endDate=t.endDate?new EL(t.endDate,this._tz):null,this._isIterator=t.iterator||!1,this._hasIterated=!1,this._nthDayOfWeek=t.nthDayOfWeek||0,this.fields=_L._freezeFields(e)}_L.map=["second","minute","hour","dayOfMonth","month","dayOfWeek"],_L.predefined={"@yearly":"0 0 1 1 *","@monthly":"0 0 1 * *","@weekly":"0 0 * * 0","@daily":"0 0 * * *","@hourly":"0 * * * *"},_L.constraints=[{min:0,max:59,chars:[]},{min:0,max:59,chars:[]},{min:0,max:23,chars:[]},{min:1,max:31,chars:["L"]},{min:1,max:12,chars:[]},{min:0,max:7,chars:["L"]}],_L.daysInMonth=[31,29,31,30,31,30,31,31,30,31,30,31],_L.aliases={month:{jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12},dayOfWeek:{sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6}},_L.parseDefaults=["0","*","*","*","*","*"],_L.standardValidCharacters=/^[,*\d/-]+$/,_L.dayOfWeekValidCharacters=/^[?,*\dL#/-]+$/,_L.dayOfMonthValidCharacters=/^[?,*\dL/-]+$/,_L.validCharacters={second:_L.standardValidCharacters,minute:_L.standardValidCharacters,hour:_L.standardValidCharacters,dayOfMonth:_L.dayOfMonthValidCharacters,month:_L.standardValidCharacters,dayOfWeek:_L.dayOfWeekValidCharacters},_L._isValidConstraintChar=function(e,t){return"string"==typeof t&&e.chars.some((function(e){return t.indexOf(e)>-1}))},_L._parseField=function(e,t,n){switch(e){case"month":case"dayOfWeek":var r=_L.aliases[e];t=t.replace(/[a-z]{3}/gi,(function(e){if(e=e.toLowerCase(),void 0!==r[e])return r[e];throw new Error('Validation error, cannot resolve alias "'+e+'"')}))}if(!_L.validCharacters[e].test(t))throw new Error("Invalid characters, got value: "+t);function a(e){var t=e.split("/");if(t.length>2)throw new Error("Invalid repeat: "+e);return t.length>1?(t[0]==+t[0]&&(t=[t[0]+"-"+n.max,t[1]]),i(t[0],t[t.length-1])):i(e,1)}function i(t,r){var a=[],i=t.split("-");if(i.length>1){if(i.length<2)return+t;if(!i[0].length){if(!i[1].length)throw new Error("Invalid range: "+t);return+t}var o=+i[0],s=+i[1];if(Number.isNaN(o)||Number.isNaN(s)||o<n.min||s>n.max)throw new Error("Constraint error, got range "+o+"-"+s+" expected range "+n.min+"-"+n.max);if(o>s)throw new Error("Invalid range: "+t);var l=+r;if(Number.isNaN(l)||l<=0)throw new Error("Constraint error, cannot repeat at every "+l+" time.");"dayOfWeek"===e&&s%7==0&&a.push(0);for(var c=o,u=s;c<=u;c++){!(-1!==a.indexOf(c))&&l>0&&l%r==0?(l=1,a.push(c)):l++}return a}return Number.isNaN(+t)?t:+t}return-1!==t.indexOf("*")?t=t.replace(/\*/g,n.min+"-"+n.max):-1!==t.indexOf("?")&&(t=t.replace(/\?/g,n.min+"-"+n.max)),function(t){var r=[];function i(t){if(t instanceof Array)for(var a=0,i=t.length;a<i;a++){var o=t[a];if(_L._isValidConstraintChar(n,o))r.push(o);else{if("number"!=typeof o||Number.isNaN(o)||o<n.min||o>n.max)throw new Error("Constraint error, got value "+o+" expected range "+n.min+"-"+n.max);r.push(o)}}else{if(_L._isValidConstraintChar(n,t))return void r.push(t);var s=+t;if(Number.isNaN(s)||s<n.min||s>n.max)throw new Error("Constraint error, got value "+t+" expected range "+n.min+"-"+n.max);"dayOfWeek"===e&&(s%=7),r.push(s)}}var o=t.split(",");if(!o.every((function(e){return e.length>0})))throw new Error("Invalid list value format");if(o.length>1)for(var s=0,l=o.length;s<l;s++)i(a(o[s]));else i(a(t));return r.sort(_L._sortCompareFn),r}(t)},_L._sortCompareFn=function(e,t){var n="number"==typeof e,r="number"==typeof t;return n&&r?e-t:!n&&r?1:n&&!r?-1:e.localeCompare(t)},_L._handleMaxDaysInMonth=function(e){if(1===e.month.length){var t=_L.daysInMonth[e.month[0]-1];if(e.dayOfMonth[0]>t)throw new Error("Invalid explicit day of month definition");return e.dayOfMonth.filter((function(e){return"L"===e||e<=t})).sort(_L._sortCompareFn)}},_L._freezeFields=function(e){for(var t=0,n=_L.map.length;t<n;++t){var r=_L.map[t],a=e[r];e[r]=Object.freeze(a)}return Object.freeze(e)},_L.prototype._applyTimezoneShift=function(e,t,n){if("Month"===n||"Day"===n){var r=e.getTime();e[t+n](),r===e.getTime()&&(0===e.getMinutes()&&0===e.getSeconds()?e.addHour():59===e.getMinutes()&&59===e.getSeconds()&&e.subtractHour())}else{var a=e.getHours();e[t+n]();var i=e.getHours(),o=i-a;2===o?24!==this.fields.hour.length&&(this._dstStart=i):0===o&&0===e.getMinutes()&&0===e.getSeconds()&&24!==this.fields.hour.length&&(this._dstEnd=i)}},_L.prototype._findSchedule=function(e){function t(e,t){for(var n=0,r=t.length;n<r;n++)if(t[n]>=e)return t[n]===e;return t[0]===e}function n(e,t){if(t<6){if(e.getDate()<8&&1===t)return!0;var n=e.getDate()%7?1:0,r=e.getDate()-e.getDate()%7;return Math.floor(r/7)+n===t}return!1}function r(e){return e.length>0&&e.some((function(e){return"string"==typeof e&&e.indexOf("L")>=0}))}var a=(e=e||!1)?"subtract":"add",i=new EL(this._currentDate,this._tz),o=this._startDate,s=this._endDate,l=i.getTime(),c=0;for(;c<1e4;){if(c++,e){if(o&&i.getTime()-o.getTime()<0)throw new Error("Out of the timespan range")}else if(s&&s.getTime()-i.getTime()<0)throw new Error("Out of the timespan range");var u=t(i.getDate(),this.fields.dayOfMonth);r(this.fields.dayOfMonth)&&(u=u||i.isLastDayOfMonth());var d=t(i.getDay(),this.fields.dayOfWeek);r(this.fields.dayOfWeek)&&(d=d||this.fields.dayOfWeek.some((function(e){if(!r([e]))return!1;var t=Number.parseInt(e[0])%7;if(Number.isNaN(t))throw new Error("Invalid last weekday of the month expression: "+e);return i.getDay()===t&&i.isLastWeekdayOfMonth()})));var p=this.fields.dayOfMonth.length>=_L.daysInMonth[i.getMonth()],h=this.fields.dayOfWeek.length===_L.constraints[5].max-_L.constraints[5].min+1,m=i.getHours();if(u||d&&!h)if(p||!h||u)if(!p||h||d)if(this._nthDayOfWeek>0&&!n(i,this._nthDayOfWeek))this._applyTimezoneShift(i,a,"Day");else if(t(i.getMonth()+1,this.fields.month)){if(t(m,this.fields.hour)){if(this._dstEnd===m&&!e){this._dstEnd=null,this._applyTimezoneShift(i,"add","Hour");continue}}else{if(this._dstStart!==m){this._dstStart=null,this._applyTimezoneShift(i,a,"Hour");continue}if(!t(m-1,this.fields.hour)){i[a+"Hour"]();continue}}if(t(i.getMinutes(),this.fields.minute))if(t(i.getSeconds(),this.fields.second)){if(l!==i.getTime())break;"add"===a||0===i.getMilliseconds()?this._applyTimezoneShift(i,a,"Second"):i.setMilliseconds(0)}else this._applyTimezoneShift(i,a,"Second");else this._applyTimezoneShift(i,a,"Minute")}else this._applyTimezoneShift(i,a,"Month");else this._applyTimezoneShift(i,a,"Day");else this._applyTimezoneShift(i,a,"Day");else this._applyTimezoneShift(i,a,"Day")}if(c>=1e4)throw new Error("Invalid expression, loop limit exceeded");return this._currentDate=new EL(i,this._tz),this._hasIterated=!0,i},_L.prototype.next=function(){var e=this._findSchedule();return this._isIterator?{value:e,done:!this.hasNext()}:e},_L.prototype.prev=function(){var e=this._findSchedule(!0);return this._isIterator?{value:e,done:!this.hasPrev()}:e},_L.prototype.hasNext=function(){var e=this._currentDate,t=this._hasIterated;try{return this._findSchedule(),!0}catch(e){return!1}finally{this._currentDate=e,this._hasIterated=t}},_L.prototype.hasPrev=function(){var e=this._currentDate,t=this._hasIterated;try{return this._findSchedule(!0),!0}catch(e){return!1}finally{this._currentDate=e,this._hasIterated=t}},_L.prototype.iterate=function(e,t){var n=[];if(e>=0)for(var r=0,a=e;r<a;r++)try{var i=this.next();n.push(i),t&&t(i,r)}catch(e){break}else for(r=0,a=e;r>a;r--)try{i=this.prev();n.push(i),t&&t(i,r)}catch(e){break}return n},_L.prototype.reset=function(e){this._currentDate=new EL(e||this._options.currentDate)},_L.prototype.stringify=function(e){for(var t=[],n=e?0:1,r=_L.map.length;n<r;++n){var a=_L.map[n],i=this.fields[a],o=_L.constraints[n];"dayOfMonth"===a&&1===this.fields.month.length?o={min:1,max:_L.daysInMonth[this.fields.month[0]-1]}:"dayOfWeek"===a&&(o={min:0,max:6},i=7===i[i.length-1]?i.slice(0,-1):i),t.push(xL(i,o.min,o.max))}return t.join(" ")},_L.parse=function(e,t){var n=this;function r(e,t){t||(t={}),void 0===t.currentDate&&(t.currentDate=new EL(void 0,n._tz)),_L.predefined[e]&&(e=_L.predefined[e]);var r=[],a=(e+"").trim().split(/\s+/);if(a.length>6)throw new Error("Invalid cron expression");for(var i=_L.map.length-a.length,o=0,s=_L.map.length;o<s;++o){var l=_L.map[o],c=a[a.length>s?o:o-i];if(o<i||!c)r.push(_L._parseField(l,_L.parseDefaults[o],_L.constraints[o]));else{var u="dayOfWeek"===l?h(c):c;r.push(_L._parseField(l,u,_L.constraints[o]))}}var d={};for(o=0,s=_L.map.length;o<s;o++){d[_L.map[o]]=r[o]}var p=_L._handleMaxDaysInMonth(d);return d.dayOfMonth=p||d.dayOfMonth,new _L(d,t);function h(e){var n=e.split("#");if(n.length>1){var r=+n[n.length-1];if(/,/.test(e))throw new Error("Constraint error, invalid dayOfWeek `#` and `,` special characters are incompatible");if(/\//.test(e))throw new Error("Constraint error, invalid dayOfWeek `#` and `/` special characters are incompatible");if(/-/.test(e))throw new Error("Constraint error, invalid dayOfWeek `#` and `-` special characters are incompatible");if(n.length>2||Number.isNaN(r)||r<1||r>5)throw new Error("Constraint error, invalid dayOfWeek occurrence number (#)");return t.nthDayOfWeek=r,n[0]}return e}}return"function"==typeof t&&(t={}),r(e,t)},_L.fieldsToExpression=function(e,t){function n(e,t,n){if(!t)throw new Error("Validation error, Field "+e+" is missing");if(0===t.length)throw new Error("Validation error, Field "+e+" contains no values");for(var r=0,a=t.length;r<a;r++){var i=t[r];if(!_L._isValidConstraintChar(n,i)&&("number"!=typeof i||Number.isNaN(i)||i<n.min||i>n.max))throw new Error("Constraint error, got value "+i+" expected range "+n.min+"-"+n.max)}}for(var r={},a=0,i=_L.map.length;a<i;++a){var o=_L.map[a],s=e[o];n(o,s,_L.constraints[a]);for(var l=[],c=-1;++c<s.length;)l[c]=s[c];if((s=l.sort(_L._sortCompareFn).filter((function(e,t,n){return!t||e!==n[t-1]}))).length!==l.length)throw new Error("Validation error, Field "+o+" contains duplicate values");r[o]=s}var u=_L._handleMaxDaysInMonth(r);return r.dayOfMonth=u||r.dayOfMonth,new _L(r,t||{})};var kL=_L;function IL(){}IL._parseEntry=function(e){var t=e.split(" ");if(6===t.length)return{interval:kL.parse(e)};if(t.length>6)return{interval:kL.parse(t.slice(0,6).join(" ")),command:t.slice(6,t.length)};throw new Error("Invalid entry: "+e)},IL.parseExpression=function(e,t){return kL.parse(e,t)},IL.fieldsToExpression=function(e,t){return kL.fieldsToExpression(e,t)},IL.parseString=function(e){for(var t=e.split("\n"),n={variables:{},expressions:[],errors:{}},r=0,a=t.length;r<a;r++){var i=null,o=t[r].trim();if(o.length>0){if(o.match(/^#/))continue;if(i=o.match(/^(.*)=(.*)$/))n.variables[i[1]]=i[2];else{var s=null;try{s=IL._parseEntry("0 "+o),n.expressions.push(s.interval)}catch(e){n.errors[o]=e}}}}return n},IL.parseFile=function(e,t){M.default.readFile(e,(function(e,n){if(!e)return t(null,IL.parseString(n.toString()));t(e)}))};var TL=IL;class AL extends E.EventEmitter{constructor(e,t={connection:{}},n=tj,r=!1){if(super(),this.name=e,this.opts=t,this.closed=!1,this.hasBlockingConnection=!1,this.hasBlockingConnection=r,this.opts=Object.assign({prefix:"bull"},t),!e)throw new Error("Queue name must be provided");if(e.includes(":"))throw new Error("Queue name cannot contain :");this.connection=new n(t.connection,{shared:PC(t.connection),blocking:r,skipVersionCheck:t.skipVersionCheck,skipWaitingForReady:t.skipWaitingForReady}),this.connection.on("error",(e=>this.emit("error",e))),this.connection.on("close",(()=>{this.closing||this.emit("ioredis:close")}));const a=new aR(t.prefix);this.qualifiedName=a.getQueueQualifiedName(e),this.keys=a.getKeys(e),this.toKey=t=>a.toKey(e,t),this.createScripts()}get client(){return this.connection.client}createScripts(){this.scripts=FC(this)}get redisVersion(){return this.connection.redisVersion}get Job(){return nR}emit(e,...t){try{return super.emit(e,...t)}catch(e){try{return super.emit("error",e)}catch(e){return console.error(e),!1}}}waitUntilReady(){return this.client}base64Name(){return Buffer.from(this.name).toString("base64")}clientName(e=""){const t=this.base64Name();return`${this.opts.prefix}:${t}${e}`}async close(){this.closing||(this.closing=this.connection.close()),await this.closing,this.closed=!0}disconnect(){return this.connection.disconnect()}async checkConnectionError(e,t=5e3){try{return await e()}catch(e){if(MC(e)&&this.emit("error",e),this.closing||!t)return;await OC(t)}}trace(e,t,n,r,a){return async function(e,t,n,r,a,i,o){if(!e)return i();{const{tracer:s,contextManager:l}=e,c=l.active();let u;o&&(u=l.fromMetadata(c,o));const d=a?`${r} ${a}`:r,p=s.startSpan(d,{kind:t},u);try{let e,a;return p.setAttributes({[iE.QueueName]:n,[iE.QueueOperation]:r}),e=t===oE.CONSUMER&&u?p.setSpanOnContext(u):p.setSpanOnContext(c),2==i.length&&(a=l.getMetadata(e)),await l.with(e,(()=>i(p,a)))}catch(e){throw p.recordException(e),e}finally{p.end()}}}(this.opts.telemetry,e,this.name,t,n,r,a)}}class OL extends AL{constructor(e,t,n){super(e,t,n),this.repeatStrategy=t.settings&&t.settings.repeatStrategy||KL}async upsertJobScheduler(e,t,n,r,a,{override:i,producerId:o}){const{every:s,limit:l,pattern:c,offset:u}=t;if(c&&s)throw new Error("Both .pattern and .every options are defined for this repeatable job");if(!c&&!s)throw new Error("Either .pattern or .every options must be defined for this repeatable job");if(t.immediately&&t.startDate)throw new Error("Both .immediately and .startDate options are defined for this repeatable job");t.immediately&&t.every&&console.warn("Using option immediately with every does not affect the job's schedule. Job will run immediately anyway.");const d=t.count?t.count+1:1;if(void 0!==t.limit&&d>t.limit)return;let p=Date.now();const{endDate:h}=t;if(h&&p>new Date(h).getTime())return;const m=a.prevMillis||0;p=m<p?p:m;const{startDate:f,immediately:y}=t,g=eR(t,["startDate","immediately"]);let b,v=p;f&&(v=new Date(f).getTime(),v=v>p?v:p);let w=null;if(s){const e=Math.floor((v-(u||0))/s)*s;w="number"==typeof u?u:v-e;const t=e+s;b=m||u?t:e}else c&&(b=await this.repeatStrategy(p,t,n),b<p&&(b=p));return b?this.trace(oE.PRODUCER,"add",`${this.name}.${n}`,(async(u,p)=>{var m,f;let y=a.telemetry;if(p){const e=null===(m=a.telemetry)||void 0===m?void 0:m.omitContext,t=(null===(f=a.telemetry)||void 0===f?void 0:f.metadata)||!e&&p;(t||e)&&(y={metadata:t,omitContext:e})}const v=this.getNextJobOpts(b,e,Object.assign(Object.assign({},a),{repeat:g,telemetry:y}),d,w);if(i){const i=await this.scripts.addJobScheduler(e,b,JSON.stringify(void 0===r?{}:r),nR.optsAsJSON(a),{name:n,endDate:h?new Date(h).getTime():void 0,tz:t.tz,pattern:c,every:s,limit:l,offset:w},nR.optsAsJSON(v),o),d=new this.Job(this,n,r,v,i);return d.id=i,null==u||u.setAttributes({[iE.JobSchedulerId]:e,[iE.JobId]:d.id}),d}{const t=await this.scripts.updateJobSchedulerNextMillis(e,b,JSON.stringify(void 0===r?{}:r),nR.optsAsJSON(v),o);if(t){const a=new this.Job(this,n,r,v,t);return a.id=t,null==u||u.setAttributes({[iE.JobSchedulerId]:e,[iE.JobId]:a.id}),a}}})):void 0}getNextJobOpts(e,t,n,r,a){var i;const o=this.getSchedulerNextJobId({jobSchedulerId:t,nextMillis:e}),s=Date.now(),l=e+a-s,c=Object.assign(Object.assign({},n),{jobId:o,delay:l<0?0:l,timestamp:s,prevMillis:e,repeatJobKey:t});return c.repeat=Object.assign(Object.assign({},n.repeat),{offset:a,count:r,endDate:(null===(i=n.repeat)||void 0===i?void 0:i.endDate)?new Date(n.repeat.endDate).getTime():void 0}),c}async removeJobScheduler(e){return this.scripts.removeJobScheduler(e)}async getSchedulerData(e,t,n){const r=await e.hgetall(this.toKey("repeat:"+t));return this.transformSchedulerData(t,r,n)}transformSchedulerData(e,t,n){if(t){const r={key:e,name:t.name,next:n};return t.ic&&(r.iterationCount=parseInt(t.ic)),t.limit&&(r.limit=parseInt(t.limit)),t.endDate&&(r.endDate=parseInt(t.endDate)),t.tz&&(r.tz=t.tz),t.pattern&&(r.pattern=t.pattern),t.every&&(r.every=parseInt(t.every)),t.offset&&(r.offset=parseInt(t.offset)),(t.data||t.opts)&&(r.template=this.getTemplateFromJSON(t.data,t.opts)),r}if(e.includes(":"))return this.keyToData(e,n)}keyToData(e,t){const n=e.split(":"),r=n.slice(4).join(":")||null;return{key:e,name:n[0],id:n[1]||null,endDate:parseInt(n[2])||null,tz:n[3]||null,pattern:r,next:t}}async getScheduler(e){const[t,n]=await this.scripts.getJobScheduler(e);return this.transformSchedulerData(e,t?TC(t):null,n?parseInt(n):null)}getTemplateFromJSON(e,t){const n={};return e&&(n.data=JSON.parse(e)),t&&(n.opts=nR.optsFromJSON(t)),n}async getJobSchedulers(e=0,t=-1,n=!1){const r=await this.client,a=this.keys.repeat,i=n?await r.zrange(a,e,t,"WITHSCORES"):await r.zrevrange(a,e,t,"WITHSCORES"),o=[];for(let e=0;e<i.length;e+=2)o.push(this.getSchedulerData(r,i[e],parseInt(i[e+1])));return Promise.all(o)}async getSchedulersCount(){const e=this.keys.repeat;return(await this.client).zcard(e)}getSchedulerNextJobId({nextMillis:e,jobSchedulerId:t}){return`repeat:${t}:${e}`}}const KL=(e,t)=>{const{pattern:n}=t,r=new Date(e),a=TL.parseExpression(n,Object.assign(Object.assign({},t),{currentDate:r}));try{return t.immediately?(new Date).getTime():a.next().getTime()}catch(e){}};class CL extends AL{constructor(e,t={connection:{}},n){var{connection:r,autorun:a=!0}=t,i=eR(t,["connection","autorun"]);super(e,Object.assign(Object.assign({},i),{connection:PC(r)?r.duplicate():r}),n,!0),this.running=!1,this.opts=Object.assign({blockingTimeout:1e4},this.opts),a&&this.run().catch((e=>this.emit("error",e)))}emit(e,...t){return super.emit(e,...t)}off(e,t){return super.off(e,t),this}on(e,t){return super.on(e,t),this}once(e,t){return super.once(e,t),this}async run(){if(this.running)throw new Error("Queue Events is already running.");try{this.running=!0;const e=await this.client;try{await e.client("SETNAME",this.clientName(":qe"))}catch(e){if(!LC.test(e.message))throw e}await this.consumeEvents(e)}catch(e){throw this.running=!1,e}}async consumeEvents(e){const t=this.opts,n=this.keys.events;let r=t.lastEventId||"$";for(;!this.closing;){const a=await this.checkConnectionError((()=>e.xread("BLOCK",t.blockingTimeout,"STREAMS",n,r)));if(a){const e=a[0][1];for(let t=0;t<e.length;t++){r=e[t][0];const n=TC(e[t][1]);switch(n.event){case"progress":n.data=JSON.parse(n.data);break;case"completed":n.returnvalue=JSON.parse(n.returnvalue)}const{event:a}=n,i=eR(n,["event"]);"drained"===a?this.emit(a,r):(this.emit(a,i,r),i.jobId&&this.emit(`${a}:${i.jobId}`,i,r))}}}}close(){return this.closing||(this.closing=this.disconnect()),this.closing}}class RL extends AL{getJob(e){return this.Job.fromId(this,e)}commandByType(e,t,n){return e.map((e=>{e="waiting"===e?"wait":e;const r=this.toKey(e);switch(e){case"completed":case"failed":case"delayed":case"prioritized":case"repeat":case"waiting-children":return n(r,t?"zcard":"zrange");case"active":case"wait":case"paused":return n(r,t?"llen":"lrange")}}))}sanitizeJobTypes(e){const t="string"==typeof e?[e]:e;if(Array.isArray(t)&&t.length>0){const e=[...t];return-1!==e.indexOf("waiting")&&e.push("paused"),[...new Set(e)]}return["active","completed","delayed","failed","paused","prioritized","waiting","waiting-children"]}async count(){return await this.getJobCountByTypes("waiting","paused","delayed","prioritized","waiting-children")}async getRateLimitTtl(e){return this.scripts.getRateLimitTtl(e)}async getDebounceJobId(e){return(await this.client).get(`${this.keys.de}:${e}`)}async getDeduplicationJobId(e){return(await this.client).get(`${this.keys.de}:${e}`)}async getJobCountByTypes(...e){const t=await this.getJobCounts(...e);return Object.values(t).reduce(((e,t)=>e+t),0)}async getJobCounts(...e){const t=this.sanitizeJobTypes(e),n=await this.scripts.getCounts(t),r={};return n.forEach(((e,n)=>{r[t[n]]=e||0})),r}getJobState(e){return this.scripts.getState(e)}getCompletedCount(){return this.getJobCountByTypes("completed")}getFailedCount(){return this.getJobCountByTypes("failed")}getDelayedCount(){return this.getJobCountByTypes("delayed")}getActiveCount(){return this.getJobCountByTypes("active")}getPrioritizedCount(){return this.getJobCountByTypes("prioritized")}async getCountsPerPriority(e){const t=[...new Set(e)],n=await this.scripts.getCountsPerPriority(t),r={};return n.forEach(((e,n)=>{r[`${t[n]}`]=e||0})),r}getWaitingCount(){return this.getJobCountByTypes("waiting")}getWaitingChildrenCount(){return this.getJobCountByTypes("waiting-children")}getWaiting(e=0,t=-1){return this.getJobs(["waiting"],e,t,!0)}getWaitingChildren(e=0,t=-1){return this.getJobs(["waiting-children"],e,t,!0)}getActive(e=0,t=-1){return this.getJobs(["active"],e,t,!0)}getDelayed(e=0,t=-1){return this.getJobs(["delayed"],e,t,!0)}getPrioritized(e=0,t=-1){return this.getJobs(["prioritized"],e,t,!0)}getCompleted(e=0,t=-1){return this.getJobs(["completed"],e,t,!1)}getFailed(e=0,t=-1){return this.getJobs(["failed"],e,t,!1)}async getDependencies(e,t,n,r){const a=this.toKey("processed"==t?`${e}:processed`:`${e}:dependencies`),{items:i,total:o,jobs:s}=await this.scripts.paginate(a,{start:n,end:r,fetchJobs:!0});return{items:i,jobs:s,total:o}}async getRanges(e,t=0,n=1,r=!1){const a=[];this.commandByType(e,!1,((e,t)=>{switch(t){case"lrange":a.push("lrange");break;case"zrange":a.push("zrange")}}));const i=await this.scripts.getRanges(e,t,n,r);let o=[];return i.forEach(((e,t)=>{const n=e||[];o=r&&"lrange"===a[t]?o.concat(n.reverse()):o.concat(n)})),[...new Set(o)]}async getJobs(e,t=0,n=-1,r=!1){const a=this.sanitizeJobTypes(e),i=await this.getRanges(a,t,n,r);return Promise.all(i.map((e=>this.Job.fromId(this,e))))}async getJobLogs(e,t=0,n=-1,r=!0){const a=(await this.client).multi(),i=this.toKey(e+":logs");r?a.lrange(i,t,n):a.lrange(i,-(n+1),-(t+1)),a.llen(i);const o=await a.exec();return r||o[0][1].reverse(),{logs:o[0][1],count:o[1][1]}}async baseGetClients(e){const t=await this.client;try{const n=await t.client("LIST");return this.parseClientList(n,e)}catch(e){if(!LC.test(e.message))throw e;return[{name:"GCP does not support client list"}]}}getWorkers(){const e=`${this.clientName()}`,t=`${this.clientName()}:w:`;return this.baseGetClients((n=>n&&(n===e||n.startsWith(t))))}async getWorkersCount(){return(await this.getWorkers()).length}async getQueueEvents(){const e=`${this.clientName()}:qe`;return this.baseGetClients((t=>t===e))}async getMetrics(e,t=0,n=-1){const r=await this.client,a=this.toKey(`metrics:${e}`),i=`${a}:data`,o=r.multi();o.hmget(a,"count","prevTS","prevCount"),o.lrange(i,t,n),o.llen(i);const[s,l,c]=await o.exec(),[u,[d,p,h]]=s,[m,f]=l,[y,g]=c;if(u||m)throw u||m||y;return{meta:{count:parseInt(d||"0",10),prevTS:parseInt(p||"0",10),prevCount:parseInt(h||"0",10)},data:f,count:g}}parseClientList(e,t){const n=e.split(/\r?\n/),r=[];return n.forEach((e=>{const n={};e.split(" ").forEach((function(e){const t=e.indexOf("="),r=e.substring(0,t),a=e.substring(t+1);n[r]=a}));const a=n.name;t(a)&&(n.name=this.name,n.rawname=a,r.push(n))})),r}async exportPrometheusMetrics(e){const t=await this.getJobCounts(),n=[];n.push("# HELP bullmq_job_count Number of jobs in the queue by state"),n.push("# TYPE bullmq_job_count gauge");const r=e?Object.keys(e).reduce(((t,n)=>`${t}, ${n}="${e[n]}"`),""):"";for(const[e,a]of Object.entries(t))n.push(`bullmq_job_count{queue="${this.name}", state="${e}"${r}} ${a}`);return n.join("\n")}}class jL extends AL{constructor(e,t,n){super(e,t,n),this.repeatStrategy=t.settings&&t.settings.repeatStrategy||DL,this.repeatKeyHashAlgorithm=t.settings&&t.settings.repeatKeyHashAlgorithm||"md5"}async updateRepeatableJob(e,t,n,{override:r}){var a,i;const o=Object.assign({},n.repeat);null!==(a=o.pattern)&&void 0!==a||(o.pattern=o.cron),delete o.cron;const s=o.count?o.count+1:1;if(void 0!==o.limit&&s>o.limit)return;let l=Date.now();const{endDate:c}=o;if(c&&l>new Date(c).getTime())return;const u=n.prevMillis||0;l=u<l?l:u;const d=await this.repeatStrategy(l,o,e),{every:p,pattern:h}=o,m=Boolean((p||h)&&o.immediately),f=m&&p?l-d:void 0;if(d){!u&&n.jobId&&(o.jobId=n.jobId);const a=PL(e,o),l=null!==(i=n.repeat.key)&&void 0!==i?i:this.hash(a);let y;if(r)y=await this.scripts.addRepeatableJob(l,d,{name:e,endDate:c?new Date(c).getTime():void 0,tz:o.tz,pattern:h,every:p},a);else{const e=await this.client;y=await this.scripts.updateRepeatableJobMillis(e,l,d,a)}const g=eR(o,["immediately"]);return this.createNextJob(e,d,y,Object.assign(Object.assign({},n),{repeat:Object.assign({offset:f},g)}),t,s,m)}}async createNextJob(e,t,n,r,a,i,o){const s=this.getRepeatJobKey(e,t,n,a),l=Date.now(),c=t+(r.repeat.offset?r.repeat.offset:0)-l,u=Object.assign(Object.assign({},r),{jobId:s,delay:c<0||o?0:c,timestamp:l,prevMillis:t,repeatJobKey:n});return u.repeat=Object.assign(Object.assign({},r.repeat),{count:i}),this.Job.create(this,e,a,u)}getRepeatJobKey(e,t,n,r){return n.split(":").length>2?this.getRepeatJobId({name:e,nextMillis:t,namespace:this.hash(n),jobId:null==r?void 0:r.id}):this.getRepeatDelayedJobId({customKey:n,nextMillis:t})}async removeRepeatable(e,t,n){var r;const a=PL(e,Object.assign(Object.assign({},t),{jobId:n})),i=null!==(r=t.key)&&void 0!==r?r:this.hash(a),o=this.getRepeatJobId({name:e,nextMillis:"",namespace:this.hash(a),jobId:null!=n?n:t.jobId,key:t.key});return this.scripts.removeRepeatable(o,a,i)}async removeRepeatableByKey(e){const t=this.keyToData(e),n=this.getRepeatJobId({name:t.name,nextMillis:"",namespace:this.hash(e),jobId:t.id});return this.scripts.removeRepeatable(n,"",e)}async getRepeatableData(e,t,n){const r=await e.hgetall(this.toKey("repeat:"+t));return r?{key:t,name:r.name,endDate:parseInt(r.endDate)||null,tz:r.tz||null,pattern:r.pattern||null,every:r.every||null,next:n}:this.keyToData(t,n)}keyToData(e,t){const n=e.split(":"),r=n.slice(4).join(":")||null;return{key:e,name:n[0],id:n[1]||null,endDate:parseInt(n[2])||null,tz:n[3]||null,pattern:r,next:t}}async getRepeatableJobs(e=0,t=-1,n=!1){const r=await this.client,a=this.keys.repeat,i=n?await r.zrange(a,e,t,"WITHSCORES"):await r.zrevrange(a,e,t,"WITHSCORES"),o=[];for(let e=0;e<i.length;e+=2)o.push(this.getRepeatableData(r,i[e],parseInt(i[e+1])));return Promise.all(o)}async getRepeatableCount(){return(await this.client).zcard(this.toKey("repeat"))}hash(e){return c.createHash(this.repeatKeyHashAlgorithm).update(e).digest("hex")}getRepeatDelayedJobId({nextMillis:e,customKey:t}){return`repeat:${t}:${e}`}getRepeatJobId({name:e,nextMillis:t,namespace:n,jobId:r,key:a}){return`repeat:${null!=a?a:this.hash(`${e}${r||""}${n}`)}:${t}`}}function PL(e,t){const n=t.endDate?new Date(t.endDate).getTime():"",r=t.tz||"",a=t.pattern,i=a||String(t.every)||"";return`${e}:${t.jobId?t.jobId:""}:${n}:${r}:${i}`}const DL=(e,t)=>{const n=t.pattern;if(n&&t.every)throw new Error("Both .pattern and .every options are defined for this repeatable job");if(t.every)return Math.floor(e/t.every)*t.every+(t.immediately?0:t.every);const r=t.startDate&&new Date(t.startDate)>new Date(e)?new Date(t.startDate):new Date(e),a=TL.parseExpression(n,Object.assign(Object.assign({},t),{currentDate:r}));try{return t.immediately?(new Date).getTime():a.next().getTime()}catch(e){}};class NL extends RL{constructor(e,t,n){var r;super(e,Object.assign({},t),n),this.token=XC(),this.libName="bullmq",this.jobsOpts=null!==(r=null==t?void 0:t.defaultJobOptions)&&void 0!==r?r:{},this.waitUntilReady().then((e=>{if(!this.closing&&!(null==t?void 0:t.skipMetasUpdate))return e.hmset(this.keys.meta,this.metaValues)})).catch((e=>{}))}emit(e,...t){return super.emit(e,...t)}off(e,t){return super.off(e,t),this}on(e,t){return super.on(e,t),this}once(e,t){return super.once(e,t),this}get defaultJobOptions(){return Object.assign({},this.jobsOpts)}get metaValues(){var e,t,n,r;return{"opts.maxLenEvents":null!==(r=null===(n=null===(t=null===(e=this.opts)||void 0===e?void 0:e.streams)||void 0===t?void 0:t.events)||void 0===n?void 0:n.maxLen)&&void 0!==r?r:1e4,version:`${this.libName}:5.56.0`}}async getVersion(){const e=await this.client;return await e.hget(this.keys.meta,"version")}get repeat(){return new Promise((async e=>{this._repeat||(this._repeat=new jL(this.name,Object.assign(Object.assign({},this.opts),{connection:await this.client})),this._repeat.on("error",(e=>this.emit.bind(this,e)))),e(this._repeat)}))}get jobScheduler(){return new Promise((async e=>{this._jobScheduler||(this._jobScheduler=new OL(this.name,Object.assign(Object.assign({},this.opts),{connection:await this.client})),this._jobScheduler.on("error",(e=>this.emit.bind(this,e)))),e(this._jobScheduler)}))}async getGlobalConcurrency(){const e=await this.client,t=await e.hget(this.keys.meta,"concurrency");return t?Number(t):null}async setGlobalConcurrency(e){return(await this.client).hset(this.keys.meta,"concurrency",e)}async removeGlobalConcurrency(){return(await this.client).hdel(this.keys.meta,"concurrency")}async add(e,t,n){return this.trace(oE.PRODUCER,"add",`${this.name}.${e}`,(async(r,a)=>{var i;if(a&&!(null===(i=null==n?void 0:n.telemetry)||void 0===i?void 0:i.omitContext)){const e={metadata:a};n=Object.assign(Object.assign({},n),{telemetry:e})}const o=await this.addJob(e,t,n);return null==r||r.setAttributes({[iE.JobName]:e,[iE.JobId]:o.id}),o}))}async addJob(e,t,n){if(n&&n.repeat){if(n.repeat.endDate&&+new Date(n.repeat.endDate)<Date.now())throw new Error("End date must be greater than current timestamp");return(await this.repeat).updateRepeatableJob(e,t,Object.assign(Object.assign({},this.jobsOpts),n),{override:!0})}{const r=null==n?void 0:n.jobId;if("0"==r||(null==r?void 0:r.startsWith("0:")))throw new Error("JobId cannot be '0' or start with 0:");const a=await this.Job.create(this,e,t,Object.assign(Object.assign(Object.assign({},this.jobsOpts),n),{jobId:r}));return this.emit("waiting",a),a}}async addBulk(e){return this.trace(oE.PRODUCER,"addBulk",this.name,(async(t,n)=>(t&&t.setAttributes({[iE.BulkNames]:e.map((e=>e.name)),[iE.BulkCount]:e.length}),await this.Job.createBulk(this,e.map((e=>{var t,r,a,i,o,s;let l=null===(t=e.opts)||void 0===t?void 0:t.telemetry;if(n){const t=null===(a=null===(r=e.opts)||void 0===r?void 0:r.telemetry)||void 0===a?void 0:a.omitContext,s=(null===(o=null===(i=e.opts)||void 0===i?void 0:i.telemetry)||void 0===o?void 0:o.metadata)||!t&&n;(s||t)&&(l={metadata:s,omitContext:t})}return{name:e.name,data:e.data,opts:Object.assign(Object.assign(Object.assign({},this.jobsOpts),e.opts),{jobId:null===(s=e.opts)||void 0===s?void 0:s.jobId,telemetry:l})}}))))))}async upsertJobScheduler(e,t,n){var r,a;if(t.endDate&&+new Date(t.endDate)<Date.now())throw new Error("End date must be greater than current timestamp");return(await this.jobScheduler).upsertJobScheduler(e,t,null!==(r=null==n?void 0:n.name)&&void 0!==r?r:e,null!==(a=null==n?void 0:n.data)&&void 0!==a?a:{},Object.assign(Object.assign({},this.jobsOpts),null==n?void 0:n.opts),{override:!0})}async pause(){await this.trace(oE.INTERNAL,"pause",this.name,(async()=>{await this.scripts.pause(!0),this.emit("paused")}))}async close(){await this.trace(oE.INTERNAL,"close",this.name,(async()=>{this.closing||this._repeat&&await this._repeat.close(),await super.close()}))}async rateLimit(e){await this.trace(oE.INTERNAL,"rateLimit",this.name,(async t=>{null==t||t.setAttributes({[iE.QueueRateLimit]:e}),await this.client.then((t=>t.set(this.keys.limiter,Number.MAX_SAFE_INTEGER,"PX",e)))}))}async resume(){await this.trace(oE.INTERNAL,"resume",this.name,(async()=>{await this.scripts.pause(!1),this.emit("resumed")}))}async isPaused(){const e=await this.client;return 1===await e.hexists(this.keys.meta,"paused")}isMaxed(){return this.scripts.isMaxed()}async getRepeatableJobs(e,t,n){return(await this.repeat).getRepeatableJobs(e,t,n)}async getJobScheduler(e){return(await this.jobScheduler).getScheduler(e)}async getJobSchedulers(e,t,n){return(await this.jobScheduler).getJobSchedulers(e,t,n)}async getJobSchedulersCount(){return(await this.jobScheduler).getSchedulersCount()}async removeRepeatable(e,t,n){return this.trace(oE.INTERNAL,"removeRepeatable",`${this.name}.${e}`,(async r=>{null==r||r.setAttributes({[iE.JobName]:e,[iE.JobId]:n});const a=await this.repeat;return!await a.removeRepeatable(e,t,n)}))}async removeJobScheduler(e){const t=await this.jobScheduler;return!await t.removeJobScheduler(e)}async removeDebounceKey(e){return this.trace(oE.INTERNAL,"removeDebounceKey",`${this.name}`,(async t=>{null==t||t.setAttributes({[iE.JobKey]:e});const n=await this.client;return await n.del(`${this.keys.de}:${e}`)}))}async removeDeduplicationKey(e){return this.trace(oE.INTERNAL,"removeDeduplicationKey",`${this.name}`,(async t=>{null==t||t.setAttributes({[iE.DeduplicationKey]:e});return(await this.client).del(`${this.keys.de}:${e}`)}))}async removeRateLimitKey(){return(await this.client).del(this.keys.limiter)}async removeRepeatableByKey(e){return this.trace(oE.INTERNAL,"removeRepeatableByKey",`${this.name}`,(async t=>{null==t||t.setAttributes({[iE.JobKey]:e});const n=await this.repeat;return!await n.removeRepeatableByKey(e)}))}async remove(e,{removeChildren:t=!0}={}){return this.trace(oE.INTERNAL,"remove",this.name,(async n=>(null==n||n.setAttributes({[iE.JobId]:e,[iE.JobOptions]:JSON.stringify({removeChildren:t})}),await this.scripts.remove(e,t))))}async updateJobProgress(e,t){await this.trace(oE.INTERNAL,"updateJobProgress",this.name,(async n=>{null==n||n.setAttributes({[iE.JobId]:e,[iE.JobProgress]:JSON.stringify(t)}),await this.scripts.updateProgress(e,t)}))}async addJobLog(e,t,n){return nR.addJobLog(this,e,t,n)}async drain(e=!1){await this.trace(oE.INTERNAL,"drain",this.name,(async t=>{null==t||t.setAttributes({[iE.QueueDrainDelay]:e}),await this.scripts.drain(e)}))}async clean(e,t,n="completed"){return this.trace(oE.INTERNAL,"clean",this.name,(async r=>{const a=t||1/0,i=Math.min(1e4,a),o=Date.now()-e;let s=0;const l=[];for(;s<a;){const e=await this.scripts.cleanJobsInSet(n,o,i);if(this.emit("cleaned",e,n),s+=e.length,l.push(...e),e.length<i)break}return null==r||r.setAttributes({[iE.QueueGrace]:e,[iE.JobType]:n,[iE.QueueCleanLimit]:a,[iE.JobIds]:l}),l}))}async obliterate(e){await this.trace(oE.INTERNAL,"obliterate",this.name,(async()=>{await this.pause();let t=0;do{t=await this.scripts.obliterate(Object.assign({force:!1,count:1e3},e))}while(t)}))}async retryJobs(e={}){await this.trace(oE.PRODUCER,"retryJobs",this.name,(async t=>{null==t||t.setAttributes({[iE.QueueOptions]:JSON.stringify(e)});let n=0;do{n=await this.scripts.retryJobs(e.state,e.count,e.timestamp)}while(n)}))}async promoteJobs(e={}){await this.trace(oE.INTERNAL,"promoteJobs",this.name,(async t=>{null==t||t.setAttributes({[iE.QueueOptions]:JSON.stringify(e)});let n=0;do{n=await this.scripts.promoteJobs(e.count)}while(n)}))}async trimEvents(e){return this.trace(oE.INTERNAL,"trimEvents",this.name,(async t=>{null==t||t.setAttributes({[iE.QueueEventMaxLength]:e});const n=await this.client;return await n.xtrim(this.keys.events,"MAXLEN","~",e)}))}async removeDeprecatedPriorityKey(){return(await this.client).del(this.toKey("priority"))}}const{EventEmitter:LL}=W.default;class ML{constructor(){this.eventEmitter=new LL,this.onabort=null,this.aborted=!1,this.reason=void 0}toString(){return"[object AbortSignal]"}get[Symbol.toStringTag](){return"AbortSignal"}removeEventListener(e,t){this.eventEmitter.removeListener(e,t)}addEventListener(e,t){this.eventEmitter.on(e,t)}dispatchEvent(e){const t={type:e,target:this},n=`on${e}`;"function"==typeof this[n]&&this[n](t),this.eventEmitter.emit(e,t)}throwIfAborted(){if(this.aborted)throw this.reason}static abort(e){const t=new FL;return t.abort(),t.signal}static timeout(e){const t=new FL;return setTimeout((()=>t.abort(new Error("TimeoutError"))),e),t.signal}}class FL{constructor(){this.signal=new ML}abort(e){this.signal.aborted||(this.signal.aborted=!0,this.signal.reason=e||new Error("AbortError"),this.signal.dispatchEvent("abort"))}toString(){return"[object AbortController]"}get[Symbol.toStringTag](){return"AbortController"}}var BL={AbortController:FL,AbortSignal:ML};class VL extends AL{static RateLimitError(){return new GC}constructor(e,t,r,a){if(super(e,Object.assign(Object.assign({drainDelay:5,concurrency:1,lockDuration:3e4,maxStalledCount:1,stalledInterval:3e4,autorun:!0,runRetryDelay:15e3},r),{blockingConnection:!0}),a),this.abortDelayController=null,this.blockUntil=0,this.drained=!1,this.extendLocksTimer=null,this.limitUntil=0,this.waiting=null,this.running=!1,this.mainLoopRunning=null,!r||!r.connection)throw new Error("Worker requires a connection");if("number"!=typeof this.opts.maxStalledCount||this.opts.maxStalledCount<0)throw new Error("maxStalledCount must be greater or equal than 0");if("number"!=typeof this.opts.stalledInterval||this.opts.stalledInterval<=0)throw new Error("stalledInterval must be greater than 0");if("number"!=typeof this.opts.drainDelay||this.opts.drainDelay<=0)throw new Error("drainDelay must be greater than 0");if(this.concurrency=this.opts.concurrency,this.opts.lockRenewTime=this.opts.lockRenewTime||this.opts.lockDuration/2,this.id=XC(),t){if("function"==typeof t)this.processFn=t;else{if(t instanceof n.URL){if(!F.existsSync(t))throw new Error(`URL ${t} does not exist in the local file system`);t=t.href}else{const e=t+([".js",".ts",".flow",".cjs"].includes(L.extname(t))?"":".js");if(!F.existsSync(e))throw new Error(`File ${e} does not exist`)}const e=L.dirname(module.filename||__filename),r=L.join(e,"main-worker.js"),a=L.join(e,"main.js");let s=this.opts.useWorkerThreads?r:a;try{F.statSync(s)}catch(e){const t=this.opts.useWorkerThreads?"main-worker.js":"main.js";s=L.join(process.cwd(),`dist/cjs/classes/${t}`),F.statSync(s)}this.childPool=new gE({mainFile:s,useWorkerThreads:this.opts.useWorkerThreads,workerForkOptions:this.opts.workerForkOptions,workerThreadsOptions:this.opts.workerThreadsOptions}),this.processFn=(i=t,o=this.childPool,async function(e,t){let n,r,a;try{const s=new Promise(((s,l)=>{(async()=>{try{a=(e,t)=>{l(new Error("Unexpected exit code: "+e+" signal: "+t))},n=await o.retain(i),n.on("exit",a),r=async t=>{var r,a,i;try{switch(t.cmd){case rE.Completed:s(t.value);break;case rE.Failed:case rE.Error:{const e=new Error;Object.assign(e,t.value),l(e);break}case rE.Progress:await e.updateProgress(t.value);break;case rE.Log:await e.log(t.value);break;case rE.MoveToDelayed:await e.moveToDelayed(null===(r=t.value)||void 0===r?void 0:r.timestamp,null===(a=t.value)||void 0===a?void 0:a.token);break;case rE.MoveToWait:await e.moveToWait(null===(i=t.value)||void 0===i?void 0:i.token);break;case rE.Update:await e.updateData(t.value);break;case rE.GetChildrenValues:{const r=await e.getChildrenValues();n.send({requestId:t.requestId,cmd:tE.GetChildrenValuesResponse,value:r})}break;case rE.GetIgnoredChildrenFailures:{const r=await e.getIgnoredChildrenFailures();n.send({requestId:t.requestId,cmd:tE.GetIgnoredChildrenFailuresResponse,value:r})}}}catch(e){l(e)}},n.on("message",r),n.send({cmd:tE.Start,job:e.asJSONSandbox(),token:t})}catch(e){l(e)}})()}));return await s,s}finally{n&&(n.off("message",r),n.off("exit",a),null===n.exitCode&&null===n.signalCode&&o.release(n))}}).bind(this)}this.opts.autorun&&this.run().catch((e=>this.emit("error",e)))}var i,o;const s=this.clientName()+(this.opts.name?`:w:${this.opts.name}`:"");this.blockingConnection=new tj(PC(r.connection)?r.connection.duplicate({connectionName:s}):Object.assign(Object.assign({},r.connection),{connectionName:s}),{shared:!1,blocking:!0,skipVersionCheck:r.skipVersionCheck}),this.blockingConnection.on("error",(e=>this.emit("error",e))),this.blockingConnection.on("ready",(()=>setTimeout((()=>this.emit("ready")),0)))}emit(e,...t){return super.emit(e,...t)}off(e,t){return super.off(e,t),this}on(e,t){return super.on(e,t),this}once(e,t){return super.once(e,t),this}callProcessJob(e,t){return this.processFn(e,t)}createJob(e,t){return this.Job.fromJSON(this,e,t)}async waitUntilReady(){return await super.waitUntilReady(),this.blockingConnection.client}set concurrency(e){if("number"!=typeof e||e<1||!isFinite(e))throw new Error("concurrency must be a finite number greater than 0");this._concurrency=e}get concurrency(){return this._concurrency}get repeat(){return new Promise((async e=>{if(!this._repeat){const e=await this.client;this._repeat=new jL(this.name,Object.assign(Object.assign({},this.opts),{connection:e})),this._repeat.on("error",(e=>this.emit.bind(this,e)))}e(this._repeat)}))}get jobScheduler(){return new Promise((async e=>{if(!this._jobScheduler){const e=await this.client;this._jobScheduler=new OL(this.name,Object.assign(Object.assign({},this.opts),{connection:e})),this._jobScheduler.on("error",(e=>this.emit.bind(this,e)))}e(this._jobScheduler)}))}async run(){if(!this.processFn)throw new Error("No process function is defined.");if(this.running)throw new Error("Worker is already running.");try{if(this.running=!0,this.closing||this.paused)return;await this.startStalledCheckTimer();const e=await this.client,t=await this.blockingConnection.client;this.mainLoopRunning=this.mainLoop(e,t),await this.mainLoopRunning}finally{this.running=!1}}async waitForRateLimit(){var e;const t=this.limitUntil;if(t>Date.now()){null===(e=this.abortDelayController)||void 0===e||e.abort(),this.abortDelayController=new BL.AbortController;const n=this.getRateLimitDelay(t-Date.now());await this.delay(n,this.abortDelayController)}}async mainLoop(e,t){const n=new dE,r=new Set;this.startLockExtenderTimer(r);let a=0;for(;!this.closing&&!this.paused;){let i,o=n.numTotal();for(;!this.closing&&!this.paused&&!this.waiting&&o<this._concurrency&&!this.isRateLimited();){const r=`${this.id}:${a++}`,i=this.retryIfFailed((()=>this._getNextJob(e,t,r,{block:!0})),this.opts.runRetryDelay);if(n.add(i),o=n.numTotal(),this.waiting&&o>1)break;if(!await i&&o>1)break;if(this.blockUntil)break}do{i=await n.fetch()}while(!i&&n.numQueued()>0);if(i){const e=i.token;n.add(this.retryIfFailed((()=>this.processJob(i,e,(()=>n.numTotal()<=this._concurrency),r)),this.opts.runRetryDelay))}else this.isRateLimited()&&await this.waitForRateLimit()}return n.waitAll()}async getNextJob(e,{block:t=!0}={}){var n,r;const a=await this._getNextJob(await this.client,await this.blockingConnection.client,e,{block:t});return this.trace(oE.INTERNAL,"getNextJob",this.name,(async e=>(null==e||e.setAttributes({[iE.WorkerId]:this.id,[iE.QueueName]:this.name,[iE.WorkerName]:this.opts.name,[iE.WorkerOptions]:JSON.stringify({block:t}),[iE.JobId]:null==a?void 0:a.id}),a)),null===(r=null===(n=null==a?void 0:a.opts)||void 0===n?void 0:n.telemetry)||void 0===r?void 0:r.metadata)}async _getNextJob(e,t,n,{block:r=!0}={}){if(!this.paused&&!this.closing){if(!this.drained||!r||this.limitUntil||this.waiting)return await this.waitForRateLimit(),this.moveToActive(e,n,this.opts.name);this.waiting=this.waitForJob(t,this.blockUntil);try{if(this.blockUntil=await this.waiting,this.blockUntil<=0||this.blockUntil-Date.now()<1)return await this.moveToActive(e,n,this.opts.name)}catch(e){if(!this.paused&&!this.closing&&MC(e))throw e}finally{this.waiting=null}}}async rateLimit(e){await this.trace(oE.INTERNAL,"rateLimit",this.name,(async t=>{null==t||t.setAttributes({[iE.WorkerId]:this.id,[iE.WorkerRateLimit]:e}),await this.client.then((t=>t.set(this.keys.limiter,Number.MAX_SAFE_INTEGER,"PX",e)))}))}get minimumBlockTimeout(){return this.blockingConnection.capabilities.canBlockFor1Ms?.001:.002}isRateLimited(){return this.limitUntil>Date.now()}async moveToActive(e,t,n){const[r,a,i,o]=await this.scripts.moveToActive(e,t,n);return this.updateDelays(i,o),this.nextJobFromJobData(r,a,t)}async waitForJob(e,t){if(this.paused)return 1/0;let n;try{if(!this.closing&&!this.isRateLimited()){let r=this.getBlockTimeout(t);if(r>0){r=this.blockingConnection.capabilities.canDoubleTimeout?r:Math.ceil(r),n=setTimeout((async()=>{e.disconnect(!this.closing)}),1e3*r+1e3),this.updateDelays();const t=await e.bzpopmin(this.keys.marker,r);if(t){const[e,n,r]=t;if(n)return parseInt(r)}}return 0}}catch(e){MC(e)&&this.emit("error",e),this.closing||await this.delay()}finally{clearTimeout(n)}return 1/0}getBlockTimeout(e){const t=this.opts;if(e){const t=e-Date.now();return t<=0?t:t<1e3*this.minimumBlockTimeout?this.minimumBlockTimeout:Math.min(t/1e3,10)}return Math.max(t.drainDelay,this.minimumBlockTimeout)}getRateLimitDelay(e){return Math.min(e,3e4)}async delay(e,t){await OC(e||100,t)}updateDelays(e=0,t=0){const n=Math.max(e,0);this.limitUntil=n>0?Date.now()+n:0,this.blockUntil=Math.max(t,0)||0}async nextJobFromJobData(e,t,n){if(e){this.drained=!1;const r=this.createJob(e,t);if(r.token=n,r.opts.repeat&&!r.nextRepeatableJobId)if(r.repeatJobKey){const e=await this.jobScheduler;await e.upsertJobScheduler(r.repeatJobKey,r.opts.repeat,r.name,r.data,r.opts,{override:!1,producerId:r.id})}else{const e=await this.repeat;await e.updateRepeatableJob(r.name,r.data,r.opts,{override:!1})}return r}this.drained||(this.emit("drained"),this.drained=!0)}async processJob(e,t,n=(()=>!0),r){var a,i;const o=null===(i=null===(a=e.opts)||void 0===a?void 0:a.telemetry)||void 0===i?void 0:i.metadata;return this.trace(oE.CONSUMER,"process",this.name,(async a=>{null==a||a.setAttributes({[iE.WorkerId]:this.id,[iE.WorkerName]:this.opts.name,[iE.JobId]:e.id}),this.emit("active",e,"waiting");const i=Date.now(),o={job:e,ts:i};try{if(e.deferredFailure){return await this.handleFailed(new $C(e.deferredFailure),e,t,n,r,o,a)}r.add(o);const s=await this.callProcessJob(e,t);return await this.handleCompleted(s,e,t,n,r,o,a)}catch(i){return await this.handleFailed(i,e,t,n,r,o,a)}finally{null==a||a.setAttributes({[iE.JobFinishedTimestamp]:Date.now(),[iE.JobProcessedTimestamp]:i})}}),o)}async handleCompleted(e,t,n,r=(()=>!0),a,i,o){if(a.delete(i),!this.connection.closing){const a=await t.moveToCompleted(e,n,r()&&!(this.closing||this.paused));this.emit("completed",t,e,"active"),null==o||o.addEvent("job completed",{[iE.JobResult]:JSON.stringify(e)});const[i,s,l,c]=a||[];return this.updateDelays(l,c),this.nextJobFromJobData(i,s,n)}}async handleFailed(e,t,n,r=(()=>!0),a,i,o){if(a.delete(i),!this.connection.closing)try{if("bullmq:rateLimitExceeded"==e.message){const e=await this.moveLimitedBackToWait(t,n);return void(this.limitUntil=e>0?Date.now()+e:0)}if(e instanceof JC||"DelayedError"==e.name||e instanceof zC||"WaitingError"==e.name||e instanceof qC||"WaitingChildrenError"==e.name)return;const a=await t.moveToFailed(e,n,r()&&!(this.closing||this.paused));if(this.emit("failed",t,e,"active"),null==o||o.addEvent("job failed",{[iE.JobFailedReason]:e.message}),a){const[e,t,r,i]=a;return this.updateDelays(r,i),this.nextJobFromJobData(e,t,n)}}catch(e){this.emit("error",e),null==o||o.recordException(e.message)}}async pause(e){await this.trace(oE.INTERNAL,"pause",this.name,(async t=>{var n;null==t||t.setAttributes({[iE.WorkerId]:this.id,[iE.WorkerName]:this.opts.name,[iE.WorkerDoNotWaitActive]:e}),this.paused||(this.paused=!0,await(!e&&this.whenCurrentJobsFinished()),null===(n=this.stalledCheckStopper)||void 0===n||n.call(this),this.emit("paused"))}))}resume(){this.running||this.trace(oE.INTERNAL,"resume",this.name,(e=>{null==e||e.setAttributes({[iE.WorkerId]:this.id,[iE.WorkerName]:this.opts.name}),this.paused=!1,this.processFn&&this.run(),this.emit("resumed")}))}isPaused(){return!!this.paused}isRunning(){return this.running}async close(e=!1){return this.closing?this.closing:(this.closing=(async()=>{await this.trace(oE.INTERNAL,"close",this.name,(async t=>{var n,r;null==t||t.setAttributes({[iE.WorkerId]:this.id,[iE.WorkerName]:this.opts.name,[iE.WorkerForceClose]:e}),this.emit("closing","closing queue"),null===(n=this.abortDelayController)||void 0===n||n.abort();const a=[()=>e||this.whenCurrentJobsFinished(!1),()=>{var e;return null===(e=this.childPool)||void 0===e?void 0:e.clean()},()=>this.blockingConnection.close(e),()=>this.connection.close(e)];for(const e of a)try{await e()}catch(e){this.emit("error",e)}clearTimeout(this.extendLocksTimer),null===(r=this.stalledCheckStopper)||void 0===r||r.call(this),this.closed=!0,this.emit("closed")}))})(),await this.closing)}async startStalledCheckTimer(){this.opts.skipStalledCheck||this.closing||await this.trace(oE.INTERNAL,"startStalledCheckTimer",this.name,(async e=>{null==e||e.setAttributes({[iE.WorkerId]:this.id,[iE.WorkerName]:this.opts.name}),this.stalledChecker().catch((e=>{this.emit("error",e)}))}))}async stalledChecker(){for(;!this.closing&&!this.paused;){try{await this.checkConnectionError((()=>this.moveStalledJobsToWait()))}catch(e){this.emit("error",e)}await new Promise((e=>{const t=setTimeout(e,this.opts.stalledInterval);this.stalledCheckStopper=()=>{clearTimeout(t),e()}}))}}startLockExtenderTimer(e){this.opts.skipLockRenewal||(clearTimeout(this.extendLocksTimer),this.closed||(this.extendLocksTimer=setTimeout((async()=>{const t=Date.now(),n=[];for(const r of e){const{job:e,ts:a}=r;a?a+this.opts.lockRenewTime/2<t&&(r.ts=t,n.push(e)):r.ts=t}try{n.length&&await this.extendLocks(n)}catch(e){this.emit("error",e)}this.startLockExtenderTimer(e)}),this.opts.lockRenewTime/2)))}async whenCurrentJobsFinished(e=!0){this.waiting?await this.blockingConnection.disconnect(e):e=!1,this.mainLoopRunning&&await this.mainLoopRunning,e&&await this.blockingConnection.reconnect()}async retryIfFailed(e,t){for(;;)try{return await e()}catch(e){if(this.emit("error",e),!t)return;await this.delay(t)}}async extendLocks(e){await this.trace(oE.INTERNAL,"extendLocks",this.name,(async t=>{null==t||t.setAttributes({[iE.WorkerId]:this.id,[iE.WorkerName]:this.opts.name,[iE.WorkerJobsToExtendLocks]:e.map((e=>e.id))});try{const t=await this.scripts.extendLocks(e.map((e=>e.id)),e.map((e=>e.token)),this.opts.lockDuration);for(const e of t)this.emit("error",new Error(`could not renew lock for job ${e}`))}catch(e){this.emit("error",e)}}))}async moveStalledJobsToWait(){await this.trace(oE.INTERNAL,"moveStalledJobsToWait",this.name,(async e=>{const t=await this.scripts.moveStalledJobsToWait();null==e||e.setAttributes({[iE.WorkerId]:this.id,[iE.WorkerName]:this.opts.name,[iE.WorkerStalledJobs]:t}),t.forEach((t=>{null==e||e.addEvent("job stalled",{[iE.JobId]:t}),this.emit("stalled",t,"active")}))}))}moveLimitedBackToWait(e,t){return e.moveToWait(t)}}var UL;!function(e){e.blocking="blocking",e.normal="normal"}(UL||(UL={}));const JL={host:process.env.CACHE_REDIS_HOST||"localhost",port:parseInt(process.env.CACHE_REDIS_PORT||"6379"),password:process.env.CACHE_PASSWORD||void 0,maxRetriesPerRequest:null},GL=new bE.exports.Redis(JL);if(!global.crypto){const e=require("crypto");global.crypto={getRandomValues:t=>(t&&e.randomFillSync(t),t),randomUUID:()=>e.randomUUID()}}const $L={},qL=e=>((e=>{$L[e]||($L[e]=new CL(`${e}`,{connection:GL}),$L[e].on("progress",(async(e,t)=>{console.log(`Job ${e} progress:`,t)})),$L[e].on("waiting",(e=>{console.log(`Job ${e} waiting`)})),$L[e].on("active",(e=>{console.log(`Job ${e} active`)})),$L[e].on("completed",(e=>{console.log(`Job ${e} completed`)})),$L[e].on("failed",((e,t)=>{console.log(`Job ${e} failed:`,t)})))})(e),new NL(`${e}`,{connection:GL}));new NL("voucher-fetch-queue",{connection:GL}),new CL("voucher-fetch-queue",{connection:GL});class zL{constructor(e,t){this.get=null,this.set=null,this.services=null,this.accountabilitySchema=null,this.itemsService=null,this.updateAccountabilitySchema=e=>{this.accountabilitySchema=e},this.redeemVoucher=async(e,t,n,r)=>{try{await(new Vi).log(`start redeem voucher! LinkId ${e} sku: ${t}`,!1,e,null);const a=qL("voucher-fetch-queue");this.workerNode("voucher-fetch-queue");const i=await a.add("redeem",{linkId:e,sku:t,token:n,env:r},{removeOnComplete:{count:0},removeOnFail:{count:0}});await a.getJobCounts();return await i.waitUntilFinished($L["voucher-fetch-queue"])}catch(t){return await(new Vi).log("redeemVoucher",!1,e,null),{success:!1,message:"Please contact Administrator",err_code:"EXC_ERR"}}},this.workers={},this.insertRedemptionAndUpdateLedger=async(e,t,n,r,a,i,o,s,l,c,u)=>{try{new Ui(this.itemsService,this.accountabilitySchema);const d=new Mi(this.itemsService,this.accountabilitySchema),{keys:p}=e;if((new Vi).log(`VPP NEW:${i} Keys RefId:${t} | keys:${p}`,!1,t,null),p&&p[0]&&p.length){const e=await d.insertVoucherRedemption(n,r,p[0],o,s,l,c,u),h="number"==typeof e&&Math.floor(e)===e;if((new Vi).log(`VPP NEW:${i} isInsertRedemptionSuc RefId:${t} | suc:${h}`,!1,t,null),h){const e=await d.updateLedgerTransactionOrderStatus(a,"successful",null,null);return(new Vi).log(`updateLedgerResponse: ${JSON.stringify(e)}`,!1,t,null),{success:!0,err_code:null}}return{success:!1,err_code:i?"NEW_INS_REDM_FAIL":"INS_REDM_FAIL"}}return{success:!1,err_code:i?"NEW_INV_KEYS_NULL":"INV_KEYS_NULL"}}catch(e){(new Vi).log(`insertRedemptionAndUpdateLedgerError${JSON.stringify(e)}`,!1,t,null)}},this.services=e,this.accountabilitySchema=t;const{ItemsService:n}=e;this.itemsService=n}async workerNode(e){return this.workers[e]||(this.workers[e]=new VL(e,(async t=>{try{switch(e){case"voucher-fetch-queue":await(new Vi).log(`workerNode! jobName ${e} job.data: ${JSON.stringify(t.data)}`,!1,t.data.linkId,null);return await this.processRedeemJob(t.data);case"soft-link-queue":await(new Vi).log(` getSoftLinkVouchers soft-link-queue jobName : ${e} job.data: ${JSON.stringify(t.data)}`,!1,t.data.link_reference_id,null);return await this.softLinkprocessRedeemJob(t.data);default:return{success:!1,message:"Job processing failed",err_code:"JOB_NOT_FOUND_ERROR"}}}catch(e){return{success:!1,message:"Job processing failed",err_code:"JOB_PROCESSING_ERROR"}}}),{connection:GL,concurrency:1,removeOnComplete:{count:0},removeOnFail:{count:0}})),this.workers[e]}async processRedeemJob(e){var t,n,r;const{linkId:a,sku:i,token:o,env:s}=e;if(await(new Vi).log("processRedeemJob!",!1,a,null),!a||!i||!o)return{success:!1,message:"Missing required parameters: linkId, sku, or token",err_code:"INVALID_INPUT"};const l=new Ui(this.itemsService,this.accountabilitySchema),c=new Mi(this.itemsService,this.accountabilitySchema);try{const e=await l.getLinkDetailsFromId(a);if(!e||0===e.length)return{success:!1,message:"Invalid linkId: Link Details Not Found",err_code:"LINK_NOT_FOUND"};await(new Vi).log("processRedeemJob linkDetailsArr!",!1,a,null);const u=await l.getSkuBrandMapping(i);if(!u||!u.id)return await(new Vi).log("processRedeemJob SKU details Not Found!",!1,a,null),{success:!1,message:"Invalid sku: SKU not found",err_code:"SKU_NOT_FOUND"};const d=u.id,p=e[0],h=await l.voucherDetails(i),m=Number(null==h?void 0:h.amount)||0;if(!m||m<=0)return await(new Vi).log("msg: 'Validation failed: Invalid voucher value for this SKU",!1,a,null),{success:!1,message:"Invalid voucher value for this SKU",err_code:"INVALID_VOUCHER_VALUE"};let f=p.reward_campaign.delivery_mode||"direct_link",y=p.reward_campaign.delivery_mode||"direct_link";const g=e[0].reward_campaign.brand_limitation||[];let b=null==p.reward_campaign.soft_link_delivery_mode||0===p.reward_campaign.soft_link_delivery_mode.length?["email"]:p.reward_campaign.soft_link_delivery_mode;const v=p.end_date,w=p.reward_campaign,S=1*p.pending_value,E=i+"-"+("leq"==w.catalog_mode?S+"-":"")+a,x=w.voucher_vendor||"best_vendor",_=p.email||"",k=p.phone||"",I=p.reward_campaign.email_regards;if(p&&v>(new Date).toISOString()){await(new Vi).log("Fetched Link Details",!1,a,null);const u=o==p.token&&p.token_last_updated>=new Date((new Date).getTime()-3e5).toISOString();console.log(u,"isTokenValid"),await(new Vi).log("Checked Token Valid",!1,E,null);let h=[];const m=await l.voucherDetails(i);h.push(m);let v="";const w=m.brand.brand_name;if(m&&(v=Number(m.amount)||0),m&&v<=S){let o=0,u=0,m=[],T=0,A=0,O=[];if(g.length>0){const t=g.find((e=>e.brand&&e.brand.brand_name===w));if(t){T=t.overall_limit||0,A=t.monthly_limit||0;const n=t.brand.brand_name;if(o=v,u=v,m=await l.getUserBrandWiseRedemptions(e[0].reward_campaign.id,_,k,n),(null==m?void 0:m.length)>0){O=m;const e=m[0].overall_limit_utilized||0,r=m[0].monthly_limit_utilized||0;if(o=Number(r)+v,u=Number(e)+v,T>0&&u>T)return await(new Vi).log(`Brand Overall Limit Reached: ${n} - ${T} - Used: ${u}`,!1,E,null),{success:!1,message:t.overall_error_message||"Reached the maximum limit of this brand"};if(A>0&&o>A)return await(new Vi).log(`Brand Monthly Limit Reached: ${n} - ${A} - Used: ${o}`,!1,E,null),{success:!1,message:t.monthly_error_message||"Reached the maximum limit of this brand for this month"}}}}let K=await l.voucherCodeList(i);const C=Li.inventoryQty,R=Li.softlLinkInventoryQty;let j=!0;K||(K=[]);const P=null===(t=e[0].reward_campaign)||void 0===t?void 0:t.base_region,D=h[0].brand.region;if(console.log(P,D,"aaaaaaaaaaa"),K.length<C&&"direct_link"===f){const e=C-(null!==(n=null==K?void 0:K.length)&&void 0!==n?n:0);j=await this.generateVoucherBySkuBestVendor(i,v,x,e,E,s,D),await(new Vi).log(`Voucher Generated direct_link:${f} - ${j}`,!1,E,null)}if(K.length<R&&"link"===f){const e=R-(null!==(r=null==K?void 0:K.length)&&void 0!==r?r:0);j=await this.generateVoucherBySkuBestVendor(i,v,x,e,E,s,D),await(new Vi).log(`Voucher Generated softlink:${f} - ${j}`,!1,E,null)}await(new Vi).log("Checked Balance Available",!1,E,null);let N="",L="",M="",F=!1,B="",V="",U="";const J={email:_,date:Date.now()};let G=Li.secret_key,$=Li.expiresIn;const q=p.reward_campaign.name+" - (R)";let z="";"link"===f?(N=await l.voucherCode(i),L=await this.generateUniqueCode(),M=await this.generateOTP(),U=await this.generateToken(J,G,$)):N=await l.voucherCode(i),z=L;const W=new Date,Y=Number(Li.expiresIn)||0,H=new Date(W.getTime()+60*Y*60*1e3);this.expiryformatDate(H);let Q={other_site_domain:Li.custom_domain,link_reference_id:L,reference_code_otp:M,type:"link",brand:h||[],value:v,valid_till:p.end_date,first_time_send:!0,image_url:Li.defaults.asset_base_url||"",soft_link_token:U};if(N&&Object.keys(N).length>0&&N.id){await(new Vi).log("Got Voucher from Gift Card Inventory",!1,E,null);const t=N.id;let n="ZEUS_INVENTORY";"best_vendor"!==x&&(n=x);const r={code:N.code,pin:N.pin,valid_till:N.validity,amount:N.price};let s="";if("link"===f)B=i+"-"+L,s="",V=E,0!==b.length&&b.forEach((e=>{"email"===e?(this.sendEmail(Li.from_mail,_,M,I,"reward-link-template",Q),(new Vi).log("Email Notification sent",!1,E,null)):"whatsapp"===e?(this.sendWhatsapp(k,M,"reward-link-template",Q),(new Vi).log("Whatsup Notification sent!",!1,E,null)):(this.sendEmail(Li.from_mail,_,M,I,"reward-link-template",Q),(new Vi).log("Email Notification sent!",!1,E,null))}));else{await c.updateVoucherRedeemed(t,E,q,z,M,!0,B,E);(new Vi).log("updateVoucherRedeemedResponse!",!1,E,null)}const l=S-v;(new Vi).log(`newLinkBalance ${l}`,!1,E,null);const p=await c.updateLinkBalance(a,l);if((new Vi).log(`updateLinkBalanceResponse ${p}`,!1,E,null),p){let i={};"link"!==f?((new Vi).log("Adding Direct redeem Transaction to Ledger!",!1,E,null),i=await c.addTransactionToLedger(a,v,"debit",E,"created",n,z,M,U)):((new Vi).log("Adding Soft link redeem Transaction to Ledger!",!1,E,null),i=await c.addTransactionToLedger(a,v,"debit",E,"created",n,z,M,U));let s={};if("link"!==f&&(s=await c.insertVoucherRedemption(a,d,t,L,M,y,i,U),(new Vi).log(`insertRedemptionResponse ${s}`,!1,E,null)),g.length>0)if(O&&O.length>0){const e=await c.updateBrandLimitationDetails(O[0].id,o,u);e&&(new Vi).log(`Brand Limitation Details Updated:${e}`,!1,E,null)}else{const t=await c.insertBrandLimitationDetails(e[0].reward_campaign.id,_,k,w,o,u);t&&(new Vi).log(`Brand Limitation Details Inserted:${t}`,!1,E,null)}if(i){(new Vi).log(`Updating Ledger:${i} OrderStatus:successful`,!1,E,null);await c.updateLedgerTransactionOrderStatus(i,"successful",null,null);return{success:!0,amount:r.amount,message:"Voucher Successfully Fetched!",voucher:"link"===f?"":r.code,pin:"link"===f?"":r.pin,valid_till:"link"===f?"":r.valid_till}}(new Vi).log(`Updating Ledger:${i} OrderStatus:failed`,!1,E,null);await c.updateLedgerTransactionOrderStatus(i,"failed",null,null);return{success:!1,message:"Voucher Redemption Error",err_code:"INS_VOU_RED_ERR"}}return{success:!1,message:"Voucher Redemption Error",err_code:"UPD_BAL_ERR"}}{await(new Vi).log("Voucher Not Found In Inventory",!1,E,null);const t=S-v;if(await c.updateLinkBalance(a,t)){await(new Vi).log(`Balance of link:${a} Updated To: ${t}`,!1,E,null),await(new Vi).log(`Adding Transaction to Ledger ${z}${M}${U}`,!1,E,null);const n=await c.addTransactionToLedger(a,v,"debit",E,"created",null,z,M,U);await(new Vi).log("Getting Voucher from VPP",!1,E,null);let r=[];const l={sku:i,qty:1,amt:v},p={syncOnly:!0,redeemed:!1,retrieveIfRedeemed:!0,reference_id:E,order_id:"",extra:{client:q},link_reference_id:"",reference_code_otp:"",soft_link_order_id:""};if("best_vendor"===x)"link"==f?(p.redeemed=!1,B=i+"-"+L,r=await Ef({voucherRequest:l,services:this.services,accountabilitySchema:this.accountabilitySchema,options:p,env:s})):(F=!0,p.redeemed=!0,p.order_id=E,r=await Ef({voucherRequest:l,services:this.services,accountabilitySchema:this.accountabilitySchema,options:p,env:s}));else{const e=new Sf(this.services,this.accountabilitySchema);"link"==f?(B=i+"-"+L,r=await e.placeNewOrderAndStoreVoucher({vendor_code:x,reference_id:E,options:p,brand_sku:i,quantity:1,env:s})):(F=!0,p.redeemed=!0,p.order_id=E,r=await e.placeNewOrderAndStoreVoucher({vendor_code:x,reference_id:E,options:p,brand_sku:i,quantity:1,env:s}))}await(new Vi).log("msg: Received Response from VPP",!1,E,null);const h=r&&r.success,m=r&&r.message,S=r&&r.vendorCode;await(new Vi).log(`Updating Ledger:${S} OrderStatus:${h}`,!1,E,null),await(new Vi).log(`Updating vendorCode:${S} OrderStatus:${h}`,!1,E,null),await(new Vi).log(`Updating voucherMessage:${m} OrderStatus:${h}`,!1,E,null);await c.updateLedgerTransactionOrderStatus(n,h?"successful":"failed",S,m);if(g.length>0)if(await(new Vi).log("VPP API CALL-Brand Limitation Details",!1,E,null),O&&O.length>0){const e=await c.updateBrandLimitationDetails(O[0].id,o,u);e&&await(new Vi).log(`VPP API CALL-Brand Limitation Details Updated:${e}`,!1,E,null)}else{const t=await c.insertBrandLimitationDetails(e[0].reward_campaign.id,_,k,w,o,u);t&&await(new Vi).log(`VPP API CALL-Brand Limitation Details Inserted:${t}`,!1,E,null)}if(console.log(h,"aravoind"),h){"link"==f&&0!==b.length&&b.forEach((e=>{"email"===e?this.sendEmail(Li.from_mail,_,M,I,"reward-link-template",Q):"whatsapp"===e?this.sendWhatsapp(k,M,"reward-link-template",Q):this.sendEmail(Li.from_mail,_,M,I,"reward-link-template",Q)}));const e=r.keys[0],t=r.response[0];let i={code:"",pin:"",valid_till:""};if(t.code&&(i={code:t.code,pin:t.pin,valid_till:t.expiry}),"link"!==f){await c.insertVoucherRedemption(a,d,e,L,M,y,n,U)}return await(new Vi).log("Inserted Redemption Response",!1,E,null),{success:!0,amount:v,message:"Voucher Successfully Fetched!",voucher:"link"===f?"":i.code,pin:"link"===f?"":i.pin,valid_till:"link"===f?"":i.valid_till}}return await(new Vi).log("VPP Failure",!1,E,null),{success:!1,message:"Please contact Administrator",err_code:"VPP_FAIL_ERR"}}return await(new Vi).log("Balance Updatation Failure'",!1,E,null),{success:!1,message:"Voucher Redemption Error",err_code:"VPP_UPD_BAL_ERR"}}}return await(new Vi).log("Balance Unavailable'",!1,E,null),{success:!1,message:"Balance Not Available",err_code:"NO_BAL_ERR"}}{const e=!(v>(new Date).toISOString());return{success:!1,message:e?"Link Expired":"Invalid Link",error_tag:e?"LINK_EXPIRED":"INVALID_LINK",err_code:"LNK_ERR"}}}catch(e){return await(new Vi).log(`redeemVoucherError: ${e} }`,!1,a,null),{success:!1,message:"Please contact Administrator",err_code:"EXC_ERR"}}}async softLinkprocessRedeemJob(e){var t,n;const{link_reference_id:r,reference_code_otp:a,soft_link_token:i,env:o,itemsService:s,accountabilitySchema:l}=e,c=new Ui(this.itemsService,this.accountabilitySchema),u=new Mi(this.itemsService,this.accountabilitySchema);try{const e=await this.verifyToken(i,o.SOFT_LINK_SECRET_KEY,o.SOFT_LINK_TOKEN_EXPIRE_INPUT,r);if(await(new Vi).log(` getLinkVouchers  verifyToken status : ${e}`,!1,r,null),!e)return(new Vi).log("Invalid Token!. Please Contact Administrator.",!1,r,null),{success:!1,message:"Invalid Token!. Please Contact Administrator."};{let e=await c.softLinkOtpVerification(r,a);await(new Vi).log(`getLinkVouchers redemption data : ${e.length}`,!1,r,null);let i={success:!1,message:"Voucher Not Fetched! Please Contact Administrator",amount:"",voucher:"",pin:"",valid_till:"",brand_details:{}};if(0!==e.length){await(new Vi).log(`getLinkVouchers Already Redeemed Voucher redemption_id : ${e[0].redemption_id}`,!1,r,null);const t=e[0].redemption_id;e[0].brand_sku.id;e[0].brand_sku.brand.brand_name=e[0].brand_sku.brand.brand_name,e[0].brand_sku.brand.brand_image=e[0].brand_sku.brand.brand_image;let n=await c.getZeusVoucherCode(t);return n.pin&&(await(new Vi).log(`getLinkVouchers return voucher : ${e[0].redemption_id}`,!1,r,null),i.voucher=n.code,i.pin=n.pin,i.valid_till=n.validity,i.amount=n.price,i.brand_details=e[0].brand_sku.brand,i.message="Voucher Fetched Successfully!",i.success=!0),i}{let e=await c.getLinkLedger(r,a);if(!(e.length>0))return i;{await(new Vi).log(`getLinkVouchers getLedger reference_id : ${e[0].reference_id}`,!1,r,null);const d=e[0].reference_id?e[0].reference_id.split("-")[0]:null,p=(await c.getSkuBrandMapping(d)).id,h=e[0].amount,m=e[0].reward_link.id,f=e[0].soft_link_token,y=e[0].id,g=r+"-"+d,b=e[0].reward_link.reward_campaign.name,v=e[0].reward_link.reward_campaign.voucher_vendor||"best_vendor",w=e[0].reference_id,S=b+" - (R)",E=e[0].reference_id?e[0].reference_id.split("-")[0]:null,x=e[0].reference_id;if(!d||!h)return i;{await(new Vi).log(`getLinkVouchers ledgerId ${y}  voucherSku ${d} amount: ${h}`,!1,r,null);const b=await c.voucherDetails(d),_=y?await c.getLinkredemptionsFromLedgerId(y):{};if(await(new Vi).log(`getLinkVouchers getLinkredemptionsFromLedgerId ${JSON.stringify(_)}`,!1,r,null),_){(new Vi).log("Data Fetching From Redeemption List",!1,r,null);const e=_.redemption_id;let t=await c.getZeusVoucherCode(e);return(new Vi).log("Data Fetching From getZeusVoucherCode",!1,r,null),t&&(i.voucher=t.code,i.pin=t.pin,i.valid_till=t.validity,i.amount=t.price,i.brand_details=b.brand,i.message="Voucher Fetched Successfully!",i.success=!0),i}{const _=await c.getZeusVoucherCodeByLedgerReferenceId(e[0].reference_id);if(null==_?void 0:_.id){if(null==_?void 0:_.id){if(!await c.getLinkredemptionsFromId(_.id)){await u.insertVoucherRedemption(m,p,_.id,r,a,"link",y,f)}i.voucher=_.code,i.pin=_.pin,i.valid_till=_.validity,i.amount=_.price,i.brand_details=b.brand,i.message="Voucher Fetched Successfully!",i.success=!0}return i}{let _=await c.voucherCode(E);if(_&&Object.keys(_).length>0&&_.id){(new Vi).log(`getLinkVouchers voucherDetails id ${_.id} gift_card sttaus ${_.gift_card} `,!1,r,null);const e=await u.updateSoftlinkVoucherRedeemedStatus(_.id,w,S,r,a,!0,g,x,!0);(new Vi).log(`getLinkVouchers updateVoucherRedeemedResponse id ${JSON.stringify(e)}`,!1,r,null);const t=await c.getLinkredemptionsFromId(_.id);let n={};return t||(n=await u.insertVoucherRedemption(m,p,_.id,r,a,"link",y,f),(new Vi).log(`getLinkVouchers insertRedemptionResponse ${JSON.stringify(n)}`,!1,r,null)),_.pin&&n?(i.voucher=_.code,i.pin=_.pin,i.valid_till=_.validity,i.amount=h,i.brand_details=b.brand||{},i.message="Voucher Fetched successfully!",i.success=!0,(new Vi).log("getLinkVouchers Voucher Return successfully",!1,r,null),i):i}{(new Vi).log("voucher Details Not Found",!1,r,null);let i=await this.fetchVoucherCode(v,d,h,e[0].reference_id,S,"","","",s,l,o);if(await this.logResponse(i),!(null==i?void 0:i.success))return(new Vi).log(`voucherCodeFromVpp?.success ${null==i?void 0:i.success}`,!1,r,null),await this.createErrorResponse(r);const w=null===(t=i.keys)||void 0===t?void 0:t[0];(new Vi).log(`voucherCodeId ${w}`,!1,r,null);const E=await c.getVoucherCodeById(w);if(0!==E.length&&!E[0].gift_card)return i.amount=E[0].price,await this.handleVoucherRedemption(i,p,S,r,a,g,m,y,f,b,e[0].reference_id,s,l);if(!await this.containsSL(e[0].reference_id)){(new Vi).log(`if inventory Details Not Found ${e[0].reference_id}`,!1,r,null);const t=await this.appendSL(e[0].reference_id),w=await u.updateSoftReferenceId(e[0].id,t);if((new Vi).log(`if inventory Details Not Found ${e[0].reference_id}if inventory Details Not Found ${t} updateRes: ${JSON.stringify(w)}`,!1,r,null),w){(new Vi).log(`New Request refId: ${t}`,!1,r,null),i=await this.fetchVoucherCode(v,d,h,t,S,"","","",s,l,o);const u=null===(n=i.keys)||void 0===n?void 0:n[0],w=await c.getVoucherCodeById(u);return await this.logResponse(i),(null==i?void 0:i.success)?(i.amount=w[0].price,await this.handleVoucherRedemption(i,p,S,r,a,g,m,y,f,b,e[0].reference_id,s,l)):await this.createErrorResponse(r)}}}}}}}}}}catch(e){return(new Vi).log(`Softlink Redeem Voucher Error ${JSON.stringify(e)}`,!1,r,null),{success:!1,message:"Please contact Administrator",err_code:"EXC_ERR"}}}async verifyToken(e,t,n,r){try{const a=sE(e,t,{ignoreExpiration:!0});if(!a.iat)return!1;const i=a.iat+3600*n,o=Math.floor(Date.now()/1e3);return(new Vi).log(`verifyToken expiryTimestamp: ${i} currentTimestamp: ${o}`,!1,r,null),o>i?((new Vi).log("verifyToken- Token Expaired",!1,r,null),!1):((new Vi).log("verifyToken- Token valid",!1,r,null),!0)}catch(e){return(new Vi).log(`verifyToken- Error ${JSON.stringify(e)}`,!1,r,null),!1}}async generateUniqueCode(){try{const e=new Ui(this.itemsService,this.accountabilitySchema);let t=await this.generateRandomChars(Li.max_random_chars),n=await e.checkRandomChars(t);for(;n&&n.length>0;)t=await this.generateRandomChars(Li.max_random_chars),n=await e.checkRandomChars(t);return t}catch(e){return await(new Vi).log(`generateUniqueCode Error: ${e}`,!1,null,null),"ERROR"+Date.now()}}async generateRandomChars(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let r=0;r<e;r++){const e=Math.floor(Math.random()*t.length);n+=t.charAt(e)}return n}async generateOTP(){return Math.floor(1e3+9e3*Math.random()).toString()}async generateVoucherBySkuBestVendor(e,t,n,r,a,i,o){try{new Ui(this.itemsService,this.accountabilitySchema),new Mi(this.itemsService,this.accountabilitySchema);const s=new Sf(this.services,this.accountabilitySchema),l={sku:e,qty:r,amt:t},c={syncOnly:!0,redeemed:!1,retrieveIfRedeemed:!0,reference_id:a,order_id:"",extra:{client:""}};let u={};u=o.id==i.INDIAN_REGION?"best_vendor"===n?await Ef({voucherRequest:l,services:this.services,accountabilitySchema:this.accountabilitySchema,options:c,env:i}):await s.placeNewOrderAndStoreVoucher({vendor_code:n,reference_id:a,options:c,brand_sku:e,quantity:r,env:i}):await s.placeNewOrderAndStoreVoucher({vendor_code:"REWARD_ST",reference_id:a,options:c,brand_sku:e,quantity:r,env:i});const d=u&&u.success,p=u&&u.message,h=u&&u.vendorCode;return(new Vi).log(`generateVoucherBySkuBestVendor:${h} OrderStatus:${d}`,!1,a,null),(new Vi).log(`voucherMessage:${p} OrderStatus:${d}`,!1,a,null),d}catch(e){return!1}}async generateToken(e,t,n){try{return lE(e,t,{expiresIn:3600*n})}catch(e){(new Vi).log(`generateToken Error:${e}`,!1,null,null)}}async expiryformatDate(e){const t=e=>e.toString().padStart(2,"0");return`${e.getFullYear()}-${t(e.getMonth()+1)}-${t(e.getDate())} ${t(e.getHours())}:${t(e.getMinutes())}:${t(e.getSeconds())}`}async sendEmail(e,t,n,r,a,i){try{const o={template_name:a||"reward-template",template_params:[n,r],email_from:e,email_to:t,otp_mode:"email",type:i&&i.type?i.type:"",extra_params:i||{}};return(await Ni.post(`${Li.workflows.base_url}/webhook/sd-notifications`,o,{headers:{Authorization:Li.workflows.sd_notifications_auth||""}})).data}catch(e){return await(new Vi).log(`sendEmail Error: ${e}`,!1,null,null),!1}}async sendWhatsapp(e,t,n,r){try{const a={template_name:n||"reward-template",template_params:[t],phone:e,otp_mode:"whatsapp",type:r&&r.type?r.type:"",extra_params:r||{}};return(await Ni.post(`${Li.workflows.base_url}/webhook/sd-notifications`,a,{headers:{Authorization:Li.workflows.sd_notifications_auth||""}})).data}catch(e){return await(new Vi).log(`sendWhatsapp Error: ${e}`,!1,null,null),!1}}async appendSL(e){return`${e}-SL`}async containsSL(e){return e.includes("-SL")}async createErrorResponse(e){return(new Vi).log("Failed to fetch voucher,Please Contact Administrator!",!1,e,null),{success:!1,message:"Failed to fetch voucher,Please Contact Administrator!"}}async fetchVoucherCode(e,t,n,r,a,i,o,s,l,c,u){new Ui(this.itemsService,this.accountabilitySchema),new Mi(this.itemsService,this.accountabilitySchema);const d=Li.apiVendorList||[],p=new Sf(this.services,this.accountabilitySchema);(new Vi).log(`generateVoucherBySkuBestVendor:${t}, voucherValue:${n} , referenceId:${r}`,!1,i,null);const h={sku:t,qty:1,amt:n},m={syncOnly:!0,redeemed:!1,retrieveIfRedeemed:!0,reference_id:r,order_id:r,extra:{client:a},link_reference_id:"",reference_code_otp:"",soft_link_order_id:""};return e&&"ZEUS_INVENTORY"!==e&&"best_vendor"!==e?0!==d.length&&d.includes(e)?((new Vi).log(`fetchVoucherCode vendor_code: ${e} referenceId:${r}`,!1,i,null),await p.placeNewOrderAndStoreVoucher({vendor_code:e,reference_id:r,options:m,brand_sku:t,quantity:1,env:u})):void 0:(m.link_reference_id=i,m.reference_code_otp=o,m.soft_link_order_id=s,(new Vi).log(`fetchVoucherCode ZEUS_INVENTORY/best_vendor: referenceId:${r}`,!1,i,null),await Ef({voucherRequest:h,services:this.services,accountabilitySchema:this.accountabilitySchema,options:m,env:u}))}async logResponse(e){(new Vi).log(`vendorCode:${null==e?void 0:e.vendorCode} OrderStatus:${null==e?void 0:e.success}`,!1,null,null),(new Vi).log(`voucherMessage:${null==e?void 0:e.message} OrderStatus:${null==e?void 0:e.success}`,!1,null,null)}async handleVoucherRedemption(e,t,n,r,a,i,o,s,l,c,u,d,p){var h,m;(new Vi).log("handleVoucherRedemption",!1,r,null),new Ui(this.itemsService,this.accountabilitySchema);const f=new Mi(this.itemsService,this.accountabilitySchema),y=(null===(h=e.response)||void 0===h?void 0:h[0])||{},g={code:y.code||"",pin:y.pin||"",valid_till:y.expiry||""},b=null===(m=e.keys)||void 0===m?void 0:m[0],v=await f.updateSoftlinkVoucherRedeemedStatus(b,u,n,r,a,!0,i,u,!0);(new Vi).log(`UpdateSoftlinkVoucherRedeemedStatus ${JSON.stringify(v)}`,!1,r,null);const w=await f.insertVoucherRedemption(o,t,b,r,a,"link",s,l);return(new Vi).log(`insertRedemptionResponse:${w}`,!1,r,null),b&&w?{success:!0,message:"Voucher Fetched successfully!",amount:e.amount,voucher:g.code,pin:g.pin,valid_till:g.valid_till,brand_details:c.brand||{}}:await this.createErrorResponse(r)}async getSoftLinkVouchers(e,t,n,r){try{await(new Vi).log(`getSoftLinkVouchers link_reference_id${e},reference_code_otp: ${t} }`,!1,e,null);new Ui(this.itemsService,this.accountabilitySchema),new Mi(this.itemsService,this.accountabilitySchema);const a=qL("soft-link-queue");this.workerNode("soft-link-queue");const i=await a.add("redeem",{link_reference_id:e,reference_code_otp:t,soft_link_token:n,env:r},{removeOnComplete:{count:0},removeOnFail:{count:0}});await a.getJobCounts();return await i.waitUntilFinished($L["soft-link-queue"])}catch(t){return await(new Vi).log(`getSoftLinkVouchers Error${JSON.stringify(t)}`,!1,e,null),{success:!1,message:"Record Not Found!.  Please Contact Administrator."}}}async retryFailedVouchers(){try{await(new Vi).log("retryFailedVouchers",!1,null,null);const e=new Ui(this.itemsService,this.accountabilitySchema),t=(new Mi(this.itemsService,this.accountabilitySchema),await e.getAllFailedLinkLedger()),n=[];if(t&&t.length)for(let e=0;e<t.length;e++){const r=t[e],a=r.id,i=r.reference_id,o=r.reward_link.id,s=r.reward_link.reward_campaign?r.reward_link.reward_campaign.name:null,l=r.vendor_code,c=r.attempts,u=r.link_reference_id||"",d=r.reward_link.reward_campaign.delivery_mode||"",p=r.reference_code_otp||"",h=r.soft_link_token||"",m=await this.handleFailedLedger({ledgerId:a,ledgerReferenceId:i,ledgerLinkId:o,ledgerVendorCode:l,ledgerAttempts:c,ledgerLinkCampaign:s,linkReferenceId:u,deliveryMode:d,failedLedger:r,reference_code_otp:p,soft_link_token:h});(new Vi).log(`ref : ${i},ctr: ${c},res: ${JSON.stringify(m)} `,!1,i,null),n.push(m)}return{response:n}}catch(e){return(new Vi).log(`retryFailedVouchers error: ${JSON.stringify(e)}`,!1,null,null),{success:!1,message:"Server Error, Please try later",err_code:"RETRY_EXC_ERR"}}}async handleFailedLedger({ledgerId:e,ledgerReferenceId:t,ledgerLinkId:n,ledgerVendorCode:r,ledgerAttempts:a,ledgerLinkCampaign:i,linkReferenceId:o,deliveryMode:s,failedLedger:l,reference_code_otp:c,soft_link_token:u}){try{(new Vi).log(`Retrying RefId:${t} | ctr:${a}`,!1,t,null);const u=new Ui(this.itemsService,this.accountabilitySchema),d=new Mi(this.itemsService,this.accountabilitySchema),p=t?t.split("-")[0]:null;let h="",m="",f="";const y={email:l.reward_link.email||"",date:Date.now()};let g=Li.secret_key,b=Li.expiresIn;const v=(await u.getSkuBrandMapping(p)).id;"link"===s&&(h=o,o||(o=await this.generateUniqueCode()),c||(c=await this.generateOTP()),m=p+"-"+h,f||(f=await this.generateToken(y,g,b)));const w=await d.updateLedgerAttempts(e,a+1);if((new Vi).log(`increaseAttemptsResponse:${JSON.stringify(w)}`,!1,t,null),"ZEUS_INVENTORY"!=r){(new Vi).log(`Requesting VPP Old Order Api RefId:${t}`,!1,t,null);const a={store_to_inventory:!0,redeemed:!h,reference_id:t,order_id:h?"":t,extra:{client:i+" - (R)"},link_reference_id:h,reference_code_otp:c,soft_link_order_id:m,voucherSku:p},o=r,l=t,y=new Sf(this.services,this.accountabilitySchema),g=await y.getAndStoreOldVouchers({vendor_code:o,reference_id:l,options:a}),b=""!=g&&g&&g.success;if((new Vi).log(`VPP Response RefId:${t} | suc:${b}`,!1,t,null),b){return await this.insertRedemptionAndUpdateLedger(g,t,n,v,e,!1,h,c,s,e,f)}{(new Vi).log(`VPP Place New Order RefId:${t}`,!1,t,null);const a=await u.placeNewOrderVpp(t,t,i+" - (R)",r,p,h,c,m),o=""!=a&&a&&a.success;if((new Vi).log(`VPP New Order Response RefId:${t} | suc:${b}`,!1,t,null),o){const{keys:r}=a;if("link"===s){const e=await d.updateSoftlinkVoucherRedeemedStatus(r[0],t,i+" - (R)",h,c,!0,m,t,!0);(new Vi).log(`getLinkVouchers updateRes ${JSON.stringify(e)}`,!1,t,null)}return await this.insertRedemptionAndUpdateLedger(a,t,n,v,e,!0,h,c,s,e,f)}}}else if("ZEUS_INVENTORY"==r&&((new Vi).log(`Inventory Failed Order, RefId:${t}`,!1,t,null),!t.includes("inventory"))){(new Vi).log(`Bypassing VPP - Redeeming from Inventory, RefId:${t}`,!1,t,null);const r=i+" - (R)";if("link"==s){let a=await u.voucherCodeByOrerId(p,t);if(a||(a=await u.voucherCode(p)),a){(new Vi).log(`Got Voucher from Gift Card Inventory, RefId:${t}`,!1,t,null);const i=a.id;let o={};await d.updateSoftlinkVoucherRedeemedStatus(i,t,r,h,c,!0,m,t,!0);return(new Vi).log(`Updated Voucher Redeemed at Zeus Inventory, RefId:${t}`,!1,t,null),o=await this.insertRedemptionAndUpdateLedger({keys:[i]},t,n,v,e,!0,h,c,s,e,f),o}}else{let a=await u.voucherCodeByOrerId(p,t);if(a||(a=await u.voucherCode(p)),a){(new Vi).log(`Got Voucher from Gift Card Inventory, RefId:${t}`,!1,t,null);const i=a.id;let o={};await d.updateVoucherRedeemed(i,t,r,h,c,!0,m,t);return(new Vi).log(`Got Voucher from Gift Card Inventory, RefId:${t}Updated Voucher Redeemed at Zeus Inventory, RefId:${t}`,!1,t,null),o=await this.insertRedemptionAndUpdateLedger({keys:[i]},t,n,v,e,!0,h,c,s,e,f),o}}}return{success:!1,err_code:"NO_HIS_ORD_FAIL"}}catch(e){(new Vi).log(`handleFailedLedgerError:${JSON.stringify(e)}`,!1,t,null)}}async VoucherActivationMail(e){var t;try{const n=e.map((e=>({Order_Id:e.order_id,sku:e.sku,Brand_Name:e.brand_name,Code:e.code,PIN:e.pin,voucher_status:e.voucher_status})));if(!n.length)return{success:!1,data:null,message:"No voucher data to export."};const r=wf.json_to_sheet(n),a=wf.book_new();wf.book_append_sheet(a,r,"Vouchers");const i=uf(a,{bookType:"xlsx",type:"buffer"}),o=`vouchers_activation_${Date.now()}.xlsx`,s=await this.uploadFileBuffer(i,o);return(null===(t=null==s?void 0:s.data)||void 0===t?void 0:t.id)?{success:!0,data:s,message:"Voucher Excel file uploaded successfully."}:{success:!1,data:s,message:"Upload failed: Invalid response from server."}}catch(e){return{success:!1,data:e,message:"Voucher upload failed. Please contact administrator."}}}async uploadFileBuffer(e,t){const n=new Ga;n.append("file",e,{filename:t,contentType:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});try{return(await Ni.post(`${Li.zeus.base_url}/files`,n,{headers:{Authorization:Li.zeus.auth,...n.getHeaders()},maxBodyLength:1/0})).data}catch(e){return{success:!1,data:e,message:"Voucher upload failed. Please contact administrator."}}}}let WL=!1;var YL=async(e,{services:t,getSchema:n,env:r,database:a})=>{const i=new Vi,o=async(e,n,r)=>{try{i.createLoggerInstance(t.ItemsService,{accountability:e.accountability,schema:e.schema},e.body),e.headers["sp-qc-auth"]&&(e.headers.authorization=e.headers["sp-qc-auth"],delete e.headers["sp-qc-auth"]),r()}catch(e){n.send({success:!1,message:"Server Error, Please try later."})}},s=async(e,n,r)=>{try{if(!e.headers.authorization)return n.status(403).json({error:"No credentials sent!"});if(e.headers.authorization!=Li.auth.extension)return n.status(403).json({error:"Access Forbidden"});{e.headers.authorization=Li.zeus.zeus_api_access||"";const o=await a.select("directus_users.id as user_id","directus_users.role as role_id","directus_roles.admin_access","directus_roles.app_access").from("directus_users").leftJoin("directus_roles","directus_users.role","directus_roles.id").where({"directus_users.token":Li.zeus.zeus_api_access,"directus_users.status":"active"}).first();o||n.send({success:!1,message:"Server Error, Please try later."});const s=await a.select("*").from("directus_permissions").where("role",o.role_id);e.accountability={user:o.user_id,role:o.role_id,admin:o.admin_access,app:o.app_access,permissions:s||[]},i.createLoggerInstance(t.ItemsService,{accountability:e.accountability,schema:e.schema},e.body),e.headers["sp-qc-auth"]&&(e.headers.authorization=e.headers["sp-qc-auth"],delete e.headers["sp-qc-auth"]),r()}}catch(e){n.send({success:!1,message:"Server Error, Please try later."})}},l=async(e,t,n)=>{try{const t=e.originalUrl.split("/vpp/yh").join(""),n=Yi.qcAmazonConfig.base_url+t,r=e.body,a=(e.method+"").toUpperCase();let i=n;const o=Yi.qcAmazonConfig.client_secret,s=e=>{if(e instanceof Array)var t=[],n=Object.keys(e);else t={},n=Object.keys(e);n.sort((function(e,t){return e<t?-1:e>t?1:0}));for(const r in n){const a=n[r];"object"==typeof e[a]?(e[a]instanceof Array&&(t[a]=s(e[a])),t[a]=s(e[a])):t[a]=e[a]}return t},l=()=>{const e=i.split("?"),t=e[0],n=e[1].split("&");return i=t+"?"+n.sort().join("&"),u(i)},c=()=>{const e=[];return e.push(a.toUpperCase()),i.indexOf("?")>=0?e.push(l()):e.push(u(i)),r&&Object.keys(r).length&&e.push(u(JSON.stringify(s(r)))),e.join("&")},u=e=>encodeURIComponent(e).replace(/[!'()*]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}));e.headers.signature=to(c(),o).toString()}catch(e){}n()};e.post("/get-vouchers",o,(async(e,n)=>{try{const a=e.body,{required_vouchers:i,options:o}=a;if(!(i&&Array.isArray(i)&&i.length)){const e={success:!1,message:"'required_vouchers' is invalid or null or has no items",response:[]};return void n.send([e])}const s=i,l={accountability:e.accountability,schema:e.schema},c=[];s.forEach(((e,n)=>{const a=new Promise(((n,a)=>{Ef({voucherRequest:e,accountabilitySchema:l,services:t,options:o,env:r}).then((e=>{n(e)}))}));c.push(a)})),Promise.all(c).then((e=>{n.send(e)}))}catch(e){await(new Vi).jsonError({exception:e,error:"get-vouchers-error"},null,null),n.send({success:!1,exception:!0,message:"Exception Occurred: "+e,response:[]})}})),e.post("/get-old-vouchers",o,(async(e,n)=>{try{const{vendor_code:r,reference_id:a,options:i}=e.body,o={accountability:e.accountability,schema:e.schema},s=new Sf(t,o),l=await s.getAndStoreOldVouchers({vendor_code:r,reference_id:a,options:i});n.send(l)}catch(e){n.send({success:!1,error:e,exception:!0}),await(new Vi).jsonError({exception:e,error:"get-catalog-error"},null,null)}})),e.post("/place-new-order",o,(async(e,n)=>{try{let{vendor_code:a,brand_sku:i,reference_id:o,options:s,quantity:l}=e.body;const c={accountability:e.accountability,schema:e.schema},u=new Sf(t,c),d=await u.placeNewOrderAndStoreVoucher({vendor_code:a,reference_id:o,options:s,brand_sku:i,quantity:l,env:r});n.send(d)}catch(e){n.send({success:!1,error:e,exception:!0}),await(new Vi).jsonError({exception:e,error:"get-catalog-error"},null,null)}})),e.get("/get-catalog/:id/:countryCode",o,(async(e,n)=>{try{const r=e.params.id,a=e.params.countryCode,i={accountability:e.accountability,schema:e.schema};await(new Vi).log(`get-catalog vendorApiIntId : ${r}`,!1,null,null);const o=new Sf(t,i),{success:s,catalog:l,error:c}=await o.getCatalog({vendorApiIntId:r,countryCode:a});if(await(new Vi).log(`success  : ${s}`,!1,null,null),await(new Vi).log(`catalog  : ${JSON.stringify(l)}`,!1,null,null),s){const e=await o.catalogToExcel({vendorApiIntId:r,catalog:l});e?(n.setHeader("Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),n.setHeader("Content-Disposition","attachment; filename=catalog.xlsx"),n.status(200).send(e)):n.send({success:!1,error:"Excel creation error"})}else n.send({success:!1,error:c})}catch(e){n.send({success:!1,error:e,exception:!0}),await(new Vi).jsonError({exception:e,error:"get-catalog-error"},null,null)}})),e.get("/get-balance/:id",o,(async(e,n)=>{try{const r=e.params.id,a={accountability:e.accountability,schema:e.schema},i=new Sf(t,a),{success:o,balance:s,error:l,currency:c}=await i.getBalance({vendorApiIntId:r});o?n.send({success:!0,balance:s,currency:c||"INR"}):n.send({success:!1,error:l})}catch(e){n.send({success:!1,error:e,exception:!0}),await(new Vi).jsonError({exception:e,error:"get-balance-error"},null,null)}})),e.get("/yh/*",[o,l],(function(e,t,n){try{if("true"!=process.env.VOUCHERS_PROXY_ENABLED)return void t.send({message:"Proxy Disabled"});const n=e.originalUrl.split("/vpp/yh").join(""),r=Yi.qcAmazonConfig.base_url+n;e.headers.Authorization=e.headers.authorization,delete e.headers.authorization,delete e.headers.host;zo(r,{headers:{...e.headers,Authorization:e.headers.Authorization},method:"GET"}).catch((e=>{t.send({error:"GET Error:"+e})})).then((async e=>{try{const n=await e.json();t.send(n)}catch(e){(new Vi).jsonError({exception:e,error:"get-proxy-error-1"},null,null)}}))}catch(e){(new Vi).jsonError({exception:e,error:"get-proxy-error-2"},null,null)}})),e.post("/yh/*",[o,l],(function(e,t,n){try{if("true"!=process.env.VOUCHERS_PROXY_ENABLED)return void t.send({message:"Proxy Disabled"});const n=e.originalUrl.split("/vpp/yh").join(""),r=Yi.qcAmazonConfig.base_url+n,a=e.body?e.body:{};e.headers.Authorization=e.headers.authorization,delete e.headers.authorization,delete e.headers.host;zo(r,{headers:{...e.headers,Authorization:e.headers.Authorization},body:JSON.stringify(a),method:"POST"}).catch((e=>{t.send({error:"POST Error:"+e})})).then((async e=>{try{const n=await e.json();t.send(n)}catch(e){(new Vi).jsonError({exception:e,error:"post-catalog-error-1"},null,null)}}))}catch(e){(new Vi).jsonError({exception:e,error:"post-catalog-error-2"},null,null)}})),e.post("/linkverifyotp",o,(async(e,n)=>{try{const{link_reference_id:r,reference_code_otp:a}=e.body,i={accountability:e.accountability,schema:e.schema},o=new Sf(t,i),s=await o.otpVerification({link_reference_id:r,reference_code_otp:a});n.send(s)}catch(e){await(new Vi).jsonError({exception:e,error:"get-link-voucher-error"},null,null),n.send({success:!1,error:e,exception:!0})}})),e.post("/otpupdate",o,(async(e,n)=>{try{const{link_reference_id:r,reference_code_otp:a,old_reference_code_otp:i}=e.body,o={accountability:e.accountability,schema:e.schema},s=new Sf(t,o),l=await s.otpUpdate({link_reference_id:r,reference_code_otp:a,old_reference_code_otp:i});n.send(l)}catch(e){await(new Vi).jsonError({exception:e,error:"get-link-voucher-error"},null,null),n.send({success:!1,error:e,exception:!0})}})),e.post("/getonevoucher",o,(async(e,n)=>{try{const{id:r}=e.body,a={accountability:e.accountability,schema:e.schema},i=new Sf(t,a),o=await i.getOneVocher(r);n.send(o)}catch(e){await(new Vi).jsonError({exception:e,error:"get-link-voucher-error"},null,null),n.send({success:!1,error:e,exception:!0})}})),e.post("/referenceupdate",o,(async(e,n)=>{try{const{id:r}=e.body,a={accountability:e.accountability,schema:e.schema},i=new Sf(t,a),o=await i.referenceUpdate(r);n.send(o)}catch(e){await(new Vi).jsonError({exception:e,error:"get-link-voucher-error"},null,null),n.send({success:!1,error:e,exception:!0})}})),e.get("/update-catalog/:id/:countryCode",o,(async(e,n)=>{try{const r=e.params.id,a=e.params.countryCode,i={accountability:e.accountability,schema:e.schema};await(new Vi).log(`udpate-catalog vendorApiIntId : ${r}`,!1,null,null);const o=new Sf(t,i),s=await o.updateCatalog({vendorApiIntId:r,countryCode:a});await(new Vi).log(`catalogResponse  : ${s}`,!1,null,null),n.send(s)}catch(e){await(new Vi).jsonError({exception:e,error:"get-catalog-error"},null,null),n.send({success:!1,error:e,exception:!0})}})),e.post("/cardbalance",o,(async(e,n)=>{try{const{cardNumber:r,pin:a}=e.body,i={accountability:e.accountability,schema:e.schema},o=new Sf(t,i),s=await o.getQCBalance(r,a);n.send(s)}catch(e){await(new Vi).jsonError({exception:e,error:"cardbalance-error"},null,null),n.send({success:!1,error:e,exception:!0})}})),e.post("/card-balace-report",o,(async(e,n)=>{try{const r={accountability:e.accountability,schema:e.schema},{start_date:a,end_date:i,limit:o}=e.body,s=new Sf(t,r),{success:l,inventoryList:c,error:u}=await s.inventoryReport(a,i,o);await(new Vi).log(`success  : ${l}`,!1,null,null),n.send({success:l,inventoryList:c})}catch(e){n.send({success:!1,error:e,exception:!0}),await(new Vi).jsonError({exception:e,error:"card-balace-report-error"},null,null)}})),e.post("/revalidate-card-balace",o,(async(e,n)=>{try{const r={accountability:e.accountability,schema:e.schema},{start_date:a,end_date:i}=e.body,o=new Sf(t,r),{success:s,inventoryList:l,error:c}=await o.revalidateInventoryReport(a,i);await(new Vi).log(`success  : ${s}`,!1,null,null),n.send({success:s,inventoryList:l})}catch(e){await(new Vi).jsonError({exception:e,error:"card-balace-report-error"},null,null),n.send({success:!1,error:e,exception:!0})}})),e.post("/redeemvoucher",s,(async(e,n)=>{try{const{id:a,sku:i,token:o}=e.body;if(await(new Vi).log(`start redeem voucher! LinkId ${a} sku: ${a}`,!1,a,null),!a||!i||!o)return await(new Vi).log("Missing required fields: id, sku, token",!1,a,null),n.status(400).send({success:!1,message:"Missing required fields: id, sku, token"});const s={accountability:e.accountability,schema:e.schema},l=new zL(t,s),c=await l.redeemVoucher(a,i,o,r);n.send(c)}catch(e){await(new Vi).jsonError({exception:e,error:"links-redeem"},null,null),n.status(500).send({success:!1,message:"Server Error",error:e})}})),e.post("/linkredeemvoucher",s,(async(e,n)=>{try{const{link_reference_id:a,reference_code_otp:i,token:o}=e.body,s=o;await(new Vi).log(`Softlink started: link_reference_id${a},reference_code_otp: ${i} }`,!1,a,null);const l={accountability:e.accountability,schema:e.schema};if(s&&a&&i){const e=new zL(t,l),o=await e.getSoftLinkVouchers(a,i,s,r);n.send(o)}else await(new Vi).log(`Please Enter Valid Input: link_reference_id${a},reference_code_otp: ${i} }`,!1,a,null),n.send({success:!1,message:"Please Enter Valid Input!"})}catch(e){await(new Vi).jsonError({exception:e,error:"sotlink-redeem"},null,null),n.send({success:!1,error:e,exception:!0})}})),e.post("/retry-failed-vouchers",o,(async(e,n)=>{try{if(await(new Vi).log("Retry Voucher invoked",!1,null,null),WL)n.send({CRON_RUNNING:WL});else{WL=!0;(new Date).getTime();const r={accountability:e.accountability,schema:e.schema},a=new zL(t,r),{response:i}=await a.retryFailedVouchers();(new Date).getTime();WL=!1,n.send({response:i})}}catch(e){await(new Vi).jsonError({exception:e,error:"retry-failed-vouchers"},null,null),WL=!1,n.send({success:!1,message:"Server Error, Please try later."})}})),e.post("/voucher-activation-mail",(async(e,n)=>{try{const{vouchers:r}=e.body,a={accountability:e.accountability,schema:e.schema};if(r.length>0){const e=new zL(t,a),i=await e.VoucherActivationMail(r);n.send(i)}else n.send({success:!1,message:"Please Enter Valid Input!"})}catch(e){await(new Vi).jsonError({exception:e,error:"sotlink-redeem"},null,null),n.send({success:!1,error:e,exception:!0})}}))};let HL=0;const QL={START_BOUNDARY:HL++,HEADER_FIELD_START:HL++,HEADER_FIELD:HL++,HEADER_VALUE_START:HL++,HEADER_VALUE:HL++,HEADER_VALUE_ALMOST_DONE:HL++,HEADERS_ALMOST_DONE:HL++,PART_DATA_START:HL++,PART_DATA:HL++,END:HL++};let ZL=1;const XL=ZL,eM=ZL*=2,tM=e=>32|e,nM=()=>{};class rM{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=nM,this.onHeaderField=nM,this.onHeadersEnd=nM,this.onHeaderValue=nM,this.onPartBegin=nM,this.onPartData=nM,this.onPartEnd=nM,this.boundaryChars={},e="\r\n--"+e;const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n),this.boundaryChars[t[n]]=!0;this.boundary=t,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=QL.START_BOUNDARY}write(e){let t=0;const n=e.length;let r=this.index,{lookbehind:a,boundary:i,boundaryChars:o,index:s,state:l,flags:c}=this;const u=this.boundary.length,d=u-1,p=e.length;let h,m;const f=e=>{this[e+"Mark"]=t},y=e=>{delete this[e+"Mark"]},g=(e,t,n,r)=>{void 0!==t&&t===n||this[e](r&&r.subarray(t,n))},b=(n,r)=>{const a=n+"Mark";a in this&&(r?(g(n,this[a],t,e),delete this[a]):(g(n,this[a],e.length,e),this[a]=0))};for(t=0;t<n;t++)switch(h=e[t],l){case QL.START_BOUNDARY:if(s===i.length-2){if(45===h)c|=eM;else if(13!==h)return;s++;break}if(s-1==i.length-2){if(c&eM&&45===h)l=QL.END,c=0;else{if(c&eM||10!==h)return;s=0,g("onPartBegin"),l=QL.HEADER_FIELD_START}break}h!==i[s+2]&&(s=-2),h===i[s+2]&&s++;break;case QL.HEADER_FIELD_START:l=QL.HEADER_FIELD,f("onHeaderField"),s=0;case QL.HEADER_FIELD:if(13===h){y("onHeaderField"),l=QL.HEADERS_ALMOST_DONE;break}if(s++,45===h)break;if(58===h){if(1===s)return;b("onHeaderField",!0),l=QL.HEADER_VALUE_START;break}if(m=tM(h),m<97||m>122)return;break;case QL.HEADER_VALUE_START:if(32===h)break;f("onHeaderValue"),l=QL.HEADER_VALUE;case QL.HEADER_VALUE:13===h&&(b("onHeaderValue",!0),g("onHeaderEnd"),l=QL.HEADER_VALUE_ALMOST_DONE);break;case QL.HEADER_VALUE_ALMOST_DONE:if(10!==h)return;l=QL.HEADER_FIELD_START;break;case QL.HEADERS_ALMOST_DONE:if(10!==h)return;g("onHeadersEnd"),l=QL.PART_DATA_START;break;case QL.PART_DATA_START:l=QL.PART_DATA,f("onPartData");case QL.PART_DATA:if(r=s,0===s){for(t+=d;t<p&&!(e[t]in o);)t+=u;t-=d,h=e[t]}if(s<i.length)i[s]===h?(0===s&&b("onPartData",!0),s++):s=0;else if(s===i.length)s++,13===h?c|=XL:45===h?c|=eM:s=0;else if(s-1===i.length)if(c&XL){if(s=0,10===h){c&=~XL,g("onPartEnd"),g("onPartBegin"),l=QL.HEADER_FIELD_START;break}}else c&eM&&45===h?(g("onPartEnd"),l=QL.END,c=0):s=0;if(s>0)a[s-1]=h;else if(r>0){const e=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);g("onPartData",0,r,e),r=0,f("onPartData"),t--}break;case QL.END:break;default:throw new Error(`Unexpected state entered: ${l}`)}b("onHeaderField"),b("onHeaderValue"),b("onPartData"),this.index=s,this.state=l,this.flags=c}end(){if(this.state===QL.HEADER_FIELD_START&&0===this.index||this.state===QL.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==QL.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}var aM=Object.freeze({__proto__:null,toFormData:async function(e,t){if(!/multipart/i.test(t))throw new TypeError("Failed to fetch");const n=t.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!n)throw new TypeError("no or bad content-type header, no multipart boundary");const r=new rM(n[1]||n[2]);let a,i,o,s,l,c;const u=[],d=new go,p=e=>{o+=y.decode(e,{stream:!0})},h=e=>{u.push(e)},m=()=>{const e=new so(u,c,{type:l});d.append(s,e)},f=()=>{d.append(s,o)},y=new TextDecoder("utf-8");y.decode(),r.onPartBegin=function(){r.onPartData=p,r.onPartEnd=f,a="",i="",o="",s="",l="",c=null,u.length=0},r.onHeaderField=function(e){a+=y.decode(e,{stream:!0})},r.onHeaderValue=function(e){i+=y.decode(e,{stream:!0})},r.onHeaderEnd=function(){if(i+=y.decode(),a=a.toLowerCase(),"content-disposition"===a){const e=i.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);e&&(s=e[2]||e[3]||""),c=function(e){const t=e.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!t)return;const n=t[2]||t[3]||"";let r=n.slice(n.lastIndexOf("\\")+1);return r=r.replace(/%22/g,'"'),r=r.replace(/&#(\d{4});/g,((e,t)=>String.fromCharCode(t))),r}(i),c&&(r.onPartData=h,r.onPartEnd=m)}else"content-type"===a&&(l=i);i="",a=""};for await(const t of e)r.write(t);return r.end(),d}});module.exports=YL;
