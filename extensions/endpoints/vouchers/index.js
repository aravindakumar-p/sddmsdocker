"use strict";class e extends Error{constructor(e,s,c,n){super(e),this.status=s,this.code=c,this.extensions=n||{}}}var s=async(s,{services:c})=>{s.post("/verify-link",(async(s,n)=>{const i=s.accountability,t=s.body,{ItemsService:o}=c;try{if(t.code){const e=new o("sp_voucher_details",{accountability:i,schema:s.schema}),c=await e.readByQuery({fields:["id"],filter:{code:t.code}});!c||c.length<=0||c.length>1?n.send({success:!1,message:"Invalid Code",error:"Invalid Code"}):n.send({id:c[0].id})}else n.send({success:!1,message:"code is required",error:"code is required"})}catch(s){s instanceof e?(n.status(s.status),n.send({success:!1,message:s.message,extensions:{code:s.code,...s.extensions}})):403==s.status?(n.status(403),n.send({success:!1,message:"You don't have permission to access this",code:"ForbiddenException",...s.extensions})):(n.status(500),n.send({success:!1,message:"Unknown Error Occurred",code:"INTERNAL_SERVER_ERROR",...s.extensions}))}})),s.post("/verify-pin",(async(s,n)=>{const i=s.accountability,t=s.body,{ItemsService:o}=c;try{if(t.pin&&t.id){const e=new o("sp_voucher_details",{accountability:i,schema:s.schema}),c=await e.readOne(t.id,{fields:["*","brand.*"]});if(c)if(t.pin!==c.pin)n.send({success:!1,message:"Invalid PIN",error:"Invalid PIN"});else{const{code:e,voucher_code:s,voucher_pin:i,pin:t,expiry_date:o,value:d,brand:a}=c;n.send({code:e,voucher_code:s,voucher_pin:i,pin:t,expiry_date:o,value:d,brand:a})}else n.send({success:!1,message:"Invalid ID",error:"Invalid ID"})}else n.send({success:!1,message:"pin/id required",error:"pin/id required"})}catch(s){s instanceof e?(n.status(s.status),n.send({success:!1,message:s.message,extensions:{code:s.code,...s.extensions}})):403==s.status?(n.status(403),n.send({success:!1,message:"You don't have permission to access this",code:"ForbiddenException",...s.extensions})):(n.status(500),n.send({success:!1,message:"Unknown Error Occurred",code:"INTERNAL_SERVER_ERROR",...s.extensions}))}}))};module.exports=s;
